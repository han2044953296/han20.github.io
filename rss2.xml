<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0"
  xmlns:atom="http://www.w3.org/2005/Atom"
  xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>枫叶冢</title>
    <link>http://zihang.fun/</link>
    
    <atom:link href="http://zihang.fun/rss2.xml" rel="self" type="application/rss+xml"/>
    
    <description>只有努力不会辜负你</description>
    <pubDate>Fri, 03 Feb 2023 07:46:53 GMT</pubDate>
    <generator>http://hexo.io/</generator>
    
    <item>
      <title>监控yarn</title>
      <link>http://zihang.fun/2023/02/03/2-3-1/</link>
      <guid>http://zihang.fun/2023/02/03/2-3-1/</guid>
      <pubDate>Fri, 03 Feb 2023 01:03:40 GMT</pubDate>
      
        
        
      <description>&lt;h1 id=&quot;目标&quot;&gt;&lt;a href=&quot;#目标&quot; class=&quot;headerlink&quot; title=&quot;目标&quot;&gt;&lt;/a&gt;目标&lt;/h1&gt;&lt;p&gt;监控yarn的资源&lt;/p&gt;
&lt;h1 id=&quot;流程&quot;&gt;&lt;a href=&quot;#流程&quot; class=&quot;headerlink&quot; title=&quot;流程&quot;&gt;</description>
        
      
      
      
      <content:encoded><![CDATA[<h1 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h1><p>监控yarn的资源</p><h1 id="流程"><a href="#流程" class="headerlink" title="流程"></a>流程</h1><p>数据采集：采集yarn的指标</p><p>数据处理：实时处理：spark-streaming</p><p>数据输出：mysql(加索引)，olap（毫秒级别）</p><p>数据可视化：superset,dataease</p><p>olap:clickhouse,doris,tidb,phenix</p><p>oltp:支持事务的</p><h1 id="链路"><a href="#链路" class="headerlink" title="链路"></a>链路</h1><p>yarn -&gt; jar 采集数据 -&gt;    kafka-&gt;  sparkstreaming -&gt; ck -&gt; superset&#x2F;dataease</p><p>采集的数据格式：</p><ul><li>文本数据 ： 网络io占据量少，分隔符设置有要求</li><li>json数据 ： json要占用网络io ，解析方便</li></ul><h1 id="start"><a href="#start" class="headerlink" title="start"></a>start</h1><h2 id="采集数据"><a href="#采集数据" class="headerlink" title="采集数据"></a>采集数据</h2><h3 id="yarn的api"><a href="#yarn的api" class="headerlink" title="yarn的api"></a>yarn的api</h3><p>添加yarn的依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.hadoop<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hadoop-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.hadoop<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hadoop-yarn-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>在idea里来进行开发</p><p>设置获取yarn数据的接口</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> sparkfirst</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.yarn.api.records.YarnApplicationState</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.yarn.client.api.YarnClient</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.yarn.conf.YarnConfiguration</span><br><span class="line"></span><br><span class="line">trait <span class="title class_">YarnInfo</span> &#123;</span><br><span class="line"></span><br><span class="line">  def getYarnInfo=&#123;</span><br><span class="line">    <span class="keyword">val</span> client = YarnClient.createYarnClient()</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    init 方法里面要求的是conf ，是yarn的配置文件</span></span><br><span class="line"><span class="comment">    先在resource里加上yarn-site.xml</span></span><br><span class="line"><span class="comment">    然后new配置文件类</span></span><br><span class="line"><span class="comment">    然后启动客户端</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">val</span> configuration = new YarnConfiguration()</span><br><span class="line">    client.<span class="keyword">init</span>(configuration)</span><br><span class="line">    client.start()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> states = util.EnumSet.noneOf(classOf[YarnApplicationState])</span><br><span class="line">    states.add(YarnApplicationState.ACCEPTED)</span><br><span class="line">    states.add(YarnApplicationState.RUNNING)</span><br><span class="line">    states.add(YarnApplicationState.NEW)</span><br><span class="line">    states.add(YarnApplicationState.SUBMITTED)</span><br><span class="line">    states.add(YarnApplicationState.KILLED)</span><br><span class="line">    states.add(YarnApplicationState.NEW_SAVING)</span><br><span class="line">    states.add(YarnApplicationState.FAILED)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> reports = client.getApplications(states)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> value = reports.iterator()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> builder = new StringBuilder</span><br><span class="line">    <span class="keyword">while</span> (value.hasNext)&#123;</span><br><span class="line">      <span class="keyword">val</span> report = value.next()</span><br><span class="line">      <span class="keyword">val</span> report1 = report.getApplicationResourceUsageReport</span><br><span class="line">      <span class="keyword">val</span> id = report.getApplicationId</span><br><span class="line">      <span class="keyword">val</span> host = report.getHost</span><br><span class="line">      <span class="keyword">val</span> applicationType = report.getApplicationType</span><br><span class="line">      <span class="keyword">val</span> name = report.getName</span><br><span class="line">      <span class="keyword">val</span> starttime = report.getStartTime</span><br><span class="line">      <span class="keyword">val</span> user = report.getUser</span><br><span class="line">      <span class="keyword">val</span> finishtime = report.getFinishTime</span><br><span class="line">      <span class="keyword">val</span> mem = report1.getMemorySeconds</span><br><span class="line">      <span class="keyword">val</span> vcore = report1.getVcoreSeconds</span><br><span class="line">      <span class="keyword">val</span> size = report1.getUsedResources.getMemorySize</span><br><span class="line">      <span class="keyword">val</span> cores = report1.getUsedResources.getVirtualCores</span><br><span class="line">      <span class="keyword">val</span> resources = report1.getUsedResources.getResources</span><br><span class="line">      <span class="keyword">val</span> state = report.getYarnApplicationState</span><br><span class="line">      <span class="keyword">val</span> url = report.getTrackingUrl</span><br><span class="line">      <span class="keyword">val</span> margin =</span><br><span class="line">        s<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">           |report: <span class="subst">$&#123;report&#125;</span></span></span><br><span class="line"><span class="string">           |report1 : <span class="subst">$&#123;report1&#125;</span></span></span><br><span class="line"><span class="string">           |id:<span class="subst">$&#123;id&#125;</span></span></span><br><span class="line"><span class="string">           |host:<span class="subst">$&#123;host&#125;</span></span></span><br><span class="line"><span class="string">           |applicationtype : <span class="subst">$&#123;applicationType&#125;</span></span></span><br><span class="line"><span class="string">           |name : <span class="subst">$&#123;name&#125;</span></span></span><br><span class="line"><span class="string">           |starttime <span class="subst">$&#123;starttime&#125;</span></span></span><br><span class="line"><span class="string">           |finishtime : <span class="subst">$&#123;finishtime&#125;</span></span></span><br><span class="line"><span class="string">           |user:<span class="subst">$&#123;user&#125;</span></span></span><br><span class="line"><span class="string">           |memeveryscends:<span class="subst">$&#123;mem&#125;</span></span></span><br><span class="line"><span class="string">           |vcoreeveryscends:<span class="subst">$&#123;vcore&#125;</span></span></span><br><span class="line"><span class="string">           |size:<span class="subst">$&#123;size&#125;</span></span></span><br><span class="line"><span class="string">           |cores<span class="subst">$&#123;cores&#125;</span></span></span><br><span class="line"><span class="string">           |state:<span class="subst">$&#123;state&#125;</span></span></span><br><span class="line"><span class="string">           |url:<span class="subst">$&#123;url&#125;</span></span></span><br><span class="line"><span class="string">           |resources:<span class="subst">$&#123;resources.mkString(<span class="string">&quot;,&quot;</span>)&#125;</span></span></span><br><span class="line"><span class="string">           |---</span></span><br><span class="line"><span class="string">           |&quot;&quot;&quot;</span>.stripMargin</span><br><span class="line">      builder.appendAll(margin)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    println(builder)</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>在主方法里继承接口并且实现方法</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> sparkfirst</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.java.utils.<span class="type">ParameterTool</span></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">testyarn</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">apply</span></span>(parameterTool: <span class="type">ParameterTool</span>): testyarn = <span class="keyword">new</span> testyarn(parameterTool)</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">val</span> tool = <span class="type">ParameterTool</span>.fromArgs(args)</span><br><span class="line">    testyarn(tool).excute()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">testyarn</span>(<span class="params">parameterTool: <span class="type">ParameterTool</span></span>) <span class="keyword">extends</span> <span class="title">YarnInfo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">excute</span></span>(): <span class="type">Unit</span> =&#123;</span><br><span class="line"></span><br><span class="line">    getYarnInfo</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>在机器上启动一个sparksql通过yarn模式的部署</p><p>获取数据如下</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">report</span>: applicationId &#123; id: <span class="number">1</span> cluster_timestamp: <span class="number">1675390427337</span> &#125; user: <span class="string">&quot;hadoop&quot;</span> queue: <span class="string">&quot;default&quot;</span> name: <span class="string">&quot;SparkSQL::192.168.41.132&quot;</span> host: <span class="string">&quot;192.168.41.133&quot;</span> rpc_port: -<span class="number">1</span> yarn_application_state: RUNNING trackingUrl: <span class="string">&quot;http://bigdata4:9999/proxy/application_1675390427337_0001/&quot;</span> diagnostics: <span class="string">&quot;&quot;</span> startTime: <span class="number">1675390547814</span> finishTime: <span class="number">0</span> final_application_status: APP_UNDEFINED app_resource_Usage &#123; num_used_containers: <span class="number">3</span> num_reserved_containers: <span class="number">0</span> used_resources &#123; memory: <span class="number">5120</span> virtual_cores: <span class="number">3</span> resource_value_map &#123; key: <span class="string">&quot;memory-mb&quot;</span> value: <span class="number">5120</span> units: <span class="string">&quot;Mi&quot;</span> type: COUNTABLE &#125; resource_value_map &#123; key: <span class="string">&quot;vcores&quot;</span> value: <span class="number">3</span> units: <span class="string">&quot;&quot;</span> type: COUNTABLE &#125; &#125; reserved_resources &#123; memory: <span class="number">0</span> virtual_cores: <span class="number">0</span> resource_value_map &#123; key: <span class="string">&quot;memory-mb&quot;</span> value: <span class="number">0</span> units: <span class="string">&quot;Mi&quot;</span> type: COUNTABLE &#125; resource_value_map &#123; key: <span class="string">&quot;vcores&quot;</span> value: <span class="number">0</span> units: <span class="string">&quot;&quot;</span> type: COUNTABLE &#125; &#125; needed_resources &#123; memory: <span class="number">5120</span> virtual_cores: <span class="number">3</span> resource_value_map &#123; key: <span class="string">&quot;memory-mb&quot;</span> value: <span class="number">5120</span> units: <span class="string">&quot;Mi&quot;</span> type: COUNTABLE &#125; resource_value_map &#123; key: <span class="string">&quot;vcores&quot;</span> value: <span class="number">3</span> units: <span class="string">&quot;&quot;</span> type: COUNTABLE &#125; &#125; memory_seconds: <span class="number">3804903</span> vcore_seconds: <span class="number">2232</span> queue_usage_percentage: <span class="number">41</span>.<span class="number">666664</span> cluster_usage_percentage: <span class="number">41</span>.<span class="number">666664</span> preempted_memory_seconds: <span class="number">0</span> preempted_vcore_seconds: <span class="number">0</span> application_resource_usage_map &#123; key: <span class="string">&quot;memory-mb&quot;</span> value: <span class="number">3804903</span> &#125; application_resource_usage_map &#123; key: <span class="string">&quot;vcores&quot;</span> value: <span class="number">2232</span> &#125; application_preempted_resource_usage_map &#123; key: <span class="string">&quot;memory-mb&quot;</span> value: <span class="number">0</span> &#125; application_preempted_resource_usage_map &#123; key: <span class="string">&quot;vcores&quot;</span> value: <span class="number">0</span> &#125; &#125; originalTrackingUrl: <span class="string">&quot;http://bigdata3:4040&quot;</span> currentApplicationAttemptId &#123; application_id &#123; id: <span class="number">1</span> cluster_timestamp: <span class="number">1675390427337</span> &#125; attemptId: <span class="number">1</span> &#125; progress: <span class="number">0</span>.<span class="number">1</span> applicationType: <span class="string">&quot;SPARK&quot;</span> log_aggregation_status: LOG_NOT_START unmanaged_application: false priority &#123; priority: <span class="number">0</span> &#125; appNodeLabelExpression: <span class="string">&quot;&lt;Not set&gt;&quot;</span> amNodeLabelExpression: <span class="string">&quot;&lt;DEFAULT_PARTITION&gt;&quot;</span> appTimeouts &#123; application_timeout_type: APP_TIMEOUT_LIFETIME application_timeout &#123; application_timeout_type: APP_TIMEOUT_LIFETIME expire_time: <span class="string">&quot;UNLIMITED&quot;</span> remaining_time: -<span class="number">1</span> &#125; &#125; launchTime: <span class="number">1675390548575</span></span><br><span class="line"><span class="attribute">report1</span> : num_used_containers: <span class="number">3</span> num_reserved_containers: <span class="number">0</span> used_resources &#123; memory: <span class="number">5120</span> virtual_cores: <span class="number">3</span> resource_value_map &#123; key: <span class="string">&quot;memory-mb&quot;</span> value: <span class="number">5120</span> units: <span class="string">&quot;Mi&quot;</span> type: COUNTABLE &#125; resource_value_map &#123; key: <span class="string">&quot;vcores&quot;</span> value: <span class="number">3</span> units: <span class="string">&quot;&quot;</span> type: COUNTABLE &#125; &#125; reserved_resources &#123; memory: <span class="number">0</span> virtual_cores: <span class="number">0</span> resource_value_map &#123; key: <span class="string">&quot;memory-mb&quot;</span> value: <span class="number">0</span> units: <span class="string">&quot;Mi&quot;</span> type: COUNTABLE &#125; resource_value_map &#123; key: <span class="string">&quot;vcores&quot;</span> value: <span class="number">0</span> units: <span class="string">&quot;&quot;</span> type: COUNTABLE &#125; &#125; needed_resources &#123; memory: <span class="number">5120</span> virtual_cores: <span class="number">3</span> resource_value_map &#123; key: <span class="string">&quot;memory-mb&quot;</span> value: <span class="number">5120</span> units: <span class="string">&quot;Mi&quot;</span> type: COUNTABLE &#125; resource_value_map &#123; key: <span class="string">&quot;vcores&quot;</span> value: <span class="number">3</span> units: <span class="string">&quot;&quot;</span> type: COUNTABLE &#125; &#125; memory_seconds: <span class="number">3804903</span> vcore_seconds: <span class="number">2232</span> queue_usage_percentage: <span class="number">41</span>.<span class="number">666664</span> cluster_usage_percentage: <span class="number">41</span>.<span class="number">666664</span> preempted_memory_seconds: <span class="number">0</span> preempted_vcore_seconds: <span class="number">0</span> application_resource_usage_map &#123; key: <span class="string">&quot;memory-mb&quot;</span> value: <span class="number">3804903</span> &#125; application_resource_usage_map &#123; key: <span class="string">&quot;vcores&quot;</span> value: <span class="number">2232</span> &#125; application_preempted_resource_usage_map &#123; key: <span class="string">&quot;memory-mb&quot;</span> value: <span class="number">0</span> &#125; application_preempted_resource_usage_map &#123; key: <span class="string">&quot;vcores&quot;</span> value: <span class="number">0</span> &#125;</span><br><span class="line"><span class="attribute">id</span>:application_1675390427337_0001</span><br><span class="line"><span class="attribute">host</span>:<span class="number">192.168.41.133</span></span><br><span class="line"><span class="attribute">applicationtype</span> : SPARK</span><br><span class="line"><span class="attribute">name</span> : SparkSQL::<span class="number">192.168.41.132</span></span><br><span class="line"><span class="attribute">starttime</span> <span class="number">1675390547814</span></span><br><span class="line"><span class="attribute">finishtime</span> : <span class="number">0</span></span><br><span class="line"><span class="attribute">user</span>:hadoop</span><br><span class="line"><span class="attribute">memeveryscends</span>:<span class="number">3804903</span></span><br><span class="line"><span class="attribute">vcoreeveryscends</span>:<span class="number">2232</span></span><br><span class="line"><span class="attribute">size</span>:<span class="number">5120</span></span><br><span class="line"><span class="attribute">cores3</span></span><br><span class="line"><span class="attribute">state</span>:RUNNING</span><br><span class="line"><span class="attribute">url</span>:http://bigdata4:<span class="number">9999</span>/proxy/application_1675390427337_0001/</span><br><span class="line"><span class="attribute">resources</span>:name: memory-mb, units: Mi, type: COUNTABLE, value: <span class="number">5120</span>, minimum allocation: <span class="number">0</span>, maximum allocation: <span class="number">9223372036854775807</span>, tags:<span class="meta"> [], attributes &#123;&#125;,name: vcores, units: , type: COUNTABLE, value: 3, minimum allocation: 0, maximum allocation: 9223372036854775807, tags: [], attributes &#123;&#125;</span></span><br><span class="line"><span class="meta">---</span></span><br></pre></td></tr></table></figure><p>yarn上的数据如下：</p><p><img src="https://pic.imgdb.cn/item/63dc72ba07d5ca7206288d89.jpg" alt="img">经对比数据一致</p><h2 id="发送数据到kafka"><a href="#发送数据到kafka" class="headerlink" title="发送数据到kafka"></a>发送数据到kafka</h2><p>如下：</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> sparkfirst</span><br><span class="line"><span class="keyword">import</span> java.util.<span class="type">Properties</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.producer.<span class="type">KafkaProducer</span></span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.producer.<span class="type">Producer</span></span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.producer.<span class="type">ProducerRecord</span></span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.java.utils.<span class="type">ParameterTool</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> scala.util.<span class="type">Random</span></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">testyarn</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">apply</span></span>(parameterTool: <span class="type">ParameterTool</span>): testyarn = <span class="keyword">new</span> testyarn(parameterTool)</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">val</span> tool = <span class="type">ParameterTool</span>.fromArgs(args)</span><br><span class="line">    testyarn(tool).excute()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">testyarn</span>(<span class="params">parameterTool: <span class="type">ParameterTool</span></span>) <span class="keyword">extends</span> <span class="title">YarnInfo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">val</span> properties = <span class="keyword">new</span> <span class="type">Properties</span></span><br><span class="line">  properties.put(<span class="string">&quot;bootstrap.servers&quot;</span>, <span class="string">&quot;bigdata3:9092,bigdata4:9092,bigdata5:9092 &quot;</span>)</span><br><span class="line">  properties.put(<span class="string">&quot;key.serializer&quot;</span>, <span class="string">&quot;org.apache.kafka.common.serialization.StringSerializer&quot;</span>)</span><br><span class="line">  properties.put(<span class="string">&quot;value.serializer&quot;</span>, <span class="string">&quot;org.apache.kafka.common.serialization.StringSerializer&quot;</span>)</span><br><span class="line">  properties.put(<span class="string">&quot;acks&quot;</span>, <span class="string">&quot;all&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">excute</span></span>() =&#123;</span><br><span class="line">    <span class="keyword">val</span> producer: <span class="type">Producer</span>[<span class="type">String</span>, <span class="type">String</span>] = <span class="keyword">new</span> <span class="type">KafkaProducer</span>[<span class="type">String</span>, <span class="type">String</span>](properties)</span><br><span class="line">  <span class="keyword">val</span> i = <span class="keyword">new</span> <span class="type">Random</span>().nextInt(<span class="number">10</span>) % <span class="number">3</span></span><br><span class="line">  <span class="keyword">val</span> strings = getYarnInfo.split(<span class="string">&quot;-------------------------------------------------------------&quot;</span>)</span><br><span class="line">  <span class="keyword">for</span> (elem &lt;- strings) &#123;</span><br><span class="line">    println(elem)</span><br><span class="line">    producer.send(<span class="keyword">new</span> <span class="type">ProducerRecord</span>[<span class="type">String</span>, <span class="type">String</span>](<span class="string">&quot;yarninfo&quot;</span>, i, <span class="string">&quot; &quot;</span>,  elem))</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">    producer.close()</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content:encoded>
      
      
      <category domain="http://zihang.fun/categories/%E6%97%A5%E5%BF%97/">日志</category>
      
      
      <category domain="http://zihang.fun/tags/%E7%9B%91%E6%8E%A7yarn/">监控yarn</category>
      
      
      <comments>http://zihang.fun/2023/02/03/2-3-1/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>同步工具</title>
      <link>http://zihang.fun/2023/02/02/2-2/</link>
      <guid>http://zihang.fun/2023/02/02/2-2/</guid>
      <pubDate>Thu, 02 Feb 2023 14:12:45 GMT</pubDate>
      
        
        
      <description>&lt;h1 id=&quot;api&quot;&gt;&lt;a href=&quot;#api&quot; class=&quot;headerlink&quot; title=&quot;api&quot;&gt;&lt;/a&gt;api&lt;/h1&gt;&lt;h2 id=&quot;jdbctohive&quot;&gt;&lt;a href=&quot;#jdbctohive&quot; class=&quot;headerlink&quot; title=&quot;j</description>
        
      
      
      
      <content:encoded><![CDATA[<h1 id="api"><a href="#api" class="headerlink" title="api"></a>api</h1><h2 id="jdbctohive"><a href="#jdbctohive" class="headerlink" title="jdbctohive"></a>jdbctohive</h2><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br></pre></td><td class="code"><pre><span class="line">package project</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.<span class="keyword">sql</span>.catalog.Catalog</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.<span class="keyword">sql</span>.&#123;DataFrame, Dataset, <span class="keyword">Row</span>, SparkSession&#125;</span><br><span class="line"><span class="keyword">import</span> tool.sqlUtils</span><br><span class="line"><span class="keyword">import</span> tool.getmysqldf</span><br><span class="line"><span class="keyword">import</span> tool.savefile</span><br><span class="line"><span class="keyword">import</span> tool.readfile</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.java.utils.ParameterTool</span><br><span class="line"><span class="keyword">object</span> jdbctohive&#123;</span><br><span class="line">  def apply(parameterTool: ParameterTool): jdbctohive = <span class="built_in">new</span> jdbctohive(parameterTool)</span><br><span class="line"></span><br><span class="line">  def main(args: <span class="keyword">Array</span>[String]): Unit = &#123;</span><br><span class="line">    <span class="keyword">if</span> (args.length==<span class="number">0</span>)&#123;</span><br><span class="line">      println(</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">          |欢迎使用本程序</span><br><span class="line">          |参数详情 mysql hive</span><br><span class="line">          |-------------------------mysql</span><br><span class="line">          |url 例子 ： jdbc:mysql://bigdata2:3306/try</span><br><span class="line">          |user 例子 ： root</span><br><span class="line">          |password 例子 ： liuzihan010616</span><br><span class="line">          |tablename =&gt; 支持谓词下压  例子 ： emp 或者 select * from emp 等</span><br><span class="line">          |driver =&gt; com.mysql.jdbc.Driver</span><br><span class="line">          |---------------------------hive</span><br><span class="line">          |mode模式 overwrite append 等</span><br><span class="line">          |hive中的table 例子 bigdata.emp</span><br><span class="line">          |可选参数 分区字段 自动开启的是动态分区 例子 deptno</span><br><span class="line">          |分区字段 [字段值] [标志位]：代表是不是只更新这一个分区的数据</span><br><span class="line">          |jdbc:mysql://bigdata2:3306/try root liuzihan010616 &quot;<span class="keyword">select</span> * <span class="keyword">from</span> emp &quot; com.mysql.jdbc.Driver append default.tmp deptno,sal,test,re 999,888</span><br><span class="line">          |&quot;&quot;&quot;.stripMargin)</span><br><span class="line">    &#125;</span><br><span class="line">    val tool = ParameterTool.fromArgs(args)</span><br><span class="line">    jdbctohive(tool).excute(args)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> jdbctohive(parameterTool: ParameterTool) &#123;</span><br><span class="line">  <span class="keyword">System</span>.setProperty(&quot;HADOOP_USER_NAME&quot;,&quot;hadoop&quot;)</span><br><span class="line">  val spark = SparkSession.builder().appName(&quot;sqoop&quot;).master(&quot;local[4]&quot;).enableHiveSupport().getOrCreate()</span><br><span class="line">  spark.sparkContext.setCheckpointDir(&quot;/tmp/checkpoint&quot;)</span><br><span class="line"></span><br><span class="line">  val getmysqldf = <span class="built_in">new</span> readfile</span><br><span class="line">  val sqlUtils = <span class="built_in">new</span> sqlUtils</span><br><span class="line">  val saveFile = <span class="built_in">new</span> savefile</span><br><span class="line">  private val catalog: Catalog = spark.catalog</span><br><span class="line">  var changecolunm = <span class="keyword">false</span></span><br><span class="line">  <span class="keyword">import</span> spark.implicits._</span><br><span class="line">  <span class="keyword">import</span> org.apache.spark.<span class="keyword">sql</span>.<span class="keyword">functions</span>._</span><br><span class="line"></span><br><span class="line">  val url = parameterTool.getRequired(&quot;url&quot;)</span><br><span class="line">  val <span class="keyword">user</span> = parameterTool.getRequired(&quot;user&quot;)</span><br><span class="line">  val <span class="keyword">password</span> = parameterTool.getRequired(&quot;password&quot;)</span><br><span class="line">  val table = parameterTool.getRequired(&quot;table&quot;)</span><br><span class="line">  val driver = parameterTool.getRequired(&quot;driver&quot;)</span><br><span class="line">  val mode = parameterTool.getRequired(&quot;mode&quot;)</span><br><span class="line">  val hivetable = parameterTool.getRequired(&quot;hivetable&quot;)</span><br><span class="line">  val hivepartition = parameterTool.<span class="keyword">get</span>(&quot;hivepartition&quot;,<span class="keyword">null</span>)</span><br><span class="line">  val partitionValues = parameterTool.<span class="keyword">get</span>(&quot;partitionValues&quot;)</span><br><span class="line">  val insertpartition = parameterTool.<span class="keyword">get</span>(&quot;insertpartition&quot;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  def excute(args: <span class="keyword">Array</span>[String]): Unit = &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    // 获取jdbc的df</span><br><span class="line">    val mysqlconnect = getmysqldf.getmysqldataframe(spark, url, <span class="keyword">user</span>, <span class="keyword">password</span>, <span class="keyword">table</span> , driver)</span><br><span class="line">    // 验证指示</span><br><span class="line">    mysqlconnect.<span class="keyword">show</span>()</span><br><span class="line">    // 生成hive参数数组</span><br><span class="line">//    var hiveconf = <span class="built_in">new</span> <span class="keyword">Array</span>[String](args.length<span class="number">-5</span>)</span><br><span class="line">//    hiveconf = util.Arrays.copyOfRange(args, <span class="number">5</span>, args.length)</span><br><span class="line">    //hiveconf.<span class="keyword">foreach</span>(println(_))</span><br><span class="line">    jdbctohive(args.length,catalog,mysqlconnect)</span><br><span class="line">    spark.stop()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  def changecolnums(<span class="type">int</span>: <span class="type">Int</span>,resourcesql:DataFrame) =&#123;</span><br><span class="line">    var finallyresult:Dataset[<span class="keyword">Row</span>] = <span class="keyword">null</span> // 最终结果集</span><br><span class="line">    var frame:DataFrame = <span class="keyword">null</span> // 中间变量</span><br><span class="line">    val strings2 = hivepartition.split(&quot;,&quot;)</span><br><span class="line">    var hiveconclumns = spark.<span class="keyword">table</span>(hivetable).<span class="keyword">columns</span> // hive的列数</span><br><span class="line">    //hiveconclumns.<span class="keyword">foreach</span>(println((_))) // 验证hive的列数</span><br><span class="line">    var mysqlconnect:DataFrame = resourcesql // 设置数据源的resource</span><br><span class="line"></span><br><span class="line">    // 判断分区字段在不在jdbc的数据里，如果不在，则在jdbc的数据源中先添加上分区字段</span><br><span class="line">    var strings1:<span class="keyword">Array</span>[String] =<span class="keyword">null</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="type">int</span> &gt; <span class="number">8</span> &amp;&amp; partitionValues != <span class="keyword">null</span>)&#123;</span><br><span class="line">      strings1 = partitionValues.split(&quot;,&quot;)</span><br><span class="line">    &#125;</span><br><span class="line">    var flagtmp:<span class="type">Int</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (elem &lt;- strings2)&#123;</span><br><span class="line">      <span class="keyword">if</span> (!mysqlconnect.<span class="keyword">columns</span>.contains(elem))&#123;</span><br><span class="line">        println(elem)</span><br><span class="line">        println(strings1(flagtmp))</span><br><span class="line">        mysqlconnect = mysqlconnect.withColumn(elem,lit(strings1(flagtmp)))</span><br><span class="line">        flagtmp = flagtmp + <span class="number">1</span></span><br><span class="line">        mysqlconnect.<span class="keyword">show</span>()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    val jdbcconclumns = mysqlconnect.<span class="keyword">columns</span> // jdbc的列数</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    var jdbcoldsource:Dataset[<span class="keyword">Row</span>] = <span class="keyword">null</span> // 源数据库的数据 <span class="keyword">checkpoint</span>是为了破坏数据均衡，以后能编写变读取</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="type">int</span> == <span class="number">10</span>)&#123;</span><br><span class="line">      hivepartition.split(&quot;,&quot;)(<span class="number">0</span>) match &#123;</span><br><span class="line">        <span class="keyword">case</span> &quot;&quot; =&gt; &#123;</span><br><span class="line">          println(&quot;-------------------------无操作&quot;)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">case</span> _ =&gt; &#123;</span><br><span class="line">          hivepartition.split(&quot;,&quot;).length match &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">1</span> =&gt;</span><br><span class="line">            &#123;</span><br><span class="line">              jdbcoldsource = spark.<span class="keyword">sql</span>(</span><br><span class="line">                s&quot;&quot;&quot;</span><br><span class="line">                   |select * from $&#123;hivetable&#125; where $&#123;hivepartition&#125; != $&#123;partitionValues&#125;</span><br><span class="line">                   |&quot;&quot;&quot;.stripMargin).<span class="keyword">checkpoint</span>()</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">case</span> _ =&gt;</span><br><span class="line">            &#123;</span><br><span class="line">              var tmpstring:String  = <span class="keyword">null</span></span><br><span class="line">              var flag:<span class="type">Int</span> = <span class="number">0</span></span><br><span class="line">                 val flagvalue = partitionValues.split(&quot;,&quot;)</span><br><span class="line">                  <span class="keyword">for</span> (elem &lt;- hivepartition.split(&quot;,&quot;))&#123;</span><br><span class="line">                 <span class="keyword">if</span> (elem == hivepartition.split(&quot;,&quot;)(hivepartition.split(&quot;,&quot;).length<span class="number">-1</span>))&#123;</span><br><span class="line">                   tmpstring = tmpstring + elem + &quot;!=&quot; + flagvalue(flag)</span><br><span class="line">                 &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                   tmpstring = tmpstring + elem + &quot;!=&quot; + flagvalue(flag) + &quot;and&quot;</span><br><span class="line">                 &#125;</span><br><span class="line">                    flag = flag + <span class="number">1</span></span><br><span class="line">              &#125;</span><br><span class="line">              jdbcoldsource = spark.<span class="keyword">sql</span>(</span><br><span class="line">                s&quot;&quot;&quot;</span><br><span class="line">                   |select * from $&#123;hivetable&#125; where $&#123;tmpstring&#125;</span><br><span class="line">                   |&quot;&quot;&quot;.stripMargin).<span class="keyword">checkpoint</span>()</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      jdbcoldsource =  spark.<span class="keyword">sql</span>(</span><br><span class="line">        s&quot;&quot;&quot;</span><br><span class="line">           |select * from $&#123;hivetable&#125;</span><br><span class="line">           |&quot;&quot;&quot;.stripMargin).<span class="keyword">checkpoint</span>()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    var existcolunms: <span class="keyword">Array</span>[String] = <span class="keyword">null</span>  // 设置hive或者mysql的额外列</span><br><span class="line">    var resultdf: DataFrame = jdbcoldsource // 获取hive的数据原始数据</span><br><span class="line"></span><br><span class="line">    // 判断是hive的列多，还是数据源的列数多</span><br><span class="line">    <span class="keyword">if</span> (hiveconclumns.length &gt;= jdbcconclumns.length)&#123;</span><br><span class="line">      // 判断额外列的存在</span><br><span class="line">      existcolunms= hiveconclumns.<span class="keyword">filter</span>(hivecol =&gt; &#123;</span><br><span class="line">        val <span class="type">bool</span> = jdbcconclumns.map(jdbccol =&gt; &#123;</span><br><span class="line">          jdbccol == hivecol</span><br><span class="line">        &#125;).contains(<span class="keyword">true</span>)</span><br><span class="line">        !<span class="type">bool</span></span><br><span class="line">      &#125;)</span><br><span class="line">      // 判断两个列数是不是相等</span><br><span class="line">        <span class="keyword">if</span> (existcolunms.isEmpty) &#123;</span><br><span class="line">          frame = mysqlconnect.selectExpr(hiveconclumns: _*)</span><br><span class="line">          frame</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        // 列数不相等的时候让列数少的加列</span><br><span class="line">        resultdf = mysqlconnect</span><br><span class="line">        <span class="keyword">for</span> (elem &lt;- existcolunms)&#123;</span><br><span class="line">          resultdf = resultdf.withColumn(elem, lit(<span class="keyword">null</span>))</span><br><span class="line">        &#125;</span><br><span class="line">        // 对字段进行排序 ， 让分区数据的分区字段在最后一列</span><br><span class="line">        frame = resultdf.selectExpr(hiveconclumns: _*)</span><br><span class="line">        // 验证数据</span><br><span class="line">        frame.<span class="keyword">show</span>()</span><br><span class="line">        // 整合历史数据</span><br><span class="line">        finallyresult = jdbcoldsource.<span class="keyword">union</span>(frame)</span><br><span class="line">        // 验证数据</span><br><span class="line">        finallyresult.<span class="keyword">show</span>()</span><br><span class="line">        changecolunm = <span class="keyword">true</span></span><br><span class="line">        finallyresult</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      // 数据的列多</span><br><span class="line">      existcolunms= jdbcconclumns.<span class="keyword">filter</span>(jdbccol =&gt; &#123;</span><br><span class="line">        val <span class="type">bool</span> = hiveconclumns.map(hivecol =&gt; &#123;</span><br><span class="line">          jdbccol == hivecol</span><br><span class="line">        &#125;).contains(<span class="keyword">true</span>)</span><br><span class="line">        !<span class="type">bool</span></span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (existcolunms.isEmpty) &#123;</span><br><span class="line">        frame = mysqlconnect.selectExpr(hiveconclumns: _*)</span><br><span class="line">        frame</span><br><span class="line">      &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (elem &lt;- existcolunms)&#123;</span><br><span class="line">          resultdf = resultdf.withColumn(elem, lit(<span class="keyword">null</span>))</span><br><span class="line">        &#125;</span><br><span class="line">        frame = resultdf.selectExpr(jdbcconclumns: _*)</span><br><span class="line">        finallyresult = frame.<span class="keyword">union</span>(mysqlconnect)</span><br><span class="line">        changecolunm = <span class="keyword">true</span></span><br><span class="line">        finallyresult</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  def jdbctohive(<span class="type">int</span>: <span class="type">Int</span>,catalog: Catalog,mysqlconnect: DataFrame)=&#123;</span><br><span class="line">    // 分割字符串获取hive的 表和数据库</span><br><span class="line">    val hivedbandtables = hivetable.split(&quot;\\.&quot;)</span><br><span class="line">    val hivepart = hivepartition.split(&quot;,&quot;)</span><br><span class="line">    hivepart.<span class="keyword">foreach</span>(println(_))</span><br><span class="line">// catalog的方法 获取表存不存在的方法</span><br><span class="line">//    catalog.listTables(strings(<span class="number">0</span>)).<span class="keyword">show</span>()</span><br><span class="line">//    val empty = catalog.listTables(strings(<span class="number">0</span>)).<span class="keyword">filter</span>(x =&gt; &#123;</span><br><span class="line">//      x.name == strings(<span class="number">1</span>)</span><br><span class="line">//    &#125;).isEmpty</span><br><span class="line">    val empty = catalog.tableExists(hivedbandtables(<span class="number">0</span>),hivedbandtables(<span class="number">1</span>))</span><br><span class="line">//<span class="comment">-----------------------------------------------------------------------------</span></span><br><span class="line">//    <span class="keyword">sql</span>的方法</span><br><span class="line">//    val empty1 = spark.<span class="keyword">sql</span>(</span><br><span class="line">//      &quot;&quot;&quot;</span><br><span class="line">//        |show tables in hivedb</span><br><span class="line">//        |&quot;&quot;&quot;.stripMargin).<span class="keyword">filter</span>(&quot;tableName = &#x27;hivetablename&#x27;&quot;).isEmpty</span><br><span class="line">// <span class="comment">--------------------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    // 判断列数是不是相等</span><br><span class="line">    var frameresult:DataFrame = mysqlconnect</span><br><span class="line">    // 先判断表存不存在 ，因为判断列数的方法要求表存在</span><br><span class="line">      empty match &#123;</span><br><span class="line">          // 表不存在</span><br><span class="line">      <span class="keyword">case</span> <span class="keyword">false</span> =&gt; &#123;</span><br><span class="line">        // 判断输入的变量个数执行 判断分区表还是普通表</span><br><span class="line">        <span class="keyword">if</span> (<span class="type">int</span> &gt; <span class="number">7</span>) &#123;</span><br><span class="line">          println(&quot;-----------------分区表&quot;)</span><br><span class="line">          // 判断分区的参数在不在列中 如果不在 ，则加上 ，在的话就自动往下走</span><br><span class="line">          var hivepartval:<span class="keyword">Array</span>[String] =<span class="keyword">null</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="type">int</span> &gt; <span class="number">8</span> &amp;&amp; partitionValues != <span class="keyword">null</span>)&#123;</span><br><span class="line">            hivepartval = partitionValues.split(&quot;,&quot;)</span><br><span class="line">          &#125;</span><br><span class="line">          var flagtmp:<span class="type">Int</span> = <span class="number">0</span>;</span><br><span class="line">          <span class="keyword">for</span> (elem &lt;- hivepart)&#123;</span><br><span class="line">            <span class="keyword">if</span> (!mysqlconnect.<span class="keyword">columns</span>.contains(elem))&#123;</span><br><span class="line">              println(elem)</span><br><span class="line">              println(hivepartval(flagtmp))</span><br><span class="line">              frameresult = frameresult.withColumn(elem,lit(hivepartval(flagtmp)))</span><br><span class="line">              flagtmp = flagtmp + <span class="number">1</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">          println(&quot;-----------普通表&quot;)</span><br><span class="line">          frameresult = mysqlconnect</span><br><span class="line">          mysqlconnect.<span class="keyword">show</span>()</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">case</span> <span class="keyword">true</span> =&gt; &#123;</span><br><span class="line">        // 表存在</span><br><span class="line">        // 判断是不是分区表</span><br><span class="line">        frameresult = changecolnums(<span class="type">int</span>, mysqlconnect)</span><br><span class="line">//        <span class="keyword">if</span> (args.length &gt; <span class="number">7</span>) &#123;</span><br><span class="line">//          println(&quot;-----------------分区表&quot;)</span><br><span class="line">//          <span class="keyword">if</span> (!mysqlconnect.<span class="keyword">columns</span>.contains(args(<span class="number">7</span>)))&#123;</span><br><span class="line">//            frameresult = changecolnums(args, hiveconf, mysqlconnect)</span><br><span class="line">//          &#125;</span><br><span class="line">//        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">//          println(&quot;-----------普通表&quot;)</span><br><span class="line">//          frameresult = mysqlconnect</span><br><span class="line">//        &#125;</span><br><span class="line">        frameresult.<span class="keyword">show</span>()&#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    spark.conf.<span class="keyword">set</span>(&quot;hive.exec.dynamic.partition.mode&quot;,&quot;nonstrict&quot;)</span><br><span class="line">    spark.conf.<span class="keyword">set</span>(&quot;hive.exec.dynamic.partition&quot;,&quot;true&quot;)</span><br><span class="line">    spark.conf.<span class="keyword">set</span>(&quot;spark.sql.parquet.writeLegacyFormat&quot;, &quot;true&quot;)</span><br><span class="line">    println(empty)</span><br><span class="line">    saveFile.savetohiveapi(spark,empty,frameresult,hivetable,mode,hivepartition,changecolunm)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="hivetojdbc"><a href="#hivetojdbc" class="headerlink" title="hivetojdbc"></a>hivetojdbc</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> project</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.sql.SparkSession</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.sql.catalog.Catalog</span><br><span class="line"><span class="keyword">import</span> tool.&#123;getmysqldf, savefile, sqlUtils,readfile&#125;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.java.utils.ParameterTool</span><br><span class="line">object hivetojdbc&#123;</span><br><span class="line">  def <span class="title function_">apply</span><span class="params">(parameterTool: ParameterTool)</span>: hivetojdbc = <span class="keyword">new</span> <span class="title class_">hivetojdbc</span>(parameterTool)</span><br><span class="line"></span><br><span class="line">  def <span class="title function_">main</span><span class="params">(args: Array[String])</span>: Unit = &#123;</span><br><span class="line">    <span class="keyword">if</span> (args.length==<span class="number">0</span>)&#123;</span><br><span class="line">      println(</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">          |欢迎使用本程序</span></span><br><span class="line"><span class="string">          |参数说明</span></span><br><span class="line"><span class="string">          |总体参数种类 hive mysql</span></span><br><span class="line"><span class="string">          |---------------------------hive</span></span><br><span class="line"><span class="string">          |hive中要选择的字段 例子 ： &quot;sal,big  / *  &quot;</span></span><br><span class="line"><span class="string">          |hive的table的名字 例子 ： bigdata_hive3.emp</span></span><br><span class="line"><span class="string">          |hive中的 条件可以为空 例子 ： where sal &gt; &#x27;300&#x27;</span></span><br><span class="line"><span class="string">          |---------------------------mysql</span></span><br><span class="line"><span class="string">          |savemode overwrite append 等</span></span><br><span class="line"><span class="string">          |url 例子 ： jdbc:mysql://bigdata2:3306/try</span></span><br><span class="line"><span class="string">          |user 例子 ： root</span></span><br><span class="line"><span class="string">          |password 例子 ： liuzihan010616</span></span><br><span class="line"><span class="string">          |dbtable 例子 ： emp</span></span><br><span class="line"><span class="string">          |幂等性的列 ： 例子 ： sal</span></span><br><span class="line"><span class="string">          |驱动名称 ： 例子 com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="string">          |&quot;&quot;&quot;</span>.stripMargin)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">val</span> <span class="variable">tool</span> <span class="operator">=</span> ParameterTool.fromArgs(args)</span><br><span class="line">    hivetojdbc(tool).excute()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">hivetojdbc</span>(parameterTool: ParameterTool) &#123;</span><br><span class="line">  <span class="type">val</span> <span class="variable">spark</span> <span class="operator">=</span> SparkSession.builder().enableHiveSupport().getOrCreate()</span><br><span class="line">  <span class="type">val</span> <span class="variable">getmysqldf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">readfile</span></span><br><span class="line">  <span class="type">val</span> <span class="variable">sqlUtils</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">sqlUtils</span></span><br><span class="line">  <span class="type">val</span> <span class="variable">saveFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">savefile</span></span><br><span class="line">  <span class="keyword">private</span> val catalog: Catalog = spark.catalog</span><br><span class="line">  <span class="type">val</span> <span class="variable">hiveconclunms</span> <span class="operator">=</span> parameterTool.getRequired(<span class="string">&quot;hiveconclumns&quot;</span>)</span><br><span class="line">  <span class="type">val</span> <span class="variable">hivetable</span> <span class="operator">=</span> parameterTool.getRequired(<span class="string">&quot;hivetable&quot;</span>)</span><br><span class="line">  <span class="type">val</span> <span class="variable">hiveoption</span> <span class="operator">=</span> parameterTool.get(<span class="string">&quot;hiveoption&quot;</span>,<span class="literal">null</span>)</span><br><span class="line">  <span class="type">val</span> <span class="variable">url</span> <span class="operator">=</span> parameterTool.get(<span class="string">&quot;url&quot;</span>,<span class="string">&quot;jdbc:mysql://bigdata2:3306/bigdata&quot;</span>)</span><br><span class="line">  <span class="type">val</span> <span class="variable">user</span> <span class="operator">=</span> parameterTool.get(<span class="string">&quot;user&quot;</span>,<span class="string">&quot;root&quot;</span>)</span><br><span class="line">  <span class="type">val</span> <span class="variable">pasword</span> <span class="operator">=</span> parameterTool.get(<span class="string">&quot;password&quot;</span>,<span class="string">&quot;liuzihan010616&quot;</span>)</span><br><span class="line">  <span class="type">val</span> <span class="variable">dbtable</span> <span class="operator">=</span> parameterTool.getRequired(<span class="string">&quot;dbtable&quot;</span>)</span><br><span class="line">  <span class="type">val</span> <span class="variable">driver</span> <span class="operator">=</span> parameterTool.getRequired(<span class="string">&quot;driver&quot;</span>)</span><br><span class="line">  <span class="type">val</span> <span class="variable">midengconclumns</span> <span class="operator">=</span> parameterTool.getRequired(<span class="string">&quot;col&quot;</span>)</span><br><span class="line">  <span class="type">val</span> <span class="variable">mode</span> <span class="operator">=</span> parameterTool.getRequired(<span class="string">&quot;mode&quot;</span>)</span><br><span class="line"></span><br><span class="line">  def <span class="title function_">excute</span><span class="params">()</span>: Unit = &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">val</span> <span class="variable">frame</span> <span class="operator">=</span> sqlUtils.checksql(spark, sqlUtils.hivesqlchoose(hiveconclunms,hivetable,hiveoption))</span><br><span class="line">    saveFile.savetojdbc(spark,frame,url,user,pasword,dbtable,driver,midengconclumns,mode)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="sql方式"><a href="#sql方式" class="headerlink" title="sql方式"></a>sql方式</h1><h2 id="jdbctohive-1"><a href="#jdbctohive-1" class="headerlink" title="jdbctohive"></a>jdbctohive</h2><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">package sparkfirst</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.<span class="keyword">sql</span>.SparkSession</span><br><span class="line"><span class="keyword">import</span> tool.savefile</span><br><span class="line"><span class="keyword">import</span> tool.sqlUtils</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.<span class="keyword">sql</span>.<span class="keyword">functions</span>._</span><br><span class="line"><span class="keyword">object</span> test &#123;</span><br><span class="line">  val spark = SparkSession.builder().appName(&quot;Sparksql01&quot;).master(&quot;local[4]&quot;).enableHiveSupport().getOrCreate()</span><br><span class="line">  private val savefile = <span class="built_in">new</span> savefile</span><br><span class="line">  private val utils = <span class="built_in">new</span> sqlUtils</span><br><span class="line">  def main(args: <span class="keyword">Array</span>[String]): Unit = &#123;</span><br><span class="line">    val df = spark.<span class="keyword">read</span>.format(&quot;JDBC&quot;)</span><br><span class="line">      .<span class="keyword">option</span>(&quot;url&quot;,&quot;jdbc:mysql://bigdata2:3306/try&quot;)</span><br><span class="line">      .<span class="keyword">option</span>(&quot;dbtable&quot;, &quot;emp&quot;)</span><br><span class="line">      .<span class="keyword">option</span>(&quot;user&quot;, &quot;root&quot;)</span><br><span class="line">      .<span class="keyword">option</span>(&quot;password&quot;, &quot;liuzihan010616&quot;)</span><br><span class="line">      .<span class="keyword">load</span>()</span><br><span class="line">    df.<span class="keyword">select</span>(&quot;sal&quot;).tail(<span class="number">1</span>).<span class="keyword">foreach</span>(println(_))</span><br><span class="line">    println(df.<span class="keyword">select</span>(&quot;sal&quot;).tail(<span class="number">1</span>)(<span class="number">0</span>)(<span class="number">0</span>))</span><br><span class="line">    df.<span class="keyword">show</span>()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    var str:String = <span class="keyword">null</span></span><br><span class="line">    val <span class="type">bool</span> = spark.catalog.tableExists(&quot;default.tmp&quot;)</span><br><span class="line">    <span class="keyword">if</span> (<span class="type">bool</span>)&#123;</span><br><span class="line">      spark.<span class="keyword">sql</span>(</span><br><span class="line">        s&quot;&quot;&quot;</span><br><span class="line">          |drop table default.tmp</span><br><span class="line">          |&quot;&quot;&quot;.stripMargin)</span><br><span class="line">      str = utils.mkcreatesql(df, &quot;default.tmp&quot;, &quot;text&quot;, &quot;&#x27;,&#x27;&quot;,&quot;deptno,hiredate&quot;)</span><br><span class="line">      utils.checksql(spark,str)</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      str = utils.mkcreatesql(df, &quot;default.tmp&quot;, &quot;text&quot;, &quot;&#x27;,&#x27;&quot;,&quot;deptno,hiredate&quot;)</span><br><span class="line">      utils.checksql(spark,str)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    spark.conf.<span class="keyword">set</span>(&quot;hive.exec.dynamic.partition.mode&quot;,&quot;nonstrict&quot;)</span><br><span class="line">    spark.conf.<span class="keyword">set</span>(&quot;hive.exec.dynamic.partition&quot;,&quot;true&quot;)</span><br><span class="line">    val frame = df.withColumn(&quot;ee&quot;, lit(&quot;aaa&quot;))</span><br><span class="line">    utils.insertmake(spark,df,&quot;default.tmp&quot;,&quot;&#x27;,&#x27;&quot;,&quot;deptno,hiredate&quot;)</span><br><span class="line">    utils.changecolunms(spark,frame,&quot;default.tmp&quot;)</span><br><span class="line">    utils.insertmake(spark,frame,&quot;default.tmp&quot;,&quot;&#x27;,&#x27;&quot;,&quot;deptno,hiredate&quot;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="hivetojdbc-1"><a href="#hivetojdbc-1" class="headerlink" title="hivetojdbc"></a>hivetojdbc</h2><p>用sqlUtils里自己定义的api来进行</p><h1 id="思路及实现功能"><a href="#思路及实现功能" class="headerlink" title="思路及实现功能"></a>思路及实现功能</h1><h2 id="source"><a href="#source" class="headerlink" title="source"></a>source</h2><p>通过api进行对jdbc数据接收</p><p>通过</p><figure class="highlight ocaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">getmysqldf.getmysqldataframe(spark, url, user, password, table , driver)</span><br><span class="line">----------------------------------------------------------------------------------------------</span><br><span class="line">  def getmysqldataframe(sparkSession: <span class="type">SparkSession</span>,<span class="built_in">string</span>: <span class="type">String</span>*) =&#123;</span><br><span class="line">    <span class="keyword">val</span> sql = <span class="built_in">string</span>(<span class="number">3</span>)</span><br><span class="line">    <span class="keyword">val</span> frame: <span class="type">DataFrame</span> = sparkSession.read.format(<span class="string">&quot;jdbc&quot;</span>).options(<span class="type">Map</span>(<span class="string">&quot;url&quot;</span> -&gt; <span class="built_in">string</span>(<span class="number">0</span>), <span class="string">&quot;user&quot;</span> -&gt; <span class="built_in">string</span>(<span class="number">1</span>), <span class="string">&quot;password&quot;</span> -&gt; <span class="built_in">string</span>(<span class="number">2</span>), <span class="string">&quot;dbtable&quot;</span> -&gt; s<span class="string">&quot;($sql) as tmp&quot;</span>,<span class="string">&quot;driver&quot;</span>-&gt;<span class="built_in">string</span>(<span class="number">4</span>))).load<span class="literal">()</span></span><br><span class="line">    frame</span><br><span class="line">  &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>来获取jdbc数据</p><p>其他的方法 ： 其中options 可以换成多个option来进行，option里是KV类型的</p><p>通过</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"> val frame = sqlUtils.checksql(spark, sqlUtils.hivesqlchoose(hiveconclunms,hivetable,hiveoption))</span></span><br><span class="line"><span class="section">-----------------------------------------------------------------------------------------------------------</span></span><br><span class="line"><span class="code">  def checksql(spark:SparkSession, string: String)=&#123;</span></span><br><span class="line"><span class="code">    spark.sql(string)</span></span><br><span class="line"><span class="section">&#125;</span></span><br><span class="line"><span class="section">---------------------------------------------------------------------------------------------------------------</span></span><br><span class="line"><span class="code"> def hivesqlchoose(hiveconclumns:String,hivetable:String,hiveoptions:String)=&#123;</span></span><br><span class="line"></span><br><span class="line"><span class="code">    &quot;select&quot; + &quot; &quot; + hiveconclumns + &quot; &quot; + &quot;from&quot; + &quot; &quot; +  hiveconclumns + &quot; &quot; + hiveoptions</span></span><br><span class="line"><span class="code">  &#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>前提在saprksession处打开enablesupporthive参数</p><h2 id="todo"><a href="#todo" class="headerlink" title="todo"></a>todo</h2><p>通过api对数据进行整合以及处理</p><p>功能 ：</p><ul><li>jdbctohive<ul><li>基本功能<ul><li>同步普通表</li><li>同步分区表<ul><li>单分区</li><li>多分区</li></ul></li></ul></li><li>追加功能api<ul><li>用户自定义分区字段及其值</li><li>用户在jdbc数据中增加列，hive中自动增加列</li><li>分区字段更改且不丢失源数据</li><li>可以实现表中自带的字段以及用户定义的字段一起分区的操作</li><li>实现单独对一个分区的数据追加或者重新写入</li><li>设置hive表的存储以及压缩格式</li><li>实现对所有分区的追加或者重新写入</li><li>通过flink的参数工具部署</li></ul></li><li>追加功能sql<ul><li>实现用户自定义分区字段以及值</li><li>用户在jdbc数据中增加列，hive中自动增加列</li><li>可以实现表中自带的字段以及用户定义的字段一起分区的操作</li><li>实现单独对一个分区的数据追加或者重新写入</li><li>实现对所有分区的追加或者重新写入</li><li>设置hive表的存储格式</li><li>实现设置存储格式text等</li><li>通过flink的参数工具部署</li></ul></li></ul></li><li>hivetojdbc<ul><li>基本功能<ul><li>同步数据</li></ul></li><li>追加功能<ul><li>幂等性操作</li></ul></li></ul></li></ul><p>基本功能没有上面要注意的点，但是多分区的时候我是采用获取字符串然后split之后map加上数据类型然后mkstring制作的</p><p>sql：</p><p>但是分区一般分为数据里的分区字段，以及用户自定义的分区字段，针对于用户自定义的分区，我直接把他们定义为string，但是对于数据里的分区字段，我选择保留他原始的类型，通过筛选出他包含的分区字段的schema信息，然后通过他的datatype，来进行数据的备份，最后和上述用户自定义的分区字段拼接到一起，就可以了，最后前面加上partitioned by 就好了，注意点是要提取变量，以及判断最后一次的时机，以及如何判断分区列在不在字段里。</p><p>api：</p><p>对于api则更为简单，直接调用partitionbyapi然后把字符串通过split然后：_*的方式传入，就ok了，但是api的分区字段必须是在df里的，也就是说，我们要提前把分区字段加上，先判断有没有分区字段，然后进而加上分区字段</p><p>追加功能：</p><h2 id="sink"><a href="#sink" class="headerlink" title="sink"></a>sink</h2><p>通过api对数据进行输出到表</p><h3 id="sink到hive"><a href="#sink到hive" class="headerlink" title="sink到hive"></a>sink到hive</h3><p>api</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">    saveFile.savetohiveapi(spark,empty,frameresult,hivetable,mode,hivepartition,changecolunm,fileformated,codec)</span><br><span class="line"><span class="comment">------------------------------------------------------------------------------------------------------------------</span></span><br><span class="line">def savetohiveapi(sparkSession: SparkSession,<span class="type">boolean</span>: <span class="type">Boolean</span>,spark: DataFrame,hivetable:String,mode:String,hivepartition:String,changecolnums:<span class="type">Boolean</span>,fileformat:String,codec:String) = &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!<span class="type">boolean</span>)&#123;</span><br><span class="line">      <span class="keyword">if</span> (hivepartition != <span class="keyword">null</span>)&#123;</span><br><span class="line">        spark.<span class="keyword">write</span>.partitionBy(hivepartition.split(&quot;,&quot;):_*).<span class="keyword">option</span>(&quot;fileFormat&quot;,fileformat).<span class="keyword">option</span>(&quot;compression&quot;,codec).mode(mode).format(&quot;hive&quot;).saveAsTable(hivetable)</span><br><span class="line">      &#125;<span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">        println(hivetable)</span><br><span class="line">        println(hivepartition)</span><br><span class="line">        spark.<span class="keyword">write</span>.<span class="keyword">option</span>(&quot;fileFormat&quot;,fileformat).<span class="keyword">option</span>(&quot;compression&quot;,codec).mode(mode).format(&quot;hive&quot;).saveAsTable(hivetable)</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      changecolnums match &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="keyword">true</span> =&gt;  &#123;</span><br><span class="line">          <span class="keyword">if</span> (hivepartition != <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(sparkSession.<span class="keyword">table</span>(hivetable).<span class="keyword">columns</span>.length != spark.<span class="keyword">columns</span>.length)&#123;</span><br><span class="line">             sparkSession.<span class="keyword">sql</span>(</span><br><span class="line">               s&quot;&quot;&quot;</span><br><span class="line">                 |drop table $&#123;hivetable&#125;</span><br><span class="line">                 |&quot;&quot;&quot;.stripMargin)</span><br><span class="line">            &#125;</span><br><span class="line">            spark.<span class="keyword">write</span>.partitionBy(hivepartition.split(&quot;,&quot;):_*).<span class="keyword">option</span>(&quot;fileFormat&quot;,fileformat).<span class="keyword">option</span>(&quot;compression&quot;,codec).mode(mode).format(&quot;hive&quot;).saveAsTable(hivetable)</span><br><span class="line">          &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            spark.<span class="keyword">write</span>.<span class="keyword">option</span>(&quot;fileFormat&quot;,fileformat).<span class="keyword">option</span>(&quot;compression&quot;,codec).mode(mode).format(&quot;hive&quot;).saveAsTable(hivetable)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="keyword">false</span> =&gt; spark.<span class="keyword">write</span>.<span class="keyword">option</span>(&quot;fileFormat&quot;,fileformat).<span class="keyword">option</span>(&quot;compression&quot;,codec).mode(mode).format(&quot;hive&quot;).insertInto(hivetable)</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      spark.<span class="keyword">show</span>()</span><br><span class="line">      println(spark.count())</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>sql</p><figure class="highlight roboconf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line">def insertmake(sparkSession: SparkSession,dataFrame: DataFrame,tablename:String,otheroptions:String*) =&#123;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">var strings</span>:Array[String] = null</span><br><span class="line"></span><br><span class="line">      dataFrame<span class="variable">.selectExpr</span>(sparkSession<span class="variable">.table</span>(tablename)<span class="variable">.columns</span>:_*)<span class="variable">.createOrReplaceTempView</span>(&quot;tmp&quot;)</span><br><span class="line"></span><br><span class="line">   // val partitionstring = sparkSession<span class="variable">.table</span>(tablename)<span class="variable">.columns</span><span class="variable">.tail</span>(sparkSession<span class="variable">.table</span>(tablename)<span class="variable">.columns</span><span class="variable">.length</span> - 2)</span><br><span class="line">    otheroptions<span class="variable">.length</span> match &#123;</span><br><span class="line">      case 0 =&gt; &#123;</span><br><span class="line">        sparkSession<span class="variable">.sql</span>(</span><br><span class="line">          s&quot;&quot;&quot;</span><br><span class="line">             |insert overwrite $&#123;tablename&#125;</span><br><span class="line">             |select * from tmp</span><br><span class="line">             |&quot;&quot;&quot;<span class="variable">.stripMargin</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      case _ =&gt; &#123;</span><br><span class="line"></span><br><span class="line">        if (otheroptions<span class="variable">.length</span> &gt; 1)&#123;</span><br><span class="line">          strings = otheroptions(1)<span class="variable">.split</span>(&quot;,&quot;)<span class="variable">.filter</span>(conclunms =&gt; &#123;</span><br><span class="line">            !dataFrame<span class="variable">.columns</span><span class="variable">.contains</span>(conclunms)</span><br><span class="line">          &#125;)</span><br><span class="line">          val fuzhiarray:Array[String] = util<span class="variable">.Arrays</span><span class="variable">.copyOfRange</span>(otheroptions<span class="variable">.toArray</span>, 2, otheroptions<span class="variable">.length</span>)</span><br><span class="line">          fuzhiarray<span class="variable">.foreach</span>(println(_))</span><br><span class="line">          strings<span class="variable">.isEmpty</span> match &#123;</span><br><span class="line">            case true =&gt; &#123;</span><br><span class="line"></span><br><span class="line">          sparkSession<span class="variable">.sql</span>(</span><br><span class="line">          s&quot;&quot;&quot;</span><br><span class="line">            |insert overwrite $&#123;tablename&#125; partition($&#123;otheroptions(1)<span class="variable">.split</span>(&quot;,&quot;)<span class="variable">.map</span>(conclunms =&gt; &#123;s&quot;$&#123;conclunms&#125;&quot;&#125;)<span class="variable">.mkString</span>(&quot;,&quot;)&#125;)</span><br><span class="line">            |select * from tmp</span><br><span class="line">            |&quot;&quot;&quot;<span class="variable">.stripMargin</span>)</span><br><span class="line">          &#125;</span><br><span class="line">            case false =&gt; &#123;</span><br><span class="line">              var tmpdf:DataFrame = dataFrame</span><br><span class="line">              for (i &lt;- 0 to strings<span class="variable">.length-</span>1)&#123;</span><br><span class="line">                tmpdf = tmpdf<span class="variable">.withColumn</span>(strings(i),lit(fuzhiarray(i)))</span><br><span class="line">              &#125;</span><br><span class="line">              tmpdf<span class="variable">.show</span>()</span><br><span class="line">              tmpdf<span class="variable">.printSchema</span>()</span><br><span class="line">              tmpdf = tmpdf<span class="variable">.selectExpr</span>(sparkSession<span class="variable">.table</span>(tablename)<span class="variable">.columns</span>: _*)</span><br><span class="line">              tmpdf<span class="variable">.show</span>()</span><br><span class="line">              tmpdf<span class="variable">.printSchema</span>()</span><br><span class="line">              val str = tmpdf<span class="variable">.columns</span><span class="variable">.mkString</span>(&quot;,\n&quot;)</span><br><span class="line">              tmpdf<span class="variable">.createOrReplaceTempView</span>(&quot;smp&quot;)</span><br><span class="line">              sparkSession<span class="variable">.sql</span>(</span><br><span class="line">                s&quot;&quot;&quot;</span><br><span class="line">                   |insert overwrite $&#123;tablename&#125; partition($&#123;otheroptions(1)<span class="variable">.split</span>(&quot;,&quot;)<span class="variable">.map</span>(conclunms =&gt; &#123;s&quot;$&#123;conclunms&#125;&quot;&#125;)<span class="variable">.mkString</span>(&quot;,&quot;)&#125;)</span><br><span class="line">                   |select $&#123;str&#125; from smp</span><br><span class="line">                   |&quot;&quot;&quot;<span class="variable">.stripMargin</span>)</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#125;else&#123;</span><br><span class="line">          strings = otheroptions(0)<span class="variable">.split</span>(&quot;,&quot;)<span class="variable">.filter</span>(conclunms =&gt; &#123;</span><br><span class="line">            !dataFrame<span class="variable">.columns</span><span class="variable">.contains</span>(conclunms)</span><br><span class="line">          &#125;)</span><br><span class="line">          val fuzhiarray:Array[String] = util<span class="variable">.Arrays</span><span class="variable">.copyOfRange</span>(otheroptions<span class="variable">.toArray</span>, 1, otheroptions<span class="variable">.length</span>)</span><br><span class="line"></span><br><span class="line">          strings<span class="variable">.isEmpty</span> match &#123;</span><br><span class="line">            case true =&gt; &#123;</span><br><span class="line">              sparkSession<span class="variable">.sql</span>(</span><br><span class="line">                s&quot;&quot;&quot;</span><br><span class="line">                   |insert overwrite $&#123;tablename&#125; partition($&#123;otheroptions(0)<span class="variable">.split</span>(&quot;,&quot;)<span class="variable">.map</span>(conclunms =&gt; &#123;s&quot;$&#123;conclunms&#125;&quot;&#125;)<span class="variable">.mkString</span>(&quot;,&quot;)&#125;)</span><br><span class="line">                   |select * from tmp</span><br><span class="line">                   |&quot;&quot;&quot;<span class="variable">.stripMargin</span>)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            case false =&gt; &#123;</span><br><span class="line">              var tmpdf:DataFrame = dataFrame</span><br><span class="line"></span><br><span class="line">              for (i &lt;- 0 to strings<span class="variable">.length-</span>1)&#123;</span><br><span class="line">                tmpdf = tmpdf<span class="variable">.withColumn</span>(strings(i),lit(fuzhiarray(i)))</span><br><span class="line">              &#125;</span><br><span class="line">              tmpdf<span class="variable">.show</span>()</span><br><span class="line">              tmpdf<span class="variable">.printSchema</span>()</span><br><span class="line">              tmpdf = tmpdf<span class="variable">.selectExpr</span>(sparkSession<span class="variable">.table</span>(tablename)<span class="variable">.columns</span>: _*)</span><br><span class="line">              val str = tmpdf<span class="variable">.columns</span><span class="variable">.mkString</span>(&quot;,\n&quot;)</span><br><span class="line">              tmpdf<span class="variable">.createOrReplaceTempView</span>(&quot;smp&quot;)</span><br><span class="line">              sparkSession<span class="variable">.sql</span>(</span><br><span class="line">                s&quot;&quot;&quot;</span><br><span class="line">                   |insert overwrite $&#123;tablename&#125; partition($&#123;otheroptions(0)<span class="variable">.split</span>(&quot;,&quot;)<span class="variable">.map</span>(conclunms =&gt; &#123;s&quot;$&#123;conclunms&#125;&quot;&#125;)<span class="variable">.mkString</span>(&quot;,&quot;)&#125;)</span><br><span class="line">                   |select $&#123;str&#125; from smp</span><br><span class="line">                   |&quot;&quot;&quot;<span class="variable">.stripMargin</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h3 id="sink到jdbc"><a href="#sink到jdbc" class="headerlink" title="sink到jdbc"></a>sink到jdbc</h3><p>api</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">def savetojdbc(spark: SparkSession,df: DataFrame, url:String,<span class="keyword">user</span>:String,<span class="keyword">password</span>:String,dbtable:String,driver:String,mideng:String,mode:String)=&#123;</span><br><span class="line">    val map = Map(&quot;url&quot; -&gt; url,</span><br><span class="line">      &quot;user&quot; -&gt; <span class="keyword">user</span>,</span><br><span class="line">      &quot;password&quot; -&gt; <span class="keyword">password</span>,</span><br><span class="line">      &quot;dbtable&quot; -&gt; dbtable,</span><br><span class="line">      &quot;driver&quot;-&gt; driver)</span><br><span class="line"></span><br><span class="line">//    df.<span class="keyword">write</span>.mode(string(<span class="number">2</span>)).format(string(<span class="number">1</span>)).<span class="keyword">options</span>(map).save()</span><br><span class="line">    // <span class="comment">-------------------------------------幂等性</span></span><br><span class="line">    val <span class="keyword">connection</span> = jdbcconnect.getconncet(driver,url,<span class="keyword">user</span>,<span class="keyword">password</span>)</span><br><span class="line">    try&#123;</span><br><span class="line">      val <span class="type">bool</span> = <span class="keyword">connection</span>.createStatement().executeQuery(s&quot;show tables like &#x27;$&#123;dbtable&#125;&#x27;&quot;).next()</span><br><span class="line">      <span class="keyword">if</span> (!<span class="type">bool</span>)&#123;</span><br><span class="line">        throw <span class="built_in">new</span> NullPointerException(s&quot;写入的结果表$&#123;dbtable&#125; 尚未创建！！！&quot;)</span><br><span class="line">      &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        var flag:<span class="keyword">Any</span> = <span class="keyword">null</span></span><br><span class="line">        val flagbool = mysqldf.getmyqsldffromMap(spark, map).<span class="keyword">select</span>(mideng).isEmpty</span><br><span class="line">        <span class="keyword">if</span> (!flagbool)&#123;</span><br><span class="line">         flag = mysqldf.getmyqsldffromMap(spark, map).<span class="keyword">select</span>(mideng).tail(<span class="number">1</span>)(<span class="number">0</span>)(<span class="number">0</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        val tmpresult = df.<span class="keyword">select</span>(mideng).<span class="keyword">filter</span>(<span class="type">line</span> =&gt; &#123;</span><br><span class="line">          <span class="type">line</span>.getString(<span class="number">0</span>) != flag</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (df.isEmpty)&#123;</span><br><span class="line">          println(&quot;数据集为空&quot;)</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">          <span class="keyword">if</span> (tmpresult.isEmpty)&#123;</span><br><span class="line">            println(&quot;你的数据已经插入过&quot;)</span><br><span class="line">            df.<span class="keyword">show</span>(<span class="keyword">false</span>)</span><br><span class="line">          &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">//            df.<span class="keyword">show</span>()</span><br><span class="line">//            println(df.count())</span><br><span class="line">            //val insertresult = tmpresult.<span class="keyword">join</span>(df, string(<span class="number">5</span>))</span><br><span class="line">            tmpresult.<span class="keyword">show</span>()</span><br><span class="line">            println(tmpresult.count())</span><br><span class="line">//            insertresult.<span class="keyword">show</span>()</span><br><span class="line">//            println(insertresult.count())</span><br><span class="line">            tmpresult.<span class="keyword">write</span>.mode(mode).format(&quot;jdbc&quot;).<span class="keyword">options</span>(map).save()</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;finally &#123;</span><br><span class="line">      <span class="keyword">connection</span>.<span class="keyword">close</span>()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content:encoded>
      
      
      <category domain="http://zihang.fun/categories/%E6%97%A5%E5%BF%97/">日志</category>
      
      
      <category domain="http://zihang.fun/tags/%E5%90%8C%E6%AD%A5%E5%B7%A5%E5%85%B7/">同步工具</category>
      
      
      <comments>http://zihang.fun/2023/02/02/2-2/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>project</title>
      <link>http://zihang.fun/2023/02/01/project/</link>
      <guid>http://zihang.fun/2023/02/01/project/</guid>
      <pubDate>Wed, 01 Feb 2023 08:40:23 GMT</pubDate>
      
        
        
      <description>&lt;h1 id=&quot;jdbctohive&quot;&gt;&lt;a href=&quot;#jdbctohive&quot; class=&quot;headerlink&quot; title=&quot;jdbctohive&quot;&gt;&lt;/a&gt;jdbctohive&lt;/h1&gt;&lt;figure class=&quot;highlight awk&quot;&gt;&lt;table&gt;&lt;tr&gt;</description>
        
      
      
      
      <content:encoded><![CDATA[<h1 id="jdbctohive"><a href="#jdbctohive" class="headerlink" title="jdbctohive"></a>jdbctohive</h1><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br></pre></td><td class="code"><pre><span class="line">package project</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">import java.util</span><br><span class="line"></span><br><span class="line">import org.apache.spark.sql.catalog.Catalog</span><br><span class="line">import org.apache.spark.sql.&#123;DataFrame, Dataset, Row, SparkSession&#125;</span><br><span class="line">import tool.sqlUtils</span><br><span class="line">import tool.getmysqldf</span><br><span class="line">import tool.savefile</span><br><span class="line">import tool.readfile</span><br><span class="line">object jdbctohive &#123;</span><br><span class="line">  System.setProperty(<span class="string">&quot;HADOOP_USER_NAME&quot;</span>,<span class="string">&quot;hadoop&quot;</span>)</span><br><span class="line">  val spark = SparkSession.builder().appName(<span class="string">&quot;sqoop&quot;</span>).master(<span class="string">&quot;local[4]&quot;</span>).enableHiveSupport().getOrCreate()</span><br><span class="line">  spark.sparkContext.setCheckpointDir(<span class="string">&quot;/tmp/checkpoint&quot;</span>)</span><br><span class="line"></span><br><span class="line">  val getmysqldf = new readfile</span><br><span class="line">  val sqlUtils = new sqlUtils</span><br><span class="line">  val saveFile = new savefile</span><br><span class="line">  private val catalog: Catalog = spark.catalog</span><br><span class="line">  var changecolunm = false</span><br><span class="line">  import spark.implicits._</span><br><span class="line">  import org.apache.spark.sql.functions._</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  def main(args: Array[String]): Unit = &#123;</span><br><span class="line">    <span class="keyword">if</span> (args.length==<span class="number">0</span>)&#123;</span><br><span class="line">      println(</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">          |欢迎使用本程序</span></span><br><span class="line"><span class="string">          |参数详情 mysql hive</span></span><br><span class="line"><span class="string">          |-------------------------mysql</span></span><br><span class="line"><span class="string">          |url 例子 ： jdbc:mysql://bigdata2:3306/try</span></span><br><span class="line"><span class="string">          |user 例子 ： root</span></span><br><span class="line"><span class="string">          |password 例子 ： liuzihan010616</span></span><br><span class="line"><span class="string">          |tablename =&gt; 支持谓词下压  例子 ： emp 或者 select * from emp 等</span></span><br><span class="line"><span class="string">          |driver =&gt; com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="string">          |---------------------------hive</span></span><br><span class="line"><span class="string">          |mode模式 overwrite append 等</span></span><br><span class="line"><span class="string">          |hive中的table 例子 bigdata.emp</span></span><br><span class="line"><span class="string">          |可选参数 分区字段 自动开启的是动态分区 例子 deptno</span></span><br><span class="line"><span class="string">          |&quot;&quot;&quot;</span>.stripMargin)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    val url = args(<span class="number">0</span>)</span><br><span class="line">    val user = args(<span class="number">1</span>)</span><br><span class="line">    val password = args(<span class="number">2</span>)</span><br><span class="line">    val table = args(<span class="number">3</span>)</span><br><span class="line">    val driver = args(<span class="number">4</span>)</span><br><span class="line">    <span class="regexp">//</span> 获取jdbc的df</span><br><span class="line">    val mysqlconnect = getmysqldf.getmysqldataframe(spark, url, user, password, table , driver)</span><br><span class="line">    <span class="regexp">//</span> 验证指示</span><br><span class="line">    mysqlconnect.show()</span><br><span class="line">    <span class="regexp">//</span> 生成hive参数数组</span><br><span class="line">    var hiveconf = new Array[String](args.length-<span class="number">5</span>)</span><br><span class="line">    hiveconf = util.Arrays.copyOfRange(args, <span class="number">5</span>, args.length)</span><br><span class="line">    <span class="regexp">//</span>hiveconf.foreach(println(_))</span><br><span class="line">    jdbctohive(args,catalog,mysqlconnect,hiveconf)</span><br><span class="line">    spark.stop()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  def changecolnums(args:Array[String],hiveconf:Array[String],resourcesql:DataFrame) =&#123;</span><br><span class="line">    var finallyresult:Dataset[Row] = null <span class="regexp">//</span> 最终结果集</span><br><span class="line">    var frame:DataFrame = null <span class="regexp">//</span> 中间变量</span><br><span class="line">    var hiveconclumns = spark.table(args(<span class="number">6</span>)).columns <span class="regexp">//</span> hive的列数</span><br><span class="line">    hiveconclumns.foreach(println((_))) <span class="regexp">//</span> 验证hive的列数</span><br><span class="line">    var mysqlconnect:DataFrame = resourcesql <span class="regexp">//</span> 设置数据源的resource</span><br><span class="line"></span><br><span class="line">    <span class="regexp">//</span> 判断分区字段在不在jdbc的数据里，如果不在，则在jdbc的数据源中先添加上分区字段</span><br><span class="line">    <span class="keyword">if</span> (args.length &gt; <span class="number">7</span>)&#123;</span><br><span class="line">      <span class="keyword">if</span> (!resourcesql.columns.contains(args(<span class="number">7</span>)))&#123;</span><br><span class="line">        mysqlconnect = resourcesql.withColumn(args(<span class="number">7</span>),lit(args(<span class="number">8</span>)))</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    val jdbcconclumns = mysqlconnect.columns <span class="regexp">//</span> jdbc的列数</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    var jdbcoldsource:Dataset[Row] = null <span class="regexp">//</span> 源数据库的数据 checkpoint是为了破坏数据均衡，以后能编写变读取</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (args.length == <span class="number">10</span>)&#123;</span><br><span class="line">      jdbcoldsource = spark.sql(</span><br><span class="line">        s<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">          |select * from $&#123;hiveconf(1)&#125; where $&#123;hiveconf(2)&#125; != $&#123;hiveconf(3)&#125;</span></span><br><span class="line"><span class="string">          |&quot;&quot;&quot;</span>.stripMargin).checkpoint()</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      jdbcoldsource =  spark.sql(</span><br><span class="line">        s<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">           |select * from $&#123;hiveconf(1)&#125;</span></span><br><span class="line"><span class="string">           |&quot;&quot;&quot;</span>.stripMargin).checkpoint()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    var existcolunms: Array[String] = null  <span class="regexp">//</span> 设置hive或者mysql的额外列</span><br><span class="line">    var resultdf: DataFrame = jdbcoldsource <span class="regexp">//</span> 获取hive的数据原始数据</span><br><span class="line"></span><br><span class="line">    <span class="regexp">//</span> 判断是hive的列多，还是数据源的列数多</span><br><span class="line">    <span class="keyword">if</span> (hiveconclumns.length &gt;= jdbcconclumns.length)&#123;</span><br><span class="line">      <span class="regexp">//</span> 判断额外列的存在</span><br><span class="line">      existcolunms= hiveconclumns.filter(hivecol =&gt; &#123;</span><br><span class="line">        val bool = jdbcconclumns.map(jdbccol =&gt; &#123;</span><br><span class="line">          jdbccol == hivecol</span><br><span class="line">        &#125;).contains(true)</span><br><span class="line">        !bool</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="regexp">//</span> 判断两个列数是不是相等</span><br><span class="line">        <span class="keyword">if</span> (existcolunms.isEmpty) &#123;</span><br><span class="line">          frame = mysqlconnect.selectExpr(hiveconclumns: _*)</span><br><span class="line">          frame</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="regexp">//</span> 列数不相等的时候让列数少的加列</span><br><span class="line">        resultdf = mysqlconnect</span><br><span class="line">        <span class="keyword">for</span> (elem &lt;- existcolunms)&#123;</span><br><span class="line">          resultdf = resultdf.withColumn(elem, lit(null))</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="regexp">//</span> 对字段进行排序 ， 让分区数据的分区字段在最后一列</span><br><span class="line">        frame = resultdf.selectExpr(hiveconclumns: _*)</span><br><span class="line">        <span class="regexp">//</span> 验证数据</span><br><span class="line">        frame.show()</span><br><span class="line">        <span class="regexp">//</span> 整合历史数据</span><br><span class="line">        finallyresult = jdbcoldsource.union(frame)</span><br><span class="line">        <span class="regexp">//</span> 验证数据</span><br><span class="line">        finallyresult.show()</span><br><span class="line">        changecolunm = true</span><br><span class="line">        finallyresult</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      <span class="regexp">//</span> 数据的列多</span><br><span class="line">      existcolunms= jdbcconclumns.filter(jdbccol =&gt; &#123;</span><br><span class="line">        val bool = hiveconclumns.map(hivecol =&gt; &#123;</span><br><span class="line">          jdbccol == hivecol</span><br><span class="line">        &#125;).contains(true)</span><br><span class="line">        !bool</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (existcolunms.isEmpty) &#123;</span><br><span class="line">        frame = mysqlconnect.selectExpr(hiveconclumns: _*)</span><br><span class="line">        frame</span><br><span class="line">      &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (elem &lt;- existcolunms)&#123;</span><br><span class="line">          resultdf = resultdf.withColumn(elem, lit(null))</span><br><span class="line">        &#125;</span><br><span class="line">        frame = resultdf.selectExpr(jdbcconclumns: _*)</span><br><span class="line">        finallyresult = resultdf.union(mysqlconnect)</span><br><span class="line">        changecolunm = true</span><br><span class="line">        finallyresult</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  def jdbctohive(args:Array[String],catalog: Catalog,mysqlconnect: DataFrame, hiveconf: Array[String])=&#123;</span><br><span class="line">    <span class="regexp">//</span> 分割字符串获取hive的 表和数据库</span><br><span class="line">    val strings = hiveconf(<span class="number">1</span>).split(<span class="string">&quot;\\.&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="regexp">//</span> catalog的方法 获取表存不存在的方法</span><br><span class="line"><span class="regexp">//</span>    catalog.listTables(strings(<span class="number">0</span>)).show()</span><br><span class="line"><span class="regexp">//</span>    val empty = catalog.listTables(strings(<span class="number">0</span>)).filter(x =&gt; &#123;</span><br><span class="line"><span class="regexp">//</span>      x.name == strings(<span class="number">1</span>)</span><br><span class="line"><span class="regexp">//</span>    &#125;).isEmpty</span><br><span class="line">    val empty = catalog.tableExists(strings(<span class="number">0</span>),strings(<span class="number">1</span>))</span><br><span class="line"><span class="regexp">//</span>-----------------------------------------------------------------------------</span><br><span class="line"><span class="regexp">//</span>    sql的方法</span><br><span class="line"><span class="regexp">//</span>    val empty1 = spark.sql(</span><br><span class="line"><span class="regexp">//</span>      <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">//        |show tables in hivedb</span></span><br><span class="line"><span class="string">//        |&quot;&quot;&quot;</span>.stripMargin).filter(<span class="string">&quot;tableName = &#x27;hivetablename&#x27;&quot;</span>).isEmpty</span><br><span class="line"><span class="regexp">//</span> --------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="regexp">//</span> 判断列数是不是相等</span><br><span class="line">    var frameresult:DataFrame = null</span><br><span class="line">    <span class="regexp">//</span> 先判断表存不存在 ，因为判断列数的方法要求表存在</span><br><span class="line">      empty match &#123;</span><br><span class="line">          <span class="regexp">//</span> 表不存在</span><br><span class="line">      case false =&gt; &#123;</span><br><span class="line">        <span class="regexp">//</span> 判断输入的变量个数执行 判断分区表还是普通表</span><br><span class="line">        <span class="keyword">if</span> (args.length &gt; <span class="number">7</span>) &#123;</span><br><span class="line">          println(<span class="string">&quot;-----------------分区表&quot;</span>)</span><br><span class="line">          <span class="regexp">//</span> 判断分区的参数在不在列中 如果不在 ，则加上 ，在的话就自动往下走</span><br><span class="line">          <span class="keyword">if</span> (!mysqlconnect.columns.contains(args(<span class="number">7</span>)))&#123;</span><br><span class="line">            frameresult = mysqlconnect.withColumn(args(<span class="number">7</span>),lit(args(<span class="number">8</span>)))</span><br><span class="line">            frameresult.show()</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">          println(<span class="string">&quot;-----------普通表&quot;</span>)</span><br><span class="line">          frameresult = mysqlconnect</span><br><span class="line">          mysqlconnect.show()</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      case true =&gt; &#123;</span><br><span class="line">        <span class="regexp">//</span> 表存在</span><br><span class="line">        <span class="regexp">//</span> 判断是不是分区表</span><br><span class="line">        frameresult = changecolnums(args, hiveconf, mysqlconnect)</span><br><span class="line"><span class="regexp">//</span>        <span class="keyword">if</span> (args.length &gt; <span class="number">7</span>) &#123;</span><br><span class="line"><span class="regexp">//</span>          println(<span class="string">&quot;-----------------分区表&quot;</span>)</span><br><span class="line"><span class="regexp">//</span>          <span class="keyword">if</span> (!mysqlconnect.columns.contains(args(<span class="number">7</span>)))&#123;</span><br><span class="line"><span class="regexp">//</span>            frameresult = changecolnums(args, hiveconf, mysqlconnect)</span><br><span class="line"><span class="regexp">//</span>          &#125;</span><br><span class="line"><span class="regexp">//</span>        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="regexp">//</span>          println(<span class="string">&quot;-----------普通表&quot;</span>)</span><br><span class="line"><span class="regexp">//</span>          frameresult = mysqlconnect</span><br><span class="line"><span class="regexp">//</span>        &#125;</span><br><span class="line">        frameresult.show()&#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    spark.conf.set(<span class="string">&quot;hive.exec.dynamic.partition.mode&quot;</span>,<span class="string">&quot;nonstrict&quot;</span>)</span><br><span class="line">    spark.conf.set(<span class="string">&quot;hive.exec.dynamic.partition&quot;</span>,<span class="string">&quot;true&quot;</span>)</span><br><span class="line">    spark.conf.set(<span class="string">&quot;spark.sql.parquet.writeLegacyFormat&quot;</span>, <span class="string">&quot;true&quot;</span>)</span><br><span class="line">    println(empty)</span><br><span class="line">    hiveconf.foreach(println(_))</span><br><span class="line">    saveFile.savetohiveapi(empty,frameresult,hiveconf,changecolunm)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="hivetojdbcs"><a href="#hivetojdbcs" class="headerlink" title="hivetojdbcs"></a>hivetojdbcs</h1><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">package project</span><br><span class="line"></span><br><span class="line">import java.util</span><br><span class="line"></span><br><span class="line">import org.apache.spark.sql.SparkSession</span><br><span class="line">import org.apache.spark.sql.catalog.Catalog</span><br><span class="line">import project.jdbctohive.spark</span><br><span class="line">import tool.&#123;getmysqldf, savefile, sqlUtils,<span class="built_in">readfile</span>&#125;</span><br><span class="line"></span><br><span class="line">object hivetojdbc &#123;</span><br><span class="line">  val spark = SparkSession.builder().appName(<span class="string">&quot;sqoop&quot;</span>).master(<span class="string">&quot;local[4]&quot;</span>).enableHiveSupport().getOrCreate()</span><br><span class="line">  val getmysqldf = <span class="keyword">new</span> <span class="built_in">readfile</span></span><br><span class="line">  val sqlUtils = <span class="keyword">new</span> sqlUtils</span><br><span class="line">  val saveFile = <span class="keyword">new</span> savefile</span><br><span class="line">  private val catalog: Catalog = spark.catalog</span><br><span class="line"></span><br><span class="line">  def main(<span class="keyword">args</span>: Array[String]): Unit = &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">args</span>.length==<span class="number">0</span>)&#123;</span><br><span class="line">      println(</span><br><span class="line">        <span class="string">&quot;&quot;</span><span class="comment">&quot;</span></span><br><span class="line">          |欢迎使用本程序</span><br><span class="line">          |参数说明</span><br><span class="line">          |总体参数种类 hive mysql</span><br><span class="line">          |---------------------------hive</span><br><span class="line">          |hive中要选择的字段 例子 ： <span class="string">&quot;sal,big  / *  &quot;</span></span><br><span class="line">          |hive的table的名字 例子 ： bigdata_hive3.emp</span><br><span class="line">          |hive中的 条件可以为空 例子 ： where <span class="keyword">sal</span> &gt; <span class="string">&#x27;300&#x27;</span></span><br><span class="line">          |---------------------------mysql</span><br><span class="line">          |savemode overwrite <span class="keyword">append</span> 等</span><br><span class="line">          |url 例子 ： jdbc:mysql://bigdata2:<span class="number">3306</span>/<span class="keyword">try</span></span><br><span class="line">          |user 例子 ： root</span><br><span class="line">          |password 例子 ： liuzihan010616</span><br><span class="line">          |dbtable 例子 ： emp</span><br><span class="line">          |幂等性的列 ： 例子 ： <span class="keyword">sal</span></span><br><span class="line">          |驱动名称 ： 例子 <span class="keyword">com</span>.mysql.jdbc.Driver</span><br><span class="line">          |<span class="string">&quot;&quot;</span><span class="comment">&quot;.stripMargin)</span></span><br><span class="line">    &#125;</span><br><span class="line">    val frame = sqlUtils.checksql(spark, sqlUtils.hivesqlchoose(<span class="keyword">args</span>))</span><br><span class="line"></span><br><span class="line">      var mysqlconf = <span class="keyword">new</span> Array[String](<span class="keyword">args</span>.length-<span class="number">3</span>)</span><br><span class="line">      mysqlconf = util.Arrays.copyOfRange(<span class="keyword">args</span>, <span class="number">2</span>, <span class="keyword">args</span>.length)</span><br><span class="line">      saveFile.savetojdbc(spark,frame,mysqlconf)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content:encoded>
      
      
      <category domain="http://zihang.fun/categories/%E6%97%A5%E5%BF%97/">日志</category>
      
      
      <category domain="http://zihang.fun/tags/project/">project</category>
      
      
      <comments>http://zihang.fun/2023/02/01/project/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>flink</title>
      <link>http://zihang.fun/2023/01/25/1-25/</link>
      <guid>http://zihang.fun/2023/01/25/1-25/</guid>
      <pubDate>Wed, 25 Jan 2023 07:29:00 GMT</pubDate>
      
        
        
      <description>&lt;h1 id=&quot;flink&quot;&gt;&lt;a href=&quot;#flink&quot; class=&quot;headerlink&quot; title=&quot;flink&quot;&gt;&lt;/a&gt;flink&lt;/h1&gt;&lt;h2 id=&quot;简介&quot;&gt;&lt;a href=&quot;#简介&quot; class=&quot;headerlink&quot; title=&quot;简介&quot;&gt;&lt;/a&gt;简</description>
        
      
      
      
      <content:encoded><![CDATA[<h1 id="flink"><a href="#flink" class="headerlink" title="flink"></a>flink</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>从14年到15年1月就正式开始</p><p>flink本身是德语词，代表快速灵巧</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Apache Flink <span class="keyword">is</span> a framework <span class="keyword">and</span> distributed processing engine <span class="keyword">for</span> stateful computations <span class="keyword">over</span> <span class="keyword">unbounded</span> <span class="keyword">and</span> bounded data streams. Flink has been designed <span class="keyword">to</span> run <span class="keyword">in</span> <span class="keyword">all</span> common <span class="keyword">cluster</span> environments, <span class="keyword">perform</span> computations at <span class="keyword">in</span>-memory speed <span class="keyword">and</span> at <span class="keyword">any</span> scale.</span><br><span class="line"></span><br><span class="line">Here, we <span class="keyword">explain</span> important aspects <span class="keyword">of</span> Flink’s architecture.</span><br></pre></td></tr></table></figure><h2 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h2><p>边界流：<strong>Bounded streams ： 有明确的开始以及结束的流 也为人所知是批处理（batch processing）</strong></p><p>无边界流：<strong>Unbounded streams :有开始无结束的边界流</strong></p><h2 id="flink特点"><a href="#flink特点" class="headerlink" title="flink特点"></a>flink特点</h2><p>flink处理的数据类型也在从边界流逐渐转向无边界流 :一起是边界流 现在是无边界流</p><p>flink是个分布式系统</p><p>flink针对本地访问进行了优化-&gt; 任务的状态始终保存在内存中如果追昂太大小超过可用内存，那么则会把他存储在能高效访问的磁盘数据结构中-&gt;任务通过访问本地（通常在内存中）状态来进行所有的计算，从而产生非常低的处理延迟。Flink 通过定期和异步地对本地状态进行持久化存储来保证故障场景下精确一次的状态一致性。</p><h2 id="flink应用"><a href="#flink应用" class="headerlink" title="flink应用"></a>flink应用</h2><h3 id="数据"><a href="#数据" class="headerlink" title="数据"></a>数据</h3><ul><li>有界</li><li>无界</li><li>实时</li><li>离线</li></ul><h3 id="状态"><a href="#状态" class="headerlink" title="状态"></a>状态</h3><p>只有在每一个单独的事件上进行转换操作的应用才不需要状态，换言之，每一个具有一定复杂度的流处理应用都是有状态的。</p><p>Flink 提供了许多状态管理相关的特性支持，其中包括：</p><ul><li><strong>多种状态基础类型</strong> ： 例如 value ，map ，list</li><li><strong>插件化的State Backend</strong> ： State Backend 负责管理应用程序状态，并在需要的时候进行 checkpoint。Flink 支持多种 state backend，可以将状态存在内存或者 <a href="https://rocksdb.org/">RocksDB</a>。RocksDB 是一种高效的嵌入式、持久化键值存储引擎。Flink 也支持插件式的自定义 state backend 进行状态存储。</li><li><strong>精确一次语义</strong> ： 就是kafka里的精准一次 -&gt; 说明flink支持事务</li><li><strong>超大数据量状态</strong> ： Flink 能够利用其异步以及增量式的 checkpoint 算法，存储数 TB 级别的应用状态。</li><li><strong>可弹性伸缩的应用</strong> ： Flink 能够通过在更多或更少的工作节点上对状态进行重新分布，支持有状态应用的分布式的横向伸缩。</li></ul><h3 id="时间"><a href="#时间" class="headerlink" title="时间"></a>时间</h3><p>时间是流处理应用另一个重要的组成部分。因为事件总是在特定时间点发生，所以大多数的事件流都拥有事件本身所固有的时间语义。进一步而言，许多常见的流计算都基于时间语义，例如窗口聚合、会话计算、模式检测和基于时间的 join。流处理的一个重要方面是应用程序如何衡量时间，即区分事件时间（event-time）和处理时间（processing-time）。</p><ul><li><strong>事件时间模式</strong> ： 使用事件时间语义的流处理应用根据事件本身自带的时间戳进行结果的计算。因此，无论处理的是历史记录的事件还是实时的事件，事件时间模式的处理总能保证结果的准确性和一致性。</li><li><strong>Watermark 支持</strong> ： Flink 引入了 watermark 的概念，用以衡量事件时间进展。Watermark 也是一种平衡处理延时和完整性的灵活机制。</li><li><strong>迟到数据处理</strong> ：当以带有 watermark 的事件时间模式处理数据流时，在计算完成之后仍会有相关数据到达。这样的事件被称为迟到事件。Flink 提供了多种处理迟到数据的选项，例如将这些数据重定向到旁路输出（side output）或者更新之前完成计算的结果</li><li><strong>处理时间模式</strong> ：除了事件时间模式，Flink 还支持处理时间语义。处理时间模式根据处理引擎的机器时钟触发计算，一般适用于有着严格的低延迟需求，并且能够容忍近似结果的流处理应用。</li></ul><h2 id="分层APi"><a href="#分层APi" class="headerlink" title="分层APi"></a>分层APi</h2><p>Flink 根据抽象程度分层，提供了三种不同的 API。每一种 API 在简洁性和表达力上有着不同的侧重，并且针对不同的应用场景。</p><p>如下 ：</p><p><img src="https://pic.imgdb.cn/item/63d7aea6face21e9ef369bfb.jpg"></p><h3 id="ProcessFunction"><a href="#ProcessFunction" class="headerlink" title="ProcessFunction"></a>ProcessFunction</h3><p><a href="https://nightlies.apache.org/flink/flink-docs-stable/dev/stream/operators/process_function.html">ProcessFunction</a> 是 Flink 所提供的最具表达力的接口。ProcessFunction 可以处理一或两条输入数据流中的单个事件或者归入一个特定窗口内的多个事件。它提供了对于时间和状态的细粒度控制。开发者可以在其中任意地修改状态，也能够注册定时器用以在未来的某一时刻触发回调函数。因此，你可以利用 ProcessFunction 实现许多<a href="https://flink.apache.org/zh/usecases.html#eventDrivenApps">有状态的事件驱动应用</a>所需要的基于单个事件的复杂业务逻辑。</p><p>相当于计时器的用处，下处是官方的例子：</p><p>官方的例子是设置开始，并登记一个4小时的的计时器，当提前返回end，则是提前结束并返回时间，当到4小时则清空状态并结束</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> * 将相邻的 keyed START 和 END 事件相匹配并计算两者的时间间隔</span></span><br><span class="line"><span class="comment"> * 输入数据为 Tuple2&lt;String, String&gt; 类型，第一个字段为 key 值， </span></span><br><span class="line"><span class="comment"> * 第二个字段标记 START 和 END 事件。</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">static</span> <span class="keyword">class</span> <span class="title class_">StartEndDuration</span></span><br><span class="line">    extends KeyedProcessFunction&lt;<span class="type">String</span>, Tuple2&lt;<span class="type">String</span>, <span class="type">String</span>&gt;, Tuple2&lt;<span class="type">String</span>, Long&gt;&gt; &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> ValueState&lt;Long&gt; startTime;</span><br><span class="line"></span><br><span class="line">  @<span class="function">Override</span></span><br><span class="line"><span class="function">  <span class="keyword">public</span> <span class="type">void</span> <span class="title">open</span><span class="params">(Configuration conf)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// obtain state handle</span></span><br><span class="line">    startTime = <span class="built_in">getRuntimeContext</span>()</span><br><span class="line">      .<span class="built_in">getState</span>(<span class="keyword">new</span> <span class="built_in">ValueStateDescriptor</span>&lt;Long&gt;(<span class="string">&quot;startTime&quot;</span>, Long.<span class="keyword">class</span>));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** Called for each processed event. */</span></span><br><span class="line">  @<span class="function">Override</span></span><br><span class="line"><span class="function">  <span class="keyword">public</span> <span class="type">void</span> <span class="title">processElement</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">      Tuple2&lt;<span class="type">String</span>, <span class="type">String</span>&gt; in,</span></span></span><br><span class="line"><span class="params"><span class="function">      Context ctx,</span></span></span><br><span class="line"><span class="params"><span class="function">      Collector&lt;Tuple2&lt;<span class="type">String</span>, Long&gt;&gt; out)</span> throws Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">switch</span> (in.f1) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&quot;START&quot;</span>:</span><br><span class="line">        <span class="comment">// set the start time if we receive a start event.</span></span><br><span class="line">        startTime.<span class="built_in">update</span>(ctx.<span class="built_in">timestamp</span>());</span><br><span class="line">        <span class="comment">// register a timer in four hours from the start event.</span></span><br><span class="line">        ctx.<span class="built_in">timerService</span>()</span><br><span class="line">          .<span class="built_in">registerEventTimeTimer</span>(ctx.<span class="built_in">timestamp</span>() + <span class="number">4</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">1000</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&quot;END&quot;</span>:</span><br><span class="line">        <span class="comment">// emit the duration between start and end event</span></span><br><span class="line">        Long sTime = startTime.<span class="built_in">value</span>();</span><br><span class="line">        <span class="keyword">if</span> (sTime != null) &#123;</span><br><span class="line">          out.<span class="built_in">collect</span>(Tuple2.<span class="built_in">of</span>(in.f0, ctx.<span class="built_in">timestamp</span>() - sTime));</span><br><span class="line">          <span class="comment">// clear the state</span></span><br><span class="line">          startTime.<span class="built_in">clear</span>();</span><br><span class="line">        &#125;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="comment">// do nothing</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** Called when a timer fires. */</span></span><br><span class="line">  @<span class="function">Override</span></span><br><span class="line"><span class="function">  <span class="keyword">public</span> <span class="type">void</span> <span class="title">onTimer</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">      <span class="type">long</span> timestamp,</span></span></span><br><span class="line"><span class="params"><span class="function">      OnTimerContext ctx,</span></span></span><br><span class="line"><span class="params"><span class="function">      Collector&lt;Tuple2&lt;<span class="type">String</span>, Long&gt;&gt; out)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Timeout interval exceeded. Cleaning up the state.</span></span><br><span class="line">    startTime.<span class="built_in">clear</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="DataStream-API"><a href="#DataStream-API" class="headerlink" title="DataStream API"></a>DataStream API</h3><p><a href="https://nightlies.apache.org/flink/flink-docs-stable/dev/datastream_api.html">DataStream API</a> 为许多通用的流处理操作提供了处理原语。这些操作包括窗口、逐条记录的转换操作，在处理事件时进行外部数据库查询等。DataStream API 支持 Java 和 Scala 语言，预先定义了例如 <code>map()</code>、<code>reduce()</code>、<code>aggregate()</code> 等函数。你可以通过扩展实现预定义接口或使用 Java、Scala 的 lambda 表达式实现自定义的函数。</p><p>下面的代码示例展示了如何捕获会话时间范围内所有的点击流事件，并对每一次会话的点击量进行计数。</p><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 网站点击 Click 的数据流</span></span><br><span class="line">DataStream&lt;Click&gt; clicks = <span class="params">...</span></span><br><span class="line"></span><br><span class="line">DataStream&lt;Tuple2&lt;<span class="built_in">String</span>, Long&gt;&gt; result = clicks</span><br><span class="line">  <span class="comment">// 将网站点击映射为 (userId, 1) 以便计数</span></span><br><span class="line">  .<span class="built_in">map</span>(</span><br><span class="line">    <span class="comment">// 实现 MapFunction 接口定义函数</span></span><br><span class="line">    <span class="literal">new</span> MapFunction&lt;Click, Tuple2&lt;<span class="built_in">String</span>, Long&gt;&gt;() &#123;</span><br><span class="line">      @Override</span><br><span class="line">      <span class="keyword">public</span> Tuple2&lt;<span class="built_in">String</span>, Long&gt; <span class="built_in">map</span>(Click click) &#123;</span><br><span class="line">        <span class="keyword">return</span> Tuple2.of(click.userId, <span class="number">1</span>L);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  <span class="comment">// 以 userId (field 0) 作为 key</span></span><br><span class="line">  .keyBy(<span class="number">0</span>)</span><br><span class="line">  <span class="comment">// 定义 30 分钟超时的会话窗口</span></span><br><span class="line">  .window(EventTimeSessionWindows.withGap(Time.minutes(<span class="number">30</span>L)))</span><br><span class="line">  <span class="comment">// 对每个会话窗口的点击进行计数，使用 lambda 表达式定义 reduce 函数</span></span><br><span class="line">  .reduce((a, b) -&gt; Tuple2.of(a.f0, a.f1 + b.f1));</span><br></pre></td></tr></table></figure><h3 id="SQL-amp-Table-API"><a href="#SQL-amp-Table-API" class="headerlink" title="SQL &amp; Table API"></a>SQL &amp; Table API</h3><p>Flink 支持两种关系型的 API，<a href="https://nightlies.apache.org/flink/flink-docs-stable/dev/table/index.html">Table API 和 SQL</a>。这两个 API 都是批处理和流处理统一的 API，这意味着在无边界的实时数据流和有边界的历史记录数据流上，关系型 API 会以相同的语义执行查询，并产生相同的结果。Table API 和 SQL 借助了 <a href="https://calcite.apache.org/">Apache Calcite</a> 来进行查询的解析，校验以及优化。它们可以与 DataStream 和 DataSet API 无缝集成，并支持用户自定义的标量函数，聚合函数以及表值函数。</p><p>Flink 的关系型 API 旨在简化<a href="https://flink.apache.org/zh/usecases.html#analytics">数据分析</a>、<a href="https://flink.apache.org/zh/usecases.html#pipelines">数据流水线和 ETL 应用</a>的定义。</p><p>下面的代码示例展示了如何使用 SQL 语句查询捕获会话时间范围内所有的点击流事件，并对每一次会话的点击量进行计数。此示例与上述 DataStream API 中的示例有着相同的逻辑。</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> userId, COUNT(*)</span><br><span class="line"><span class="keyword">FROM</span> clicks</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">SESSION</span>(clicktime, <span class="type">INTERVAL</span> <span class="string">&#x27;30&#x27;</span> MINUTE), userId</span><br></pre></td></tr></table></figure><h2 id="库"><a href="#库" class="headerlink" title="库"></a>库</h2><p>Flink 具有数个适用于常见数据处理应用场景的扩展库。这些库通常嵌入在 API 中，且并不完全独立于其它 API。它们也因此可以受益于 API 的所有特性，并与其他库集成。</p><ul><li><strong><a href="https://nightlies.apache.org/flink/flink-docs-stable/dev/libs/cep.html">复杂事件处理(CEP)</a></strong> ：模式检测是事件流处理中的一个非常常见的用例。Flink 的 CEP 库提供了 API，使用户能够以例如正则表达式或状态机的方式指定事件模式。CEP 库与 Flink 的 DataStream API 集成，以便在 DataStream 上评估模式。CEP 库的应用包括网络入侵检测，业务流程监控和欺诈检测。</li><li><strong><a href="https://nightlies.apache.org/flink/flink-docs-stable/dev/batch/index.html">DataSet API</a></strong> ：DataSet API 是 Flink 用于批处理应用程序的核心 API。DataSet API 所提供的基础算子包括 <em>map</em> 、 <em>reduce</em> 、 <em>(outer) join</em> 、 <em>co-group</em> 、<em>iterate</em>等。所有算子都有相应的算法和数据结构支持，对内存中的序列化数据进行操作。如果数据大小超过预留内存，则过量数据将存储到磁盘。Flink 的 DataSet API 的数据处理算法借鉴了传统数据库算法的实现，例如混合散列连接（hybrid hash-join）和外部归并排序（external merge-sort）。</li><li><strong><a href="https://nightlies.apache.org/flink/flink-docs-stable/dev/libs/gelly/index.html">Gelly</a></strong> : Gelly 是一个可扩展的图形处理和分析库。Gelly 是在 DataSet API 之上实现的，并与 DataSet API 集成。因此，它能够受益于其可扩展且健壮的操作符。Gelly 提供了<a href="https://nightlies.apache.org/flink/flink-docs-stable/dev/libs/gelly/library_methods.html">内置算法</a>，如 label propagation、triangle enumeration 和 page rank 算法，也提供了一个简化自定义图算法实现的 <a href="https://nightlies.apache.org/flink/flink-docs-stable/dev/libs/gelly/graph_api.html">Graph API</a>。</li></ul><h2 id="flink运维"><a href="#flink运维" class="headerlink" title="flink运维"></a>flink运维</h2><p>Flink通过几下多种机制维护应用可持续运行及其一致性:</p><ul><li><strong>检查点的一致性</strong> : Flink的故障恢复机制是通过建立分布式应用服务状态一致性检查点实现的，当有故障产生时，应用服务会重启后，再重新加载上一次成功备份的状态检查点信息。结合可重放的数据源，该特性可保证 <em>精确一次（exactly-once）</em> 的状态一致性。</li><li><strong>高效的检查点</strong> : 如果一个应用要维护一个TB级的状态信息，对此应用的状态建立检查点服务的资源开销是很高的，为了减小因检查点服务对应用的延迟性（SLAs服务等级协议）的影响，Flink采用异步及增量的方式构建检查点服务。</li><li><strong>端到端的精确一次</strong> : Flink 为某些特定的存储支持了事务型输出的功能，及时在发生故障的情况下，也能够保证精确一次的输出。</li><li><strong>集成多种集群管理服务</strong> : Flink已与多种集群管理服务紧密集成，如 <a href="https://hadoop.apache.org/">Hadoop YARN</a>, <a href="https://mesos.apache.org/">Mesos</a>, 以及 <a href="https://kubernetes.io/">Kubernetes</a>。当集群中某个流程任务失败后，一个新的流程服务会自动启动并替代它继续执行。</li><li><strong>内置高可用服务</strong> : Flink内置了为解决单点故障问题的高可用性服务模块，此模块是基于<a href="https://zookeeper.apache.org/">Apache ZooKeeper</a> 技术实现的，<a href="https://zookeeper.apache.org/">Apache ZooKeeper</a>是一种可靠的、交互式的、分布式协调服务组件。</li></ul><h2 id="Flink能够更方便地升级、迁移、暂停、恢复应用服务"><a href="#Flink能够更方便地升级、迁移、暂停、恢复应用服务" class="headerlink" title="Flink能够更方便地升级、迁移、暂停、恢复应用服务"></a>Flink能够更方便地升级、迁移、暂停、恢复应用服务</h2><p>而Flink的 <em>Savepoint</em> 服务就是为解决升级服务过程中记录流应用状态信息及其相关难题而产生的一种唯一的、强大的组件。一个 Savepoint，就是一个应用服务状态的一致性快照，因此其与checkpoint组件的很相似，但是与checkpoint相比，Savepoint 需要手动触发启动，而且当流应用服务停止时，它并不会自动删除。Savepoint 常被应用于启动一个已含有状态的流服务，并初始化其（备份时）状态。Savepoint 有以下特点：</p><ul><li><strong>便于升级应用服务版本</strong> : Savepoint 常在应用版本升级时使用，当前应用的新版本更新升级时，可以根据上一个版本程序记录的 Savepoint 内的服务状态信息来重启服务。它也可能会使用更早的 Savepoint 还原点来重启服务，以便于修复由于有缺陷的程序版本导致的不正确的程序运行结果。</li><li><strong>方便集群服务移植</strong> : 通过使用 Savepoint，流服务应用可以自由的在不同集群中迁移部署。</li><li><strong>方便Flink版本升级</strong> : 通过使用 Savepoint，可以使应用服务在升级Flink时，更加安全便捷。</li><li><strong>增加应用并行服务的扩展性</strong> : Savepoint 也常在增加或减少应用服务集群的并行度时使用。</li><li><strong>便于A&#x2F;B测试及假设分析场景对比结果</strong> : 通过把同一应用在使用不同版本的应用程序，基于同一个 Savepoint 还原点启动服务时，可以测试对比2个或多个版本程序的性能及服务质量。</li><li><strong>暂停和恢复服务</strong> : 一个应用服务可以在新建一个 Savepoint 后再停止服务，以便于后面任何时间点再根据这个实时刷新的 Savepoint 还原点进行恢复服务。</li><li><strong>归档服务</strong> : Savepoint 还提供还原点的归档服务，以便于用户能够指定时间点的 Savepoint 的服务数据进行重置应用服务的状态，进行恢复服务。</li></ul><h2 id="监控和控制应用服务"><a href="#监控和控制应用服务" class="headerlink" title="监控和控制应用服务"></a>监控和控制应用服务</h2><p>如其它应用服务一样，持续运行的流应用服务也需要监控及集成到一些基础设施资源管理服务中，例如一个组件的监控服务及日志服务等。监控服务有助于预测问题并提前做出反应，日志服务提供日志记录能够帮助追踪、调查、分析故障发生的根本原因。最后，便捷易用的访问控制应用服务运行的接口也是Flink的一个重要的亮点特征。</p><p>Flink与许多常见的日志记录和监视服务集成得很好，并提供了一个REST API来控制应用服务和查询应用信息。具体表现如下：</p><ul><li><strong>Web UI方式</strong> : Flink提供了一个web UI来观察、监视和调试正在运行的应用服务。并且还可以执行或取消组件或任务的执行。</li><li><strong>日志集成服务</strong> :Flink实现了流行的slf4j日志接口，并与日志框架<a href="https://logging.apache.org/log4j/2.x/">log4j</a>或<a href="https://logback.qos.ch/">logback</a>集成。</li><li><strong>指标服务</strong> : Flink提供了一个复杂的度量系统来收集和报告系统和用户定义的度量指标信息。度量信息可以导出到多个报表组件服务，包括 <a href="https://en.wikipedia.org/wiki/Java_Management_Extensions">JMX</a>, Ganglia, <a href="https://graphiteapp.org/">Graphite</a>, <a href="https://prometheus.io/">Prometheus</a>, <a href="https://github.com/etsy/statsd">StatsD</a>, <a href="https://www.datadoghq.com/">Datadog</a>, 和 <a href="https://www.slf4j.org/">Slf4j</a>.</li><li><strong>标准的WEB REST API接口服务</strong> : Flink提供多种REST API接口，有提交新应用程序、获取正在运行的应用程序的Savepoint服务信息、取消应用服务等接口。REST API还提供元数据信息和已采集的运行中或完成后的应用服务的指标信息。</li></ul><h2 id="flink优点"><a href="#flink优点" class="headerlink" title="flink优点"></a>flink优点</h2><p>处理流式数据</p><p>事件驱动</p><p>低延迟</p><p>高吞吐</p><p>准确性，以及容错性</p><p>支持精准一次</p><p>应用：</p><p>数据源 -&gt; etl -&gt; 数仓 -&gt; flink -&gt; 报表业务等</p><h2 id="flink解析"><a href="#flink解析" class="headerlink" title="flink解析"></a>flink解析</h2><p>state ： 存储在内存中的数据 ，内存的数据响应快 ，但是不稳定</p><p>checkpoint ： 备份checkpoint ，当机器出现故障的时候可以恢复数据 -&gt; 会周期行进行保存</p><p>对于数据的准确性：以lambad为例</p><p>通过两个系统（lambad系统,sparkStreaming）</p><ul><li>流式处理 -&gt; 实现快速</li><li>批处理 -&gt; 保证顺序</li></ul><p>先把数据通过流式处理进行数据处理，然后设定一定时间或者一定的数据量，当达到一定时间的时候或者数据量达到一定程度，再进行往下通过批处理发送，保证结果的顺序</p><p>衍生出flink</p><p>storm第一代</p><p>lambda第二代</p><p>flink第三代 -&gt; 集成上面所有的</p><h3 id="数据模型"><a href="#数据模型" class="headerlink" title="数据模型"></a>数据模型</h3><p>sparkStreaming：</p><p> 采用RDD 实际上就是一组小数据的集合RDD</p><p>flink：</p><p>基本就是数据流 ，以event序列</p><h3 id="运行时架构"><a href="#运行时架构" class="headerlink" title="运行时架构"></a>运行时架构</h3><p>spark是批计算，将DAG划分为不同的stage，一个完成才开始下一个</p><p>flink是标准的流执行，一个事件再一个节点处理完后可以直接发送到下一个节点</p><h3 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h3><p>jobmanager ：针对整个job的 &#x3D;》 driver &#x3D;》 会在启动的机器上  &#x3D;》 其会和taskmanager进行通信，默认通信端口是 6123</p><p>rpc.address : 启动的机器，在配置文件里设置的</p><p>rpc.port : 通信端口</p><p>heap.size : 堆的内存 jvm中</p><p>process.size : taskmanager 的占用的内存，包括jvm以及堆外内存 默认开启</p><p>flink.size : task占用的内存，包括一些状态什么的 process.size 包含flink.size</p><p>numberTaskSlots: 一个任务在几个Solt上执行</p><p>parallelism：并行度 这个参数和上面的不一样，这个是运行的时候来的，上一个是直接给你分，不是在运行的时候的</p><p>taskmanager ： 针对job下的一个task的 &#x3D;》 worker</p><h2 id="搭建flink项目"><a href="#搭建flink项目" class="headerlink" title="搭建flink项目"></a>搭建flink项目</h2><p>在idea里</p><p>pom</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">   <span class="section">&lt;dependency&gt;</span></span><br><span class="line">  <span class="section">&lt;groupId&gt;</span><span class="attribute">org</span>.apache.flink&lt;/groupId&gt;</span><br><span class="line">  <span class="section">&lt;artifactId&gt;</span><span class="attribute">flink</span>-scala_2.<span class="number">12</span>&lt;/artifactId&gt;</span><br><span class="line">  <span class="section">&lt;version&gt;</span><span class="attribute">1</span>.<span class="number">13</span>.<span class="number">6</span>&lt;/version&gt;</span><br><span class="line"><span class="section">&lt;/dependency&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="section">&lt;dependency&gt;</span></span><br><span class="line">  <span class="section">&lt;groupId&gt;</span><span class="attribute">org</span>.apache.flink&lt;/groupId&gt;</span><br><span class="line">  <span class="section">&lt;artifactId&gt;</span><span class="attribute">flink</span>-streaming-scala_2.<span class="number">12</span>&lt;/artifactId&gt;</span><br><span class="line">  <span class="section">&lt;version&gt;</span><span class="attribute">1</span>.<span class="number">13</span>.<span class="number">6</span>&lt;/version&gt;</span><br><span class="line"><span class="section">&lt;/dependency&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>代码：</p><figure class="highlight roboconf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">package flinklearn</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.scala.ExecutionEnvironment</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">object frist &#123;</span><br><span class="line">  <span class="attribute">def apply()</span>: frist = new frist()</span><br><span class="line">  def main(args: Array[String]): Unit = &#123;</span><br><span class="line">   // frist()<span class="variable">.piwc</span>()</span><br><span class="line">    frist()<span class="variable">.Streamwc</span>()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class frist() &#123;</span><br><span class="line"></span><br><span class="line">  //创建批处理执行环境类比sparksession</span><br><span class="line">  val pienvironment =org<span class="variable">.apache</span><span class="variable">.flink</span><span class="variable">.api</span><span class="variable">.scala</span><span class="variable">.ExecutionEnvironment</span><span class="variable">.getExecutionEnvironment</span></span><br><span class="line">  val streamingenv= org<span class="variable">.apache</span><span class="variable">.flink</span><span class="variable">.streaming</span><span class="variable">.api</span><span class="variable">.scala</span><span class="variable">.StreamExecutionEnvironment</span><span class="variable">.getExecutionEnvironment</span></span><br><span class="line"></span><br><span class="line">  // 批处理wc</span><br><span class="line">  def piwc()=&#123;</span><br><span class="line"></span><br><span class="line">    import org<span class="variable">.apache</span><span class="variable">.flink</span><span class="variable">.api</span><span class="variable">.scala</span><span class="variable">._</span></span><br><span class="line">    // 从文件中取数据</span><br><span class="line">    val path = &quot;F:\\bigdatajava\\src\\main\\resources\\wc<span class="variable">.data</span>&quot;</span><br><span class="line">    val value = pienvironment<span class="variable">.readTextFile</span>(path)</span><br><span class="line"></span><br><span class="line">    // 对数据进行转换处理</span><br><span class="line">    val resultds:DataSet[(String,Int)] = value<span class="variable">.flatMap</span>(_<span class="variable">.split</span>(&quot;,&quot;))<span class="variable">.map</span>((_,1))<span class="variable">.groupBy</span>(0)<span class="variable">.sum</span>(1)</span><br><span class="line">    resultds<span class="variable">.print</span>()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  // 流处理wc</span><br><span class="line">  def Streamwc() = &#123;</span><br><span class="line"></span><br><span class="line">    import org<span class="variable">.apache</span><span class="variable">.flink</span><span class="variable">.streaming</span><span class="variable">.api</span><span class="variable">.scala</span><span class="variable">._</span></span><br><span class="line"></span><br><span class="line">    // 设置并行度 -&gt; 界面的数字就是并行度，10&gt; (flume,2) 前面的数字就是哪一个任务的id -&gt; 是根据hash值进行分的 -&gt; 默认是电脑的最大配置</span><br><span class="line">    // 下面是全局设置</span><br><span class="line">    // 还可按照每个算子后面设置</span><br><span class="line">    // 因为每个算子都算一个单独的任务</span><br><span class="line">    // val value1 = value<span class="variable">.flatMap</span>(_<span class="variable">.split</span>(&quot;,&quot;))<span class="variable">.filter</span>(_<span class="variable">.nonEmpty</span>)<span class="variable">.setParallelism</span>(3)<span class="variable">.map</span>((_, 1))<span class="variable">.keyBy</span>(0)<span class="variable">.sum</span>(1)<span class="variable">.setParallelism</span>(1)</span><br><span class="line">    streamingenv<span class="variable">.setParallelism</span>(1)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    // 接受一个socket文本流</span><br><span class="line">    val value = streamingenv<span class="variable">.socketTextStream</span>(&quot;bigdata3&quot;,8888)</span><br><span class="line"></span><br><span class="line">    val value1 = value<span class="variable">.flatMap</span>(_<span class="variable">.split</span>(&quot;,&quot;))<span class="variable">.filter</span>(_<span class="variable">.nonEmpty</span>)<span class="variable">.map</span>((_, 1))<span class="variable">.keyBy</span>(0)<span class="variable">.sum</span>(1)</span><br><span class="line"></span><br><span class="line">    value1<span class="variable">.print</span>()<span class="variable">.setParallelism</span>(1)</span><br><span class="line"></span><br><span class="line">    // 启动任务执行</span><br><span class="line">    streamingenv<span class="variable">.execute</span>(&quot;first&quot;)</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="部署flink并运行"><a href="#部署flink并运行" class="headerlink" title="部署flink并运行"></a>部署flink并运行</h2><p>先下载flink的包，我用的scala是2.12的所以下的是flink_scala_2.12的</p><p>根据自己的版本选择</p><p>地址：<a href="https://archive.apache.org/dist/flink">flink</a></p><p>下载完成上传到服务器</p><p>然后解压 -&gt; 设置环境变量 -&gt; 进入到flink的conf文件夹，编辑 flink-conf.yaml 文件 把参数 <code>jobmanager.rpc.address:</code>设置成主节点，然后按照需求是不是开启高可用，以及设置检查点的文件夹（如果文件夹放在hdfs上，则flink要两个依赖包，flink自己没有的分别是 <code>flink-shaded-hadoop-3-uber-3.1.1.7.2.9.0-173-9.0.jar</code>以及 <code>commons-cli-1.5.0.jar</code>）可以区<a href="https://mvnrepository.com/">maven官网</a>下载，然后放到flink&#x2F;lib下，这两个jar包要按照自己hadoop的版本进行下载</p><p>-&gt;然后再编辑workers -&gt; 添加上子节点的名字 -&gt; 分发到各个机器上</p><p>然后再主节点启动start-cluster.sh</p><p>就成功了 访问 <code>主节点:8081</code></p><p>就可以访问flink的web页面</p><p>编写启动脚本如下：</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">case $<span class="number">1</span> in </span><br><span class="line"><span class="string">&quot;start&quot;</span>)</span><br><span class="line">ssh <span class="keyword">bigdata5 </span><span class="string">&quot;/home/hadoop/app/flink/bin/start-cluster.sh&quot;</span></span><br><span class="line"><span class="comment">;;</span></span><br><span class="line"><span class="string">&quot;stop&quot;</span>)</span><br><span class="line">ssh <span class="keyword">bigdata5 </span><span class="string">&quot;/home/hadoop/app/flink/bin/stop-cluster.sh&quot;</span></span><br><span class="line"><span class="comment">;;</span></span><br><span class="line"><span class="string">&quot;status&quot;</span>)</span><br><span class="line">echo <span class="string">&quot;web ui : bigdata5:8081&quot;</span></span><br><span class="line"><span class="keyword">jps| </span>grep TaskManagerRunner</span><br><span class="line">ssh <span class="keyword">bigdata4 </span><span class="string">&quot;jps| grep TaskManagerRunner&quot;</span></span><br><span class="line">ssh <span class="keyword">bigdata5 </span><span class="string">&quot;jps| grep StandaloneSessionClusterEntrypoint&quot;</span></span><br><span class="line"><span class="comment">;;</span></span><br><span class="line">*)</span><br><span class="line">echo <span class="string">&quot;error input you should use by start|stop|status&quot;</span></span><br><span class="line"><span class="comment">;;</span></span><br><span class="line">esac</span><br></pre></td></tr></table></figure><p>把上述scala代码打包成jar包</p><h3 id="web"><a href="#web" class="headerlink" title="web"></a>web</h3><p>上传到服务器的web界面如下</p><p><img src="https://pic.imgdb.cn/item/63ddd0414757feff338bbb5c.jpg" alt="img">然后设置运行主类，以及并行度，参数，checkpoint点就好</p><p>如果上述没有放置两个jar包，则是无法执行再hdfs上设置checkpoint文件夹的</p><p>上述的代码执行之后输出在哪里呢？</p><p>他会输出在task manager里，至于具体在哪个里，应该点击输出任务</p><p>如下：</p><p><img src="https://pic.imgdb.cn/item/63ddd2334757feff338eaa2e.jpg" alt="img"></p><p>然后在web界面上点击task-manager -&gt; 点击相应机器 -&gt; 点击Stdout 就会看见控制台信息了</p><p>这就是web部署成功了</p><p>然后停止如下：</p><p><img src="https://pic.imgdb.cn/item/63ddd30c4757feff338fe87d.jpg"></p><h3 id="命令行"><a href="#命令行" class="headerlink" title="命令行"></a>命令行</h3><p>执行：<code>flink run -m bigdata5:8081 -c flinklearn.frist -p 2 ./bigdatajava-1.0-SNAPSHOT.jar</code></p><p>就可以了，参数以及checkpoint可以加载后面，如果不设置，就走默认的</p><p>因为对于sockt文本流他的并行度就是1，所以外面无法改变</p><p>如下：</p><p><img src="https://pic.imgdb.cn/item/63ddd5304757feff339342a7.jpg"></p><p>经过ctrl + c 或者其他操作之后，这个作业并不会停掉</p><p>通过 <code>flink list 9723a168e896e048b777473cb871e10a</code>后面的是job的id，其实知识为了更精准一下，这个参数是可选的</p><p>还可以接-a 代表查看所有的</p><p>通过 <code>flink cancel jobid</code>就可以对只定的jobid进行停止</p><p>如下 ：<br><img src="https://pic.imgdb.cn/item/63ddd64f4757feff3394d986.jpg"></p><h2 id="部署模式"><a href="#部署模式" class="headerlink" title="部署模式"></a>部署模式</h2><p>flink为我们的不同场景设置了不同的模式</p><ul><li>会话模式</li><li>单作业模式</li><li>应用模式</li></ul><h3 id="会话"><a href="#会话" class="headerlink" title="会话"></a>会话</h3><p>先启动集群，然后其他的进行提交作业，就是我们上述的模式</p><p>优点：相当于集群先启动，索要的资源已经固定好了，集群的生命周期高于任何的job，不和job的结束而改变</p><p>缺点：资源不够的时候会出问题</p><p>和另外的资源管理平台结合用</p><h3 id="单作业"><a href="#单作业" class="headerlink" title="单作业"></a>单作业</h3><p>每个作业都启动一个flink集群，就不会出现上述资源不够的问题</p><p>就是按照把资源按照作业来划分</p><p>相当于container</p><p>一般的时候是首选的，但是flink本身是没有办法用单作业的</p><p>他要借助别人的容器化的管理机制-&gt; yarn&#x2F; k8s</p><h3 id="应用模式"><a href="#应用模式" class="headerlink" title="应用模式"></a>应用模式</h3><p>上述两种是都先在客户端进行执行的，然后再发送给jobmanager，但是会占用网络带宽，</p><p>而且对于单作业模式的情况很可能会在客户端拆分成好几个作业，任何根据他每个作业就启动一个集群的说法，会造成大量的资源浪费</p><p>然后我们直接把作业发送到jobmanager上直接由他做处理，就是应用模式</p><p>和单作业很像</p><p>单作业是作业和集群一对一</p><p>应用是应用和集群一对一</p><h2 id="独立模式"><a href="#独立模式" class="headerlink" title="独立模式"></a>独立模式</h2><p>不依赖任何外部资源管理平台</p><p>最基本，也是最简单的</p><p>在实际项目中使用会比较少</p><p>因为对资源的管理有要求</p><p>再独立模式的时候，没有单作业的，因为必须要外部平台</p><p>应用模式 -&gt; 可以 但是使用少</p><p>首先把要运行的jar包放在flink的lib文件夹下</p><p>然后执行 <code>standalone-job.sh start --job-classname flinklearn.frist</code>因为flink会骂人扫描lib包下的所有的jar包所以这里指定入口就好</p><p>然后 执行 <code>taskmanager.sh start</code></p><p>停掉集群：</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">standlone-job.<span class="keyword">sh</span> <span class="keyword">stop</span></span><br><span class="line"></span><br><span class="line">taskmanager.<span class="keyword">sh</span> <span class="keyword">stop</span></span><br></pre></td></tr></table></figure><h2 id="yarn模式"><a href="#yarn模式" class="headerlink" title="yarn模式"></a>yarn模式</h2><p>客户端先把flink的一个应用提交到yarn上</p><p>yarn他的resourcemanager会向nodemanager申请容器 ?</p><p>在这些容器上flink会部署他的作业flink会根据作业所要的sloat的数量进行动态分配taskmanager的资源</p><p>hadoop至少是2.2及其以上</p><p>flink在1.8之前hadoop的版本和正常的版本是分开的，就是人家给了你两套</p><p>但是1.8-1.11我们要下载的仅仅只是hadoop的插件</p><p>但是1.11之后就更不用下载hadoop的插件了，我们主要就进行环境变量的配置就好了</p><p>要配置</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> <span class="attribute">HADOOP_HOME</span>=/home/hadoop/app/hadoop</span><br><span class="line"><span class="built_in">export</span> <span class="attribute">HADOOP_CONF_DIR</span>=<span class="variable">$&#123;HADOOP_HOME&#125;</span>/etc/hadoop</span><br><span class="line"><span class="built_in">export</span> <span class="attribute">HADOOP_CLASSPATH</span>=`hadoop classpath`</span><br><span class="line"><span class="built_in">export</span> <span class="attribute">PATH</span>=<span class="variable">$&#123;HADOOP_HOME&#125;</span>/bin:$&#123;HADOOP_HOME&#125;/sbin:<span class="variable">$PATH</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>就好</p><p>然后要创建一个Yarnsession</p><p>在flink的主节点下用 <code>yarn-session.sh -nm name</code>就能关联上yarn</p><p>如下</p><p><img src="https://pic.imgdb.cn/item/63dde0144757feff33a46f1b.jpg"></p><p>但是仅仅这样启动的集群他的web界面查看后发现插槽是0，如下</p><p><img src="https://pic.imgdb.cn/item/63dde0a24757feff33a54533.jpg"></p><p>这是因为我们启动的是yarn的模式的应用模式</p><p>当我们关掉它的时候yarnsession就会关掉了，我们可以加如下参数对它进行控制</p><p>-d ： 分离模式 ，前台关掉，后面不会把yarnsession关掉</p><p>-jm ： 配置jobmanager索要的内存 默认单位 MB</p><p>-nm : 配置名字</p><p>-qu :  指定yarn的队列名字</p><p>-tm:  配置每个taskmanager的内存</p><p>注意：flink 从1.11之后就不再使用 -s和-n 指定插槽数量以及taskmanager的数量了，yarn会动态的进行分配的</p><p>然后用户还是可以通过web和命令行两种进行提交作业和上述standlone的时候是一样的</p><p>其实上述就是很简单的会话模式</p><h3 id="单作业-1"><a href="#单作业-1" class="headerlink" title="单作业"></a>单作业</h3><p>在yarn模式的时候由于有了外部资源管理平台，就可以进行单作业模式了</p><p>执行 <code>flink run -d -t yarn-per-job -c flinklearn.frist jar包的绝对路径</code></p><p>-d : 就是分离模式</p><p>-t ：是指定yarn模式的模式 <code>yarn-per-job</code> 就是单作业</p><p>-c ： 是class入口</p><p>后面还可以接参数等等</p><p>早期还有一种把 -t  pre-yarn-job 用 -m yarn-cluster 代替的写法</p><h3 id="应用模式-1"><a href="#应用模式-1" class="headerlink" title="应用模式"></a>应用模式</h3><p>和单作业模式很像，就是运行的参数不同</p><p><code>flink run-application -t yarn-application -c ....</code></p><p>查看作业</p><p><code>flink list -t yarn-application -Dyarn.application.id = ....</code></p><p>取消作业</p><p><code>flink cancel -t yarn-application -Dyarn.application.id = ....</code></p><p>还可以通过yarn.provided.lib.dirs配置选项指定位置 ，把jar上传到远程</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flink run-application -t yarn-application -Dyarn.provided.lib.dirs=<span class="string">&quot;hdfs://bigdata3:9000/tmp/flinktmp&quot;</span> hdfs:<span class="regexp">//</span>bigdata3:<span class="number">9000</span><span class="regexp">/tmp/</span>flinktmp</span><br></pre></td></tr></table></figure><p>上传到hdfs上运行</p><h2 id="flink运行时的架构"><a href="#flink运行时的架构" class="headerlink" title="flink运行时的架构"></a>flink运行时的架构</h2><h3 id="flink系统架构"><a href="#flink系统架构" class="headerlink" title="flink系统架构"></a>flink系统架构</h3><p>作业管理器（jobmanager）</p><p>是flink集群中的任务管理中心以及调度中心</p><p>最核心的组件，负责单独处理job</p><p>在作业提交的时候jobmaster会先接受到要执行的应用，一般是客户端提交的，包括：jar，数据流图，作业图</p><p>jobmaster会把jobGraph转换成一个物理层面的数据流图，这个图被叫做执行图（ExecutionGraph），它包含了所有可以并发的任务，jobMaster会向资源管理器（ResourceManager）发送请求，申请执行任务必要的资源，一旦它获取了足够的资源，就会将执行图分别发到他们真正运行的TaskManager上</p><p>在运行过程中jobmaster会负责监控指标以及调度，比如说检查点的协调</p><p>资源管理器（resourcemanager）</p><p>在一个flink集群里只有一个，负责分配资源，所谓资源其实主要是taskmanager的任务槽（slot），任务槽就是flink集群中的资源调度单位，包含机器用来计算的我cpu和内存资源，每一个任务都要分配到一个solt上，主要是内存分开</p><p>分发器（Dispatcher）</p><p>他主要是负责提供一个rest接口，用来提交应用的，并且为每一个新提交的作业启动一个新的jobMaster组件，Diapatcher也会启动一个web UI 用来方便和展示监控作业的信息，Diapatcher在架构中并不是必须的在不同的模式种可能会被忽略</p><p>任务管理器（taskmanager）</p><p>flink种的worker</p><p>每一个taskmanager包含了一定的solt</p><p>插槽的数量限制了并行度 ： 设置并行度的优先级 代码最高 其次是命令 其次是配置文件</p><p>启动之后taskmanager 会将一个或者多个插槽提供给jobmaster调用，jobmaster就可以向插槽分配任务来执行</p><p>执行过程中，一个taskManager可以和其他的与运行同一job的taskmanager来交互数据</p><p>一些执行流程图如下：<br><img src="https://pic.imgdb.cn/item/63ddf0284757feff33bd9e11.jpg"></p><p><img src="https://pic.imgdb.cn/item/63ddf0414757feff33bdc9a6.jpg"></p><p><img src="https://pic.imgdb.cn/item/63ddf0564757feff33bdead7.jpg"></p><p><img src="https://pic.imgdb.cn/item/63ddf06d4757feff33be0cab.jpg"></p><p><img src="https://pic.imgdb.cn/item/63ddf0944757feff33be4b31.jpg"></p><h2 id="flink的细节"><a href="#flink的细节" class="headerlink" title="flink的细节"></a>flink的细节</h2><h3 id="程序和数据流："><a href="#程序和数据流：" class="headerlink" title="程序和数据流："></a>程序和数据流：</h3><p>所有的flink程序都是要由三部分组成的 source transform sink</p><p>在运行flink项目的时候flink的程序会被映射成逻辑数据流（dataflow），它包含了三个部分 ，每一个dataflow都以一个或者多个source开始，以一个或者多个sink结束，其类似有向无环图（DAG）</p><p>大部分情况，程序中的转换操作（transform）和dataflow的算子（operation）是一一对应的关系</p><h3 id="并行度"><a href="#并行度" class="headerlink" title="并行度"></a>并行度</h3><p>每一个算子可以包含多个或者一个子任务 ，这些子任务在不同的线程，不同的物理机，不同的容器中是完全独立的</p><p>一个特定的算子的子任务的个数就被称为并行度</p><p>任务并行：就是相当于多个线程<br>数据并行：同一个算子可以茶城多分町是处理多份数据</p><p>例子：suorce的时候如何设置多并行?</p><p>它是把数据源进行复制，如何让每一个线程去处理不同数据最后再合到一起</p><h3 id="数据传输形式"><a href="#数据传输形式" class="headerlink" title="数据传输形式"></a>数据传输形式</h3><p>一个程序之间不同的算子可能有不同的并行度</p><p>算子之间的传输数据的形式可以是one-to-one也可以是redistributing的模式具体是什么取决于算子的种类</p><p>one-to-one:streaming维护着分区的顺序以及元素的顺序（比如source以及map之间）这意味着元素的个数顺序相同，map,filiter,flatMap,等算子，都是one-to-one的</p><p>Redistributing:指分区数量可能会发生改变，每一个算子，的子任务依据所选择的transform发送数据到不同的目标任务</p><p>例如：keyBy基于hashcode重新分区，而broadcast和rebalance会随即重新分区，这些算子都是引起redistributing的而这个过程就相当于spar中的shuffle</p><p>于是就诞生了算子链</p><p>flink使用一种称为任务链的优化技术，减少通信的开销，为了满足任务链的需求，将两个或者多个算子设为相同的并行度，通过本地转发（local forward）的放式进行链接</p><p>相同并行度的one-to-one操作，flink放在一起，链接形成一个task，并行度相同，并且是one-to-one操作，两个条件缺一不可</p><h3 id="执行图"><a href="#执行图" class="headerlink" title="执行图"></a>执行图</h3><p>flink中的执行图可以分为StreamingGraph -&gt; jobGraph -&gt; ExcutionGraph -&gt; 物理执行图</p><ul><li>StreamingGraph：是根据用户的api自动生成的最初的图用来表明程序的拓扑结构</li><li>jobGraph：上面一个经过优化，提交给jobmanager的数据结构，将多个符合条件的节点chain到一起作为一个节点</li><li>ExcutionGraph ： jobmanager 根据jobGraph生成的并行化版本，是调度曾的核心的数据结构</li><li>物理执行图：在各个taskmanager上的，就是告诉他们怎么做的，是部署到taskmanager上的，不是一个数据结构</li></ul><p>如下：</p><p><img src="https://pic.imgdb.cn/item/63ddfdf24757feff33d5175f.jpg"></p><p><img src="https://pic.imgdb.cn/item/63ddfe204757feff33d56469.jpg"></p><p><img src="https://pic.imgdb.cn/item/63ddfe3a4757feff33d59272.jpg"></p><h3 id="任务和任务槽"><a href="#任务和任务槽" class="headerlink" title="任务和任务槽"></a>任务和任务槽</h3><p>flink中每一个taskmanager就相当于是一个进程，他会在独立的线程上执行一个或者多个子任务</p><p>为了控制taskmanager能接收多少个task，Taskmanager通过task solt来进行控制 ，（一个taskmanager最少有一个slot）</p><p>slot最主要的作用就是隔离内存，因为cpu是没有办法真正隔离开的</p><p>flink里默认是允许子任务进行共享slot的，简单来说就是一个slot可以作为我们保存作业的整个管道</p><p>当我们将资源密集型和资源非密集型的任务放到一个slot中，他们就可以自行分配对资源占用的比例，从而保证最重的活平均分配给所有的taskmanager</p><p>slot和并行度</p><p>solt：静态概念：是指taskmanager具有的并发的执行的能力</p><p>通过参数taskmanager.numberOfTaskSlot进行配置</p><p>并行度：动态概念，就是真正所用到的并发能力</p><p>通过参数：parallelism.default进行设置</p><p>简单来说就是我可以拿起多沉的东西，但是我不用那么大的力气</p><h3 id="flink控制任务调度（代码）"><a href="#flink控制任务调度（代码）" class="headerlink" title="flink控制任务调度（代码）"></a>flink控制任务调度（代码）</h3><p>可以禁用算子链</p><p>通过 <code>xxx.disableChaining()</code></p><p>可以实现一个slot单独给一个算子用，同时也不能把他纳入任何一条算子链</p><p>还可以用 <code>xxx.startNewChain()</code></p><p>可以实现从xxx开始一个新的算子链，不管前面如何都要分开</p><p>还可以设置slot共享组</p><p>就是在一个共享组里的slot才可以共享slot</p><p>不在一个共享组里的slot他们必须分开</p><p>通过 <code>xxx.slotSharingGroup(String)</code>实现 代表后面的算子默认情况下就是在String所在的共享组</p><h1 id="DataStreamAPI"><a href="#DataStreamAPI" class="headerlink" title="DataStreamAPI"></a>DataStreamAPI</h1><p>对于以后的apiDatasetapi即将被弃用</p><p>所以我们用datasetapi</p><p>可以把DS堪称一种比较特殊的java集合类型</p><p>比如一个socket文本流底层就是DataStream</p><p>如果想调用DS的api要进行先创建环境</p><h2 id="创建环境"><a href="#创建环境" class="headerlink" title="创建环境"></a>创建环境</h2><h3 id="getExecutionEnvironment"><a href="#getExecutionEnvironment" class="headerlink" title="getExecutionEnvironment"></a>getExecutionEnvironment</h3><p>它是相当于把下面两种放在一起了，价格判断</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">val pienvironment =org<span class="selector-class">.apache</span><span class="selector-class">.flink</span><span class="selector-class">.api</span><span class="selector-class">.scala</span><span class="selector-class">.ExecutionEnvironment</span><span class="selector-class">.getExecutionEnvironment</span></span><br><span class="line">val streamingenv= org<span class="selector-class">.apache</span><span class="selector-class">.flink</span><span class="selector-class">.streaming</span><span class="selector-class">.api</span><span class="selector-class">.scala</span><span class="selector-class">.StreamExecutionEnvironment</span>.getExecutionEnvironment</span><br></pre></td></tr></table></figure><p>上述的getExecutionEnvironment方法是很智能的，它会自动识别我们是在本地调试还是在集群中调试，它会自动进行转换</p><h3 id="createLocalEnvironment"><a href="#createLocalEnvironment" class="headerlink" title="createLocalEnvironment"></a>createLocalEnvironment</h3><p>是创建一个本地的环境，在调用的时候可以传入一个参数指定默认的并行度，如果不传入默认就是当前电脑的cpu核心数量</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">private val environment: StreamExecutionEnvironment = org<span class="selector-class">.apache</span><span class="selector-class">.flink</span><span class="selector-class">.streaming</span><span class="selector-class">.api</span><span class="selector-class">.scala</span><span class="selector-class">.StreamExecutionEnvironment</span><span class="selector-class">.createLocalEnvironment</span>()</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="createRemoteEnvironment"><a href="#createRemoteEnvironment" class="headerlink" title="createRemoteEnvironment"></a>createRemoteEnvironment</h3><p>调用远程的执行环境</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">private val environment: StreamExecutionEnvironment = org<span class="selector-class">.apache</span><span class="selector-class">.flink</span><span class="selector-class">.streaming</span><span class="selector-class">.api</span><span class="selector-class">.scala</span><span class="selector-class">.StreamExecutionEnvironment</span><span class="selector-class">.createRemoteEnvironment</span>(<span class="string">&quot;bigdata5&quot;</span>,<span class="number">8081</span>,<span class="number">1</span>,<span class="string">&quot;jar包的路径&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>它底层是这样定义的</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">def <span class="title function_ invoke__">createRemoteEnvironment</span>(</span><br><span class="line">      <span class="attr">host</span>: String,</span><br><span class="line">      <span class="attr">port</span>: Int,</span><br><span class="line">      <span class="attr">parallelism</span>: Int,</span><br><span class="line">      <span class="attr">jarFiles</span>: String*): StreamExecutionEnvironment = &#123;</span><br><span class="line"></span><br><span class="line">    val javaEnv = JavaEnv.<span class="title function_ invoke__">createRemoteEnvironment</span>(host, port, <span class="attr">jarFiles</span>: _*)</span><br><span class="line">    javaEnv.<span class="title function_ invoke__">setParallelism</span>(parallelism)</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">StreamExecutionEnvironment</span>(javaEnv)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h2 id="执行模式"><a href="#执行模式" class="headerlink" title="执行模式"></a>执行模式</h2><p>经过上面获取的环境，我们就可以开始对其设置执行模式</p><p>在早期的代码中它把批处理和流处理分开了</p><p>通过代码</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">val pienvironment =org<span class="selector-class">.apache</span><span class="selector-class">.flink</span><span class="selector-class">.api</span><span class="selector-class">.scala</span><span class="selector-class">.ExecutionEnvironment</span><span class="selector-class">.getExecutionEnvironment</span></span><br><span class="line">val streamingenv= org<span class="selector-class">.apache</span><span class="selector-class">.flink</span><span class="selector-class">.streaming</span><span class="selector-class">.api</span><span class="selector-class">.scala</span><span class="selector-class">.StreamExecutionEnvironment</span>.getExecutionEnvironment</span><br></pre></td></tr></table></figure><p>这样的方式</p><p>上面一个是批处理的</p><p>下面一个是流处理的</p><p>他们的api是基本相同的，但是包不同</p><p>但是现在的做法是直接用下面的那个</p><p>对于批处理而言：我们只要在提交的时候通过命令</p><p><code>flink run -Dexecution.runtime-mode=BATCH 。。。。</code></p><p>就可以证明他是批处理的</p><p>如果不处理上述的参数默认是STREAMING ：就是流处理的格式</p><p>或者在代码的时候直接通过</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">val streamingenv= org<span class="selector-class">.apache</span><span class="selector-class">.flink</span><span class="selector-class">.streaming</span><span class="selector-class">.api</span><span class="selector-class">.scala</span><span class="selector-class">.StreamExecutionEnvironment</span><span class="selector-class">.getExecutionEnvironment</span></span><br><span class="line"> streamingenv<span class="selector-class">.setRuntimeMode</span>(RuntimeExecutionMode.AUTOMATIC)</span><br><span class="line">streamingenv<span class="selector-class">.setRuntimeMode</span>(RuntimeExecutionMode.BATCH)</span><br><span class="line">streamingenv<span class="selector-class">.setRuntimeMode</span>(RuntimeExecutionMode.STREAMING)</span><br></pre></td></tr></table></figure><p>里面传入相应的参数即可</p><p>但是一般不推荐这样做，因为这相当于固定死了，直接当命令行参数传递更好一点</p><p>在flink中批处理数据被划分到有界流中了，为什么还要批处理模式？</p><p>因为性能问题，流处理是来一条数据我处理一个数据，然后发送一条，批处理是来一堆数据我处理，如何再一起发送</p><p>对于批处理数据，它来的时候就是一堆来的，然后流处理的时候要一条一条发送，发送的次数多了，而对于批处理，我只用处理，然后一次发过去，就好了</p><p>这就是批处理还在flink中的原因</p><p>我们的flink代码是懒执行的，和懒加载是一个道理的，只有通过excute才开张真正的执行</p><h2 id="source"><a href="#source" class="headerlink" title="source"></a>source</h2><p>源算子：就是读取数据源的算子</p><h3 id="有界数据"><a href="#有界数据" class="headerlink" title="有界数据"></a>有界数据</h3><p>读取有界数据的简单的测试方法</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"> val streamingenv= org<span class="selector-class">.apache</span><span class="selector-class">.flink</span><span class="selector-class">.streaming</span><span class="selector-class">.api</span><span class="selector-class">.scala</span><span class="selector-class">.StreamExecutionEnvironment</span><span class="selector-class">.getExecutionEnvironment</span></span><br><span class="line"></span><br><span class="line"> case class <span class="built_in">event</span>(uaer:String,url:String,timestamp:Long)</span><br><span class="line"></span><br><span class="line">streamingenv<span class="selector-class">.setParallelism</span>(<span class="number">1</span>)</span><br><span class="line">    <span class="comment">// 从元素中读取数据</span></span><br><span class="line">    streamingenv<span class="selector-class">.fromElements</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">65</span>,<span class="number">67</span>,<span class="number">7</span>,<span class="number">7</span>)<span class="selector-class">.print</span>(<span class="string">&quot;from elem&quot;</span>)</span><br><span class="line">    streamingenv<span class="selector-class">.fromElements</span>(</span><br><span class="line">      <span class="built_in">event</span>(<span class="string">&quot;zihan&quot;</span>,<span class="string">&quot;1211&quot;</span>,<span class="number">1111</span>),</span><br><span class="line">      <span class="built_in">event</span>(<span class="string">&quot;bob&quot;</span>,<span class="string">&quot;1333&quot;</span>,<span class="number">22222</span>)</span><br><span class="line">    )<span class="selector-class">.print</span>(<span class="string">&quot;from case class&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 这个可以从迭代器中读取数据，具体可以ctrl + p 查看</span></span><br><span class="line">    val events = <span class="built_in">List</span>(<span class="built_in">event</span>(<span class="string">&quot;zihan&quot;</span>, <span class="string">&quot;1211&quot;</span>, <span class="number">1111</span>), <span class="built_in">event</span>(<span class="string">&quot;bob&quot;</span>, <span class="string">&quot;1333&quot;</span>, <span class="number">22222</span>))</span><br><span class="line">    streamingenv<span class="selector-class">.fromCollection</span>(events)<span class="selector-class">.print</span>(<span class="string">&quot;from list&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 读取文本文件</span></span><br><span class="line">    streamingenv<span class="selector-class">.readTextFile</span>(<span class="string">&quot;F:\\bigdatajava\\src\\main\\resources\\wc.data&quot;</span>)<span class="selector-class">.print</span>(<span class="string">&quot;from text&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>输出结果为</p><figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> elem&gt; <span class="number">1</span></span><br><span class="line"><span class="keyword">from</span> elem&gt; <span class="number">2</span></span><br><span class="line"><span class="keyword">from</span> elem&gt; <span class="number">3</span></span><br><span class="line"><span class="keyword">from</span> elem&gt; <span class="number">4</span></span><br><span class="line"><span class="keyword">from</span> elem&gt; <span class="number">5</span></span><br><span class="line"><span class="keyword">from</span> elem&gt; <span class="number">65</span></span><br><span class="line"><span class="keyword">from</span> elem&gt; <span class="number">67</span></span><br><span class="line"><span class="keyword">from</span> elem&gt; <span class="number">7</span></span><br><span class="line"><span class="keyword">from</span> elem&gt; <span class="number">7</span></span><br><span class="line"><span class="keyword">from</span> <span class="keyword">case</span> <span class="keyword">class</span>&gt; <span class="keyword">event</span>(zihan,<span class="number">1211</span>,<span class="number">1111</span>)</span><br><span class="line"><span class="keyword">from</span> list&gt; <span class="keyword">event</span>(zihan,<span class="number">1211</span>,<span class="number">1111</span>)</span><br><span class="line"><span class="keyword">from</span> <span class="keyword">case</span> <span class="keyword">class</span>&gt; <span class="keyword">event</span>(bob,<span class="number">1333</span>,<span class="number">22222</span>)</span><br><span class="line"><span class="keyword">from</span> list&gt; <span class="keyword">event</span>(bob,<span class="number">1333</span>,<span class="number">22222</span>)</span><br><span class="line">feom <span class="keyword">text</span>&gt; spark,linux，spark,spark</span><br><span class="line">feom <span class="keyword">text</span>&gt; hadoop</span><br><span class="line">feom <span class="keyword">text</span>&gt; linux,hive</span><br><span class="line">feom <span class="keyword">text</span>&gt; flume,flink</span><br><span class="line">feom <span class="keyword">text</span>&gt; gg,dd</span><br><span class="line">feom <span class="keyword">text</span>&gt; ttm,ff</span><br><span class="line">feom <span class="keyword">text</span>&gt; <span class="string">&quot;zihan&quot;</span>,<span class="string">&quot;1211&quot;</span>,<span class="number">1111</span></span><br><span class="line">feom <span class="keyword">text</span>&gt; <span class="string">&quot;bob&quot;</span>,<span class="string">&quot;1333&quot;</span>,<span class="number">22222</span></span><br><span class="line">[WARN ][<span class="number">2023</span>-<span class="number">02</span>-<span class="number">04</span> <span class="number">16</span>:<span class="number">15</span>:<span class="number">57</span>][org.apache.flink.streaming.api.functions.source.ContinuousFileReaderOperator$ReaderState$<span class="number">6</span>.prepareToProcessRecord(ContinuousFileReaderOperator.java:<span class="number">178</span>)]<span class="built_in">not</span> processing any records <span class="keyword">while</span> closed</span><br><span class="line"></span><br><span class="line">Process finished <span class="keyword">with</span> <span class="keyword">exit</span> code <span class="number">0</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>我们还可以把一些数据写进文本文件中然后进行读取</p><h3 id="无界数据"><a href="#无界数据" class="headerlink" title="无界数据"></a>无界数据</h3><p>我们一般是从kafka来接受数据的</p><p>我们先要引入链接kafka的依赖</p><p>如下：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">&lt;dependency&gt;</span></span><br><span class="line">  <span class="section">&lt;groupId&gt;</span><span class="attribute">org</span>.apache.flink&lt;/groupId&gt;</span><br><span class="line">  <span class="section">&lt;artifactId&gt;</span><span class="attribute">flink</span>-connector-kafka_2.<span class="number">12</span>&lt;/artifactId&gt;</span><br><span class="line">  <span class="section">&lt;version&gt;</span><span class="attribute">1</span>.<span class="number">13</span>.<span class="number">6</span>&lt;/version&gt;</span><br><span class="line"><span class="section">&lt;/dependency&gt;</span></span><br></pre></td></tr></table></figure><p>值得注意的是这个是官方的，他会自动根据kafka的版本进行更新，目前支持kafka0.10.0版本及以上的</p><p>有特殊需要就去找特殊的版本的</p><p>而且对于1.14版本之后的时候对我们要引入的方法有了更改从FlinkKafkaConsumer变成KafkaSource</p><p>代码如下</p><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line">import org.apache.flink.streaming.connectors.kafka.FlinkKafkaConsumer</span><br><span class="line">streamingenv.setParallelism(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    // 链接kafka</span><br><span class="line">    val <span class="built_in">properties</span> = <span class="built_in">new</span> Properties()</span><br><span class="line">    <span class="built_in">properties</span>.<span class="built_in">put</span>(<span class="string">&quot;bootstrap.servers&quot;</span>, <span class="string">&quot;bigdata3:9092,bigdata4:9092,bigdata5:9092 &quot;</span>)</span><br><span class="line"></span><br><span class="line">    // 注意使用下面的那个方法的时候不用在此设置下面的参数，因为这个FlinkKafkaConsumer[T]里面已经封装好了，而且默认采用的就是精准一次</span><br><span class="line">//    <span class="built_in">properties</span>.<span class="built_in">put</span>(<span class="string">&quot;key.serializer&quot;</span>, <span class="string">&quot;org.apache.kafka.common.serialization.StringSerializer&quot;</span>)</span><br><span class="line">//    <span class="built_in">properties</span>.<span class="built_in">put</span>(<span class="string">&quot;value.serializer&quot;</span>, <span class="string">&quot;org.apache.kafka.common.serialization.StringSerializer&quot;</span>)</span><br><span class="line">//    <span class="built_in">properties</span>.<span class="built_in">put</span>(<span class="string">&quot;acks&quot;</span>, <span class="string">&quot;all&quot;</span>)</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    传入参数说明FlinkKafkaConsumer[T]</span></span><br><span class="line"><span class="comment">    topic , 反序列化器 ， kafka配置参数</span></span><br><span class="line"><span class="comment">    上面的T是代表把获得的数据当作什么类型</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    streamingenv.addSource(<span class="built_in">new</span> FlinkKafkaConsumer[String](<span class="string">&quot;dl2262&quot;</span>,<span class="built_in">new</span> SimpleStringSchema(),<span class="built_in">properties</span>)).<span class="built_in">print</span>(<span class="string">&quot;kafka&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="读取自定义数据源"><a href="#读取自定义数据源" class="headerlink" title="读取自定义数据源"></a>读取自定义数据源</h3><p>如下</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">streamingenv.set<span class="constructor">Parallelism(1)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> 自己定义外部数据源</span></span><br><span class="line"><span class="comment"> 实现SourceFunction接口</span></span><br><span class="line"><span class="comment"> 重写两个方法run()和cancel()</span></span><br><span class="line"><span class="comment"> run()获取数据的方法</span></span><br><span class="line"><span class="comment"> cance()控制停止的方法</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line">import flinklearn.clickSource</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> stream = streamingenv.add<span class="constructor">Source(<span class="params">new</span> <span class="params">clickSource</span>)</span></span><br><span class="line"></span><br><span class="line">stream.print(<span class="string">&quot;makebyself&quot;</span>)</span><br></pre></td></tr></table></figure><p>source方法</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> flinklearn</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.<span class="type">Calendar</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.functions.source.<span class="type">SourceFunction</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> scala.util.<span class="type">Random</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">clickSource</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">apply</span></span>(): clickSource = <span class="keyword">new</span> clickSource()</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">SourceFunction[T]</span></span><br><span class="line"><span class="comment">其中的泛型就是我们对应的返回的数据的类型</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">clickSource</span> <span class="keyword">extends</span> <span class="title">SourceFunction</span>[event]</span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 标志位</span></span><br><span class="line">  <span class="keyword">var</span> flag = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">excute</span></span>(): <span class="type">Unit</span> =&#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">run</span></span>(sourceContext: <span class="type">SourceFunction</span>.<span class="type">SourceContext</span>[event]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="comment">// 随机数生成器</span></span><br><span class="line">    <span class="keyword">val</span> random =<span class="keyword">new</span>  <span class="type">Random</span>()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 定义选择的范围</span></span><br><span class="line">    <span class="keyword">val</span> user = <span class="type">Array</span>(<span class="string">&quot;1&quot;</span>,<span class="string">&quot;2&quot;</span>,<span class="string">&quot;3&quot;</span>)</span><br><span class="line">    <span class="keyword">val</span> url = <span class="type">Array</span>(<span class="string">&quot;/cat&quot;</span>,<span class="string">&quot;/.dog&quot;</span>,<span class="string">&quot;/info&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//使用循环不停的发送数据，标志位做为判断题条件，不停的发送数据</span></span><br><span class="line">    <span class="keyword">while</span> (flag)&#123;</span><br><span class="line">      <span class="keyword">val</span> eventtmp = event(user(random.nextInt(<span class="number">2</span>)),url(random.nextInt(<span class="number">2</span>)),<span class="type">Calendar</span>.getInstance().getTimeInMillis)</span><br><span class="line">      <span class="comment">// 调用上下文sourceContext的方法向下游发送数据</span></span><br><span class="line">      sourceContext.collect(eventtmp)</span><br><span class="line">      <span class="comment">// 每隔1s发送一条数据</span></span><br><span class="line">      <span class="type">Thread</span>.sleep(<span class="number">1000</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">cancel</span></span>(): <span class="type">Unit</span> = &#123;</span><br><span class="line">    flag = <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>但是对于SourceFunction它本身就是个并行度只能为1的接口</p><p>和socket文本流一样</p><p>如果想设置多并行度的就要用ParallelSourceFunction这个接口，其使用和上面一样</p><h2 id="flink支持的类型"><a href="#flink支持的类型" class="headerlink" title="flink支持的类型"></a>flink支持的类型</h2><p>flink里DS的数据类型都是由他的泛型进行控制的</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> stream:DataStream<span class="literal">[<span class="identifier">event</span>]</span> = streamingenv.add<span class="constructor">Source(<span class="params">new</span> <span class="params">clickSource</span>)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>基本上scala和java里所有的他都支持，但只是基本上，因为flink是分布式的，它再每个节点之间交付数据的时候是要经网络传输的，序列化和反序列化，所以对于一些的数据类型就无法支持</p><p>他的底层类型都是封装在TypeInformation和types中的，可以点进去查看</p><p>泛型的时候不是由flink进行序列化的，他是由Kyro进行的所以就可能出现问题，要尽可能避免</p><h2 id="算子"><a href="#算子" class="headerlink" title="算子"></a>算子</h2><h3 id="转换算子"><a href="#转换算子" class="headerlink" title="转换算子"></a>转换算子</h3><ul><li>map</li><li>filter</li><li>FlatMap</li><li>KeyBy:根据key进行聚合里面可以传入字符串，或者数字，或者和map里一样传入一个function</li><li>简单聚合方法 -&gt; sum , min ,max 等</li><li>reduce：就是和spark里的reducebykey一样</li></ul><p>调用的时候都是得到DS进行调用</p><p>使用如下:</p><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">    val value: DataStream[<span class="built_in">String</span>] = streamingenv.readTextFile(<span class="string">&quot;F:\\bigdatajava\\src\\main\\resources\\wc.data&quot;</span>)</span><br><span class="line">    value.flatMap(_.split(<span class="string">&quot;,&quot;</span>)).map(<span class="function"><span class="params">(_,<span class="number">1</span>)</span>).keyBy<span class="params">(_._1)</span>.reduce(<span class="params">(x,y)</span>=&gt;</span>&#123;</span><br><span class="line">      (x._1,x._2+y._2)</span><br><span class="line">    &#125;).<span class="built_in">print</span>()</span><br><span class="line">-------------------------------------------数据</span><br><span class="line">spark,linux,spark,spark</span><br><span class="line">hadoop</span><br><span class="line">linux,hive</span><br><span class="line">flume,flink</span><br><span class="line">gg,dd</span><br><span class="line">ttm,ff</span><br><span class="line"><span class="string">&quot;zihan&quot;</span>,<span class="string">&quot;1211&quot;</span>,<span class="number">1111</span></span><br><span class="line"><span class="string">&quot;bob&quot;</span>,<span class="string">&quot;1333&quot;</span>,<span class="number">22222</span></span><br></pre></td></tr></table></figure><h3 id="函数类（udf）"><a href="#函数类（udf）" class="headerlink" title="函数类（udf）"></a>函数类（udf）</h3><p>为什么他们里面可以放function</p><p>查看底层源码可以看见</p><figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@<span class="keyword">Public</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="function"><span class="keyword">Function</span></span> <span class="keyword">extends</span> java.io.Serializable &#123;&#125;</span><br></pre></td></tr></table></figure><p>他们继承于这个接口，并实现了各自的方法，所以就可以传入Function</p><p>进而导出udf是如何实现的</p><p>对于flink里的udf我们可以让它继承不同的function，然后再放进去</p><p>测试自定义udf的做法</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> flinklearn</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.common.functions.<span class="type">FilterFunction</span></span><br><span class="line"><span class="keyword">import</span> tool._</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.scala._</span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">udf</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">apply</span></span>(): udf = <span class="keyword">new</span> udf()</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    udf().udftest</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">udf</span></span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">val</span> streamingcontext = <span class="keyword">new</span> streamingcontext</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">udftest</span> </span>= &#123;</span><br><span class="line">    <span class="keyword">val</span> environment = streamingcontext.getflinkenv()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> testdata = <span class="type">List</span>(</span><br><span class="line">      event(<span class="string">&quot;zihan&quot;</span>, <span class="string">&quot;1211&quot;</span>, <span class="number">1111</span>),</span><br><span class="line">      event(<span class="string">&quot;bob&quot;</span>, <span class="string">&quot;1333&quot;</span>, <span class="number">22222</span>)</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> testDS = environment.fromCollection(testdata)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 筛选特定数据</span></span><br><span class="line">    testDS.filter( <span class="keyword">new</span> myfiliterfunction() ).print()</span><br><span class="line">  </span><br><span class="line">    testDS.filter( <span class="keyword">new</span> <span class="type">FilterFunction</span>[event] &#123;</span><br><span class="line">      <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">filter</span></span>(value: event): <span class="type">Boolean</span> = &#123;</span><br><span class="line">        value.uaer.contains(<span class="string">&quot;zihan&quot;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;).print()</span><br><span class="line"></span><br><span class="line">    environment.execute()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现自定义的function</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">myfiliterfunction</span>(<span class="params"></span>) <span class="keyword">extends</span> <span class="title">FilterFunction</span>[event]</span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">filter</span></span>(value: event): <span class="type">Boolean</span> = &#123;</span><br><span class="line">    value.uaer.contains(<span class="string">&quot;zi&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>注意，这里不要引用错包，如果引用错包，就会报错，因为scala和java的api名字是一样的</p><h3 id="富函数（udf）"><a href="#富函数（udf）" class="headerlink" title="富函数（udf）"></a>富函数（udf）</h3><p>因为我们上述所说的udf是针对一条数据进行操作的</p><p>但是假如我们想对一批数据进行操作，也就是数据来之前对其进行操作怎么办？</p><p>我们要通过更加复杂的用户自定义类，是函数类的扩展版本</p><p>最大的不同就是富函数类，可以获取运行环境的上下文，以及有生命周期等</p><p>富函数类的继承接口是Rich…Fnction </p><p>它里面有两个方法：</p><ul><li>open ： 相当于算子初始化的时候 和spring 里的初始化一样</li><li>close ： 结束的时候 和spring里的销毁是一样的</li></ul><p>如下：</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> flinklearn</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.common.functions.&#123;<span class="type">FilterFunction</span>, <span class="type">RichMapFunction</span>&#125;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.configuration.<span class="type">Configuration</span></span><br><span class="line"><span class="keyword">import</span> tool._</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.scala._</span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">udf</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">apply</span></span>(): udf = <span class="keyword">new</span> udf()</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    udf().udftest</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">udf</span></span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">val</span> streamingcontext = <span class="keyword">new</span> streamingcontext</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">udftest</span> </span>= &#123;</span><br><span class="line">    <span class="keyword">val</span> environment = streamingcontext.getflinkenv()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> testdata = <span class="type">List</span>(</span><br><span class="line">      event(<span class="string">&quot;zihan&quot;</span>, <span class="string">&quot;1211&quot;</span>, <span class="number">1111</span>),</span><br><span class="line">      event(<span class="string">&quot;bob&quot;</span>, <span class="string">&quot;1333&quot;</span>, <span class="number">22222</span>)</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> testDS = environment.fromCollection(testdata)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 定义富函数</span></span><br><span class="line">    testDS.map( <span class="keyword">new</span> myRichmap).print(<span class="string">&quot;2&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> result =</span><br><span class="line">      <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        |索引号0</span></span><br><span class="line"><span class="string">        |编号为4a4f30b513560b972fd0e372460b71c4</span></span><br><span class="line"><span class="string">        |2&gt; 1211</span></span><br><span class="line"><span class="string">        |2&gt; 1333</span></span><br><span class="line"><span class="string">        |这个是结束方法0</span></span><br><span class="line"><span class="string">        |&quot;&quot;&quot;</span>.stripMargin</span><br><span class="line">    environment.execute()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现富函数</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">myRichmap</span> <span class="keyword">extends</span> <span class="title">RichMapFunction</span>[event,<span class="type">String</span>]</span>&#123;</span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">map</span></span>(value: event): <span class="type">String</span> = &#123;</span><br><span class="line">    value.url</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 在所有数据到来之前进行处理</span></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">open</span></span>(parameters: <span class="type">Configuration</span>): <span class="type">Unit</span> = &#123;</span><br><span class="line">    println(<span class="string">&quot;索引号&quot;</span> + getRuntimeContext.getIndexOfThisSubtask)</span><br><span class="line">    println(<span class="string">&quot;编号为&quot;</span> + getRuntimeContext.getJobId)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// closa</span></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">close</span></span>(): <span class="type">Unit</span> = &#123;</span><br><span class="line">    println(<span class="string">&quot;这个是结束方法&quot;</span> + getRuntimeContext.getIndexOfThisSubtask)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>注意，当多个并行度进行的时候，每一个并行调用map的时候都会进行初始化，以及销毁</p><h2 id="分区函数"><a href="#分区函数" class="headerlink" title="分区函数"></a>分区函数</h2><p>简单来说就是数据的重新分区的操作</p><p>简单介绍一下：keyby</p><p>keyby：是把每个key根据hash值然后取模运算的方法进行分区也就造成了，每一个相同的key一定可以在同一分区，不同的不一定不在同一分区</p><p>接下来我们要学习的算子，是可以真正控制分区的</p><p>如果用上面keyby有可能会造成数据倾斜，也就是我们现在的操作就是控制数据倾斜的</p><p>物理分区，一般在并行度减少的时候会自动进行</p><h3 id="随机分区（shuffle）"><a href="#随机分区（shuffle）" class="headerlink" title="随机分区（shuffle）"></a>随机分区（shuffle）</h3><p>使用方法很简单直接DS.shuffle就可以了</p><h3 id="轮询分区（Round-Robin）"><a href="#轮询分区（Round-Robin）" class="headerlink" title="轮询分区（Round-Robin）"></a>轮询分区（Round-Robin）</h3><p>对比上面的shuffle是洗牌，则他就是发牌，和打扑克一样的那种，和kafka以及nginx是一样的</p><p>调用方式DS.rebalance()，其实Ds里上游到下游默认的就是轮询</p><h3 id="重缩放分区（rescale）"><a href="#重缩放分区（rescale）" class="headerlink" title="重缩放分区（rescale）"></a>重缩放分区（rescale）</h3><p>它和上面的轮询很像</p><p>轮询是把每一个并行子任务的数据都进行轮询，就是如果上游是两个任务，下游是三个任务</p><p>轮询会让第一个子任务的第一个数据 给下游的第一个，第一个第二个给下游的第二个，第一个的第三个给下游的第三个</p><p>上游的第二个子任务同理</p><p>但是这个并不是，它是做了个分组，旨在当前的组内进行轮询</p><p>就是相当于玩游戏局大了，要分开玩一样</p><p>每一个上游任务都会对应下游的一个组，然后再组里进行轮询，不能发牌给其他组</p><p>其本质上也就是按照taskmanager进行分组，每个taskmanager之间如果项进行通信则要经过网络传输代价比较大，</p><p>然后轮询其实就是再一个taskmanager（上游）和另外一个taskmanager（下游）之间进行通信，所以轮询的数据通道要建立M（上游数量）* N (下游数量)个通信</p><p>而现在的则不是，因为他是按照taskmanager进行分开的，所以它理论上是按照它组内的来进行的1上游数量）* N (下游数量)来通信，但是这里的n的数量都比上述小得多</p><p>但是要注意如果想优化性能要让上游子任务和下游子任务的数量是倍数的关系最好</p><p>使用的时候直接DS.rescale就好</p><p>可以用自定义数据源进行测试如下：</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> flinklearn</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.common.functions.&#123;<span class="type">FilterFunction</span>, <span class="type">RichMapFunction</span>&#125;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.configuration.<span class="type">Configuration</span></span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.functions.source.&#123;<span class="type">RichParallelSourceFunction</span>, <span class="type">SourceFunction</span>&#125;</span><br><span class="line"><span class="keyword">import</span> tool._</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.scala._</span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">udf</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">apply</span></span>(): udf = <span class="keyword">new</span> udf()</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    udf().udftest</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">udf</span></span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">val</span> streamingcontext = <span class="keyword">new</span> streamingcontext</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">udftest</span> </span>= &#123;</span><br><span class="line">    <span class="keyword">val</span> environment = streamingcontext.getflinkenv(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> testdata = <span class="type">List</span>(</span><br><span class="line">      event(<span class="string">&quot;zihan&quot;</span>, <span class="string">&quot;1211&quot;</span>, <span class="number">1111</span>),</span><br><span class="line">      event(<span class="string">&quot;bob&quot;</span>, <span class="string">&quot;1333&quot;</span>, <span class="number">22222</span>)</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">val</span> testDS = environment.addSource(<span class="keyword">new</span> trysource).setParallelism(<span class="number">3</span>)</span><br><span class="line">    testDS.rescale.print(<span class="string">&quot;rescale&quot;</span>)</span><br><span class="line">    environment.execute()</span><br><span class="line">    <span class="keyword">val</span> result =</span><br><span class="line">      <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        |rescale:1&gt; 2</span></span><br><span class="line"><span class="string">        |rescale:2&gt; 1</span></span><br><span class="line"><span class="string">        |rescale:2&gt; 3</span></span><br><span class="line"><span class="string">        |rescale:1&gt; 4</span></span><br><span class="line"><span class="string">        |rescale:2&gt; 5</span></span><br><span class="line"><span class="string">        |rescale:1&gt; 6</span></span><br><span class="line"><span class="string">        |rescale:2&gt; 7</span></span><br><span class="line"><span class="string">        |rescale:1&gt; 8</span></span><br><span class="line"><span class="string">        |&quot;&quot;&quot;</span>.stripMargin</span><br><span class="line">  </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">trysource</span> <span class="keyword">extends</span> <span class="title">RichParallelSourceFunction</span>[<span class="type">Int</span>]</span>&#123;</span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">run</span></span>(ctx: <span class="type">SourceFunction</span>.<span class="type">SourceContext</span>[<span class="type">Int</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">for</span> (i &lt;- <span class="number">0</span> to <span class="number">7</span>)&#123;</span><br><span class="line">      <span class="keyword">if</span> (getRuntimeContext.getIndexOfThisSubtask == (i+<span class="number">1</span>)%<span class="number">2</span>)&#123;</span><br><span class="line">        ctx.collect(i+<span class="number">1</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">cancel</span></span>(): <span class="type">Unit</span> = ???</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>通过结果我们可以知道1，3，5，7对应的子任务的id都是2 ，则2，4，6，8是1</p><p>满足我们设置的条件</p><h3 id="广播分区（broadcast）"><a href="#广播分区（broadcast）" class="headerlink" title="广播分区（broadcast）"></a>广播分区（broadcast）</h3><p>把一份数据复制成多个然后发送到下游所有子任务</p><p>但是一般会造成数据重复，但还是有作用的在用广播创建广播流的时候用</p><h3 id="自定义分区"><a href="#自定义分区" class="headerlink" title="自定义分区"></a>自定义分区</h3><p>接口叫做partitionCustom</p><p>源码如下：</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Partitions a DataStream on the key returned by the selector, using a custom partitioner.</span></span><br><span class="line"><span class="comment"> * This method takes the key selector to get the key to partition on, and a partitioner that</span></span><br><span class="line"><span class="comment"> * accepts the key type.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Note: This method works only on single field keys, i.e. the selector cannot return tuples</span></span><br><span class="line"><span class="comment"> * of fields.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">def partitionCustom<span class="literal">[K: T<span class="identifier">ypeInformation</span>]</span>(partitioner: Partitioner<span class="literal">[K]</span>, <span class="keyword">fun</span>: T =&gt; K)</span><br><span class="line">    : DataStream<span class="literal">[T]</span> = &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">val</span> keyType = implicitly<span class="literal">[T<span class="identifier">ypeInformation</span>[K]</span>]</span><br><span class="line">  <span class="keyword">val</span> cleanFun = clean(<span class="keyword">fun</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">val</span> keyExtractor = <span class="keyword">new</span> KeySelector<span class="literal">[T, K]</span> <span class="keyword">with</span> ResultTypeQueryable<span class="literal">[K]</span> &#123;</span><br><span class="line">    def get<span class="constructor">Key(<span class="params">in</span>: T)</span> = clean<span class="constructor">Fun(<span class="params">in</span>)</span></span><br><span class="line">    override def get<span class="constructor">ProducedType()</span>: TypeInformation<span class="literal">[K]</span> = keyType</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">as</span><span class="constructor">ScalaStream(<span class="params">stream</span>.<span class="params">partitionCustom</span>(<span class="params">partitioner</span>, <span class="params">keyExtractor</span>)</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Partitioner是分区器，后面的lambda表达式是提取当前分区字段的方法</p><p>点进去查看发现</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Partitioner</span>&lt;<span class="title">K</span>&gt; <span class="keyword">extends</span> <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span>, <span class="title">Function</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Computes the partition for the given key.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key The key.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> numPartitions The number of partitions to partition into.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> The partition index.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">partition</span><span class="params">(K key, <span class="keyword">int</span> numPartitions)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>它也是一个接口，他的返回值是要返回到下游子任务的编号，也就是分区的编号</p><p>如下：</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">package flinklearn</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.common.<span class="keyword">functions</span>.&#123;FilterFunction, Partitioner, RichMapFunction&#125;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.<span class="keyword">configuration</span>.<span class="keyword">Configuration</span></span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.<span class="keyword">functions</span>.source.&#123;RichParallelSourceFunction, SourceFunction&#125;</span><br><span class="line"><span class="keyword">import</span> tool._</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.scala._</span><br><span class="line"><span class="keyword">object</span> udf &#123;</span><br><span class="line"></span><br><span class="line">  def apply(): udf = <span class="built_in">new</span> udf()</span><br><span class="line"></span><br><span class="line">  def main(args: <span class="keyword">Array</span>[String]): Unit = &#123;</span><br><span class="line">    udf().udftest</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> udf&#123;</span><br><span class="line"></span><br><span class="line">  private val streamingcontext = <span class="built_in">new</span> streamingcontext</span><br><span class="line"></span><br><span class="line">  def udftest = &#123;</span><br><span class="line">    val environment = streamingcontext.getflinkenv(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">    val testDS = environment.fromElements(<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">67</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">8</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">4</span>,<span class="number">3</span>)</span><br><span class="line">    testDS.partitionCustom( <span class="built_in">new</span> Partitioner[<span class="type">Int</span>]&#123;</span><br><span class="line">      override def <span class="keyword">partition</span>(key: <span class="type">Int</span>, numPartitions: <span class="type">Int</span>): <span class="type">Int</span> = &#123;</span><br><span class="line">        key % <span class="number">2</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;, x=&gt;x ).print(&quot;rescale&quot;)</span><br><span class="line">    environment.<span class="keyword">execute</span>()</span><br><span class="line">    val result =</span><br><span class="line">      &quot;&quot;&quot;</span><br><span class="line">        |rescale:1&gt; 2</span><br><span class="line">        |rescale:1&gt; 4</span><br><span class="line">        |rescale:2&gt; 1</span><br><span class="line">        |rescale:1&gt; 6</span><br><span class="line">        |rescale:2&gt; 1</span><br><span class="line">        |rescale:1&gt; 8</span><br><span class="line">        |rescale:2&gt; 3</span><br><span class="line">        |rescale:1&gt; 8</span><br><span class="line">        |rescale:2&gt; 5</span><br><span class="line">        |rescale:1&gt; 6</span><br><span class="line">        |rescale:2&gt; 67</span><br><span class="line">        |rescale:1&gt; 4</span><br><span class="line">        |rescale:2&gt; 7</span><br><span class="line">        |rescale:2&gt; 5</span><br><span class="line">        |rescale:2&gt; 3</span><br><span class="line">        |</span><br><span class="line">        |Process finished with exit code 0</span><br><span class="line">        |</span><br><span class="line">        |&quot;&quot;&quot;.stripMargin</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>但是对于case class 可能不好使，我用就是不好用</p><h2 id="输出算子"><a href="#输出算子" class="headerlink" title="输出算子"></a>输出算子</h2><p>可以调用addSink就可以自己定义一个sink</p><p>里面最关键的构造方法是一个invoke具体在源码里</p><p>当然SinkFunction一般我们不用用，因为官方给我们提供了好多</p><p>接下来我们按照官网进行学习</p><h3 id="JDBC"><a href="#JDBC" class="headerlink" title="JDBC"></a>JDBC</h3><p>先在idea里添加依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.flink<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>flink-connector-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.16.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>已创建的 JDBC Sink 能够保证至少一次的语义。 更有效的精确执行一次可以通过 upsert 语句或幂等更新实现。</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">val value1: DataStreamSink[Yarninfo] = value.<span class="built_in">addSink</span>(</span><br><span class="line">  JdbcSink.<span class="built_in">sink</span>(</span><br><span class="line">    <span class="string">&quot;insert into yarninfo(id,host,applicationtype,name,startime,endtime,user,memeveryscends,vcoreeveryscends,size,cores,state,url) values(?,?,?,?,?,?,?,?,?,?,?,?,?)&quot;</span>,</span><br><span class="line">    new JdbcStatementBuilder[Yarninfo] &#123;</span><br><span class="line">      override def <span class="built_in">accept</span>(t: PreparedStatement, u: Yarninfo): Unit = &#123;</span><br><span class="line">        t<span class="selector-class">.setString</span>(<span class="number">1</span>, u.id)</span><br><span class="line">        t<span class="selector-class">.setString</span>(<span class="number">2</span>, u.host)</span><br><span class="line">        t<span class="selector-class">.setString</span>(<span class="number">3</span>, u.applicationtype)</span><br><span class="line">        t<span class="selector-class">.setString</span>(<span class="number">4</span>, u.name)</span><br><span class="line">        t<span class="selector-class">.setString</span>(<span class="number">5</span>, u.startime)</span><br><span class="line">        t<span class="selector-class">.setString</span>(<span class="number">6</span>, u.endtime)</span><br><span class="line">        t<span class="selector-class">.setString</span>(<span class="number">7</span>, u.user)</span><br><span class="line">        t<span class="selector-class">.setString</span>(<span class="number">8</span>, u.memeveryscends)</span><br><span class="line">        t<span class="selector-class">.setString</span>(<span class="number">9</span>, u.vcoreeveryscends)</span><br><span class="line">        t<span class="selector-class">.setString</span>(<span class="number">10</span>, u.size)</span><br><span class="line">        t<span class="selector-class">.setString</span>(<span class="number">11</span>, u.cores)</span><br><span class="line">        t<span class="selector-class">.setString</span>(<span class="number">12</span>, u.state)</span><br><span class="line">        t<span class="selector-class">.setString</span>(<span class="number">13</span>, u.url)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    new JdbcConnectionOptions<span class="selector-class">.JdbcConnectionOptionsBuilder</span>()</span><br><span class="line">      <span class="selector-class">.withUrl</span>(&quot;jdbc:mysql://bigdata2:<span class="number">3306</span>/bigdata&quot;)</span><br><span class="line">      <span class="selector-class">.withDriverName</span>(&quot;com.mysql.jdbc.Driver&quot;)</span><br><span class="line">      <span class="selector-class">.withUsername</span>(&quot;root&quot;)</span><br><span class="line">      <span class="selector-class">.withPassword</span>(&quot;liuzihan010616&quot;)</span><br><span class="line">      <span class="selector-class">.build</span>()</span><br><span class="line">  )</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>如果要实现幂等性等要自己家进行操作</p><h3 id="文件"><a href="#文件" class="headerlink" title="文件"></a>文件</h3><p>flink写入到文件中</p><p>如下：</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">testDS.map(<span class="literal">_</span>.toString).addSink(StreamingFileSink.</span><br><span class="line">  forRowFormat(<span class="keyword">new</span> <span class="type">Path</span>(<span class="string">&quot;./output&quot;</span>),</span><br><span class="line">   <span class="keyword">new</span> <span class="type">SimpleStringEncoder</span>[<span class="keyword">String</span>](<span class="string">&quot;UTF-8&quot;</span>))</span><br><span class="line">  .build())</span><br></pre></td></tr></table></figure><p>分区数量等于生成的文件数量</p><p><img src="https://pic.imgdb.cn/item/63df221a4757feff33a88620.jpg"></p><p>还可以在.bulid之前用with来设置一些写入的参数</p><ul><li>withBucketCheckInterval()：设置多长时间进行滚动一次</li><li>等，具体自己看下就ok</li></ul><p>写入到hdfs上的时候也直接改一下path就好</p><h3 id="kafka"><a href="#kafka" class="headerlink" title="kafka"></a>kafka</h3><p>如下：</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">testDS.map(<span class="literal">_</span>.toString).addSink(</span><br><span class="line">  <span class="keyword">new</span> <span class="type">FlinkKafkaProducer</span>[<span class="keyword">String</span>]</span><br><span class="line">  (<span class="string">&quot;bigdata3:9092,bigdata4:9092,bigdata5:9092&quot;</span>,<span class="string">&quot;dl2262&quot;</span>,<span class="keyword">new</span> <span class="type">SimpleStringSchema</span>())</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>就可以往kafka里写入了</p><h3 id="自定义外部连接器"><a href="#自定义外部连接器" class="headerlink" title="自定义外部连接器"></a>自定义外部连接器</h3><p>就是通过继承SinkFunction，以及对应的RichSinkfunction</p><p>实现invoke方法，放入自己写入的方法</p><h2 id="时间语义"><a href="#时间语义" class="headerlink" title="时间语义"></a>时间语义</h2><p>对于无界流，我们要查看它一定时间内的数据</p><p>对于分布式系统，我们没有一个绝对的时间指标</p><p>窗口进行数据的收集是以什么为标准的？</p><h3 id="处理时间"><a href="#处理时间" class="headerlink" title="处理时间"></a>处理时间</h3><p>就是我们对数据进行处理的时候的时间</p><h3 id="事件事件"><a href="#事件事件" class="headerlink" title="事件事件"></a>事件事件</h3><p>就是这个数据什么时候产生的</p><h3 id="水位线"><a href="#水位线" class="headerlink" title="水位线"></a>水位线</h3><p>用来度量事件时间的度量</p><h3 id="窗口"><a href="#窗口" class="headerlink" title="窗口"></a>窗口</h3><p>我们要观察，或者对一定时间内的数据进行操作</p>]]></content:encoded>
      
      
      <category domain="http://zihang.fun/categories/%E6%97%A5%E5%BF%97/">日志</category>
      
      
      <category domain="http://zihang.fun/tags/flink/">flink</category>
      
      
      <comments>http://zihang.fun/2023/01/25/1-25/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>sparksql-4</title>
      <link>http://zihang.fun/2023/01/16/1-16/</link>
      <guid>http://zihang.fun/2023/01/16/1-16/</guid>
      <pubDate>Mon, 16 Jan 2023 00:39:10 GMT</pubDate>
      
        
        
      <description>&lt;h1 id=&quot;sparkstreaming&quot;&gt;&lt;a href=&quot;#sparkstreaming&quot; class=&quot;headerlink&quot; title=&quot;sparkstreaming&quot;&gt;&lt;/a&gt;sparkstreaming&lt;/h1&gt;&lt;p&gt;用于实时计算的模块 &amp;#x3D;》 spar</description>
        
      
      
      
      <content:encoded><![CDATA[<h1 id="sparkstreaming"><a href="#sparkstreaming" class="headerlink" title="sparkstreaming"></a>sparkstreaming</h1><p>用于实时计算的模块 &#x3D;》 sparkstreaming，structuredstreaming</p><h2 id="流处理-：-实时"><a href="#流处理-：-实时" class="headerlink" title="流处理 ： 实时"></a>流处理 ： 实时</h2><ul><li>实时 来一套数据处理一条 storm，flink 数据叫event</li><li>近实时 来一批数据处理 mini-batch sparkstreaming</li><li>数据会源源不断地来</li></ul><h2 id="批处理-：-离线"><a href="#批处理-：-离线" class="headerlink" title="批处理 ： 离线"></a>批处理 ： 离线</h2><ul><li><p>代码或者程序处理一个批次的数据</p><ul><li>例子：数据放在hdfs上，我们对他进行处理 &#x3D;》 ok</li></ul></li></ul><h2 id="技术选型"><a href="#技术选型" class="headerlink" title="技术选型"></a>技术选型</h2><p>生产上：</p><ul><li>sparkstreaming，structuredstreaming 10%</li><li>flink 90%</li><li>storm 2%</li></ul><p>开发角度：</p><ul><li>code &#x3D;》 flink &gt; sparkstreaming</li><li>sql &#x3D;&gt; flink &gt; spark streaming</li></ul><p>业务：</p><ul><li>实施指标 ：都差不多</li><li>实时数仓：<ul><li>代码 ： 差不多</li><li>sql文件 ： flinksql维护实时数仓 &#x3D;》 ok</li></ul></li></ul><h2 id="特性"><a href="#特性" class="headerlink" title="特性"></a>特性</h2><p>容易使用 &#x3D;》 客观看</p><p>批流一体的处理方法 &#x3D;》 sparksql &lt;&#x3D;&gt; 流处理</p><p>低延迟高消费</p><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><ul><li>sparkstreaming开发是spark-core的一个扩展</li><li>接收数据的渠道多</li><li>还可以对数据进行流处理的可以机器学习等</li></ul><p>一般来说流式处理会比批处理负载小，但不绝对</p><h3 id="数据源-："><a href="#数据源-：" class="headerlink" title="数据源 ："></a>数据源 ：</h3><ul><li>kafka ****** 流式引擎重要的数据源 -》 通过topic进行数据缓冲，它会根据sp的吞吐量来进行处理，两个引擎之间会有联系</li><li>flume **** 可以使用但是一般不用 flume 没有数据缓冲 致命 -》 直接把数据弄到sp里，如果数据量特别多，会让sp程序挂掉，因为如果sa程序的吞吐量比较小，则会崩掉，和sp无联系</li><li>hdfs</li></ul><h3 id="数据积压：kafka数据太大，导致sp程序一直处理不过来，一个出不来报表-x3D-gt-解决方法"><a href="#数据积压：kafka数据太大，导致sp程序一直处理不过来，一个出不来报表-x3D-gt-解决方法" class="headerlink" title="数据积压：kafka数据太大，导致sp程序一直处理不过来，一个出不来报表 &#x3D;&gt;解决方法"></a>数据积压：kafka数据太大，导致sp程序一直处理不过来，一个出不来报表 &#x3D;&gt;解决方法</h3><ul><li>吞吐量提高</li><li>数据量减少</li></ul><h3 id="sparkstreaming运行机制"><a href="#sparkstreaming运行机制" class="headerlink" title="sparkstreaming运行机制"></a>sparkstreaming运行机制</h3><ul><li>接收数据</li><li>拆分成batches</li></ul><h3 id="sparkstreaming-gt-kafka-："><a href="#sparkstreaming-gt-kafka-：" class="headerlink" title="sparkstreaming -&gt; kafka ："></a>sparkstreaming -&gt; kafka ：</h3><ul><li>5s处理数据</li><li>每5s会切分成一次batch</li><li>交给sparkngine处理</li><li>处理完的也是一个batch</li></ul><h3 id="sparkstreaming编程模型：Dstream"><a href="#sparkstreaming编程模型：Dstream" class="headerlink" title="sparkstreaming编程模型：Dstream"></a>sparkstreaming编程模型：Dstream</h3><ul><li>外部数据源</li><li>高级算子</li><li>类似RDD</li></ul><h3 id="idea开发先配置pom文件"><a href="#idea开发先配置pom文件" class="headerlink" title="idea开发先配置pom文件"></a>idea开发先配置pom文件</h3><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">&lt;dependency&gt;</span></span><br><span class="line">  <span class="section">&lt;groupId&gt;</span><span class="attribute">org</span>.apache.spark&lt;/groupId&gt;</span><br><span class="line">  <span class="section">&lt;artifactId&gt;</span><span class="attribute">spark</span>-streaming_2.<span class="number">12</span>&lt;/artifactId&gt;</span><br><span class="line">  <span class="section">&lt;version&gt;</span><span class="attribute">3</span>.<span class="number">2</span>.<span class="number">1</span>&lt;/version&gt;</span><br><span class="line"><span class="section">&lt;/dependency&gt;</span></span><br></pre></td></tr></table></figure><h3 id="idea代码"><a href="#idea代码" class="headerlink" title="idea代码"></a>idea代码</h3><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">package sparkstreaming</span><br><span class="line">import org.apache.spark._</span><br><span class="line">import org.apache.spark.streaming._</span><br><span class="line">import org.apache.spark.streaming.<span class="module-access"><span class="module"><span class="identifier">StreamingContext</span>.</span><span class="module"><span class="identifier">_</span></span></span></span><br><span class="line"><span class="module"><span class="module-access">i</span></span>mport org.apache.spark.SparkConf</span><br><span class="line"></span><br><span class="line"><span class="keyword">object</span> sparkstreaming1 &#123;</span><br><span class="line">  def main(args: Array<span class="literal">[S<span class="identifier">tring</span>]</span>): Unit = &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> conf = <span class="keyword">new</span> <span class="constructor">SparkConf()</span>.set<span class="constructor">Master(<span class="string">&quot;local[4]&quot;</span>)</span>.set<span class="constructor">AppName(<span class="string">&quot;NetworkWordCount&quot;</span>)</span></span><br><span class="line">    <span class="keyword">val</span> ssc = <span class="keyword">new</span> <span class="constructor">StreamingContext(<span class="params">conf</span>, Seconds(5)</span>)</span><br><span class="line">    <span class="comment">// 或者通过sparkcontext进行创建</span></span><br><span class="line">    <span class="comment">//val ssc = new StreamingContext(sc, Seconds(1))</span></span><br><span class="line">    <span class="comment">// 数据源</span></span><br><span class="line">    <span class="keyword">val</span> lines = ssc.socket<span class="constructor">TextStream(<span class="string">&quot;bigdata5&quot;</span>, 9999)</span></span><br><span class="line">    <span class="comment">// 处理数据</span></span><br><span class="line">    <span class="keyword">val</span> words = lines.flat<span class="constructor">Map(<span class="params">_</span>.<span class="params">split</span>(<span class="string">&quot; &quot;</span>)</span>)</span><br><span class="line">    <span class="keyword">val</span> pairs = words.map(word =&gt; (word, <span class="number">1</span>))</span><br><span class="line">    <span class="keyword">val</span> wordCounts = pairs.reduce<span class="constructor">ByKey(<span class="params">_</span> + <span class="params">_</span>)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 打印数据当前批次</span></span><br><span class="line">    wordCounts.print<span class="literal">()</span></span><br><span class="line">    ssc.start<span class="literal">()</span>             <span class="comment">// Start</span></span><br><span class="line">    ssc.await<span class="constructor">Termination()</span>  <span class="comment">// Wait</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 配置数据源在目标机器上执行nc -lk 9999 然后输入数据就ok了</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>还可以在webui上查看</p><p>如下：</p><p><img src="https://pic.imgdb.cn/item/63c4b657be43e0d30e191256.jpg"></p><p>他的打印数据是处理当前批次的数据，不是累积批次的数据</p><h3 id="双流join"><a href="#双流join" class="headerlink" title="双流join"></a>双流join</h3><p>api :</p><ul><li>flink -》调用api</li><li>sparkstreaming code 很多 -》 api join stste</li></ul><p> 延迟数据</p><ul><li>processtime + udf</li><li>eventime + watermaker<ul><li>数据和离线对不上（容易）</li></ul></li></ul><p>如何构建DStream</p><ul><li>从inputstream的方式 生产上</li><li>receiver 测试用 为面试准备</li></ul><h2 id="构建Dstream"><a href="#构建Dstream" class="headerlink" title="构建Dstream"></a>构建Dstream</h2><h3 id="inputstrteam"><a href="#inputstrteam" class="headerlink" title="inputstrteam"></a>inputstrteam</h3><p>比如卡夫卡</p><h3 id="receiver"><a href="#receiver" class="headerlink" title="receiver"></a>receiver</h3><p>用receiver接受的时候如果是本地则要大于1 -&gt; local[2+]</p><p>因为sparkstreaming最少是有两部分切分以及处理，如果只给1则会没有资源进行处理</p><p>所以针对于receiver一个要大于等于</p><p>上面仅仅是针对receiver</p><p>例子 ：</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> lines = ssc.socket<span class="constructor">TextStream(<span class="string">&quot;bigdata5&quot;</span>, 9999)</span></span><br></pre></td></tr></table></figure><p>因为他底层源码是</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">def <span class="title function_">socketTextStream</span>(</span><br><span class="line">    <span class="attr">hostname</span>: <span class="title class_">String</span>,</span><br><span class="line">    <span class="attr">port</span>: <span class="title class_">Int</span>,</span><br><span class="line">    <span class="attr">storageLevel</span>: <span class="title class_">StorageLevel</span> = <span class="title class_">StorageLevel</span>.<span class="property">MEMORY_AND_DISK_SER_2</span></span><br><span class="line">  ): <span class="title class_">ReceiverInputDStream</span>[<span class="title class_">String</span>] = <span class="title function_">withNamedScope</span>(<span class="params"><span class="string">&quot;socket text stream&quot;</span></span>) &#123;</span><br><span class="line">  socketStream[<span class="title class_">String</span>](hostname, port, <span class="title class_">SocketReceiver</span>.<span class="property">bytesToLines</span>, storageLevel)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="Dstream算子"><a href="#Dstream算子" class="headerlink" title="Dstream算子"></a>Dstream算子</h2><p>转换操作：</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Similar</span> <span class="keyword">to</span> that <span class="keyword">of</span> RDDs, transformations allow the data <span class="keyword">from</span> the <span class="keyword">input</span> DStream <span class="keyword">to</span> be modified. DStreams support many <span class="keyword">of</span> the transformations available <span class="keyword">on</span> normal Spark RDD’s. <span class="keyword">Some</span> <span class="keyword">of</span> the common ones are <span class="keyword">as</span> follows.</span><br></pre></td></tr></table></figure><table><thead><tr><th>Transformation</th><th>Meaning</th></tr></thead><tbody><tr><td><strong>map</strong> ( <em>func</em> )</td><td>Return a new DStream by passing each element of the source DStream through a function<em>func</em> .</td></tr><tr><td><strong>flatMap</strong> ( <em>func</em> )</td><td>Similar to map, but each input item can be mapped to 0 or more output items.</td></tr><tr><td><strong>filter</strong> ( <em>func</em> )</td><td>Return a new DStream by selecting only the records of the source DStream on which<em>func</em> returns true.</td></tr><tr><td><strong>repartition</strong> ( <em>numPartitions</em> )</td><td>Changes the level of parallelism in this DStream by creating more or fewer partitions.</td></tr><tr><td><strong>union</strong> ( <em>otherStream</em> )</td><td>Return a new DStream that contains the union of the elements in the source DStream and<em>otherDStream</em> .</td></tr><tr><td><strong>count</strong> ()</td><td>Return a new DStream of single-element RDDs by counting the number of elements in each RDD of the source DStream.</td></tr><tr><td><strong>reduce</strong> ( <em>func</em> )</td><td>Return a new DStream of single-element RDDs by aggregating the elements in each RDD of the source DStream using a function<em>func</em> (which takes two arguments and returns one). The function should be associative and commutative so that it can be computed in parallel.</td></tr><tr><td><strong>countByValue</strong> ()</td><td>When called on a DStream of elements of type K, return a new DStream of (K, Long) pairs where the value of each key is its frequency in each RDD of the source DStream.</td></tr><tr><td><strong>reduceByKey</strong> ( <em>func</em> , [ <em>numTasks</em> ])</td><td>When called on a DStream of (K, V) pairs, return a new DStream of (K, V) pairs where the values for each key are aggregated using the given reduce function.<strong>Note:</strong> By default, this uses Spark’s default number of parallel tasks (2 for local mode, and in cluster mode the number is determined by the config property <code>spark.default.parallelism</code>) to do the grouping. You can pass an optional <code>numTasks</code> argument to set a different number of tasks.</td></tr><tr><td><strong>join</strong> ( <em>otherStream</em> , [ <em>numTasks</em> ])</td><td>When called on two DStreams of (K, V) and (K, W) pairs, return a new DStream of (K, (V, W)) pairs with all pairs of elements for each key.</td></tr><tr><td><strong>cogroup</strong> ( <em>otherStream</em> , [ <em>numTasks</em> ])</td><td>When called on a DStream of (K, V) and (K, W) pairs, return a new DStream of (K, Seq[V], Seq[W]) tuples.</td></tr><tr><td><strong>transform</strong> ( <em>func</em> )</td><td>Return a new DStream by applying a RDD-to-RDD function to every RDD of the source DStream. This can be used to do arbitrary RDD operations on the DStream.</td></tr><tr><td><strong>updateStateByKey</strong> ( <em>func</em> )</td><td>Return a new “state” DStream where the state for each key is updated by applying the given function on the previous state of the key and the new values for the key. This can be used to maintain arbitrary state data for each key.</td></tr></tbody></table><p>输出操作：</p><table><thead><tr><th>Output Operation</th><th>Meaning</th></tr></thead><tbody><tr><td><strong>print</strong> ()</td><td>Prints the first ten elements of every batch of data in a DStream on the driver node running the streaming application. This is useful for development and debugging.&#96;&#96;Python API This is called<strong>pprint()</strong> in the Python API.</td></tr><tr><td><strong>saveAsTextFiles</strong> ( <em>prefix</em> , [ <em>suffix</em> ])</td><td>Save this DStream’s contents as text files. The file name at each batch interval is generated based on<em>prefix</em> and  <em>suffix</em> :  <em>“prefix-TIME_IN_MS[.suffix]”</em> .</td></tr><tr><td><strong>saveAsObjectFiles</strong> ( <em>prefix</em> , [ <em>suffix</em> ])</td><td>Save this DStream’s contents as <code>SequenceFiles</code> of serialized Java objects. The file name at each batch interval is generated based on <em>prefix</em> and  <em>suffix</em> :  <em>“prefix-TIME_IN_MS[.suffix]”</em> .&#96;&#96;Python API This is not available in the Python API.</td></tr><tr><td><strong>saveAsHadoopFiles</strong> ( <em>prefix</em> , [ <em>suffix</em> ])</td><td>Save this DStream’s contents as Hadoop files. The file name at each batch interval is generated based on<em>prefix</em> and  <em>suffix</em> :  <em>“prefix-TIME_IN_MS[.suffix]”</em> .&#96;&#96;Python API This is not available in the Python API.</td></tr><tr><td><strong>foreachRDD</strong> ( <em>func</em> )</td><td>The most generic output operator that applies a function,<em>func</em> , to each RDD generated from the stream. This function should push the data in each RDD to an external system, such as saving the RDD to files, or writing it over the network to a database. Note that the function <em>func</em> is executed in the driver process running the streaming application, and will usually have RDD actions in it that will force the computation of the streaming RDDs.</td></tr></tbody></table><p>我们之前的计算代码只是计算当前批次的数据，也是sparkstreaming默认的</p><p>基于上面官方提出了状态</p><h2 id="状态"><a href="#状态" class="headerlink" title="状态"></a>状态</h2><ul><li>有状态 前后批次有联系</li><li>无状态 前后批次无联系</li></ul><p>用于解决统计类问题</p><p><strong>updateStateByKey</strong> ( <em>func</em> )：这个算子</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">def updateFunction(<span class="keyword">new</span><span class="type">Values</span>: Seq[<span class="keyword">Int</span>], runningCount: <span class="type">Option</span>[<span class="keyword">Int</span>]): <span class="type">Option</span>[<span class="keyword">Int</span>] = &#123;</span><br><span class="line">    val <span class="keyword">new</span><span class="type">Count</span> = ...  <span class="comment">// add the new values with the previous running count to get the new count</span></span><br><span class="line">    Some(<span class="keyword">new</span><span class="type">Count</span>)</span><br><span class="line">&#125;</span><br><span class="line">val runningCounts = pairs.updateStateByKey[<span class="keyword">Int</span>](updateFunction <span class="literal">_</span>)</span><br></pre></td></tr></table></figure><p>代码如下：</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">package sparkstreaming</span><br><span class="line"><span class="keyword">import</span> org.apache.spark._</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.streaming._</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.streaming.StreamingContext._</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.SparkConf</span><br><span class="line"><span class="keyword">import</span> tool.streamingcontext</span><br><span class="line"><span class="keyword">object</span> sparkstreaming1 &#123;</span><br><span class="line">  private val streamingcontext = <span class="built_in">new</span> streamingcontext</span><br><span class="line">  def main(args: <span class="keyword">Array</span>[String]): Unit = &#123;</span><br><span class="line"></span><br><span class="line">    val ssc = streamingcontext.getstreamcotext()</span><br><span class="line">    // 或者通过sparkcontext进行创建</span><br><span class="line">    //val ssc = <span class="built_in">new</span> StreamingContext(sc, Seconds(<span class="number">1</span>))</span><br><span class="line">    // 数据源</span><br><span class="line">    val lines = ssc.socketTextStream(&quot;bigdata5&quot;, <span class="number">9999</span>)</span><br><span class="line">    // 处理数据</span><br><span class="line">    val words = lines.flatMap(_.split(&quot; &quot;))</span><br><span class="line">    val pairs = words.map(word =&gt; (word, <span class="number">1</span>))</span><br><span class="line">    val wordCounts = pairs.reduceByKey(_ + _)</span><br><span class="line">    // 要指定<span class="keyword">checkpoint</span>目录</span><br><span class="line">    ssc.<span class="keyword">checkpoint</span>(&quot;file:///D:\\checkpoint&quot;)</span><br><span class="line">    val totalwc = pairs.updateStateByKey(updateFunction _)</span><br><span class="line">    //wordCounts.updateStateByKey()</span><br><span class="line">    // 打印数据当前批次</span><br><span class="line">    wordCounts.print()</span><br><span class="line">    totalwc.print()</span><br><span class="line">    ssc.<span class="keyword">start</span>()             // <span class="keyword">Start</span></span><br><span class="line">    ssc.awaitTermination()  // Wait</span><br><span class="line"></span><br><span class="line">    // 配置数据源在目标机器上执行nc -lk <span class="number">9999</span> 然后输入数据就ok了</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  def updateFunction(newValues: Seq[<span class="type">Int</span>], runningCount: <span class="keyword">Option</span>[<span class="type">Int</span>]): <span class="keyword">Option</span>[<span class="type">Int</span>] = &#123;</span><br><span class="line">      // <span class="keyword">add</span> the <span class="built_in">new</span> <span class="keyword">values</span> <span class="keyword">with</span> the previous running count <span class="keyword">to</span> <span class="keyword">get</span> the <span class="built_in">new</span> count</span><br><span class="line">    val sum = newValues.sum</span><br><span class="line">    val i = runningCount.getOrElse(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">Some</span>(sum+i)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>但是这样也产生了个新问题</p><p>我们观察checkpoint文件夹</p><p><img src="https://pic.imgdb.cn/item/63c4fa26be43e0d30e9044af.jpg"></p><p>生成很多个小文件</p><p>我们该如何解决</p><p>生产上我们不用</p><p>但是必备的知识还是要的</p><p>为了容错，恢复作业，和kafka里的一样</p><h2 id="checkpoint的存储东西"><a href="#checkpoint的存储东西" class="headerlink" title="checkpoint的存储东西"></a>checkpoint的存储东西</h2><p>matestore 元数据</p><ul><li>conf 作业里的配置信息</li><li>算子操作</li><li>未完成的批次</li></ul><p>Data</p><ul><li>就是批次的数据</li></ul><p>使用场景</p><ul><li>作业失败的时候回复的时候用</li><li>转换算子的时候</li></ul><p>但是注意生产上用不了</p><p>如何使用</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Checkpointing can be enabled <span class="keyword">by</span> setting a directory <span class="keyword">in</span> a fault-tolerant, reliable file <span class="keyword">system</span> (e.g., HDFS, S3, etc.) <span class="keyword">to</span> which the <span class="keyword">checkpoint</span> information will be saved. This <span class="keyword">is</span> done <span class="keyword">by</span> <span class="keyword">using</span> streamingContext.<span class="keyword">checkpoint</span>(checkpointDirectory). This will allow you <span class="keyword">to</span> use the aforementioned stateful transformations. Additionally, <span class="keyword">if</span> you want <span class="keyword">to</span> make the application recover <span class="keyword">from</span> driver failures, you should rewrite your streaming application <span class="keyword">to</span> have the <span class="keyword">following</span> behavior.</span><br><span class="line"></span><br><span class="line"><span class="keyword">When</span> the program <span class="keyword">is</span> being started <span class="keyword">for</span> the first <span class="type">time</span>, it will <span class="keyword">create</span> a <span class="built_in">new</span> StreamingContext, <span class="keyword">set</span> up <span class="keyword">all</span> the streams <span class="keyword">and</span> <span class="keyword">then</span> <span class="keyword">call</span> <span class="keyword">start</span>().</span><br><span class="line"><span class="keyword">When</span> the program <span class="keyword">is</span> being restarted <span class="keyword">after</span> failure, it will re-<span class="keyword">create</span> a StreamingContext <span class="keyword">from</span> the <span class="keyword">checkpoint</span> data <span class="keyword">in</span> the <span class="keyword">checkpoint</span> directory.</span><br></pre></td></tr></table></figure><p>idea代码</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Function to create and setup a new StreamingContext</span></span><br><span class="line">def <span class="keyword">function</span><span class="constructor">ToCreateContext()</span>: StreamingContext = &#123;</span><br><span class="line">  <span class="keyword">val</span> ssc = <span class="keyword">new</span> <span class="constructor">StreamingContext(<span class="operator">...</span>)</span>   <span class="comment">// new context</span></span><br><span class="line">  <span class="keyword">val</span> lines = ssc.socket<span class="constructor">TextStream(<span class="operator">...</span>)</span> <span class="comment">// create DStreams</span><span class="operator"></span></span><br><span class="line"><span class="operator">  ...</span></span><br><span class="line"><span class="operator">  </span>ssc.checkpoint(checkpointDirectory)   <span class="comment">// set checkpoint directory</span></span><br><span class="line">  ssc</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Get StreamingContext from checkpoint data or create a new one</span></span><br><span class="line"><span class="keyword">val</span> context = <span class="module-access"><span class="module"><span class="identifier">StreamingContext</span>.</span></span>get<span class="constructor">OrCreate(<span class="params">checkpointDirectory</span>, <span class="params">functionToCreateContext</span> <span class="params">_</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Do additional setup on context that needs to be done,</span></span><br><span class="line"><span class="comment">// irrespective of whether it is being started or restarted</span></span><br><span class="line">context.<span class="operator"> ...</span></span><br><span class="line"><span class="operator"></span></span><br><span class="line"><span class="operator"></span><span class="comment">// Start the context</span></span><br><span class="line">context.start<span class="literal">()</span></span><br><span class="line">context.await<span class="constructor">Termination()</span></span><br></pre></td></tr></table></figure><h3 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h3><p>小文件</p><p>修改代码就费了，就要重整</p><p>checkpoint用不了-》累计批次指标问题 -》 出现问题</p><h2 id="如何实现相同功能？"><a href="#如何实现相同功能？" class="headerlink" title="如何实现相同功能？"></a>如何实现相同功能？</h2><p>实现存储到外部，如何根据而外部文件进行累计</p><h2 id="使用checkpoint"><a href="#使用checkpoint" class="headerlink" title="使用checkpoint"></a>使用checkpoint</h2><p>解决checkpoint修改代码报错和小文件问题</p><p>所以简历上不可以出现我在生产上用过updateStateByKey，坚决不会用</p><h2 id="如何把处理好的数据存储到外部"><a href="#如何把处理好的数据存储到外部" class="headerlink" title="如何把处理好的数据存储到外部"></a>如何把处理好的数据存储到外部</h2><p>如下：</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">dstream.foreachRDD &#123;<span class="function"> <span class="params">rdd</span> =&gt;</span></span><br><span class="line">  <span class="keyword">val</span> connection = create<span class="constructor">NewConnection()</span>  <span class="comment">// executed at the driver</span></span><br><span class="line">  rdd.foreach &#123;<span class="function"> <span class="params">record</span> =&gt;</span></span><br><span class="line">    connection.send(record) <span class="comment">// executed at the worker</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>idea</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> sparkstreaming</span><br><span class="line"><span class="keyword">import</span> org.apache.spark._</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.streaming._</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.streaming.StreamingContext._</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.SparkConf</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.sql.SparkSession</span><br><span class="line"><span class="keyword">import</span> tool.&#123;mysqlutils, streamingcontext,savefile&#125;</span><br><span class="line">object sparkstreaming1 &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="type">val</span> <span class="variable">mysqlutils</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">mysqlutils</span></span><br><span class="line">  <span class="keyword">private</span> <span class="type">val</span> <span class="variable">streamingcontext</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">streamingcontext</span></span><br><span class="line">  <span class="keyword">private</span> <span class="type">val</span> <span class="variable">savefile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">savefile</span></span><br><span class="line">  def <span class="title function_">main</span><span class="params">(args: Array[String])</span>: Unit = &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="type">val</span> <span class="variable">ssc</span> <span class="operator">=</span> streamingcontext.getstreamcotext()</span><br><span class="line">    <span class="comment">// 或者通过sparkcontext进行创建</span></span><br><span class="line">    <span class="comment">//val ssc = new StreamingContext(sc, Seconds(1))</span></span><br><span class="line">    <span class="comment">// 数据源</span></span><br><span class="line">    <span class="type">val</span> <span class="variable">lines</span> <span class="operator">=</span> ssc.socketTextStream(<span class="string">&quot;bigdata5&quot;</span>, <span class="number">9999</span>)</span><br><span class="line">    <span class="comment">// 处理数据</span></span><br><span class="line">    <span class="type">val</span> <span class="variable">words</span> <span class="operator">=</span> lines.flatMap(_.split(<span class="string">&quot; &quot;</span>))</span><br><span class="line">    <span class="type">val</span> <span class="variable">pairs</span> <span class="operator">=</span> words.map(word =&gt; (word, <span class="number">1</span>))</span><br><span class="line">    <span class="type">val</span> <span class="variable">wordCounts</span> <span class="operator">=</span> pairs.reduceByKey(_ + _)</span><br><span class="line">    <span class="comment">//val totalwc = pairs.updateStateByKey(updateFunction _)</span></span><br><span class="line">    <span class="comment">//wordCounts.updateStateByKey()</span></span><br><span class="line">    <span class="comment">// 打印数据当前批次</span></span><br><span class="line">    wordCounts.print()</span><br><span class="line">    <span class="comment">//totalwc.print()</span></span><br><span class="line">    <span class="comment">// 把结果输入到mysql里 先在mysql里创建完表了</span></span><br><span class="line">    <span class="comment">// 下面会报错-&gt; mysql链接没有进行序列化 ，我们不能加除非更改底层源码</span></span><br><span class="line">    <span class="comment">// closure 闭包 -&gt; 方法内使用了方法外的变量 比如下述的connect</span></span><br><span class="line">    wordCounts.foreachRDD(rdd=&gt;&#123;</span><br><span class="line">      <span class="type">val</span> <span class="variable">connection</span> <span class="operator">=</span> mysqlutils.getconnect(<span class="string">&quot;jdbc:mysql://bigdata2:3306/bigdata&quot;</span>, <span class="string">&quot;root&quot;</span>, <span class="string">&quot;liuzihan010616&quot;</span>)</span><br><span class="line">      rdd.foreach &#123; record =&gt;</span><br><span class="line">        <span class="type">val</span> <span class="variable">sql</span> <span class="operator">=</span> s<span class="string">&quot;insert into wc values(&#x27;$&#123;record._1&#125;&#x27;,&#x27;$&#123;record._2&#125;&#x27;)&quot;</span></span><br><span class="line">        connection.createStatement.execute(sql)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"><span class="comment">// --------------------------------------------------------</span></span><br><span class="line">    <span class="comment">//对上述进行修改之后</span></span><br><span class="line">    <span class="comment">//这样是可以的但是性能不高</span></span><br><span class="line">    <span class="comment">//因为会一直拿链接，会造成性能下降</span></span><br><span class="line">        wordCounts.foreachRDD(rdd=&gt;&#123;</span><br><span class="line">          rdd.foreach &#123; record =&gt;</span><br><span class="line">            <span class="type">val</span> <span class="variable">sql</span> <span class="operator">=</span> s<span class="string">&quot;insert into wc values(&#x27;$&#123;record._1&#125;&#x27;,&#x27;$&#123;record._2&#125;&#x27;)&quot;</span></span><br><span class="line">            <span class="type">val</span> <span class="variable">connection</span> <span class="operator">=</span> mysqlutils.getconnect(<span class="string">&quot;jdbc:mysql://bigdata2:3306/bigdata&quot;</span>, <span class="string">&quot;root&quot;</span>, <span class="string">&quot;liuzihan010616&quot;</span>)</span><br><span class="line">            connection.createStatement.execute(sql)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    <span class="comment">//优化性能</span></span><br><span class="line">    wordCounts.foreachRDD(rdd=&gt;&#123;</span><br><span class="line">      rdd.foreachPartition(record=&gt;&#123;</span><br><span class="line">        <span class="type">val</span> <span class="variable">connection</span> <span class="operator">=</span> mysqlutils.getconnect(<span class="string">&quot;jdbc:mysql://bigdata2:3306/bigdata&quot;</span>, <span class="string">&quot;root&quot;</span>, <span class="string">&quot;liuzihan010616&quot;</span>)</span><br><span class="line">        record.foreach(pari =&gt; &#123;</span><br><span class="line">          <span class="type">val</span> <span class="variable">sql</span> <span class="operator">=</span> s<span class="string">&quot;insert into wc values(&#x27;$&#123;pari._1&#125;&#x27;,&#x27;$&#123;pari._2&#125;&#x27;)&quot;</span></span><br><span class="line">          connection.createStatement.execute(sql)</span><br><span class="line">        &#125;)</span><br><span class="line">        mysqlutils.closeconnect(connection)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// 再次进行优化 原因 -》 partition的数量过高</span></span><br><span class="line">    <span class="comment">// 通过连接池来进行</span></span><br><span class="line">    <span class="comment">// 或者通过coalse来控制这个分区数量</span></span><br><span class="line">    dstream.foreachRDD &#123; rdd =&gt;</span><br><span class="line">      rdd.foreachPartition &#123; partitionOfRecords =&gt;</span><br><span class="line">        <span class="comment">// ConnectionPool is a static, lazily initialized pool of connections</span></span><br><span class="line">        <span class="type">val</span> <span class="variable">connection</span> <span class="operator">=</span> ConnectionPool.getConnection()</span><br><span class="line">        partitionOfRecords.foreach(record =&gt; connection.send(record))</span><br><span class="line">        ConnectionPool.returnConnection(connection)  <span class="comment">// return to the pool for future reuse</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 利用sparksql的方式写入 最推荐</span></span><br><span class="line">    <span class="comment">// 性能也很好因为用的是spark的</span></span><br><span class="line">    wordCounts.foreachRDD(rdd=&gt;&#123;</span><br><span class="line">      <span class="type">val</span> <span class="variable">spark</span> <span class="operator">=</span> SparkSession.builder.config(rdd.sparkContext.getConf).getOrCreate()</span><br><span class="line">      <span class="keyword">import</span> spark.implicits._</span><br><span class="line">      <span class="comment">// Convert RDD[String] to DataFrame</span></span><br><span class="line">      <span class="type">val</span> <span class="variable">wordsDataFrame</span> <span class="operator">=</span> rdd.toDF(<span class="string">&quot;word&quot;</span>,<span class="string">&quot;cnt&quot;</span>)</span><br><span class="line">      val srray:Array[String] = Array(<span class="string">&quot;append&quot;</span>,<span class="string">&quot;jdbc:mysql://bigdata2:3306/bigdata&quot;</span>,<span class="string">&quot;root&quot;</span>,<span class="string">&quot;liuzihan010616&quot;</span>,<span class="string">&quot;wc&quot;</span>,<span class="string">&quot;word&quot;</span>)</span><br><span class="line">      savefile.savetojdbc(spark,wordsDataFrame,srray)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    ssc.start()             <span class="comment">// Start</span></span><br><span class="line">    ssc.awaitTermination()  <span class="comment">// Wait</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 配置数据源在目标机器上执行nc -lk 9999 然后输入数据就ok了</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  def <span class="title function_">updateFunction</span><span class="params">(newValues: Seq[Int], runningCount: Option[Int])</span>: Option[Int] = &#123;</span><br><span class="line">      <span class="comment">// add the new values with the previous running count to get the new count</span></span><br><span class="line">    <span class="type">val</span> <span class="variable">sum</span> <span class="operator">=</span> newValues.sum</span><br><span class="line">    <span class="type">val</span> <span class="variable">i</span> <span class="operator">=</span> runningCount.getOrElse(<span class="number">0</span>)</span><br><span class="line">    Some(sum+i)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="transform"><a href="#transform" class="headerlink" title="transform"></a>transform</h2><h3 id="DStream和RDD之间交互的算子"><a href="#DStream和RDD之间交互的算子" class="headerlink" title="DStream和RDD之间交互的算子"></a>DStream和RDD之间交互的算子</h3><p>需求 ：</p><ul><li>一个数据是来自于mysql&#x2F;文本数据 ： 量小 伪表</li><li>一个数据 来自kafka sss读取形成的DStream 量大 主业务线</li></ul><p>实例：弹幕过滤功能</p><ul><li>离线</li><li>实时</li></ul><h3 id="数据如下"><a href="#数据如下" class="headerlink" title="数据如下"></a>数据如下</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">主表：</span><br><span class="line">不好看</span><br><span class="line">垃圾</span><br><span class="line">女主真好看</span><br><span class="line">666</span><br><span class="line">过滤的弹幕：</span><br><span class="line">热巴真丑</span><br><span class="line">鸡儿真美</span><br><span class="line">王退出娱乐圈</span><br></pre></td></tr></table></figure><h3 id="离线"><a href="#离线" class="headerlink" title="离线:"></a>离线:</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> sparkstreaming</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.sql.SparkSession</span><br><span class="line"><span class="keyword">import</span> tool._</span><br><span class="line"><span class="keyword">object</span> sparkstreaming2 &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">val</span> spark = SparkSession.builder().appName(<span class="string">&quot;Sparksql01&quot;</span>).master(<span class="string">&quot;local[4]&quot;</span>).enableHiveSupport().getOrCreate()</span><br><span class="line">  def main(args: Array[String]): <span class="built_in">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">var</span> mainsql = List(</span><br><span class="line">      <span class="string">&quot;不好看&quot;</span>,</span><br><span class="line">      <span class="string">&quot;垃圾&quot;</span>,</span><br><span class="line">      <span class="string">&quot;女主真好看&quot;</span>,</span><br><span class="line">      <span class="string">&quot;666&quot;</span>,</span><br><span class="line">      <span class="string">&quot;热巴真丑&quot;</span>,</span><br><span class="line">      <span class="string">&quot;鸡儿真美&quot;</span>,</span><br><span class="line">      <span class="string">&quot;王退出娱乐圈&quot;</span>)</span><br><span class="line">    <span class="keyword">val</span> maintable = spark.sparkContext.parallelize(mainsql)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> black = List(</span><br><span class="line">      <span class="string">&quot;热巴真丑&quot;</span>,</span><br><span class="line">        <span class="string">&quot;鸡儿真美&quot;</span>,</span><br><span class="line">      <span class="string">&quot;王退出娱乐圈&quot;</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> blacktable = spark.sparkContext.parallelize(black)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> value1 = maintable.map(x =&gt; &#123;</span><br><span class="line">      (x, <span class="number">1</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">val</span> value = blacktable.map(x =&gt; &#123;</span><br><span class="line">      (x, <span class="literal">true</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    value1.leftOuterJoin(value).filter(_._2._2.getOrElse(<span class="literal">false</span>)!=<span class="literal">true</span>).map(_._1).foreach(println(_))</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="实时："><a href="#实时：" class="headerlink" title="实时："></a>实时：</h3><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">private val streamingcontext = <span class="keyword">new</span> streamingcontext</span><br><span class="line">def main(args: <span class="built_in">Array</span>[String]): Unit = &#123;</span><br><span class="line">  val ssc = streamingcontext.getstreamcotext()</span><br><span class="line">  val maintable = ssc.socketTextStream(<span class="string">&quot;bigdata5&quot;</span>, <span class="number">9099</span>)</span><br><span class="line">  <span class="keyword">var</span> black = List(</span><br><span class="line">    <span class="string">&quot;热巴真丑&quot;</span>,</span><br><span class="line">    <span class="string">&quot;鸡儿真美&quot;</span>,</span><br><span class="line">    <span class="string">&quot;王退出娱乐圈&quot;</span></span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line">  val blacktable = ssc.sparkContext.parallelize(black)</span><br><span class="line"></span><br><span class="line">  val value = blacktable.<span class="built_in">map</span>(<span class="function"><span class="params">x</span> =&gt;</span> &#123;</span><br><span class="line">    (x, <span class="literal">true</span>)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  val value1 = maintable.<span class="built_in">map</span>(<span class="function"><span class="params">x</span> =&gt;</span> &#123;</span><br><span class="line">    (x, <span class="number">1</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">  val value2 = value1.transform(<span class="function"><span class="params">x</span> =&gt;</span> &#123;</span><br><span class="line">    x.leftOuterJoin(value).<span class="built_in">filter</span>(_._2._2.getOrElse(<span class="literal">false</span>) != <span class="literal">true</span>).<span class="built_in">map</span>(_._1)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  value2.print()</span><br><span class="line">  </span><br><span class="line">  ssc.start()</span><br><span class="line">  ssc.awaitTermination()</span><br></pre></td></tr></table></figure><h2 id="sparkstreaming和kafka整合"><a href="#sparkstreaming和kafka整合" class="headerlink" title="sparkstreaming和kafka整合"></a>sparkstreaming和kafka整合</h2><p>通过receiver方式读取kafka数据</p><p>kafka版本我们选择的是2.2.1</p><p>在sparkstreaming里默认的时候是至少一次</p><p>spark消费kafka数据形成的DStream里的分区数量和Kafka里的topic的分区数是一一对应的</p><p>分区数和task数是一一对应的-》并行度一一对应</p><p>官网：<a href="https://spark.apache.org/docs/latest/streaming-kafka-0-10-integration">kafkaonspark</a></p><p>idea里的依赖</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">&lt;dependency&gt;</span></span><br><span class="line">  <span class="section">&lt;groupId&gt;</span><span class="attribute">org</span>.apache.spark&lt;/groupId&gt;</span><br><span class="line">  <span class="section">&lt;artifactId&gt;</span><span class="attribute">spark</span>-streaming-kafka-<span class="number">0</span>-<span class="number">10</span>_2.<span class="number">12</span>&lt;/artifactId&gt;</span><br><span class="line">  <span class="section">&lt;version&gt;</span><span class="attribute">3</span>.<span class="number">2</span>.<span class="number">1</span>&lt;/version&gt;</span><br><span class="line"><span class="section">&lt;/dependency&gt;</span></span><br></pre></td></tr></table></figure><p>使用：</p><figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-------------------------------kafka消费数据</span></span><br><span class="line"><span class="title">kafka</span>-console-consumer.sh \</span><br><span class="line"><span class="comment">--bootstrap-server bigdata3:9092,bigdata4:9092,bigdata5:9092 \</span></span><br><span class="line"><span class="comment">--topic dl2262 \</span></span><br><span class="line"><span class="comment">--from-beginning </span></span><br><span class="line"><span class="comment">-----------------------------kafka创建topic</span></span><br><span class="line"><span class="title">kafka</span>-topics.sh \</span><br><span class="line"><span class="comment">--create \</span></span><br><span class="line"><span class="comment">--zookeeper bigdata3:2181,bigdata4:2181,bigdata5:2181/kafka \</span></span><br><span class="line"><span class="comment">--topic dl2262 \</span></span><br><span class="line"><span class="comment">--partitions 6 \</span></span><br><span class="line"><span class="comment">--replication-factor 3</span></span><br><span class="line"><span class="comment">-------------------------------kafka生产数据</span></span><br><span class="line"><span class="title">kafka</span>-console-producer.sh \</span><br><span class="line"><span class="comment">--broker-list bigdata3:9092,bigdata4:9092,bigdata5:9092 \</span></span><br><span class="line"><span class="comment">--topic dl2262</span></span><br><span class="line"><span class="comment">-------------------------------kafka查看topic</span></span><br><span class="line"><span class="title">kafka</span>-topics.sh \</span><br><span class="line"><span class="comment">--describe \</span></span><br><span class="line"><span class="comment">--zookeeper bigdata3:2181,bigdata4:2181,bigdata5:2181/kafka \</span></span><br><span class="line"><span class="comment">--topic dl2262 </span></span><br><span class="line"><span class="comment">-----------------------------代码</span></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.sql.SparkSession</span><br><span class="line"><span class="keyword">import</span> tool._</span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.consumer.ConsumerRecord</span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.common.serialization.StringDeserializer</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.streaming.kafka010._</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.streaming.kafka010.LocationStrategies.PreferConsistent</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.streaming.kafka010.ConsumerStrategies.Subscribe</span><br><span class="line"><span class="title">object</span> sparkstreaming2 &#123;</span><br><span class="line"></span><br><span class="line">  private val streamingcontext = new streamingcontext</span><br><span class="line"></span><br><span class="line">  def main(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    val kafkaParams = <span class="type">Map</span>[<span class="type">String</span>, <span class="type">Object</span>](</span><br><span class="line">      <span class="string">&quot;bootstrap.servers&quot;</span> -&gt; <span class="string">&quot;bigdata3:9092,bigdata4:9092,bigdata5:9092&quot;</span>, // kafka地址</span><br><span class="line">      <span class="string">&quot;key.deserializer&quot;</span> -&gt; classOf[<span class="type">StringDeserializer</span>], // 反序列化</span><br><span class="line">      <span class="string">&quot;value.deserializer&quot;</span> -&gt; classOf[<span class="type">StringDeserializer</span>], // 反序列化</span><br><span class="line">      <span class="string">&quot;group.id&quot;</span> -&gt; <span class="string">&quot;dl2262-1&quot;</span>, // 指定消费者组</span><br><span class="line">      <span class="string">&quot;auto.offset.reset&quot;</span> -&gt; <span class="string">&quot;latest&quot;</span>, // 从什么地方开始消费</span><br><span class="line">      <span class="string">&quot;enable.auto.commit&quot;</span> -&gt; (false: java.lang.<span class="type">Boolean</span>) // offset的提交 是不是自动提交</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">     val example = streamingcontext.getstreamcotext()</span><br><span class="line">    val topics = <span class="type">Array</span>(<span class="string">&quot;dl2262&quot;</span>)</span><br><span class="line">    val stream = <span class="type">KafkaUtils</span>.createDirectStream[<span class="type">String</span>, <span class="type">String</span>](</span><br><span class="line">      example,</span><br><span class="line">      <span class="type">PreferConsistent</span>, // 数据存储策略 <span class="type">Kafka</span>数据均匀分在各个exector上，一共有三种</span><br><span class="line">      <span class="type">Subscribe</span>[<span class="type">String</span>, <span class="type">String</span>](topics, kafkaParams) // 固定写法</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    stream.map(record =&gt; (record.value)).print()</span><br><span class="line"></span><br><span class="line">    example.start()</span><br><span class="line">    example.awaitTermination()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>上述用的是新版本的kafka的api</p><p>消费kafka数据做wc 将结果-》mysql</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">package sparkstreaming</span><br><span class="line"><span class="keyword">import</span> org.<span class="property">apache</span>.<span class="property">spark</span>.<span class="property">sql</span>.<span class="property">SparkSession</span></span><br><span class="line"><span class="keyword">import</span> tool.<span class="property">_</span></span><br><span class="line"><span class="keyword">import</span> org.<span class="property">apache</span>.<span class="property">kafka</span>.<span class="property">clients</span>.<span class="property">consumer</span>.<span class="property">ConsumerRecord</span></span><br><span class="line"><span class="keyword">import</span> org.<span class="property">apache</span>.<span class="property">kafka</span>.<span class="property">common</span>.<span class="property">serialization</span>.<span class="property">StringDeserializer</span></span><br><span class="line"><span class="keyword">import</span> org.<span class="property">apache</span>.<span class="property">spark</span>.<span class="property">streaming</span>.<span class="property">kafka010</span>.<span class="property">_</span></span><br><span class="line"><span class="keyword">import</span> org.<span class="property">apache</span>.<span class="property">spark</span>.<span class="property">streaming</span>.<span class="property">kafka010</span>.<span class="property">LocationStrategies</span>.<span class="property">PreferConsistent</span></span><br><span class="line"><span class="keyword">import</span> org.<span class="property">apache</span>.<span class="property">spark</span>.<span class="property">streaming</span>.<span class="property">kafka010</span>.<span class="property">ConsumerStrategies</span>.<span class="property">Subscribe</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">object</span> sparkstreaming2 &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> val streamingcontext = <span class="keyword">new</span> streamingcontext</span><br><span class="line">  <span class="keyword">private</span> val savefile = <span class="keyword">new</span> savefile</span><br><span class="line">  def <span class="title function_">main</span>(<span class="attr">args</span>: <span class="title class_">Array</span>[<span class="title class_">String</span>]): <span class="title class_">Unit</span> = &#123;</span><br><span class="line">    val kafkaParams = <span class="title class_">Map</span>[<span class="title class_">String</span>, <span class="title class_">Object</span>](</span><br><span class="line">      <span class="string">&quot;bootstrap.servers&quot;</span> -&gt; <span class="string">&quot;bigdata3:9092,bigdata4:9092,bigdata5:9092&quot;</span>, <span class="comment">// kafka地址</span></span><br><span class="line">      <span class="string">&quot;key.deserializer&quot;</span> -&gt; classOf[<span class="title class_">StringDeserializer</span>], <span class="comment">// 反序列化</span></span><br><span class="line">      <span class="string">&quot;value.deserializer&quot;</span> -&gt; classOf[<span class="title class_">StringDeserializer</span>], <span class="comment">// 反序列化</span></span><br><span class="line">      <span class="string">&quot;group.id&quot;</span> -&gt; <span class="string">&quot;dl2262-1&quot;</span>, <span class="comment">// 指定消费者组</span></span><br><span class="line">      <span class="string">&quot;auto.offset.reset&quot;</span> -&gt; <span class="string">&quot;latest&quot;</span>, <span class="comment">// 从什么地方开始消费</span></span><br><span class="line">      <span class="string">&quot;enable.auto.commit&quot;</span> -&gt; (<span class="attr">false</span>: java.<span class="property">lang</span>.<span class="property">Boolean</span>) <span class="comment">// offset的提交 是不是自动提交</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    val example = streamingcontext.<span class="title function_">getstreamcotext</span>()</span><br><span class="line">    val topics = <span class="title class_">Array</span>(<span class="string">&quot;dl2262&quot;</span>)</span><br><span class="line">    val stream = <span class="title class_">KafkaUtils</span>.<span class="property">createDirectStream</span>[<span class="title class_">String</span>, <span class="title class_">String</span>](</span><br><span class="line">      example,</span><br><span class="line">      <span class="title class_">PreferConsistent</span>, <span class="comment">// 数据存储策略 Kafka数据均匀分在各个exector上，一共有三种</span></span><br><span class="line">      <span class="title class_">Subscribe</span>[<span class="title class_">String</span>, <span class="title class_">String</span>](topics, kafkaParams) <span class="comment">// 固定写法</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    stream.<span class="title function_">map</span>(<span class="function"><span class="params">record</span> =&gt;</span> (record.<span class="property">value</span>)).<span class="title function_">print</span>()</span><br><span class="line"></span><br><span class="line">    val value = stream.<span class="title function_">map</span>(<span class="function"><span class="params">record</span> =&gt;</span> (record.<span class="property">value</span>)).<span class="title function_">flatMap</span>(<span class="function"><span class="params">x</span> =&gt;</span> &#123;</span><br><span class="line">      x.<span class="title function_">split</span>(<span class="string">&quot;,&quot;</span>)</span><br><span class="line">    &#125;).<span class="title function_">map</span>(<span class="function"><span class="params">word</span> =&gt;</span> &#123;</span><br><span class="line">      (word, <span class="number">1</span>)</span><br><span class="line">    &#125;).<span class="title function_">reduceByKey</span>(_ + _)</span><br><span class="line"></span><br><span class="line">    value.<span class="title function_">foreachRDD</span>(<span class="function"><span class="params">rdd</span>=&gt;</span>&#123;</span><br><span class="line">      val spark = <span class="title class_">SparkSession</span>.<span class="title function_">builder</span>().<span class="title function_">config</span>(rdd.<span class="property">sparkContext</span>.<span class="property">getConf</span>).<span class="title function_">getOrCreate</span>()</span><br><span class="line">      <span class="keyword">import</span> spark.<span class="property">implicits</span>.<span class="property">_</span></span><br><span class="line">      val wordsDataFrame = rdd.<span class="title function_">toDF</span>(<span class="string">&quot;word&quot;</span>,<span class="string">&quot;cnt&quot;</span>)</span><br><span class="line">      val <span class="attr">srray</span>:<span class="title class_">Array</span>[<span class="title class_">String</span>] = <span class="title class_">Array</span>(<span class="string">&quot;append&quot;</span>,<span class="string">&quot;jdbc:mysql://bigdata2:3306/bigdata&quot;</span>,<span class="string">&quot;root&quot;</span>,<span class="string">&quot;liuzihan010616&quot;</span>,<span class="string">&quot;wc&quot;</span>,<span class="string">&quot;word&quot;</span>)</span><br><span class="line">      savefile.<span class="title function_">savetojdbc</span>(spark,wordsDataFrame,srray)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    example.<span class="title function_">start</span>()</span><br><span class="line">    example.<span class="title function_">awaitTermination</span>()</span><br><span class="line">  &#125;&#125;</span><br></pre></td></tr></table></figure><p>消费完之后如果重启从上次挂掉的位置继续消费</p><p>要设置</p><ul><li>enable.auto.commit</li><li>auto.offset.reset</li></ul><p>才可以从断掉的位置开始</p><p>解决：</p><ul><li>获取kafka offset</li><li>提交kafka offset</li></ul><p>获取kafka的offset信息</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">stream<span class="selector-class">.foreachRDD</span> &#123; rdd =&gt;</span><br><span class="line">  val offsetRanges = rdd<span class="selector-class">.asInstanceOf</span><span class="selector-attr">[HasOffsetRanges]</span><span class="selector-class">.offsetRanges</span></span><br><span class="line">  rdd<span class="selector-class">.foreachPartition</span> &#123; iter =&gt;</span><br><span class="line">    val o: OffsetRange = <span class="built_in">offsetRanges</span>(TaskContext<span class="selector-class">.get</span>.partitionId)</span><br><span class="line">    <span class="built_in">println</span>(rdd<span class="selector-class">.partitions</span>.size)</span><br><span class="line">    <span class="built_in">println</span>(s<span class="string">&quot;$&#123;o.topic&#125; $&#123;o.partition&#125; $&#123;o.fromOffset&#125; $&#123;o.untilOffset&#125;&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>关于offset信息的解释：只要最后两列数据一样就代表这个topic里的数据都消费完了</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">6</span><br><span class="line">dl2262 5 19 19</span><br><span class="line">dl2262 4 18 18</span><br><span class="line">dl2262 0 19 19</span><br><span class="line">dl2262 2 77 77</span><br><span class="line">dl2262 1 19 19</span><br><span class="line"><span class="section">dl2262 3 46 47</span></span><br><span class="line"><span class="section">-------------------------------------------</span></span><br><span class="line"><span class="section">Time: 1673939535000 ms</span></span><br><span class="line"><span class="section">-------------------------------------------</span></span><br><span class="line">bidhashdas</span><br><span class="line"></span><br><span class="line">6</span><br><span class="line">dl2262 4 18 18</span><br><span class="line">dl2262 3 47 47</span><br><span class="line">dl2262 0 19 19</span><br><span class="line">dl2262 5 19 19</span><br><span class="line">dl2262 2 77 77</span><br><span class="line">dl2262 1 19 19</span><br></pre></td></tr></table></figure><p>注意：这些操作是获取到数据之后立刻这样做，就可以获得offset信息</p><p>其他对数据的进行操作，可以在这个里面做</p><p>如下：</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">stream<span class="selector-class">.foreachRDD</span> &#123; rdd =&gt;</span><br><span class="line">  val offsetRanges = rdd<span class="selector-class">.asInstanceOf</span><span class="selector-attr">[HasOffsetRanges]</span><span class="selector-class">.offsetRanges</span></span><br><span class="line">  <span class="built_in">println</span>(rdd<span class="selector-class">.partitions</span>.size)</span><br><span class="line">  rdd<span class="selector-class">.foreachPartition</span> &#123; iter =&gt;</span><br><span class="line">    val o: OffsetRange = <span class="built_in">offsetRanges</span>(TaskContext<span class="selector-class">.get</span>.partitionId)</span><br><span class="line">    <span class="built_in">println</span>(s<span class="string">&quot;$&#123;o.topic&#125; $&#123;o.partition&#125; $&#123;o.fromOffset&#125; $&#123;o.untilOffset&#125;&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// wc</span></span><br><span class="line">  val spark = SparkSession<span class="selector-class">.builder</span>()<span class="selector-class">.config</span>(rdd<span class="selector-class">.sparkContext</span>.getConf)<span class="selector-class">.getOrCreate</span>()</span><br><span class="line">  import spark<span class="selector-class">.implicits</span>._</span><br><span class="line"></span><br><span class="line">  val wordsDataFrame = rdd<span class="selector-class">.map</span>(_.value)<span class="selector-class">.flatMap</span>(_<span class="selector-class">.split</span>(<span class="string">&quot;,&quot;</span>))<span class="selector-class">.map</span>((_, <span class="number">1</span>))<span class="selector-class">.reduceByKey</span>(_ + _)<span class="selector-class">.toDF</span>(<span class="string">&quot;word&quot;</span>,<span class="string">&quot;cnt&quot;</span>)</span><br><span class="line">  val srray:Array<span class="selector-attr">[String]</span> = <span class="built_in">Array</span>(<span class="string">&quot;append&quot;</span>,<span class="string">&quot;jdbc:mysql://bigdata2:3306/bigdata&quot;</span>,<span class="string">&quot;root&quot;</span>,<span class="string">&quot;liuzihan010616&quot;</span>,<span class="string">&quot;wc&quot;</span>,<span class="string">&quot;word&quot;</span>)</span><br><span class="line">  savefile<span class="selector-class">.savetojdbc</span>(spark,wordsDataFrame,srray)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 存储offset</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 提交offset</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>接下来，我们要进行提交offset</p><p>在提交offset之前</p><p>我们要存储offset</p><p>spark流处理 默认的就是至少一次</p><p>存储offfset</p><ul><li>checkpoints 不能用</li><li>kafka本身 简单高效 -》消费语义-》至少一次&#x2F;最多一次 ：但是最多一次我们不用 -》因为不支持事务 -》 无法支持精准一次</li><li>可以使用支持事务的存储结构进行精准一次的交付语义</li></ul><p>kafka本身 ： 他存储的offset信息是存储在kafka的一共特殊的offset里比如_customer_offsets</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">stream.asInstanceOf<span class="literal">[C<span class="identifier">anCommitOffsets</span>]</span>.commit<span class="constructor">Async(<span class="params">offsetRanges</span>)</span></span><br><span class="line">-------------------------------------------整体代码</span><br><span class="line">package sparkstreaming</span><br><span class="line">import org.apache.spark.sql.SparkSession</span><br><span class="line">import tool._</span><br><span class="line">import org.apache.kafka.clients.consumer.ConsumerRecord</span><br><span class="line">import org.apache.kafka.common.serialization.StringDeserializer</span><br><span class="line">import org.apache.spark.TaskContext</span><br><span class="line">import org.apache.spark.streaming.kafka010._</span><br><span class="line">import org.apache.spark.streaming.kafka010.LocationStrategies.PreferConsistent</span><br><span class="line">import org.apache.spark.streaming.kafka010.ConsumerStrategies.Subscribe</span><br><span class="line"></span><br><span class="line"><span class="keyword">object</span> sparkstreaming2 &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">val</span> streamingcontext = <span class="keyword">new</span> streamingcontext</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">val</span> savefile = <span class="keyword">new</span> savefile</span><br><span class="line">  def main(args: Array<span class="literal">[S<span class="identifier">tring</span>]</span>): Unit = &#123;</span><br><span class="line">    <span class="keyword">val</span> kafkaParams = Map<span class="literal">[S<span class="identifier">tring</span>, O<span class="identifier">bject</span>]</span>(</span><br><span class="line">      <span class="string">&quot;bootstrap.servers&quot;</span> -&gt; <span class="string">&quot;bigdata3:9092,bigdata4:9092,bigdata5:9092&quot;</span>, <span class="comment">// kafka地址</span></span><br><span class="line">      <span class="string">&quot;key.deserializer&quot;</span> -&gt; classOf<span class="literal">[S<span class="identifier">tringDeserializer</span>]</span>, <span class="comment">// 反序列化</span></span><br><span class="line">      <span class="string">&quot;value.deserializer&quot;</span> -&gt; classOf<span class="literal">[S<span class="identifier">tringDeserializer</span>]</span>, <span class="comment">// 反序列化</span></span><br><span class="line">      <span class="string">&quot;group.id&quot;</span> -&gt; <span class="string">&quot;dl2262-1&quot;</span>, <span class="comment">// 指定消费者组</span></span><br><span class="line">      <span class="string">&quot;auto.offset.reset&quot;</span> -&gt; <span class="string">&quot;latest&quot;</span>, <span class="comment">// 从什么地方开始消费</span></span><br><span class="line">      <span class="string">&quot;enable.auto.commit&quot;</span> -&gt; (<span class="literal">false</span>: java.lang.Boolean) <span class="comment">// offset的提交 是不是自动提交</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> example = streamingcontext.getstreamcotext<span class="literal">()</span></span><br><span class="line">    <span class="keyword">val</span> topics = <span class="constructor">Array(<span class="string">&quot;dl2262&quot;</span>)</span></span><br><span class="line">    <span class="keyword">val</span> stream = <span class="module-access"><span class="module"><span class="identifier">KafkaUtils</span>.</span></span>createDirectStream<span class="literal">[S<span class="identifier">tring</span>, S<span class="identifier">tring</span>]</span>(</span><br><span class="line">      example,</span><br><span class="line">      PreferConsistent, <span class="comment">// 数据存储策略 Kafka数据均匀分在各个exector上，一共有三种</span></span><br><span class="line">      Subscribe<span class="literal">[S<span class="identifier">tring</span>, S<span class="identifier">tring</span>]</span>(topics, kafkaParams) <span class="comment">// 固定写法</span></span><br><span class="line">    )</span><br><span class="line">    <span class="comment">// 获取offset信息</span></span><br><span class="line">    stream.foreachRDD &#123;<span class="function"> <span class="params">rdd</span> =&gt;</span></span><br><span class="line">      <span class="keyword">val</span> offsetRanges = rdd.asInstanceOf<span class="literal">[H<span class="identifier">asOffsetRanges</span>]</span>.offsetRanges</span><br><span class="line">      println(rdd.partitions.size)</span><br><span class="line">      rdd.foreachPartition &#123;<span class="function"> <span class="params">iter</span> =&gt;</span></span><br><span class="line">        <span class="keyword">val</span> o: OffsetRange = offset<span class="constructor">Ranges(TaskContext.<span class="params">get</span>.<span class="params">partitionId</span>)</span></span><br><span class="line">        println(s<span class="string">&quot;$&#123;o.topic&#125; $&#123;o.partition&#125; $&#123;o.fromOffset&#125; $&#123;o.untilOffset&#125;&quot;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// wc</span></span><br><span class="line">      <span class="keyword">val</span> spark = <span class="module-access"><span class="module"><span class="identifier">SparkSession</span>.</span></span>builder<span class="literal">()</span>.config(rdd.sparkContext.getConf).get<span class="constructor">OrCreate()</span></span><br><span class="line">      import spark.implicits._</span><br><span class="line"></span><br><span class="line">      <span class="keyword">val</span> wordsDataFrame = rdd.map(<span class="module-access"><span class="module"><span class="identifier">_</span>.</span></span>value).flat<span class="constructor">Map(<span class="params">_</span>.<span class="params">split</span>(<span class="string">&quot;,&quot;</span>)</span>).map((_, <span class="number">1</span>)).reduce<span class="constructor">ByKey(<span class="params">_</span> + <span class="params">_</span>)</span>.<span class="keyword">to</span><span class="constructor">DF(<span class="string">&quot;word&quot;</span>,<span class="string">&quot;cnt&quot;</span>)</span></span><br><span class="line">      <span class="keyword">val</span> srray:Array<span class="literal">[S<span class="identifier">tring</span>]</span> = <span class="constructor">Array(<span class="string">&quot;append&quot;</span>,<span class="string">&quot;jdbc:mysql://bigdata2:3306/bigdata&quot;</span>,<span class="string">&quot;root&quot;</span>,<span class="string">&quot;liuzihan010616&quot;</span>,<span class="string">&quot;wc&quot;</span>,<span class="string">&quot;word&quot;</span>)</span></span><br><span class="line">      savefile.savetojdbc(spark,wordsDataFrame,srray)</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 存储offset和提交offset</span></span><br><span class="line">      stream.asInstanceOf<span class="literal">[C<span class="identifier">anCommitOffsets</span>]</span>.commit<span class="constructor">Async(<span class="params">offsetRanges</span>)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    example.start<span class="literal">()</span></span><br><span class="line">    example.await<span class="constructor">Termination()</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>其他数据源：官方的</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// The details depend on your data store, but the general idea looks like this</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// begin from the offsets committed to the database</span></span><br><span class="line">val fromOffsets = selectOffsetsFromYourDatabase<span class="selector-class">.map</span> &#123; resultSet =&gt;</span><br><span class="line">  new <span class="built_in">TopicPartition</span>(resultSet<span class="selector-class">.string</span>(<span class="string">&quot;topic&quot;</span>), resultSet<span class="selector-class">.int</span>(<span class="string">&quot;partition&quot;</span>)) -&gt; resultSet<span class="selector-class">.long</span>(<span class="string">&quot;offset&quot;</span>)</span><br><span class="line">&#125;<span class="selector-class">.toMap</span></span><br><span class="line"></span><br><span class="line">val stream = KafkaUtils<span class="selector-class">.createDirectStream</span><span class="selector-attr">[String, String]</span>(</span><br><span class="line">  streamingContext,</span><br><span class="line">  PreferConsistent,</span><br><span class="line">  Assign<span class="selector-attr">[String, String]</span>(fromOffsets<span class="selector-class">.keys</span><span class="selector-class">.toList</span>, kafkaParams, fromOffsets)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">stream<span class="selector-class">.foreachRDD</span> &#123; rdd =&gt;</span><br><span class="line">  val offsetRanges = rdd<span class="selector-class">.asInstanceOf</span><span class="selector-attr">[HasOffsetRanges]</span><span class="selector-class">.offsetRanges</span></span><br><span class="line"></span><br><span class="line">  val results = <span class="built_in">yourCalculation</span>(rdd)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// begin your transaction</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// update results</span></span><br><span class="line">  <span class="comment">// update offsets where the end of existing offsets matches the beginning of this batch of offsets</span></span><br><span class="line">  <span class="comment">// assert that offsets were updated correctly</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// end your transaction</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>SSL的一些配置</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">val kafkaParams = Map[<span class="type">String</span>, Object](</span><br><span class="line">  <span class="comment">// the usual params, make sure to change the port in bootstrap.servers if 9092 is not TLS</span></span><br><span class="line">  <span class="string">&quot;security.protocol&quot;</span> <span class="punctuation">-&gt;</span> <span class="string">&quot;SSL&quot;</span>,</span><br><span class="line">  <span class="string">&quot;ssl.truststore.location&quot;</span> <span class="punctuation">-&gt;</span> <span class="string">&quot;/some-directory/kafka.client.truststore.jks&quot;</span>,</span><br><span class="line">  <span class="string">&quot;ssl.truststore.password&quot;</span> <span class="punctuation">-&gt;</span> <span class="string">&quot;test1234&quot;</span>,</span><br><span class="line">  <span class="string">&quot;ssl.keystore.location&quot;</span> <span class="punctuation">-&gt;</span> <span class="string">&quot;/some-directory/kafka.client.keystore.jks&quot;</span>,</span><br><span class="line">  <span class="string">&quot;ssl.keystore.password&quot;</span> <span class="punctuation">-&gt;</span> <span class="string">&quot;test1234&quot;</span>,</span><br><span class="line">  <span class="string">&quot;ssl.key.password&quot;</span> <span class="punctuation">-&gt;</span> <span class="string">&quot;test1234&quot;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>]]></content:encoded>
      
      
      <category domain="http://zihang.fun/categories/%E6%97%A5%E5%BF%97/">日志</category>
      
      
      <category domain="http://zihang.fun/tags/spark/">spark</category>
      
      
      <comments>http://zihang.fun/2023/01/16/1-16/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>sparksql-3</title>
      <link>http://zihang.fun/2023/01/13/1-13/</link>
      <guid>http://zihang.fun/2023/01/13/1-13/</guid>
      <pubDate>Fri, 13 Jan 2023 00:09:52 GMT</pubDate>
      
        
        
      <description>&lt;h1 id=&quot;案例：业务数据-日志数据&quot;&gt;&lt;a href=&quot;#案例：业务数据-日志数据&quot; class=&quot;headerlink&quot; title=&quot;案例：业务数据 + 日志数据&quot;&gt;&lt;/a&gt;案例：业务数据 + 日志数据&lt;/h1&gt;&lt;p&gt;业务数据 在mysql里 &amp;#x3D;》&lt;/p&gt;
&lt;</description>
        
      
      
      
      <content:encoded><![CDATA[<h1 id="案例：业务数据-日志数据"><a href="#案例：业务数据-日志数据" class="headerlink" title="案例：业务数据 + 日志数据"></a>案例：业务数据 + 日志数据</h1><p>业务数据 在mysql里 &#x3D;》</p><ul><li>city_info</li><li>user_info</li></ul><p>日志数据 在hive里 &#x3D;》</p><ul><li>user_click</li></ul><p>思路 &#x3D;》 先用代码把数据统计到df中对df进行操作</p><h3 id="代码如下："><a href="#代码如下：" class="headerlink" title="代码如下："></a>代码如下：</h3><figure class="highlight pony"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">package sparkfirst</span><br><span class="line"></span><br><span class="line">import org.apache.spark.sql.<span class="type">SparkSession</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">object</span> xiangmu1 &#123;</span><br><span class="line">  def main(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="meta">val</span> spark = <span class="type">SparkSession</span>.builder().appName(<span class="string">&quot;Sparksql01&quot;</span>).master(<span class="string">&quot;local[4]&quot;</span>).enableHiveSupport().getOrCreate()</span><br><span class="line">    import spark.implicits._</span><br><span class="line">    <span class="meta">val</span> city_info = spark.read.format(<span class="string">&quot;jdbc&quot;</span>)</span><br><span class="line">      .options(<span class="type">Map</span>(<span class="string">&quot;url&quot;</span>-&gt;args(<span class="number">0</span>),<span class="string">&quot;dbtable&quot;</span>-&gt;args(<span class="number">3</span>),<span class="string">&quot;user&quot;</span>-&gt;args(<span class="number">1</span>),<span class="string">&quot;password&quot;</span>-&gt;args(<span class="number">2</span>),<span class="string">&quot;driver&quot;</span>-&gt;<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>)).load()</span><br><span class="line"></span><br><span class="line">    <span class="meta">val</span> user_info = spark.sql(</span><br><span class="line">      <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        |select * from bigdata.product_info</span></span><br><span class="line"><span class="string">        |&quot;&quot;&quot;</span>.stripMargin)</span><br><span class="line"></span><br><span class="line"><span class="comment">//    city_info.show()</span></span><br><span class="line"><span class="comment">//    user_info.show()</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">val</span> product_info = spark.read.textFile(<span class="string">&quot;hdfs://bigdata3:9000/data/user_click.txt&quot;</span>)</span><br><span class="line"><span class="comment">//    product_info.show(false)</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">val</span> userlog = product_info.map(line =&gt; &#123;</span><br><span class="line">      <span class="meta">val</span> strings = line.split(<span class="string">&quot;,&quot;</span>)</span><br><span class="line">      <span class="meta">val</span> userid = strings(<span class="number">0</span>)</span><br><span class="line">      <span class="meta">val</span> sessionid = strings(<span class="number">1</span>)</span><br><span class="line">      <span class="meta">val</span> dt = strings(<span class="number">2</span>)</span><br><span class="line">      <span class="meta">val</span> cityid = strings(<span class="number">3</span>)</span><br><span class="line">      <span class="meta">val</span> shopid = strings(<span class="number">4</span>)</span><br><span class="line">      (userid, sessionid, dt, cityid, shopid)</span><br><span class="line">    &#125;).toDF(<span class="string">&quot;userid&quot;</span>, <span class="string">&quot;sessionid&quot;</span>, <span class="string">&quot;dt&quot;</span>, <span class="string">&quot;cityid&quot;</span>, <span class="string">&quot;shopid&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//    userlog.show(false)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//----------------------------------------------------------------</span></span><br><span class="line">    city_info.createOrReplaceTempView(<span class="string">&quot;city_info&quot;</span>)</span><br><span class="line">    userlog.createOrReplaceTempView(<span class="string">&quot;user_log&quot;</span>)</span><br><span class="line">    user_info.createOrReplaceTempView(<span class="string">&quot;product_info&quot;</span>)</span><br><span class="line">    <span class="comment">//--------------------------------------------------------------</span></span><br><span class="line">    spark.sql(</span><br><span class="line">      <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        |drop table if exists bigdata.tmp</span></span><br><span class="line"><span class="string">        |&quot;&quot;&quot;</span>.stripMargin)</span><br><span class="line">    spark.sql(</span><br><span class="line">      <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        |</span></span><br><span class="line"><span class="string">        |</span></span><br><span class="line"><span class="string">        |create table bigdata.tmp as</span></span><br><span class="line"><span class="string">        |select</span></span><br><span class="line"><span class="string">        |*</span></span><br><span class="line"><span class="string">        |from (</span></span><br><span class="line"><span class="string">        |    select * from city_info left join user_log on city_info.city_id = user_log.cityid left join product_info  on user_log.shopid = product_info.product_id</span></span><br><span class="line"><span class="string">        |)</span></span><br><span class="line"><span class="string">        |&quot;&quot;&quot;</span>.stripMargin)</span><br><span class="line">    spark.sql(</span><br><span class="line">      <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        |drop table if exists bigdata.sparkfinish</span></span><br><span class="line"><span class="string">        |&quot;&quot;&quot;</span>.stripMargin)</span><br><span class="line">    spark.sql(</span><br><span class="line">      <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        |create table bigdata.sparkfinish as</span></span><br><span class="line"><span class="string">        |select</span></span><br><span class="line"><span class="string">        |*</span></span><br><span class="line"><span class="string">        |from(</span></span><br><span class="line"><span class="string">        |select</span></span><br><span class="line"><span class="string">        |area,</span></span><br><span class="line"><span class="string">        |product_name,</span></span><br><span class="line"><span class="string">        |rank() over(partition by area order by cnt) as rk</span></span><br><span class="line"><span class="string">        |from (</span></span><br><span class="line"><span class="string">        |select</span></span><br><span class="line"><span class="string">        |area,</span></span><br><span class="line"><span class="string">        |product_name,</span></span><br><span class="line"><span class="string">        |count(1) as cnt</span></span><br><span class="line"><span class="string">        |from bigdata.tmp</span></span><br><span class="line"><span class="string">        |group by area,product_name</span></span><br><span class="line"><span class="string">        |)</span></span><br><span class="line"><span class="string">        |)where rk &lt; 3;</span></span><br><span class="line"><span class="string">        |&quot;&quot;&quot;</span>.stripMargin)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="然后我们进行打包上传"><a href="#然后我们进行打包上传" class="headerlink" title="然后我们进行打包上传"></a>然后我们进行打包上传</h3><p>进行打包之前，我们要把我们的</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> spark = <span class="module-access"><span class="module"><span class="identifier">SparkSession</span>.</span></span>builder<span class="literal">()</span>.app<span class="constructor">Name(<span class="string">&quot;Sparksql01&quot;</span>)</span>.master(<span class="string">&quot;local[4]&quot;</span>).enable<span class="constructor">HiveSupport()</span>.get<span class="constructor">OrCreate()</span></span><br></pre></td></tr></table></figure><p>给注释掉，因为我们用spark-submit的时候会通过命令的方式指定他</p><p>打包上传之后我们可以进行调用脚本spark-submit脚本</p><p>但是这里还是有分歧的，因为spark-submit部署的时候一般是部署在yarn的要分几种模式的简单介绍一下两种模式</p><p>Cluster：</p><ul><li>提交作业  client作业提交  client就可以关闭了 对spark作业是没有影响的 而且运行的时候</li><li>driver  是在集群机器里的</li><li>上yarn上看日志</li></ul><p>client：</p><ul><li>提交作业  client作业提交 如果client关闭了 driver process 挂了  对spark作业有影响的</li><li>是在 client机器里的</li><li>可以直接看见日志的</li></ul><p>以下代码分别写一下</p><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">spark-submit <span class="string">\</span></span><br><span class="line">--master yarn <span class="string">\</span></span><br><span class="line">--deploy-mode client <span class="string">\</span></span><br><span class="line">--name userlog <span class="string">\</span></span><br><span class="line">--executor-memory <span class="number">1g</span> <span class="string">\</span></span><br><span class="line">--num-executors <span class="number">1</span> <span class="string">\</span></span><br><span class="line">--executor-cores <span class="number">1</span> <span class="string">\</span></span><br><span class="line">--<span class="keyword">class</span> <span class="title class_">sparkfirst</span>.xiangmu1 <span class="string">\</span></span><br><span class="line">/home/hadoop/project/jar/bigdatajava-<span class="number">1.0</span>-SNAPSHOT.jar <span class="string">\</span></span><br><span class="line"><span class="string">&quot;jdbc:mysql://bigdata2:3306/bigdata&quot;</span> root liuzihan010616 city_info</span><br><span class="line">--------------------------------------------------------cluster</span><br><span class="line">spark-submit <span class="string">\</span></span><br><span class="line">--master yarn <span class="string">\</span></span><br><span class="line">--deploy-mode cluster <span class="string">\</span></span><br><span class="line">--name userlog <span class="string">\</span></span><br><span class="line">--executor-memory <span class="number">1g</span> <span class="string">\</span></span><br><span class="line">--num-executors <span class="number">2</span> <span class="string">\</span></span><br><span class="line">--executor-cores <span class="number">1</span> <span class="string">\</span></span><br><span class="line">--<span class="keyword">class</span> <span class="title class_">sparkfirst</span>.xiangmu1 <span class="string">\</span></span><br><span class="line">/home/hadoop/project/jar/bigdatajava-<span class="number">1.0</span>-SNAPSHOT.jar <span class="string">\</span></span><br><span class="line"><span class="string">&quot;jdbc:mysql://bigdata2:3306/bigdata&quot;</span> root liuzihan010616 city_info</span><br><span class="line">-------------------------------------------------------------- 以下是正常的因为我把mysql的driver加入到spark的jars文件夹里了，所以上面不用指定jar</span><br><span class="line">spark-submit <span class="string">\</span></span><br><span class="line">--master yarn <span class="string">\</span></span><br><span class="line">--deploy-mode client  <span class="string">\</span></span><br><span class="line">--name userlog <span class="string">\</span></span><br><span class="line">--executor-memory <span class="number">1g</span> <span class="string">\</span></span><br><span class="line">--num-executors <span class="number">1</span> <span class="string">\</span></span><br><span class="line">--executor-cores <span class="number">1</span> <span class="string">\</span></span><br><span class="line">--jars /home/hadoop/software/mysql-connector-java-<span class="number">5.1</span>.<span class="number">28.jar</span> <span class="string">\</span></span><br><span class="line">--driver-<span class="keyword">class</span>-path /home/hadoop/software/mysql-connector-java-<span class="number">5.1</span>.<span class="number">28.jar</span> <span class="string">\</span></span><br><span class="line">--driver-library-path /home/hadoop/software/mysql-connector-java-<span class="number">5.1</span>.<span class="number">28.jar</span> <span class="string">\</span></span><br><span class="line">--<span class="keyword">class</span> <span class="title class_">sparkfirst</span>.xiangmu1 <span class="string">\</span></span><br><span class="line">/home/hadoop/project/jar/bigdatajava-<span class="number">1.0</span>-SNAPSHOT.jar <span class="string">\</span></span><br><span class="line"><span class="string">&quot;jdbc:mysql://bigdata2:3306/bigdata&quot;</span> root liuzihan010616 city_info user_info</span><br><span class="line">--------------------------------------------------------------------------------------------------</span><br><span class="line">spark-submit <span class="string">\</span></span><br><span class="line">--master yarn <span class="string">\</span></span><br><span class="line">--deploy-mode cluster <span class="string">\</span></span><br><span class="line">--name userlog <span class="string">\</span></span><br><span class="line">--executor-memory <span class="number">1g</span> <span class="string">\</span></span><br><span class="line">--num-executors <span class="number">1</span> <span class="string">\</span></span><br><span class="line">--executor-cores <span class="number">1</span> <span class="string">\</span></span><br><span class="line">--jars /home/hadoop/software/mysql-connector-java-<span class="number">5.1</span>.<span class="number">28.jar</span> <span class="string">\</span></span><br><span class="line">--driver-<span class="keyword">class</span>-path /home/hadoop/software/mysql-connector-java-<span class="number">5.1</span>.<span class="number">28.jar</span> <span class="string">\</span></span><br><span class="line">--driver-library-path /home/hadoop/software/mysql-connector-java-<span class="number">5.1</span>.<span class="number">28.jar</span> <span class="string">\</span></span><br><span class="line">--<span class="keyword">class</span> <span class="title class_">sparkfirst</span>.xiangmu1 <span class="string">\</span></span><br><span class="line">/home/hadoop/project/jar/bigdatajava-<span class="number">1.0</span>-SNAPSHOT.jar <span class="string">\</span></span><br><span class="line"><span class="string">&quot;jdbc:mysql://bigdata2:3306/bigdata&quot;</span> root liuzihan010616 city_info user_info</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="几种加入driver的方法是"><a href="#几种加入driver的方法是" class="headerlink" title="几种加入driver的方法是"></a>几种加入driver的方法是</h3><p>在执行命令的时候加入命令：如上</p><p>直接加到jars里</p><p>这里比较不推荐的就是第二种，因为怕和spark本身的包产生冲突</p><h3 id="执行流程"><a href="#执行流程" class="headerlink" title="执行流程"></a>执行流程</h3><p>spark到yarn的执行流程和hadoop基本一样，除了spark的持久化操作要用到catche，其余都一样</p><p>driver &#x3D;》manager</p><p>excuter &#x3D;》 container</p><h3 id="catlog"><a href="#catlog" class="headerlink" title="catlog"></a>catlog</h3><p>hive元数据 在mysql里</p><p>spark 访问hive元数据 通过jdbc</p><p>spark提供了个catlog</p><p>直接调用catlog可以直接拿到hive的元数据的功能</p><p>比如制作大数据分析平台</p><p>获取catlog</p><p><code>sparksesson.catlog</code></p><p>然后里面有很多的方法可以在idea里通过ctrl + f12 查看方法</p><p>冷数据可能放在cos 或者 oss上</p><h3 id="udf"><a href="#udf" class="headerlink" title="udf"></a>udf</h3><ul><li>代码的方式定义udf</li><li>hive的udf可以在spark可以直接用</li></ul><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">idea里定义udf</span><br><span class="line">---------------------------------------</span><br><span class="line">先导包</span><br><span class="line">import org<span class="selector-class">.apache</span><span class="selector-class">.spark</span><span class="selector-class">.sql</span><span class="selector-class">.functions</span><span class="selector-class">.udf</span></span><br><span class="line">然后</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">val spark = SparkSession</span><br><span class="line">  <span class="selector-class">.builder</span>()</span><br><span class="line">  <span class="selector-class">.appName</span>(<span class="string">&quot;Spark SQL UDF scalar example&quot;</span>)</span><br><span class="line">  <span class="selector-class">.getOrCreate</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// Define and register a zero-argument non-deterministic UDF</span></span><br><span class="line"><span class="comment">// UDF is deterministic by default, i.e. produces the same result for the same input.</span></span><br><span class="line">val random = <span class="built_in">udf</span>(() =&gt; Math<span class="selector-class">.random</span>())</span><br><span class="line">spark<span class="selector-class">.udf</span><span class="selector-class">.register</span>(<span class="string">&quot;random&quot;</span>, random<span class="selector-class">.asNondeterministic</span>())</span><br><span class="line">spark<span class="selector-class">.sql</span>(<span class="string">&quot;SELECT random()&quot;</span>)<span class="selector-class">.show</span>()</span><br><span class="line"><span class="comment">// +-------+</span></span><br><span class="line"><span class="comment">// |UDF()  |</span></span><br><span class="line"><span class="comment">// +-------+</span></span><br><span class="line"><span class="comment">// |xxxxxxx|</span></span><br><span class="line"><span class="comment">// +-------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Define and register a one-argument UDF</span></span><br><span class="line">val plusOne = <span class="built_in">udf</span>((x: Int) =&gt; x + <span class="number">1</span>)</span><br><span class="line">spark<span class="selector-class">.udf</span><span class="selector-class">.register</span>(<span class="string">&quot;plusOne&quot;</span>, plusOne)</span><br><span class="line">spark<span class="selector-class">.sql</span>(<span class="string">&quot;SELECT plusOne(5)&quot;</span>)<span class="selector-class">.show</span>()</span><br><span class="line"><span class="comment">// +------+</span></span><br><span class="line"><span class="comment">// |UDF(5)|</span></span><br><span class="line"><span class="comment">// +------+</span></span><br><span class="line"><span class="comment">// |     6|</span></span><br><span class="line"><span class="comment">// +------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Define a two-argument UDF and register it with Spark in one step</span></span><br><span class="line">spark<span class="selector-class">.udf</span><span class="selector-class">.register</span>(<span class="string">&quot;strLenScala&quot;</span>, (_: String)<span class="selector-class">.length</span> + (_: Int))</span><br><span class="line">spark<span class="selector-class">.sql</span>(<span class="string">&quot;SELECT strLenScala(&#x27;test&#x27;, 1)&quot;</span>)<span class="selector-class">.show</span>()</span><br><span class="line"><span class="comment">// +--------------------+</span></span><br><span class="line"><span class="comment">// |strLenScala(test, 1)|</span></span><br><span class="line"><span class="comment">// +--------------------+</span></span><br><span class="line"><span class="comment">// |                   5|</span></span><br><span class="line"><span class="comment">// +--------------------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// UDF in a WHERE clause</span></span><br><span class="line">spark<span class="selector-class">.udf</span><span class="selector-class">.register</span>(<span class="string">&quot;oneArgFilter&quot;</span>, (n: Int) =&gt; &#123; n &gt; <span class="number">5</span> &#125;)</span><br><span class="line">spark<span class="selector-class">.range</span>(<span class="number">1</span>, <span class="number">10</span>)<span class="selector-class">.createOrReplaceTempView</span>(<span class="string">&quot;test&quot;</span>)</span><br><span class="line">spark<span class="selector-class">.sql</span>(<span class="string">&quot;SELECT * FROM test WHERE oneArgFilter(id)&quot;</span>)<span class="selector-class">.show</span>()</span><br><span class="line"><span class="comment">// +---+</span></span><br><span class="line"><span class="comment">// | id|</span></span><br><span class="line"><span class="comment">// +---+</span></span><br><span class="line"><span class="comment">// |  6|</span></span><br><span class="line"><span class="comment">// |  7|</span></span><br><span class="line"><span class="comment">// |  8|</span></span><br><span class="line"><span class="comment">// |  9|</span></span><br><span class="line"><span class="comment">// +---+</span></span><br></pre></td></tr></table></figure>]]></content:encoded>
      
      
      <category domain="http://zihang.fun/categories/%E6%97%A5%E5%BF%97/">日志</category>
      
      
      <category domain="http://zihang.fun/tags/spark/">spark</category>
      
      
      <comments>http://zihang.fun/2023/01/13/1-13/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>sparksql-2</title>
      <link>http://zihang.fun/2023/01/11/1-11/</link>
      <guid>http://zihang.fun/2023/01/11/1-11/</guid>
      <pubDate>Wed, 11 Jan 2023 00:53:32 GMT</pubDate>
      
        
        
      <description>&lt;h1 id=&quot;构建df&quot;&gt;&lt;a href=&quot;#构建df&quot; class=&quot;headerlink&quot; title=&quot;构建df&quot;&gt;&lt;/a&gt;构建df&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;rdd&lt;/li&gt;
&lt;li&gt;hive&lt;/li&gt;
&lt;li&gt;外部数据源&lt;ul&gt;
&lt;li&gt;json,csv,jdbc&amp;#</description>
        
      
      
      
      <content:encoded><![CDATA[<h1 id="构建df"><a href="#构建df" class="headerlink" title="构建df"></a>构建df</h1><ul><li>rdd</li><li>hive</li><li>外部数据源<ul><li>json,csv,jdbc&#x2F;odbc</li></ul></li></ul><h1 id="加载外部数据源"><a href="#加载外部数据源" class="headerlink" title="加载外部数据源"></a>加载外部数据源</h1><h2 id="api简介"><a href="#api简介" class="headerlink" title="api简介"></a>api简介</h2><h3 id="TEXT"><a href="#TEXT" class="headerlink" title="TEXT"></a>TEXT</h3><table><thead><tr><th><strong>Property Name</strong></th><th><strong>Default</strong></th><th><strong>Meaning</strong></th><th><strong>Scope</strong></th></tr></thead><tbody><tr><td>wholetext</td><td>false</td><td>If true, read each file from input path(s) as a single row.</td><td>read</td></tr><tr><td>lineSep</td><td><code>\r</code>, <code>\r\n</code>, <code>\n</code> (for reading), <code>\n</code> (for writing)</td><td>Defines the line separator that should be used for reading or writing.</td><td>read&#x2F;write</td></tr><tr><td>compression</td><td>(none)</td><td>Compression codec to use when saving to file.<br />This can be one of the known case-insensitive shorten names<br /> (none, bzip2, gzip, lz4, snappy and deflate).</td><td>write</td></tr></tbody></table><h3 id="json"><a href="#json" class="headerlink" title="json"></a>json</h3><table><thead><tr><th><strong>Property Name</strong></th><th><strong>Default</strong></th><th><strong>Meaning</strong></th><th><strong>Scope</strong></th></tr></thead><tbody><tr><td><code>timeZone</code></td><td>(value of <code>spark.sql.session.timeZone</code> configuration)</td><td>Sets the string that indicates a time zone ID to be used to format timestamps in the JSON datasources or partition values. The following formats of <code>timeZone</code> are supported:&#96;&#96;* Region-based zone ID: <br />It should have the form ‘area&#x2F;city’,<br /> such as ‘America&#x2F;Los_Angeles’.* Zone offset: It should be in the format ‘(+</td><td>-)HH:mm’, for example ‘-08:00’ or ‘+01:00’. Also ‘UTC’ and ‘Z’ are supported as aliases of ‘+00:00’.Other short names like ‘CST’ are not recommended to use because they can be ambiguous.</td></tr><tr><td><code>primitivesAsString</code></td><td><code>false</code></td><td>Infers all primitive values as a string type.</td><td>read</td></tr><tr><td><code>prefersDecimal</code></td><td><code>false</code></td><td>Infers all floating-point values as a decimal type.<br />If the values do not fit in decimal, then it infers them as doubles.</td><td>read</td></tr><tr><td><code>allowComments</code></td><td><code>false</code></td><td>Ignores Java&#x2F;C++ style comment in JSON records.</td><td>read</td></tr><tr><td><code>allowUnquotedFieldNames</code></td><td><code>false</code></td><td>Allows unquoted JSON field names.</td><td>read</td></tr><tr><td><code>allowSingleQuotes</code></td><td><code>true</code></td><td>Allows single quotes in addition to double quotes.</td><td>read</td></tr><tr><td><code>allowNumericLeadingZero</code></td><td><code>false</code></td><td>Allows leading zeros in numbers (e.g. 00012).</td><td>read</td></tr><tr><td><code>allowBackslashEscapingAnyCharacter</code></td><td><code>false</code></td><td>Allows accepting quoting of all character using backslash quoting mechanism<br />.</td><td>read</td></tr><tr><td><code>mode</code></td><td><code>PERMISSIVE</code></td><td>Allows a mode for dealing with corrupt records during parsing.&#96;&#96;<em><code>PERMISSIVE</code>: when it meets a corrupted record, puts the malformed string into a field configured by <code>columnNameOfCorruptRecord</code>, and sets malformed fields to <code>null</code>. To keep corrupt records, an user can set a string type field named <code>columnNameOfCorruptRecord</code> in an user-defined schema. If a schema does not have the field, it drops corrupt records during parsing. When inferring a schema, it implicitly adds a <code>columnNameOfCorruptRecord</code> field in an output schema.</em> <code>DROPMALFORMED</code>: ignores the whole corrupted records. This mode is unsupported in the JSON built-in functions.* <code>FAILFAST</code>: throws an exception when it meets corrupted records.</td><td>read</td></tr><tr><td><code>columnNameOfCorruptRecord</code></td><td>(value of <code>spark.sql.columnNameOfCorruptRecord</code> configuration)</td><td>Allows renaming the new field having malformed string created by <code>PERMISSIVE</code> mode. This overrides spark.sql.columnNameOfCorruptRecord.</td><td>read</td></tr><tr><td><code>dateFormat</code></td><td><code>yyyy-MM-dd</code></td><td>Sets the string that indicates a date format. Custom date formats follow the formats at<a href="https://spark.apache.org/docs/latest/sql-ref-datetime-pattern.html">datetime pattern</a>. This applies to date type.</td><td>read&#x2F;write</td></tr><tr><td><code>timestampFormat</code></td><td><code>yyyy-MM-dd&#39;T&#39;HH:mm:ss[.SSS][XXX]</code></td><td>Sets the string that indicates a timestamp format. Custom date formats follow the formats at<a href="https://spark.apache.org/docs/latest/sql-ref-datetime-pattern.html">datetime pattern</a>. This applies to timestamp type.</td><td>read&#x2F;write</td></tr><tr><td><code>timestampNTZFormat</code></td><td>yyyy-MM-dd’T’HH:mm:ss[.SSS]</td><td>Sets the string that indicates a timestamp without timezone format. Custom date formats follow the formats at<a href="https://spark.apache.org/docs/latest/sql-ref-datetime-pattern.html">Datetime Patterns</a>. This applies to timestamp without timezone type, note that zone-offset and time-zone components are not supported when writing or reading this data type.</td><td>read&#x2F;write</td></tr><tr><td><code>multiLine</code></td><td><code>false</code></td><td>Parse one record, which may span multiple lines, per file. JSON built-in functions ignore this option.</td><td>read</td></tr><tr><td><code>allowUnquotedControlChars</code></td><td><code>false</code></td><td>Allows JSON Strings to contain unquoted control characters (ASCII characters with value less than 32, including tab and line feed characters) or not.</td><td>read</td></tr><tr><td><code>encoding</code></td><td>Detected automatically when <code>multiLine</code> is set to <code>true</code> (for reading), <code>UTF-8</code> (for writing)</td><td>For reading, allows to forcibly set one of standard basic or extended encoding for the JSON files. For example UTF-16BE, UTF-32LE. For writing, Specifies encoding (charset) of saved json files. JSON built-in functions ignore this option.</td><td>read&#x2F;write</td></tr><tr><td><code>lineSep</code></td><td><code>\r</code>, <code>\r\n</code>, <code>\n</code> (for reading), <code>\n</code> (for writing)</td><td>Defines the line separator that should be used for parsing. JSON built-in functions ignore this option.</td><td>read&#x2F;write</td></tr><tr><td><code>samplingRatio</code></td><td><code>1.0</code></td><td>Defines fraction of input JSON objects used for schema inferring.</td><td>read</td></tr><tr><td><code>dropFieldIfAllNull</code></td><td><code>false</code></td><td>Whether to ignore column of all null values or empty array&#x2F;struct during schema inference.</td><td>read</td></tr><tr><td><code>locale</code></td><td><code>en-US</code></td><td>Sets a locale as language tag in IETF BCP 47 format. For instance,<code>locale</code> is used while parsing dates and timestamps.</td><td>read</td></tr><tr><td><code>allowNonNumericNumbers</code></td><td><code>true</code></td><td>Allows JSON parser to recognize set of “Not-a-Number” (NaN) tokens as legal floating number values.&#96;&#96;<em><code>+INF</code>:<br /> for positive infinity, as well as alias of <code>+Infinity</code> and <code>Infinity</code>.</em> <code>-INF</code>: for negative infinity, alias <code>-Infinity</code>.* <code>NaN</code>: for other not-a-numbers, like result of division by zero.</td><td>read</td></tr><tr><td><code>compression</code></td><td>(none)</td><td>Compression codec to use when saving to file. This can be one of the known case-insensitive shorten names<br /> (none, bzip2, gzip, lz4, snappy and deflate). JSON built-in functions ignore this option.</td><td>write</td></tr><tr><td><code>ignoreNullFields</code></td><td>(value of <code>spark.sql.jsonGenerator.ignoreNullFields</code> configuration)</td><td>Whether to ignore null fields when generating JSON objects.</td><td>write</td></tr></tbody></table><h3 id="csv"><a href="#csv" class="headerlink" title="csv"></a>csv</h3><table><thead><tr><th><strong>Property Name</strong></th><th><strong>Default</strong></th><th><strong>Meaning</strong></th><th><strong>Scope</strong></th></tr></thead><tbody><tr><td><code>sep</code></td><td>,</td><td>Sets a separator for each field and value. This separator can be one or more characters.</td><td>read&#x2F;write</td></tr><tr><td><code>encoding</code></td><td>UTF-8</td><td>For reading, decodes the CSV files by the given encoding type. For writing, specifies encoding (charset) of saved CSV files. CSV built-in functions ignore this option.</td><td>read&#x2F;write</td></tr><tr><td><code>quote</code></td><td>“</td><td>Sets a single character used for escaping quoted values where the separator can be part of the value. For reading, if you would like to turn off quotations, you need to set not <code>null</code> but an empty string. For writing, if an empty string is set, it uses <code>u0000</code> (null character).</td><td>read&#x2F;write</td></tr><tr><td><code>quoteAll</code></td><td>false</td><td>A flag indicating whether all values should always be enclosed in quotes. Default is to only escape values containing a quote character.</td><td>write</td></tr><tr><td><code>escape</code></td><td>\</td><td>Sets a single character used for escaping quotes inside an already quoted value.</td><td>read&#x2F;write</td></tr><tr><td><code>escapeQuotes</code></td><td>true</td><td>A flag indicating whether values containing quotes should always be enclosed in quotes. Default is to escape all values containing a quote character.</td><td>write</td></tr><tr><td><code>comment</code></td><td></td><td>Sets a single character used for skipping lines beginning with this character. By default, it is disabled.</td><td>read</td></tr><tr><td><code>header</code></td><td>false</td><td>For reading, uses the first line as names of columns. For writing, writes the names of columns as the first line. Note that if the given path is a RDD of Strings, this header option will remove all lines same with the header if exists. CSV built-in functions ignore this option.</td><td>read&#x2F;write</td></tr><tr><td><code>inferSchema</code></td><td>false</td><td>Infers the input schema automatically from data. It requires one extra pass over the data. CSV built-in functions ignore this option.</td><td>read</td></tr><tr><td><code>enforceSchema</code></td><td>true</td><td>If it is set to <code>true</code>, the specified or inferred schema will be forcibly applied to datasource files, and headers in CSV files will be ignored. If the option is set to <code>false</code>, the schema will be validated against all headers in CSV files in the case when the <code>header</code> option is set to <code>true</code>. Field names in the schema and column names in CSV headers are checked by their positions taking into account <code>spark.sql.caseSensitive</code>. Though the default value is true, it is recommended to disable the <code>enforceSchema</code> option to avoid incorrect results. CSV built-in functions ignore this option.</td><td>read</td></tr><tr><td><code>ignoreLeadingWhiteSpace</code></td><td><code>false</code> (for reading), <code>true</code> (for writing)</td><td>A flag indicating whether or not leading whitespaces from values being read&#x2F;written should be skipped.</td><td>read&#x2F;write</td></tr><tr><td><code>ignoreTrailingWhiteSpace</code></td><td><code>false</code> (for reading), <code>true</code> (for writing)</td><td>A flag indicating whether or not trailing whitespaces from values being read&#x2F;written should be skipped.</td><td>read&#x2F;write</td></tr><tr><td><code>nullValue</code></td><td></td><td>Sets the string representation of a null value. Since 2.0.1, this <code>nullValue</code> param applies to all supported types including the string type.</td><td>read&#x2F;write</td></tr><tr><td><code>nanValue</code></td><td>NaN</td><td>Sets the string representation of a non-number value.</td><td>read</td></tr><tr><td><code>positiveInf</code></td><td>Inf</td><td>Sets the string representation of a positive infinity value.</td><td>read</td></tr><tr><td><code>negativeInf</code></td><td>-Inf</td><td>Sets the string representation of a negative infinity value.</td><td>read</td></tr><tr><td><code>dateFormat</code></td><td>yyyy-MM-dd</td><td>Sets the string that indicates a date format. Custom date formats follow the formats at<a href="https://spark.apache.org/docs/latest/sql-ref-datetime-pattern.html">Datetime Patterns</a>. This applies to date type.</td><td>read&#x2F;write</td></tr><tr><td><code>timestampFormat</code></td><td>yyyy-MM-dd’T’HH:mm:ss[.SSS][XXX]</td><td>Sets the string that indicates a timestamp format. Custom date formats follow the formats at<a href="https://spark.apache.org/docs/latest/sql-ref-datetime-pattern.html">Datetime Patterns</a>. This applies to timestamp type.</td><td>read&#x2F;write</td></tr><tr><td><code>timestampNTZFormat</code></td><td>yyyy-MM-dd’T’HH:mm:ss[.SSS]</td><td>Sets the string that indicates a timestamp without timezone format. Custom date formats follow the formats at<a href="https://spark.apache.org/docs/latest/sql-ref-datetime-pattern.html">Datetime Patterns</a>. This applies to timestamp without timezone type, note that zone-offset and time-zone components are not supported when writing or reading this data type.</td><td>read&#x2F;write</td></tr><tr><td><code>maxColumns</code></td><td>20480</td><td>Defines a hard limit of how many columns a record can have.</td><td>read</td></tr><tr><td><code>maxCharsPerColumn</code></td><td>-1</td><td>Defines the maximum number of characters allowed for any given value being read. By default, it is -1 meaning unlimited length</td><td>read</td></tr><tr><td><code>mode</code></td><td>PERMISSIVE</td><td>Allows a mode for dealing with corrupt records during parsing. It supports the following case-insensitive modes. Note that Spark tries to parse only required columns in CSV under column pruning. Therefore, corrupt records can be different based on required set of fields. This behavior can be controlled by <code>spark.sql.csv.parser.columnPruning.enabled</code> (enabled by default).&#96;&#96;* <code>PERMISSIVE</code>: when it meets a corrupted record, puts the malformed string into a field configured by <code>columnNameOfCorruptRecord</code>, and sets malformed fields to <code>null</code>. To keep corrupt records, an user can set a string type field named <code>columnNameOfCorruptRecord</code> in an user-defined schema. If a schema does not have the field, it drops corrupt records during parsing. A record with less&#x2F;more tokens than schema is not a corrupted record to CSV. When it meets a record having fewer tokens than the length of the schema, sets <code>null</code> to extra fields. When the record has more tokens than the length of the schema, it drops extra tokens.* <code>DROPMALFORMED</code>: ignores the whole corrupted records. This mode is unsupported in the CSV built-in functions.* <code>FAILFAST</code>: throws an exception when it meets corrupted records.</td><td>read</td></tr><tr><td><code>columnNameOfCorruptRecord</code></td><td>(value of <code>spark.sql.columnNameOfCorruptRecord</code> configuration)</td><td>Allows renaming the new field having malformed string created by <code>PERMISSIVE</code> mode. This overrides <code>spark.sql.columnNameOfCorruptRecord</code>.</td><td>read</td></tr><tr><td><code>multiLine</code></td><td>false</td><td>Parse one record, which may span multiple lines, per file. CSV built-in functions ignore this option.</td><td>read</td></tr><tr><td><code>charToEscapeQuoteEscaping</code></td><td><code>escape</code> or <code>\0</code></td><td>Sets a single character used for escaping the escape for the quote character. The default value is escape character when escape and quote characters are different,<code>\0</code> otherwise.</td><td>read&#x2F;write</td></tr><tr><td><code>samplingRatio</code></td><td>1.0</td><td>Defines fraction of rows used for schema inferring. CSV built-in functions ignore this option.</td><td>read</td></tr><tr><td><code>emptyValue</code></td><td>(for reading),<code>&quot;&quot;</code> (for writing)</td><td>Sets the string representation of an empty value.</td><td>read&#x2F;write</td></tr><tr><td><code>locale</code></td><td>en-US</td><td>Sets a locale as language tag in IETF BCP 47 format. For instance, this is used while parsing dates and timestamps.</td><td>read</td></tr><tr><td><code>lineSep</code></td><td><code>\r</code>, <code>\r\n</code> and <code>\n</code> (for reading), <code>\n</code> (for writing)</td><td>Defines the line separator that should be used for parsing&#x2F;writing. Maximum length is 1 character. CSV built-in functions ignore this option.</td><td>read&#x2F;write</td></tr><tr><td><code>unescapedQuoteHandling</code></td><td>STOP_AT_DELIMITER</td><td>Defines how the CsvParser will handle values with unescaped quotes.&#96;&#96;<em><code>STOP_AT_CLOSING_QUOTE</code>: If unescaped quotes are found in the input, accumulate the quote character and proceed parsing the value as a quoted value, until a closing quote is found.</em> <code>BACK_TO_DELIMITER</code>: If unescaped quotes are found in the input, consider the value as an unquoted value. This will make the parser accumulate all characters of the current parsed value until the delimiter is found. If no delimiter is found in the value, the parser will continue accumulating characters from the input until a delimiter or line ending is found.* <code>STOP_AT_DELIMITER</code>: If unescaped quotes are found in the input, consider the value as an unquoted value. This will make the parser accumulate all characters until the delimiter or a line ending is found in the input.* <code>SKIP_VALUE</code>: If unescaped quotes are found in the input, the content parsed for the given value will be skipped and the value set in nullValue will be produced instead.* <code>RAISE_ERROR</code>: If unescaped quotes are found in the input, a TextParsingException will be thrown.</td><td>read</td></tr><tr><td><code>compression</code></td><td>(none)</td><td>Compression codec to use when saving to file. This can be one of the known case-insensitive shorten names (<code>none</code>, <code>bzip2</code>, <code>gzip</code>, <code>lz4</code>, <code>snappy</code> and <code>deflate</code>). CSV built-in functions ignore this option.</td><td>write</td></tr></tbody></table><h3 id="jdbc"><a href="#jdbc" class="headerlink" title="jdbc"></a>jdbc</h3><table><thead><tr><th><strong>Property Name</strong></th><th><strong>Default</strong></th><th><strong>Meaning</strong></th><th><strong>Scope</strong></th></tr></thead><tbody><tr><td><code>url</code></td><td>(none)</td><td>The JDBC URL of the form <code>jdbc:subprotocol:subname</code> to connect to. The source-specific connection properties may be specified in the URL. e.g., <code>jdbc:postgresql://localhost/test?user=fred&amp;password=secret</code></td><td>read&#x2F;write</td></tr><tr><td><code>dbtable</code></td><td>(none)</td><td>The JDBC table that should be read from or written into. Note that when using it in the read path anything that is valid in a <code>FROM</code> clause of a SQL query can be used. For example, instead of a full table you could also use a subquery in parentheses. It is not allowed to specify <code>dbtable</code> and <code>query</code> options at the same time.</td><td>read&#x2F;write</td></tr><tr><td><code>query</code></td><td>(none)</td><td>A query that will be used to read data into Spark. The specified query will be parenthesized and used as a subquery in the <code>FROM</code> clause. Spark will also assign an alias to the subquery clause. As an example, spark will issue a query of the following form to the JDBC Source.<code>SELECT &lt;columns&gt; FROM (&lt;user_specified_query&gt;) spark_gen_alias</code>Below are a couple of restrictions while using this option.<code>1. It is not allowed to specify `dbtable` and `query` options at the same time.1. It is not allowed to specify `query` and `partitionColumn` options at the same time. When specifying `partitionColumn` option is required, the subquery can be specified using `dbtable` option instead and partition columns can be qualified using the subquery alias provided as part of `dbtable`.</code>Example:<code>spark.read.format(&quot;jdbc&quot;).option(&quot;url&quot;, jdbcUrl).option(&quot;query&quot;, &quot;select c1, c2 from t1&quot;).load()</code></td><td>read&#x2F;write</td></tr><tr><td><code>driver</code></td><td>(none)</td><td>The class name of the JDBC driver to use to connect to this URL.</td><td>read&#x2F;write</td></tr><tr><td><code>partitionColumn, lowerBound, upperBound</code></td><td>(none)</td><td>These options must all be specified if any of them is specified. In addition,<code>numPartitions</code> must be specified. They describe how to partition the table when reading in parallel from multiple workers. <code>partitionColumn</code> must be a numeric, date, or timestamp column from the table in question. Notice that <code>lowerBound</code> and <code>upperBound</code> are just used to decide the partition stride, not for filtering the rows in table. So all rows in the table will be partitioned and returned. This option applies only to reading.</td><td>read</td></tr><tr><td><code>numPartitions</code></td><td>(none)</td><td>The maximum number of partitions that can be used for parallelism in table reading and writing. This also determines the maximum number of concurrent JDBC connections. If the number of partitions to write exceeds this limit, we decrease it to this limit by calling <code>coalesce(numPartitions)</code> before writing.</td><td>read&#x2F;write</td></tr><tr><td><code>queryTimeout</code></td><td><code>0</code></td><td>The number of seconds the driver will wait for a Statement object to execute to the given number of seconds. Zero means there is no limit. In the write path, this option depends on how JDBC drivers implement the API <code>setQueryTimeout</code>, e.g., the h2 JDBC driver checks the timeout of each query instead of an entire JDBC batch.</td><td>read&#x2F;write</td></tr><tr><td><code>fetchsize</code></td><td><code>0</code></td><td>The JDBC fetch size, which determines how many rows to fetch per round trip. This can help performance on JDBC drivers which default to low fetch size (e.g. Oracle with 10 rows).</td><td>read</td></tr><tr><td><code>batchsize</code></td><td><code>1000</code></td><td>The JDBC batch size, which determines how many rows to insert per round trip. This can help performance on JDBC drivers. This option applies only to writing.</td><td>write</td></tr><tr><td><code>isolationLevel</code></td><td><code>READ_UNCOMMITTED</code></td><td>The transaction isolation level, which applies to current connection. It can be one of <code>NONE</code>, <code>READ_COMMITTED</code>, <code>READ_UNCOMMITTED</code>, <code>REPEATABLE_READ</code>, or <code>SERIALIZABLE</code>, corresponding to standard transaction isolation levels defined by JDBC’s Connection object, with default of <code>READ_UNCOMMITTED</code>. Please refer the documentation in <code>java.sql.Connection</code>.</td><td>write</td></tr><tr><td><code>sessionInitStatement</code></td><td>(none)</td><td>After each database session is opened to the remote DB and before starting to read data, this option executes a custom SQL statement (or a PL&#x2F;SQL block). Use this to implement session initialization code. Example:<code>option(&quot;sessionInitStatement&quot;, &quot;&quot;&quot;BEGIN execute immediate &#39;alter session set &quot;_serial_direct_read&quot;=true&#39;; END;&quot;&quot;&quot;)</code></td><td>read</td></tr><tr><td><code>truncate</code></td><td><code>false</code></td><td>This is a JDBC writer related option. When <code>SaveMode.Overwrite</code> is enabled, this option causes Spark to truncate an existing table instead of dropping and recreating it. This can be more efficient, and prevents the table metadata (e.g., indices) from being removed. However, it will not work in some cases, such as when the new data has a different schema. In case of failures, users should turn off <code>truncate</code> option to use <code>DROP TABLE</code> again. Also, due to the different behavior of <code>TRUNCATE TABLE</code> among DBMS, it’s not always safe to use this. MySQLDialect, DB2Dialect, MsSqlServerDialect, DerbyDialect, and OracleDialect supports this while PostgresDialect and default JDBCDirect doesn’t. For unknown and unsupported JDBCDirect, the user option <code>truncate</code> is ignored.</td><td>write</td></tr><tr><td><code>cascadeTruncate</code></td><td>the default cascading truncate behaviour of the JDBC database in question, specified in the <code>isCascadeTruncate</code> in each JDBCDialect</td><td>This is a JDBC writer related option. If enabled and supported by the JDBC database (PostgreSQL and Oracle at the moment), this options allows execution of a <code>TRUNCATE TABLE t CASCADE</code> (in the case of PostgreSQL a <code>TRUNCATE TABLE ONLY t CASCADE</code> is executed to prevent inadvertently truncating descendant tables). This will affect other tables, and thus should be used with care.</td><td>write</td></tr><tr><td><code>createTableOptions</code></td><td></td><td>This is a JDBC writer related option. If specified, this option allows setting of database-specific table and partition options when creating a table (e.g.,<code>CREATE TABLE t (name string) ENGINE=InnoDB.</code>).</td><td>write</td></tr><tr><td><code>createTableColumnTypes</code></td><td>(none)</td><td>The database column data types to use instead of the defaults, when creating the table. Data type information should be specified in the same format as CREATE TABLE columns syntax (e.g:<code>&quot;name CHAR(64), comments VARCHAR(1024)&quot;)</code>. The specified types should be valid spark sql data types.</td><td>write</td></tr><tr><td><code>customSchema</code></td><td>(none)</td><td>The custom schema to use for reading data from JDBC connectors. For example,<code>&quot;id DECIMAL(38, 0), name STRING&quot;</code>. You can also specify partial fields, and the others use the default type mapping. For example, <code>&quot;id DECIMAL(38, 0)&quot;</code>. The column names should be identical to the corresponding column names of JDBC table. Users can specify the corresponding data types of Spark SQL instead of using the defaults.</td><td>read</td></tr><tr><td><code>pushDownPredicate</code></td><td><code>true</code></td><td>The option to enable or disable predicate push-down into the JDBC data source. The default value is true, in which case Spark will push down filters to the JDBC data source as much as possible. Otherwise, if set to false, no filter will be pushed down to the JDBC data source and thus all filters will be handled by Spark. Predicate push-down is usually turned off when the predicate filtering is performed faster by Spark than by the JDBC data source.</td><td>read</td></tr><tr><td><code>pushDownAggregate</code></td><td><code>false</code></td><td>The option to enable or disable aggregate push-down in V2 JDBC data source. The default value is false, in which case Spark will not push down aggregates to the JDBC data source. Otherwise, if sets to true, aggregates will be pushed down to the JDBC data source. Aggregate push-down is usually turned off when the aggregate is performed faster by Spark than by the JDBC data source. Please note that aggregates can be pushed down if and only if all the aggregate functions and the related filters can be pushed down. If <code>numPartitions</code> equals to 1 or the group by key is the same as <code>partitionColumn</code>, Spark will push down aggregate to data source completely and not apply a final aggregate over the data source output. Otherwise, Spark will apply a final aggregate over the data source output.</td><td>read</td></tr><tr><td><code>pushDownLimit</code></td><td><code>false</code></td><td>The option to enable or disable LIMIT push-down into V2 JDBC data source. The LIMIT push-down also includes LIMIT + SORT , a.k.a. the Top N operator. The default value is false, in which case Spark does not push down LIMIT or LIMIT with SORT to the JDBC data source. Otherwise, if sets to true, LIMIT or LIMIT with SORT is pushed down to the JDBC data source. If <code>numPartitions</code> is greater than 1, SPARK still applies LIMIT or LIMIT with SORT on the result from data source even if LIMIT or LIMIT with SORT is pushed down. Otherwise, if LIMIT or LIMIT with SORT is pushed down and <code>numPartitions</code> equals to 1, SPARK will not apply LIMIT or LIMIT with SORT on the result from data source.</td><td>read</td></tr><tr><td><code>pushDownTableSample</code></td><td><code>false</code></td><td>The option to enable or disable TABLESAMPLE push-down into V2 JDBC data source. The default value is false, in which case Spark does not push down TABLESAMPLE to the JDBC data source. Otherwise, if value sets to true, TABLESAMPLE is pushed down to the JDBC data source.</td><td>read</td></tr><tr><td><code>keytab</code></td><td>(none)</td><td>Location of the kerberos keytab file (which must be pre-uploaded to all nodes either by <code>--files</code> option of spark-submit or manually) for the JDBC client. When path information found then Spark considers the keytab distributed manually, otherwise <code>--files</code> assumed. If both <code>keytab</code> and <code>principal</code> are defined then Spark tries to do kerberos authentication.</td><td>read&#x2F;write</td></tr><tr><td><code>principal</code></td><td>(none)</td><td>Specifies kerberos principal name for the JDBC client. If both <code>keytab</code> and <code>principal</code> are defined then Spark tries to do kerberos authentication.</td><td>read&#x2F;write</td></tr><tr><td><code>refreshKrb5Config</code></td><td><code>false</code></td><td>This option controls whether the kerberos configuration is to be refreshed or not for the JDBC client before establishing a new connection. Set to true if you want to refresh the configuration, otherwise set to false. The default value is false. Note that if you set this option to true and try to establish multiple connections, a race condition can occur. One possble situation would be like as follows.1. refreshKrb5Config flag is set with security context 11. A JDBC connection provider is used for the corresponding DBMS1. The krb5.conf is modified but the JVM not yet realized that it must be reloaded1. Spark authenticates successfully for security context 11. The JVM loads security context 2 from the modified krb5.conf1. Spark restores the previously saved security context 11. The modified krb5.conf content just gone</td><td>read&#x2F;write</td></tr><tr><td><code>connectionProvider</code></td><td>(none)</td><td>The name of the JDBC connection provider to use to connect to this URL, e.g.<code>db2</code>, <code>mssql</code>. Must be one of the providers loaded with the JDBC data source. Used to disambiguate when more than one provider can handle the specified driver and options. The selected provider must not be disabled by <code>spark.sql.sources.disabledJdbcConnProviderList</code>.</td><td>read&#x2F;write</td></tr></tbody></table><h3 id="excel"><a href="#excel" class="headerlink" title="excel"></a>excel</h3><p>暂时没找到，找到再补</p><h3 id="hive"><a href="#hive" class="headerlink" title="hive"></a>hive</h3><p>对于hive我们要定义输入格式输出格式甚至是元素内部，以及每个元素之间的分隔符如下</p><table><thead><tr><th>Property Name</th><th>Meaning</th></tr></thead><tbody><tr><td>fileFormat</td><td>A fileFormat is kind of a package of storage format specifications, including “serde”, “input format” and “output format”. Currently we support 6 fileFormats: ‘sequencefile’, ‘rcfile’, ‘orc’, ‘parquet’, ‘textfile’ and ‘avro’.</td></tr><tr><td>inputFormat, outputFormat</td><td>These 2 options specify the name of a corresponding <code>InputFormat</code> and <code>OutputFormat</code> class as a string literal, e.g. <code>org.apache.hadoop.hive.ql.io.orc.OrcInputFormat</code>. These 2 options must be appeared in a pair, and you can not specify them if you already specified the <code>fileFormat</code> option.</td></tr><tr><td>serde</td><td>This option specifies the name of a serde class. When the <code>fileFormat</code> option is specified, do not specify this option if the given <code>fileFormat</code> already include the information of serde. Currently “sequencefile”, “textfile” and “rcfile” don’t include the serde information and you can use this option with these 3 fileFormats.</td></tr><tr><td>fieldDelim, escapeDelim, collectionDelim, mapkeyDelim, lineDelim</td><td>These options can only be used with “textfile” fileFormat. They define how to read delimited files into rows.</td></tr></tbody></table><p>关于不同版本的spark关联到hive的源数据库如下配置</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">One <span class="keyword">of</span> the most important pieces <span class="keyword">of</span> Spark <span class="keyword">SQL</span>’s Hive support <span class="keyword">is</span> interaction <span class="keyword">with</span> Hive metastore, which enables Spark <span class="keyword">SQL</span> <span class="keyword">to</span> <span class="keyword">access</span> metadata <span class="keyword">of</span> Hive <span class="keyword">tables</span>. Starting <span class="keyword">from</span> Spark <span class="number">1.4</span><span class="number">.0</span>, a single binary build <span class="keyword">of</span> Spark <span class="keyword">SQL</span> can be used <span class="keyword">to</span> query different versions <span class="keyword">of</span> Hive metastores, <span class="keyword">using</span> the <span class="keyword">configuration</span> described below. Note that independent <span class="keyword">of</span> the <span class="keyword">version</span> <span class="keyword">of</span> Hive that <span class="keyword">is</span> being used <span class="keyword">to</span> talk <span class="keyword">to</span> the metastore, internally Spark <span class="keyword">SQL</span> will compile against built-<span class="keyword">in</span> Hive <span class="keyword">and</span> use those classes <span class="keyword">for</span> <span class="type">internal</span> execution (serdes, UDFs, UDAFs, etc).</span><br></pre></td></tr></table></figure><table><thead><tr><th>Property Name</th><th>Default</th><th>Meaning</th><th>Since Version</th></tr></thead><tbody><tr><td>spark.sql.hive.metastore.version</td><td>2.3.9</td><td>Version of the Hive metastore. Available options are <code>0.12.0</code> through <code>2.3.9</code> and <code>3.0.0</code> through <code>3.1.2</code>.</td><td>1.40</td></tr><tr><td>spark.sql.hive.metastore.jars</td><td>builtin</td><td>Location of the jars that should be used to instantiate the HiveMetastoreClient.<br />This property can be one of four options:<br />1.builtin<br />Use Hive 2.3.9, which is bundled with the Spark assembly when <code>-Phive</code> is enabled. When this option is chosen, <code>spark.sql.hive.metastore.version</code> must be either <code>2.3.9</code> or not defined.<br />maven<br />Use Hive jars of specified version downloaded from Maven repositories. This configuration is not generally recommended for production deployments.<br />path<br />Use Hive jars configured by <code>spark.sql.hive.metastore.jars.path</code> in comma separated format. Support both local or remote paths. The provided jars should be the same version as <code>spark.sql.hive.metastore.version</code>.<br />A classpath in the standard format for the JVM. This classpath must include all of Hive and its dependencies, including the correct version of Hadoop. The provided jars should be the same version as <code>spark.sql.hive.metastore.version</code>. These jars only need to be present on the driver, but if you are running in yarn cluster mode then you must ensure they are packaged with your application.</td><td>1.40</td></tr><tr><td>spark.sql.hive.metastore.jars.path</td><td>(empty)</td><td>Comma-separated paths of the jars that used to instantiate the HiveMetastoreClient. This configuration is useful only when <code>spark.sql.hive.metastore.jars</code> is set as <code>path</code>.&#96;&#96;The paths can be any of the following format:1. <code>file://path/to/jar/foo.jar</code>1. <code>hdfs://nameservice/path/to/jar/foo.jar</code>1. <code>/path/to/jar/</code>(path without URI scheme follow conf <code>fs.defaultFS</code>‘s URI schema)1. <code>[http/https/ftp]://path/to/jar/foo.jar</code>Note that 1, 2, and 3 support wildcard. For example:1. <code>file://path/to/jar/*,file://path2/to/jar/*/*.jar</code>1. <code>hdfs://nameservice/path/to/jar/*,hdfs://nameservice2/path/to/jar/*/*.jar</code></td><td>3.10</td></tr><tr><td>spark.sql.hive.metastore.sharedPrefixes</td><td>com.mysql.jdbc,<br />org.postgresql,<br />com.microsoft.sqlserver,<br />oracle.jdbc</td><td>A comma-separated list of class prefixes that should be loaded using the classloader that is shared between Spark SQL and a specific version of Hive. An example of classes that should be shared is JDBC drivers that are needed to talk to the metastore. Other classes that need to be shared are those that interact with classes that are already shared. For example, custom appenders that are used by log4j.</td><td>1.40</td></tr><tr><td>spark.sql.hive.metastore.barrierPrefixes</td><td>(empty)</td><td>A comma separated list of class prefixes that should explicitly be reloaded for each version of Hive that Spark SQL is communicating with. For example, Hive UDFs that are declared in a prefix that typically would be shared (i.e.<code>org.apache.spark.*</code>).</td><td>1.40</td></tr></tbody></table><h2 id="读数据"><a href="#读数据" class="headerlink" title="读数据"></a>读数据</h2><h3 id="TEXT-1"><a href="#TEXT-1" class="headerlink" title="TEXT"></a>TEXT</h3><p>官方简介</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Spark SQL provides spark.<span class="built_in">read</span>().<span class="keyword">text</span>(<span class="string">&quot;file_name&quot;</span>) <span class="built_in">to</span> <span class="built_in">read</span> <span class="keyword">a</span> <span class="built_in">file</span> <span class="keyword">or</span> <span class="built_in">directory</span> <span class="keyword">of</span> <span class="keyword">text</span> <span class="built_in">files</span> <span class="keyword">into</span> <span class="keyword">a</span> Spark DataFrame, <span class="keyword">and</span> dataframe.<span class="built_in">write</span>().<span class="keyword">text</span>(<span class="string">&quot;path&quot;</span>) <span class="built_in">to</span> <span class="built_in">write</span> <span class="built_in">to</span> <span class="keyword">a</span> <span class="keyword">text</span> <span class="built_in">file</span>. When reading <span class="keyword">a</span> <span class="keyword">text</span> <span class="built_in">file</span>, <span class="keyword">each</span> <span class="built_in">line</span> becomes <span class="keyword">each</span> row that has <span class="keyword">string</span> “<span class="built_in">value</span>” column <span class="keyword">by</span> default. The <span class="built_in">line</span> separator can be changed <span class="keyword">as</span> shown <span class="keyword">in</span> <span class="keyword">the</span> example below. The option() <span class="function"><span class="keyword">function</span> <span class="title">can</span> <span class="title">be</span> <span class="title">used</span> <span class="title">to</span> <span class="title">customize</span> <span class="title">the</span> <span class="title">behavior</span> <span class="title">of</span> <span class="title">reading</span> <span class="title">or</span> <span class="title">writing</span>, <span class="title">such</span> <span class="title">as</span> <span class="title">controlling</span> <span class="title">behavior</span> <span class="title">of</span> <span class="title">the</span> <span class="title">line</span> <span class="title">separator</span>, <span class="title">compression</span>, <span class="title">and</span> <span class="title">so</span> <span class="title">on</span>.</span></span><br></pre></td></tr></table></figure><p>读的时候我们不用设置压缩格式，它和mr一样会自动解压</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line">package sparkfirst</span><br><span class="line"></span><br><span class="line">import org.apache.spark.sql.SparkSession</span><br><span class="line"></span><br><span class="line">object sparksql2 &#123;</span><br><span class="line"><span class="code">  def main(args: Array[String]): Unit = &#123;</span></span><br><span class="line"><span class="code">    val spark = SparkSession.builder().appName(&quot;Sparksql01&quot;).master(&quot;local[4]&quot;).getOrCreate()</span></span><br><span class="line"><span class="code">    val df = spark.read.text(&quot;file:///D:\\test.txt&quot;) // 返回值是DF</span></span><br><span class="line"><span class="code">    df.show()</span></span><br><span class="line"><span class="code">    df.printSchema()</span></span><br><span class="line"><span class="code">  </span></span><br><span class="line"><span class="code">  </span></span><br><span class="line"><span class="code">    var result =</span></span><br><span class="line"><span class="section">      &quot;&quot;&quot;</span></span><br><span class="line"><span class="section">+--------------------+</span></span><br><span class="line"><span class="section">|               value|</span></span><br><span class="line"><span class="section">+--------------------+</span></span><br><span class="line">|as,s,ed,f,,,qq,eq...|</span><br><span class="line"><span class="section">|,w,wq,e,w,ewq,we,...|</span></span><br><span class="line"><span class="section">+--------------------+</span></span><br><span class="line"><span class="code">      &quot;&quot;&quot;</span></span><br><span class="line"><span class="code">  </span></span><br><span class="line"><span class="code">    //text所带有的schame信息是他自己给我们添加上的，所以有时候我们用这个会不方便</span></span><br><span class="line"><span class="code">    val df1 = spark.read.textFile(&quot;file:///D:\\test.txt&quot;) // 返回值是dataset</span></span><br><span class="line"><span class="code">    df1.printSchema()</span></span><br><span class="line"><span class="code">    //--------------------------------------------------------------------</span></span><br><span class="line"><span class="code">    //使用lineSep改变分隔符如下</span></span><br><span class="line"><span class="code">    val df2 = spark.read.option(&quot;lineSep&quot;,&quot;,&quot;).text(&quot;file:///D:\\test.txt&quot;)</span></span><br><span class="line"><span class="code">    df2.show()</span></span><br><span class="line"><span class="code">    result =</span></span><br><span class="line"><span class="section">      &quot;&quot;&quot;</span></span><br><span class="line"><span class="section">+---------+</span></span><br><span class="line"><span class="section">|    value|</span></span><br><span class="line"><span class="section">+---------+</span></span><br><span class="line">|       as|</span><br><span class="line">|        s|</span><br><span class="line">|       ed|</span><br><span class="line">|        f|</span><br><span class="line">|         |</span><br><span class="line">|         |</span><br><span class="line">|       qq|</span><br><span class="line">|eqedqwe\n|</span><br><span class="line">|        w|</span><br><span class="line">|       wq|</span><br><span class="line">|        e|</span><br><span class="line">|        w|</span><br><span class="line">|      ewq|</span><br><span class="line">|       we|</span><br><span class="line">|        q|</span><br><span class="line">|        e|</span><br><span class="line">|wewqeqwel|</span><br><span class="line">|       qe|</span><br><span class="line">| lqeweqwl|</span><br><span class="line"><span class="section">|     qw\n|</span></span><br><span class="line"><span class="section">+---------+</span></span><br><span class="line"><span class="code">      &quot;&quot;&quot;</span></span><br><span class="line"><span class="code">    //---------------------------------------------------------------------</span></span><br><span class="line"><span class="code">    //使用wholetext把一整个文件当作一行来接受</span></span><br><span class="line"><span class="code">    val df3 = spark.read.option(&quot;wholetext&quot;,true).text(&quot;file:///D:\\test.txt&quot;)</span></span><br><span class="line"><span class="code">    df3.show()</span></span><br><span class="line"><span class="code">    var result =</span></span><br><span class="line"><span class="section">      &quot;&quot;&quot;</span></span><br><span class="line"><span class="section">+--------------------+</span></span><br><span class="line"><span class="section">|               value|</span></span><br><span class="line"><span class="section">+--------------------+</span></span><br><span class="line"><span class="section">|as,s,ed,f,,,qq,eq...|</span></span><br><span class="line"><span class="section">+--------------------+</span></span><br><span class="line"><span class="code">      &quot;&quot;&quot;</span></span><br><span class="line"><span class="code">    //这里的text和textFile是可以相互用的</span></span><br><span class="line"><span class="code">    val df4 = spark.read.option(&quot;wholetext&quot;,true).textFile(&quot;file:///D:\\test.txt&quot;)</span></span><br><span class="line"><span class="code">    df4.show()</span></span><br><span class="line"><span class="code">    var result =</span></span><br><span class="line"><span class="section">      &quot;&quot;&quot;</span></span><br><span class="line"><span class="section">+--------------------+</span></span><br><span class="line"><span class="section">|               value|</span></span><br><span class="line"><span class="section">+--------------------+</span></span><br><span class="line"><span class="section">|as,s,ed,f,,,qq,eq...|</span></span><br><span class="line"><span class="section">+--------------------+</span></span><br><span class="line"><span class="code">      &quot;&quot;&quot;</span></span><br><span class="line"><span class="code">    val df5 = spark.read.option(&quot;wholetext&quot;,true).format(&quot;text&quot;).load(&quot;file:///D:\\test.txt&quot;)</span></span><br><span class="line"><span class="code">    df5.show()</span></span><br><span class="line"><span class="code">    var result =</span></span><br><span class="line"><span class="section">      &quot;&quot;&quot;</span></span><br><span class="line"><span class="section">+--------------------+</span></span><br><span class="line"><span class="section">|               value|</span></span><br><span class="line"><span class="section">+--------------------+</span></span><br><span class="line"><span class="section">|as,s,ed,f,,,qq,eq...|</span></span><br><span class="line"><span class="section">+--------------------+</span></span><br><span class="line"><span class="code">      &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="code">  &#125;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>我们点进去源码发现text的底层是</p><p><code>def text(paths: String*): DataFrame = format(&quot;text&quot;).load(paths : _*)</code></p><p>所以我们使用的时候可以</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">val df5=spark.<span class="keyword">read</span>.<span class="keyword">option</span>(&quot;wholetext&quot;,<span class="keyword">true</span>).format(&quot;text&quot;).<span class="keyword">load</span>(&quot;file:///D:\\test.txt&quot;)</span><br></pre></td></tr></table></figure><h3 id="json-1"><a href="#json-1" class="headerlink" title="json"></a>json</h3><p>简介</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Spark <span class="keyword">SQL</span> can automatically infer the <span class="keyword">schema</span> <span class="keyword">of</span> a <span class="type">JSON</span> dataset <span class="keyword">and</span> <span class="keyword">load</span> it <span class="keyword">as</span> a Dataset[<span class="keyword">Row</span>]. This <span class="keyword">conversion</span> can be done <span class="keyword">using</span> SparkSession.<span class="keyword">read</span>.json() <span class="keyword">on</span> either a Dataset[String], <span class="keyword">or</span> a <span class="type">JSON</span> file.</span><br><span class="line"></span><br><span class="line">Note that the file that <span class="keyword">is</span> offered <span class="keyword">as</span> a <span class="type">json</span> file <span class="keyword">is</span> <span class="keyword">not</span> a typical <span class="type">JSON</span> file. <span class="keyword">Each</span> <span class="type">line</span> must contain a separate, self-contained <span class="keyword">valid</span> <span class="type">JSON</span> <span class="keyword">object</span>. <span class="keyword">For</span> more information, please see <span class="type">JSON</span> Lines <span class="type">text</span> <span class="keyword">format</span>, <span class="keyword">also</span> <span class="keyword">called</span> newline-delimited <span class="type">JSON</span>.</span><br><span class="line"></span><br><span class="line"><span class="keyword">For</span> a regular multi-<span class="type">line</span> <span class="type">JSON</span> file, <span class="keyword">set</span> the multiLine <span class="keyword">option</span> <span class="keyword">to</span> <span class="keyword">true</span>.</span><br></pre></td></tr></table></figure><p>json分为简单json和嵌套json</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">val spark = SparkSession.builder().appName(<span class="string">&quot;Sparksql01&quot;</span>).master(<span class="string">&quot;local[4]&quot;</span>).getOrCreate()</span><br><span class="line"></span><br><span class="line"><span class="regexp">//</span>-------------------------普通json</span><br><span class="line">val df = spark.read.json(<span class="string">&quot;file:///C:\\Users\\dell\\Desktop\\dept.json&quot;</span>)</span><br><span class="line">df.show()</span><br><span class="line">df.printSchema()</span><br><span class="line"><span class="regexp">//</span>--------------------------嵌套json如果嵌套的是STruct =&gt; 打点 / ARRAY 类型 先炸开 再打点</span><br><span class="line">var df1 = spark.read.format(<span class="string">&quot;json&quot;</span>).load(<span class="string">&quot;file:///C:\\Users\\dell\\Desktop\\Skills.json&quot;</span>)</span><br><span class="line">df1.printSchema()</span><br><span class="line"><span class="regexp">//</span>--------------------------api</span><br><span class="line"><span class="regexp">//</span>-withColumn可以增加一个字段，或者把一个字段重命名 =》 提出字段</span><br><span class="line">df1=df1.withColumn(<span class="string">&quot;critical&quot;</span>,col(<span class="string">&quot;damage.critical&quot;</span>))</span><br><span class="line">df1=df1.withColumn(<span class="string">&quot;elementId&quot;</span>,explode(col(<span class="string">&quot;damage.elementId&quot;</span>)))</span><br><span class="line">df1.printSchema()</span><br><span class="line"><span class="regexp">//</span>------------------------删除字段</span><br><span class="line">df1=df1.drop(<span class="string">&quot;damage.critical&quot;</span>,<span class="string">&quot;damage.elementId&quot;</span>)</span><br><span class="line"><span class="regexp">//</span>-------------------------sql</span><br><span class="line"><span class="regexp">//</span>------------------------对比hivesql</span><br><span class="line">df1.createOrReplaceTempView(<span class="string">&quot;test&quot;</span>)</span><br><span class="line"><span class="regexp">//</span>spark.sql(<span class="string">&quot;SELECT get_json_object(&#x27;&#123;\&quot;a\&quot;:\&quot;b\&quot;&#125;&#x27;, &#x27;$.a&#x27;);&quot;</span>).show()</span><br><span class="line"><span class="regexp">//</span> struct可以用下面打点的方法</span><br><span class="line">spark.sql(</span><br><span class="line">  <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    |select</span></span><br><span class="line"><span class="string">    |effects.ddd,</span></span><br><span class="line"><span class="string">    |damage.ddddds</span></span><br><span class="line"><span class="string">    |from</span></span><br><span class="line"><span class="string">    |test</span></span><br><span class="line"><span class="string">    |&quot;&quot;&quot;</span>.stripMargin).show()</span><br><span class="line"><span class="regexp">//</span>或者用爆炸加侧写进行 ：array元素,嵌套json</span><br><span class="line">spark.sql(</span><br><span class="line">  <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    |select</span></span><br><span class="line"><span class="string">    |effects.ddd,</span></span><br><span class="line"><span class="string">    |damage.ddddds</span></span><br><span class="line"><span class="string">    |from</span></span><br><span class="line"><span class="string">    |test</span></span><br><span class="line"><span class="string">    |lateral view explode(store.fruit) as fruit</span></span><br><span class="line"><span class="string">    |&quot;&quot;&quot;</span>.stripMargin)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="csv-1"><a href="#csv-1" class="headerlink" title="csv"></a>csv</h3><p>简介</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Spark SQL provides spark.<span class="built_in">read</span>().csv(<span class="string">&quot;file_name&quot;</span>) <span class="built_in">to</span> <span class="built_in">read</span> <span class="keyword">a</span> <span class="built_in">file</span> <span class="keyword">or</span> <span class="built_in">directory</span> <span class="keyword">of</span> <span class="built_in">files</span> <span class="keyword">in</span> CSV <span class="built_in">format</span> <span class="keyword">into</span> Spark DataFrame, <span class="keyword">and</span> dataframe.<span class="built_in">write</span>().csv(<span class="string">&quot;path&quot;</span>) <span class="built_in">to</span> <span class="built_in">write</span> <span class="built_in">to</span> <span class="keyword">a</span> CSV <span class="built_in">file</span>. Function option() can be used <span class="built_in">to</span> customize <span class="keyword">the</span> behavior <span class="keyword">of</span> reading <span class="keyword">or</span> writing, such <span class="keyword">as</span> controlling behavior <span class="keyword">of</span> <span class="keyword">the</span> header, delimiter <span class="keyword">character</span>, <span class="keyword">character</span> <span class="built_in">set</span>, <span class="keyword">and</span> so on.</span><br></pre></td></tr></table></figure><p>csv文件默认的分隔符是，但是可以更改</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><span class="line">val spark = SparkSession.builder().appName(<span class="string">&quot;Sparksql01&quot;</span>).master(<span class="string">&quot;local[4]&quot;</span>).getOrCreate()</span><br><span class="line"></span><br><span class="line">val df = spark.read.format(<span class="string">&quot;csv&quot;</span>).load(<span class="string">&quot;file:///C:\\Users\\dell\\Desktop\\user_profile.csv&quot;</span>)</span><br><span class="line">df.show()</span><br><span class="line">var result=</span><br><span class="line">  <span class="string">&quot;&quot;&quot;</span></span><br><span class="line">    <span class="string">|+---+---------+------+----+----------+---+--------------------+------------+----------+</span></span><br><span class="line">    <span class="string">||_c0|      _c1|   _c2| _c3|       _c4|_c5|                 _c6|         _c7|       _c8|</span></span><br><span class="line">    <span class="string">|+---+---------+------+----+----------+---+--------------------+------------+----------+</span></span><br><span class="line">    <span class="string">|| id|device_id|gender| age|university|gpa|active_days_withi...|question_cnt|answer_cnt|</span></span><br><span class="line">    <span class="string">||  1|     2138|  male|  21|  北京大学|3.4|                   7|           2|        12|</span></span><br><span class="line">    <span class="string">||  2|     3214|  male|null|  复旦大学|  4|                  15|           5|        25|</span></span><br><span class="line">    <span class="string">||  3|     6543|female|  20|  北京大学|3.2|                  12|           3|        30|</span></span><br><span class="line">    <span class="string">||  4|     2315|female|  23|  浙江大学|3.6|                   5|           1|         2|</span></span><br><span class="line">    <span class="string">||  5|     5432|  male|  25|  山东大学|3.8|                  20|          15|        70|</span></span><br><span class="line">    <span class="string">||  6|     2131|  male|  28|  山东大学|3.3|                  15|           7|        13|</span></span><br><span class="line">    <span class="string">||  7|     4321|  male|  28|  复旦大学|3.6|                   9|           6|        52|</span></span><br><span class="line">    <span class="string">|+---+---------+------+----+----------+---+--------------------+------------+----------+</span></span><br><span class="line">    <span class="string">|&quot;&quot;&quot;</span>.stripMargin</span><br><span class="line"><span class="comment">// 这样默认是通过，进行分割的</span></span><br><span class="line"><span class="comment">//可以通过delimiter来设置分割参数，sep和他一样</span></span><br><span class="line">val df1 = spark.read.option(<span class="string">&quot;delimiter&quot;</span>,<span class="string">&quot;;&quot;</span>).csv(<span class="string">&quot;file:///C:\\Users\\dell\\Desktop\\user_profile.csv&quot;</span>)</span><br><span class="line">df1.show()</span><br><span class="line">result =</span><br><span class="line">  <span class="string">&quot;&quot;&quot;</span></span><br><span class="line">    <span class="string">|+------------------------+</span></span><br><span class="line">    <span class="string">||                     _c0|</span></span><br><span class="line">    <span class="string">|+------------------------+</span></span><br><span class="line">    <span class="string">||    &quot;</span>id<span class="string">&quot;,&quot;</span>device_id<span class="string">&quot;,...|</span></span><br><span class="line">    <span class="string">||  1,2138,male,21,北京...|</span></span><br><span class="line">    <span class="string">||2,3214,male,,复旦大学...|</span></span><br><span class="line">    <span class="string">||    3,6543,female,20,...|</span></span><br><span class="line">    <span class="string">||    4,2315,female,23,...|</span></span><br><span class="line">    <span class="string">||  5,5432,male,25,山东...|</span></span><br><span class="line">    <span class="string">||  6,2131,male,28,山东...|</span></span><br><span class="line">    <span class="string">||  7,4321,male,28,复旦...|</span></span><br><span class="line">    <span class="string">|+------------------------+</span></span><br><span class="line">    <span class="string">|&quot;&quot;&quot;</span>.stripMargin</span><br><span class="line">val df4 = spark.read.option(<span class="string">&quot;sep&quot;</span>,<span class="string">&quot;;&quot;</span>).csv(<span class="string">&quot;file:///C:\\Users\\dell\\Desktop\\user_profile.csv&quot;</span>)</span><br><span class="line">df4.show()</span><br><span class="line">result =</span><br><span class="line">  <span class="string">&quot;&quot;&quot;</span></span><br><span class="line">    <span class="string">|+------------------------+</span></span><br><span class="line">    <span class="string">||                     _c0|</span></span><br><span class="line">    <span class="string">|+------------------------+</span></span><br><span class="line">    <span class="string">||    &quot;</span>id<span class="string">&quot;,&quot;</span>device_id<span class="string">&quot;,...|</span></span><br><span class="line">    <span class="string">||  1,2138,male,21,北京...|</span></span><br><span class="line">    <span class="string">||2,3214,male,,复旦大学...|</span></span><br><span class="line">    <span class="string">||    3,6543,female,20,...|</span></span><br><span class="line">    <span class="string">||    4,2315,female,23,...|</span></span><br><span class="line">    <span class="string">||  5,5432,male,25,山东...|</span></span><br><span class="line">    <span class="string">||  6,2131,male,28,山东...|</span></span><br><span class="line">    <span class="string">||  7,4321,male,28,复旦...|</span></span><br><span class="line">    <span class="string">|+------------------------+</span></span><br><span class="line">    <span class="string">|&quot;&quot;&quot;</span>.stripMargin</span><br><span class="line"><span class="comment">//还可以从csv里加载表头</span></span><br><span class="line">val df2 = spark.read.option(<span class="string">&quot;delimiter&quot;</span>,<span class="string">&quot;,&quot;</span>).option(<span class="string">&quot;header&quot;</span>,<span class="string">&quot;true&quot;</span>).format(<span class="string">&quot;csv&quot;</span>).load(<span class="string">&quot;file:///C:\\Users\\dell\\Desktop\\user_profile.csv&quot;</span>)</span><br><span class="line">df2.show()</span><br><span class="line">result=</span><br><span class="line">  <span class="string">&quot;&quot;&quot;</span></span><br><span class="line">    <span class="string">|+---+---------+------+----+----------+---+---------------------+------------+----------+</span></span><br><span class="line">    <span class="string">|| id|device_id|gender| age|university|gpa|active_days_within_30|question_cnt|answer_cnt|</span></span><br><span class="line">    <span class="string">|+---+---------+------+----+----------+---+---------------------+------------+----------+</span></span><br><span class="line">    <span class="string">||  1|     2138|  male|  21|  北京大学|3.4|                    7|           2|        12|</span></span><br><span class="line">    <span class="string">||  2|     3214|  male|null|  复旦大学|  4|                   15|           5|        25|</span></span><br><span class="line">    <span class="string">||  3|     6543|female|  20|  北京大学|3.2|                   12|           3|        30|</span></span><br><span class="line">    <span class="string">||  4|     2315|female|  23|  浙江大学|3.6|                    5|           1|         2|</span></span><br><span class="line">    <span class="string">||  5|     5432|  male|  25|  山东大学|3.8|                   20|          15|        70|</span></span><br><span class="line">    <span class="string">||  6|     2131|  male|  28|  山东大学|3.3|                   15|           7|        13|</span></span><br><span class="line">    <span class="string">||  7|     4321|  male|  28|  复旦大学|3.6|                    9|           6|        52|</span></span><br><span class="line">    <span class="string">|+---+---------+------+----+----------+---+---------------------+------------+----------+</span></span><br><span class="line">    <span class="string">|&quot;&quot;&quot;</span>.stripMargin</span><br><span class="line"><span class="comment">//还可以把上面两个option合并</span></span><br><span class="line">val df3 = spark.read.options(Map(<span class="string">&quot;delimiter&quot;</span> -&gt; <span class="string">&quot;,&quot;</span> ,<span class="string">&quot;header&quot;</span> -&gt; <span class="string">&quot;true&quot;</span>)).csv(<span class="string">&quot;file:///C:\\Users\\dell\\Desktop\\user_profile.csv&quot;</span>)</span><br><span class="line">df3.show()</span><br><span class="line">result=</span><br><span class="line">  <span class="string">&quot;&quot;&quot;</span></span><br><span class="line">    <span class="string">|+---+---------+------+----+----------+---+---------------------+------------+----------+</span></span><br><span class="line">    <span class="string">|| id|device_id|gender| age|university|gpa|active_days_within_30|question_cnt|answer_cnt|</span></span><br><span class="line">    <span class="string">|+---+---------+------+----+----------+---+---------------------+------------+----------+</span></span><br><span class="line">    <span class="string">||  1|     2138|  male|  21|  北京大学|3.4|                    7|           2|        12|</span></span><br><span class="line">    <span class="string">||  2|     3214|  male|null|  复旦大学|  4|                   15|           5|        25|</span></span><br><span class="line">    <span class="string">||  3|     6543|female|  20|  北京大学|3.2|                   12|           3|        30|</span></span><br><span class="line">    <span class="string">||  4|     2315|female|  23|  浙江大学|3.6|                    5|           1|         2|</span></span><br><span class="line">    <span class="string">||  5|     5432|  male|  25|  山东大学|3.8|                   20|          15|        70|</span></span><br><span class="line">    <span class="string">||  6|     2131|  male|  28|  山东大学|3.3|                   15|           7|        13|</span></span><br><span class="line">    <span class="string">||  7|     4321|  male|  28|  复旦大学|3.6|                    9|           6|        52|</span></span><br><span class="line">    <span class="string">|+---+---------+------+----+----------+---+---------------------+------------+----------+</span></span><br><span class="line">    <span class="string">|&quot;&quot;&quot;</span>.stripMargin</span><br><span class="line"><span class="comment">//还可以加上自动推断类型，如果不加，它就会默认是字符串类型inferSchema</span></span><br><span class="line">val df5 = spark.read.options(Map(<span class="string">&quot;sep&quot;</span>-&gt;<span class="string">&quot;,&quot;</span>,<span class="string">&quot;header&quot;</span>-&gt;<span class="string">&quot;true&quot;</span>,<span class="string">&quot;inferSchema&quot;</span>-&gt;<span class="string">&quot;true&quot;</span>,<span class="string">&quot;encoding&quot;</span>-&gt;<span class="string">&quot;UTF8&quot;</span>)).csv(<span class="string">&quot;file:///C:\\Users\\dell\\Desktop\\user_profile.csv&quot;</span>)</span><br><span class="line">df5.show()</span><br><span class="line">result=</span><br><span class="line">  <span class="string">&quot;&quot;&quot;</span></span><br><span class="line">    <span class="string">|+---+---------+------+----+----------+---+---------------------+------------+----------+</span></span><br><span class="line">    <span class="string">|| id|device_id|gender| age|university|gpa|active_days_within_30|question_cnt|answer_cnt|</span></span><br><span class="line">    <span class="string">|+---+---------+------+----+----------+---+---------------------+------------+----------+</span></span><br><span class="line">    <span class="string">||  1|     2138|  male|  21|  北京大学|3.4|                    7|           2|        12|</span></span><br><span class="line">    <span class="string">||  2|     3214|  male|null|  复旦大学|4.0|                   15|           5|        25|</span></span><br><span class="line">    <span class="string">||  3|     6543|female|  20|  北京大学|3.2|                   12|           3|        30|</span></span><br><span class="line">    <span class="string">||  4|     2315|female|  23|  浙江大学|3.6|                    5|           1|         2|</span></span><br><span class="line">    <span class="string">||  5|     5432|  male|  25|  山东大学|3.8|                   20|          15|        70|</span></span><br><span class="line">    <span class="string">||  6|     2131|  male|  28|  山东大学|3.3|                   15|           7|        13|</span></span><br><span class="line">    <span class="string">||  7|     4321|  male|  28|  复旦大学|3.6|                    9|           6|        52|</span></span><br><span class="line">    <span class="string">|+---+---------+------+----+----------+---+---------------------+------------+----------+</span></span><br><span class="line">    <span class="string">|&quot;&quot;&quot;</span>.stripMargin</span><br><span class="line">df5.printSchema()</span><br><span class="line">result=</span><br><span class="line">  <span class="string">&quot;&quot;&quot;</span></span><br><span class="line">    <span class="string">|root</span></span><br><span class="line">    <span class="string">| |-- id: integer (nullable = true)</span></span><br><span class="line">    <span class="string">| |-- device_id: integer (nullable = true)</span></span><br><span class="line">    <span class="string">| |-- gender: string (nullable = true)</span></span><br><span class="line">    <span class="string">| |-- age: integer (nullable = true)</span></span><br><span class="line">    <span class="string">| |-- university: string (nullable = true)</span></span><br><span class="line">    <span class="string">| |-- gpa: double (nullable = true)</span></span><br><span class="line">    <span class="string">| |-- active_days_within_30: integer (nullable = true)</span></span><br><span class="line">    <span class="string">| |-- question_cnt: integer (nullable = true)</span></span><br><span class="line">    <span class="string">| |-- answer_cnt: integer (nullable = true)</span></span><br><span class="line">    <span class="string">|&quot;&quot;&quot;</span>.stripMargin</span><br><span class="line"><span class="comment">//等 剩下的请看api简介</span></span><br><span class="line"></span><br><span class="line">df5.createOrReplaceTempView(<span class="string">&quot;csv&quot;</span>)</span><br><span class="line">spark.sql(</span><br><span class="line">  <span class="string">&quot;&quot;&quot;</span></span><br><span class="line">    <span class="string">|select</span></span><br><span class="line">    <span class="string">|gender,</span></span><br><span class="line">    <span class="string">|device_id,</span></span><br><span class="line">    <span class="string">|active_days_within_30,</span></span><br><span class="line">    <span class="string">|university</span></span><br><span class="line">    <span class="string">|from</span></span><br><span class="line">    <span class="string">|csv</span></span><br><span class="line">    <span class="string">|where university = &#x27;北京大学&#x27;</span></span><br><span class="line">    <span class="string">|&quot;&quot;&quot;</span>.stripMargin).show()</span><br><span class="line"></span><br><span class="line">result=</span><br><span class="line">  <span class="string">&quot;&quot;&quot;</span></span><br><span class="line">    <span class="string">|+------+---------+---------------------+----------+</span></span><br><span class="line">    <span class="string">||gender|device_id|active_days_within_30|university|</span></span><br><span class="line">    <span class="string">|+------+---------+---------------------+----------+</span></span><br><span class="line">    <span class="string">||  male|     2138|                    7|  北京大学|</span></span><br><span class="line">    <span class="string">||female|     6543|                   12|  北京大学|</span></span><br><span class="line">    <span class="string">|+------+---------+---------------------+----------+</span></span><br><span class="line">    <span class="string">|&quot;&quot;&quot;</span>.stripMargin</span><br></pre></td></tr></table></figure><h3 id="jdbc-1"><a href="#jdbc-1" class="headerlink" title="jdbc"></a>jdbc</h3><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">val spark = SparkSession.builder().appName(<span class="string">&quot;Sparksql01&quot;</span>).master(<span class="string">&quot;local[4]&quot;</span>).getOrCreate()</span><br><span class="line"></span><br><span class="line"><span class="comment">//用代码创建</span></span><br><span class="line">val df = spark.read.format(<span class="string">&quot;JDBC&quot;</span>)</span><br><span class="line">  .option(<span class="string">&quot;url&quot;</span>,<span class="string">&quot;jdbc:mysql://bigdata2:3306/try&quot;</span>)</span><br><span class="line">  .option(<span class="string">&quot;dbtable&quot;</span>, <span class="string">&quot;emp&quot;</span>)</span><br><span class="line">  .option(<span class="string">&quot;user&quot;</span>, <span class="string">&quot;root&quot;</span>)</span><br><span class="line">  .option(<span class="string">&quot;password&quot;</span>, <span class="string">&quot;liuzihan010616&quot;</span>)</span><br><span class="line">  .load()</span><br><span class="line">df.printSchema()</span><br><span class="line">df.show()</span><br><span class="line"><span class="comment">// 但是这样传入是把整个表直接传进来，但是有时候我们只要其中一一部分可以这样相当于谓词下压</span></span><br><span class="line">    val sal =</span><br><span class="line">  <span class="string">&quot;&quot;&quot;</span></span><br><span class="line">    <span class="string">|select</span></span><br><span class="line">    <span class="string">|*</span></span><br><span class="line">    <span class="string">|from</span></span><br><span class="line">    <span class="string">|emp where sal &gt; 1500</span></span><br><span class="line">    <span class="string">|&quot;&quot;&quot;</span>.stripMargin</span><br><span class="line">val df1 = spark.read.format(<span class="string">&quot;JDBC&quot;</span>)</span><br><span class="line">  .option(<span class="string">&quot;url&quot;</span>,<span class="string">&quot;jdbc:mysql://bigdata2:3306/try&quot;</span>)</span><br><span class="line">  .option(<span class="string">&quot;dbtable&quot;</span>, s<span class="string">&quot;($sal) as tmp&quot;</span>)</span><br><span class="line">  .option(<span class="string">&quot;user&quot;</span>, <span class="string">&quot;root&quot;</span>)</span><br><span class="line">  .option(<span class="string">&quot;password&quot;</span>, <span class="string">&quot;liuzihan010616&quot;</span>)</span><br><span class="line">  .load()</span><br><span class="line">df1.show()</span><br><span class="line"> result =</span><br><span class="line">  <span class="string">&quot;&quot;&quot;</span></span><br><span class="line">    <span class="string">|+-----+------+---------+----+-------------------+-------+-------+------+</span></span><br><span class="line">    <span class="string">||empno| ename|      job| mgr|           hiredate|    sal|   comm|deptno|</span></span><br><span class="line">    <span class="string">|+-----+------+---------+----+-------------------+-------+-------+------+</span></span><br><span class="line">    <span class="string">|| 7499| ALLEN| SALESMAN|7698|1981-02-20 00:00:00|1600.00| 300.00|    30|</span></span><br><span class="line">    <span class="string">|| 7566| JONES|  MANAGER|7839|1981-04-02 00:00:00|2975.00|   null|    20|</span></span><br><span class="line">    <span class="string">|| 7698| BLAKE|  MANAGER|7839|1981-05-01 00:00:00|2850.00|   null|    30|</span></span><br><span class="line">    <span class="string">|| 7782| CLARK|  MANAGER|7839|1981-06-09 00:00:00|2450.00|   null|    10|</span></span><br><span class="line">    <span class="string">|| 7788| SCOTT|  ANALYST|7566|1982-12-09 00:00:00|3000.00|   null|    20|</span></span><br><span class="line">    <span class="string">|| 7839|  KING|PRESIDENT|null|1981-11-17 00:00:00|5000.00|   null|    10|</span></span><br><span class="line">    <span class="string">|| 7902|  FORD|  ANALYST|7566|1981-12-03 00:00:00|3000.00|   null|    20|</span></span><br><span class="line">    <span class="string">|| 7839|  KING|PRESIDENT|null|1981-11-17 00:00:00|5000.00|   null|    10|</span></span><br><span class="line">    <span class="string">|| 7654|MARTIN| SALESMAN|7698|1981-09-28 00:00:00|3200.00|1400.00|    30|</span></span><br><span class="line">    <span class="string">|| 7788| SCOTT|  ANALYST|7566|1982-12-09 00:00:00|3000.00|   null|    20|</span></span><br><span class="line">    <span class="string">|| 7788| SCOTT|  ANALYST|7566|1982-12-09 00:00:00|3000.00|   null|    20|</span></span><br><span class="line">    <span class="string">|| 7788| SCOTT|  ANALYST|7566|1982-12-09 00:00:00|3000.00|   null|    20|</span></span><br><span class="line">    <span class="string">|| 7788| SCOTT|  ANALYST|7566|1982-12-09 00:00:00|3000.00|   null|    20|</span></span><br><span class="line">    <span class="string">|| 7788| SCOTT|  ANALYST|7566|1982-12-09 00:00:00|3000.00|   null|    20|</span></span><br><span class="line">    <span class="string">|| 7788| SCOTT|  ANALYST|7566|1982-12-09 00:00:00|3000.00|   null|    20|</span></span><br><span class="line">    <span class="string">|| 7788| SCOTT|  ANALYST|7566|1982-12-09 00:00:00|3000.00|   null|    20|</span></span><br><span class="line">    <span class="string">|| 7788| SCOTT|  ANALYST|7566|1982-12-09 00:00:00|3000.00|   null|    20|</span></span><br><span class="line">    <span class="string">|| 7788| SCOTT|  ANALYST|7566|1982-12-09 00:00:00|3000.00|   null|    20|</span></span><br><span class="line">    <span class="string">|| 7788| SCOTT|  ANALYST|7566|1982-12-09 00:00:00|3000.00|   null|    20|</span></span><br><span class="line">    <span class="string">|| 7788| SCOTT|  ANALYST|7566|1982-12-09 00:00:00|3000.00|   null|    20|</span></span><br><span class="line">    <span class="string">|+-----+------+---------+----+-------------------+-------+-------+------+</span></span><br><span class="line">    <span class="string">|only showing top 20 rows</span></span><br><span class="line">    <span class="string">|</span></span><br><span class="line">    <span class="string">|</span></span><br><span class="line">    <span class="string">|Process finished with exit code 0</span></span><br><span class="line">    <span class="string">|</span></span><br><span class="line">    <span class="string">|&quot;&quot;&quot;</span>.stripMargin</span><br><span class="line"><span class="comment">//用Properties传入</span></span><br><span class="line">val connectionProperties = new Properties()</span><br><span class="line">connectionProperties.put(<span class="string">&quot;user&quot;</span>, <span class="string">&quot;root&quot;</span>)</span><br><span class="line">connectionProperties.put(<span class="string">&quot;password&quot;</span>, <span class="string">&quot;liuzihan010616&quot;</span>)</span><br><span class="line">val jdbcDF2 = spark.read</span><br><span class="line">  .jdbc(<span class="string">&quot;jdbc:mysql://bigdata2:3306/try&quot;</span>, <span class="string">&quot;try.emp&quot;</span>, connectionProperties)</span><br></pre></td></tr></table></figure><h3 id="excel-1"><a href="#excel-1" class="headerlink" title="excel"></a>excel</h3><p>在idea里要先导入spark-excel的pom：这里的版本要和scala对应上</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">&lt;dependency&gt;</span></span><br><span class="line">   <span class="section">&lt;groupId&gt;</span><span class="attribute">com</span>.crealytics&lt;/groupId&gt;</span><br><span class="line">   <span class="section">&lt;artifactId&gt;</span><span class="attribute">spark</span>-excel_2.<span class="number">12</span>&lt;/artifactId&gt;</span><br><span class="line">   <span class="section">&lt;version&gt;</span><span class="attribute">0</span>.<span class="number">14</span>.<span class="number">0</span>&lt;/version&gt;</span><br><span class="line"> <span class="section">&lt;/dependency&gt;</span></span><br></pre></td></tr></table></figure><p>然后代码</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">package sparkfirst</span><br><span class="line"></span><br><span class="line">import java.util.Properties</span><br><span class="line"></span><br><span class="line">import org.apache.spark.sql.SparkSession</span><br><span class="line">import org.apache.spark.sql.functions._</span><br><span class="line">import com.crealytics.spark.excel._</span><br><span class="line">object sparksql2 &#123;</span><br><span class="line">  def main(args: Array[String]): Unit = &#123;</span><br><span class="line">    val spark = SparkSession.builder().appName(<span class="string">&quot;Sparksql01&quot;</span>).master(<span class="string">&quot;local[4]&quot;</span>).getOrCreate()</span><br><span class="line">    val df = spark.read.excel(header = true,inferSchema = true).load(<span class="string">&quot;file:////C:\\Users\\dell\\Desktop\\2023届毕业设计题目-计算机-选题志愿表.xlsx&quot;</span>)</span><br><span class="line">    df.show()</span><br><span class="line">    val result =</span><br><span class="line">      <span class="string">&quot;&quot;&quot;</span></span><br><span class="line">        <span class="string">|+--------------------------------------+--------+-------------------------------------+------+--------+--------+--------+</span></span><br><span class="line">        <span class="string">||2023届计算机科学与技术专业毕业设计选题|     _c1|                                  _c2|   _c3|     _c4|     _c5|     _c6|</span></span><br><span class="line">        <span class="string">|+--------------------------------------+--------+-------------------------------------+------+--------+--------+--------+</span></span><br><span class="line">        <span class="string">||                                  序号|指导老师|                                 题目|学生数|第一志愿|第二志愿|第三志愿|</span></span><br><span class="line">        <span class="string">||                                     1|  王海涛|          基于android的房产中介app...|     1|    null|    null|    null|</span></span><br><span class="line">        <span class="string">||                                     2|  王海涛|        基于android的酒店预约入住a...|     1|    null|    null|    null|</span></span><br><span class="line">        <span class="string">||                                     3|  王海涛|          基于android的有声书app的...|     1|    null|    null|    null|</span></span><br><span class="line">        <span class="string">||                                     4|  王海涛|          基于android的掌上医院app...|     1|    null|    null|    null|</span></span><br><span class="line">        <span class="string">||                                     5|  王海涛|    基于web的考试管理系统的设计与实现|     1|    null|    null|    null|</span></span><br><span class="line">        <span class="string">||                                     6|    王琢|           电商平台产品评论爬虫的设计|     1|    null|    null|    null|</span></span><br><span class="line">        <span class="string">||                                     7|    王琢|     基于Django的智能水务系统前端开发|     1|    null|    null|    null|</span></span><br><span class="line">        <span class="string">||                                     8|    王琢|           个人账本管理微信小程序开发|     1|    null|    null|    null|</span></span><br><span class="line">        <span class="string">||                                     9|    王琢|       智能水务系统远程监控模块的开发|     1|    null|    null|    null|</span></span><br><span class="line">        <span class="string">||                                    10|  张文波|基于安卓系统的硕士研究生招生预报名...|     1|    null|    null|    null|</span></span><br><span class="line">        <span class="string">||                                    11|  张文波|面向工业互联网的联网设备故障检测技...|     1|    null|    null|    null|</span></span><br><span class="line">        <span class="string">||                                    12|  张文波|面向工业互联网的联网设备运行维护系...|     1|    null|    null|    null|</span></span><br><span class="line">        <span class="string">||                                    13|    曹烨|     疫情防控管理信息系统的设计与开发|     1|    null|    null|    null|</span></span><br><span class="line">        <span class="string">||                                    14|    曹烨|             多线程下载器的设计与开发|     1|    null|    null|    null|</span></span><br><span class="line">        <span class="string">||                                    15|    曹烨|             坦克对战游戏的设计与开发|     1|    null|    null|    null|</span></span><br><span class="line">        <span class="string">||                                    16|    曹烨|           五子棋游戏大厅的设计与开发|     1|    null|    null|    null|</span></span><br><span class="line">        <span class="string">||                                    17|    杜焱|       疫情封闭人员及物资管理系统开发|     1|    null|    null|    null|</span></span><br><span class="line">        <span class="string">||                                    18|    杜焱|                   志愿者服务系统开发|     1|    null|    null|    null|</span></span><br><span class="line">        <span class="string">||                                    19|    杜焱|         高校教师工作绩效管理系统开发|     1|    null|    null|    null|</span></span><br><span class="line">        <span class="string">|+--------------------------------------+--------+-------------------------------------+------+--------+--------+--------+</span></span><br><span class="line">        <span class="string">|only showing top 20 rows</span></span><br><span class="line">        <span class="string">|</span></span><br><span class="line">        <span class="string">|</span></span><br><span class="line">        <span class="string">|Process finished with exit code 0</span></span><br><span class="line">        <span class="string">|</span></span><br><span class="line">        <span class="string">|&quot;&quot;&quot;</span>.stripMargin</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="hive-1"><a href="#hive-1" class="headerlink" title="hive"></a>hive</h3><p>在生产上我们要对配置文件进行修改</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Configuration</span> <span class="keyword">of</span> Hive <span class="keyword">is</span> done <span class="keyword">by</span> <span class="keyword">placing</span> your hive-site.xml, core-site.xml (<span class="keyword">for</span> <span class="keyword">security</span> <span class="keyword">configuration</span>), <span class="keyword">and</span> hdfs-site.xml (<span class="keyword">for</span> HDFS <span class="keyword">configuration</span>) file <span class="keyword">in</span> conf/.</span><br></pre></td></tr></table></figure><p>直接cp hivehome 下的配置文件 hive-site.xml到spark的配置下或者做软连接到spark的配置文件下</p><p>即使hive和spark不在同一台机器上也是可以的，只不过不能做软连接了</p><p>如果缺少mysql驱动的化把mysql驱动添加到spark的jar文件夹里就好</p><p>或者用 –jars 路径 来配置启动方式</p><p>接下来我们直接执行如下语句</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">scala&gt; spark.sql(&quot;show databases&quot;).show</span></span><br><span class="line"><span class="section">+-------------+</span></span><br><span class="line"><span class="section">|    namespace|</span></span><br><span class="line"><span class="section">+-------------+</span></span><br><span class="line">|      bigdata|</span><br><span class="line">| bigdata<span class="emphasis">_hive|</span></span><br><span class="line"><span class="emphasis">|bigdata_hive2|</span></span><br><span class="line"><span class="emphasis">|bigdata_hive3|</span></span><br><span class="line"><span class="emphasis">|bigdata_</span>hive4|</span><br><span class="line">|      default|</span><br><span class="line"><span class="section">|         test|</span></span><br><span class="line"><span class="section">+-------------+</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>我们可以用spark-sql脚本来执行hive的语句</p><p>如下：</p><figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[hadoop@bigdata5 conf]$ spark-sql --master <span class="keyword">local</span>[<span class="number">4</span>]</span><br><span class="line">Setting <span class="keyword">default</span> <span class="built_in">log</span> level to <span class="string">&quot;WARN&quot;</span>.</span><br><span class="line">To adjust logging level <span class="keyword">use</span> sc.setLogLevel(newLevel). For SparkR, <span class="keyword">use</span> setLogLevel(newLevel).</span><br><span class="line"><span class="number">23</span>/<span class="number">01</span>/<span class="number">12</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">13</span> WARN NativeCodeLoader: Unable to load native-hadoop library for your platform... using builtin-java classes <span class="keyword">where</span> applicable</span><br><span class="line"><span class="number">23</span>/<span class="number">01</span>/<span class="number">12</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">15</span> WARN HiveConf: HiveConf of <span class="keyword">name</span> hive.stats.jdbc.timeout does not <span class="keyword">exist</span></span><br><span class="line"><span class="number">23</span>/<span class="number">01</span>/<span class="number">12</span> <span class="number">10</span>:<span class="number">10</span>:<span class="number">15</span> WARN HiveConf: HiveConf of <span class="keyword">name</span> hive.stats.retries.<span class="keyword">wait</span> does not <span class="keyword">exist</span></span><br><span class="line">Spark master: <span class="keyword">local</span>[<span class="number">4</span>], Application Id: <span class="keyword">local</span>-<span class="number">1673489414801</span></span><br><span class="line">spark-sql (<span class="keyword">default</span>)&gt; show databases;</span><br><span class="line">namespace</span><br><span class="line">bigdata</span><br><span class="line">bigdata_hive</span><br><span class="line">bigdata_hive2</span><br><span class="line">bigdata_hive3</span><br><span class="line">bigdata_hive4</span><br><span class="line"><span class="keyword">default</span></span><br><span class="line">test</span><br><span class="line">Time taken: <span class="number">2.213</span> seconds, Fetched <span class="number">7</span> row(s)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>我们一般都在spark-sql里进行测试sql语句，然后再通过代码部署&#x3D;》不要再sparksql里创建表会有点问题&#x3D;》尽可能再hive里键</p><p>维护数仓 &#x3D;》 可以用spark-sql -e&#x2F;-f  sql文件 &#x3D;》 推荐的方式维护离线数仓 好维护 简单</p><p>hive引擎如果改成spark &#x3D;》 不稳定 &#x3D;》 bug &#x3D;》 有的时候spark的function无法使用</p><p>hive里有的function &#x3D;》 spark始终有</p><p>但是spark里有的hive里没有</p><p>idea里也是要把hive-site放到resource文件夹里</p><p>东西很多想要什么上官网查看 <code>https://spark.apache.org/docs/latest/sql-ref-syntax.html#ddl-statements</code></p><p>idea里要提前加上依赖</p><p>如下</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">&lt;dependency&gt;</span></span><br><span class="line">  <span class="section">&lt;groupId&gt;</span><span class="attribute">org</span>.apache.spark&lt;/groupId&gt;</span><br><span class="line">  <span class="section">&lt;artifactId&gt;</span><span class="attribute">spark</span>-hive_2.<span class="number">12</span>&lt;/artifactId&gt;</span><br><span class="line">  <span class="section">&lt;version&gt;</span><span class="attribute">3</span>.<span class="number">2</span>.<span class="number">1</span>&lt;/version&gt;</span><br><span class="line"><span class="section">&lt;/dependency&gt;</span></span><br></pre></td></tr></table></figure><p>然后执行以下代码就ok了</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">package sparkfirst</span><br><span class="line"></span><br><span class="line">import org.apache.spark.sql.SparkSession</span><br><span class="line"></span><br><span class="line">object sparksql3 &#123;</span><br><span class="line">  def main(args: Array[String]): Unit = &#123;</span><br><span class="line">    val spark = SparkSession.builder().appName(<span class="string">&quot;Sparksql01&quot;</span>).master(<span class="string">&quot;local[4]&quot;</span>).enableHiveSupport().getOrCreate()</span><br><span class="line">    val frame = spark.sql(</span><br><span class="line">      <span class="string">&quot;&quot;&quot;</span></span><br><span class="line">        <span class="string">|select</span></span><br><span class="line">        <span class="string">|*</span></span><br><span class="line">        <span class="string">|from</span></span><br><span class="line">        <span class="string">|bigdata_hive3.emp</span></span><br><span class="line">        <span class="string">|&quot;&quot;&quot;</span>.stripMargin)</span><br><span class="line">    frame.show()</span><br><span class="line">    frame.printSchema()</span><br><span class="line">    val result =</span><br><span class="line">      <span class="string">&quot;&quot;&quot;</span></span><br><span class="line">        <span class="string">|+-----+--------+---------+----+--------+----+----+------+</span></span><br><span class="line">        <span class="string">||empno|   ename|      job| mgr|hiredate| sal|comm|deptno|</span></span><br><span class="line">        <span class="string">|+-----+--------+---------+----+--------+----+----+------+</span></span><br><span class="line">        <span class="string">|| 7369|   SMITH|    CLERK|7902|    null| 800|null|    20|</span></span><br><span class="line">        <span class="string">|| 7499|   ALLEN| SALESMAN|7698|    null|1600| 300|    30|</span></span><br><span class="line">        <span class="string">|| 7521|    WARD| SALESMAN|7698|    null|1250| 500|    30|</span></span><br><span class="line">        <span class="string">|| 7566|   JONES|  MANAGER|7839|    null|2975|null|    20|</span></span><br><span class="line">        <span class="string">|| 7654|  MARTIN| SALESMAN|7698|    null|1250|1400|    30|</span></span><br><span class="line">        <span class="string">|| 7698|   BLAKE|  MANAGER|7839|    null|2850|null|    30|</span></span><br><span class="line">        <span class="string">|| 7782|   CLARK|  MANAGER|7839|    null|2450|null|    10|</span></span><br><span class="line">        <span class="string">|| 7788|   SCOTT|  ANALYST|7566|    null|3000|null|    20|</span></span><br><span class="line">        <span class="string">|| 7839|    KING|PRESIDENT|null|    null|5000|null|    10|</span></span><br><span class="line">        <span class="string">|| 7844|  TURNER| SALESMAN|7698|    null|1500|   0|    30|</span></span><br><span class="line">        <span class="string">|| 7876|   ADAMS|    CLERK|7788|    null|1100|null|    20|</span></span><br><span class="line">        <span class="string">|| 7900|lebulang|    CLERK|7698|    null| 950|null|    30|</span></span><br><span class="line">        <span class="string">|| 7902|    FORD|  ANALYST|7566|    null|3000|null|    20|</span></span><br><span class="line">        <span class="string">|| 7934|  MILLER|    CLERK|7782|    null|1300|null|    10|</span></span><br><span class="line">        <span class="string">|| 7839|    KING|PRESIDENT|null|    null|5000|null|    10|</span></span><br><span class="line">        <span class="string">|| 7654|  MARTIN| SALESMAN|7698|    null|3200|1400|    30|</span></span><br><span class="line">        <span class="string">|| 7788|   SCOTT|  ANALYST|7566|    null|3000|null|    20|</span></span><br><span class="line">        <span class="string">|| 7788|   SCOTT|  ANALYST|7566|    null|3000|null|    20|</span></span><br><span class="line">        <span class="string">|| 7788|   SCOTT|  ANALYST|7566|    null|3000|null|    20|</span></span><br><span class="line">        <span class="string">|| 7788|   SCOTT|  ANALYST|7566|    null|3000|null|    20|</span></span><br><span class="line">        <span class="string">|+-----+--------+---------+----+--------+----+----+------+</span></span><br><span class="line">        <span class="string">|only showing top 20 rows</span></span><br><span class="line">        <span class="string">|</span></span><br><span class="line">        <span class="string">|root</span></span><br><span class="line">        <span class="string">| |-- empno: string (nullable = true)</span></span><br><span class="line">        <span class="string">| |-- ename: string (nullable = true)</span></span><br><span class="line">        <span class="string">| |-- job: string (nullable = true)</span></span><br><span class="line">        <span class="string">| |-- mgr: long (nullable = true)</span></span><br><span class="line">        <span class="string">| |-- hiredate: date (nullable = true)</span></span><br><span class="line">        <span class="string">| |-- sal: decimal(10,0) (nullable = true)</span></span><br><span class="line">        <span class="string">| |-- comm: decimal(10,0) (nullable = true)</span></span><br><span class="line">        <span class="string">| |-- deptno: long (nullable = true)</span></span><br><span class="line">        <span class="string">|</span></span><br><span class="line">        <span class="string">|</span></span><br><span class="line">        <span class="string">|Process finished with exit code 0</span></span><br><span class="line">        <span class="string">|</span></span><br><span class="line">        <span class="string">|&quot;&quot;&quot;</span>.stripMargin</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="写数据"><a href="#写数据" class="headerlink" title="写数据"></a>写数据</h2><p>写数据的时候一般会伴随crc文件</p><h3 id="TEXT-2"><a href="#TEXT-2" class="headerlink" title="TEXT"></a>TEXT</h3><p>注意text仅仅支持一列的数据进行输出，不支持多列，因为我们的resource文件夹里有配置文件所以它走我们的配置文件压缩格式为bz2，不过可以自己指定格式，一般不指定且无配置文件是不压缩的</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">package sparkfirst</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.<span class="keyword">sql</span>.SparkSession</span><br><span class="line"></span><br><span class="line"><span class="keyword">object</span> sparksql2 &#123;</span><br><span class="line">  def main(args: <span class="keyword">Array</span>[String]): Unit = &#123;</span><br><span class="line">    val spark = SparkSession.builder().appName(&quot;Sparksql01&quot;).master(&quot;local[4]&quot;).getOrCreate()</span><br><span class="line">    val df2 = spark.<span class="keyword">read</span>.<span class="keyword">option</span>(&quot;lineSep&quot;,&quot;,&quot;).text(&quot;file:///D:\\test.txt&quot;)</span><br><span class="line">    df2.<span class="keyword">show</span>()</span><br><span class="line">    //<span class="comment">-----------------------------------------写数据</span></span><br><span class="line">    df2.<span class="keyword">write</span>.text(&quot;file:///D:\\test1.txt&quot;)</span><br><span class="line">    //<span class="comment">-------------------------------------------加压缩</span></span><br><span class="line">    df2.<span class="keyword">write</span>.<span class="keyword">option</span>(&quot;compression&quot;, &quot;gzip&quot;).text(&quot;file:///D:\\test2.txt&quot;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>如果想解决，要自己定义外部数据源，相当于自己修改源码</p><p>或者把dataframe变成rdd进行输出 因为saveasTextFile是可以多列输出的</p><p><code>df2.rdd.saveAsTextFile(&quot;file:///D:\\test3.txt&quot;)</code></p><p><img src="https://pic.imgdb.cn/item/63be1a9cbe43e0d30e184271.jpg"></p><p>查看文件格式</p><p><img src="https://pic.imgdb.cn/item/63be1ad7be43e0d30e18aa99.jpg"></p><h3 id="json-2"><a href="#json-2" class="headerlink" title="json"></a>json</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">//</span>常用的输出方式追加append，或者覆盖(overwrite),或者忽略（ignore），错误等（error）</span><br><span class="line"><span class="regexp">//</span>df.write.mode(saveMode = <span class="string">&quot;overwrite&quot;</span>).json(<span class="string">&quot;hdfs://bigdata3:9000/spark&quot;</span>)</span><br></pre></td></tr></table></figure><h3 id="csv-2"><a href="#csv-2" class="headerlink" title="csv"></a>csv</h3><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//写出可以用sep进行设置导出的分隔符，mode设置是不是覆盖，compression设置压缩</span></span><br><span class="line">  df5<span class="selector-class">.write</span><span class="selector-class">.options</span>(<span class="built_in">Map</span>(<span class="string">&quot;sep&quot;</span>-&gt;<span class="string">&quot;;&quot;</span>,<span class="string">&quot;compression&quot;</span>-&gt;<span class="string">&quot;gzip&quot;</span>))<span class="selector-class">.mode</span>(<span class="string">&quot;overwrite&quot;</span>)<span class="selector-class">.format</span>(<span class="string">&quot;csv&quot;</span>)<span class="selector-class">.save</span>(<span class="string">&quot;file:///C:\\Users\\dell\\Desktop\\user_profile1.csv&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>结果如下</p><p><img src="https://pic.imgdb.cn/item/63be621fbe43e0d30e93423c.jpg"></p><h3 id="JDBC"><a href="#JDBC" class="headerlink" title="JDBC"></a>JDBC</h3><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//写出 --------------------------代码</span></span><br><span class="line">    <span class="comment">//如果用overwrite，会把之前的表删掉，然后重新建一个，表的数据结构会发生改变</span></span><br><span class="line">    df<span class="selector-class">.write</span><span class="selector-class">.mode</span>(<span class="string">&quot;append&quot;</span>)</span><br><span class="line">      <span class="selector-class">.format</span>(<span class="string">&quot;jdbc&quot;</span>)</span><br><span class="line">      <span class="selector-class">.option</span>(<span class="string">&quot;url&quot;</span>, <span class="string">&quot;jdbc:mysql://bigdata2:3306/try&quot;</span>)</span><br><span class="line">      <span class="selector-class">.option</span>(<span class="string">&quot;dbtable&quot;</span>, <span class="string">&quot;emp1&quot;</span>)</span><br><span class="line">      <span class="selector-class">.option</span>(<span class="string">&quot;user&quot;</span>, <span class="string">&quot;root&quot;</span>)</span><br><span class="line">      <span class="selector-class">.option</span>(<span class="string">&quot;password&quot;</span>, <span class="string">&quot;liuzihan010616&quot;</span>)</span><br><span class="line">      <span class="selector-class">.save</span>()</span><br><span class="line">      <span class="comment">// --------------------------Properties</span></span><br><span class="line">    df<span class="selector-class">.write</span><span class="selector-class">.mode</span>(<span class="string">&quot;append&quot;</span>)</span><br><span class="line">      <span class="selector-class">.jdbc</span>(<span class="string">&quot;jdbc:mysql://bigdata2:3306/try&quot;</span>, <span class="string">&quot;emp1&quot;</span>, connectionProperties)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 可以在写的时候多创建列</span></span><br><span class="line">    df<span class="selector-class">.write</span><span class="selector-class">.mode</span>(<span class="string">&quot;append&quot;</span>)</span><br><span class="line">      <span class="selector-class">.option</span>(<span class="string">&quot;createTableColumnTypes&quot;</span>, <span class="string">&quot;name CHAR(64), comments VARCHAR(1024)&quot;</span>)</span><br><span class="line">      <span class="selector-class">.jdbc</span>(<span class="string">&quot;jdbc:mysql://bigdata2:3306/try&quot;</span>, <span class="string">&quot;try.emp&quot;</span>, connectionProperties)</span><br></pre></td></tr></table></figure><h3 id="excel-2"><a href="#excel-2" class="headerlink" title="excel"></a>excel</h3><p>如下</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df<span class="selector-class">.write</span><span class="selector-class">.mode</span>(<span class="string">&quot;overwrite&quot;</span>)<span class="selector-class">.excel</span>(<span class="selector-tag">header</span> = true,<span class="string">&quot;A1&quot;</span>)<span class="selector-class">.save</span>(<span class="string">&quot;file:///C:\\Users\\dell\\Desktop\\2023届毕业设计题目-计算机-选题志愿表1.xlsx&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="hive-2"><a href="#hive-2" class="headerlink" title="hive"></a>hive</h3><p>一共有几种方法</p><ul><li>ctas</li></ul><figure class="highlight pony"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line">  <span class="meta">val</span> spark = <span class="type">SparkSession</span>.builder().appName(<span class="string">&quot;Sparksql01&quot;</span>).master(<span class="string">&quot;local[4]&quot;</span>).enableHiveSupport().getOrCreate()</span><br><span class="line">  def main(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line"></span><br><span class="line">    spark.sql(</span><br><span class="line">      <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        |create table bigdata.sparkfinish as</span></span><br><span class="line"><span class="string">        |select</span></span><br><span class="line"><span class="string">        |*</span></span><br><span class="line"><span class="string">        |from(</span></span><br><span class="line"><span class="string">        |select</span></span><br><span class="line"><span class="string">        |area,</span></span><br><span class="line"><span class="string">        |product_name,</span></span><br><span class="line"><span class="string">        |rank() over(partition by area order by cnt) as rk</span></span><br><span class="line"><span class="string">        |from (</span></span><br><span class="line"><span class="string">        |select</span></span><br><span class="line"><span class="string">        |area,</span></span><br><span class="line"><span class="string">        |product_name,</span></span><br><span class="line"><span class="string">        |count(1) as cnt</span></span><br><span class="line"><span class="string">        |from bigdata.tmp</span></span><br><span class="line"><span class="string">        |group by area,product_name</span></span><br><span class="line"><span class="string">        |)</span></span><br><span class="line"><span class="string">        |)where rk &lt; 3;</span></span><br><span class="line"><span class="string">        |&quot;&quot;&quot;</span>.stripMargin)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// --------------------------------------insert into  数据追加</span></span><br><span class="line">    spark.sql(</span><br><span class="line">      <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        |insert into table bigdata.sparkfinish</span></span><br><span class="line"><span class="string">        |select * from bigdata.sparkfinish</span></span><br><span class="line"><span class="string">        |&quot;&quot;&quot;</span>.stripMargin)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ----------------------------------------数据覆盖</span></span><br><span class="line">    spark.sql(</span><br><span class="line">      <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        |insert overwrite table bigdata.sparkfinish</span></span><br><span class="line"><span class="string">        |select * from bigdata.sparkfinish</span></span><br><span class="line"><span class="string">        |&quot;&quot;&quot;</span>.stripMargin)</span><br><span class="line">    <span class="comment">// ----------------------------------------分区表 emp_partition是元数据分区表 emp_partition1是后来键的分区表</span></span><br><span class="line">    <span class="comment">// ---------------------------------------执行动态分区的时候要配置参数 静态分区不用</span></span><br><span class="line">    spark.conf.set(<span class="string">&quot;hive.exec.dynamic.partition.mode&quot;</span>,<span class="string">&quot;nonstrict&quot;</span>)</span><br><span class="line">    spark.conf.set(<span class="string">&quot;hive.exec.dynamic.partition&quot;</span>,<span class="string">&quot;true&quot;</span>)</span><br><span class="line">    spark.sql(</span><br><span class="line">      <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        |insert overwrite table bigdata_hive3.emp_partition1 partition(deptno)</span></span><br><span class="line"><span class="string">        |select * from bigdata_hive3.emp_partition</span></span><br><span class="line"><span class="string">        |&quot;&quot;&quot;</span>.stripMargin)</span><br><span class="line"><span class="comment">//-----------------------------------------------------------------api</span></span><br><span class="line">  <span class="meta">val</span> frame = checksql(hivesqlchoose(<span class="string">&quot;empno , ename , job , mgr , deptno &quot;</span>, <span class="string">&quot;bigdata_hive3.emp&quot;</span>, <span class="string">&quot;where sal &gt; 3000&quot;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment">// -----------------------------这里如果用覆盖模式是会把整个表都弄美哦然后重新建表到数据的，所以一般不用，放置我们只对一个分区数据进行操作的时候别的数据不见</span></span><br><span class="line">    <span class="comment">// -------------------------------------普通表</span></span><br><span class="line">    frame.write.mode(saveMode = <span class="string">&quot;append&quot;</span>).format(<span class="string">&quot;hive&quot;</span>).saveAsTable(<span class="string">&quot;bigdata_hive3.emp89&quot;</span>)</span><br><span class="line">        spark.conf.set(<span class="string">&quot;hive.exec.dynamic.partition.mode&quot;</span>,<span class="string">&quot;nonstrict&quot;</span>)</span><br><span class="line">        spark.conf.set(<span class="string">&quot;hive.exec.dynamic.partition&quot;</span>,<span class="string">&quot;true&quot;</span>)</span><br><span class="line">    <span class="comment">// -------------------------------------分区表</span></span><br><span class="line">    frame.write.partitionBy(<span class="string">&quot;deptno&quot;</span>).mode(saveMode = <span class="string">&quot;append&quot;</span>).format(<span class="string">&quot;hive&quot;</span>).saveAsTable(<span class="string">&quot;bigdata_hive3.emp891&quot;</span>)</span><br><span class="line">    <span class="comment">// ---------------------------------------insertInto 插入数据 如果是用于分区表它会自动使用动态分区 对普通表可以</span></span><br><span class="line">    <span class="comment">// Exception in thread &quot;main&quot; org.apache.spark.sql.AnalysisException:  insertInto() can&#x27;t be used together with partitionBy(). Partition columns have already been defined for the table. It is not necessary to use partitionBy().</span></span><br><span class="line">    <span class="comment">//frame.write.partitionBy(&quot;deptno&quot;).mode(saveMode = &quot;overwrite&quot;).format(&quot;hive&quot;).insertInto(&quot;bigdata_hive3.emp891&quot;)</span></span><br><span class="line">    <span class="comment">// 可以把数据作为路径写入到hdfs上 ，写入他对应的table path下</span></span><br><span class="line"></span><br><span class="line">    frame.select(<span class="string">&quot;empno&quot;</span>,<span class="string">&quot;ename&quot;</span>,<span class="string">&quot;job&quot;</span>,<span class="string">&quot;mgr&quot;</span>).write.mode(<span class="string">&quot;overwrite&quot;</span>).parquet(<span class="string">&quot;hdfs://bigdata3:9000/user/hive/warehouse/bigdata_hive3.db/emp_partition1/deptno=20&quot;</span>)</span><br><span class="line">    <span class="comment">// 对于普通表这样写入是ok的，但是对于分区表 因为元数据的不同 所以可能会导致元数据关联不上</span></span><br><span class="line">    <span class="comment">// 修复元数据库就ok了</span></span><br><span class="line">    <span class="comment">// 注意这里要是parquet的存储格式的或者orc的，如果是text的会成乱码</span></span><br><span class="line">    <span class="comment">// 修复元数据</span></span><br><span class="line">    <span class="comment">// msck repair table table_name [ADD/DROP/SYNC partition]</span></span><br><span class="line">    <span class="comment">// 或者通过rdd的方法进行存储</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  def hivesqlchoose(string: <span class="type">String</span>*)=&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">val</span> str = <span class="string">&quot;select&quot;</span> + <span class="string">&quot; &quot;</span> + string(<span class="number">0</span>) + <span class="string">&quot; &quot;</span> + <span class="string">&quot;from&quot;</span> + <span class="string">&quot; &quot;</span> +  string(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">if</span> (string.length &gt; <span class="number">2</span>)&#123;</span><br><span class="line">      str +<span class="string">&quot; &quot;</span> + string(<span class="number">2</span>)</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      str</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  def descfunctionsql(string: <span class="type">String</span>)=&#123;</span><br><span class="line">    s<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">      |desc function extended $string</span></span><br><span class="line"><span class="string">      |&quot;&quot;&quot;</span>.stripMargin</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  def checksql(string: <span class="type">String</span>)=&#123;</span><br><span class="line">    spark.sql(string).show(<span class="literal">false</span>)</span><br><span class="line">    spark.sql(string)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content:encoded>
      
      
      <category domain="http://zihang.fun/categories/%E6%97%A5%E5%BF%97/">日志</category>
      
      
      <category domain="http://zihang.fun/tags/spark/">spark</category>
      
      
      <comments>http://zihang.fun/2023/01/11/1-11/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>sparksql</title>
      <link>http://zihang.fun/2023/01/10/1-10/</link>
      <guid>http://zihang.fun/2023/01/10/1-10/</guid>
      <pubDate>Tue, 10 Jan 2023 01:04:20 GMT</pubDate>
      
        
        
      <description>&lt;h1 id=&quot;sparksql&quot;&gt;&lt;a href=&quot;#sparksql&quot; class=&quot;headerlink&quot; title=&quot;sparksql&quot;&gt;&lt;/a&gt;sparksql&lt;/h1&gt;&lt;p&gt;sparksql主要是处理结构化数据的 模块&lt;/p&gt;
&lt;p&gt;结构化数据 &amp;#x3D;》 带有</description>
        
      
      
      
      <content:encoded><![CDATA[<h1 id="sparksql"><a href="#sparksql" class="headerlink" title="sparksql"></a>sparksql</h1><p>sparksql主要是处理结构化数据的 模块</p><p>结构化数据 &#x3D;》 带有schema信息的数据</p><p>半结构化数据 &#x3D; 》csv ， json ， orc ， parquet</p><p>非结构化数据 &#x3D;》 nosql &#x3D;》 redis , hbase</p><p>sparksql &#x3D;&gt; 不仅可以写sql 还可以编程</p><h2 id="特性"><a href="#特性" class="headerlink" title="特性"></a>特性</h2><p>sparksql &#x3D;》 sql + dataframeapi &#x3D;》 处理结构化数据</p><p>spark-core里的api这里也通用</p><p>有个统一的数据接口 &#x3D;》 处理多种外部数据源 &#x3D;》 mysql&#x2F;hive&#x2F;excel&#x2F;csv&#x2F;….. &#x3D;》统一的api</p><p>整合hive &#x3D;》 使用hive非常简单</p><p>sparksql 不仅仅是sql</p><p>hive on spark &#x3D;》 hive的查询引擎是spark</p><p>spark on hive &#x3D;》 sparksql 去hive上查数据 大部分人用这个</p><p>sparksql做了性能优化 &#x3D;》 比RDD 高</p><h2 id="基本介绍"><a href="#基本介绍" class="headerlink" title="基本介绍"></a>基本介绍</h2><p>sparksql比RDD的性能高原因：</p><p>sparksql底层跑的还是spark -core的RDD 只不过是做了优化</p><p>因为用户开发的schema</p><p>saprkcore &#x3D;&gt; 编程模型 RDD</p><p>sparksql &#x3D;》 RDD[数据集] + schema[字段 字段类型] &#x3D;》 table</p><h2 id="DataSet-amp-DataFrame"><a href="#DataSet-amp-DataFrame" class="headerlink" title="DataSet&amp;DataFrame"></a>DataSet&amp;DataFrame</h2><p>sparksql : 编程模型 &#x3D;》 dataSet&#x2F;dataframe</p><h3 id="dataset"><a href="#dataset" class="headerlink" title="dataset"></a>dataset</h3><p>分布式数据集</p><p>比RDD多出很多优势 &#x3D;》做了很多优化 &#x3D;》 效率高 &#x3D;》 使用了强类型 &#x3D;》 可以使用算子 &#x3D; 》查询性能高 &#x3D;》 spark1.6之后诞生的</p><p>Py不支持dataset的api</p><h3 id="dataframe"><a href="#dataframe" class="headerlink" title="dataframe"></a>dataframe</h3><p>dataeframe &#x3D;》 也是一个dataset</p><p>dataframe &#x3D;》 普通数据库里的一个table &#x3D;》 可以使用算子 &#x3D;》 dataset的rows</p><p>Row&#x3D;》一行数据，仅仅包含列数据</p><p>dataframe &#x3D;》table</p><h3 id="和spark-core对比"><a href="#和spark-core对比" class="headerlink" title="和spark-core对比"></a>和spark-core对比</h3><p>spare-core  &#x3D;》 rdd</p><p>sparksql &#x3D;》 df [RDD数据集 + 额外的信息scheme]</p><p>sparksql ：</p><ul><li>1.0 &#x3D;》schemaRdd ：RDD 存数据 + scheme（类似元数据：存储额外的信息）</li><li>1.6 &#x3D; 》dataset &#x3D;》 dataframe 变过来的</li></ul><h2 id="使用sparksession创建dataframe"><a href="#使用sparksession创建dataframe" class="headerlink" title="使用sparksession创建dataframe"></a>使用sparksession创建dataframe</h2><p>工具 ： idea，linux</p><p>引入 ： sparksql依赖</p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.spark<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spark-sql_2.12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.2.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">     <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.hadoop<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hadoop-mapreduce-client-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$</span><span class="template-variable">&#123;hadoop.version&#125;</span><span class="language-xml"><span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.hive<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hive-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$</span><span class="template-variable">&#123;hive.version&#125;</span><span class="language-xml"><span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h3 id="linux"><a href="#linux" class="headerlink" title="linux"></a>linux</h3><p>在linux里启动spark-shell的时候他会给你自动提供好spark-session</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[hadoop@bigdata5 ~]$ spark-shell --master local[<span class="number">4</span>]</span><br><span class="line">Setting <span class="keyword">default</span> log level to <span class="string">&quot;WARN&quot;</span>.</span><br><span class="line">To adjust logging level use sc.setLogLevel(newLevel). <span class="keyword">For</span> SparkR, use setLogLevel(newLevel).</span><br><span class="line"><span class="number">23</span><span class="regexp">/01/</span><span class="number">10</span> <span class="number">10</span>:<span class="number">11</span>:<span class="number">22</span> WARN NativeCodeLoader: Unable to load <span class="keyword">native</span>-hadoop library <span class="keyword">for</span> your platform... using builtin-java classes where applicable</span><br><span class="line">Spark context Web UI available at http:<span class="comment">//bigdata5:4040</span></span><br><span class="line">Spark context available as <span class="string">&#x27;sc&#x27;</span> (master = local[<span class="number">4</span>], app id = local-<span class="number">1673316684351</span>).</span><br><span class="line">Spark session available as <span class="string">&#x27;spark&#x27;</span>.</span><br><span class="line">Welcome to</span><br><span class="line">      ____              __</span><br><span class="line">     <span class="regexp">/ __/</span>__  ___ _____<span class="regexp">/ /</span>__</span><br><span class="line">    _\ \<span class="regexp">/ _ \/ _ `/</span> __<span class="regexp">/  &#x27;_/</span></span><br><span class="line">   <span class="regexp">/___/</span> .__<span class="regexp">/\_,_/</span>_<span class="regexp">/ /</span>_/\_\   version <span class="number">3.3</span>.<span class="number">1</span></span><br><span class="line">      <span class="regexp">/_/</span></span><br><span class="line">   </span><br><span class="line">Using Scala version <span class="number">2.12</span>.<span class="number">15</span> (Java HotSpot(TM) <span class="number">64</span>-Bit Server VM, Java <span class="number">1.8</span>.<span class="number">0</span>_45)</span><br><span class="line">Type in expressions to have them evaluated.</span><br><span class="line">Type :help <span class="keyword">for</span> more information.</span><br><span class="line"></span><br><span class="line">scala&gt; </span><br><span class="line"></span><br></pre></td></tr></table></figure><p>创建df如下</p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">scala&gt; val df = spark.read.json(<span class="string">&quot;file:///home/hadoop/data/json/Skills.json&quot;</span>)</span><br><span class="line">df: org.apache.spark.sql.DataFrame = [_corrupt_record: string, animationId: bigint ... 24 more fields]</span><br><span class="line"></span><br><span class="line">scala&gt; df.show</span><br><span class="line">23/01/10 10:14:42 WARN package: Truncated the string representation of a plan since it was too large. This behavior can be adjusted by setting &#x27;spark.sql.debug.maxToStringFields&#x27;.</span><br><span class="line">+---------------+-----------+--------------------+-----------------------------------+--------------------+-------+---------+----+----------------+--------+-----------+------+--------+----------------------------------+--------+-------+---------------+----------------+----------------+-----+-----+-------+-----------+------+------+----------+</span><br><span class="line">|<span class="string">_corrupt_record</span>|<span class="string">animationId</span>|<span class="string">              damage</span>|<span class="string">                        description</span>|<span class="string">             effects</span>|<span class="string">hitType</span>|<span class="string">iconIndex</span>|<span class="string">  id</span>|<span class="string">        message1</span>|<span class="string">message2</span>|<span class="string">messageType</span>|<span class="string">mpCost</span>|<span class="string">    name</span>|<span class="string">                              note</span>|<span class="string">occasion</span>|<span class="string">repeats</span>|<span class="string">requiredWtypeId</span>|<span class="string">requiredWtypeId1</span>|<span class="string">requiredWtypeId2</span>|<span class="string">scope</span>|<span class="string">speed</span>|<span class="string">stypeId</span>|<span class="string">successRate</span>|<span class="string">tpCost</span>|<span class="string">tpGain</span>|<span class="string">xianliCost</span>|</span><br><span class="line">+---------------+-----------+--------------------+-----------------------------------+--------------------+-------+---------+----+----------------+--------+-----------+------+--------+----------------------------------+--------+-------+---------------+----------------+----------------+-----+-----+-------+-----------+------+------+----------+</span><br><span class="line">|<span class="string">              [</span>|<span class="string">       null</span>|<span class="string">                null</span>|<span class="string">                               null</span>|<span class="string">                null</span>|<span class="string">   null</span>|<span class="string">     null</span>|<span class="string">null</span>|<span class="string">            null</span>|<span class="string">    null</span>|<span class="string">       null</span>|<span class="string">  null</span>|<span class="string">    null</span>|<span class="string">                              null</span>|<span class="string">    null</span>|<span class="string">   null</span>|<span class="string">           null</span>|<span class="string">            null</span>|<span class="string">            null</span>|<span class="string"> null</span>|<span class="string"> null</span>|<span class="string">   null</span>|<span class="string">       null</span>|<span class="string">  null</span>|<span class="string">  null</span>|<span class="string">      null</span>|</span><br><span class="line">|<span class="string">          null,</span>|<span class="string">       null</span>|<span class="string">                null</span>|<span class="string">                               null</span>|<span class="string">                null</span>|<span class="string">   null</span>|<span class="string">     null</span>|<span class="string">null</span>|<span class="string">            null</span>|<span class="string">    null</span>|<span class="string">       null</span>|<span class="string">  null</span>|<span class="string">    null</span>|<span class="string">                              null</span>|<span class="string">    null</span>|<span class="string">   null</span>|<span class="string">           null</span>|<span class="string">            null</span>|<span class="string">            null</span>|<span class="string"> null</span>|<span class="string"> null</span>|<span class="string">   null</span>|<span class="string">       null</span>|<span class="string">  null</span>|<span class="string">  null</span>|<span class="string">      null</span>|</span><br><span class="line">|<span class="string">           null</span>|<span class="string">          1</span>|<span class="string">&#123;true, -1, a.atk ...</span>|<span class="string">                                   </span>|<span class="string">   [&#123;21, 0, 1.0, 0&#125;]</span>|<span class="string">      1</span>|<span class="string">      880</span>|<span class="string">   1</span>|<span class="string">      %1的攻击！</span>|<span class="string">        </span>|<span class="string">          1</span>|<span class="string">     0</span>|<span class="string">    攻击</span>|<span class="string"> 1 号技能会在选择“攻击”指令时使...</span>|<span class="string">       1</span>|<span class="string">      1</span>|<span class="string">           null</span>|<span class="string">               0</span>|<span class="string">               0</span>|<span class="string">    1</span>|<span class="string">    0</span>|<span class="string">      0</span>|<span class="string">        100</span>|<span class="string">     0</span>|<span class="string">    10</span>|<span class="string">      null</span>|</span><br><span class="line">|<span class="string">           null</span>|<span class="string">          0</span>|<span class="string">&#123;false, 0, 0, 0, 20&#125;</span>|<span class="string">                                   </span>|<span class="string">   [&#123;21, 2, 1.0, 0&#125;]</span>|<span class="string">      0</span>|<span class="string">      688</span>|<span class="string">   2</span>|<span class="string">%1正在保护自己。</span>|<span class="string">        </span>|<span class="string">          1</span>|<span class="string">     0</span>|<span class="string">    防御</span>|<span class="string">1 号技能会在选择“防御”指令时使用。</span>|<span class="string">       1</span>|<span class="string">      1</span>|<span class="string">           null</span>|<span class="string">               0</span>|<span class="string">               0</span>|<span class="string">   11</span>|<span class="string">   10</span>|<span class="string">      0</span>|<span class="string">        100</span>|<span class="string">     0</span>|<span class="string">    10</span>|<span class="string">      null</span>|</span><br><span class="line">|<span class="string">           null</span>|<span class="string">         -1</span>|<span class="string">&#123;true, -1, a.atk ...</span>|<span class="string">                                   </span>|<span class="string">   [&#123;21, 0, 1.0, 0&#125;]</span>|<span class="string">      1</span>|<span class="string">      880</span>|<span class="string">   3</span>|<span class="string">      %1的攻击！</span>|<span class="string">        </span>|<span class="string">          1</span>|<span class="string">     0</span>|<span class="string">连续攻击</span>|<span class="string">                                  </span>|<span class="string">       1</span>|<span class="string">      2</span>|<span class="string">           null</span>|<span class="string">               0</span>|<span class="string">               0</span>|<span class="string">    1</span>|<span class="string">    0</span>|<span class="string">      2</span>|<span class="string">        100</span>|<span class="string">     0</span>|<span class="string">     5</span>|<span class="string">      null</span>|</span><br><span class="line">|<span class="string">           null</span>|<span class="string">         -1</span>|<span class="string">&#123;true, -1, a.atk ...</span>|<span class="string">                                   </span>|<span class="string">   [&#123;21, 0, 1.0, 0&#125;]</span>|<span class="string">      1</span>|<span class="string">      880</span>|<span class="string">   4</span>|<span class="string">      %1的攻击！</span>|<span class="string">        </span>|<span class="string">          1</span>|<span class="string">     0</span>|<span class="string">两次攻击</span>|<span class="string">                                  </span>|<span class="string">       1</span>|<span class="string">      1</span>|<span class="string">           null</span>|<span class="string">               0</span>|<span class="string">               0</span>|<span class="string">    4</span>|<span class="string">    0</span>|<span class="string">      0</span>|<span class="string">        100</span>|<span class="string">     0</span>|<span class="string">     5</span>|<span class="string">      null</span>|</span><br><span class="line">|<span class="string">           null</span>|<span class="string">         -1</span>|<span class="string">&#123;true, -1, a.atk ...</span>|<span class="string">                                   </span>|<span class="string">   [&#123;21, 0, 1.0, 0&#125;]</span>|<span class="string">      1</span>|<span class="string">      849</span>|<span class="string">   5</span>|<span class="string">      %1的攻击！</span>|<span class="string">        </span>|<span class="string">          1</span>|<span class="string">     0</span>|<span class="string">三次攻击</span>|<span class="string">                                  </span>|<span class="string">       1</span>|<span class="string">      1</span>|<span class="string">           null</span>|<span class="string">               0</span>|<span class="string">               0</span>|<span class="string">    5</span>|<span class="string">    0</span>|<span class="string">      0</span>|<span class="string">        100</span>|<span class="string">     0</span>|<span class="string">     4</span>|<span class="string">      null</span>|</span><br><span class="line">|<span class="string">           null</span>|<span class="string">          0</span>|<span class="string">&#123;false, 0, 0, 0, 20&#125;</span>|<span class="string">                                   </span>|<span class="string">   [&#123;41, 0, 0.0, 0&#125;]</span>|<span class="string">      0</span>|<span class="string">      883</span>|<span class="string">   6</span>|<span class="string">      %1逃跑了。</span>|<span class="string">        </span>|<span class="string">          1</span>|<span class="string">     0</span>|<span class="string">    逃跑</span>|<span class="string">                                  </span>|<span class="string">       1</span>|<span class="string">      1</span>|<span class="string">           null</span>|<span class="string">               0</span>|<span class="string">               0</span>|<span class="string">   11</span>|<span class="string">    0</span>|<span class="string">      0</span>|<span class="string">        100</span>|<span class="string">     0</span>|<span class="string">     0</span>|<span class="string">      null</span>|</span><br><span class="line">|<span class="string">           null</span>|<span class="string">          0</span>|<span class="string">&#123;false, 0, 0, 0, 20&#125;</span>|<span class="string">                                   </span>|<span class="string">                  []</span>|<span class="string">      0</span>|<span class="string">      979</span>|<span class="string">   7</span>|<span class="string">    %1正在观望。</span>|<span class="string">        </span>|<span class="string">          1</span>|<span class="string">     0</span>|<span class="string">    观望</span>|<span class="string">                                  </span>|<span class="string">       1</span>|<span class="string">      1</span>|<span class="string">           null</span>|<span class="string">               0</span>|<span class="string">               0</span>|<span class="string">    0</span>|<span class="string">    0</span>|<span class="string">      0</span>|<span class="string">        100</span>|<span class="string">     0</span>|<span class="string">    10</span>|<span class="string">      null</span>|</span><br><span class="line">|<span class="string">           null</span>|<span class="string">         41</span>|<span class="string">&#123;false, 0, 200 + ...</span>|<span class="string">                                   </span>|<span class="string">[&#123;21, 4, 1.0, 0&#125;,...</span>|<span class="string">      0</span>|<span class="string">       72</span>|<span class="string">   8</span>|<span class="string">    %1吟唱了%2！</span>|<span class="string">        </span>|<span class="string">          1</span>|<span class="string">     5</span>|<span class="string">    治愈</span>|<span class="string">                                  </span>|<span class="string">       0</span>|<span class="string">      1</span>|<span class="string">           null</span>|<span class="string">               0</span>|<span class="string">               0</span>|<span class="string">    1</span>|<span class="string">    0</span>|<span class="string">      1</span>|<span class="string">        100</span>|<span class="string">     0</span>|<span class="string">    10</span>|<span class="string">      null</span>|</span><br><span class="line">|<span class="string">           null</span>|<span class="string">         66</span>|<span class="string">&#123;false, 2, 100 + ...</span>|<span class="string"> 魔法\n初级的圣光技能,能召唤微弱...</span>|<span class="string">  [&#123;44, 30, 1.0, 0&#125;]</span>|<span class="string">      2</span>|<span class="string">       64</span>|<span class="string">   9</span>|<span class="string">    %1吟唱了%2！</span>|<span class="string">        </span>|<span class="string">          1</span>|<span class="string">     5</span>|<span class="string">    火焰</span>|<span class="string">                                  </span>|<span class="string">       1</span>|<span class="string">      1</span>|<span class="string">           null</span>|<span class="string">               0</span>|<span class="string">               0</span>|<span class="string">    1</span>|<span class="string">    0</span>|<span class="string">      1</span>|<span class="string">        100</span>|<span class="string">     0</span>|<span class="string">    10</span>|<span class="string">      null</span>|</span><br><span class="line">|<span class="string">           null</span>|<span class="string">          0</span>|<span class="string">&#123;false, 2, 285 + ...</span>|<span class="string">呼吸法\n常见的呼吸法，运转时能够...</span>|<span class="string">  [&#123;21, 21, 1.0, 0&#125;]</span>|<span class="string">      0</span>|<span class="string">     3084</span>|<span class="string">  10</span>|<span class="string">    %1施放了%2！</span>|<span class="string">        </span>|<span class="string">          1</span>|<span class="string">     0</span>|<span class="string">小吐纳法</span>|<span class="string">              &lt;Cast Animation: ...</span>|<span class="string">       0</span>|<span class="string">      1</span>|<span class="string">           null</span>|<span class="string">               0</span>|<span class="string">               0</span>|<span class="string">   11</span>|<span class="string">    0</span>|<span class="string">      4</span>|<span class="string">        100</span>|<span class="string">     0</span>|<span class="string">     0</span>|<span class="string">      null</span>|</span><br><span class="line">|<span class="string">           null</span>|<span class="string">        152</span>|<span class="string">&#123;false, 2, 285 + ...</span>|<span class="string">                                   </span>|<span class="string">[&#123;21, 153, 1.0, 0...</span>|<span class="string">      0</span>|<span class="string">      499</span>|<span class="string">  11</span>|<span class="string">    %1使用了%2！</span>|<span class="string">        </span>|<span class="string">          1</span>|<span class="string">     0</span>|<span class="string">  灭魂术</span>|<span class="string">              &lt;Cast Animation: 0&gt; </span>|<span class="string">       1</span>|<span class="string">      1</span>|<span class="string">           null</span>|<span class="string">               0</span>|<span class="string">               0</span>|<span class="string">    2</span>|<span class="string">    0</span>|<span class="string">      0</span>|<span class="string">        100</span>|<span class="string">     0</span>|<span class="string">     0</span>|<span class="string">      null</span>|</span><br><span class="line">|<span class="string">           null</span>|<span class="string">         38</span>|<span class="string">&#123;true, 1, 20000, ...</span>|<span class="string"> 基因锁·一阶\n觉醒了脚上的力量，...</span>|<span class="string">  [&#123;21, 72, 0.2, 0&#125;]</span>|<span class="string">      0</span>|<span class="string">      479</span>|<span class="string">  12</span>|<span class="string">   %1使出了 %2！</span>|<span class="string">        </span>|<span class="string">          1</span>|<span class="string">     0</span>|<span class="string">  骑士踢</span>|<span class="string">              &lt;setup action&gt;\na...</span>|<span class="string">       1</span>|<span class="string">      1</span>|<span class="string">           null</span>|<span class="string">               0</span>|<span class="string">               0</span>|<span class="string">    1</span>|<span class="string">    0</span>|<span class="string">      2</span>|<span class="string">        100</span>|<span class="string">     0</span>|<span class="string">     0</span>|<span class="string">      null</span>|</span><br><span class="line">|<span class="string">           null</span>|<span class="string">        125</span>|<span class="string">&#123;true, 0, 150 + a...</span>|<span class="string"> 基因锁·一阶\n觉醒了一种气功，能...</span>|<span class="string">  [&#123;44, 24, 1.0, 0&#125;]</span>|<span class="string">      2</span>|<span class="string">     4471</span>|<span class="string">  13</span>|<span class="string">    %1施放了%2！</span>|<span class="string">        </span>|<span class="string">          1</span>|<span class="string">    50</span>|<span class="string">    变身</span>|<span class="string">              &lt;Cast Animation: ...</span>|<span class="string">       1</span>|<span class="string">      1</span>|<span class="string">           null</span>|<span class="string">               0</span>|<span class="string">               0</span>|<span class="string">   11</span>|<span class="string">    0</span>|<span class="string">      2</span>|<span class="string">        100</span>|<span class="string">     0</span>|<span class="string">     0</span>|<span class="string">      null</span>|</span><br><span class="line">|<span class="string">           null</span>|<span class="string">         23</span>|<span class="string">&#123;true, -1, 426500...</span>|<span class="string">                                   </span>|<span class="string">   [&#123;21, 0, 1.0, 0&#125;]</span>|<span class="string">      1</span>|<span class="string">      640</span>|<span class="string">  14</span>|<span class="string">      %1的攻击！</span>|<span class="string">        </span>|<span class="string">          1</span>|<span class="string">     0</span>|<span class="string">莫名剑法</span>|<span class="string">              &lt;Cast Animation: ...</span>|<span class="string">       1</span>|<span class="string">      1</span>|<span class="string">           null</span>|<span class="string">               0</span>|<span class="string">               0</span>|<span class="string">    1</span>|<span class="string">    0</span>|<span class="string">      2</span>|<span class="string">        100</span>|<span class="string">     0</span>|<span class="string">    10</span>|<span class="string">      null</span>|</span><br><span class="line">|<span class="string">           null</span>|<span class="string">          0</span>|<span class="string">&#123;false, 4, 100 + ...</span>|<span class="string"> 基因锁·破碎\n已经达到身体的极限...</span>|<span class="string">                  []</span>|<span class="string">      0</span>|<span class="string">      943</span>|<span class="string">  15</span>|<span class="string">                </span>|<span class="string">        </span>|<span class="string">          1</span>|<span class="string">     0</span>|<span class="string">无望三阶</span>|<span class="string">              &lt;Hide in Battle&gt;\...</span>|<span class="string">       3</span>|<span class="string">      1</span>|<span class="string">           null</span>|<span class="string">               0</span>|<span class="string">               0</span>|<span class="string">    0</span>|<span class="string">    0</span>|<span class="string">      3</span>|<span class="string">        100</span>|<span class="string">     0</span>|<span class="string">     0</span>|<span class="string">      null</span>|</span><br><span class="line">|<span class="string">           null</span>|<span class="string">          0</span>|<span class="string">&#123;false, 4, 100 + ...</span>|<span class="string"> 基因锁·破碎\n已经达到身体的极限...</span>|<span class="string">                  []</span>|<span class="string">      0</span>|<span class="string">      943</span>|<span class="string">  16</span>|<span class="string">                </span>|<span class="string">        </span>|<span class="string">          1</span>|<span class="string">     0</span>|<span class="string">无望四阶</span>|<span class="string">              &lt;Hide in Battle&gt;\...</span>|<span class="string">       3</span>|<span class="string">      1</span>|<span class="string">           null</span>|<span class="string">               0</span>|<span class="string">               0</span>|<span class="string">    0</span>|<span class="string">    0</span>|<span class="string">      3</span>|<span class="string">        100</span>|<span class="string">     0</span>|<span class="string">     0</span>|<span class="string">      null</span>|</span><br><span class="line">|<span class="string">           null</span>|<span class="string">         -1</span>|<span class="string">&#123;true, -1, 10000+...</span>|<span class="string">                                   </span>|<span class="string">   [&#123;21, 0, 1.0, 0&#125;]</span>|<span class="string">      0</span>|<span class="string">      880</span>|<span class="string">  17</span>|<span class="string">      %1的攻击！</span>|<span class="string">        </span>|<span class="string">          1</span>|<span class="string">     0</span>|<span class="string">  骑士拳</span>|<span class="string">                                  </span>|<span class="string">       1</span>|<span class="string">      1</span>|<span class="string">           null</span>|<span class="string">               0</span>|<span class="string">               0</span>|<span class="string">    4</span>|<span class="string">    0</span>|<span class="string">      0</span>|<span class="string">        100</span>|<span class="string">     0</span>|<span class="string">     5</span>|<span class="string">      null</span>|</span><br><span class="line">|<span class="string">           null</span>|<span class="string">        311</span>|<span class="string">&#123;false, 0, 300, 0...</span>|<span class="string">  基因锁·四阶\n返祖·又北二百八十...</span>|<span class="string">                  []</span>|<span class="string">      0</span>|<span class="string">      484</span>|<span class="string">  18</span>|<span class="string">    %1施放了%2！</span>|<span class="string">        </span>|<span class="string">          1</span>|<span class="string">     0</span>|<span class="string">孟极血脉</span>|<span class="string">              \n&lt;passiveAPLUS:1...</span>|<span class="string">       3</span>|<span class="string">      1</span>|<span class="string">           null</span>|<span class="string">               0</span>|<span class="string">               0</span>|<span class="string">    0</span>|<span class="string">    0</span>|<span class="string">      3</span>|<span class="string">        100</span>|<span class="string">     0</span>|<span class="string">     0</span>|<span class="string">      null</span>|</span><br><span class="line">+---------------+-----------+--------------------+-----------------------------------+--------------------+-------+---------+----+----------------+--------+-----------+------+--------+----------------------------------+--------+-------+---------------+----------------+----------------+-----+-----+-------+-----------+------+------+----------+</span><br><span class="line">only showing top 20 rows</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="idea"><a href="#idea" class="headerlink" title="idea"></a>idea</h3><figure class="highlight roboconf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">package sparkfirst</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.sql.SparkSession</span><br><span class="line"></span><br><span class="line">object sparksql &#123;</span><br><span class="line">  <span class="attribute">def main(args</span>: Array[String]): Unit = &#123;</span><br><span class="line">    val spark = SparkSession<span class="variable">.builder</span>()<span class="variable">.appName</span>(&quot;Sparksql01&quot;)<span class="variable">.master</span>(&quot;local[2]&quot;)<span class="variable">.getOrCreate</span>()</span><br><span class="line">    val frame = spark<span class="variable">.read</span><span class="variable">.json</span>(&quot;file:///C:\\Users\\dell\\Desktop\\Skills<span class="variable">.json</span>&quot;)</span><br><span class="line">    frame<span class="variable">.show</span>()</span><br><span class="line">    spark<span class="variable">.stop</span>()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>sparksql进行数据分析</p><ul><li>sql</li><li>代码</li></ul><p>开发df</p><ul><li>sql &#x3D;》 idea api + sql 一起使用 或者 hive里的sql文件</li><li>api &#x3D; &gt; 一般用于开发大数据平台</li></ul><h2 id="学习api"><a href="#学习api" class="headerlink" title="学习api"></a>学习api</h2><p>加载dataframe中的一个字段 ： select</p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">scala&gt; df.select(<span class="string">&quot;description&quot;</span>).show</span><br><span class="line">+-----------------------------------+</span><br><span class="line">|<span class="string">                        description</span>|</span><br><span class="line">+-----------------------------------+</span><br><span class="line">|<span class="string">                               null</span>|</span><br><span class="line">|<span class="string">                               null</span>|</span><br><span class="line">|<span class="string">                                   </span>|</span><br><span class="line">|<span class="string">                                   </span>|</span><br><span class="line">|<span class="string">                                   </span>|</span><br><span class="line">|<span class="string">                                   </span>|</span><br><span class="line">|<span class="string">                                   </span>|</span><br><span class="line">|<span class="string">                                   </span>|</span><br><span class="line">|<span class="string">                                   </span>|</span><br><span class="line">|<span class="string">                                   </span>|</span><br><span class="line">|<span class="string"> 魔法\n初级的圣光技能,能召唤微弱...</span>|</span><br><span class="line">|<span class="string">呼吸法\n常见的呼吸法，运转时能够...</span>|</span><br><span class="line">|<span class="string">                                   </span>|</span><br><span class="line">|<span class="string"> 基因锁·一阶\n觉醒了脚上的力量，...</span>|</span><br><span class="line">|<span class="string"> 基因锁·一阶\n觉醒了一种气功，能...</span>|</span><br><span class="line">|<span class="string">                                   </span>|</span><br><span class="line">|<span class="string"> 基因锁·破碎\n已经达到身体的极限...</span>|</span><br><span class="line">|<span class="string"> 基因锁·破碎\n已经达到身体的极限...</span>|</span><br><span class="line">|<span class="string">                                   </span>|</span><br><span class="line">|<span class="string">  基因锁·四阶\n返祖·又北二百八十...</span>|</span><br><span class="line">+-----------------------------------+</span><br><span class="line">only showing top 20 rows</span><br><span class="line">----------------------------------------------------------------------------源码</span><br><span class="line"> def select(col: String, cols: String<span class="symbol">*</span>): DataFrame = select((col +: cols).map(Column(_)) : _<span class="symbol">*</span>)</span><br><span class="line"></span><br><span class="line">直接传字段的名字 =》 select（<span class="string">&quot;sdhakdhaj&quot;</span>）或者 select($<span class="string">&quot;niasda&quot;</span>)或者select(&#x27;hsjakd)=&gt; 加上隐式转换import spark.implicits._ 但是在linux里不需要</span><br><span class="line">select(col = <span class="string">&quot;age&quot;</span>) =》 加上import org.apache.spark.sql.functions._ ，linux不用</span><br><span class="line">------------------------------------------------------------------------------</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>createOrReplaceTempView()：创建临时表 &#x3D;》 就可以用sql来查询了</p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">scala&gt; df.createOrReplaceTempView(<span class="string">&quot;test&quot;</span>)</span><br><span class="line"></span><br><span class="line">scala&gt; spark.sql(<span class="string">&quot;select * from test&quot;</span>)</span><br><span class="line">res4: org.apache.spark.sql.DataFrame = [_corrupt_record: string, animationId: bigint ... 24 more fields]</span><br><span class="line"></span><br><span class="line">scala&gt; spark.sql(<span class="string">&quot;select * from test&quot;</span>).show()</span><br><span class="line">+---------------+-----------+--------------------+-----------------------------------+--------------------+-------+---------+----+----------------+--------+-----------+------+--------+----------------------------------+--------+-------+---------------+----------------+----------------+-----+-----+-------+-----------+------+------+----------+</span><br><span class="line">|<span class="string">_corrupt_record</span>|<span class="string">animationId</span>|<span class="string">              damage</span>|<span class="string">                        description</span>|<span class="string">             effects</span>|<span class="string">hitType</span>|<span class="string">iconIndex</span>|<span class="string">  id</span>|<span class="string">        message1</span>|<span class="string">message2</span>|<span class="string">messageType</span>|<span class="string">mpCost</span>|<span class="string">    name</span>|<span class="string">                              note</span>|<span class="string">occasion</span>|<span class="string">repeats</span>|<span class="string">requiredWtypeId</span>|<span class="string">requiredWtypeId1</span>|<span class="string">requiredWtypeId2</span>|<span class="string">scope</span>|<span class="string">speed</span>|<span class="string">stypeId</span>|<span class="string">successRate</span>|<span class="string">tpCost</span>|<span class="string">tpGain</span>|<span class="string">xianliCost</span>|</span><br><span class="line">+---------------+-----------+--------------------+-----------------------------------+--------------------+-------+---------+----+----------------+--------+-----------+------+--------+----------------------------------+--------+-------+---------------+----------------+----------------+-----+-----+-------+-----------+------+------+----------+</span><br><span class="line">|<span class="string">              [</span>|<span class="string">       null</span>|<span class="string">                null</span>|<span class="string">                               null</span>|<span class="string">                null</span>|<span class="string">   null</span>|<span class="string">     null</span>|<span class="string">null</span>|<span class="string">            null</span>|<span class="string">    null</span>|<span class="string">       null</span>|<span class="string">  null</span>|<span class="string">    null</span>|<span class="string">                              null</span>|<span class="string">    null</span>|<span class="string">   null</span>|<span class="string">           null</span>|<span class="string">            null</span>|<span class="string">            null</span>|<span class="string"> null</span>|<span class="string"> null</span>|<span class="string">   null</span>|<span class="string">       null</span>|<span class="string">  null</span>|<span class="string">  null</span>|<span class="string">      null</span>|</span><br><span class="line">|<span class="string">          null,</span>|<span class="string">       null</span>|<span class="string">                null</span>|<span class="string">                               null</span>|<span class="string">                null</span>|<span class="string">   null</span>|<span class="string">     null</span>|<span class="string">null</span>|<span class="string">            null</span>|<span class="string">    null</span>|<span class="string">       null</span>|<span class="string">  null</span>|<span class="string">    null</span>|<span class="string">                              null</span>|<span class="string">    null</span>|<span class="string">   null</span>|<span class="string">           null</span>|<span class="string">            null</span>|<span class="string">            null</span>|<span class="string"> null</span>|<span class="string"> null</span>|<span class="string">   null</span>|<span class="string">       null</span>|<span class="string">  null</span>|<span class="string">  null</span>|<span class="string">      null</span>|</span><br><span class="line">|<span class="string">           null</span>|<span class="string">          1</span>|<span class="string">&#123;true, -1, a.atk ...</span>|<span class="string">                                   </span>|<span class="string">   [&#123;21, 0, 1.0, 0&#125;]</span>|<span class="string">      1</span>|<span class="string">      880</span>|<span class="string">   1</span>|<span class="string">      %1的攻击！</span>|<span class="string">        </span>|<span class="string">          1</span>|<span class="string">     0</span>|<span class="string">    攻击</span>|<span class="string"> 1 号技能会在选择“攻击”指令时使...</span>|<span class="string">       1</span>|<span class="string">      1</span>|<span class="string">           null</span>|<span class="string">               0</span>|<span class="string">               0</span>|<span class="string">    1</span>|<span class="string">    0</span>|<span class="string">      0</span>|<span class="string">        100</span>|<span class="string">     0</span>|<span class="string">    10</span>|<span class="string">      null</span>|</span><br><span class="line">|<span class="string">           null</span>|<span class="string">          0</span>|<span class="string">&#123;false, 0, 0, 0, 20&#125;</span>|<span class="string">                                   </span>|<span class="string">   [&#123;21, 2, 1.0, 0&#125;]</span>|<span class="string">      0</span>|<span class="string">      688</span>|<span class="string">   2</span>|<span class="string">%1正在保护自己。</span>|<span class="string">        </span>|<span class="string">          1</span>|<span class="string">     0</span>|<span class="string">    防御</span>|<span class="string">1 号技能会在选择“防御”指令时使用。</span>|<span class="string">       1</span>|<span class="string">      1</span>|<span class="string">           null</span>|<span class="string">               0</span>|<span class="string">               0</span>|<span class="string">   11</span>|<span class="string">   10</span>|<span class="string">      0</span>|<span class="string">        100</span>|<span class="string">     0</span>|<span class="string">    10</span>|<span class="string">      null</span>|</span><br><span class="line">|<span class="string">           null</span>|<span class="string">         -1</span>|<span class="string">&#123;true, -1, a.atk ...</span>|<span class="string">                                   </span>|<span class="string">   [&#123;21, 0, 1.0, 0&#125;]</span>|<span class="string">      1</span>|<span class="string">      880</span>|<span class="string">   3</span>|<span class="string">      %1的攻击！</span>|<span class="string">        </span>|<span class="string">          1</span>|<span class="string">     0</span>|<span class="string">连续攻击</span>|<span class="string">                                  </span>|<span class="string">       1</span>|<span class="string">      2</span>|<span class="string">           null</span>|<span class="string">               0</span>|<span class="string">               0</span>|<span class="string">    1</span>|<span class="string">    0</span>|<span class="string">      2</span>|<span class="string">        100</span>|<span class="string">     0</span>|<span class="string">     5</span>|<span class="string">      null</span>|</span><br><span class="line">|<span class="string">           null</span>|<span class="string">         -1</span>|<span class="string">&#123;true, -1, a.atk ...</span>|<span class="string">                                   </span>|<span class="string">   [&#123;21, 0, 1.0, 0&#125;]</span>|<span class="string">      1</span>|<span class="string">      880</span>|<span class="string">   4</span>|<span class="string">      %1的攻击！</span>|<span class="string">        </span>|<span class="string">          1</span>|<span class="string">     0</span>|<span class="string">两次攻击</span>|<span class="string">                                  </span>|<span class="string">       1</span>|<span class="string">      1</span>|<span class="string">           null</span>|<span class="string">               0</span>|<span class="string">               0</span>|<span class="string">    4</span>|<span class="string">    0</span>|<span class="string">      0</span>|<span class="string">        100</span>|<span class="string">     0</span>|<span class="string">     5</span>|<span class="string">      null</span>|</span><br><span class="line">|<span class="string">           null</span>|<span class="string">         -1</span>|<span class="string">&#123;true, -1, a.atk ...</span>|<span class="string">                                   </span>|<span class="string">   [&#123;21, 0, 1.0, 0&#125;]</span>|<span class="string">      1</span>|<span class="string">      849</span>|<span class="string">   5</span>|<span class="string">      %1的攻击！</span>|<span class="string">        </span>|<span class="string">          1</span>|<span class="string">     0</span>|<span class="string">三次攻击</span>|<span class="string">                                  </span>|<span class="string">       1</span>|<span class="string">      1</span>|<span class="string">           null</span>|<span class="string">               0</span>|<span class="string">               0</span>|<span class="string">    5</span>|<span class="string">    0</span>|<span class="string">      0</span>|<span class="string">        100</span>|<span class="string">     0</span>|<span class="string">     4</span>|<span class="string">      null</span>|</span><br><span class="line">|<span class="string">           null</span>|<span class="string">          0</span>|<span class="string">&#123;false, 0, 0, 0, 20&#125;</span>|<span class="string">                                   </span>|<span class="string">   [&#123;41, 0, 0.0, 0&#125;]</span>|<span class="string">      0</span>|<span class="string">      883</span>|<span class="string">   6</span>|<span class="string">      %1逃跑了。</span>|<span class="string">        </span>|<span class="string">          1</span>|<span class="string">     0</span>|<span class="string">    逃跑</span>|<span class="string">                                  </span>|<span class="string">       1</span>|<span class="string">      1</span>|<span class="string">           null</span>|<span class="string">               0</span>|<span class="string">               0</span>|<span class="string">   11</span>|<span class="string">    0</span>|<span class="string">      0</span>|<span class="string">        100</span>|<span class="string">     0</span>|<span class="string">     0</span>|<span class="string">      null</span>|</span><br><span class="line">|<span class="string">           null</span>|<span class="string">          0</span>|<span class="string">&#123;false, 0, 0, 0, 20&#125;</span>|<span class="string">                                   </span>|<span class="string">                  []</span>|<span class="string">      0</span>|<span class="string">      979</span>|<span class="string">   7</span>|<span class="string">    %1正在观望。</span>|<span class="string">        </span>|<span class="string">          1</span>|<span class="string">     0</span>|<span class="string">    观望</span>|<span class="string">                                  </span>|<span class="string">       1</span>|<span class="string">      1</span>|<span class="string">           null</span>|<span class="string">               0</span>|<span class="string">               0</span>|<span class="string">    0</span>|<span class="string">    0</span>|<span class="string">      0</span>|<span class="string">        100</span>|<span class="string">     0</span>|<span class="string">    10</span>|<span class="string">      null</span>|</span><br><span class="line">|<span class="string">           null</span>|<span class="string">         41</span>|<span class="string">&#123;false, 0, 200 + ...</span>|<span class="string">                                   </span>|<span class="string">[&#123;21, 4, 1.0, 0&#125;,...</span>|<span class="string">      0</span>|<span class="string">       72</span>|<span class="string">   8</span>|<span class="string">    %1吟唱了%2！</span>|<span class="string">        </span>|<span class="string">          1</span>|<span class="string">     5</span>|<span class="string">    治愈</span>|<span class="string">                                  </span>|<span class="string">       0</span>|<span class="string">      1</span>|<span class="string">           null</span>|<span class="string">               0</span>|<span class="string">               0</span>|<span class="string">    1</span>|<span class="string">    0</span>|<span class="string">      1</span>|<span class="string">        100</span>|<span class="string">     0</span>|<span class="string">    10</span>|<span class="string">      null</span>|</span><br><span class="line">|<span class="string">           null</span>|<span class="string">         66</span>|<span class="string">&#123;false, 2, 100 + ...</span>|<span class="string"> 魔法\n初级的圣光技能,能召唤微弱...</span>|<span class="string">  [&#123;44, 30, 1.0, 0&#125;]</span>|<span class="string">      2</span>|<span class="string">       64</span>|<span class="string">   9</span>|<span class="string">    %1吟唱了%2！</span>|<span class="string">        </span>|<span class="string">          1</span>|<span class="string">     5</span>|<span class="string">    火焰</span>|<span class="string">                                  </span>|<span class="string">       1</span>|<span class="string">      1</span>|<span class="string">           null</span>|<span class="string">               0</span>|<span class="string">               0</span>|<span class="string">    1</span>|<span class="string">    0</span>|<span class="string">      1</span>|<span class="string">        100</span>|<span class="string">     0</span>|<span class="string">    10</span>|<span class="string">      null</span>|</span><br><span class="line">|<span class="string">           null</span>|<span class="string">          0</span>|<span class="string">&#123;false, 2, 285 + ...</span>|<span class="string">呼吸法\n常见的呼吸法，运转时能够...</span>|<span class="string">  [&#123;21, 21, 1.0, 0&#125;]</span>|<span class="string">      0</span>|<span class="string">     3084</span>|<span class="string">  10</span>|<span class="string">    %1施放了%2！</span>|<span class="string">        </span>|<span class="string">          1</span>|<span class="string">     0</span>|<span class="string">小吐纳法</span>|<span class="string">              &lt;Cast Animation: ...</span>|<span class="string">       0</span>|<span class="string">      1</span>|<span class="string">           null</span>|<span class="string">               0</span>|<span class="string">               0</span>|<span class="string">   11</span>|<span class="string">    0</span>|<span class="string">      4</span>|<span class="string">        100</span>|<span class="string">     0</span>|<span class="string">     0</span>|<span class="string">      null</span>|</span><br><span class="line">|<span class="string">           null</span>|<span class="string">        152</span>|<span class="string">&#123;false, 2, 285 + ...</span>|<span class="string">                                   </span>|<span class="string">[&#123;21, 153, 1.0, 0...</span>|<span class="string">      0</span>|<span class="string">      499</span>|<span class="string">  11</span>|<span class="string">    %1使用了%2！</span>|<span class="string">        </span>|<span class="string">          1</span>|<span class="string">     0</span>|<span class="string">  灭魂术</span>|<span class="string">              &lt;Cast Animation: 0&gt; </span>|<span class="string">       1</span>|<span class="string">      1</span>|<span class="string">           null</span>|<span class="string">               0</span>|<span class="string">               0</span>|<span class="string">    2</span>|<span class="string">    0</span>|<span class="string">      0</span>|<span class="string">        100</span>|<span class="string">     0</span>|<span class="string">     0</span>|<span class="string">      null</span>|</span><br><span class="line">|<span class="string">           null</span>|<span class="string">         38</span>|<span class="string">&#123;true, 1, 20000, ...</span>|<span class="string"> 基因锁·一阶\n觉醒了脚上的力量，...</span>|<span class="string">  [&#123;21, 72, 0.2, 0&#125;]</span>|<span class="string">      0</span>|<span class="string">      479</span>|<span class="string">  12</span>|<span class="string">   %1使出了 %2！</span>|<span class="string">        </span>|<span class="string">          1</span>|<span class="string">     0</span>|<span class="string">  骑士踢</span>|<span class="string">              &lt;setup action&gt;\na...</span>|<span class="string">       1</span>|<span class="string">      1</span>|<span class="string">           null</span>|<span class="string">               0</span>|<span class="string">               0</span>|<span class="string">    1</span>|<span class="string">    0</span>|<span class="string">      2</span>|<span class="string">        100</span>|<span class="string">     0</span>|<span class="string">     0</span>|<span class="string">      null</span>|</span><br><span class="line">|<span class="string">           null</span>|<span class="string">        125</span>|<span class="string">&#123;true, 0, 150 + a...</span>|<span class="string"> 基因锁·一阶\n觉醒了一种气功，能...</span>|<span class="string">  [&#123;44, 24, 1.0, 0&#125;]</span>|<span class="string">      2</span>|<span class="string">     4471</span>|<span class="string">  13</span>|<span class="string">    %1施放了%2！</span>|<span class="string">        </span>|<span class="string">          1</span>|<span class="string">    50</span>|<span class="string">    变身</span>|<span class="string">              &lt;Cast Animation: ...</span>|<span class="string">       1</span>|<span class="string">      1</span>|<span class="string">           null</span>|<span class="string">               0</span>|<span class="string">               0</span>|<span class="string">   11</span>|<span class="string">    0</span>|<span class="string">      2</span>|<span class="string">        100</span>|<span class="string">     0</span>|<span class="string">     0</span>|<span class="string">      null</span>|</span><br><span class="line">|<span class="string">           null</span>|<span class="string">         23</span>|<span class="string">&#123;true, -1, 426500...</span>|<span class="string">                                   </span>|<span class="string">   [&#123;21, 0, 1.0, 0&#125;]</span>|<span class="string">      1</span>|<span class="string">      640</span>|<span class="string">  14</span>|<span class="string">      %1的攻击！</span>|<span class="string">        </span>|<span class="string">          1</span>|<span class="string">     0</span>|<span class="string">莫名剑法</span>|<span class="string">              &lt;Cast Animation: ...</span>|<span class="string">       1</span>|<span class="string">      1</span>|<span class="string">           null</span>|<span class="string">               0</span>|<span class="string">               0</span>|<span class="string">    1</span>|<span class="string">    0</span>|<span class="string">      2</span>|<span class="string">        100</span>|<span class="string">     0</span>|<span class="string">    10</span>|<span class="string">      null</span>|</span><br><span class="line">|<span class="string">           null</span>|<span class="string">          0</span>|<span class="string">&#123;false, 4, 100 + ...</span>|<span class="string"> 基因锁·破碎\n已经达到身体的极限...</span>|<span class="string">                  []</span>|<span class="string">      0</span>|<span class="string">      943</span>|<span class="string">  15</span>|<span class="string">                </span>|<span class="string">        </span>|<span class="string">          1</span>|<span class="string">     0</span>|<span class="string">无望三阶</span>|<span class="string">              &lt;Hide in Battle&gt;\...</span>|<span class="string">       3</span>|<span class="string">      1</span>|<span class="string">           null</span>|<span class="string">               0</span>|<span class="string">               0</span>|<span class="string">    0</span>|<span class="string">    0</span>|<span class="string">      3</span>|<span class="string">        100</span>|<span class="string">     0</span>|<span class="string">     0</span>|<span class="string">      null</span>|</span><br><span class="line">|<span class="string">           null</span>|<span class="string">          0</span>|<span class="string">&#123;false, 4, 100 + ...</span>|<span class="string"> 基因锁·破碎\n已经达到身体的极限...</span>|<span class="string">                  []</span>|<span class="string">      0</span>|<span class="string">      943</span>|<span class="string">  16</span>|<span class="string">                </span>|<span class="string">        </span>|<span class="string">          1</span>|<span class="string">     0</span>|<span class="string">无望四阶</span>|<span class="string">              &lt;Hide in Battle&gt;\...</span>|<span class="string">       3</span>|<span class="string">      1</span>|<span class="string">           null</span>|<span class="string">               0</span>|<span class="string">               0</span>|<span class="string">    0</span>|<span class="string">    0</span>|<span class="string">      3</span>|<span class="string">        100</span>|<span class="string">     0</span>|<span class="string">     0</span>|<span class="string">      null</span>|</span><br><span class="line">|<span class="string">           null</span>|<span class="string">         -1</span>|<span class="string">&#123;true, -1, 10000+...</span>|<span class="string">                                   </span>|<span class="string">   [&#123;21, 0, 1.0, 0&#125;]</span>|<span class="string">      0</span>|<span class="string">      880</span>|<span class="string">  17</span>|<span class="string">      %1的攻击！</span>|<span class="string">        </span>|<span class="string">          1</span>|<span class="string">     0</span>|<span class="string">  骑士拳</span>|<span class="string">                                  </span>|<span class="string">       1</span>|<span class="string">      1</span>|<span class="string">           null</span>|<span class="string">               0</span>|<span class="string">               0</span>|<span class="string">    4</span>|<span class="string">    0</span>|<span class="string">      0</span>|<span class="string">        100</span>|<span class="string">     0</span>|<span class="string">     5</span>|<span class="string">      null</span>|</span><br><span class="line">|<span class="string">           null</span>|<span class="string">        311</span>|<span class="string">&#123;false, 0, 300, 0...</span>|<span class="string">  基因锁·四阶\n返祖·又北二百八十...</span>|<span class="string">                  []</span>|<span class="string">      0</span>|<span class="string">      484</span>|<span class="string">  18</span>|<span class="string">    %1施放了%2！</span>|<span class="string">        </span>|<span class="string">          1</span>|<span class="string">     0</span>|<span class="string">孟极血脉</span>|<span class="string">              \n&lt;passiveAPLUS:1...</span>|<span class="string">       3</span>|<span class="string">      1</span>|<span class="string">           null</span>|<span class="string">               0</span>|<span class="string">               0</span>|<span class="string">    0</span>|<span class="string">    0</span>|<span class="string">      3</span>|<span class="string">        100</span>|<span class="string">     0</span>|<span class="string">     0</span>|<span class="string">      null</span>|</span><br><span class="line">+---------------+-----------+--------------------+-----------------------------------+--------------------+-------+---------+----+----------------+--------+-----------+------+--------+----------------------------------+--------+-------+---------------+----------------+----------------+-----+-----+-------+-----------+------+------+----------+</span><br><span class="line">only showing top 20 rows</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>开发数仓：</p><ul><li>sql文件 维护数仓 &#x3D;》 推荐 好维护</li><li>idea<ul><li>sql维护数仓  &#x3D;》 例子 ：滴滴</li><li>api维护数仓 &#x3D;》 不好维护  &#x3D;》 定义udf函数方便<ul><li>可以写通用性代码来维护 &#x3D;》 写完之后牛皮</li></ul></li></ul></li></ul><h2 id="如何构建dataframe"><a href="#如何构建dataframe" class="headerlink" title="如何构建dataframe"></a>如何构建dataframe</h2><p>通过spark-session</p><p>RDD &#x3D;》 dataframe</p><ul><li>反射 数据结构（tuple,case class）-》形成dataframe-》<code>RDD.toDF</code>就可以了 其中 toDF(“列名”，”列名”。。。。)里面的是在dataframe里的列名</li><li>编程的方式 - 》 形成dataframe-》<ul><li><p>准备RDD 结构 &#x3D;》 row类型的</p></li><li><p>scheme &#x3D;》 数据字段名字，以及字段类型</p><ul><li>scheme ： 可以理解为一个表的元数据 &#x3D;》 字段的名字，字段的类型 &#x3D;》 以StructType来维护的<ul><li>fileds:一个字段的元数据是用StructFileds来维护的</li></ul></li></ul></li><li><p>createDataFrame &#x3D;》 df</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">val rowRDD: RDD<span class="selector-attr">[Row]</span> = inputRDD<span class="selector-class">.map</span>(line =&gt; &#123;</span><br><span class="line">     val splits = line<span class="selector-class">.split</span>(<span class="string">&quot;,&quot;</span>)</span><br><span class="line">     val uid = <span class="built_in">splits</span>(<span class="number">0</span>)</span><br><span class="line">     val name = <span class="built_in">splits</span>(<span class="number">1</span>)</span><br><span class="line">     val age = <span class="built_in">splits</span>(<span class="number">2</span>)<span class="selector-class">.toInt</span></span><br><span class="line">     <span class="built_in">Row</span>(uid, name, age)</span><br><span class="line">   &#125;)</span><br><span class="line"></span><br><span class="line">   val schema = <span class="built_in">StructType</span>(<span class="built_in">Array</span>(</span><br><span class="line">     <span class="built_in">StructField</span>(<span class="string">&quot;uid&quot;</span>, StringType),</span><br><span class="line">     <span class="built_in">StructField</span>(<span class="string">&quot;name&quot;</span>, StringType),</span><br><span class="line">     <span class="built_in">StructField</span>(<span class="string">&quot;age&quot;</span>, IntegerType)</span><br><span class="line">   ))</span><br><span class="line"></span><br><span class="line">   val inputDF: DataFrame = spark<span class="selector-class">.createDataFrame</span>(rowRDD,schema)</span><br></pre></td></tr></table></figure></li></ul></li></ul><p>dataframe&#x2F;datasetr-&gt;RDD</p><ul><li><code>df.rdd</code></li></ul><p>df -&gt; ds</p><ul><li>用as来转换 <code>df.as[数据类型]</code>&#x3D;》dataset ：一般这个as里是类</li></ul><p>作业 把mysql的emp以及dept表以json的方式提取出来</p><h1 id="通过sparksql来完成之前的需求"><a href="#通过sparksql来完成之前的需求" class="headerlink" title="通过sparksql来完成之前的需求"></a>通过sparksql来完成之前的需求</h1><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br><span class="line">861</span><br><span class="line">862</span><br><span class="line">863</span><br><span class="line">864</span><br><span class="line">865</span><br><span class="line">866</span><br><span class="line">867</span><br><span class="line">868</span><br><span class="line">869</span><br><span class="line">870</span><br><span class="line">871</span><br><span class="line">872</span><br><span class="line">873</span><br><span class="line">874</span><br><span class="line">875</span><br><span class="line">876</span><br><span class="line">877</span><br><span class="line">878</span><br><span class="line">879</span><br><span class="line">880</span><br><span class="line">881</span><br><span class="line">882</span><br><span class="line">883</span><br><span class="line">884</span><br><span class="line">885</span><br><span class="line">886</span><br><span class="line">887</span><br><span class="line">888</span><br><span class="line">889</span><br><span class="line">890</span><br><span class="line">891</span><br><span class="line">892</span><br><span class="line">893</span><br><span class="line">894</span><br><span class="line">895</span><br><span class="line">896</span><br><span class="line">897</span><br><span class="line">898</span><br><span class="line">899</span><br><span class="line">900</span><br><span class="line">901</span><br><span class="line">902</span><br><span class="line">903</span><br><span class="line">904</span><br><span class="line">905</span><br><span class="line">906</span><br><span class="line">907</span><br><span class="line">908</span><br><span class="line">909</span><br><span class="line">910</span><br><span class="line">911</span><br><span class="line">912</span><br><span class="line">913</span><br><span class="line">914</span><br><span class="line">915</span><br><span class="line">916</span><br><span class="line">917</span><br><span class="line">918</span><br><span class="line">919</span><br><span class="line">920</span><br><span class="line">921</span><br><span class="line">922</span><br><span class="line">923</span><br><span class="line">924</span><br><span class="line">925</span><br><span class="line">926</span><br><span class="line">927</span><br><span class="line">928</span><br><span class="line">929</span><br><span class="line">930</span><br><span class="line">931</span><br><span class="line">932</span><br><span class="line">933</span><br><span class="line">934</span><br><span class="line">935</span><br><span class="line">936</span><br><span class="line">937</span><br><span class="line">938</span><br><span class="line">939</span><br><span class="line">940</span><br><span class="line">941</span><br><span class="line">942</span><br><span class="line">943</span><br><span class="line">944</span><br><span class="line">945</span><br><span class="line">946</span><br><span class="line">947</span><br><span class="line">948</span><br><span class="line">949</span><br><span class="line">950</span><br><span class="line">951</span><br><span class="line">952</span><br><span class="line">953</span><br><span class="line">954</span><br><span class="line">955</span><br><span class="line">956</span><br><span class="line">957</span><br><span class="line">958</span><br><span class="line">959</span><br><span class="line">960</span><br><span class="line">961</span><br><span class="line">962</span><br><span class="line">963</span><br><span class="line">964</span><br><span class="line">965</span><br><span class="line">966</span><br><span class="line">967</span><br><span class="line">968</span><br><span class="line">969</span><br><span class="line">970</span><br><span class="line">971</span><br><span class="line">972</span><br><span class="line">973</span><br><span class="line">974</span><br><span class="line">975</span><br><span class="line">976</span><br><span class="line">977</span><br><span class="line">978</span><br><span class="line">979</span><br><span class="line">980</span><br><span class="line">981</span><br><span class="line">982</span><br><span class="line">983</span><br><span class="line">984</span><br><span class="line">985</span><br><span class="line">986</span><br><span class="line">987</span><br><span class="line">988</span><br><span class="line">989</span><br><span class="line">990</span><br><span class="line">991</span><br><span class="line">992</span><br><span class="line">993</span><br><span class="line">994</span><br><span class="line">995</span><br><span class="line">996</span><br><span class="line">997</span><br><span class="line">998</span><br><span class="line">999</span><br><span class="line">1000</span><br><span class="line">1001</span><br><span class="line">1002</span><br><span class="line">1003</span><br><span class="line">1004</span><br><span class="line">1005</span><br><span class="line">1006</span><br><span class="line">1007</span><br><span class="line">1008</span><br><span class="line">1009</span><br><span class="line">1010</span><br><span class="line">1011</span><br><span class="line">1012</span><br><span class="line">1013</span><br><span class="line">1014</span><br><span class="line">1015</span><br><span class="line">1016</span><br><span class="line">1017</span><br><span class="line">1018</span><br><span class="line">1019</span><br><span class="line">1020</span><br><span class="line">1021</span><br><span class="line">1022</span><br><span class="line">1023</span><br><span class="line">1024</span><br><span class="line">1025</span><br><span class="line">1026</span><br><span class="line">1027</span><br><span class="line">1028</span><br><span class="line">1029</span><br><span class="line">1030</span><br><span class="line">1031</span><br><span class="line">1032</span><br><span class="line">1033</span><br><span class="line">1034</span><br><span class="line">1035</span><br><span class="line">1036</span><br><span class="line">1037</span><br><span class="line">1038</span><br><span class="line">1039</span><br><span class="line">1040</span><br><span class="line">1041</span><br><span class="line">1042</span><br><span class="line">1043</span><br><span class="line">1044</span><br><span class="line">1045</span><br><span class="line">1046</span><br><span class="line">1047</span><br><span class="line">1048</span><br><span class="line">1049</span><br><span class="line">1050</span><br><span class="line">1051</span><br><span class="line">1052</span><br><span class="line">1053</span><br><span class="line">1054</span><br><span class="line">1055</span><br><span class="line">1056</span><br><span class="line">1057</span><br><span class="line">1058</span><br><span class="line">1059</span><br><span class="line">1060</span><br><span class="line">1061</span><br><span class="line">1062</span><br><span class="line">1063</span><br><span class="line">1064</span><br><span class="line">1065</span><br><span class="line">1066</span><br><span class="line">1067</span><br><span class="line">1068</span><br><span class="line">1069</span><br><span class="line">1070</span><br><span class="line">1071</span><br><span class="line">1072</span><br><span class="line">1073</span><br><span class="line">1074</span><br><span class="line">1075</span><br><span class="line">1076</span><br><span class="line">1077</span><br><span class="line">1078</span><br><span class="line">1079</span><br><span class="line">1080</span><br><span class="line">1081</span><br><span class="line">1082</span><br><span class="line">1083</span><br><span class="line">1084</span><br><span class="line">1085</span><br><span class="line">1086</span><br><span class="line">1087</span><br><span class="line">1088</span><br><span class="line">1089</span><br><span class="line">1090</span><br><span class="line">1091</span><br><span class="line">1092</span><br><span class="line">1093</span><br><span class="line">1094</span><br><span class="line">1095</span><br><span class="line">1096</span><br><span class="line">1097</span><br><span class="line">1098</span><br><span class="line">1099</span><br><span class="line">1100</span><br><span class="line">1101</span><br><span class="line">1102</span><br><span class="line">1103</span><br><span class="line">1104</span><br><span class="line">1105</span><br><span class="line">1106</span><br><span class="line">1107</span><br><span class="line">1108</span><br><span class="line">1109</span><br><span class="line">1110</span><br><span class="line">1111</span><br><span class="line">1112</span><br><span class="line">1113</span><br><span class="line">1114</span><br><span class="line">1115</span><br><span class="line">1116</span><br><span class="line">1117</span><br><span class="line">1118</span><br><span class="line">1119</span><br><span class="line">1120</span><br><span class="line">1121</span><br><span class="line">1122</span><br><span class="line">1123</span><br><span class="line">1124</span><br><span class="line">1125</span><br><span class="line">1126</span><br><span class="line">1127</span><br><span class="line">1128</span><br><span class="line">1129</span><br><span class="line">1130</span><br><span class="line">1131</span><br><span class="line">1132</span><br><span class="line">1133</span><br><span class="line">1134</span><br><span class="line">1135</span><br><span class="line">1136</span><br><span class="line">1137</span><br><span class="line">1138</span><br><span class="line">1139</span><br><span class="line">1140</span><br><span class="line">1141</span><br><span class="line">1142</span><br><span class="line">1143</span><br><span class="line">1144</span><br><span class="line">1145</span><br><span class="line">1146</span><br><span class="line">1147</span><br><span class="line">1148</span><br><span class="line">1149</span><br><span class="line">1150</span><br><span class="line">1151</span><br><span class="line">1152</span><br><span class="line">1153</span><br><span class="line">1154</span><br><span class="line">1155</span><br><span class="line">1156</span><br><span class="line">1157</span><br><span class="line">1158</span><br><span class="line">1159</span><br><span class="line">1160</span><br><span class="line">1161</span><br><span class="line">1162</span><br><span class="line">1163</span><br><span class="line">1164</span><br><span class="line">1165</span><br><span class="line">1166</span><br><span class="line">1167</span><br><span class="line">1168</span><br><span class="line">1169</span><br><span class="line">1170</span><br><span class="line">1171</span><br><span class="line">1172</span><br><span class="line">1173</span><br><span class="line">1174</span><br><span class="line">1175</span><br><span class="line">1176</span><br><span class="line">1177</span><br><span class="line">1178</span><br><span class="line">1179</span><br><span class="line">1180</span><br><span class="line">1181</span><br><span class="line">1182</span><br><span class="line">1183</span><br><span class="line">1184</span><br><span class="line">1185</span><br><span class="line">1186</span><br><span class="line">1187</span><br><span class="line">1188</span><br><span class="line">1189</span><br><span class="line">1190</span><br><span class="line">1191</span><br><span class="line">1192</span><br><span class="line">1193</span><br><span class="line">1194</span><br><span class="line">1195</span><br><span class="line">1196</span><br><span class="line">1197</span><br><span class="line">1198</span><br><span class="line">1199</span><br><span class="line">1200</span><br><span class="line">1201</span><br><span class="line">1202</span><br><span class="line">1203</span><br><span class="line">1204</span><br><span class="line">1205</span><br><span class="line">1206</span><br><span class="line">1207</span><br><span class="line">1208</span><br><span class="line">1209</span><br><span class="line">1210</span><br><span class="line">1211</span><br><span class="line">1212</span><br><span class="line">1213</span><br><span class="line">1214</span><br><span class="line">1215</span><br><span class="line">1216</span><br><span class="line">1217</span><br><span class="line">1218</span><br><span class="line">1219</span><br><span class="line">1220</span><br><span class="line">1221</span><br><span class="line">1222</span><br><span class="line">1223</span><br><span class="line">1224</span><br><span class="line">1225</span><br><span class="line">1226</span><br><span class="line">1227</span><br><span class="line">1228</span><br><span class="line">1229</span><br><span class="line">1230</span><br><span class="line">1231</span><br><span class="line">1232</span><br><span class="line">1233</span><br><span class="line">1234</span><br><span class="line">1235</span><br><span class="line">1236</span><br><span class="line">1237</span><br><span class="line">1238</span><br><span class="line">1239</span><br><span class="line">1240</span><br><span class="line">1241</span><br><span class="line">1242</span><br><span class="line">1243</span><br><span class="line">1244</span><br><span class="line">1245</span><br><span class="line">1246</span><br><span class="line">1247</span><br><span class="line">1248</span><br><span class="line">1249</span><br><span class="line">1250</span><br><span class="line">1251</span><br><span class="line">1252</span><br><span class="line">1253</span><br><span class="line">1254</span><br><span class="line">1255</span><br><span class="line">1256</span><br><span class="line">1257</span><br><span class="line">1258</span><br><span class="line">1259</span><br><span class="line">1260</span><br><span class="line">1261</span><br><span class="line">1262</span><br><span class="line">1263</span><br><span class="line">1264</span><br><span class="line">1265</span><br><span class="line">1266</span><br><span class="line">1267</span><br><span class="line">1268</span><br><span class="line">1269</span><br><span class="line">1270</span><br><span class="line">1271</span><br><span class="line">1272</span><br><span class="line">1273</span><br><span class="line">1274</span><br><span class="line">1275</span><br><span class="line">1276</span><br><span class="line">1277</span><br><span class="line">1278</span><br><span class="line">1279</span><br><span class="line">1280</span><br><span class="line">1281</span><br><span class="line">1282</span><br><span class="line">1283</span><br><span class="line">1284</span><br><span class="line">1285</span><br><span class="line">1286</span><br><span class="line">1287</span><br><span class="line">1288</span><br><span class="line">1289</span><br><span class="line">1290</span><br><span class="line">1291</span><br><span class="line">1292</span><br><span class="line">1293</span><br><span class="line">1294</span><br><span class="line">1295</span><br><span class="line">1296</span><br><span class="line">1297</span><br><span class="line">1298</span><br><span class="line">1299</span><br><span class="line">1300</span><br><span class="line">1301</span><br><span class="line">1302</span><br><span class="line">1303</span><br><span class="line">1304</span><br><span class="line">1305</span><br><span class="line">1306</span><br><span class="line">1307</span><br><span class="line">1308</span><br><span class="line">1309</span><br><span class="line">1310</span><br><span class="line">1311</span><br><span class="line">1312</span><br><span class="line">1313</span><br><span class="line">1314</span><br><span class="line">1315</span><br><span class="line">1316</span><br><span class="line">1317</span><br><span class="line">1318</span><br><span class="line">1319</span><br><span class="line">1320</span><br><span class="line">1321</span><br><span class="line">1322</span><br><span class="line">1323</span><br><span class="line">1324</span><br><span class="line">1325</span><br><span class="line">1326</span><br><span class="line">1327</span><br><span class="line">1328</span><br><span class="line">1329</span><br><span class="line">1330</span><br><span class="line">1331</span><br><span class="line">1332</span><br><span class="line">1333</span><br><span class="line">1334</span><br><span class="line">1335</span><br><span class="line">1336</span><br><span class="line">1337</span><br><span class="line">1338</span><br><span class="line">1339</span><br><span class="line">1340</span><br><span class="line">1341</span><br><span class="line">1342</span><br><span class="line">1343</span><br><span class="line">1344</span><br><span class="line">1345</span><br><span class="line">1346</span><br><span class="line">1347</span><br><span class="line">1348</span><br><span class="line">1349</span><br><span class="line">1350</span><br><span class="line">1351</span><br><span class="line">1352</span><br><span class="line">1353</span><br><span class="line">1354</span><br><span class="line">1355</span><br><span class="line">1356</span><br><span class="line">1357</span><br><span class="line">1358</span><br><span class="line">1359</span><br><span class="line">1360</span><br><span class="line">1361</span><br><span class="line">1362</span><br><span class="line">1363</span><br><span class="line">1364</span><br><span class="line">1365</span><br><span class="line">1366</span><br><span class="line">1367</span><br><span class="line">1368</span><br><span class="line">1369</span><br><span class="line">1370</span><br><span class="line">1371</span><br><span class="line">1372</span><br><span class="line">1373</span><br><span class="line">1374</span><br><span class="line">1375</span><br><span class="line">1376</span><br><span class="line">1377</span><br><span class="line">1378</span><br><span class="line">1379</span><br><span class="line">1380</span><br><span class="line">1381</span><br><span class="line">1382</span><br><span class="line">1383</span><br><span class="line">1384</span><br><span class="line">1385</span><br><span class="line">1386</span><br><span class="line">1387</span><br><span class="line">1388</span><br><span class="line">1389</span><br><span class="line">1390</span><br><span class="line">1391</span><br><span class="line">1392</span><br><span class="line">1393</span><br><span class="line">1394</span><br><span class="line">1395</span><br><span class="line">1396</span><br><span class="line">1397</span><br><span class="line">1398</span><br><span class="line">1399</span><br><span class="line">1400</span><br><span class="line">1401</span><br><span class="line">1402</span><br><span class="line">1403</span><br><span class="line">1404</span><br><span class="line">1405</span><br><span class="line">1406</span><br><span class="line">1407</span><br><span class="line">1408</span><br><span class="line">1409</span><br><span class="line">1410</span><br><span class="line">1411</span><br><span class="line">1412</span><br><span class="line">1413</span><br><span class="line">1414</span><br><span class="line">1415</span><br><span class="line">1416</span><br><span class="line">1417</span><br><span class="line">1418</span><br><span class="line">1419</span><br><span class="line">1420</span><br><span class="line">1421</span><br><span class="line">1422</span><br><span class="line">1423</span><br><span class="line">1424</span><br><span class="line">1425</span><br><span class="line">1426</span><br><span class="line">1427</span><br><span class="line">1428</span><br><span class="line">1429</span><br><span class="line">1430</span><br><span class="line">1431</span><br><span class="line">1432</span><br><span class="line">1433</span><br><span class="line">1434</span><br><span class="line">1435</span><br><span class="line">1436</span><br><span class="line">1437</span><br><span class="line">1438</span><br><span class="line">1439</span><br><span class="line">1440</span><br><span class="line">1441</span><br><span class="line">1442</span><br><span class="line">1443</span><br><span class="line">1444</span><br><span class="line">1445</span><br><span class="line">1446</span><br><span class="line">1447</span><br><span class="line">1448</span><br><span class="line">1449</span><br><span class="line">1450</span><br><span class="line">1451</span><br><span class="line">1452</span><br><span class="line">1453</span><br><span class="line">1454</span><br><span class="line">1455</span><br><span class="line">1456</span><br><span class="line">1457</span><br><span class="line">1458</span><br><span class="line">1459</span><br><span class="line">1460</span><br><span class="line">1461</span><br><span class="line">1462</span><br><span class="line">1463</span><br><span class="line">1464</span><br><span class="line">1465</span><br><span class="line">1466</span><br><span class="line">1467</span><br><span class="line">1468</span><br><span class="line">1469</span><br><span class="line">1470</span><br><span class="line">1471</span><br><span class="line">1472</span><br><span class="line">1473</span><br><span class="line">1474</span><br><span class="line">1475</span><br><span class="line">1476</span><br><span class="line">1477</span><br><span class="line">1478</span><br><span class="line">1479</span><br><span class="line">1480</span><br><span class="line">1481</span><br><span class="line">1482</span><br><span class="line">1483</span><br><span class="line">1484</span><br><span class="line">1485</span><br><span class="line">1486</span><br><span class="line">1487</span><br><span class="line">1488</span><br><span class="line">1489</span><br><span class="line">1490</span><br><span class="line">1491</span><br><span class="line">1492</span><br><span class="line">1493</span><br><span class="line">1494</span><br><span class="line">1495</span><br><span class="line">1496</span><br><span class="line">1497</span><br><span class="line">1498</span><br><span class="line">1499</span><br><span class="line">1500</span><br><span class="line">1501</span><br><span class="line">1502</span><br><span class="line">1503</span><br><span class="line">1504</span><br><span class="line">1505</span><br><span class="line">1506</span><br><span class="line">1507</span><br><span class="line">1508</span><br><span class="line">1509</span><br><span class="line">1510</span><br><span class="line">1511</span><br><span class="line">1512</span><br><span class="line">1513</span><br><span class="line">1514</span><br><span class="line">1515</span><br><span class="line">1516</span><br><span class="line">1517</span><br><span class="line">1518</span><br><span class="line">1519</span><br><span class="line">1520</span><br><span class="line">1521</span><br><span class="line">1522</span><br><span class="line">1523</span><br><span class="line">1524</span><br><span class="line">1525</span><br><span class="line">1526</span><br><span class="line">1527</span><br><span class="line">1528</span><br><span class="line">1529</span><br><span class="line">1530</span><br><span class="line">1531</span><br><span class="line">1532</span><br><span class="line">1533</span><br><span class="line">1534</span><br><span class="line">1535</span><br><span class="line">1536</span><br><span class="line">1537</span><br><span class="line">1538</span><br><span class="line">1539</span><br><span class="line">1540</span><br><span class="line">1541</span><br><span class="line">1542</span><br><span class="line">1543</span><br><span class="line">1544</span><br><span class="line">1545</span><br><span class="line">1546</span><br><span class="line">1547</span><br><span class="line">1548</span><br><span class="line">1549</span><br><span class="line">1550</span><br><span class="line">1551</span><br><span class="line">1552</span><br><span class="line">1553</span><br><span class="line">1554</span><br><span class="line">1555</span><br><span class="line">1556</span><br><span class="line">1557</span><br><span class="line">1558</span><br><span class="line">1559</span><br><span class="line">1560</span><br><span class="line">1561</span><br><span class="line">1562</span><br><span class="line">1563</span><br><span class="line">1564</span><br><span class="line">1565</span><br><span class="line">1566</span><br><span class="line">1567</span><br><span class="line">1568</span><br><span class="line">1569</span><br><span class="line">1570</span><br><span class="line">1571</span><br><span class="line">1572</span><br><span class="line">1573</span><br><span class="line">1574</span><br><span class="line">1575</span><br><span class="line">1576</span><br><span class="line">1577</span><br><span class="line">1578</span><br><span class="line">1579</span><br><span class="line">1580</span><br><span class="line">1581</span><br><span class="line">1582</span><br><span class="line">1583</span><br><span class="line">1584</span><br><span class="line">1585</span><br><span class="line">1586</span><br><span class="line">1587</span><br><span class="line">1588</span><br><span class="line">1589</span><br><span class="line">1590</span><br><span class="line">1591</span><br><span class="line">1592</span><br><span class="line">1593</span><br><span class="line">1594</span><br><span class="line">1595</span><br><span class="line">1596</span><br><span class="line">1597</span><br><span class="line">1598</span><br><span class="line">1599</span><br><span class="line">1600</span><br><span class="line">1601</span><br><span class="line">1602</span><br><span class="line">1603</span><br><span class="line">1604</span><br><span class="line">1605</span><br><span class="line">1606</span><br><span class="line">1607</span><br><span class="line">1608</span><br><span class="line">1609</span><br><span class="line">1610</span><br><span class="line">1611</span><br><span class="line">1612</span><br><span class="line">1613</span><br><span class="line">1614</span><br><span class="line">1615</span><br><span class="line">1616</span><br><span class="line">1617</span><br><span class="line">1618</span><br><span class="line">1619</span><br><span class="line">1620</span><br><span class="line">1621</span><br><span class="line">1622</span><br><span class="line">1623</span><br><span class="line">1624</span><br><span class="line">1625</span><br><span class="line">1626</span><br><span class="line">1627</span><br><span class="line">1628</span><br><span class="line">1629</span><br><span class="line">1630</span><br><span class="line">1631</span><br><span class="line">1632</span><br><span class="line">1633</span><br><span class="line">1634</span><br><span class="line">1635</span><br><span class="line">1636</span><br><span class="line">1637</span><br><span class="line">1638</span><br><span class="line">1639</span><br><span class="line">1640</span><br><span class="line">1641</span><br><span class="line">1642</span><br><span class="line">1643</span><br><span class="line">1644</span><br><span class="line">1645</span><br><span class="line">1646</span><br><span class="line">1647</span><br><span class="line">1648</span><br><span class="line">1649</span><br><span class="line">1650</span><br><span class="line">1651</span><br><span class="line">1652</span><br><span class="line">1653</span><br><span class="line">1654</span><br><span class="line">1655</span><br><span class="line">1656</span><br><span class="line">1657</span><br><span class="line">1658</span><br><span class="line">1659</span><br><span class="line">1660</span><br><span class="line">1661</span><br><span class="line">1662</span><br><span class="line">1663</span><br><span class="line">1664</span><br><span class="line">1665</span><br><span class="line">1666</span><br><span class="line">1667</span><br><span class="line">1668</span><br><span class="line">1669</span><br><span class="line">1670</span><br><span class="line">1671</span><br><span class="line">1672</span><br><span class="line">1673</span><br><span class="line">1674</span><br><span class="line">1675</span><br><span class="line">1676</span><br><span class="line">1677</span><br><span class="line">1678</span><br><span class="line">1679</span><br><span class="line">1680</span><br><span class="line">1681</span><br><span class="line">1682</span><br><span class="line">1683</span><br><span class="line">1684</span><br><span class="line">1685</span><br><span class="line">1686</span><br><span class="line">1687</span><br><span class="line">1688</span><br><span class="line">1689</span><br><span class="line">1690</span><br><span class="line">1691</span><br><span class="line">1692</span><br><span class="line">1693</span><br><span class="line">1694</span><br><span class="line">1695</span><br><span class="line">1696</span><br><span class="line">1697</span><br><span class="line">1698</span><br><span class="line">1699</span><br><span class="line">1700</span><br><span class="line">1701</span><br><span class="line">1702</span><br><span class="line">1703</span><br><span class="line">1704</span><br><span class="line">1705</span><br><span class="line">1706</span><br><span class="line">1707</span><br><span class="line">1708</span><br><span class="line">1709</span><br><span class="line">1710</span><br><span class="line">1711</span><br><span class="line">1712</span><br><span class="line">1713</span><br><span class="line">1714</span><br><span class="line">1715</span><br><span class="line">1716</span><br><span class="line">1717</span><br><span class="line">1718</span><br><span class="line">1719</span><br><span class="line">1720</span><br><span class="line">1721</span><br><span class="line">1722</span><br><span class="line">1723</span><br><span class="line">1724</span><br><span class="line">1725</span><br><span class="line">1726</span><br><span class="line">1727</span><br><span class="line">1728</span><br><span class="line">1729</span><br><span class="line">1730</span><br><span class="line">1731</span><br><span class="line">1732</span><br><span class="line">1733</span><br><span class="line">1734</span><br><span class="line">1735</span><br><span class="line">1736</span><br><span class="line">1737</span><br><span class="line">1738</span><br><span class="line">1739</span><br><span class="line">1740</span><br><span class="line">1741</span><br><span class="line">1742</span><br><span class="line">1743</span><br><span class="line">1744</span><br><span class="line">1745</span><br><span class="line">1746</span><br><span class="line">1747</span><br><span class="line">1748</span><br><span class="line">1749</span><br><span class="line">1750</span><br><span class="line">1751</span><br><span class="line">1752</span><br><span class="line">1753</span><br><span class="line">1754</span><br><span class="line">1755</span><br><span class="line">1756</span><br><span class="line">1757</span><br><span class="line">1758</span><br><span class="line">1759</span><br><span class="line">1760</span><br><span class="line">1761</span><br><span class="line">1762</span><br><span class="line">1763</span><br><span class="line">1764</span><br><span class="line">1765</span><br><span class="line">1766</span><br><span class="line">1767</span><br><span class="line">1768</span><br><span class="line">1769</span><br><span class="line">1770</span><br><span class="line">1771</span><br><span class="line">1772</span><br><span class="line">1773</span><br><span class="line">1774</span><br><span class="line">1775</span><br><span class="line">1776</span><br><span class="line">1777</span><br><span class="line">1778</span><br><span class="line">1779</span><br><span class="line">1780</span><br><span class="line">1781</span><br><span class="line">1782</span><br><span class="line">1783</span><br><span class="line">1784</span><br><span class="line">1785</span><br><span class="line">1786</span><br><span class="line">1787</span><br><span class="line">1788</span><br><span class="line">1789</span><br><span class="line">1790</span><br><span class="line">1791</span><br><span class="line">1792</span><br><span class="line">1793</span><br><span class="line">1794</span><br><span class="line">1795</span><br><span class="line">1796</span><br><span class="line">1797</span><br><span class="line">1798</span><br><span class="line">1799</span><br><span class="line">1800</span><br><span class="line">1801</span><br><span class="line">1802</span><br><span class="line">1803</span><br><span class="line">1804</span><br><span class="line">1805</span><br><span class="line">1806</span><br><span class="line">1807</span><br><span class="line">1808</span><br><span class="line">1809</span><br><span class="line">1810</span><br><span class="line">1811</span><br><span class="line">1812</span><br><span class="line">1813</span><br><span class="line">1814</span><br><span class="line">1815</span><br><span class="line">1816</span><br><span class="line">1817</span><br><span class="line">1818</span><br><span class="line">1819</span><br><span class="line">1820</span><br><span class="line">1821</span><br><span class="line">1822</span><br><span class="line">1823</span><br><span class="line">1824</span><br><span class="line">1825</span><br><span class="line">1826</span><br><span class="line">1827</span><br><span class="line">1828</span><br><span class="line">1829</span><br><span class="line">1830</span><br><span class="line">1831</span><br><span class="line">1832</span><br><span class="line">1833</span><br><span class="line">1834</span><br><span class="line">1835</span><br><span class="line">1836</span><br><span class="line">1837</span><br><span class="line">1838</span><br><span class="line">1839</span><br><span class="line">1840</span><br><span class="line">1841</span><br><span class="line">1842</span><br><span class="line">1843</span><br><span class="line">1844</span><br><span class="line">1845</span><br><span class="line">1846</span><br><span class="line">1847</span><br><span class="line">1848</span><br><span class="line">1849</span><br><span class="line">1850</span><br><span class="line">1851</span><br><span class="line">1852</span><br><span class="line">1853</span><br><span class="line">1854</span><br><span class="line">1855</span><br><span class="line">1856</span><br><span class="line">1857</span><br><span class="line">1858</span><br><span class="line">1859</span><br><span class="line">1860</span><br><span class="line">1861</span><br><span class="line">1862</span><br><span class="line">1863</span><br><span class="line">1864</span><br><span class="line">1865</span><br><span class="line">1866</span><br><span class="line">1867</span><br><span class="line">1868</span><br><span class="line">1869</span><br><span class="line">1870</span><br><span class="line">1871</span><br><span class="line">1872</span><br><span class="line">1873</span><br><span class="line">1874</span><br><span class="line">1875</span><br><span class="line">1876</span><br><span class="line">1877</span><br><span class="line">1878</span><br><span class="line">1879</span><br><span class="line">1880</span><br><span class="line">1881</span><br><span class="line">1882</span><br><span class="line">1883</span><br><span class="line">1884</span><br><span class="line">1885</span><br><span class="line">1886</span><br><span class="line">1887</span><br><span class="line">1888</span><br><span class="line">1889</span><br><span class="line">1890</span><br><span class="line">1891</span><br><span class="line">1892</span><br><span class="line">1893</span><br><span class="line">1894</span><br><span class="line">1895</span><br><span class="line">1896</span><br><span class="line">1897</span><br><span class="line">1898</span><br><span class="line">1899</span><br><span class="line">1900</span><br><span class="line">1901</span><br><span class="line">1902</span><br><span class="line">1903</span><br><span class="line">1904</span><br><span class="line">1905</span><br><span class="line">1906</span><br><span class="line">1907</span><br><span class="line">1908</span><br><span class="line">1909</span><br><span class="line">1910</span><br><span class="line">1911</span><br><span class="line">1912</span><br><span class="line">1913</span><br><span class="line">1914</span><br><span class="line">1915</span><br><span class="line">1916</span><br><span class="line">1917</span><br><span class="line">1918</span><br><span class="line">1919</span><br><span class="line">1920</span><br><span class="line">1921</span><br><span class="line">1922</span><br><span class="line">1923</span><br><span class="line">1924</span><br><span class="line">1925</span><br><span class="line">1926</span><br><span class="line">1927</span><br><span class="line">1928</span><br><span class="line">1929</span><br><span class="line">1930</span><br><span class="line">1931</span><br><span class="line">1932</span><br><span class="line">1933</span><br><span class="line">1934</span><br><span class="line">1935</span><br><span class="line">1936</span><br><span class="line">1937</span><br><span class="line">1938</span><br><span class="line">1939</span><br><span class="line">1940</span><br><span class="line">1941</span><br><span class="line">1942</span><br><span class="line">1943</span><br><span class="line">1944</span><br><span class="line">1945</span><br><span class="line">1946</span><br><span class="line">1947</span><br><span class="line">1948</span><br><span class="line">1949</span><br><span class="line">1950</span><br><span class="line">1951</span><br><span class="line">1952</span><br><span class="line">1953</span><br><span class="line">1954</span><br><span class="line">1955</span><br><span class="line">1956</span><br><span class="line">1957</span><br><span class="line">1958</span><br><span class="line">1959</span><br><span class="line">1960</span><br><span class="line">1961</span><br><span class="line">1962</span><br><span class="line">1963</span><br><span class="line">1964</span><br><span class="line">1965</span><br><span class="line">1966</span><br><span class="line">1967</span><br><span class="line">1968</span><br><span class="line">1969</span><br><span class="line">1970</span><br><span class="line">1971</span><br><span class="line">1972</span><br><span class="line">1973</span><br><span class="line">1974</span><br><span class="line">1975</span><br><span class="line">1976</span><br><span class="line">1977</span><br><span class="line">1978</span><br><span class="line">1979</span><br><span class="line">1980</span><br><span class="line">1981</span><br><span class="line">1982</span><br><span class="line">1983</span><br><span class="line">1984</span><br><span class="line">1985</span><br><span class="line">1986</span><br><span class="line">1987</span><br><span class="line">1988</span><br><span class="line">1989</span><br><span class="line">1990</span><br><span class="line">1991</span><br><span class="line">1992</span><br><span class="line">1993</span><br><span class="line">1994</span><br><span class="line">1995</span><br><span class="line">1996</span><br><span class="line">1997</span><br><span class="line">1998</span><br><span class="line">1999</span><br><span class="line">2000</span><br><span class="line">2001</span><br><span class="line">2002</span><br><span class="line">2003</span><br><span class="line">2004</span><br><span class="line">2005</span><br><span class="line">2006</span><br><span class="line">2007</span><br><span class="line">2008</span><br><span class="line">2009</span><br><span class="line">2010</span><br><span class="line">2011</span><br><span class="line">2012</span><br><span class="line">2013</span><br><span class="line">2014</span><br><span class="line">2015</span><br><span class="line">2016</span><br><span class="line">2017</span><br><span class="line">2018</span><br><span class="line">2019</span><br><span class="line">2020</span><br><span class="line">2021</span><br><span class="line">2022</span><br><span class="line">2023</span><br><span class="line">2024</span><br><span class="line">2025</span><br><span class="line">2026</span><br><span class="line">2027</span><br><span class="line">2028</span><br><span class="line">2029</span><br><span class="line">2030</span><br><span class="line">2031</span><br><span class="line">2032</span><br><span class="line">2033</span><br><span class="line">2034</span><br><span class="line">2035</span><br><span class="line">2036</span><br><span class="line">2037</span><br><span class="line">2038</span><br><span class="line">2039</span><br><span class="line">2040</span><br><span class="line">2041</span><br><span class="line">2042</span><br><span class="line">2043</span><br><span class="line">2044</span><br><span class="line">2045</span><br><span class="line">2046</span><br><span class="line">2047</span><br><span class="line">2048</span><br><span class="line">2049</span><br><span class="line">2050</span><br><span class="line">2051</span><br><span class="line">2052</span><br><span class="line">2053</span><br><span class="line">2054</span><br><span class="line">2055</span><br><span class="line">2056</span><br><span class="line">2057</span><br><span class="line">2058</span><br><span class="line">2059</span><br><span class="line">2060</span><br><span class="line">2061</span><br><span class="line">2062</span><br><span class="line">2063</span><br><span class="line">2064</span><br><span class="line">2065</span><br><span class="line">2066</span><br><span class="line">2067</span><br><span class="line">2068</span><br><span class="line">2069</span><br><span class="line">2070</span><br><span class="line">2071</span><br><span class="line">2072</span><br><span class="line">2073</span><br><span class="line">2074</span><br><span class="line">2075</span><br><span class="line">2076</span><br><span class="line">2077</span><br><span class="line">2078</span><br><span class="line">2079</span><br><span class="line">2080</span><br><span class="line">2081</span><br><span class="line">2082</span><br><span class="line">2083</span><br><span class="line">2084</span><br><span class="line">2085</span><br><span class="line">2086</span><br><span class="line">2087</span><br><span class="line">2088</span><br><span class="line">2089</span><br><span class="line">2090</span><br><span class="line">2091</span><br><span class="line">2092</span><br><span class="line">2093</span><br><span class="line">2094</span><br><span class="line">2095</span><br><span class="line">2096</span><br><span class="line">2097</span><br><span class="line">2098</span><br><span class="line">2099</span><br><span class="line">2100</span><br><span class="line">2101</span><br><span class="line">2102</span><br><span class="line">2103</span><br><span class="line">2104</span><br><span class="line">2105</span><br><span class="line">2106</span><br><span class="line">2107</span><br><span class="line">2108</span><br><span class="line">2109</span><br><span class="line">2110</span><br><span class="line">2111</span><br><span class="line">2112</span><br><span class="line">2113</span><br><span class="line">2114</span><br><span class="line">2115</span><br><span class="line">2116</span><br><span class="line">2117</span><br><span class="line">2118</span><br><span class="line">2119</span><br><span class="line">2120</span><br><span class="line">2121</span><br><span class="line">2122</span><br><span class="line">2123</span><br><span class="line">2124</span><br><span class="line">2125</span><br><span class="line">2126</span><br><span class="line">2127</span><br><span class="line">2128</span><br><span class="line">2129</span><br><span class="line">2130</span><br><span class="line">2131</span><br><span class="line">2132</span><br><span class="line">2133</span><br><span class="line">2134</span><br><span class="line">2135</span><br><span class="line">2136</span><br><span class="line">2137</span><br><span class="line">2138</span><br><span class="line">2139</span><br><span class="line">2140</span><br><span class="line">2141</span><br><span class="line">2142</span><br><span class="line">2143</span><br><span class="line">2144</span><br><span class="line">2145</span><br><span class="line">2146</span><br><span class="line">2147</span><br><span class="line">2148</span><br><span class="line">2149</span><br><span class="line">2150</span><br><span class="line">2151</span><br><span class="line">2152</span><br><span class="line">2153</span><br><span class="line">2154</span><br><span class="line">2155</span><br><span class="line">2156</span><br><span class="line">2157</span><br><span class="line">2158</span><br><span class="line">2159</span><br><span class="line">2160</span><br><span class="line">2161</span><br><span class="line">2162</span><br><span class="line">2163</span><br><span class="line">2164</span><br><span class="line">2165</span><br><span class="line">2166</span><br><span class="line">2167</span><br><span class="line">2168</span><br><span class="line">2169</span><br><span class="line">2170</span><br><span class="line">2171</span><br><span class="line">2172</span><br><span class="line">2173</span><br><span class="line">2174</span><br><span class="line">2175</span><br><span class="line">2176</span><br><span class="line">2177</span><br><span class="line">2178</span><br><span class="line">2179</span><br><span class="line">2180</span><br><span class="line">2181</span><br><span class="line">2182</span><br><span class="line">2183</span><br><span class="line">2184</span><br><span class="line">2185</span><br><span class="line">2186</span><br><span class="line">2187</span><br><span class="line">2188</span><br><span class="line">2189</span><br><span class="line">2190</span><br><span class="line">2191</span><br><span class="line">2192</span><br><span class="line">2193</span><br><span class="line">2194</span><br><span class="line">2195</span><br><span class="line">2196</span><br><span class="line">2197</span><br><span class="line">2198</span><br><span class="line">2199</span><br><span class="line">2200</span><br><span class="line">2201</span><br><span class="line">2202</span><br><span class="line">2203</span><br><span class="line">2204</span><br><span class="line">2205</span><br><span class="line">2206</span><br><span class="line">2207</span><br><span class="line">2208</span><br><span class="line">2209</span><br><span class="line">2210</span><br><span class="line">2211</span><br><span class="line">2212</span><br><span class="line">2213</span><br><span class="line">2214</span><br><span class="line">2215</span><br><span class="line">2216</span><br><span class="line">2217</span><br><span class="line">2218</span><br><span class="line">2219</span><br><span class="line">2220</span><br><span class="line">2221</span><br><span class="line">2222</span><br><span class="line">2223</span><br><span class="line">2224</span><br><span class="line">2225</span><br><span class="line">2226</span><br><span class="line">2227</span><br><span class="line">2228</span><br><span class="line">2229</span><br><span class="line">2230</span><br><span class="line">2231</span><br><span class="line">2232</span><br><span class="line">2233</span><br><span class="line">2234</span><br><span class="line">2235</span><br><span class="line">2236</span><br><span class="line">2237</span><br><span class="line">2238</span><br><span class="line">2239</span><br><span class="line">2240</span><br><span class="line">2241</span><br><span class="line">2242</span><br><span class="line">2243</span><br><span class="line">2244</span><br><span class="line">2245</span><br><span class="line">2246</span><br><span class="line">2247</span><br><span class="line">2248</span><br><span class="line">2249</span><br><span class="line">2250</span><br><span class="line">2251</span><br><span class="line">2252</span><br><span class="line">2253</span><br><span class="line">2254</span><br><span class="line">2255</span><br><span class="line">2256</span><br><span class="line">2257</span><br><span class="line">2258</span><br><span class="line">2259</span><br><span class="line">2260</span><br><span class="line">2261</span><br><span class="line">2262</span><br><span class="line">2263</span><br><span class="line">2264</span><br><span class="line">2265</span><br><span class="line">2266</span><br><span class="line">2267</span><br><span class="line">2268</span><br><span class="line">2269</span><br><span class="line">2270</span><br><span class="line">2271</span><br><span class="line">2272</span><br><span class="line">2273</span><br><span class="line">2274</span><br><span class="line">2275</span><br><span class="line">2276</span><br><span class="line">2277</span><br><span class="line">2278</span><br><span class="line">2279</span><br><span class="line">2280</span><br><span class="line">2281</span><br><span class="line">2282</span><br><span class="line">2283</span><br><span class="line">2284</span><br><span class="line">2285</span><br><span class="line">2286</span><br><span class="line">2287</span><br><span class="line">2288</span><br><span class="line">2289</span><br><span class="line">2290</span><br><span class="line">2291</span><br><span class="line">2292</span><br><span class="line">2293</span><br><span class="line">2294</span><br><span class="line">2295</span><br><span class="line">2296</span><br><span class="line">2297</span><br><span class="line">2298</span><br><span class="line">2299</span><br><span class="line">2300</span><br><span class="line">2301</span><br><span class="line">2302</span><br><span class="line">2303</span><br><span class="line">2304</span><br><span class="line">2305</span><br><span class="line">2306</span><br><span class="line">2307</span><br><span class="line">2308</span><br><span class="line">2309</span><br><span class="line">2310</span><br><span class="line">2311</span><br><span class="line">2312</span><br><span class="line">2313</span><br><span class="line">2314</span><br><span class="line">2315</span><br><span class="line">2316</span><br><span class="line">2317</span><br><span class="line">2318</span><br><span class="line">2319</span><br><span class="line">2320</span><br><span class="line">2321</span><br><span class="line">2322</span><br><span class="line">2323</span><br><span class="line">2324</span><br><span class="line">2325</span><br><span class="line">2326</span><br><span class="line">2327</span><br><span class="line">2328</span><br><span class="line">2329</span><br><span class="line">2330</span><br><span class="line">2331</span><br><span class="line">2332</span><br><span class="line">2333</span><br><span class="line">2334</span><br><span class="line">2335</span><br><span class="line">2336</span><br><span class="line">2337</span><br><span class="line">2338</span><br><span class="line">2339</span><br><span class="line">2340</span><br><span class="line">2341</span><br><span class="line">2342</span><br><span class="line">2343</span><br><span class="line">2344</span><br><span class="line">2345</span><br><span class="line">2346</span><br><span class="line">2347</span><br><span class="line">2348</span><br><span class="line">2349</span><br><span class="line">2350</span><br><span class="line">2351</span><br><span class="line">2352</span><br><span class="line">2353</span><br><span class="line">2354</span><br><span class="line">2355</span><br><span class="line">2356</span><br><span class="line">2357</span><br><span class="line">2358</span><br><span class="line">2359</span><br><span class="line">2360</span><br><span class="line">2361</span><br><span class="line">2362</span><br><span class="line">2363</span><br><span class="line">2364</span><br><span class="line">2365</span><br><span class="line">2366</span><br><span class="line">2367</span><br><span class="line">2368</span><br><span class="line">2369</span><br><span class="line">2370</span><br><span class="line">2371</span><br><span class="line">2372</span><br><span class="line">2373</span><br><span class="line">2374</span><br><span class="line">2375</span><br><span class="line">2376</span><br><span class="line">2377</span><br><span class="line">2378</span><br><span class="line">2379</span><br><span class="line">2380</span><br><span class="line">2381</span><br><span class="line">2382</span><br><span class="line">2383</span><br><span class="line">2384</span><br><span class="line">2385</span><br><span class="line">2386</span><br><span class="line">2387</span><br><span class="line">2388</span><br><span class="line">2389</span><br><span class="line">2390</span><br><span class="line">2391</span><br><span class="line">2392</span><br><span class="line">2393</span><br><span class="line">2394</span><br><span class="line">2395</span><br><span class="line">2396</span><br><span class="line">2397</span><br><span class="line">2398</span><br><span class="line">2399</span><br><span class="line">2400</span><br><span class="line">2401</span><br><span class="line">2402</span><br><span class="line">2403</span><br><span class="line">2404</span><br><span class="line">2405</span><br><span class="line">2406</span><br><span class="line">2407</span><br><span class="line">2408</span><br><span class="line">2409</span><br><span class="line">2410</span><br><span class="line">2411</span><br><span class="line">2412</span><br><span class="line">2413</span><br><span class="line">2414</span><br><span class="line">2415</span><br><span class="line">2416</span><br><span class="line">2417</span><br><span class="line">2418</span><br><span class="line">2419</span><br><span class="line">2420</span><br><span class="line">2421</span><br><span class="line">2422</span><br><span class="line">2423</span><br><span class="line">2424</span><br><span class="line">2425</span><br><span class="line">2426</span><br><span class="line">2427</span><br><span class="line">2428</span><br><span class="line">2429</span><br><span class="line">2430</span><br><span class="line">2431</span><br><span class="line">2432</span><br><span class="line">2433</span><br><span class="line">2434</span><br><span class="line">2435</span><br><span class="line">2436</span><br><span class="line">2437</span><br><span class="line">2438</span><br><span class="line">2439</span><br><span class="line">2440</span><br><span class="line">2441</span><br><span class="line">2442</span><br><span class="line">2443</span><br><span class="line">2444</span><br><span class="line">2445</span><br><span class="line">2446</span><br><span class="line">2447</span><br><span class="line">2448</span><br><span class="line">2449</span><br><span class="line">2450</span><br><span class="line">2451</span><br><span class="line">2452</span><br><span class="line">2453</span><br><span class="line">2454</span><br><span class="line">2455</span><br><span class="line">2456</span><br><span class="line">2457</span><br><span class="line">2458</span><br><span class="line">2459</span><br><span class="line">2460</span><br><span class="line">2461</span><br><span class="line">2462</span><br><span class="line">2463</span><br><span class="line">2464</span><br><span class="line">2465</span><br><span class="line">2466</span><br><span class="line">2467</span><br><span class="line">2468</span><br><span class="line">2469</span><br><span class="line">2470</span><br><span class="line">2471</span><br><span class="line">2472</span><br><span class="line">2473</span><br><span class="line">2474</span><br><span class="line">2475</span><br><span class="line">2476</span><br><span class="line">2477</span><br><span class="line">2478</span><br><span class="line">2479</span><br><span class="line">2480</span><br><span class="line">2481</span><br><span class="line">2482</span><br><span class="line">2483</span><br><span class="line">2484</span><br><span class="line">2485</span><br><span class="line">2486</span><br><span class="line">2487</span><br><span class="line">2488</span><br><span class="line">2489</span><br><span class="line">2490</span><br><span class="line">2491</span><br><span class="line">2492</span><br><span class="line">2493</span><br><span class="line">2494</span><br><span class="line">2495</span><br><span class="line">2496</span><br><span class="line">2497</span><br><span class="line">2498</span><br><span class="line">2499</span><br><span class="line">2500</span><br><span class="line">2501</span><br><span class="line">2502</span><br><span class="line">2503</span><br><span class="line">2504</span><br><span class="line">2505</span><br><span class="line">2506</span><br><span class="line">2507</span><br><span class="line">2508</span><br><span class="line">2509</span><br><span class="line">2510</span><br><span class="line">2511</span><br><span class="line">2512</span><br><span class="line">2513</span><br><span class="line">2514</span><br><span class="line">2515</span><br><span class="line">2516</span><br><span class="line">2517</span><br><span class="line">2518</span><br><span class="line">2519</span><br><span class="line">2520</span><br><span class="line">2521</span><br><span class="line">2522</span><br><span class="line">2523</span><br><span class="line">2524</span><br><span class="line">2525</span><br><span class="line">2526</span><br><span class="line">2527</span><br><span class="line">2528</span><br><span class="line">2529</span><br><span class="line">2530</span><br><span class="line">2531</span><br><span class="line">2532</span><br><span class="line">2533</span><br><span class="line">2534</span><br><span class="line">2535</span><br><span class="line">2536</span><br><span class="line">2537</span><br><span class="line">2538</span><br><span class="line">2539</span><br><span class="line">2540</span><br><span class="line">2541</span><br><span class="line">2542</span><br><span class="line">2543</span><br><span class="line">2544</span><br><span class="line">2545</span><br><span class="line">2546</span><br><span class="line">2547</span><br><span class="line">2548</span><br><span class="line">2549</span><br><span class="line">2550</span><br><span class="line">2551</span><br><span class="line">2552</span><br><span class="line">2553</span><br><span class="line">2554</span><br><span class="line">2555</span><br><span class="line">2556</span><br><span class="line">2557</span><br><span class="line">2558</span><br><span class="line">2559</span><br><span class="line">2560</span><br><span class="line">2561</span><br><span class="line">2562</span><br><span class="line">2563</span><br><span class="line">2564</span><br><span class="line">2565</span><br><span class="line">2566</span><br><span class="line">2567</span><br><span class="line">2568</span><br><span class="line">2569</span><br><span class="line">2570</span><br><span class="line">2571</span><br><span class="line">2572</span><br><span class="line">2573</span><br><span class="line">2574</span><br><span class="line">2575</span><br><span class="line">2576</span><br><span class="line">2577</span><br><span class="line">2578</span><br><span class="line">2579</span><br><span class="line">2580</span><br><span class="line">2581</span><br><span class="line">2582</span><br><span class="line">2583</span><br><span class="line">2584</span><br><span class="line">2585</span><br><span class="line">2586</span><br><span class="line">2587</span><br><span class="line">2588</span><br><span class="line">2589</span><br><span class="line">2590</span><br><span class="line">2591</span><br><span class="line">2592</span><br><span class="line">2593</span><br><span class="line">2594</span><br><span class="line">2595</span><br><span class="line">2596</span><br><span class="line">2597</span><br><span class="line">2598</span><br><span class="line">2599</span><br><span class="line">2600</span><br><span class="line">2601</span><br><span class="line">2602</span><br><span class="line">2603</span><br><span class="line">2604</span><br><span class="line">2605</span><br><span class="line">2606</span><br><span class="line">2607</span><br><span class="line">2608</span><br><span class="line">2609</span><br><span class="line">2610</span><br><span class="line">2611</span><br><span class="line">2612</span><br><span class="line">2613</span><br><span class="line">2614</span><br><span class="line">2615</span><br><span class="line">2616</span><br><span class="line">2617</span><br><span class="line">2618</span><br><span class="line">2619</span><br><span class="line">2620</span><br><span class="line">2621</span><br><span class="line">2622</span><br><span class="line">2623</span><br><span class="line">2624</span><br><span class="line">2625</span><br><span class="line">2626</span><br><span class="line">2627</span><br><span class="line">2628</span><br><span class="line">2629</span><br><span class="line">2630</span><br><span class="line">2631</span><br><span class="line">2632</span><br><span class="line">2633</span><br><span class="line">2634</span><br><span class="line">2635</span><br><span class="line">2636</span><br><span class="line">2637</span><br><span class="line">2638</span><br><span class="line">2639</span><br><span class="line">2640</span><br><span class="line">2641</span><br><span class="line">2642</span><br><span class="line">2643</span><br><span class="line">2644</span><br><span class="line">2645</span><br><span class="line">2646</span><br><span class="line">2647</span><br><span class="line">2648</span><br><span class="line">2649</span><br><span class="line">2650</span><br><span class="line">2651</span><br><span class="line">2652</span><br><span class="line">2653</span><br><span class="line">2654</span><br><span class="line">2655</span><br><span class="line">2656</span><br><span class="line">2657</span><br><span class="line">2658</span><br><span class="line">2659</span><br><span class="line">2660</span><br><span class="line">2661</span><br><span class="line">2662</span><br><span class="line">2663</span><br><span class="line">2664</span><br><span class="line">2665</span><br><span class="line">2666</span><br><span class="line">2667</span><br><span class="line">2668</span><br><span class="line">2669</span><br><span class="line">2670</span><br><span class="line">2671</span><br><span class="line">2672</span><br><span class="line">2673</span><br><span class="line">2674</span><br><span class="line">2675</span><br><span class="line">2676</span><br><span class="line">2677</span><br><span class="line">2678</span><br><span class="line">2679</span><br><span class="line">2680</span><br><span class="line">2681</span><br><span class="line">2682</span><br><span class="line">2683</span><br><span class="line">2684</span><br><span class="line">2685</span><br><span class="line">2686</span><br><span class="line">2687</span><br><span class="line">2688</span><br><span class="line">2689</span><br><span class="line">2690</span><br><span class="line">2691</span><br><span class="line">2692</span><br><span class="line">2693</span><br><span class="line">2694</span><br><span class="line">2695</span><br><span class="line">2696</span><br><span class="line">2697</span><br><span class="line">2698</span><br><span class="line">2699</span><br><span class="line">2700</span><br><span class="line">2701</span><br><span class="line">2702</span><br><span class="line">2703</span><br><span class="line">2704</span><br><span class="line">2705</span><br><span class="line">2706</span><br><span class="line">2707</span><br><span class="line">2708</span><br><span class="line">2709</span><br><span class="line">2710</span><br><span class="line">2711</span><br><span class="line">2712</span><br><span class="line">2713</span><br><span class="line">2714</span><br><span class="line">2715</span><br><span class="line">2716</span><br><span class="line">2717</span><br><span class="line">2718</span><br><span class="line">2719</span><br><span class="line">2720</span><br><span class="line">2721</span><br><span class="line">2722</span><br><span class="line">2723</span><br><span class="line">2724</span><br><span class="line">2725</span><br><span class="line">2726</span><br><span class="line">2727</span><br><span class="line">2728</span><br><span class="line">2729</span><br><span class="line">2730</span><br><span class="line">2731</span><br><span class="line">2732</span><br><span class="line">2733</span><br><span class="line">2734</span><br><span class="line">2735</span><br><span class="line">2736</span><br><span class="line">2737</span><br><span class="line">2738</span><br><span class="line">2739</span><br><span class="line">2740</span><br><span class="line">2741</span><br><span class="line">2742</span><br><span class="line">2743</span><br><span class="line">2744</span><br><span class="line">2745</span><br><span class="line">2746</span><br><span class="line">2747</span><br><span class="line">2748</span><br><span class="line">2749</span><br><span class="line">2750</span><br><span class="line">2751</span><br><span class="line">2752</span><br><span class="line">2753</span><br><span class="line">2754</span><br><span class="line">2755</span><br><span class="line">2756</span><br><span class="line">2757</span><br><span class="line">2758</span><br><span class="line">2759</span><br><span class="line">2760</span><br><span class="line">2761</span><br><span class="line">2762</span><br><span class="line">2763</span><br><span class="line">2764</span><br><span class="line">2765</span><br><span class="line">2766</span><br><span class="line">2767</span><br><span class="line">2768</span><br><span class="line">2769</span><br><span class="line">2770</span><br><span class="line">2771</span><br><span class="line">2772</span><br><span class="line">2773</span><br><span class="line">2774</span><br><span class="line">2775</span><br><span class="line">2776</span><br><span class="line">2777</span><br><span class="line">2778</span><br><span class="line">2779</span><br><span class="line">2780</span><br><span class="line">2781</span><br><span class="line">2782</span><br><span class="line">2783</span><br><span class="line">2784</span><br><span class="line">2785</span><br><span class="line">2786</span><br><span class="line">2787</span><br><span class="line">2788</span><br><span class="line">2789</span><br><span class="line">2790</span><br><span class="line">2791</span><br><span class="line">2792</span><br><span class="line">2793</span><br><span class="line">2794</span><br><span class="line">2795</span><br><span class="line">2796</span><br><span class="line">2797</span><br><span class="line">2798</span><br><span class="line">2799</span><br><span class="line">2800</span><br><span class="line">2801</span><br><span class="line">2802</span><br><span class="line">2803</span><br><span class="line">2804</span><br><span class="line">2805</span><br><span class="line">2806</span><br><span class="line">2807</span><br><span class="line">2808</span><br><span class="line">2809</span><br><span class="line">2810</span><br><span class="line">2811</span><br><span class="line">2812</span><br><span class="line">2813</span><br><span class="line">2814</span><br><span class="line">2815</span><br><span class="line">2816</span><br><span class="line">2817</span><br><span class="line">2818</span><br><span class="line">2819</span><br><span class="line">2820</span><br><span class="line">2821</span><br><span class="line">2822</span><br><span class="line">2823</span><br><span class="line">2824</span><br><span class="line">2825</span><br><span class="line">2826</span><br><span class="line">2827</span><br><span class="line">2828</span><br><span class="line">2829</span><br><span class="line">2830</span><br><span class="line">2831</span><br><span class="line">2832</span><br><span class="line">2833</span><br><span class="line">2834</span><br><span class="line">2835</span><br><span class="line">2836</span><br><span class="line">2837</span><br><span class="line">2838</span><br><span class="line">2839</span><br><span class="line">2840</span><br><span class="line">2841</span><br><span class="line">2842</span><br><span class="line">2843</span><br><span class="line">2844</span><br><span class="line">2845</span><br><span class="line">2846</span><br><span class="line">2847</span><br><span class="line">2848</span><br><span class="line">2849</span><br><span class="line">2850</span><br><span class="line">2851</span><br><span class="line">2852</span><br><span class="line">2853</span><br><span class="line">2854</span><br><span class="line">2855</span><br><span class="line">2856</span><br><span class="line">2857</span><br><span class="line">2858</span><br><span class="line">2859</span><br><span class="line">2860</span><br><span class="line">2861</span><br><span class="line">2862</span><br><span class="line">2863</span><br><span class="line">2864</span><br><span class="line">2865</span><br><span class="line">2866</span><br><span class="line">2867</span><br><span class="line">2868</span><br><span class="line">2869</span><br><span class="line">2870</span><br><span class="line">2871</span><br><span class="line">2872</span><br><span class="line">2873</span><br><span class="line">2874</span><br><span class="line">2875</span><br><span class="line">2876</span><br><span class="line">2877</span><br><span class="line">2878</span><br><span class="line">2879</span><br><span class="line">2880</span><br><span class="line">2881</span><br><span class="line">2882</span><br><span class="line">2883</span><br><span class="line">2884</span><br><span class="line">2885</span><br><span class="line">2886</span><br><span class="line">2887</span><br><span class="line">2888</span><br><span class="line">2889</span><br><span class="line">2890</span><br><span class="line">2891</span><br><span class="line">2892</span><br><span class="line">2893</span><br><span class="line">2894</span><br><span class="line">2895</span><br><span class="line">2896</span><br><span class="line">2897</span><br><span class="line">2898</span><br><span class="line">2899</span><br><span class="line">2900</span><br><span class="line">2901</span><br><span class="line">2902</span><br><span class="line">2903</span><br><span class="line">2904</span><br><span class="line">2905</span><br><span class="line">2906</span><br><span class="line">2907</span><br><span class="line">2908</span><br><span class="line">2909</span><br><span class="line">2910</span><br><span class="line">2911</span><br><span class="line">2912</span><br><span class="line">2913</span><br><span class="line">2914</span><br><span class="line">2915</span><br><span class="line">2916</span><br><span class="line">2917</span><br><span class="line">2918</span><br><span class="line">2919</span><br><span class="line">2920</span><br><span class="line">2921</span><br><span class="line">2922</span><br><span class="line">2923</span><br><span class="line">2924</span><br><span class="line">2925</span><br><span class="line">2926</span><br><span class="line">2927</span><br><span class="line">2928</span><br><span class="line">2929</span><br><span class="line">2930</span><br><span class="line">2931</span><br><span class="line">2932</span><br><span class="line">2933</span><br><span class="line">2934</span><br><span class="line">2935</span><br><span class="line">2936</span><br><span class="line">2937</span><br><span class="line">2938</span><br><span class="line">2939</span><br><span class="line">2940</span><br><span class="line">2941</span><br><span class="line">2942</span><br><span class="line">2943</span><br><span class="line">2944</span><br><span class="line">2945</span><br><span class="line">2946</span><br><span class="line">2947</span><br><span class="line">2948</span><br><span class="line">2949</span><br><span class="line">2950</span><br><span class="line">2951</span><br><span class="line">2952</span><br><span class="line">2953</span><br><span class="line">2954</span><br><span class="line">2955</span><br><span class="line">2956</span><br><span class="line">2957</span><br><span class="line">2958</span><br><span class="line">2959</span><br><span class="line">2960</span><br><span class="line">2961</span><br><span class="line">2962</span><br><span class="line">2963</span><br><span class="line">2964</span><br><span class="line">2965</span><br><span class="line">2966</span><br><span class="line">2967</span><br><span class="line">2968</span><br><span class="line">2969</span><br><span class="line">2970</span><br><span class="line">2971</span><br><span class="line">2972</span><br><span class="line">2973</span><br><span class="line">2974</span><br><span class="line">2975</span><br><span class="line">2976</span><br><span class="line">2977</span><br><span class="line">2978</span><br><span class="line">2979</span><br><span class="line">2980</span><br><span class="line">2981</span><br><span class="line">2982</span><br><span class="line">2983</span><br><span class="line">2984</span><br><span class="line">2985</span><br><span class="line">2986</span><br><span class="line">2987</span><br><span class="line">2988</span><br><span class="line">2989</span><br><span class="line">2990</span><br><span class="line">2991</span><br><span class="line">2992</span><br><span class="line">2993</span><br><span class="line">2994</span><br><span class="line">2995</span><br><span class="line">2996</span><br><span class="line">2997</span><br><span class="line">2998</span><br><span class="line">2999</span><br><span class="line">3000</span><br><span class="line">3001</span><br><span class="line">3002</span><br><span class="line">3003</span><br><span class="line">3004</span><br><span class="line">3005</span><br><span class="line">3006</span><br><span class="line">3007</span><br><span class="line">3008</span><br><span class="line">3009</span><br><span class="line">3010</span><br><span class="line">3011</span><br><span class="line">3012</span><br><span class="line">3013</span><br><span class="line">3014</span><br><span class="line">3015</span><br><span class="line">3016</span><br><span class="line">3017</span><br><span class="line">3018</span><br><span class="line">3019</span><br><span class="line">3020</span><br><span class="line">3021</span><br><span class="line">3022</span><br><span class="line">3023</span><br><span class="line">3024</span><br><span class="line">3025</span><br><span class="line">3026</span><br><span class="line">3027</span><br><span class="line">3028</span><br><span class="line">3029</span><br><span class="line">3030</span><br><span class="line">3031</span><br><span class="line">3032</span><br><span class="line">3033</span><br><span class="line">3034</span><br><span class="line">3035</span><br><span class="line">3036</span><br><span class="line">3037</span><br><span class="line">3038</span><br><span class="line">3039</span><br><span class="line">3040</span><br><span class="line">3041</span><br><span class="line">3042</span><br><span class="line">3043</span><br><span class="line">3044</span><br><span class="line">3045</span><br><span class="line">3046</span><br><span class="line">3047</span><br><span class="line">3048</span><br><span class="line">3049</span><br><span class="line">3050</span><br><span class="line">3051</span><br><span class="line">3052</span><br><span class="line">3053</span><br><span class="line">3054</span><br><span class="line">3055</span><br><span class="line">3056</span><br><span class="line">3057</span><br><span class="line">3058</span><br><span class="line">3059</span><br><span class="line">3060</span><br><span class="line">3061</span><br><span class="line">3062</span><br><span class="line">3063</span><br><span class="line">3064</span><br><span class="line">3065</span><br><span class="line">3066</span><br><span class="line">3067</span><br><span class="line">3068</span><br><span class="line">3069</span><br><span class="line">3070</span><br><span class="line">3071</span><br><span class="line">3072</span><br><span class="line">3073</span><br><span class="line">3074</span><br><span class="line">3075</span><br><span class="line">3076</span><br><span class="line">3077</span><br><span class="line">3078</span><br><span class="line">3079</span><br><span class="line">3080</span><br><span class="line">3081</span><br><span class="line">3082</span><br><span class="line">3083</span><br><span class="line">3084</span><br><span class="line">3085</span><br><span class="line">3086</span><br><span class="line">3087</span><br><span class="line">3088</span><br><span class="line">3089</span><br><span class="line">3090</span><br><span class="line">3091</span><br><span class="line">3092</span><br><span class="line">3093</span><br><span class="line">3094</span><br><span class="line">3095</span><br><span class="line">3096</span><br><span class="line">3097</span><br><span class="line">3098</span><br><span class="line">3099</span><br><span class="line">3100</span><br><span class="line">3101</span><br><span class="line">3102</span><br><span class="line">3103</span><br><span class="line">3104</span><br><span class="line">3105</span><br><span class="line">3106</span><br><span class="line">3107</span><br><span class="line">3108</span><br><span class="line">3109</span><br><span class="line">3110</span><br><span class="line">3111</span><br><span class="line">3112</span><br><span class="line">3113</span><br><span class="line">3114</span><br><span class="line">3115</span><br><span class="line">3116</span><br><span class="line">3117</span><br><span class="line">3118</span><br><span class="line">3119</span><br><span class="line">3120</span><br><span class="line">3121</span><br><span class="line">3122</span><br><span class="line">3123</span><br><span class="line">3124</span><br><span class="line">3125</span><br><span class="line">3126</span><br><span class="line">3127</span><br><span class="line">3128</span><br><span class="line">3129</span><br><span class="line">3130</span><br><span class="line">3131</span><br><span class="line">3132</span><br><span class="line">3133</span><br><span class="line">3134</span><br><span class="line">3135</span><br><span class="line">3136</span><br><span class="line">3137</span><br><span class="line">3138</span><br><span class="line">3139</span><br><span class="line">3140</span><br><span class="line">3141</span><br><span class="line">3142</span><br><span class="line">3143</span><br><span class="line">3144</span><br><span class="line">3145</span><br><span class="line">3146</span><br><span class="line">3147</span><br><span class="line">3148</span><br><span class="line">3149</span><br><span class="line">3150</span><br><span class="line">3151</span><br><span class="line">3152</span><br><span class="line">3153</span><br><span class="line">3154</span><br><span class="line">3155</span><br><span class="line">3156</span><br><span class="line">3157</span><br><span class="line">3158</span><br><span class="line">3159</span><br><span class="line">3160</span><br><span class="line">3161</span><br><span class="line">3162</span><br><span class="line">3163</span><br><span class="line">3164</span><br><span class="line">3165</span><br><span class="line">3166</span><br><span class="line">3167</span><br><span class="line">3168</span><br><span class="line">3169</span><br><span class="line">3170</span><br><span class="line">3171</span><br><span class="line">3172</span><br><span class="line">3173</span><br><span class="line">3174</span><br><span class="line">3175</span><br><span class="line">3176</span><br><span class="line">3177</span><br><span class="line">3178</span><br><span class="line">3179</span><br><span class="line">3180</span><br><span class="line">3181</span><br><span class="line">3182</span><br><span class="line">3183</span><br><span class="line">3184</span><br><span class="line">3185</span><br><span class="line">3186</span><br><span class="line">3187</span><br><span class="line">3188</span><br><span class="line">3189</span><br><span class="line">3190</span><br><span class="line">3191</span><br><span class="line">3192</span><br><span class="line">3193</span><br><span class="line">3194</span><br><span class="line">3195</span><br><span class="line">3196</span><br><span class="line">3197</span><br><span class="line">3198</span><br><span class="line">3199</span><br><span class="line">3200</span><br><span class="line">3201</span><br><span class="line">3202</span><br><span class="line">3203</span><br><span class="line">3204</span><br><span class="line">3205</span><br><span class="line">3206</span><br><span class="line">3207</span><br><span class="line">3208</span><br><span class="line">3209</span><br><span class="line">3210</span><br><span class="line">3211</span><br><span class="line">3212</span><br><span class="line">3213</span><br><span class="line">3214</span><br><span class="line">3215</span><br><span class="line">3216</span><br><span class="line">3217</span><br><span class="line">3218</span><br><span class="line">3219</span><br><span class="line">3220</span><br><span class="line">3221</span><br><span class="line">3222</span><br><span class="line">3223</span><br><span class="line">3224</span><br><span class="line">3225</span><br><span class="line">3226</span><br><span class="line">3227</span><br><span class="line">3228</span><br><span class="line">3229</span><br><span class="line">3230</span><br><span class="line">3231</span><br><span class="line">3232</span><br><span class="line">3233</span><br><span class="line">3234</span><br><span class="line">3235</span><br><span class="line">3236</span><br><span class="line">3237</span><br><span class="line">3238</span><br><span class="line">3239</span><br><span class="line">3240</span><br><span class="line">3241</span><br><span class="line">3242</span><br><span class="line">3243</span><br><span class="line">3244</span><br><span class="line">3245</span><br><span class="line">3246</span><br><span class="line">3247</span><br><span class="line">3248</span><br><span class="line">3249</span><br><span class="line">3250</span><br><span class="line">3251</span><br><span class="line">3252</span><br><span class="line">3253</span><br><span class="line">3254</span><br><span class="line">3255</span><br><span class="line">3256</span><br><span class="line">3257</span><br><span class="line">3258</span><br><span class="line">3259</span><br><span class="line">3260</span><br><span class="line">3261</span><br><span class="line">3262</span><br><span class="line">3263</span><br><span class="line">3264</span><br><span class="line">3265</span><br><span class="line">3266</span><br><span class="line">3267</span><br><span class="line">3268</span><br><span class="line">3269</span><br><span class="line">3270</span><br><span class="line">3271</span><br><span class="line">3272</span><br><span class="line">3273</span><br><span class="line">3274</span><br><span class="line">3275</span><br><span class="line">3276</span><br><span class="line">3277</span><br><span class="line">3278</span><br><span class="line">3279</span><br><span class="line">3280</span><br></pre></td><td class="code"><pre><span class="line">数据如下 ： </span><br><span class="line"><span class="comment">-----------------------------------------dept</span></span><br><span class="line">&#123;</span><br><span class="line">&quot;dept&quot;: [</span><br><span class="line">&#123;</span><br><span class="line">&quot;deptno&quot; : <span class="number">10</span>,</span><br><span class="line">&quot;dname&quot; : &quot;ACCOUNTING&quot;,</span><br><span class="line">&quot;loc&quot; : &quot;NEW YORK&quot;</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span>,</span><br><span class="line">&quot;dname&quot; : &quot;RESEARCH&quot;,</span><br><span class="line">&quot;loc&quot; : &quot;DALLAS&quot;</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;deptno&quot; : <span class="number">30</span>,</span><br><span class="line">&quot;dname&quot; : &quot;SALES&quot;,</span><br><span class="line">&quot;loc&quot; : &quot;CHICAGO&quot;</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;deptno&quot; : <span class="number">40</span>,</span><br><span class="line">&quot;dname&quot; : &quot;OPERATIONS&quot;,</span><br><span class="line">&quot;loc&quot; : &quot;BOSTON&quot;</span><br><span class="line">&#125;</span><br><span class="line">]&#125;</span><br><span class="line"><span class="comment">-----------------------------------------emp</span></span><br><span class="line">&#123;</span><br><span class="line">&quot;emp&quot;: [</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7369</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SMITH&quot;,</span><br><span class="line">&quot;job&quot; : &quot;CLERK&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7902</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1980-12-17T06:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">800.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7499</span>,</span><br><span class="line">&quot;ename&quot; : &quot;ALLEN&quot;,</span><br><span class="line">&quot;job&quot; : &quot;SALESMAN&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7698</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-02-20T06:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">1600.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="number">300.00</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">30</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7521</span>,</span><br><span class="line">&quot;ename&quot; : &quot;WARD&quot;,</span><br><span class="line">&quot;job&quot; : &quot;SALESMAN&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7698</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-02-22T06:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">1250.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="number">500.00</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">30</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;ename&quot; : &quot;JONES&quot;,</span><br><span class="line">&quot;job&quot; : &quot;MANAGER&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7839</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-04-02T06:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">2975.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7654</span>,</span><br><span class="line">&quot;ename&quot; : &quot;MARTIN&quot;,</span><br><span class="line">&quot;job&quot; : &quot;SALESMAN&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7698</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-09-28T05:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">1250.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="number">1400.00</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">30</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7698</span>,</span><br><span class="line">&quot;ename&quot; : &quot;BLAKE&quot;,</span><br><span class="line">&quot;job&quot; : &quot;MANAGER&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7839</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-05-01T05:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">2850.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">30</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7782</span>,</span><br><span class="line">&quot;ename&quot; : &quot;CLARK&quot;,</span><br><span class="line">&quot;job&quot; : &quot;MANAGER&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7839</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-06-09T05:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">2450.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">10</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T06:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7839</span>,</span><br><span class="line">&quot;ename&quot; : &quot;KING&quot;,</span><br><span class="line">&quot;job&quot; : &quot;PRESIDENT&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-11-17T06:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">5000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">10</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7844</span>,</span><br><span class="line">&quot;ename&quot; : &quot;TURNER&quot;,</span><br><span class="line">&quot;job&quot; : &quot;SALESMAN&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7698</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-09-08T05:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">1500.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="number">0.00</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">30</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7876</span>,</span><br><span class="line">&quot;ename&quot; : &quot;ADAMS&quot;,</span><br><span class="line">&quot;job&quot; : &quot;CLERK&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1983-01-12T06:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">1100.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7900</span>,</span><br><span class="line">&quot;ename&quot; : &quot;lebulang&quot;,</span><br><span class="line">&quot;job&quot; : &quot;CLERK&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7698</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-12-03T06:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">950.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">30</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7902</span>,</span><br><span class="line">&quot;ename&quot; : &quot;FORD&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-12-03T06:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7934</span>,</span><br><span class="line">&quot;ename&quot; : &quot;MILLER&quot;,</span><br><span class="line">&quot;job&quot; : &quot;CLERK&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7782</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-01-23T06:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">1300.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">10</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7839</span>,</span><br><span class="line">&quot;ename&quot; : &quot;KING&quot;,</span><br><span class="line">&quot;job&quot; : &quot;PRESIDENT&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-11-17T06:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">5000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">10</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7654</span>,</span><br><span class="line">&quot;ename&quot; : &quot;MARTIN&quot;,</span><br><span class="line">&quot;job&quot; : &quot;SALESMAN&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7698</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-09-28T05:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3200.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="number">1400.00</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">30</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T06:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T06:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T06:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T06:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T06:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T06:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T06:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T06:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T06:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T06:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T06:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7839</span>,</span><br><span class="line">&quot;ename&quot; : &quot;KING&quot;,</span><br><span class="line">&quot;job&quot; : &quot;PRESIDENT&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-11-17T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">5000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">10</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7654</span>,</span><br><span class="line">&quot;ename&quot; : &quot;MARTIN&quot;,</span><br><span class="line">&quot;job&quot; : &quot;SALESMAN&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7698</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-09-28T18:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3200.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="number">1400.00</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">30</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7839</span>,</span><br><span class="line">&quot;ename&quot; : &quot;KING&quot;,</span><br><span class="line">&quot;job&quot; : &quot;PRESIDENT&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-11-17T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">5000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">10</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7654</span>,</span><br><span class="line">&quot;ename&quot; : &quot;MARTIN&quot;,</span><br><span class="line">&quot;job&quot; : &quot;SALESMAN&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7698</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-09-28T18:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3200.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="number">1400.00</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">30</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7369</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SMITH&quot;,</span><br><span class="line">&quot;job&quot; : &quot;CLERK&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7902</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1980-12-17T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">800.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7499</span>,</span><br><span class="line">&quot;ename&quot; : &quot;ALLEN&quot;,</span><br><span class="line">&quot;job&quot; : &quot;SALESMAN&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7698</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-02-20T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">1600.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="number">300.00</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">30</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7521</span>,</span><br><span class="line">&quot;ename&quot; : &quot;WARD&quot;,</span><br><span class="line">&quot;job&quot; : &quot;SALESMAN&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7698</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-02-22T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">1250.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="number">500.00</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">30</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;ename&quot; : &quot;JONES&quot;,</span><br><span class="line">&quot;job&quot; : &quot;MANAGER&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7839</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-04-02T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">2975.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7654</span>,</span><br><span class="line">&quot;ename&quot; : &quot;MARTIN&quot;,</span><br><span class="line">&quot;job&quot; : &quot;SALESMAN&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7698</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-09-28T18:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">1250.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="number">1400.00</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">30</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7698</span>,</span><br><span class="line">&quot;ename&quot; : &quot;BLAKE&quot;,</span><br><span class="line">&quot;job&quot; : &quot;MANAGER&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7839</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-05-01T18:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">2850.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">30</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7782</span>,</span><br><span class="line">&quot;ename&quot; : &quot;CLARK&quot;,</span><br><span class="line">&quot;job&quot; : &quot;MANAGER&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7839</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-06-09T18:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">2450.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">10</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7839</span>,</span><br><span class="line">&quot;ename&quot; : &quot;KING&quot;,</span><br><span class="line">&quot;job&quot; : &quot;PRESIDENT&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-11-17T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">5000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">10</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7844</span>,</span><br><span class="line">&quot;ename&quot; : &quot;TURNER&quot;,</span><br><span class="line">&quot;job&quot; : &quot;SALESMAN&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7698</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-09-08T18:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">1500.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="number">0.00</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">30</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7876</span>,</span><br><span class="line">&quot;ename&quot; : &quot;ADAMS&quot;,</span><br><span class="line">&quot;job&quot; : &quot;CLERK&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1983-01-12T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">1100.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7900</span>,</span><br><span class="line">&quot;ename&quot; : &quot;lebulang&quot;,</span><br><span class="line">&quot;job&quot; : &quot;CLERK&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7698</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-12-03T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">950.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">30</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7902</span>,</span><br><span class="line">&quot;ename&quot; : &quot;FORD&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-12-03T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7934</span>,</span><br><span class="line">&quot;ename&quot; : &quot;MILLER&quot;,</span><br><span class="line">&quot;job&quot; : &quot;CLERK&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7782</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-01-23T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">1300.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">10</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7369</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SMITH&quot;,</span><br><span class="line">&quot;job&quot; : &quot;CLERK&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7902</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1980-12-17T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">800.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7499</span>,</span><br><span class="line">&quot;ename&quot; : &quot;ALLEN&quot;,</span><br><span class="line">&quot;job&quot; : &quot;SALESMAN&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7698</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-02-20T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">1600.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="number">300.00</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">30</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7521</span>,</span><br><span class="line">&quot;ename&quot; : &quot;WARD&quot;,</span><br><span class="line">&quot;job&quot; : &quot;SALESMAN&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7698</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-02-22T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">1250.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="number">500.00</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">30</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;ename&quot; : &quot;JONES&quot;,</span><br><span class="line">&quot;job&quot; : &quot;MANAGER&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7839</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-04-02T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">2975.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7654</span>,</span><br><span class="line">&quot;ename&quot; : &quot;MARTIN&quot;,</span><br><span class="line">&quot;job&quot; : &quot;SALESMAN&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7698</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-09-28T18:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">1250.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="number">1400.00</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">30</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7698</span>,</span><br><span class="line">&quot;ename&quot; : &quot;BLAKE&quot;,</span><br><span class="line">&quot;job&quot; : &quot;MANAGER&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7839</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-05-01T18:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">2850.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">30</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7782</span>,</span><br><span class="line">&quot;ename&quot; : &quot;CLARK&quot;,</span><br><span class="line">&quot;job&quot; : &quot;MANAGER&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7839</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-06-09T18:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">2450.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">10</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7839</span>,</span><br><span class="line">&quot;ename&quot; : &quot;KING&quot;,</span><br><span class="line">&quot;job&quot; : &quot;PRESIDENT&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-11-17T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">5000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">10</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7844</span>,</span><br><span class="line">&quot;ename&quot; : &quot;TURNER&quot;,</span><br><span class="line">&quot;job&quot; : &quot;SALESMAN&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7698</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-09-08T18:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">1500.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="number">0.00</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">30</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7876</span>,</span><br><span class="line">&quot;ename&quot; : &quot;ADAMS&quot;,</span><br><span class="line">&quot;job&quot; : &quot;CLERK&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1983-01-12T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">1100.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7900</span>,</span><br><span class="line">&quot;ename&quot; : &quot;lebulang&quot;,</span><br><span class="line">&quot;job&quot; : &quot;CLERK&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7698</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-12-03T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">950.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">30</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7902</span>,</span><br><span class="line">&quot;ename&quot; : &quot;FORD&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-12-03T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7934</span>,</span><br><span class="line">&quot;ename&quot; : &quot;MILLER&quot;,</span><br><span class="line">&quot;job&quot; : &quot;CLERK&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7782</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-01-23T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">1300.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">10</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7369</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SMITH&quot;,</span><br><span class="line">&quot;job&quot; : &quot;CLERK&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7902</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1980-12-17T06:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">800.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7499</span>,</span><br><span class="line">&quot;ename&quot; : &quot;ALLEN&quot;,</span><br><span class="line">&quot;job&quot; : &quot;SALESMAN&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7698</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-02-20T06:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">1600.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="number">300.00</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">30</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7521</span>,</span><br><span class="line">&quot;ename&quot; : &quot;WARD&quot;,</span><br><span class="line">&quot;job&quot; : &quot;SALESMAN&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7698</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-02-22T06:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">1250.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="number">500.00</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">30</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;ename&quot; : &quot;JONES&quot;,</span><br><span class="line">&quot;job&quot; : &quot;MANAGER&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7839</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-04-02T06:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">2975.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7654</span>,</span><br><span class="line">&quot;ename&quot; : &quot;MARTIN&quot;,</span><br><span class="line">&quot;job&quot; : &quot;SALESMAN&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7698</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-09-28T05:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">1250.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="number">1400.00</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">30</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7698</span>,</span><br><span class="line">&quot;ename&quot; : &quot;BLAKE&quot;,</span><br><span class="line">&quot;job&quot; : &quot;MANAGER&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7839</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-05-01T05:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">2850.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">30</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7782</span>,</span><br><span class="line">&quot;ename&quot; : &quot;CLARK&quot;,</span><br><span class="line">&quot;job&quot; : &quot;MANAGER&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7839</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-06-09T05:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">2450.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">10</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T06:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7839</span>,</span><br><span class="line">&quot;ename&quot; : &quot;KING&quot;,</span><br><span class="line">&quot;job&quot; : &quot;PRESIDENT&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-11-17T06:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">5000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">10</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7844</span>,</span><br><span class="line">&quot;ename&quot; : &quot;TURNER&quot;,</span><br><span class="line">&quot;job&quot; : &quot;SALESMAN&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7698</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-09-08T05:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">1500.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="number">0.00</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">30</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7876</span>,</span><br><span class="line">&quot;ename&quot; : &quot;ADAMS&quot;,</span><br><span class="line">&quot;job&quot; : &quot;CLERK&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1983-01-12T06:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">1100.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7900</span>,</span><br><span class="line">&quot;ename&quot; : &quot;lebulang&quot;,</span><br><span class="line">&quot;job&quot; : &quot;CLERK&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7698</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-12-03T06:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">950.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">30</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7902</span>,</span><br><span class="line">&quot;ename&quot; : &quot;FORD&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-12-03T06:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7934</span>,</span><br><span class="line">&quot;ename&quot; : &quot;MILLER&quot;,</span><br><span class="line">&quot;job&quot; : &quot;CLERK&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7782</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-01-23T06:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">1300.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">10</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7839</span>,</span><br><span class="line">&quot;ename&quot; : &quot;KING&quot;,</span><br><span class="line">&quot;job&quot; : &quot;PRESIDENT&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-11-17T06:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">5000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">10</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7654</span>,</span><br><span class="line">&quot;ename&quot; : &quot;MARTIN&quot;,</span><br><span class="line">&quot;job&quot; : &quot;SALESMAN&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7698</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-09-28T05:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3200.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="number">1400.00</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">30</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T06:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T06:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T06:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T06:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T06:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T06:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T06:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T06:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T06:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T06:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T06:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7839</span>,</span><br><span class="line">&quot;ename&quot; : &quot;KING&quot;,</span><br><span class="line">&quot;job&quot; : &quot;PRESIDENT&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-11-17T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">5000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">10</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7654</span>,</span><br><span class="line">&quot;ename&quot; : &quot;MARTIN&quot;,</span><br><span class="line">&quot;job&quot; : &quot;SALESMAN&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7698</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-09-28T18:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3200.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="number">1400.00</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">30</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7839</span>,</span><br><span class="line">&quot;ename&quot; : &quot;KING&quot;,</span><br><span class="line">&quot;job&quot; : &quot;PRESIDENT&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-11-17T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">5000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">10</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7654</span>,</span><br><span class="line">&quot;ename&quot; : &quot;MARTIN&quot;,</span><br><span class="line">&quot;job&quot; : &quot;SALESMAN&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7698</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-09-28T18:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3200.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="number">1400.00</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">30</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7369</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SMITH&quot;,</span><br><span class="line">&quot;job&quot; : &quot;CLERK&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7902</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1980-12-17T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">800.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7499</span>,</span><br><span class="line">&quot;ename&quot; : &quot;ALLEN&quot;,</span><br><span class="line">&quot;job&quot; : &quot;SALESMAN&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7698</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-02-20T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">1600.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="number">300.00</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">30</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7521</span>,</span><br><span class="line">&quot;ename&quot; : &quot;WARD&quot;,</span><br><span class="line">&quot;job&quot; : &quot;SALESMAN&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7698</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-02-22T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">1250.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="number">500.00</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">30</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;ename&quot; : &quot;JONES&quot;,</span><br><span class="line">&quot;job&quot; : &quot;MANAGER&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7839</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-04-02T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">2975.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7654</span>,</span><br><span class="line">&quot;ename&quot; : &quot;MARTIN&quot;,</span><br><span class="line">&quot;job&quot; : &quot;SALESMAN&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7698</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-09-28T18:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">1250.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="number">1400.00</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">30</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7698</span>,</span><br><span class="line">&quot;ename&quot; : &quot;BLAKE&quot;,</span><br><span class="line">&quot;job&quot; : &quot;MANAGER&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7839</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-05-01T18:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">2850.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">30</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7782</span>,</span><br><span class="line">&quot;ename&quot; : &quot;CLARK&quot;,</span><br><span class="line">&quot;job&quot; : &quot;MANAGER&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7839</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-06-09T18:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">2450.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">10</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7839</span>,</span><br><span class="line">&quot;ename&quot; : &quot;KING&quot;,</span><br><span class="line">&quot;job&quot; : &quot;PRESIDENT&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-11-17T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">5000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">10</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7844</span>,</span><br><span class="line">&quot;ename&quot; : &quot;TURNER&quot;,</span><br><span class="line">&quot;job&quot; : &quot;SALESMAN&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7698</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-09-08T18:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">1500.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="number">0.00</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">30</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7876</span>,</span><br><span class="line">&quot;ename&quot; : &quot;ADAMS&quot;,</span><br><span class="line">&quot;job&quot; : &quot;CLERK&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1983-01-12T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">1100.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7900</span>,</span><br><span class="line">&quot;ename&quot; : &quot;lebulang&quot;,</span><br><span class="line">&quot;job&quot; : &quot;CLERK&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7698</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-12-03T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">950.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">30</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7902</span>,</span><br><span class="line">&quot;ename&quot; : &quot;FORD&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-12-03T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7934</span>,</span><br><span class="line">&quot;ename&quot; : &quot;MILLER&quot;,</span><br><span class="line">&quot;job&quot; : &quot;CLERK&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7782</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-01-23T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">1300.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">10</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7369</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SMITH&quot;,</span><br><span class="line">&quot;job&quot; : &quot;CLERK&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7902</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1980-12-17T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">800.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7499</span>,</span><br><span class="line">&quot;ename&quot; : &quot;ALLEN&quot;,</span><br><span class="line">&quot;job&quot; : &quot;SALESMAN&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7698</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-02-20T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">1600.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="number">300.00</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">30</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7521</span>,</span><br><span class="line">&quot;ename&quot; : &quot;WARD&quot;,</span><br><span class="line">&quot;job&quot; : &quot;SALESMAN&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7698</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-02-22T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">1250.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="number">500.00</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">30</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;ename&quot; : &quot;JONES&quot;,</span><br><span class="line">&quot;job&quot; : &quot;MANAGER&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7839</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-04-02T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">2975.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7654</span>,</span><br><span class="line">&quot;ename&quot; : &quot;MARTIN&quot;,</span><br><span class="line">&quot;job&quot; : &quot;SALESMAN&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7698</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-09-28T18:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">1250.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="number">1400.00</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">30</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7698</span>,</span><br><span class="line">&quot;ename&quot; : &quot;BLAKE&quot;,</span><br><span class="line">&quot;job&quot; : &quot;MANAGER&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7839</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-05-01T18:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">2850.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">30</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7782</span>,</span><br><span class="line">&quot;ename&quot; : &quot;CLARK&quot;,</span><br><span class="line">&quot;job&quot; : &quot;MANAGER&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7839</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-06-09T18:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">2450.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">10</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7839</span>,</span><br><span class="line">&quot;ename&quot; : &quot;KING&quot;,</span><br><span class="line">&quot;job&quot; : &quot;PRESIDENT&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-11-17T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">5000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">10</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7844</span>,</span><br><span class="line">&quot;ename&quot; : &quot;TURNER&quot;,</span><br><span class="line">&quot;job&quot; : &quot;SALESMAN&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7698</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-09-08T18:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">1500.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="number">0.00</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">30</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7876</span>,</span><br><span class="line">&quot;ename&quot; : &quot;ADAMS&quot;,</span><br><span class="line">&quot;job&quot; : &quot;CLERK&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1983-01-12T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">1100.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7900</span>,</span><br><span class="line">&quot;ename&quot; : &quot;lebulang&quot;,</span><br><span class="line">&quot;job&quot; : &quot;CLERK&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7698</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-12-03T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">950.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">30</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7902</span>,</span><br><span class="line">&quot;ename&quot; : &quot;FORD&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-12-03T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7934</span>,</span><br><span class="line">&quot;ename&quot; : &quot;MILLER&quot;,</span><br><span class="line">&quot;job&quot; : &quot;CLERK&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7782</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-01-23T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">1300.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">10</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7369</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SMITH&quot;,</span><br><span class="line">&quot;job&quot; : &quot;CLERK&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7902</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1980-12-17T06:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">800.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7499</span>,</span><br><span class="line">&quot;ename&quot; : &quot;ALLEN&quot;,</span><br><span class="line">&quot;job&quot; : &quot;SALESMAN&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7698</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-02-20T06:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">1600.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="number">300.00</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">30</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7521</span>,</span><br><span class="line">&quot;ename&quot; : &quot;WARD&quot;,</span><br><span class="line">&quot;job&quot; : &quot;SALESMAN&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7698</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-02-22T06:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">1250.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="number">500.00</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">30</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;ename&quot; : &quot;JONES&quot;,</span><br><span class="line">&quot;job&quot; : &quot;MANAGER&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7839</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-04-02T06:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">2975.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7654</span>,</span><br><span class="line">&quot;ename&quot; : &quot;MARTIN&quot;,</span><br><span class="line">&quot;job&quot; : &quot;SALESMAN&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7698</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-09-28T05:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">1250.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="number">1400.00</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">30</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7698</span>,</span><br><span class="line">&quot;ename&quot; : &quot;BLAKE&quot;,</span><br><span class="line">&quot;job&quot; : &quot;MANAGER&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7839</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-05-01T05:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">2850.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">30</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7782</span>,</span><br><span class="line">&quot;ename&quot; : &quot;CLARK&quot;,</span><br><span class="line">&quot;job&quot; : &quot;MANAGER&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7839</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-06-09T05:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">2450.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">10</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T06:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7839</span>,</span><br><span class="line">&quot;ename&quot; : &quot;KING&quot;,</span><br><span class="line">&quot;job&quot; : &quot;PRESIDENT&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-11-17T06:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">5000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">10</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7844</span>,</span><br><span class="line">&quot;ename&quot; : &quot;TURNER&quot;,</span><br><span class="line">&quot;job&quot; : &quot;SALESMAN&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7698</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-09-08T05:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">1500.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="number">0.00</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">30</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7876</span>,</span><br><span class="line">&quot;ename&quot; : &quot;ADAMS&quot;,</span><br><span class="line">&quot;job&quot; : &quot;CLERK&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1983-01-12T06:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">1100.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7900</span>,</span><br><span class="line">&quot;ename&quot; : &quot;lebulang&quot;,</span><br><span class="line">&quot;job&quot; : &quot;CLERK&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7698</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-12-03T06:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">950.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">30</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7902</span>,</span><br><span class="line">&quot;ename&quot; : &quot;FORD&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-12-03T06:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7934</span>,</span><br><span class="line">&quot;ename&quot; : &quot;MILLER&quot;,</span><br><span class="line">&quot;job&quot; : &quot;CLERK&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7782</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-01-23T06:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">1300.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">10</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7839</span>,</span><br><span class="line">&quot;ename&quot; : &quot;KING&quot;,</span><br><span class="line">&quot;job&quot; : &quot;PRESIDENT&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-11-17T06:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">5000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">10</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7654</span>,</span><br><span class="line">&quot;ename&quot; : &quot;MARTIN&quot;,</span><br><span class="line">&quot;job&quot; : &quot;SALESMAN&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7698</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-09-28T05:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3200.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="number">1400.00</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">30</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T06:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T06:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T06:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T06:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T06:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T06:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T06:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T06:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T06:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T06:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T06:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7839</span>,</span><br><span class="line">&quot;ename&quot; : &quot;KING&quot;,</span><br><span class="line">&quot;job&quot; : &quot;PRESIDENT&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-11-17T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">5000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">10</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7654</span>,</span><br><span class="line">&quot;ename&quot; : &quot;MARTIN&quot;,</span><br><span class="line">&quot;job&quot; : &quot;SALESMAN&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7698</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-09-28T18:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3200.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="number">1400.00</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">30</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7839</span>,</span><br><span class="line">&quot;ename&quot; : &quot;KING&quot;,</span><br><span class="line">&quot;job&quot; : &quot;PRESIDENT&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-11-17T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">5000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">10</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7654</span>,</span><br><span class="line">&quot;ename&quot; : &quot;MARTIN&quot;,</span><br><span class="line">&quot;job&quot; : &quot;SALESMAN&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7698</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-09-28T18:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3200.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="number">1400.00</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">30</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7369</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SMITH&quot;,</span><br><span class="line">&quot;job&quot; : &quot;CLERK&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7902</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1980-12-17T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">800.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7499</span>,</span><br><span class="line">&quot;ename&quot; : &quot;ALLEN&quot;,</span><br><span class="line">&quot;job&quot; : &quot;SALESMAN&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7698</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-02-20T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">1600.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="number">300.00</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">30</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7521</span>,</span><br><span class="line">&quot;ename&quot; : &quot;WARD&quot;,</span><br><span class="line">&quot;job&quot; : &quot;SALESMAN&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7698</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-02-22T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">1250.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="number">500.00</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">30</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;ename&quot; : &quot;JONES&quot;,</span><br><span class="line">&quot;job&quot; : &quot;MANAGER&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7839</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-04-02T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">2975.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7654</span>,</span><br><span class="line">&quot;ename&quot; : &quot;MARTIN&quot;,</span><br><span class="line">&quot;job&quot; : &quot;SALESMAN&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7698</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-09-28T18:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">1250.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="number">1400.00</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">30</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7698</span>,</span><br><span class="line">&quot;ename&quot; : &quot;BLAKE&quot;,</span><br><span class="line">&quot;job&quot; : &quot;MANAGER&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7839</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-05-01T18:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">2850.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">30</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7782</span>,</span><br><span class="line">&quot;ename&quot; : &quot;CLARK&quot;,</span><br><span class="line">&quot;job&quot; : &quot;MANAGER&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7839</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-06-09T18:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">2450.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">10</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7839</span>,</span><br><span class="line">&quot;ename&quot; : &quot;KING&quot;,</span><br><span class="line">&quot;job&quot; : &quot;PRESIDENT&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-11-17T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">5000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">10</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7844</span>,</span><br><span class="line">&quot;ename&quot; : &quot;TURNER&quot;,</span><br><span class="line">&quot;job&quot; : &quot;SALESMAN&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7698</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-09-08T18:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">1500.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="number">0.00</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">30</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7876</span>,</span><br><span class="line">&quot;ename&quot; : &quot;ADAMS&quot;,</span><br><span class="line">&quot;job&quot; : &quot;CLERK&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1983-01-12T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">1100.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7900</span>,</span><br><span class="line">&quot;ename&quot; : &quot;lebulang&quot;,</span><br><span class="line">&quot;job&quot; : &quot;CLERK&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7698</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-12-03T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">950.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">30</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7902</span>,</span><br><span class="line">&quot;ename&quot; : &quot;FORD&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-12-03T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7934</span>,</span><br><span class="line">&quot;ename&quot; : &quot;MILLER&quot;,</span><br><span class="line">&quot;job&quot; : &quot;CLERK&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7782</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-01-23T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">1300.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">10</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7369</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SMITH&quot;,</span><br><span class="line">&quot;job&quot; : &quot;CLERK&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7902</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1980-12-17T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">800.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7499</span>,</span><br><span class="line">&quot;ename&quot; : &quot;ALLEN&quot;,</span><br><span class="line">&quot;job&quot; : &quot;SALESMAN&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7698</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-02-20T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">1600.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="number">300.00</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">30</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7521</span>,</span><br><span class="line">&quot;ename&quot; : &quot;WARD&quot;,</span><br><span class="line">&quot;job&quot; : &quot;SALESMAN&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7698</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-02-22T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">1250.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="number">500.00</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">30</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;ename&quot; : &quot;JONES&quot;,</span><br><span class="line">&quot;job&quot; : &quot;MANAGER&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7839</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-04-02T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">2975.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7654</span>,</span><br><span class="line">&quot;ename&quot; : &quot;MARTIN&quot;,</span><br><span class="line">&quot;job&quot; : &quot;SALESMAN&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7698</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-09-28T18:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">1250.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="number">1400.00</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">30</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7698</span>,</span><br><span class="line">&quot;ename&quot; : &quot;BLAKE&quot;,</span><br><span class="line">&quot;job&quot; : &quot;MANAGER&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7839</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-05-01T18:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">2850.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">30</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7782</span>,</span><br><span class="line">&quot;ename&quot; : &quot;CLARK&quot;,</span><br><span class="line">&quot;job&quot; : &quot;MANAGER&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7839</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-06-09T18:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">2450.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">10</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7839</span>,</span><br><span class="line">&quot;ename&quot; : &quot;KING&quot;,</span><br><span class="line">&quot;job&quot; : &quot;PRESIDENT&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-11-17T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">5000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">10</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7844</span>,</span><br><span class="line">&quot;ename&quot; : &quot;TURNER&quot;,</span><br><span class="line">&quot;job&quot; : &quot;SALESMAN&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7698</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-09-08T18:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">1500.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="number">0.00</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">30</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7876</span>,</span><br><span class="line">&quot;ename&quot; : &quot;ADAMS&quot;,</span><br><span class="line">&quot;job&quot; : &quot;CLERK&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1983-01-12T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">1100.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7900</span>,</span><br><span class="line">&quot;ename&quot; : &quot;lebulang&quot;,</span><br><span class="line">&quot;job&quot; : &quot;CLERK&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7698</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-12-03T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">950.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">30</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7902</span>,</span><br><span class="line">&quot;ename&quot; : &quot;FORD&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-12-03T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7934</span>,</span><br><span class="line">&quot;ename&quot; : &quot;MILLER&quot;,</span><br><span class="line">&quot;job&quot; : &quot;CLERK&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7782</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-01-23T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">1300.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">10</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7369</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SMITH&quot;,</span><br><span class="line">&quot;job&quot; : &quot;CLERK&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7902</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1980-12-17T06:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">800.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7499</span>,</span><br><span class="line">&quot;ename&quot; : &quot;ALLEN&quot;,</span><br><span class="line">&quot;job&quot; : &quot;SALESMAN&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7698</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-02-20T06:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">1600.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="number">300.00</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">30</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7521</span>,</span><br><span class="line">&quot;ename&quot; : &quot;WARD&quot;,</span><br><span class="line">&quot;job&quot; : &quot;SALESMAN&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7698</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-02-22T06:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">1250.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="number">500.00</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">30</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;ename&quot; : &quot;JONES&quot;,</span><br><span class="line">&quot;job&quot; : &quot;MANAGER&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7839</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-04-02T06:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">2975.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7654</span>,</span><br><span class="line">&quot;ename&quot; : &quot;MARTIN&quot;,</span><br><span class="line">&quot;job&quot; : &quot;SALESMAN&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7698</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-09-28T05:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">1250.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="number">1400.00</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">30</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7698</span>,</span><br><span class="line">&quot;ename&quot; : &quot;BLAKE&quot;,</span><br><span class="line">&quot;job&quot; : &quot;MANAGER&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7839</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-05-01T05:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">2850.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">30</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7782</span>,</span><br><span class="line">&quot;ename&quot; : &quot;CLARK&quot;,</span><br><span class="line">&quot;job&quot; : &quot;MANAGER&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7839</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-06-09T05:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">2450.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">10</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T06:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7839</span>,</span><br><span class="line">&quot;ename&quot; : &quot;KING&quot;,</span><br><span class="line">&quot;job&quot; : &quot;PRESIDENT&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-11-17T06:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">5000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">10</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7844</span>,</span><br><span class="line">&quot;ename&quot; : &quot;TURNER&quot;,</span><br><span class="line">&quot;job&quot; : &quot;SALESMAN&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7698</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-09-08T05:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">1500.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="number">0.00</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">30</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7876</span>,</span><br><span class="line">&quot;ename&quot; : &quot;ADAMS&quot;,</span><br><span class="line">&quot;job&quot; : &quot;CLERK&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1983-01-12T06:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">1100.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7900</span>,</span><br><span class="line">&quot;ename&quot; : &quot;lebulang&quot;,</span><br><span class="line">&quot;job&quot; : &quot;CLERK&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7698</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-12-03T06:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">950.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">30</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7902</span>,</span><br><span class="line">&quot;ename&quot; : &quot;FORD&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-12-03T06:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7934</span>,</span><br><span class="line">&quot;ename&quot; : &quot;MILLER&quot;,</span><br><span class="line">&quot;job&quot; : &quot;CLERK&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7782</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-01-23T06:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">1300.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">10</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7839</span>,</span><br><span class="line">&quot;ename&quot; : &quot;KING&quot;,</span><br><span class="line">&quot;job&quot; : &quot;PRESIDENT&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-11-17T06:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">5000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">10</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7654</span>,</span><br><span class="line">&quot;ename&quot; : &quot;MARTIN&quot;,</span><br><span class="line">&quot;job&quot; : &quot;SALESMAN&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7698</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-09-28T05:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3200.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="number">1400.00</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">30</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T06:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T06:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T06:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T06:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T06:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T06:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T06:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T06:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T06:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T06:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T06:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7839</span>,</span><br><span class="line">&quot;ename&quot; : &quot;KING&quot;,</span><br><span class="line">&quot;job&quot; : &quot;PRESIDENT&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-11-17T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">5000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">10</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7654</span>,</span><br><span class="line">&quot;ename&quot; : &quot;MARTIN&quot;,</span><br><span class="line">&quot;job&quot; : &quot;SALESMAN&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7698</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-09-28T18:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3200.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="number">1400.00</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">30</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7839</span>,</span><br><span class="line">&quot;ename&quot; : &quot;KING&quot;,</span><br><span class="line">&quot;job&quot; : &quot;PRESIDENT&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-11-17T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">5000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">10</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7654</span>,</span><br><span class="line">&quot;ename&quot; : &quot;MARTIN&quot;,</span><br><span class="line">&quot;job&quot; : &quot;SALESMAN&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7698</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-09-28T18:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3200.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="number">1400.00</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">30</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7369</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SMITH&quot;,</span><br><span class="line">&quot;job&quot; : &quot;CLERK&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7902</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1980-12-17T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">800.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7499</span>,</span><br><span class="line">&quot;ename&quot; : &quot;ALLEN&quot;,</span><br><span class="line">&quot;job&quot; : &quot;SALESMAN&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7698</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-02-20T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">1600.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="number">300.00</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">30</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7521</span>,</span><br><span class="line">&quot;ename&quot; : &quot;WARD&quot;,</span><br><span class="line">&quot;job&quot; : &quot;SALESMAN&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7698</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-02-22T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">1250.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="number">500.00</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">30</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;ename&quot; : &quot;JONES&quot;,</span><br><span class="line">&quot;job&quot; : &quot;MANAGER&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7839</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-04-02T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">2975.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7654</span>,</span><br><span class="line">&quot;ename&quot; : &quot;MARTIN&quot;,</span><br><span class="line">&quot;job&quot; : &quot;SALESMAN&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7698</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-09-28T18:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">1250.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="number">1400.00</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">30</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7698</span>,</span><br><span class="line">&quot;ename&quot; : &quot;BLAKE&quot;,</span><br><span class="line">&quot;job&quot; : &quot;MANAGER&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7839</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-05-01T18:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">2850.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">30</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7782</span>,</span><br><span class="line">&quot;ename&quot; : &quot;CLARK&quot;,</span><br><span class="line">&quot;job&quot; : &quot;MANAGER&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7839</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-06-09T18:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">2450.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">10</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7839</span>,</span><br><span class="line">&quot;ename&quot; : &quot;KING&quot;,</span><br><span class="line">&quot;job&quot; : &quot;PRESIDENT&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-11-17T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">5000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">10</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7844</span>,</span><br><span class="line">&quot;ename&quot; : &quot;TURNER&quot;,</span><br><span class="line">&quot;job&quot; : &quot;SALESMAN&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7698</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-09-08T18:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">1500.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="number">0.00</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">30</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7876</span>,</span><br><span class="line">&quot;ename&quot; : &quot;ADAMS&quot;,</span><br><span class="line">&quot;job&quot; : &quot;CLERK&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1983-01-12T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">1100.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7900</span>,</span><br><span class="line">&quot;ename&quot; : &quot;lebulang&quot;,</span><br><span class="line">&quot;job&quot; : &quot;CLERK&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7698</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-12-03T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">950.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">30</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7902</span>,</span><br><span class="line">&quot;ename&quot; : &quot;FORD&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-12-03T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7934</span>,</span><br><span class="line">&quot;ename&quot; : &quot;MILLER&quot;,</span><br><span class="line">&quot;job&quot; : &quot;CLERK&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7782</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-01-23T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">1300.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">10</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7369</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SMITH&quot;,</span><br><span class="line">&quot;job&quot; : &quot;CLERK&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7902</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1980-12-17T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">800.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7499</span>,</span><br><span class="line">&quot;ename&quot; : &quot;ALLEN&quot;,</span><br><span class="line">&quot;job&quot; : &quot;SALESMAN&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7698</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-02-20T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">1600.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="number">300.00</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">30</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7521</span>,</span><br><span class="line">&quot;ename&quot; : &quot;WARD&quot;,</span><br><span class="line">&quot;job&quot; : &quot;SALESMAN&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7698</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-02-22T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">1250.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="number">500.00</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">30</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;ename&quot; : &quot;JONES&quot;,</span><br><span class="line">&quot;job&quot; : &quot;MANAGER&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7839</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-04-02T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">2975.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7654</span>,</span><br><span class="line">&quot;ename&quot; : &quot;MARTIN&quot;,</span><br><span class="line">&quot;job&quot; : &quot;SALESMAN&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7698</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-09-28T18:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">1250.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="number">1400.00</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">30</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7698</span>,</span><br><span class="line">&quot;ename&quot; : &quot;BLAKE&quot;,</span><br><span class="line">&quot;job&quot; : &quot;MANAGER&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7839</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-05-01T18:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">2850.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">30</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7782</span>,</span><br><span class="line">&quot;ename&quot; : &quot;CLARK&quot;,</span><br><span class="line">&quot;job&quot; : &quot;MANAGER&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7839</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-06-09T18:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">2450.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">10</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;ename&quot; : &quot;SCOTT&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-12-09T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7839</span>,</span><br><span class="line">&quot;ename&quot; : &quot;KING&quot;,</span><br><span class="line">&quot;job&quot; : &quot;PRESIDENT&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-11-17T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">5000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">10</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7844</span>,</span><br><span class="line">&quot;ename&quot; : &quot;TURNER&quot;,</span><br><span class="line">&quot;job&quot; : &quot;SALESMAN&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7698</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-09-08T18:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">1500.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="number">0.00</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">30</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7876</span>,</span><br><span class="line">&quot;ename&quot; : &quot;ADAMS&quot;,</span><br><span class="line">&quot;job&quot; : &quot;CLERK&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7788</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1983-01-12T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">1100.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7900</span>,</span><br><span class="line">&quot;ename&quot; : &quot;lebulang&quot;,</span><br><span class="line">&quot;job&quot; : &quot;CLERK&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7698</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-12-03T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">950.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">30</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7902</span>,</span><br><span class="line">&quot;ename&quot; : &quot;FORD&quot;,</span><br><span class="line">&quot;job&quot; : &quot;ANALYST&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7566</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1981-12-03T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">3000.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">20</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;empno&quot; : <span class="number">7934</span>,</span><br><span class="line">&quot;ename&quot; : &quot;MILLER&quot;,</span><br><span class="line">&quot;job&quot; : &quot;CLERK&quot;,</span><br><span class="line">&quot;mgr&quot; : <span class="number">7782</span>,</span><br><span class="line">&quot;hiredate&quot; : &quot;1982-01-23T20:00:00Z&quot;,</span><br><span class="line">&quot;sal&quot; : <span class="number">1300.00</span>,</span><br><span class="line">&quot;comm&quot; : <span class="keyword">null</span>,</span><br><span class="line">&quot;deptno&quot; : <span class="number">10</span></span><br><span class="line">&#125;</span><br><span class="line">]&#125;</span><br><span class="line"><span class="comment">----------------------------------------------------------------------------问题</span></span><br><span class="line"><span class="number">1</span>，查询出部门编号为<span class="number">30</span>的所有员工的编号和姓名</span><br><span class="line"><span class="number">2.</span>找出部门编号为<span class="number">10</span>中所有经理，和部门编号为<span class="number">20</span>中所有销售员的详细资料。</span><br><span class="line"><span class="number">3.</span>查询所有员工详细信息，用工资降序排序，如果工资相同使用入职日期升序排序</span><br><span class="line"><span class="number">4.</span>列出薪金大于<span class="number">1500</span>的各种工作及从事此工作的员工人数。</span><br><span class="line"><span class="number">5.</span>列出在销售部工作的员工的姓名，假定不知道销售部的部门编号。</span><br><span class="line"><span class="number">6.</span>查询姓名以S开头的\以S结尾\包含S字符\第二个字母为L  __</span><br><span class="line"><span class="number">7.</span>查询每种工作的最高工资、最低工资、人数</span><br><span class="line"><span class="number">8.</span>列出薪金 高于 公司平均薪金的所有员工号，员工姓名，所在部门名称，上级领导，工资，工资等级</span><br><span class="line"><span class="number">9.</span>列出薪金  高于  在各自部门工作的员工的平均薪金的员工姓名和薪金、部门名称。</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="解决-："><a href="#解决-：" class="headerlink" title="解决 ："></a>解决 ：</h1><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br></pre></td><td class="code"><pre><span class="line">因为上述数据不符合spark的规定，所以我们要在vscode中把他转化</span><br><span class="line">转化完成之后</span><br><span class="line">-------------------------------------------------------</span><br><span class="line">查询出部门编号为<span class="number">30</span>的所有员工的编号和姓名</span><br><span class="line"> <span class="comment">//---------------------------api</span></span><br><span class="line">    val cluname = emp.columns.toList</span><br><span class="line">    cluname.foreach(println(_))</span><br><span class="line">    emp.select(<span class="string">&quot;deptno&quot;</span>,<span class="string">&quot;empno&quot;</span>,<span class="string">&quot;ename&quot;</span>).rdd.<span class="built_in">filter</span>(<span class="function"><span class="params">x</span>=&gt;</span>&#123;</span><br><span class="line">      x(<span class="number">0</span>)==<span class="number">30</span></span><br><span class="line">    &#125;).saveAsTextFile(<span class="string">&quot;hdfs://bigdata3:9000/spark/1&quot;</span>)</span><br><span class="line">    <span class="comment">//---------------------------sql</span></span><br><span class="line">    emp.createOrReplaceTempView(<span class="string">&quot;tableemp&quot;</span>)</span><br><span class="line">    spark.sql(<span class="string">&quot;select deptno,empno,ename from tableemp where deptno=30&quot;</span>).show()</span><br><span class="line"><span class="comment">//---------------------------------------------------------------2</span></span><br><span class="line"><span class="comment">//找出部门编号为10中所有经理，和部门编号为20中所有销售员的详细资料。</span></span><br><span class="line">    <span class="comment">//----------------------------api</span></span><br><span class="line">    emp.select(<span class="string">&quot;comm&quot;</span>,<span class="string">&quot;deptno&quot;</span>,<span class="string">&quot;empno&quot;</span>,<span class="string">&quot;ename&quot;</span>,<span class="string">&quot;hiredate&quot;</span>,<span class="string">&quot;job&quot;</span>,<span class="string">&quot;mgr&quot;</span>,<span class="string">&quot;sal&quot;</span>).rdd.<span class="built_in">filter</span>(<span class="function"><span class="params">x</span>=&gt;</span>&#123;</span><br><span class="line">      (x(<span class="number">1</span>)==<span class="number">10</span>&amp;&amp;x(<span class="number">5</span>)==<span class="string">&quot;MANAGER&quot;</span>)||(x(<span class="number">1</span>)==<span class="number">20</span>&amp;&amp;x(<span class="number">5</span>)==<span class="string">&quot;SALESMAN&quot;</span>)</span><br><span class="line">    &#125;).saveAsTextFile(<span class="string">&quot;hdfs://bigdata3:9000/spark/2&quot;</span>)</span><br><span class="line">    <span class="comment">//--------------------------sql</span></span><br><span class="line">    spark.sql(<span class="string">&quot;select * from tableemp where deptno=10 and job= &#x27;MANAGER&#x27; or deptno = 20 and job= &#x27;SALESMAN&#x27;&quot;</span>).show()</span><br><span class="line">/-------------------------------------------------------------<span class="number">-3</span></span><br><span class="line"><span class="comment">//查询所有员工详细信息，用工资降序排序，如果工资相同使用入职日期升序排序</span></span><br><span class="line">    <span class="comment">//----------------------api</span></span><br><span class="line">   emp.rdd.<span class="built_in">map</span>(<span class="function"><span class="params">x</span>=&gt;</span>&#123;</span><br><span class="line">     <span class="keyword">if</span> (x.isNullAt(<span class="number">0</span>))&#123;</span><br><span class="line">     <span class="keyword">var</span> total = x.getDouble(<span class="number">7</span>)</span><br><span class="line">       <span class="keyword">var</span> hire = x.getString(<span class="number">4</span>).<span class="built_in">split</span>(<span class="string">&quot;Z&quot;</span>)</span><br><span class="line">       <span class="keyword">var</span> reallyhire = hire(<span class="number">0</span>).<span class="built_in">split</span>(<span class="string">&quot;T&quot;</span>)</span><br><span class="line">       val <span class="built_in">date</span> = reallyhire(<span class="number">0</span>)+<span class="string">&quot; &quot;</span> +reallyhire(<span class="number">1</span>)</span><br><span class="line">       <span class="keyword">var</span> Data = <span class="keyword">new</span> SimpleDateFormat(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>).parse(<span class="built_in">date</span>)</span><br><span class="line">       (total,Data,x)</span><br><span class="line">     &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      <span class="keyword">var</span> total = x.getDouble(<span class="number">0</span>)+x.getDouble(<span class="number">7</span>)</span><br><span class="line">       <span class="keyword">var</span> hire = x.getString(<span class="number">4</span>).<span class="built_in">split</span>(<span class="string">&quot;Z&quot;</span>)</span><br><span class="line">       <span class="keyword">var</span> reallyhire = hire(<span class="number">0</span>).<span class="built_in">split</span>(<span class="string">&quot;T&quot;</span>)</span><br><span class="line">       val <span class="built_in">date</span> = reallyhire(<span class="number">0</span>)+<span class="string">&quot; &quot;</span> +reallyhire(<span class="number">1</span>)</span><br><span class="line">       <span class="keyword">var</span> Data = <span class="keyword">new</span> SimpleDateFormat(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>).parse(<span class="built_in">date</span>)</span><br><span class="line">       (total,Data,x)</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;).sortBy(<span class="function"><span class="params">x</span>=&gt;</span>(-x._1,x._2)).<span class="built_in">map</span>(<span class="function"><span class="params">x</span>=&gt;</span>&#123;x._3&#125;).saveAsTextFile(<span class="string">&quot;hdfs://bigdata3:9000/spark/3&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//------------------------------------sql</span></span><br><span class="line">    spark.sql(<span class="string">&quot;select * from (select (ifnull(comm,0)+sal) as total, hiredate,job,mgr,sal,empno,ename,deptno from tableemp ) order by total desc,hiredate asc&quot;</span>)</span><br><span class="line">------------------------------------------<span class="number">-4</span></span><br><span class="line"><span class="comment">//列出薪金大于1500的各种工作及从事此工作的员工人数。</span></span><br><span class="line">    <span class="comment">//----------------------------------------api</span></span><br><span class="line">    emp.<span class="built_in">filter</span>(<span class="function"><span class="params">Row</span>=&gt;</span>&#123;</span><br><span class="line">      Row.getDouble(<span class="number">7</span>) &gt; <span class="number">1500</span></span><br><span class="line">    &#125;).<span class="built_in">groupBy</span>(<span class="string">&quot;job&quot;</span>).<span class="built_in">count</span>().rdd.saveAsTextFile(<span class="string">&quot;hdfs://bigdata3:9000/spark/4&quot;</span>)</span><br><span class="line">    <span class="comment">//----------------------------------------sql</span></span><br><span class="line">    spark.sql(<span class="string">&quot;select job,count(*) from tableemp where sal &gt; 1500  group by job&quot;</span>).show()</span><br><span class="line">-------------------------------------------<span class="number">-5</span></span><br><span class="line"><span class="comment">//-列出在销售部工作的员工的姓名，假定不知道销售部的部门编号。</span></span><br><span class="line">    <span class="comment">//---------------------------api</span></span><br><span class="line">    dept.<span class="built_in">filter</span>(<span class="function"><span class="params">x</span>=&gt;</span>&#123;</span><br><span class="line">      x.getString(<span class="number">1</span>)==<span class="string">&quot;SALES&quot;</span></span><br><span class="line">    &#125;).join(emp,<span class="string">&quot;deptno&quot;</span>).select(<span class="string">&quot;ename&quot;</span>).rdd.saveAsTextFile(<span class="string">&quot;hdfs://bigdata3:9000/spark/5&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//------------------------sql</span></span><br><span class="line">    spark.sql(<span class="string">&quot;select ename from tableemp where deptno in(select  deptno from tabledept where dname=&#x27;SALES&#x27;)&quot;</span>).show()</span><br><span class="line"><span class="comment">//-----------------------------------------------------------6</span></span><br><span class="line"><span class="comment">//查询姓名以S开头的\以S结尾\包含S字符\第二个字母为L  __</span></span><br><span class="line">    <span class="comment">//----------------------------------api</span></span><br><span class="line">    emp.<span class="built_in">filter</span>(<span class="function"><span class="params">x</span>=&gt;</span>&#123;</span><br><span class="line">      (x.getString(<span class="number">3</span>).<span class="built_in">contains</span>(<span class="string">&quot;S&quot;</span>))||(x.getString(<span class="number">3</span>).startsWith(<span class="string">&quot;S&quot;</span>))||(x.getString(<span class="number">3</span>).endsWith(<span class="string">&quot;S&quot;</span>)||x.getString(<span class="number">3</span>).charAt(<span class="number">1</span>)==<span class="string">&#x27;L&#x27;</span>)</span><br><span class="line">    &#125;).rdd.saveAsTextFile(<span class="string">&quot;hdfs://bigdata3:9000/spark/6&quot;</span>)</span><br><span class="line">    <span class="comment">//----------------------------------sql</span></span><br><span class="line">    spark.sql(<span class="string">&quot;select * from tableemp where ename like &#x27;%S%&#x27; or ename REGEXP &#x27;^.L&#x27;&quot;</span>).show()</span><br><span class="line"><span class="comment">//-----------------------------------------------------------7</span></span><br><span class="line"><span class="comment">//查询每种工作的最高工资、最低工资、人数</span></span><br><span class="line">    <span class="comment">//---------------------------------api</span></span><br><span class="line">val frame2 = emp.<span class="built_in">map</span>(<span class="function"><span class="params">x</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (x.isNullAt(<span class="number">0</span>)) &#123;</span><br><span class="line">    val d = x.getDouble(<span class="number">7</span>)</span><br><span class="line">    (x.getString(<span class="number">5</span>), d)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    val d = x.getDouble(<span class="number">0</span>) + x.getDouble(<span class="number">7</span>)</span><br><span class="line">    (x.getString(<span class="number">5</span>), d)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;).<span class="built_in">groupBy</span>(<span class="string">&quot;_1&quot;</span>).<span class="built_in">max</span>(<span class="string">&quot;_2&quot;</span>)</span><br><span class="line"></span><br><span class="line">    val frame1 = emp.<span class="built_in">map</span>(<span class="function"><span class="params">x</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (x.isNullAt(<span class="number">0</span>)) &#123;</span><br><span class="line">        val d = x.getDouble(<span class="number">7</span>)</span><br><span class="line">        (x.getString(<span class="number">5</span>), d)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        val d = x.getDouble(<span class="number">0</span>) + x.getDouble(<span class="number">7</span>)</span><br><span class="line">        (x.getString(<span class="number">5</span>), d)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;).<span class="built_in">groupBy</span>(<span class="string">&quot;_1&quot;</span>).<span class="built_in">min</span>(<span class="string">&quot;_2&quot;</span>)</span><br><span class="line"></span><br><span class="line">    val frame = emp.<span class="built_in">map</span>(<span class="function"><span class="params">x</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (x.isNullAt(<span class="number">0</span>)) &#123;</span><br><span class="line">        val d = x.getDouble(<span class="number">7</span>)</span><br><span class="line">        (x.getString(<span class="number">5</span>), d)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        val d = x.getDouble(<span class="number">0</span>) + x.getDouble(<span class="number">7</span>)</span><br><span class="line">        (x.getString(<span class="number">5</span>), d)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;).<span class="built_in">groupBy</span>(<span class="string">&quot;_1&quot;</span>).<span class="built_in">count</span>()</span><br><span class="line"></span><br><span class="line">    frame.join(frame1 , <span class="string">&quot;_1&quot;</span>).join(frame2,<span class="string">&quot;_1&quot;</span>).rdd.saveAsTextFile(<span class="string">&quot;hdfs://bigdata3:9000/spark/7&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//-------------------------------sql</span></span><br><span class="line">    spark.sql(<span class="string">&quot;select max(ifnull(comm,0)+sal),min(ifnull(comm,0)+sal),count(*),job from tableemp group by job &quot;</span>).show()</span><br><span class="line"></span><br><span class="line"><span class="comment">//--------------------------------------------------------------8</span></span><br><span class="line"><span class="comment">//列出薪金 高于 公司平均薪金的所有员工号，员工姓名，所在部门名称，上级领导，工资，工资等级</span></span><br><span class="line">    <span class="comment">//--------------------------------------------api</span></span><br><span class="line">    import org.apache.spark.sql.functions._</span><br><span class="line">val list = emp.<span class="built_in">groupBy</span>().avg(<span class="string">&quot;sal&quot;</span>).rdd.<span class="built_in">map</span>(_.getDouble(<span class="number">0</span>)).collect().toList</span><br><span class="line">    println(list(<span class="number">0</span>))</span><br><span class="line">    val value = emp.<span class="built_in">filter</span>(<span class="function"><span class="params">x</span> =&gt;</span> &#123;</span><br><span class="line">      x.getDouble(<span class="number">7</span>) &gt; list(<span class="number">0</span>).toDouble</span><br><span class="line">    &#125;)</span><br><span class="line">    value.show()</span><br><span class="line">    val frame = emp.select($<span class="string">&quot;empno&quot;</span>.alias(<span class="string">&quot;mgr&quot;</span>), $<span class="string">&quot;ename&quot;</span>.alias(<span class="string">&quot;leader&quot;</span>)).join(value, <span class="string">&quot;mgr&quot;</span>).join(dept,<span class="string">&quot;deptno&quot;</span>)</span><br><span class="line"><span class="comment">//----------------------------------------------------工资等级</span></span><br><span class="line"><span class="comment">//    insert into salgrade values (1, 700, 1200);</span></span><br><span class="line"><span class="comment">//    insert into salgrade values (2, 1201, 1400);</span></span><br><span class="line"><span class="comment">//    insert into salgrade values (3, 1401, 2000);</span></span><br><span class="line"><span class="comment">//    insert into salgrade values (4, 2001, 3000);</span></span><br><span class="line"><span class="comment">//    insert into salgrade values (5, 3001, 9999);</span></span><br><span class="line">    frame.printSchema()</span><br><span class="line"><span class="comment">//    frame.rdd.collect().foreach(println(_))</span></span><br><span class="line">    val value1 = frame.rdd.<span class="built_in">map</span>(<span class="function"><span class="params">x</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (x.isNullAt(<span class="number">3</span>)) &#123;</span><br><span class="line">        val tmp = x.getDouble(<span class="number">8</span>).toInt</span><br><span class="line">        <span class="keyword">if</span> (tmp &gt; <span class="number">700</span> &amp;&amp; tmp &lt; <span class="number">1200</span>)&#123;</span><br><span class="line">          (<span class="number">1</span>, x(<span class="number">1</span>),x)</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">          <span class="keyword">if</span> (tmp &gt; <span class="number">1201</span> &amp;&amp; tmp &lt; <span class="number">1400</span>)&#123;</span><br><span class="line">            (<span class="number">2</span>, x(<span class="number">1</span>),x)</span><br><span class="line">          &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (tmp &gt; <span class="number">1401</span> &amp;&amp; tmp &lt; <span class="number">2000</span>)&#123;</span><br><span class="line">              (<span class="number">3</span>, x(<span class="number">1</span>),x)</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">              <span class="keyword">if</span> (tmp &gt; <span class="number">2001</span> &amp;&amp; tmp &lt; <span class="number">3000</span>)&#123;</span><br><span class="line">                (<span class="number">4</span>, x(<span class="number">1</span>),x)</span><br><span class="line">              &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (tmp &gt; <span class="number">3001</span> &amp;&amp; tmp &lt; <span class="number">9999</span>)&#123;</span><br><span class="line">                  (<span class="number">5</span>, x(<span class="number">1</span>),x)</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                  (<span class="number">5</span>, x(<span class="number">1</span>),x)</span><br><span class="line">                &#125;</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        val tmp =  (x.getDouble(<span class="number">3</span>) + x.getDouble(<span class="number">8</span>)).toInt</span><br><span class="line">        <span class="keyword">if</span> (tmp &gt; <span class="number">700</span> &amp;&amp; tmp &lt; <span class="number">1200</span>)&#123;</span><br><span class="line">          (<span class="number">1</span>, x(<span class="number">1</span>),x)</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">          <span class="keyword">if</span> (tmp &gt; <span class="number">1201</span> &amp;&amp; tmp &lt; <span class="number">1400</span>)&#123;</span><br><span class="line">            (<span class="number">2</span>, x(<span class="number">1</span>),x)</span><br><span class="line">          &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (tmp &gt; <span class="number">1401</span> &amp;&amp; tmp &lt; <span class="number">2000</span>)&#123;</span><br><span class="line">              (<span class="number">3</span>, x(<span class="number">1</span>),x)</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">              <span class="keyword">if</span> (tmp &gt; <span class="number">2001</span> &amp;&amp; tmp &lt; <span class="number">3000</span>)&#123;</span><br><span class="line">                (<span class="number">4</span>, x(<span class="number">1</span>),x)</span><br><span class="line">              &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (tmp &gt; <span class="number">3001</span> &amp;&amp; tmp &lt; <span class="number">9999</span>)&#123;</span><br><span class="line">                  (<span class="number">5</span>, x(<span class="number">1</span>),x)</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                  (<span class="number">5</span>, x(<span class="number">1</span>),x)</span><br><span class="line">                &#125;</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    value1.saveAsTextFile(<span class="string">&quot;hdfs://bigdata3:9000/spark/8&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// --------------------------------------------sql</span></span><br><span class="line">    emp.createOrReplaceTempView(<span class="string">&quot;tableemp1&quot;</span>)</span><br><span class="line">    spark.sql(<span class="string">&quot;\n\nselect \nking.ename,\nking.empno,\ne1.ename as leader,\nking.earn,\ns.grade\nas sallevel\nfrom (\n  select ename , empno , deptno , ifnull((sal + comm),sal) as earn ,mgr \n  from tableemp\n  where sal &gt; (\n    select avg(sal)\n    from tableemp1\n  )\n) as king \nleft join tabledept on king.deptno=tabledept.deptno \nleft join (\n  select empno,ename\n  from tableemp\n) e1 on king.mgr = e1.empno\nleft join salgrade as s on earn &gt;= losal and earn &lt;= hisal;&quot;</span>).show()</span><br><span class="line"></span><br><span class="line"><span class="comment">//--------------------------------------------------------------------9</span></span><br><span class="line"><span class="comment">//列出薪金  高于  在各自部门工作的员工的平均薪金的员工姓名和薪金、部门名称。</span></span><br><span class="line">    <span class="comment">//----------------------------------------------api</span></span><br><span class="line">val frame = emp.<span class="built_in">groupBy</span>(<span class="string">&quot;deptno&quot;</span>).avg(<span class="string">&quot;sal&quot;</span>).rdd.collect().toList</span><br><span class="line">    frame.foreach(println(_))</span><br><span class="line"></span><br><span class="line">   <span class="keyword">for</span> (elem &lt;- frame)&#123;</span><br><span class="line">     <span class="keyword">var</span> name = elem(<span class="number">0</span>).toString + <span class="string">&quot;deptno&quot;</span></span><br><span class="line">     <span class="keyword">var</span> frame1 = emp.<span class="built_in">filter</span>(<span class="function"><span class="params">x</span> =&gt;</span> &#123;</span><br><span class="line">       (x.getLong(<span class="number">1</span>).toString == elem(<span class="number">0</span>).toString) &amp;&amp; (x.getDouble(<span class="number">7</span>) &gt; elem(<span class="number">1</span>).toString.toDouble)</span><br><span class="line">     &#125;).join(dept, <span class="string">&quot;deptno&quot;</span>).rdd.saveAsTextFile(s<span class="string">&quot;hdfs://bigdata3:9000/spark/9/$name&quot;</span>)</span><br><span class="line">   &#125;</span><br><span class="line">    <span class="comment">//----------------------------------------------sql</span></span><br><span class="line">    spark.sql(<span class="string">&quot;\n\n\nselect  * \nfrom  \n(select\n*\nfrom (select avg(sal) as sal_avg, deptno as deptno1 from (select  sal ,deptno from tableemp group by sal , deptno) as king group by deptno) as avg_basic left join tableemp\non tableemp.deptno=avg_basic.deptno1  and tableemp.sal &gt; avg_basic.sal_avg) as basicinfo where basicinfo.deptno1 in (select deptno from tabledept);&quot;</span>).show()</span><br><span class="line"></span><br><span class="line"><span class="number">1</span>点ok</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content:encoded>
      
      
      <category domain="http://zihang.fun/categories/%E6%97%A5%E5%BF%97/">日志</category>
      
      
      <category domain="http://zihang.fun/tags/spark/">spark</category>
      
      
      <comments>http://zihang.fun/2023/01/10/1-10/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>spark</title>
      <link>http://zihang.fun/2023/01/04/1-4/</link>
      <guid>http://zihang.fun/2023/01/04/1-4/</guid>
      <pubDate>Wed, 04 Jan 2023 00:40:48 GMT</pubDate>
      
        
        
      <description>&lt;h1 id=&quot;spark&quot;&gt;&lt;a href=&quot;#spark&quot; class=&quot;headerlink&quot; title=&quot;spark&quot;&gt;&lt;/a&gt;spark&lt;/h1&gt;&lt;p&gt;spark产生背景？&lt;br&gt;mr,hive批处理，离线处理存在一些局限性：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;mr api </description>
        
      
      
      
      <content:encoded><![CDATA[<h1 id="spark"><a href="#spark" class="headerlink" title="spark"></a>spark</h1><p>spark产生背景？<br>mr,hive批处理，离线处理存在一些局限性：</p><ul><li>mr api 开发复杂</li><li>只能做离线计算，不能实时计算</li><li>性能不高</li></ul><p>需求：</p><p>sql &#x3D;》 mr</p><p>会产生多个job去完成一个需求</p><p>mr1&#x3D;&gt;mr2&#x3D;&gt;mr3</p><p>map &#x3D;&gt; reduce</p><p>map处理完数据&#x3D;》dask数据落盘 &#x3D;》 reduce mr</p><p>kv进行操作 &#x3D;》 k进行排序</p><p>什么是spark？</p><p>官网：<code>spark.apache.org  </code></p><p>计算特点： 不关注数据存储</p><h3 id="特点-："><a href="#特点-：" class="headerlink" title="特点 ："></a>特点 ：</h3><ul><li>Batch&#x2F;streaming data &#x3D;》 批流一体</li><li>SQL analytics</li><li>Data science at scale</li><li>Machine learning</li></ul><h3 id="速度快："><a href="#速度快：" class="headerlink" title="速度快："></a>速度快：</h3><ul><li>基于内存的运算</li><li>DAG &#x3D;》 链式编程&#x3D;》mr1&#x3D;&gt;mr2&#x3D;&gt;mr3</li><li>pipline通道的</li><li>编程模型 线程级别的</li></ul><h3 id="易用性"><a href="#易用性" class="headerlink" title="易用性"></a>易用性</h3><ul><li>开发语言：java ，Scala ， python ， sql</li><li>外部数据源</li><li>80多个高级算子&#x3D;》Scala算子</li><li>mr&#x3D;》 去读mysql数据库 &#x3D;》 DBinputformat</li><li>spark &#x3D;&gt; 封装好了多种外部数据源 &#x3D;》 jdbc ， json ，csv</li><li>mr map&#x2F;reduce</li><li>spark :80</li></ul><p>通用性</p><ul><li>子模块</li><li>sparkcore &#x3D;》 ：离线计算</li><li>sparksql &#x3D;》 离线计算</li><li>sparkstreaming，structstreaming &#x3D;》 实时计算</li><li>mllib &#x3D;》 机器学习</li><li>图计算 &#x3D;》 图处理</li></ul><p>对于spark的子模块之间可以用交互式使用</p><p>运行作业的地方</p><ul><li>yarn ***</li><li>mesos</li><li>k8s ***</li><li>standalone</li></ul><p>hadoop生态圈 vs spark生态圈</p><ul><li>Batch： mr ， hive vs sparkcore，sparksql</li><li>Sql：hive，impala vs sparksql</li><li>stream ： Strom vs spark streaming，sss</li><li>MLLib：Mahout vs MLLib</li><li>real存储 ： HBase，cassandra vs DataSource Api</li></ul><h3 id="spark-能不能替换hadoop-x3D-》-替换不了-x3D-》spark-x3D-》-可以mr"><a href="#spark-能不能替换hadoop-x3D-》-替换不了-x3D-》spark-x3D-》-可以mr" class="headerlink" title="spark 能不能替换hadoop &#x3D;》 替换不了&#x3D;》spark &#x3D;》 可以mr"></a>spark 能不能替换hadoop &#x3D;》 替换不了&#x3D;》spark &#x3D;》 可以mr</h3><p>spqrk版本：</p><ul><li>spark 1.x</li><li>spark 2.x主流</li><li>spark 3.x主流</li></ul><p>编程模型：</p><p>sparkcore &#x3D;》 RDD</p><p>sparksql &#x3D;》 dataframe &amp; dataset</p><p>sparkstreaming &#x3D;》 DS</p><p>sparkcore</p><p>RDD：rdd开发 降低开发人员的开发成本 vs mr</p><p>什么是rdd？</p><p>lower level &#x3D; 》mr</p><p>high level &#x3D;》 spark 高级算子</p><h3 id="优点："><a href="#优点：" class="headerlink" title="优点："></a>优点：</h3><ul><li>弹性 分布式 数据集</li><li>数据集 &#x3D;》 partitions 元素 &#x3D;》 一条一条数据</li><li>可以用并行的方式进行计算</li></ul><h3 id="弹性？"><a href="#弹性？" class="headerlink" title="弹性？"></a>弹性？</h3><ul><li>容错 &#x3D;》 计算的时候 可以重试</li></ul><h3 id="分布式？"><a href="#分布式？" class="headerlink" title="分布式？"></a>分布式？</h3><ul><li>存储<ul><li>rdd：1 2 3 4 5 6<ul><li>partition1:1 2 3</li><li>partition2: 4 5</li><li>partition:6</li></ul></li><li>bigdata3:p1</li><li>bigdata4:p2</li><li>bigdtat5:p3</li></ul></li><li>计算<ul><li>对rdd的操作是操作里面的数据</li></ul></li><li>数据集<ul><li>就是构建rdd本身的数据</li></ul></li><li>immutable 不可变的<ul><li>scala ： val var</li><li>rdda &#x3D;》 rddb</li><li>不可变 &#x3D; 》rdda 通过一个计算到新的rdd</li></ul></li><li>partition collection of elements &#x3D;&gt; rdd可以被分区存储&#x2F;计算</li><li>一个rdd 是由多个partition所构成的</li><li>rdd数据存储是分布式的，是跨节点进行存储的</li></ul><p>abstract</p><p>T泛型 &#x3D;》 限定在人dd里面数据 是什么类型的如：RDD[String] , RDD[Int],RDD[Student]</p><p>Serializable序列化&#x3D;》可以经过网络传输</p><p>@transient注解 这个属性不用序列化 [了解]</p><h3 id="RDD-的特性："><a href="#RDD-的特性：" class="headerlink" title="RDD 的特性："></a>RDD 的特性：</h3><ul><li>rdd 的底层存储是系列的partition</li><li>针对rdd做计算&#x2F;操作其实就是对rdd底层的partition进行计算&#x2F;操作</li><li>rdd之间的依赖关系<ul><li>rdda &#x3D;》rddb</li><li>rdd 不可变</li><li>rdda &#x3D; 》b &#x3D;》 c</li></ul></li><li>Partitioner &#x3D;》 kv类型的rdd</li><li>默认分区是hash</li><li>数据本地性 &#x3D;》 减少数据传输的io ，优点<ul><li>rdd进行操作的好处 ：<ul><li>有限的作业调度在数据所在的节点上 &#x3D;》 理想状况</li><li>常见计算 &#x3D;》 作业调度在别的节点上 ，数据另外存储在一台节点上，只能把数据通过网络传过去再进行计算</li></ul></li></ul></li></ul><p>在rdd中可以用scala的map和其他高级函数</p><p>RDD操作 ：</p><p>构建sparkcore 作业 ：idea</p><p>添加依赖 ：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">&lt;dependency&gt;</span></span><br><span class="line">     <span class="section">&lt;groupId&gt;</span><span class="attribute">org</span>.apache.spark&lt;/groupId&gt;</span><br><span class="line">     <span class="section">&lt;artifactId&gt;</span><span class="attribute">spark</span>-core_2.<span class="number">12</span>&lt;/artifactId&gt;</span><br><span class="line">     <span class="section">&lt;version&gt;</span><span class="attribute">3</span>.<span class="number">2</span>.<span class="number">1</span>&lt;/version&gt;</span><br><span class="line">   <span class="section">&lt;/dependency&gt;</span></span><br></pre></td></tr></table></figure><p>mapreduce  ：程序入口：job</p><h3 id="初始化spark："><a href="#初始化spark：" class="headerlink" title="初始化spark："></a>初始化spark：</h3><ul><li><p>sparkContext &#x3D;》 sparkcore 程序入口</p></li><li><p>SparkConf &#x3D;&gt; 指定spark app 详细信息</p><ul><li>AppName &#x3D; 》作业名字</li><li>Master &#x3D;》作业运行在什么地方 spark作业运行模式<ul><li>local，yarn，stanalone，k8s,mesos</li><li>公共中：yarn，k8s，local</li><li>测试的时候：local</li><li>一个spark作业里面只能由一个sparkcontext</li></ul></li></ul></li><li><p>如和指定Master spark作业运行模式</p><ul><li><p>local【K】模式</p><ul><li>k指的是线程数</li></ul></li><li><p>standalone &#x3D;&gt; spark:&#x2F;&#x2F;HOST:PORT</p></li><li><p>yarn 两种模式：</p><ul><li>client模式</li><li>cluster模式</li></ul></li><li><p>k8s</p><ul><li>k8s:&#x2F;&#x2F;HOST:PORT</li></ul></li></ul></li></ul><p>rdd进行编程</p><p>创建rdd</p><p>parallelize existing collection  &#x3D;》 已经存在的集合</p><p>referencing a dataset in an external storage system，hdfs、hbase、其他数据存储系统</p><p>外部数据源存储<br>            hdfs、local、hbase、s3、cos、<br>数据文件类型：<br>            text files, SequenceFiles, and any other Hadoop InputFormat.</p><p>spark部署：</p><p>spark不是部署分布式的 参考hive</p><p>spark支持分布式部署 &#x3D;》 standalone</p><p>步骤 ： 解压 &#x3D;》 软连接 &#x3D;》 source</p><p>spark-core的脚本spark-shell</p><p>例子 ： <code>spark -shell --master local[2]</code></p><p>启动spark-shell：测试code</p><ul><li>web ui &#x3D;》 每个spark作业的 <a href="http://bigdata32:4040/">http://bigdata32:4040</a></li><li>参数：<code>--master =&gt; spark shell 以什么模式去运行</code></li><li>可以用 <code>--name </code>更改spark shell的名字</li></ul><p>以下是关于参数的详细情况</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">spark-shell : </span><br><span class="line"><span class="attr">--master</span>  spark作业运行环境 </span><br><span class="line"><span class="attr">--deploy-mode</span> yarn模式 运行选择</span><br><span class="line"><span class="attr">--class</span>  spark作业包 运行主类<span class="selector-tag">main</span>  class 包名 </span><br><span class="line"><span class="attr">--name</span>  指定spark作业的名字 </span><br><span class="line"><span class="attr">--jars</span> 指定第三方的依赖包</span><br><span class="line"><span class="attr">--conf</span> 指定spark作业配置参数 </span><br><span class="line">yarn 参数补充： </span><br><span class="line"><span class="attr">--num-executors</span> 指定 申请资源的参数 </span><br><span class="line"><span class="attr">--executor-memory</span> 指定 申请资源的参数 </span><br><span class="line"><span class="attr">--executor-cores</span> 指定 申请资源的参数</span><br><span class="line"><span class="attr">--queue</span> 指定作业 运行在yarn的哪个队列上 </span><br><span class="line"></span><br><span class="line">spark-shell 交互式命令 底层调用 =》 spark-submit </span><br><span class="line">开发者 主要使用的脚本 用于提交用户自己开发的spark作业</span><br><span class="line"></span><br><span class="line">spark-shell: </span><br><span class="line">spark-submit \</span><br><span class="line"><span class="attr">--class</span> org<span class="selector-class">.apache</span><span class="selector-class">.spark</span><span class="selector-class">.repl</span><span class="selector-class">.Main</span> \</span><br><span class="line"><span class="attr">--name</span> <span class="string">&quot;Spark shell&quot;</span> <span class="string">&quot;$@&quot;</span></span><br><span class="line"></span><br><span class="line">spark-shell <span class="attr">--master</span> <span class="string">&quot;local[2]&quot;</span>: </span><br><span class="line">spark-submit \</span><br><span class="line"><span class="attr">--class</span> org<span class="selector-class">.apache</span><span class="selector-class">.spark</span><span class="selector-class">.repl</span><span class="selector-class">.Main</span> \</span><br><span class="line"><span class="attr">--name</span> <span class="string">&quot;Spark shell&quot;</span>  <span class="attr">--master</span> <span class="string">&quot;local[2]&quot;</span></span><br></pre></td></tr></table></figure><h3 id="算子："><a href="#算子：" class="headerlink" title="算子："></a>算子：</h3><p>filter：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">scala</span>&gt; test.collect</span><br><span class="line"><span class="attribute">res15</span>: Array[Int] = Array(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">17</span>, <span class="number">18</span>, <span class="number">19</span>, <span class="number">20</span>, <span class="number">21</span>, <span class="number">22</span>, <span class="number">23</span>, <span class="number">24</span>, <span class="number">25</span>, <span class="number">26</span>, <span class="number">27</span>, <span class="number">28</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">31</span>, <span class="number">32</span>, <span class="number">33</span>, <span class="number">34</span>, <span class="number">35</span>, <span class="number">36</span>, <span class="number">37</span>, <span class="number">38</span>, <span class="number">39</span>, <span class="number">40</span>, <span class="number">41</span>, <span class="number">42</span>, <span class="number">43</span>, <span class="number">44</span>, <span class="number">45</span>, <span class="number">46</span>, <span class="number">47</span>, <span class="number">48</span>, <span class="number">49</span>, <span class="number">50</span>, <span class="number">51</span>, <span class="number">52</span>, <span class="number">53</span>, <span class="number">54</span>, <span class="number">55</span>, <span class="number">56</span>, <span class="number">57</span>, <span class="number">58</span>, <span class="number">59</span>, <span class="number">60</span>, <span class="number">61</span>, <span class="number">62</span>, <span class="number">63</span>, <span class="number">64</span>, <span class="number">65</span>, <span class="number">66</span>, <span class="number">67</span>, <span class="number">68</span>, <span class="number">69</span>, <span class="number">70</span>, <span class="number">71</span>, <span class="number">72</span>, <span class="number">73</span>, <span class="number">74</span>, <span class="number">75</span>, <span class="number">76</span>, <span class="number">77</span>, <span class="number">78</span>, <span class="number">79</span>, <span class="number">80</span>, <span class="number">81</span>, <span class="number">82</span>, <span class="number">83</span>, <span class="number">84</span>, <span class="number">85</span>, <span class="number">86</span>, <span class="number">87</span>, <span class="number">88</span>, <span class="number">89</span>, <span class="number">90</span>, <span class="number">91</span>, <span class="number">92</span>, <span class="number">93</span>, <span class="number">94</span>, <span class="number">95</span>, <span class="number">96</span>, <span class="number">97</span>, <span class="number">98</span>, <span class="number">99</span>, <span class="number">100</span>, <span class="number">101</span>, <span class="number">102</span>, <span class="number">103</span>, <span class="number">104</span>, <span class="number">105</span>, <span class="number">106</span>, <span class="number">107</span>, <span class="number">108</span>, <span class="number">109</span>, <span class="number">110</span>, <span class="number">111</span>, <span class="number">112</span>, <span class="number">113</span>, <span class="number">114</span>, <span class="number">115</span>, <span class="number">116</span>, <span class="number">117</span>, <span class="number">118</span>, <span class="number">119</span>, <span class="number">120</span>, <span class="number">121</span>, <span class="number">122</span>, <span class="number">123</span>, <span class="number">124</span>, <span class="number">125</span>, <span class="number">126</span>, <span class="number">127</span>, <span class="number">128</span>, <span class="number">129</span>, <span class="number">130</span>, <span class="number">131</span>, <span class="number">132</span>, <span class="number">133</span>, <span class="number">134</span>, <span class="number">135</span>, <span class="number">136</span>, <span class="number">137</span>, <span class="number">138</span>, <span class="number">139</span>, <span class="number">140</span>, <span class="number">141</span>, <span class="number">142</span>, <span class="number">143</span>, <span class="number">144</span>, <span class="number">145</span>, <span class="number">146</span>, <span class="number">147</span>, <span class="number">148</span>, <span class="number">149</span>, <span class="number">150</span>, <span class="number">151</span>, <span class="number">152</span>, <span class="number">153</span>, <span class="number">154</span>, <span class="number">155</span>, <span class="number">156</span>, <span class="number">157</span>, <span class="number">158</span>, <span class="number">159</span>, <span class="number">160</span>, <span class="number">161</span>, <span class="number">162</span>, <span class="number">163</span>, <span class="number">164</span>, <span class="number">165</span>, <span class="number">166</span>, <span class="number">167</span>, <span class="number">168</span>, <span class="number">169</span>, <span class="number">170</span>, <span class="number">171</span>...</span><br><span class="line"></span><br><span class="line"><span class="attribute">scala</span>&gt; test.filter(_&gt;<span class="number">999</span>).collect</span><br><span class="line"><span class="attribute">res16</span>: Array[Int] = Array(<span class="number">1000</span>)</span><br><span class="line"><span class="attribute">scala</span>&gt; test.collect</span><br><span class="line"><span class="attribute">res15</span>: Array[Int] = Array(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">17</span>, <span class="number">18</span>, <span class="number">19</span>, <span class="number">20</span>, <span class="number">21</span>, <span class="number">22</span>, <span class="number">23</span>, <span class="number">24</span>, <span class="number">25</span>, <span class="number">26</span>, <span class="number">27</span>, <span class="number">28</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">31</span>, <span class="number">32</span>, <span class="number">33</span>, <span class="number">34</span>, <span class="number">35</span>, <span class="number">36</span>, <span class="number">37</span>, <span class="number">38</span>, <span class="number">39</span>, <span class="number">40</span>, <span class="number">41</span>, <span class="number">42</span>, <span class="number">43</span>, <span class="number">44</span>, <span class="number">45</span>, <span class="number">46</span>, <span class="number">47</span>, <span class="number">48</span>, <span class="number">49</span>, <span class="number">50</span>, <span class="number">51</span>, <span class="number">52</span>, <span class="number">53</span>, <span class="number">54</span>, <span class="number">55</span>, <span class="number">56</span>, <span class="number">57</span>, <span class="number">58</span>, <span class="number">59</span>, <span class="number">60</span>, <span class="number">61</span>, <span class="number">62</span>, <span class="number">63</span>, <span class="number">64</span>, <span class="number">65</span>, <span class="number">66</span>, <span class="number">67</span>, <span class="number">68</span>, <span class="number">69</span>, <span class="number">70</span>, <span class="number">71</span>, <span class="number">72</span>, <span class="number">73</span>, <span class="number">74</span>, <span class="number">75</span>, <span class="number">76</span>, <span class="number">77</span>, <span class="number">78</span>, <span class="number">79</span>, <span class="number">80</span>, <span class="number">81</span>, <span class="number">82</span>, <span class="number">83</span>, <span class="number">84</span>, <span class="number">85</span>, <span class="number">86</span>, <span class="number">87</span>, <span class="number">88</span>, <span class="number">89</span>, <span class="number">90</span>, <span class="number">91</span>, <span class="number">92</span>, <span class="number">93</span>, <span class="number">94</span>, <span class="number">95</span>, <span class="number">96</span>, <span class="number">97</span>, <span class="number">98</span>, <span class="number">99</span>, <span class="number">100</span>, <span class="number">101</span>, <span class="number">102</span>, <span class="number">103</span>, <span class="number">104</span>, <span class="number">105</span>, <span class="number">106</span>, <span class="number">107</span>, <span class="number">108</span>, <span class="number">109</span>, <span class="number">110</span>, <span class="number">111</span>, <span class="number">112</span>, <span class="number">113</span>, <span class="number">114</span>, <span class="number">115</span>, <span class="number">116</span>, <span class="number">117</span>, <span class="number">118</span>, <span class="number">119</span>, <span class="number">120</span>, <span class="number">121</span>, <span class="number">122</span>, <span class="number">123</span>, <span class="number">124</span>, <span class="number">125</span>, <span class="number">126</span>, <span class="number">127</span>, <span class="number">128</span>, <span class="number">129</span>, <span class="number">130</span>, <span class="number">131</span>, <span class="number">132</span>, <span class="number">133</span>, <span class="number">134</span>, <span class="number">135</span>, <span class="number">136</span>, <span class="number">137</span>, <span class="number">138</span>, <span class="number">139</span>, <span class="number">140</span>, <span class="number">141</span>, <span class="number">142</span>, <span class="number">143</span>, <span class="number">144</span>, <span class="number">145</span>, <span class="number">146</span>, <span class="number">147</span>, <span class="number">148</span>, <span class="number">149</span>, <span class="number">150</span>, <span class="number">151</span>, <span class="number">152</span>, <span class="number">153</span>, <span class="number">154</span>, <span class="number">155</span>, <span class="number">156</span>, <span class="number">157</span>, <span class="number">158</span>, <span class="number">159</span>, <span class="number">160</span>, <span class="number">161</span>, <span class="number">162</span>, <span class="number">163</span>, <span class="number">164</span>, <span class="number">165</span>, <span class="number">166</span>, <span class="number">167</span>, <span class="number">168</span>, <span class="number">169</span>, <span class="number">170</span>, <span class="number">171</span>...</span><br><span class="line"></span><br><span class="line"><span class="attribute">scala</span>&gt; test.filter(_&gt;<span class="number">999</span>).collect</span><br><span class="line"><span class="attribute">res16</span>: Array[Int] = Array(<span class="number">1000</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>mapPartitionsWithIndex：就是和mappartition是基本上一样的就是多了个索引</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> rdd = sc.make<span class="constructor">RDD(List(1,2,3,4)</span>,numSlices = <span class="number">2</span>)<span class="comment">//分区为2</span></span><br><span class="line">scala&gt; rdd.map<span class="constructor">PartitionsWithIndex((<span class="params">index</span>,<span class="params">iter</span>)</span>=&gt; &#123;<span class="keyword">if</span>(index ==<span class="number">1</span>) &#123; iter &#125; <span class="keyword">else</span> &#123; <span class="module-access"><span class="module"><span class="identifier">Nil</span>.</span></span>iterator&#125;&#125;).collect.foreach(println)</span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line">scala&gt; rdd.map<span class="constructor">PartitionsWithIndex((<span class="params">index</span>,<span class="params">iter</span>)</span>=&gt; &#123;iter.map(num =&gt; &#123;(index , num)&#125;)&#125;).collect.foreach(println)</span><br><span class="line">(<span class="number">0</span>,<span class="number">1</span>)</span><br><span class="line">(<span class="number">0</span>,<span class="number">2</span>)</span><br><span class="line">(<span class="number">1</span>,<span class="number">3</span>)</span><br><span class="line">(<span class="number">1</span>,<span class="number">4</span>)</span><br><span class="line">-=--------------------------------------------------------mappartition</span><br><span class="line">scala&gt; test1.map<span class="constructor">Partitions(<span class="params">_</span>.<span class="params">map</span>(<span class="params">_</span>.<span class="params">_2</span>)</span>,<span class="literal">true</span>).collect.foreach(print)</span><br><span class="line"><span class="number">1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798991001011021031041051061071081091101111121131141151161171181191201211221231241251261271281291301311321331341351361371381391401411421431441451461471481491501511521531541551561571581591601611621631641651661671681691701711721731741751761771781791801811821831841851861871881891901911921931941951961971981992002012022032042052062072082092102112122132142152162172182192202212222232242252262272282292302312322332342352362372382392402412422432442452462472482492502512522532542552562572582592602612622632642652662672682692702712722732742752762772782792802812822832842852862872882892902912922932942952962972982993003013023033043053063073083093103113123133143153163173183193203213223233243253263273283293303313323333343353363373383393403413423433443453463473483493503513523533543553563573583593603613623633643653663673683693703713723733743753763773783793803813823833843853863873883893903913923933943953963973983994004014024034044054064074084094104114124134144154164174184194204214224234244254264274284294304314324334344354364374384394404414424434444454464474484494504514524534544554564574584594604614624634644654664674684694704714724734744754764774784794804814824834844854864874884894904914924934944954964974984995005015025035045055065075085095105115125135145155165175185195205215225235245255265275285295305315325335345355365375385395405415425435445455465475485495505515525535545555565575585595605615625635645655665675685695705715725735745755765775785795805815825835845855865875885895905915925935945955965975985996006016026036046056066076086096106116126136146156166176186196206216226236246256266276286296306316326336346356366376386396406416426436446456466476486496506516526536546556566576586596606616626636646656666676686696706716726736746756766776786796806816826836846856866876886896906916926936946956966976986997007017027037047057067077087097107117127137147157167177187197207217227237247257267277287297307317327337347357367377387397407417427437447457467477487497507517527537547557567577587597607617627637647657667677687697707717727737747757767777787797807817827837847857867877887897907917927937947957967977987998008018028038048058068078088098108118128138148158168178188198208218228238248258268278288298308318328338348358368378388398408418428438448458468478488498508518528538548558568578588598608618628638648658668678688698708718728738748758768778788798808818828838848858868878888898908918928938948958968978988999009019029039049059069079089099109119129139149159169179189199209219229239249259269279289299309319329339349359369379389399409419429439449459469479489499509519529539549559569579589599609619629639649659669679689699709719729739749759769779789799809819829839849859869879889899909919929939949959969979989991000</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>一般的使用场景是查看partition里的元素</p><p>每个rdd的数据落到是什么分区上，我们不用太管，后面会讲</p><p>mapValues：只对kv类型的数据进行操作，相当于是单独对每个values做处理</p><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">scala&gt; test<span class="number">1.</span>mapValues<span class="comment">(_+3)</span>.collect.foreach<span class="comment">(print)</span></span><br><span class="line"><span class="comment">(0,4)</span><span class="comment">(0,5)</span><span class="comment">(0,6)</span><span class="comment">(0,7)</span><span class="comment">(0,8)</span><span class="comment">(0,9)</span><span class="comment">(0,10)</span><span class="comment">(0,11)</span><span class="comment">(0,12)</span><span class="comment">(0,13)</span><span class="comment">(0,14)</span><span class="comment">(0,15)</span><span class="comment">(0,16)</span><span class="comment">(0,17)</span><span class="comment">(0,18)</span><span class="comment">(0,19)</span><span class="comment">(0,20)</span><span class="comment">(0,21)</span><span class="comment">(0,22)</span><span class="comment">(0,23)</span><span class="comment">(0,24)</span><span class="comment">(0,25)</span><span class="comment">(0,26)</span><span class="comment">(0,27)</span><span class="comment">(0,28)</span><span class="comment">(0,29)</span><span class="comment">(0,30)</span><span class="comment">(0,31)</span><span class="comment">(0,32)</span><span class="comment">(0,33)</span><span class="comment">(0,34)</span><span class="comment">(0,35)</span><span class="comment">(0,36)</span><span class="comment">(0,37)</span><span class="comment">(0,38)</span><span class="comment">(0,39)</span><span class="comment">(0,40)</span><span class="comment">(0,41)</span><span class="comment">(0,42)</span><span class="comment">(0,43)</span><span class="comment">(0,44)</span><span class="comment">(0,45)</span><span class="comment">(0,46)</span><span class="comment">(0,47)</span><span class="comment">(0,48)</span><span class="comment">(0,49)</span><span class="comment">(0,50)</span><span class="comment">(0,51)</span><span class="comment">(0,52)</span><span class="comment">(0,53)</span><span class="comment">(0,54)</span><span class="comment">(0,55)</span><span class="comment">(0,56)</span><span class="comment">(0,57)</span><span class="comment">(0,58)</span><span class="comment">(0,59)</span><span class="comment">(0,60)</span><span class="comment">(0,61)</span><span class="comment">(0,62)</span><span class="comment">(0,63)</span><span class="comment">(0,64)</span><span class="comment">(0,65)</span><span class="comment">(0,66)</span><span class="comment">(0,67)</span><span class="comment">(0,68)</span><span class="comment">(0,69)</span><span class="comment">(0,70)</span><span class="comment">(0,71)</span><span class="comment">(0,72)</span><span class="comment">(0,73)</span><span class="comment">(0,74)</span><span class="comment">(0,75)</span><span class="comment">(0,76)</span><span class="comment">(0,77)</span><span class="comment">(0,78)</span><span class="comment">(0,79)</span><span class="comment">(0,80)</span><span class="comment">(0,81)</span><span class="comment">(0,82)</span><span class="comment">(0,83)</span><span class="comment">(0,84)</span><span class="comment">(0,85)</span><span class="comment">(0,86)</span><span class="comment">(0,87)</span><span class="comment">(0,88)</span><span class="comment">(0,89)</span><span class="comment">(0,90)</span><span class="comment">(0,91)</span><span class="comment">(0,92)</span><span class="comment">(0,93)</span><span class="comment">(0,94)</span><span class="comment">(0,95)</span><span class="comment">(0,96)</span><span class="comment">(0,97)</span><span class="comment">(0,98)</span><span class="comment">(0,99)</span><span class="comment">(0,100)</span><span class="comment">(0,101)</span><span class="comment">(0,102)</span><span class="comment">(0,103)</span><span class="comment">(0,104)</span><span class="comment">(0,105)</span><span class="comment">(0,106)</span><span class="comment">(0,107)</span><span class="comment">(0,108)</span><span class="comment">(0,109)</span><span class="comment">(0,110)</span><span class="comment">(0,111)</span><span class="comment">(0,112)</span><span class="comment">(0,113)</span><span class="comment">(0,114)</span><span class="comment">(0,115)</span><span class="comment">(0,116)</span><span class="comment">(0,117)</span><span class="comment">(0,118)</span><span class="comment">(0,119)</span><span class="comment">(0,120)</span><span class="comment">(0,121)</span><span class="comment">(0,122)</span><span class="comment">(0,123)</span><span class="comment">(0,124)</span><span class="comment">(0,125)</span><span class="comment">(0,126)</span><span class="comment">(0,127)</span><span class="comment">(0,128)</span><span class="comment">(0,129)</span><span class="comment">(0,130)</span><span class="comment">(0,131)</span><span class="comment">(0,132)</span><span class="comment">(0,133)</span><span class="comment">(0,134)</span><span class="comment">(0,135)</span><span class="comment">(0,136)</span><span class="comment">(0,137)</span><span class="comment">(0,138)</span><span class="comment">(0,139)</span><span class="comment">(0,140)</span><span class="comment">(0,141)</span><span class="comment">(0,142)</span><span class="comment">(0,143)</span><span class="comment">(0,144)</span><span class="comment">(0,145)</span><span class="comment">(0,146)</span><span class="comment">(0,147)</span><span class="comment">(0,148)</span><span class="comment">(0,149)</span><span class="comment">(0,150)</span><span class="comment">(0,151)</span><span class="comment">(0,152)</span><span class="comment">(0,153)</span><span class="comment">(0,154)</span><span class="comment">(0,155)</span><span class="comment">(0,156)</span><span class="comment">(0,157)</span><span class="comment">(0,158)</span><span class="comment">(0,159)</span><span class="comment">(0,160)</span><span class="comment">(0,161)</span><span class="comment">(0,162)</span><span class="comment">(0,163)</span><span class="comment">(0,164)</span><span class="comment">(0,165)</span><span class="comment">(0,166)</span><span class="comment">(0,167)</span><span class="comment">(0,168)</span><span class="comment">(0,169)</span><span class="comment">(0,170)</span><span class="comment">(0,171)</span><span class="comment">(0,172)</span><span class="comment">(0,173)</span><span class="comment">(0,174)</span><span class="comment">(0,175)</span><span class="comment">(0,176)</span><span class="comment">(0,177)</span><span class="comment">(0,178)</span><span class="comment">(0,179)</span><span class="comment">(0,180)</span><span class="comment">(0,181)</span><span class="comment">(0,182)</span><span class="comment">(0,183)</span><span class="comment">(0,184)</span><span class="comment">(0,185)</span><span class="comment">(0,186)</span><span class="comment">(0,187)</span><span class="comment">(0,188)</span><span class="comment">(0,189)</span><span class="comment">(0,190)</span><span class="comment">(0,191)</span><span class="comment">(0,192)</span><span class="comment">(0,193)</span><span class="comment">(0,194)</span><span class="comment">(0,195)</span><span class="comment">(0,196)</span><span class="comment">(0,197)</span><span class="comment">(0,198)</span><span class="comment">(0,199)</span><span class="comment">(0,200)</span><span class="comment">(0,201)</span><span class="comment">(0,202)</span><span class="comment">(0,203)</span><span class="comment">(0,204)</span><span class="comment">(0,205)</span><span class="comment">(0,206)</span><span class="comment">(0,207)</span><span class="comment">(0,208)</span><span class="comment">(0,209)</span><span class="comment">(0,210)</span><span class="comment">(0,211)</span><span class="comment">(0,212)</span><span class="comment">(0,213)</span><span class="comment">(0,214)</span><span class="comment">(0,215)</span><span class="comment">(0,216)</span><span class="comment">(0,217)</span><span class="comment">(0,218)</span><span class="comment">(0,219)</span><span class="comment">(0,220)</span><span class="comment">(0,221)</span><span class="comment">(0,222)</span><span class="comment">(0,223)</span><span class="comment">(0,224)</span><span class="comment">(0,225)</span><span class="comment">(0,226)</span><span class="comment">(0,227)</span><span class="comment">(0,228)</span><span class="comment">(0,229)</span><span class="comment">(0,230)</span><span class="comment">(0,231)</span><span class="comment">(0,232)</span><span class="comment">(0,233)</span><span class="comment">(0,234)</span><span class="comment">(0,235)</span><span class="comment">(0,236)</span><span class="comment">(0,237)</span><span class="comment">(0,238)</span><span class="comment">(0,239)</span><span class="comment">(0,240)</span><span class="comment">(0,241)</span><span class="comment">(0,242)</span><span class="comment">(0,243)</span><span class="comment">(0,244)</span><span class="comment">(0,245)</span><span class="comment">(0,246)</span><span class="comment">(0,247)</span><span class="comment">(0,248)</span><span class="comment">(0,249)</span><span class="comment">(0,250)</span><span class="comment">(0,251)</span><span class="comment">(0,252)</span><span class="comment">(0,253)</span><span class="comment">(0,254)</span><span class="comment">(0,255)</span><span class="comment">(0,256)</span><span class="comment">(0,257)</span><span class="comment">(0,258)</span><span class="comment">(0,259)</span><span class="comment">(0,260)</span><span class="comment">(0,261)</span><span class="comment">(0,262)</span><span class="comment">(0,263)</span><span class="comment">(0,264)</span><span class="comment">(0,265)</span><span class="comment">(0,266)</span><span class="comment">(0,267)</span><span class="comment">(0,268)</span><span class="comment">(0,269)</span><span class="comment">(0,270)</span><span class="comment">(0,271)</span><span class="comment">(0,272)</span><span class="comment">(0,273)</span><span class="comment">(0,274)</span><span class="comment">(0,275)</span><span class="comment">(0,276)</span><span class="comment">(0,277)</span><span class="comment">(0,278)</span><span class="comment">(0,279)</span><span class="comment">(0,280)</span><span class="comment">(0,281)</span><span class="comment">(0,282)</span><span class="comment">(0,283)</span><span class="comment">(0,284)</span><span class="comment">(0,285)</span><span class="comment">(0,286)</span><span class="comment">(0,287)</span><span class="comment">(0,288)</span><span class="comment">(0,289)</span><span class="comment">(0,290)</span><span class="comment">(0,291)</span><span class="comment">(0,292)</span><span class="comment">(0,293)</span><span class="comment">(0,294)</span><span class="comment">(0,295)</span><span class="comment">(0,296)</span><span class="comment">(0,297)</span><span class="comment">(0,298)</span><span class="comment">(0,299)</span><span class="comment">(0,300)</span><span class="comment">(0,301)</span><span class="comment">(0,302)</span><span class="comment">(0,303)</span><span class="comment">(0,304)</span><span class="comment">(0,305)</span><span class="comment">(0,306)</span><span class="comment">(0,307)</span><span class="comment">(0,308)</span><span class="comment">(0,309)</span><span class="comment">(0,310)</span><span class="comment">(0,311)</span><span class="comment">(0,312)</span><span class="comment">(0,313)</span><span class="comment">(0,314)</span><span class="comment">(0,315)</span><span class="comment">(0,316)</span><span class="comment">(0,317)</span><span class="comment">(0,318)</span><span class="comment">(0,319)</span><span class="comment">(0,320)</span><span class="comment">(0,321)</span><span class="comment">(0,322)</span><span class="comment">(0,323)</span><span class="comment">(0,324)</span><span class="comment">(0,325)</span><span class="comment">(0,326)</span><span class="comment">(0,327)</span><span class="comment">(0,328)</span><span class="comment">(0,329)</span><span class="comment">(0,330)</span><span class="comment">(0,331)</span><span class="comment">(0,332)</span><span class="comment">(0,333)</span><span class="comment">(0,334)</span><span class="comment">(0,335)</span><span class="comment">(0,336)</span><span class="comment">(0,337)</span><span class="comment">(0,338)</span><span class="comment">(0,339)</span><span class="comment">(0,340)</span><span class="comment">(0,341)</span><span class="comment">(0,342)</span><span class="comment">(0,343)</span><span class="comment">(0,344)</span><span class="comment">(0,345)</span><span class="comment">(0,346)</span><span class="comment">(0,347)</span><span class="comment">(0,348)</span><span class="comment">(0,349)</span><span class="comment">(0,350)</span><span class="comment">(0,351)</span><span class="comment">(0,352)</span><span class="comment">(0,353)</span><span class="comment">(0,354)</span><span class="comment">(0,355)</span><span class="comment">(0,356)</span><span class="comment">(0,357)</span><span class="comment">(0,358)</span><span class="comment">(0,359)</span><span class="comment">(0,360)</span><span class="comment">(0,361)</span><span class="comment">(0,362)</span><span class="comment">(0,363)</span><span class="comment">(0,364)</span><span class="comment">(0,365)</span><span class="comment">(0,366)</span><span class="comment">(0,367)</span><span class="comment">(0,368)</span><span class="comment">(0,369)</span><span class="comment">(0,370)</span><span class="comment">(0,371)</span><span class="comment">(0,372)</span><span class="comment">(0,373)</span><span class="comment">(0,374)</span><span class="comment">(0,375)</span><span class="comment">(0,376)</span><span class="comment">(0,377)</span><span class="comment">(0,378)</span><span class="comment">(0,379)</span><span class="comment">(0,380)</span><span class="comment">(0,381)</span><span class="comment">(0,382)</span><span class="comment">(0,383)</span><span class="comment">(0,384)</span><span class="comment">(0,385)</span><span class="comment">(0,386)</span><span class="comment">(0,387)</span><span class="comment">(0,388)</span><span class="comment">(0,389)</span><span class="comment">(0,390)</span><span class="comment">(0,391)</span><span class="comment">(0,392)</span><span class="comment">(0,393)</span><span class="comment">(0,394)</span><span class="comment">(0,395)</span><span class="comment">(0,396)</span><span class="comment">(0,397)</span><span class="comment">(0,398)</span><span class="comment">(0,399)</span><span class="comment">(0,400)</span><span class="comment">(0,401)</span><span class="comment">(0,402)</span><span class="comment">(0,403)</span><span class="comment">(0,404)</span><span class="comment">(0,405)</span><span class="comment">(0,406)</span><span class="comment">(0,407)</span><span class="comment">(0,408)</span><span class="comment">(0,409)</span><span class="comment">(0,410)</span><span class="comment">(0,411)</span><span class="comment">(0,412)</span><span class="comment">(0,413)</span><span class="comment">(0,414)</span><span class="comment">(0,415)</span><span class="comment">(0,416)</span><span class="comment">(0,417)</span><span class="comment">(0,418)</span><span class="comment">(0,419)</span><span class="comment">(0,420)</span><span class="comment">(0,421)</span><span class="comment">(0,422)</span><span class="comment">(0,423)</span><span class="comment">(0,424)</span><span class="comment">(0,425)</span><span class="comment">(0,426)</span><span class="comment">(0,427)</span><span class="comment">(0,428)</span><span class="comment">(0,429)</span><span class="comment">(0,430)</span><span class="comment">(0,431)</span><span class="comment">(0,432)</span><span class="comment">(0,433)</span><span class="comment">(0,434)</span><span class="comment">(0,435)</span><span class="comment">(0,436)</span><span class="comment">(0,437)</span><span class="comment">(0,438)</span><span class="comment">(0,439)</span><span class="comment">(0,440)</span><span class="comment">(0,441)</span><span class="comment">(0,442)</span><span class="comment">(0,443)</span><span class="comment">(0,444)</span><span class="comment">(0,445)</span><span class="comment">(0,446)</span><span class="comment">(0,447)</span><span class="comment">(0,448)</span><span class="comment">(0,449)</span><span class="comment">(0,450)</span><span class="comment">(0,451)</span><span class="comment">(0,452)</span><span class="comment">(0,453)</span><span class="comment">(0,454)</span><span class="comment">(0,455)</span><span class="comment">(0,456)</span><span class="comment">(0,457)</span><span class="comment">(0,458)</span><span class="comment">(0,459)</span><span class="comment">(0,460)</span><span class="comment">(0,461)</span><span class="comment">(0,462)</span><span class="comment">(0,463)</span><span class="comment">(0,464)</span><span class="comment">(0,465)</span><span class="comment">(0,466)</span><span class="comment">(0,467)</span><span class="comment">(0,468)</span><span class="comment">(0,469)</span><span class="comment">(0,470)</span><span class="comment">(0,471)</span><span class="comment">(0,472)</span><span class="comment">(0,473)</span><span class="comment">(0,474)</span><span class="comment">(0,475)</span><span class="comment">(0,476)</span><span class="comment">(0,477)</span><span class="comment">(0,478)</span><span class="comment">(0,479)</span><span class="comment">(0,480)</span><span class="comment">(0,481)</span><span class="comment">(0,482)</span><span class="comment">(0,483)</span><span class="comment">(0,484)</span><span class="comment">(0,485)</span><span class="comment">(0,486)</span><span class="comment">(0,487)</span><span class="comment">(0,488)</span><span class="comment">(0,489)</span><span class="comment">(0,490)</span><span class="comment">(0,491)</span><span class="comment">(0,492)</span><span class="comment">(0,493)</span><span class="comment">(0,494)</span><span class="comment">(0,495)</span><span class="comment">(0,496)</span><span class="comment">(0,497)</span><span class="comment">(0,498)</span><span class="comment">(0,499)</span><span class="comment">(0,500)</span><span class="comment">(0,501)</span><span class="comment">(0,502)</span><span class="comment">(0,503)</span><span class="comment">(1,504)</span><span class="comment">(1,505)</span><span class="comment">(1,506)</span><span class="comment">(1,507)</span><span class="comment">(1,508)</span><span class="comment">(1,509)</span><span class="comment">(1,510)</span><span class="comment">(1,511)</span><span class="comment">(1,512)</span><span class="comment">(1,513)</span><span class="comment">(1,514)</span><span class="comment">(1,515)</span><span class="comment">(1,516)</span><span class="comment">(1,517)</span><span class="comment">(1,518)</span><span class="comment">(1,519)</span><span class="comment">(1,520)</span><span class="comment">(1,521)</span><span class="comment">(1,522)</span><span class="comment">(1,523)</span><span class="comment">(1,524)</span><span class="comment">(1,525)</span><span class="comment">(1,526)</span><span class="comment">(1,527)</span><span class="comment">(1,528)</span><span class="comment">(1,529)</span><span class="comment">(1,530)</span><span class="comment">(1,531)</span><span class="comment">(1,532)</span><span class="comment">(1,533)</span><span class="comment">(1,534)</span><span class="comment">(1,535)</span><span class="comment">(1,536)</span><span class="comment">(1,537)</span><span class="comment">(1,538)</span><span class="comment">(1,539)</span><span class="comment">(1,540)</span><span class="comment">(1,541)</span><span class="comment">(1,542)</span><span class="comment">(1,543)</span><span class="comment">(1,544)</span><span class="comment">(1,545)</span><span class="comment">(1,546)</span><span class="comment">(1,547)</span><span class="comment">(1,548)</span><span class="comment">(1,549)</span><span class="comment">(1,550)</span><span class="comment">(1,551)</span><span class="comment">(1,552)</span><span class="comment">(1,553)</span><span class="comment">(1,554)</span><span class="comment">(1,555)</span><span class="comment">(1,556)</span><span class="comment">(1,557)</span><span class="comment">(1,558)</span><span class="comment">(1,559)</span><span class="comment">(1,560)</span><span class="comment">(1,561)</span><span class="comment">(1,562)</span><span class="comment">(1,563)</span><span class="comment">(1,564)</span><span class="comment">(1,565)</span><span class="comment">(1,566)</span><span class="comment">(1,567)</span><span class="comment">(1,568)</span><span class="comment">(1,569)</span><span class="comment">(1,570)</span><span class="comment">(1,571)</span><span class="comment">(1,572)</span><span class="comment">(1,573)</span><span class="comment">(1,574)</span><span class="comment">(1,575)</span><span class="comment">(1,576)</span><span class="comment">(1,577)</span><span class="comment">(1,578)</span><span class="comment">(1,579)</span><span class="comment">(1,580)</span><span class="comment">(1,581)</span><span class="comment">(1,582)</span><span class="comment">(1,583)</span><span class="comment">(1,584)</span><span class="comment">(1,585)</span><span class="comment">(1,586)</span><span class="comment">(1,587)</span><span class="comment">(1,588)</span><span class="comment">(1,589)</span><span class="comment">(1,590)</span><span class="comment">(1,591)</span><span class="comment">(1,592)</span><span class="comment">(1,593)</span><span class="comment">(1,594)</span><span class="comment">(1,595)</span><span class="comment">(1,596)</span><span class="comment">(1,597)</span><span class="comment">(1,598)</span><span class="comment">(1,599)</span><span class="comment">(1,600)</span><span class="comment">(1,601)</span><span class="comment">(1,602)</span><span class="comment">(1,603)</span><span class="comment">(1,604)</span><span class="comment">(1,605)</span><span class="comment">(1,606)</span><span class="comment">(1,607)</span><span class="comment">(1,608)</span><span class="comment">(1,609)</span><span class="comment">(1,610)</span><span class="comment">(1,611)</span><span class="comment">(1,612)</span><span class="comment">(1,613)</span><span class="comment">(1,614)</span><span class="comment">(1,615)</span><span class="comment">(1,616)</span><span class="comment">(1,617)</span><span class="comment">(1,618)</span><span class="comment">(1,619)</span><span class="comment">(1,620)</span><span class="comment">(1,621)</span><span class="comment">(1,622)</span><span class="comment">(1,623)</span><span class="comment">(1,624)</span><span class="comment">(1,625)</span><span class="comment">(1,626)</span><span class="comment">(1,627)</span><span class="comment">(1,628)</span><span class="comment">(1,629)</span><span class="comment">(1,630)</span><span class="comment">(1,631)</span><span class="comment">(1,632)</span><span class="comment">(1,633)</span><span class="comment">(1,634)</span><span class="comment">(1,635)</span><span class="comment">(1,636)</span><span class="comment">(1,637)</span><span class="comment">(1,638)</span><span class="comment">(1,639)</span><span class="comment">(1,640)</span><span class="comment">(1,641)</span><span class="comment">(1,642)</span><span class="comment">(1,643)</span><span class="comment">(1,644)</span><span class="comment">(1,645)</span><span class="comment">(1,646)</span><span class="comment">(1,647)</span><span class="comment">(1,648)</span><span class="comment">(1,649)</span><span class="comment">(1,650)</span><span class="comment">(1,651)</span><span class="comment">(1,652)</span><span class="comment">(1,653)</span><span class="comment">(1,654)</span><span class="comment">(1,655)</span><span class="comment">(1,656)</span><span class="comment">(1,657)</span><span class="comment">(1,658)</span><span class="comment">(1,659)</span><span class="comment">(1,660)</span><span class="comment">(1,661)</span><span class="comment">(1,662)</span><span class="comment">(1,663)</span><span class="comment">(1,664)</span><span class="comment">(1,665)</span><span class="comment">(1,666)</span><span class="comment">(1,667)</span><span class="comment">(1,668)</span><span class="comment">(1,669)</span><span class="comment">(1,670)</span><span class="comment">(1,671)</span><span class="comment">(1,672)</span><span class="comment">(1,673)</span><span class="comment">(1,674)</span><span class="comment">(1,675)</span><span class="comment">(1,676)</span><span class="comment">(1,677)</span><span class="comment">(1,678)</span><span class="comment">(1,679)</span><span class="comment">(1,680)</span><span class="comment">(1,681)</span><span class="comment">(1,682)</span><span class="comment">(1,683)</span><span class="comment">(1,684)</span><span class="comment">(1,685)</span><span class="comment">(1,686)</span><span class="comment">(1,687)</span><span class="comment">(1,688)</span><span class="comment">(1,689)</span><span class="comment">(1,690)</span><span class="comment">(1,691)</span><span class="comment">(1,692)</span><span class="comment">(1,693)</span><span class="comment">(1,694)</span><span class="comment">(1,695)</span><span class="comment">(1,696)</span><span class="comment">(1,697)</span><span class="comment">(1,698)</span><span class="comment">(1,699)</span><span class="comment">(1,700)</span><span class="comment">(1,701)</span><span class="comment">(1,702)</span><span class="comment">(1,703)</span><span class="comment">(1,704)</span><span class="comment">(1,705)</span><span class="comment">(1,706)</span><span class="comment">(1,707)</span><span class="comment">(1,708)</span><span class="comment">(1,709)</span><span class="comment">(1,710)</span><span class="comment">(1,711)</span><span class="comment">(1,712)</span><span class="comment">(1,713)</span><span class="comment">(1,714)</span><span class="comment">(1,715)</span><span class="comment">(1,716)</span><span class="comment">(1,717)</span><span class="comment">(1,718)</span><span class="comment">(1,719)</span><span class="comment">(1,720)</span><span class="comment">(1,721)</span><span class="comment">(1,722)</span><span class="comment">(1,723)</span><span class="comment">(1,724)</span><span class="comment">(1,725)</span><span class="comment">(1,726)</span><span class="comment">(1,727)</span><span class="comment">(1,728)</span><span class="comment">(1,729)</span><span class="comment">(1,730)</span><span class="comment">(1,731)</span><span class="comment">(1,732)</span><span class="comment">(1,733)</span><span class="comment">(1,734)</span><span class="comment">(1,735)</span><span class="comment">(1,736)</span><span class="comment">(1,737)</span><span class="comment">(1,738)</span><span class="comment">(1,739)</span><span class="comment">(1,740)</span><span class="comment">(1,741)</span><span class="comment">(1,742)</span><span class="comment">(1,743)</span><span class="comment">(1,744)</span><span class="comment">(1,745)</span><span class="comment">(1,746)</span><span class="comment">(1,747)</span><span class="comment">(1,748)</span><span class="comment">(1,749)</span><span class="comment">(1,750)</span><span class="comment">(1,751)</span><span class="comment">(1,752)</span><span class="comment">(1,753)</span><span class="comment">(1,754)</span><span class="comment">(1,755)</span><span class="comment">(1,756)</span><span class="comment">(1,757)</span><span class="comment">(1,758)</span><span class="comment">(1,759)</span><span class="comment">(1,760)</span><span class="comment">(1,761)</span><span class="comment">(1,762)</span><span class="comment">(1,763)</span><span class="comment">(1,764)</span><span class="comment">(1,765)</span><span class="comment">(1,766)</span><span class="comment">(1,767)</span><span class="comment">(1,768)</span><span class="comment">(1,769)</span><span class="comment">(1,770)</span><span class="comment">(1,771)</span><span class="comment">(1,772)</span><span class="comment">(1,773)</span><span class="comment">(1,774)</span><span class="comment">(1,775)</span><span class="comment">(1,776)</span><span class="comment">(1,777)</span><span class="comment">(1,778)</span><span class="comment">(1,779)</span><span class="comment">(1,780)</span><span class="comment">(1,781)</span><span class="comment">(1,782)</span><span class="comment">(1,783)</span><span class="comment">(1,784)</span><span class="comment">(1,785)</span><span class="comment">(1,786)</span><span class="comment">(1,787)</span><span class="comment">(1,788)</span><span class="comment">(1,789)</span><span class="comment">(1,790)</span><span class="comment">(1,791)</span><span class="comment">(1,792)</span><span class="comment">(1,793)</span><span class="comment">(1,794)</span><span class="comment">(1,795)</span><span class="comment">(1,796)</span><span class="comment">(1,797)</span><span class="comment">(1,798)</span><span class="comment">(1,799)</span><span class="comment">(1,800)</span><span class="comment">(1,801)</span><span class="comment">(1,802)</span><span class="comment">(1,803)</span><span class="comment">(1,804)</span><span class="comment">(1,805)</span><span class="comment">(1,806)</span><span class="comment">(1,807)</span><span class="comment">(1,808)</span><span class="comment">(1,809)</span><span class="comment">(1,810)</span><span class="comment">(1,811)</span><span class="comment">(1,812)</span><span class="comment">(1,813)</span><span class="comment">(1,814)</span><span class="comment">(1,815)</span><span class="comment">(1,816)</span><span class="comment">(1,817)</span><span class="comment">(1,818)</span><span class="comment">(1,819)</span><span class="comment">(1,820)</span><span class="comment">(1,821)</span><span class="comment">(1,822)</span><span class="comment">(1,823)</span><span class="comment">(1,824)</span><span class="comment">(1,825)</span><span class="comment">(1,826)</span><span class="comment">(1,827)</span><span class="comment">(1,828)</span><span class="comment">(1,829)</span><span class="comment">(1,830)</span><span class="comment">(1,831)</span><span class="comment">(1,832)</span><span class="comment">(1,833)</span><span class="comment">(1,834)</span><span class="comment">(1,835)</span><span class="comment">(1,836)</span><span class="comment">(1,837)</span><span class="comment">(1,838)</span><span class="comment">(1,839)</span><span class="comment">(1,840)</span><span class="comment">(1,841)</span><span class="comment">(1,842)</span><span class="comment">(1,843)</span><span class="comment">(1,844)</span><span class="comment">(1,845)</span><span class="comment">(1,846)</span><span class="comment">(1,847)</span><span class="comment">(1,848)</span><span class="comment">(1,849)</span><span class="comment">(1,850)</span><span class="comment">(1,851)</span><span class="comment">(1,852)</span><span class="comment">(1,853)</span><span class="comment">(1,854)</span><span class="comment">(1,855)</span><span class="comment">(1,856)</span><span class="comment">(1,857)</span><span class="comment">(1,858)</span><span class="comment">(1,859)</span><span class="comment">(1,860)</span><span class="comment">(1,861)</span><span class="comment">(1,862)</span><span class="comment">(1,863)</span><span class="comment">(1,864)</span><span class="comment">(1,865)</span><span class="comment">(1,866)</span><span class="comment">(1,867)</span><span class="comment">(1,868)</span><span class="comment">(1,869)</span><span class="comment">(1,870)</span><span class="comment">(1,871)</span><span class="comment">(1,872)</span><span class="comment">(1,873)</span><span class="comment">(1,874)</span><span class="comment">(1,875)</span><span class="comment">(1,876)</span><span class="comment">(1,877)</span><span class="comment">(1,878)</span><span class="comment">(1,879)</span><span class="comment">(1,880)</span><span class="comment">(1,881)</span><span class="comment">(1,882)</span><span class="comment">(1,883)</span><span class="comment">(1,884)</span><span class="comment">(1,885)</span><span class="comment">(1,886)</span><span class="comment">(1,887)</span><span class="comment">(1,888)</span><span class="comment">(1,889)</span><span class="comment">(1,890)</span><span class="comment">(1,891)</span><span class="comment">(1,892)</span><span class="comment">(1,893)</span><span class="comment">(1,894)</span><span class="comment">(1,895)</span><span class="comment">(1,896)</span><span class="comment">(1,897)</span><span class="comment">(1,898)</span><span class="comment">(1,899)</span><span class="comment">(1,900)</span><span class="comment">(1,901)</span><span class="comment">(1,902)</span><span class="comment">(1,903)</span><span class="comment">(1,904)</span><span class="comment">(1,905)</span><span class="comment">(1,906)</span><span class="comment">(1,907)</span><span class="comment">(1,908)</span><span class="comment">(1,909)</span><span class="comment">(1,910)</span><span class="comment">(1,911)</span><span class="comment">(1,912)</span><span class="comment">(1,913)</span><span class="comment">(1,914)</span><span class="comment">(1,915)</span><span class="comment">(1,916)</span><span class="comment">(1,917)</span><span class="comment">(1,918)</span><span class="comment">(1,919)</span><span class="comment">(1,920)</span><span class="comment">(1,921)</span><span class="comment">(1,922)</span><span class="comment">(1,923)</span><span class="comment">(1,924)</span><span class="comment">(1,925)</span><span class="comment">(1,926)</span><span class="comment">(1,927)</span><span class="comment">(1,928)</span><span class="comment">(1,929)</span><span class="comment">(1,930)</span><span class="comment">(1,931)</span><span class="comment">(1,932)</span><span class="comment">(1,933)</span><span class="comment">(1,934)</span><span class="comment">(1,935)</span><span class="comment">(1,936)</span><span class="comment">(1,937)</span><span class="comment">(1,938)</span><span class="comment">(1,939)</span><span class="comment">(1,940)</span><span class="comment">(1,941)</span><span class="comment">(1,942)</span><span class="comment">(1,943)</span><span class="comment">(1,944)</span><span class="comment">(1,945)</span><span class="comment">(1,946)</span><span class="comment">(1,947)</span><span class="comment">(1,948)</span><span class="comment">(1,949)</span><span class="comment">(1,950)</span><span class="comment">(1,951)</span><span class="comment">(1,952)</span><span class="comment">(1,953)</span><span class="comment">(1,954)</span><span class="comment">(1,955)</span><span class="comment">(1,956)</span><span class="comment">(1,957)</span><span class="comment">(1,958)</span><span class="comment">(1,959)</span><span class="comment">(1,960)</span><span class="comment">(1,961)</span><span class="comment">(1,962)</span><span class="comment">(1,963)</span><span class="comment">(1,964)</span><span class="comment">(1,965)</span><span class="comment">(1,966)</span><span class="comment">(1,967)</span><span class="comment">(1,968)</span><span class="comment">(1,969)</span><span class="comment">(1,970)</span><span class="comment">(1,971)</span><span class="comment">(1,972)</span><span class="comment">(1,973)</span><span class="comment">(1,974)</span><span class="comment">(1,975)</span><span class="comment">(1,976)</span><span class="comment">(1,977)</span><span class="comment">(1,978)</span><span class="comment">(1,979)</span><span class="comment">(1,980)</span><span class="comment">(1,981)</span><span class="comment">(1,982)</span><span class="comment">(1,983)</span><span class="comment">(1,984)</span><span class="comment">(1,985)</span><span class="comment">(1,986)</span><span class="comment">(1,987)</span><span class="comment">(1,988)</span><span class="comment">(1,989)</span><span class="comment">(1,990)</span><span class="comment">(1,991)</span><span class="comment">(1,992)</span><span class="comment">(1,993)</span><span class="comment">(1,994)</span><span class="comment">(1,995)</span><span class="comment">(1,996)</span><span class="comment">(1,997)</span><span class="comment">(1,998)</span><span class="comment">(1,999)</span><span class="comment">(1,1000)</span><span class="comment">(1,1001)</span><span class="comment">(1,1002)</span><span class="comment">(1,1003)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>flatMap：和Scala里的是一样的</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">scala</span>&gt; test.flatMap(x=&gt;x.to(<span class="number">3</span>)).collect</span><br><span class="line"><span class="attribute">res98</span>: Array[Int] = Array(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>其他的算子</p><p>glom：把每个分区的数据形成一个数组，比mapPartitionWithIndex好用</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">scala</span>&gt; test.glom.collect</span><br><span class="line"><span class="attribute">res62</span>: Array[Array[Int]] = Array(Array(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">17</span>, <span class="number">18</span>, <span class="number">19</span>, <span class="number">20</span>, <span class="number">21</span>, <span class="number">22</span>, <span class="number">23</span>, <span class="number">24</span>, <span class="number">25</span>, <span class="number">26</span>, <span class="number">27</span>, <span class="number">28</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">31</span>, <span class="number">32</span>, <span class="number">33</span>, <span class="number">34</span>, <span class="number">35</span>, <span class="number">36</span>, <span class="number">37</span>, <span class="number">38</span>, <span class="number">39</span>, <span class="number">40</span>, <span class="number">41</span>, <span class="number">42</span>, <span class="number">43</span>, <span class="number">44</span>, <span class="number">45</span>, <span class="number">46</span>, <span class="number">47</span>, <span class="number">48</span>, <span class="number">49</span>, <span class="number">50</span>, <span class="number">51</span>, <span class="number">52</span>, <span class="number">53</span>, <span class="number">54</span>, <span class="number">55</span>, <span class="number">56</span>, <span class="number">57</span>, <span class="number">58</span>, <span class="number">59</span>, <span class="number">60</span>, <span class="number">61</span>, <span class="number">62</span>, <span class="number">63</span>, <span class="number">64</span>, <span class="number">65</span>, <span class="number">66</span>, <span class="number">67</span>, <span class="number">68</span>, <span class="number">69</span>, <span class="number">70</span>, <span class="number">71</span>, <span class="number">72</span>, <span class="number">73</span>, <span class="number">74</span>, <span class="number">75</span>, <span class="number">76</span>, <span class="number">77</span>, <span class="number">78</span>, <span class="number">79</span>, <span class="number">80</span>, <span class="number">81</span>, <span class="number">82</span>, <span class="number">83</span>, <span class="number">84</span>, <span class="number">85</span>, <span class="number">86</span>, <span class="number">87</span>, <span class="number">88</span>, <span class="number">89</span>, <span class="number">90</span>, <span class="number">91</span>, <span class="number">92</span>, <span class="number">93</span>, <span class="number">94</span>, <span class="number">95</span>, <span class="number">96</span>, <span class="number">97</span>, <span class="number">98</span>, <span class="number">99</span>, <span class="number">100</span>, <span class="number">101</span>, <span class="number">102</span>, <span class="number">103</span>, <span class="number">104</span>, <span class="number">105</span>, <span class="number">106</span>, <span class="number">107</span>, <span class="number">108</span>, <span class="number">109</span>, <span class="number">110</span>, <span class="number">111</span>, <span class="number">112</span>, <span class="number">113</span>, <span class="number">114</span>, <span class="number">115</span>, <span class="number">116</span>, <span class="number">117</span>, <span class="number">118</span>, <span class="number">119</span>, <span class="number">120</span>, <span class="number">121</span>, <span class="number">122</span>, <span class="number">123</span>, <span class="number">124</span>, <span class="number">125</span>, <span class="number">126</span>, <span class="number">127</span>, <span class="number">128</span>, <span class="number">129</span>, <span class="number">130</span>, <span class="number">131</span>, <span class="number">132</span>, <span class="number">133</span>, <span class="number">134</span>, <span class="number">135</span>, <span class="number">136</span>, <span class="number">137</span>, <span class="number">138</span>, <span class="number">139</span>, <span class="number">140</span>, <span class="number">141</span>, <span class="number">142</span>, <span class="number">143</span>, <span class="number">144</span>, <span class="number">145</span>, <span class="number">146</span>, <span class="number">147</span>, <span class="number">148</span>, <span class="number">149</span>, <span class="number">150</span>, <span class="number">151</span>, <span class="number">152</span>, <span class="number">153</span>, <span class="number">154</span>, <span class="number">155</span>, <span class="number">156</span>, <span class="number">157</span>, <span class="number">158</span>, <span class="number">159</span>, <span class="number">160</span>, <span class="number">161</span>, <span class="number">162</span>, <span class="number">163</span>, <span class="number">164</span>, <span class="number">165</span>, <span class="number">166</span>, <span class="number">167</span>, <span class="number">168</span>, ...</span><br></pre></td></tr></table></figure><p>sample：抽样，随机抽样的</p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">scala</span>&gt; (<span class="keyword">test</span>.<span class="keyword">sample</span>(false,0.77)).collect.<span class="keyword">foreach</span>(<span class="keyword">print</span>)</span><br><span class="line">236781112141516182022232425262728303132333435363738394041434446474850515254555657596061626364666768697172747576777879818285868789919293969798991001011021031041051061071081091101111121131161181191201211221241251271281301311321331341351361371381391401411441461471491501531541551561611621631641651661671681691701711721731741751761781791801811831841861871891901911931951961971982002012022042052072082092112122132142162172182202212222242252262272282302322332352362372382402412432442452472482502512522532542552562572582602612632642652662672682692702712732742752762772782812822832842892902922932942952962972982993003013023033043053063073083093113123133143153163173183193203213223233263293303313323333343353363373383393403413423443463473483493513523543573583593603613623633663673683693703713723743763773783793803813823833873903913923943954004014024034044054074084094114124134144154164174184194224234244264274284294304314324334344354364374384394404414424454464494504514524534544554564574584604614634644654664674684694714724744754764794804814824834844854864874884904914924934944954974984995005015025065075085105115125135145165175185195225235245255265275295305315325355375385395405415425445455465475485495515525545565575585595605625635645655675685715735755765795805815825835845855895905925935955965975985996016026036046066086096106116126136146156166176206216226236246256266276296316326336346356366376386396406416436446456466476486496506516536546556576586596606616626636646676696706716726736746756766776796806816836846856866876896906916926936946976986997007037047057067087097107117127157167177187197217227237267277297307327337347357367377387417427447457467477487497517527537547557567577587597607627637667677697707727737747757777787797807817827837847867887897907917937957967987998018028038048058068078098108128138148178198208228248258268278288308318328348358368378388408418428438458468478488498508528538548558588598608618628638648658668678688698708718758768778788798808828838848878888898908918958988999009019029039049059069079099129149159179189199209219229249259269279289299309319329339349359369379389399419429439449469489499509519549559569589599609619629639649659679689699709729749759769799809819829839859869879889899909919939949969979989991000</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>union：简单的数据合并，不去重</p><p>intersection：两个rdd的交集</p><p>subtract：出现在a里的没有出现在b里</p><p>.collect:把结果以数组的形式转到控制台</p><p>distinct：去重和sql效果一样 &#x3D;》 底层去重的方法是用reduceByKey进行去重的目的</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">scala&gt; val <span class="selector-tag">dd</span> = sc<span class="selector-class">.parallelize</span>(<span class="built_in">List</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>))</span><br><span class="line"><span class="selector-tag">dd</span>: org<span class="selector-class">.apache</span><span class="selector-class">.spark</span><span class="selector-class">.rdd</span><span class="selector-class">.RDD</span><span class="selector-attr">[Int]</span> = ParallelCollectionRDD<span class="selector-attr">[28]</span> at parallelize at &lt;console&gt;:<span class="number">24</span></span><br><span class="line"></span><br><span class="line">scala&gt; <span class="selector-tag">dd</span><span class="selector-class">.collect</span><span class="selector-class">.foreach</span>(print)</span><br><span class="line"><span class="number">122345678</span></span><br><span class="line">scala&gt; <span class="selector-tag">dd</span><span class="selector-class">.collect</span><span class="selector-class">.foreach</span>(println)</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">5</span></span><br><span class="line"><span class="number">6</span></span><br><span class="line"><span class="number">7</span></span><br><span class="line"><span class="number">8</span></span><br><span class="line"></span><br><span class="line">scala&gt; <span class="selector-tag">dd</span><span class="selector-class">.distinct</span><span class="selector-class">.collect</span><span class="selector-class">.foreach</span>(println)</span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">6</span></span><br><span class="line"><span class="number">8</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">7</span></span><br><span class="line"><span class="number">5</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>kv算子 ： groupbykey &#x3D;》 就是对key进行分组，和wordcount里的分组是一样的&#x3D;》工作中不要使用，效率低，不灵活</p><p>预聚合：</p><ul><li>mr ： input &#x3D; &gt; map &#x3D;&gt; combine(调优的过程) &#x3D;&gt; reduce &#x3D;&gt; output</li><li>combine &#x3D;&gt; 预聚合 按照map的输出的key进行数据聚合</li></ul><p>mapSideCombine &#x3D; false 代表预聚合关闭</p><p>一般groupbykey是关闭预聚合的，reducebykey是开启的</p><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">scala&gt; test<span class="number">1.</span>collect</span><br><span class="line">res<span class="number">25</span>: Array[<span class="comment">(Int, Int)</span>] = Array<span class="comment">((0,1)</span>, <span class="comment">(0,2)</span>, <span class="comment">(0,3)</span>, <span class="comment">(0,4)</span>, <span class="comment">(0,5)</span>, <span class="comment">(0,6)</span>, <span class="comment">(0,7)</span>, <span class="comment">(0,8)</span>, <span class="comment">(0,9)</span>, <span class="comment">(0,10)</span>, <span class="comment">(0,11)</span>, <span class="comment">(0,12)</span>, <span class="comment">(0,13)</span>, <span class="comment">(0,14)</span>, <span class="comment">(0,15)</span>, <span class="comment">(0,16)</span>, <span class="comment">(0,17)</span>, <span class="comment">(0,18)</span>, <span class="comment">(0,19)</span>, <span class="comment">(0,20)</span>, <span class="comment">(0,21)</span>, <span class="comment">(0,22)</span>, <span class="comment">(0,23)</span>, <span class="comment">(0,24)</span>, <span class="comment">(0,25)</span>, <span class="comment">(0,26)</span>, <span class="comment">(0,27)</span>, <span class="comment">(0,28)</span>, <span class="comment">(0,29)</span>, <span class="comment">(0,30)</span>, <span class="comment">(0,31)</span>, <span class="comment">(0,32)</span>, <span class="comment">(0,33)</span>, <span class="comment">(0,34)</span>, <span class="comment">(0,35)</span>, <span class="comment">(0,36)</span>, <span class="comment">(0,37)</span>, <span class="comment">(0,38)</span>, <span class="comment">(0,39)</span>, <span class="comment">(0,40)</span>, <span class="comment">(0,41)</span>, <span class="comment">(0,42)</span>, <span class="comment">(0,43)</span>, <span class="comment">(0,44)</span>, <span class="comment">(0,45)</span>, <span class="comment">(0,46)</span>, <span class="comment">(0,47)</span>, <span class="comment">(0,48)</span>, <span class="comment">(0,49)</span>, <span class="comment">(0,50)</span>, <span class="comment">(0,51)</span>, <span class="comment">(0,52)</span>, <span class="comment">(0,53)</span>, <span class="comment">(0,54)</span>, <span class="comment">(0,55)</span>, <span class="comment">(0,56)</span>, <span class="comment">(0,57)</span>, <span class="comment">(0,58)</span>, <span class="comment">(0,59)</span>, <span class="comment">(0,60)</span>, <span class="comment">(0,61)</span>, <span class="comment">(0,62)</span>, <span class="comment">(0,63)</span>, <span class="comment">(0,64)</span>, <span class="comment">(0,65)</span>, <span class="comment">(0,66)</span>, <span class="comment">(0,67)</span>, <span class="comment">(0,68)</span>, <span class="comment">(0,69)</span>, <span class="comment">(0,70)</span>, <span class="comment">(0,71)</span>, <span class="comment">(0,72)</span>, <span class="comment">(0,73)</span>, <span class="comment">(0,74)</span>, <span class="comment">(0,75)</span>, <span class="comment">(0,76)</span>, <span class="comment">(0,77)</span>, <span class="comment">(0,78)</span>, <span class="comment">(0,79)</span>, <span class="comment">(0,80)</span>, <span class="comment">(0,81)</span>, <span class="comment">(0,82)</span>, <span class="comment">(0,83)</span>, <span class="comment">(0,84)</span>, <span class="comment">(0,85)</span>, <span class="comment">(0,86)</span>, <span class="comment">(0,87)</span>, <span class="comment">(0,88)</span>, <span class="comment">(0,89)</span>, <span class="comment">(0,90)</span>, <span class="comment">(0,91)</span>, <span class="comment">(0,92)</span>, <span class="comment">(0,93)</span>, <span class="comment">(0,...</span></span><br><span class="line"><span class="comment">scala&gt; test1.groupByKey.collect.foreach(print)</span></span><br><span class="line"><span class="comment">(0,CompactBuffer(1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123, 124, 125, 126, 127, 128, 129, 130, 131, 132, 133, 134, 135, 136, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147, 148, 149, 150, 151, 152, 153, 154, 155, 156, 157, 158, 159, 160, 161, 162, 163, 164, 165, 166, 167, 168, 169, 170, 171, 172, 173, 174, 175, 176, 177, 178, 179, 180, 181, 182, 183, 184, 185, 186, 187, 188, 189, 190, 191, 192, 193, 194, 195, 196, 197, 198, 199, 200, 201, 202, 203, 204, 205, 206, 207, 208, 209, 210, 211, 212, 213, 214, 215, 216, 217, 218, 219, 220, 221, 222, 223, 224, 225, 226, 227, 228, 229, 230, 231, 232, 233, 234, 235, 236, 237, 238, 239, 240, 241, 242, 243, 244, 245, 246, 247, 248, 249, 250, 251, 252, 253, 254, 255, 256, 257, 258, 259, 260, 261, 262, 263, 264, 265, 266, 267, 268, 269, 270, 271, 272, 273, 274, 275, 276, 277, 278, 279, 280, 281, 282, 283, 284, 285, 286, 287, 288, 289, 290, 291, 292, 293, 294, 295, 296, 297, 298, 299, 300, 301, 302, 303, 304, 305, 306, 307, 308, 309, 310, 311, 312, 313, 314, 315, 316, 317, 318, 319, 320, 321, 322, 323, 324, 325, 326, 327, 328, 329, 330, 331, 332, 333, 334, 335, 336, 337, 338, 339, 340, 341, 342, 343, 344, 345, 346, 347, 348, 349, 350, 351, 352, 353, 354, 355, 356, 357, 358, 359, 360, 361, 362, 363, 364, 365, 366, 367, 368, 369, 370, 371, 372, 373, 374, 375, 376, 377, 378, 379, 380, 381, 382, 383, 384, 385, 386, 387, 388, 389, 390, 391, 392, 393, 394, 395, 396, 397, 398, 399, 400, 401, 402, 403, 404, 405, 406, 407, 408, 409, 410, 411, 412, 413, 414, 415, 416, 417, 418, 419, 420, 421, 422, 423, 424, 425, 426, 427, 428, 429, 430, 431, 432, 433, 434, 435, 436, 437, 438, 439, 440, 441, 442, 443, 444, 445, 446, 447, 448, 449, 450, 451, 452, 453, 454, 455, 456, 457, 458, 459, 460, 461, 462, 463, 464, 465, 466, 467, 468, 469, 470, 471, 472, 473, 474, 475, 476, 477, 478, 479, 480, 481, 482, 483, 484, 485, 486, 487, 488, 489, 490, 491, 492, 493, 494, 495, 496, 497, 498, 499, 500)</span>)<span class="comment">(1,CompactBuffer(501, 502, 503, 504, 505, 506, 507, 508, 509, 510, 511, 512, 513, 514, 515, 516, 517, 518, 519, 520, 521, 522, 523, 524, 525, 526, 527, 528, 529, 530, 531, 532, 533, 534, 535, 536, 537, 538, 539, 540, 541, 542, 543, 544, 545, 546, 547, 548, 549, 550, 551, 552, 553, 554, 555, 556, 557, 558, 559, 560, 561, 562, 563, 564, 565, 566, 567, 568, 569, 570, 571, 572, 573, 574, 575, 576, 577, 578, 579, 580, 581, 582, 583, 584, 585, 586, 587, 588, 589, 590, 591, 592, 593, 594, 595, 596, 597, 598, 599, 600, 601, 602, 603, 604, 605, 606, 607, 608, 609, 610, 611, 612, 613, 614, 615, 616, 617, 618, 619, 620, 621, 622, 623, 624, 625, 626, 627, 628, 629, 630, 631, 632, 633, 634, 635, 636, 637, 638, 639, 640, 641, 642, 643, 644, 645, 646, 647, 648, 649, 650, 651, 652, 653, 654, 655, 656, 657, 658, 659, 660, 661, 662, 663, 664, 665, 666, 667, 668, 669, 670, 671, 672, 673, 674, 675, 676, 677, 678, 679, 680, 681, 682, 683, 684, 685, 686, 687, 688, 689, 690, 691, 692, 693, 694, 695, 696, 697, 698, 699, 700, 701, 702, 703, 704, 705, 706, 707, 708, 709, 710, 711, 712, 713, 714, 715, 716, 717, 718, 719, 720, 721, 722, 723, 724, 725, 726, 727, 728, 729, 730, 731, 732, 733, 734, 735, 736, 737, 738, 739, 740, 741, 742, 743, 744, 745, 746, 747, 748, 749, 750, 751, 752, 753, 754, 755, 756, 757, 758, 759, 760, 761, 762, 763, 764, 765, 766, 767, 768, 769, 770, 771, 772, 773, 774, 775, 776, 777, 778, 779, 780, 781, 782, 783, 784, 785, 786, 787, 788, 789, 790, 791, 792, 793, 794, 795, 796, 797, 798, 799, 800, 801, 802, 803, 804, 805, 806, 807, 808, 809, 810, 811, 812, 813, 814, 815, 816, 817, 818, 819, 820, 821, 822, 823, 824, 825, 826, 827, 828, 829, 830, 831, 832, 833, 834, 835, 836, 837, 838, 839, 840, 841, 842, 843, 844, 845, 846, 847, 848, 849, 850, 851, 852, 853, 854, 855, 856, 857, 858, 859, 860, 861, 862, 863, 864, 865, 866, 867, 868, 869, 870, 871, 872, 873, 874, 875, 876, 877, 878, 879, 880, 881, 882, 883, 884, 885, 886, 887, 888, 889, 890, 891, 892, 893, 894, 895, 896, 897, 898, 899, 900, 901, 902, 903, 904, 905, 906, 907, 908, 909, 910, 911, 912, 913, 914, 915, 916, 917, 918, 919, 920, 921, 922, 923, 924, 925, 926, 927, 928, 929, 930, 931, 932, 933, 934, 935, 936, 937, 938, 939, 940, 941, 942, 943, 944, 945, 946, 947, 948, 949, 950, 951, 952, 953, 954, 955, 956, 957, 958, 959, 960, 961, 962, 963, 964, 965, 966, 967, 968, 969, 970, 971, 972, 973, 974, 975, 976, 977, 978, 979, 980, 981, 982, 983, 984, 985, 986, 987, 988, 989, 990, 991, 992, 993, 994, 995, 996, 997, 998, 999, 1000)</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>reducebykey：对比groupby是相当于可以统计之后进行计算的</p><figure class="highlight moonscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">scala&gt; test1.reduceByKey(<span class="function"><span class="params">(x,y)</span>=&gt;</span>&#123;x+y&#125;).collect.foreach(<span class="built_in">print</span>)</span><br><span class="line">(<span class="number">0</span>,<span class="number">125250</span>)(<span class="number">1</span>,<span class="number">375250</span>)</span><br><span class="line"><span class="comment">--------------------------------------其中的x+y代表拉完成之后，对他们进行相加</span></span><br><span class="line"><span class="comment">--------------------------------------通过reduceByKey实现distinct</span></span><br><span class="line">scala&gt; test1.reduceByKey(<span class="function"><span class="params">(x,_)</span>=&gt;</span>&#123;x&#125;).map(_._1).collect.foreach(println)</span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>groupby：自定义分组</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">scala</span>&gt; test.groupBy(x=&gt;&#123;if(x%<span class="number">2</span>==<span class="number">0</span>)&#123;<span class="string">&quot;2e&quot;</span>&#125;else&#123;<span class="string">&quot;e2&quot;</span>&#125;&#125;).collect</span><br><span class="line"><span class="attribute">res99</span>: Array[(String, Iterable[Int])] = Array((e2,CompactBuffer(<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">11</span>, <span class="number">13</span>, <span class="number">15</span>, <span class="number">17</span>, <span class="number">19</span>, <span class="number">21</span>, <span class="number">23</span>, <span class="number">25</span>, <span class="number">27</span>, <span class="number">29</span>, <span class="number">31</span>, <span class="number">33</span>, <span class="number">35</span>, <span class="number">37</span>, <span class="number">39</span>, <span class="number">41</span>, <span class="number">43</span>, <span class="number">45</span>, <span class="number">47</span>, <span class="number">49</span>, <span class="number">51</span>, <span class="number">53</span>, <span class="number">55</span>, <span class="number">57</span>, <span class="number">59</span>, <span class="number">61</span>, <span class="number">63</span>, <span class="number">65</span>, <span class="number">67</span>, <span class="number">69</span>, <span class="number">71</span>, <span class="number">73</span>, <span class="number">75</span>, <span class="number">77</span>, <span class="number">79</span>, <span class="number">81</span>, <span class="number">83</span>, <span class="number">85</span>, <span class="number">87</span>, <span class="number">89</span>, <span class="number">91</span>, <span class="number">93</span>, <span class="number">95</span>, <span class="number">97</span>, <span class="number">99</span>, <span class="number">101</span>, <span class="number">103</span>, <span class="number">105</span>, <span class="number">107</span>, <span class="number">109</span>, <span class="number">111</span>, <span class="number">113</span>, <span class="number">115</span>, <span class="number">117</span>, <span class="number">119</span>, <span class="number">121</span>, <span class="number">123</span>, <span class="number">125</span>, <span class="number">127</span>, <span class="number">129</span>, <span class="number">131</span>, <span class="number">133</span>, <span class="number">135</span>, <span class="number">137</span>, <span class="number">139</span>, <span class="number">141</span>, <span class="number">143</span>, <span class="number">145</span>, <span class="number">147</span>, <span class="number">149</span>, <span class="number">151</span>, <span class="number">153</span>, <span class="number">155</span>, <span class="number">157</span>, <span class="number">159</span>, <span class="number">161</span>, <span class="number">163</span>, <span class="number">165</span>, <span class="number">167</span>, <span class="number">169</span>, <span class="number">171</span>, <span class="number">173</span>, <span class="number">175</span>, <span class="number">177</span>, <span class="number">179</span>, <span class="number">181</span>, <span class="number">183</span>, <span class="number">185</span>, <span class="number">187</span>, <span class="number">189</span>, <span class="number">191</span>, <span class="number">193</span>, <span class="number">195</span>, <span class="number">197</span>, <span class="number">199</span>, <span class="number">201</span>, <span class="number">203</span>, <span class="number">205</span>, <span class="number">207</span>, <span class="number">209</span>, <span class="number">211</span>, <span class="number">213</span>, <span class="number">215</span>, <span class="number">217</span>, <span class="number">219</span>, <span class="number">221</span>, <span class="number">223</span>, <span class="number">225</span>, <span class="number">227</span>, <span class="number">229</span>, <span class="number">231</span>, <span class="number">233</span>, <span class="number">235</span>, <span class="number">237</span>, <span class="number">239</span>, <span class="number">241</span>, <span class="number">243</span>, <span class="number">245</span>, <span class="number">247</span>, <span class="number">249</span>, <span class="number">251</span>, <span class="number">253</span>, <span class="number">255</span>, <span class="number">257</span>, <span class="number">259</span>, <span class="number">261</span>, <span class="number">263</span>, <span class="number">265</span>, <span class="number">267</span>, <span class="number">269</span>, <span class="number">271</span>, <span class="number">273</span>, <span class="number">275</span>, <span class="number">277</span>, <span class="number">279</span>, <span class="number">281</span>, <span class="number">283</span>, <span class="number">285</span>, <span class="number">287</span>, <span class="number">289</span>, <span class="number">291</span>, <span class="number">293</span>, <span class="number">295</span>, <span class="number">297</span>, <span class="number">299</span>, <span class="number">301</span>, <span class="number">303</span>, <span class="number">30</span>...</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>sortbykey：按照key进行排序，分区排序，如果想达到全局排序，则要求你rdd里的只有一个的分区，降序就是把true变成false</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">scala&gt; val r2 = sc<span class="selector-class">.parallelize</span>(<span class="built_in">List</span>((<span class="string">&quot;zuan&quot;</span>,<span class="number">18</span>),(<span class="string">&quot;kaige&quot;</span>,<span class="number">20</span>),(<span class="string">&quot;zihang&quot;</span>,<span class="number">21</span>)),<span class="number">1</span>)</span><br><span class="line">r2: org<span class="selector-class">.apache</span><span class="selector-class">.spark</span><span class="selector-class">.rdd</span><span class="selector-class">.RDD</span><span class="selector-attr">[(String, Int)]</span> = ParallelCollectionRDD<span class="selector-attr">[69]</span> at parallelize at &lt;console&gt;:<span class="number">24</span></span><br><span class="line"></span><br><span class="line">scala&gt; r2<span class="selector-class">.sortByKey</span>(true)</span><br><span class="line">res89: org<span class="selector-class">.apache</span><span class="selector-class">.spark</span><span class="selector-class">.rdd</span><span class="selector-class">.RDD</span><span class="selector-attr">[(String, Int)]</span> = ShuffledRDD<span class="selector-attr">[70]</span> at sortByKey at &lt;console&gt;:<span class="number">25</span></span><br><span class="line"></span><br><span class="line">scala&gt; res89<span class="selector-class">.collect</span></span><br><span class="line">res90: Array<span class="selector-attr">[(String, Int)]</span> = <span class="built_in">Array</span>((kaige,<span class="number">20</span>), (zihang,<span class="number">21</span>), (zuan,<span class="number">18</span>))</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>自定义排序：sortby</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">scala&gt; r2.sort<span class="constructor">By(<span class="params">x</span>=&gt;<span class="params">x</span>.<span class="params">_2</span>,<span class="params">true</span>)</span>.collect</span><br><span class="line">res92: Array<span class="literal">[(S<span class="identifier">tring</span>, I<span class="identifier">nt</span>)]</span> = <span class="constructor">Array((<span class="params">zuan</span>,18)</span>, (kaige,<span class="number">20</span>), (zihang,<span class="number">21</span>))</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>join：他默认就是按照key进行关联的&#x3D;》底层调用的是cogroup</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">scala&gt; val r3 = sc<span class="selector-class">.parallelize</span>(<span class="built_in">List</span>((<span class="string">&quot;zuan&quot;</span>,<span class="string">&quot;广西&quot;</span>),(<span class="string">&quot;kaige&quot;</span>,<span class="string">&quot;中国&quot;</span>),(<span class="string">&quot;zihang&quot;</span>,<span class="string">&quot;黑龙江&quot;</span>)))</span><br><span class="line">r3: org<span class="selector-class">.apache</span><span class="selector-class">.spark</span><span class="selector-class">.rdd</span><span class="selector-class">.RDD</span><span class="selector-attr">[(String, String)]</span> = ParallelCollectionRDD<span class="selector-attr">[77]</span> at parallelize at &lt;console&gt;:<span class="number">24</span></span><br><span class="line"></span><br><span class="line">scala&gt; r1<span class="selector-class">.join</span>(r3)<span class="selector-class">.collect</span></span><br><span class="line">res93: Array<span class="selector-attr">[(String, (Int, String))]</span> = <span class="built_in">Array</span>((zuan,(<span class="number">18</span>,广西)), (kaige,(<span class="number">20</span>,中国)), (zihang,(<span class="number">21</span>,黑龙江)))</span><br><span class="line"></span><br><span class="line">-----------------------<span class="attr">--cogroup</span></span><br><span class="line">scala&gt; r1<span class="selector-class">.cogroup</span>(r3)<span class="selector-class">.collect</span></span><br><span class="line">res94: Array<span class="selector-attr">[(String, (Iterable[Int]</span>, Iterable<span class="selector-attr">[String]</span>))] = <span class="built_in">Array</span>((zuan,(<span class="built_in">CompactBuffer</span>(<span class="number">18</span>),<span class="built_in">CompactBuffer</span>(广西))), (kaige,(<span class="built_in">CompactBuffer</span>(<span class="number">20</span>),<span class="built_in">CompactBuffer</span>(中国))), (zihang,(<span class="built_in">CompactBuffer</span>(<span class="number">21</span>),<span class="built_in">CompactBuffer</span>(黑龙江))))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>都是根据key进行关联</p><p>但是cogroup的返回是集合当作value的</p><p>join则是返回的是值当value</p><p>分区规则：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">分区号：0，元素是4 4%<span class="attribute">4</span>=0</span><br><span class="line">分区号：1，元素是9 9%<span class="attribute">4</span>=1</span><br></pre></td></tr></table></figure><p>action算子：会执行job的算子</p><p>collect&#x3D;》把rdd的数据集拉回控制台 &#x3D; 》driver端</p><p>foreach</p><p>foreachpartition：对每个分区进行处理&#x3D;》首选的mysql数据集导入是它，因为获取mysql的次数能少一点</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">  def foreach<span class="constructor">Partition(<span class="params">f</span>: Iterator[T] =&gt; Unit)</span>: Unit = withScope &#123;</span><br><span class="line">    <span class="keyword">val</span> cleanF = sc.clean(f)</span><br><span class="line">    sc.run<span class="constructor">Job(<span class="params">this</span>, (<span class="params">iter</span>: Iterator[T])</span> =&gt; clean<span class="constructor">F(<span class="params">iter</span>)</span>)</span><br><span class="line">  &#125;</span><br><span class="line">-----------------------------------使用</span><br><span class="line">scala&gt; test.foreach<span class="constructor">Partition(<span class="params">ax</span>=&gt;<span class="params">ax</span>.<span class="params">foreach</span>(<span class="params">print</span>)</span>)</span><br><span class="line"><span class="number">1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798991001011021031041051061071081091101111121131141151161171181191201211221231241251261271281291301311321331341351361371381391401411421431441451461471481491501511521531541551561571581591601611621631641651661671681691701711721731741751761771781791801811821831841851861871881891901911921931941951961971981992002012022032042052062072082092102112122132142152162172182192202212222232242252262272282292302312322332342352362372382392402412422432442452462472482492502512522532542552562572582592602612622632642652662672682692702712722732742752762772782792802812822832842852862872882892902912922932942952962972982993003013023033043053063073083093103113123133143153163173183193203213223233243253263273283293303313323333343353363373383393403413423433443453463473483493503513523533543553563573583593603613623633643653663673683693703713723733743753763773783793803813823833843853863873883893903913923933943953963973983994004014024034044054064074084094104114124134144154164174184194204214224234244254264274284294304314324334344354364374384394404414424434444454464474484494504514524534544554564574584594604614624634644654664674684694704714724734744754764774784794804814824834844854864874884894904914924934944954964974984995005015025035045055065075085095105115125135145155165175185195205215225235245255265275285295305315325335345355365375385395405415425435445455465475485495505515525535545555565575585595605615625635645655665675685695705715725735745755765775785795805815825835845855865875885895905915925935945955965975985996006016026036046056066076086096106116126136146156166176186196206216226236246256266276286296306316326336346356366376386396406416426436446456466476486496506516526536546556566576586596606616626636646656666676686696706716726736746756766776786796806816826836846856866876886896906916926936946956966976986997007017027037047057067077087097107117127137147157167177187197207217227237247257267277287297307317327337347357367377387397407417427437447457467477487497507517527537547557567577587597607617627637647657667677687697707717727737747757767777787797807817827837847857867877887897907917927937947957967977987998008018028038048058068078088098108118128138148158168178188198208218228238248258268278288298308318328338348358368378388398408418428438448458468478488498508518528538548558568578588598608618628638648658668678688698708718728738748758768778788798808818828838848858868878888898908918928938948958968978988999009019029039049059069079089099109119129139149159169179189199209219229239249259269279289299309319329339349359369379389399409419429439449459469479489499509519529539549559569579589599609619629639649659669679689699709719729739749759769779789799809819829839849859869879889899909919929939949959969979989991000</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>reduce：mr里的reduce，这里不可以接collect，因为已经完成了</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">scala&gt; test.<span class="built_in">reduce</span>(<span class="function">(<span class="params">x,y</span>)=&gt;</span>x+y)</span><br><span class="line">res108: Int = <span class="number">500500</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>first：取出数据集里的第一个元素底层是take</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">scala<span class="operator">&gt;</span> test.first()</span><br><span class="line">res109: <span class="type">Int</span> <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"><span class="comment">-------------------------take</span></span><br><span class="line">scala<span class="operator">&gt;</span> test.take(<span class="number">77</span>)</span><br><span class="line">res112: <span class="keyword">Array</span>[<span class="type">Int</span>] <span class="operator">=</span> <span class="keyword">Array</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">17</span>, <span class="number">18</span>, <span class="number">19</span>, <span class="number">20</span>, <span class="number">21</span>, <span class="number">22</span>, <span class="number">23</span>, <span class="number">24</span>, <span class="number">25</span>, <span class="number">26</span>, <span class="number">27</span>, <span class="number">28</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">31</span>, <span class="number">32</span>, <span class="number">33</span>, <span class="number">34</span>, <span class="number">35</span>, <span class="number">36</span>, <span class="number">37</span>, <span class="number">38</span>, <span class="number">39</span>, <span class="number">40</span>, <span class="number">41</span>, <span class="number">42</span>, <span class="number">43</span>, <span class="number">44</span>, <span class="number">45</span>, <span class="number">46</span>, <span class="number">47</span>, <span class="number">48</span>, <span class="number">49</span>, <span class="number">50</span>, <span class="number">51</span>, <span class="number">52</span>, <span class="number">53</span>, <span class="number">54</span>, <span class="number">55</span>, <span class="number">56</span>, <span class="number">57</span>, <span class="number">58</span>, <span class="number">59</span>, <span class="number">60</span>, <span class="number">61</span>, <span class="number">62</span>, <span class="number">63</span>, <span class="number">64</span>, <span class="number">65</span>, <span class="number">66</span>, <span class="number">67</span>, <span class="number">68</span>, <span class="number">69</span>, <span class="number">70</span>, <span class="number">71</span>, <span class="number">72</span>, <span class="number">73</span>, <span class="number">74</span>, <span class="number">75</span>, <span class="number">76</span>, <span class="number">77</span>)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>takeOrderd:升序获取前n个</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">scala</span>&gt; test.takeOrdered(<span class="number">2</span>)</span><br><span class="line"><span class="attribute">res127</span>: Array[Int] = Array(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="attribute">scala</span>&gt; test.takeOrdered(<span class="number">55</span>)</span><br><span class="line"><span class="attribute">res128</span>: Array[Int] = Array(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">17</span>, <span class="number">18</span>, <span class="number">19</span>, <span class="number">20</span>, <span class="number">21</span>, <span class="number">22</span>, <span class="number">23</span>, <span class="number">24</span>, <span class="number">25</span>, <span class="number">26</span>, <span class="number">27</span>, <span class="number">28</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">31</span>, <span class="number">32</span>, <span class="number">33</span>, <span class="number">34</span>, <span class="number">35</span>, <span class="number">36</span>, <span class="number">37</span>, <span class="number">38</span>, <span class="number">39</span>, <span class="number">40</span>, <span class="number">41</span>, <span class="number">42</span>, <span class="number">43</span>, <span class="number">44</span>, <span class="number">45</span>, <span class="number">46</span>, <span class="number">47</span>, <span class="number">48</span>, <span class="number">49</span>, <span class="number">50</span>, <span class="number">51</span>, <span class="number">52</span>, <span class="number">53</span>, <span class="number">54</span>, <span class="number">55</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>top:就是取排名前几的数据底层是takeOrederd&#x3D;》数据量比较小的时候可以使用</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">scala</span>&gt; test.top(<span class="number">1</span>)</span><br><span class="line"><span class="attribute">res113</span>: Array[Int] = Array(<span class="number">1000</span>)</span><br><span class="line"></span><br><span class="line"><span class="attribute">scala</span>&gt; test.top(<span class="number">5</span>)</span><br><span class="line"><span class="attribute">res114</span>: Array[Int] = Array(<span class="number">1000</span>, <span class="number">999</span>, <span class="number">998</span>, <span class="number">997</span>, <span class="number">996</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>saveASTextFile</p><p>saveASSequenceFile</p><p>saveAsObjectFile</p><p>countByKey:统计key的个数</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">scala&gt; test1<span class="selector-class">.countByKey</span></span><br><span class="line">res125: scala<span class="selector-class">.collection</span><span class="selector-class">.Map</span><span class="selector-attr">[Int,Long]</span> = <span class="built_in">Map</span>(<span class="number">0</span> -&gt; <span class="number">500</span>, <span class="number">1</span> -&gt; <span class="number">500</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>collectAsMap：和countByKey有点类似</p><p>count:返回rdd里有多少个数</p><p>判断action算子和普通算子的方法&#x3D;》源码底层有runjob</p><p>&#x3D;》调用collect&#x2F;其他action算子</p><h3 id="案例："><a href="#案例：" class="headerlink" title="案例："></a>案例：</h3><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">一张表：</span><br><span class="line">name price num</span><br><span class="line">diar<span class="number"> 300 </span>1000</span><br><span class="line">香奈儿<span class="number"> 4000 </span>2</span><br><span class="line">螺蛳粉<span class="number"> 200 </span>98</span><br><span class="line">30显卡<span class="number"> 200 </span>10</span><br><span class="line">-----------------------------------------------按照价格进行排序【desc】，如果价格相同，按照库存排序【asc】</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>解决：</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">数据类型：tuple【推荐】 ， <span class="class"><span class="keyword">class</span> <span class="title">，</span> <span class="title">case</span> <span class="title">class【推荐】</span></span></span><br><span class="line">用tuple做</span><br><span class="line">-----------------------------------------------------------------</span><br><span class="line">    <span class="keyword">val</span> value = sc.parallelize(<span class="type">List</span>(<span class="string">&quot;diar 300 1000&quot;</span>,</span><br><span class="line">      <span class="string">&quot;香奈儿 4000 2&quot;</span>,</span><br><span class="line">      <span class="string">&quot;螺蛳粉 200 98&quot;</span>,</span><br><span class="line">      <span class="string">&quot;30显卡 200 10&quot;</span>)，<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> etlData = value.map(x=&gt;&#123;</span><br><span class="line">      <span class="keyword">val</span> strings=x.split(<span class="string">&quot; &quot;</span>)</span><br><span class="line">      <span class="keyword">val</span> name=strings(<span class="number">0</span>)</span><br><span class="line">      <span class="keyword">val</span> price=strings(<span class="number">1</span>).toInt</span><br><span class="line">      <span class="keyword">val</span> store=strings(<span class="number">2</span>)</span><br><span class="line">      (name,price,store)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    etlData.sortBy(x =&gt; ( -x._2 , x._3)).saveAsTextFile(<span class="string">&quot;hdfs://bigdata3:9000/data&quot;</span>)</span><br><span class="line">----------------------------------------------------------<span class="class"><span class="keyword">class</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.&#123;<span class="type">SparkConf</span>, <span class="type">SparkContext</span>&#125;</span><br><span class="line"><span class="keyword">import</span> sparkfirst.<span class="type">ContextUtils</span></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">sparktest</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">val</span> sc:<span class="type">SparkContext</span> = <span class="type">ContextUtils</span>.getSparkContext(<span class="string">&quot;test&quot;</span>)</span><br><span class="line">    <span class="keyword">val</span> bb = <span class="keyword">new</span> <span class="type">SparkContext</span>(<span class="keyword">new</span> <span class="type">SparkConf</span>().setAppName(<span class="string">&quot;test&quot;</span>).setMaster(<span class="string">&quot;local[2]&quot;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> value = sc.parallelize(<span class="type">List</span>(<span class="string">&quot;diar 300 1000&quot;</span>,</span><br><span class="line">      <span class="string">&quot;香奈儿 4000 2&quot;</span>,</span><br><span class="line">      <span class="string">&quot;螺蛳粉 200 98&quot;</span>,</span><br><span class="line">      <span class="string">&quot;30显卡 200 10&quot;</span>)，<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> etlData = value.map(x=&gt;&#123;</span><br><span class="line">      <span class="keyword">val</span> strings=x.split(<span class="string">&quot; &quot;</span>)</span><br><span class="line">      <span class="keyword">val</span> name=strings(<span class="number">0</span>)</span><br><span class="line">      <span class="keyword">val</span> price=strings(<span class="number">1</span>).toDouble</span><br><span class="line">      <span class="keyword">val</span> store=strings(<span class="number">2</span>).toInt</span><br><span class="line">      <span class="keyword">new</span> skuu(name,price,store)</span><br><span class="line">    &#125;)</span><br><span class="line">    etlData.sortBy(x=&gt;(-x.d,x.str1)).collect.foreach(print(_))</span><br><span class="line"></span><br><span class="line">    sc.stop()</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">skuu</span>(<span class="params">val str: <span class="type">String</span>,val d: <span class="type">Double</span>,val str1: <span class="type">Int</span></span>) <span class="keyword">extends</span> <span class="title">Serializable</span></span>&#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">toString</span></span>: <span class="type">String</span> =str + <span class="string">&quot;\t&quot;</span> + d + <span class="string">&quot;\t&quot;</span> + str1</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">------------------------------------------------------------------------------------------------------<span class="keyword">case</span> <span class="class"><span class="keyword">class</span></span></span><br><span class="line"><span class="keyword">case</span>好处=》重写了toString，hashcode方法，自动实现了序列化，不用实例化</span><br><span class="line"><span class="keyword">package</span> sparkfirst</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.&#123;<span class="type">SparkConf</span>, <span class="type">SparkContext</span>&#125;</span><br><span class="line"><span class="keyword">import</span> sparkfirst.<span class="type">ContextUtils</span></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">sparktest</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">val</span> sc:<span class="type">SparkContext</span> = <span class="type">ContextUtils</span>.getSparkContext(<span class="string">&quot;test&quot;</span>)</span><br><span class="line">    <span class="keyword">val</span> bb = <span class="keyword">new</span> <span class="type">SparkContext</span>(<span class="keyword">new</span> <span class="type">SparkConf</span>().setAppName(<span class="string">&quot;test&quot;</span>).setMaster(<span class="string">&quot;local[2]&quot;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> value = sc.parallelize(<span class="type">List</span>(<span class="string">&quot;diar 300 1000&quot;</span>,</span><br><span class="line">      <span class="string">&quot;香奈儿 4000 2&quot;</span>,</span><br><span class="line">      <span class="string">&quot;螺蛳粉 200 98&quot;</span>,</span><br><span class="line">      <span class="string">&quot;30显卡 200 10&quot;</span>)，<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> etlData = value.map(x=&gt;&#123;</span><br><span class="line">      <span class="keyword">val</span> strings=x.split(<span class="string">&quot; &quot;</span>)</span><br><span class="line">      <span class="keyword">val</span> name=strings(<span class="number">0</span>)</span><br><span class="line">      <span class="keyword">val</span> price=strings(<span class="number">1</span>).toDouble</span><br><span class="line">      <span class="keyword">val</span> store=strings(<span class="number">2</span>).toInt</span><br><span class="line">      skuu(name,price,store)</span><br><span class="line">    &#125;)</span><br><span class="line">    etlData.sortBy(x=&gt;(-x.d,x.str1)).collect.foreach(print(_))</span><br><span class="line"></span><br><span class="line">    sc.stop()</span><br><span class="line">  &#125;</span><br><span class="line"> <span class="keyword">case</span> <span class="class"><span class="keyword">class</span> <span class="title">skuu</span>(<span class="params">val str: <span class="type">String</span>,val d: <span class="type">Double</span>,val str1: <span class="type">Int</span></span>)</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>当用 <code>saveAsTextFile(&quot;hdfs://bigdata3:9000/data/test&quot;)</code></p><p>的时候它会根据你的分区数来生成文件</p><h3 id="需求：用两类进行-对比："><a href="#需求：用两类进行-对比：" class="headerlink" title="需求：用两类进行 对比："></a>需求：用两类进行 对比：</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> sparkfirst</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.&#123;<span class="type">SparkConf</span>, <span class="type">SparkContext</span>&#125;</span><br><span class="line"><span class="keyword">import</span> sparkfirst.<span class="type">ContextUtils</span></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">sparktest</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">val</span> sc:<span class="type">SparkContext</span> = <span class="type">ContextUtils</span>.getSparkContext(<span class="string">&quot;test&quot;</span>)</span><br><span class="line">    <span class="keyword">val</span> bb = <span class="keyword">new</span> <span class="type">SparkContext</span>(<span class="keyword">new</span> <span class="type">SparkConf</span>().setAppName(<span class="string">&quot;test&quot;</span>).setMaster(<span class="string">&quot;local[2]&quot;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> value = sc.parallelize(<span class="type">List</span>(</span><br><span class="line">      <span class="string">&quot;diar 300 1000&quot;</span>,</span><br><span class="line">      <span class="string">&quot;香奈儿 4000 2&quot;</span>,</span><br><span class="line">      <span class="string">&quot;螺蛳粉 200 98&quot;</span>,</span><br><span class="line">      <span class="string">&quot;30显卡 200 10&quot;</span>),<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> etlData = value.map(x=&gt;&#123;</span><br><span class="line">      <span class="keyword">val</span> strings=x.split(<span class="string">&quot; &quot;</span>)</span><br><span class="line">      <span class="keyword">val</span> name=strings(<span class="number">0</span>)</span><br><span class="line">      <span class="keyword">val</span> price=strings(<span class="number">1</span>).toDouble</span><br><span class="line">      <span class="keyword">val</span> store=strings(<span class="number">2</span>).toInt</span><br><span class="line">      skuu(name,price,store)</span><br><span class="line">    &#125;)</span><br><span class="line">    etlData.sortBy(x=&gt;(-x.d,x.str1)).collect.foreach(print(_))</span><br><span class="line"></span><br><span class="line">    sc.stop()</span><br><span class="line">  &#125;</span><br><span class="line"> <span class="keyword">case</span> <span class="class"><span class="keyword">class</span> <span class="title">skuu</span>(<span class="params">val str: <span class="type">String</span>,val d: <span class="type">Double</span>,val str1: <span class="type">Int</span></span>) <span class="keyword">extends</span> <span class="title">Ordered</span>[skuu]</span>&#123;</span><br><span class="line">   <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">compare</span></span>(that: skuu): <span class="type">Int</span> = &#123;</span><br><span class="line">     <span class="keyword">if</span> (<span class="keyword">this</span>.d == that.d)&#123;</span><br><span class="line">       <span class="keyword">this</span>.str1-that.str1</span><br><span class="line">     &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">       -(<span class="keyword">this</span>.d - that.d).toInt</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>隐式转换</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> sparkfirst</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.&#123;<span class="type">SparkConf</span>, <span class="type">SparkContext</span>&#125;</span><br><span class="line"><span class="keyword">import</span> sparkfirst.<span class="type">ContextUtils</span></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">sparktest</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">val</span> sc:<span class="type">SparkContext</span> = <span class="type">ContextUtils</span>.getSparkContext(<span class="string">&quot;test&quot;</span>)</span><br><span class="line">    <span class="keyword">val</span> bb = <span class="keyword">new</span> <span class="type">SparkContext</span>(<span class="keyword">new</span> <span class="type">SparkConf</span>().setAppName(<span class="string">&quot;test&quot;</span>).setMaster(<span class="string">&quot;local[2]&quot;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> value = sc.parallelize(<span class="type">List</span>(</span><br><span class="line">      <span class="string">&quot;diar 300 1000&quot;</span>,</span><br><span class="line">      <span class="string">&quot;香奈儿 4000 2&quot;</span>,</span><br><span class="line">      <span class="string">&quot;螺蛳粉 200 98&quot;</span>,</span><br><span class="line">      <span class="string">&quot;30显卡 200 10&quot;</span>),<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> etlData = value.map(x=&gt;&#123;</span><br><span class="line">      <span class="keyword">val</span> strings=x.split(<span class="string">&quot; &quot;</span>)</span><br><span class="line">      <span class="keyword">val</span> name=strings(<span class="number">0</span>)</span><br><span class="line">      <span class="keyword">val</span> price=strings(<span class="number">1</span>).toDouble</span><br><span class="line">      <span class="keyword">val</span> store=strings(<span class="number">2</span>).toInt</span><br><span class="line">      skuu(name,price,store)</span><br><span class="line">    &#125;)</span><br><span class="line">    etlData.sortBy(x=&gt;(-x.d,x.str1)).collect.foreach(print(_))</span><br><span class="line"></span><br><span class="line">    sc.stop()</span><br><span class="line"></span><br><span class="line">    implicitly <span class="function"><span class="keyword">def</span> <span class="title">skutooreder</span></span>(sku:skuu):<span class="type">Ordered</span>[skuu]=&#123;</span><br><span class="line">      <span class="keyword">new</span> <span class="type">Ordered</span>[skuu]&#123;</span><br><span class="line">        <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">compare</span></span>(that: skuu): <span class="type">Int</span> = &#123;</span><br><span class="line">          <span class="keyword">if</span> (sku.d == that.d)&#123;</span><br><span class="line">            sku.str1-that.str1</span><br><span class="line">          &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            -(sku.d - that.d).toInt</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"> <span class="keyword">case</span> <span class="class"><span class="keyword">class</span> <span class="title">skuu</span>(<span class="params">val str: <span class="type">String</span>,val d: <span class="type">Double</span>,val str1: <span class="type">Int</span></span>)</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>例子：</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">数据：</span><br><span class="line">word <span class="keyword">show</span> click</span><br><span class="line">a,<span class="number">2</span>,<span class="number">3</span></span><br><span class="line">b,<span class="number">1</span>,<span class="number">1</span></span><br><span class="line">c,<span class="number">4</span>,<span class="number">5</span></span><br><span class="line">f,<span class="number">5</span>,<span class="number">6</span></span><br><span class="line">g,<span class="number">7</span>,<span class="number">8</span></span><br><span class="line">k,<span class="number">8</span>,<span class="number">9</span></span><br><span class="line">a,<span class="number">1</span>,<span class="number">2</span></span><br><span class="line">a,<span class="number">1</span>,<span class="number">1</span></span><br><span class="line">a,<span class="number">4</span>,<span class="number">5</span></span><br><span class="line">b,<span class="number">5</span>,<span class="number">6</span></span><br><span class="line"><span class="comment">------------------------------------------------------------------------------</span></span><br><span class="line">package sparkfirst</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.&#123;SparkConf, SparkContext&#125;</span><br><span class="line"><span class="keyword">import</span> sparkfirst.ContextUtils</span><br><span class="line"><span class="keyword">object</span> sparktest &#123;</span><br><span class="line"></span><br><span class="line">  def sub(<span class="type">name</span>: String, tuple: (<span class="type">Double</span>, <span class="type">Int</span>))=&#123;</span><br><span class="line">    (<span class="type">name</span> , tuple)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  def main(args: <span class="keyword">Array</span>[String]): Unit = &#123;</span><br><span class="line">    val sc:SparkContext = ContextUtils.getSparkContext(&quot;test&quot;)</span><br><span class="line">    val bb = <span class="built_in">new</span> SparkContext(<span class="built_in">new</span> SparkConf().setAppName(&quot;test&quot;).setMaster(&quot;local[2]&quot;))</span><br><span class="line"></span><br><span class="line">    val <span class="keyword">value</span> = sc.parallelize(List(</span><br><span class="line">      &quot;a,2,3&quot;,</span><br><span class="line">      &quot;b,1,1&quot;,</span><br><span class="line">      &quot;c,4,5&quot;,</span><br><span class="line">      &quot;f,5,6&quot;,</span><br><span class="line">      &quot;g,7,8&quot;,</span><br><span class="line">      &quot;k,8,9&quot;,</span><br><span class="line">      &quot;a,1,2&quot;,</span><br><span class="line">      &quot;a,1,1&quot;,</span><br><span class="line">      &quot;a,4,5&quot;,</span><br><span class="line">      &quot;b,5,6&quot;),<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    val etlData = <span class="keyword">value</span>.map(x=&gt;&#123;</span><br><span class="line">      val strings=x.split(&quot;,&quot;)</span><br><span class="line">      val <span class="type">name</span>=strings(<span class="number">0</span>)</span><br><span class="line">      val price=strings(<span class="number">1</span>).toDouble</span><br><span class="line">      val store=strings(<span class="number">2</span>).toInt</span><br><span class="line">      sub(<span class="type">name</span>,(price,store))</span><br><span class="line">     // (<span class="type">name</span>,(price,store))</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    etlData.reduceByKey((x,y)=&gt;&#123;</span><br><span class="line">      (x._1+y._1,x._2+y._2)</span><br><span class="line">    &#125;).map(x=&gt;x._1+&quot;\t&quot;+x._2._1+&quot;\t&quot;+x._2._2+&quot;\t&quot;)</span><br><span class="line">   // etlData.reduceByKey((x,y)=&gt;&#123;(x._1+y._1,x._2+y._2)&#125;).map(x=&gt;x._1+&quot;\t&quot;+x._2._1+&quot;\t&quot;+x._2._2+&quot;\t&quot;)</span><br><span class="line">  </span><br><span class="line">    sc.stop()</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h3 id="理论："><a href="#理论：" class="headerlink" title="理论："></a>理论：</h3><p>spark架构：</p><ul><li>Application &#x3D;》 spark作业 &#x3D;》 driver program 和 executor on the cluster两个进程<ul><li>driver：运行sparkContext</li><li>exacutor：运行任务并保存数据在内存和磁盘中</li></ul></li><li>web ui</li><li>sparkcontext</li><li>application jar &#x3D;》 开发好的代码生成的jar包 &#x3D;》 包含spark作业 &#x3D;》 包含 main方法 &#x3D;》 用户自己开发完spark之后可以部署到服务器上</li><li>driver program &#x3D;》 运行 jar包里的main方法 &#x3D;》 创建sparkContext</li><li>Custer manager &#x3D;》 集群管理者 &#x3D;》 通过集群获取资源</li><li>Deploy mode &#x3D;》 当把作业提交到yarn上的时候<ul><li>cluster模式：是跑在集群内布的（driver）&#x3D;》 yarn所在的机器里面</li><li>client模式：跑在集群外外的</li></ul></li><li>Worker node &#x3D;》 工作节点&#x3D;》打工人&#x3D;》运行集群代码&#x3D;&#x3D;node manager</li><li>excutor &#x3D; 》相当于yarn的container&#x3D;》每个spark都有自己的excutor</li><li>task &#x3D;》partition &#x3D;》 rdd</li><li>job &#x3D;》 spark 里的job &#x3D;》 application里的job &#x3D;》 一个application里可能会有多个job</li><li>stage &#x3D;》 job的小单位，且每个stage之间是有依赖关系的</li><li>一个application会包含1-n个job，一个job包含1-n个stage</li><li>一个stage可以包含1-n个task</li><li>task和rdd里的分区数一一对应</li></ul><h3 id="spark的执行流程"><a href="#spark的执行流程" class="headerlink" title="spark的执行流程"></a>spark的执行流程</h3><p>sc去链接cluster manager</p><p>cluster manager 会给spark作业分配资源</p><p>spark一旦连接上Custer</p><p>启动&#x3D;》exector&#x3D;》存储和计算</p><p>sc发送代码 给 exector 发送task给他去运行</p><p>每个作业都是有自己的exector的</p><p>exector是相当于container&#x3D;》资源隔离&#x3D;》调度隔离</p><p>多个作业之间产生的数据是不可以进行共享的，但是当写到一个外部存储上，就可以了</p><p>spark-shell简单就是&#x3D;》 提交很多个job &#x3D;》相当于外部存储</p><p>用户无感知的连接到集群</p><p>可以监听exector的生命周期&#x3D;》和driver之间有 通信</p><p>只要driver可以连接到Custer集群上，他就可以&#x3D;》也就是说外部dirver也可以</p><p>提议：driver和work节点靠近一点，这样可以减少网络发送的时间，就是可以用本地来实现</p><h3 id="spark整合yarn"><a href="#spark整合yarn" class="headerlink" title="spark整合yarn"></a>spark整合yarn</h3><p>首先在spark的conf文件夹里执行 <code>cp spark-env.sh.template spark-env.sh</code></p><p>然后 <code>vim spark-env.sh</code></p><p>把 <code>HADOOP_CONF_DIR=/home/hadoop/app/hadoop/etc/hadoop 和 YARN_CONF_DIR=/home/hadoop/app/hadoop/etc/hadoop</code></p><p>加上之后重新启动spark执行 <code>spark-shell --master yarn</code></p><p>就可以了</p><p>一般启动之后，不配别的，一般这样是占用5G的内存</p><h3 id="案例：-1"><a href="#案例：-1" class="headerlink" title="案例："></a>案例：</h3><p>spark统计用户行为分析</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">    val value = sc<span class="selector-class">.parallelize</span>(<span class="built_in">List</span>(</span><br><span class="line">      <span class="string">&quot;u01,英雄联盟|绝活&amp;职业|云顶|奴神,1,1&quot;</span>,</span><br><span class="line">      <span class="string">&quot;u01,英雄联盟|绝活&amp;职业|云顶|金潺潺,1,1&quot;</span>,</span><br><span class="line">      <span class="string">&quot;u01,英雄联盟|绝活&amp;职业|云顶|带粉上车,1,0&quot;</span>,</span><br><span class="line">      <span class="string">&quot;u02,星秀|好声音|女团|三年一班,1,1&quot;</span>,</span><br><span class="line">      <span class="string">&quot;u02,星秀|好声音|女团|奴神,1,1&quot;</span>,</span><br><span class="line">      <span class="string">&quot;u02,星秀|好声音|女团|将神,1,0&quot;</span>,</span><br><span class="line">      <span class="string">&quot;u02,星秀|好声音|女团|西索,1,1&quot;</span>),<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    val etlData = value<span class="selector-class">.flatMap</span>(x=&gt;&#123;</span><br><span class="line">      val strings=x<span class="selector-class">.split</span>(<span class="string">&quot;,&quot;</span>)</span><br><span class="line">      val name=<span class="built_in">strings</span>(<span class="number">0</span>)</span><br><span class="line">      val type_log_total=<span class="built_in">strings</span>(<span class="number">1</span>)</span><br><span class="line">      val show=<span class="built_in">strings</span>(<span class="number">2</span>)<span class="selector-class">.toInt</span></span><br><span class="line">      val click=<span class="built_in">strings</span>(<span class="number">3</span>)<span class="selector-class">.toInt</span></span><br><span class="line">      val type_log_total_ni=type_log_total<span class="selector-class">.split</span>(<span class="string">&quot;\\|&quot;</span>)</span><br><span class="line">      type_log_total_ni<span class="selector-class">.map</span>(x=&gt;&#123;</span><br><span class="line">        ((name,x),(show,click))</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="comment">//sub(name,(price,store))</span></span><br><span class="line">      <span class="comment">//(name,(price,store))</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//    etlData.reduceByKey((x,y)=&gt;&#123;</span></span><br><span class="line"><span class="comment">//      (x._1+y._1,x._2+y._2)</span></span><br><span class="line"><span class="comment">//    &#125;).map(x=&gt;x._1+&quot;\t&quot;+x._2._1+&quot;\t&quot;+x._2._2+&quot;\t&quot;)</span></span><br><span class="line">   <span class="comment">//etlData.reduceByKey((x,y)=&gt;&#123;(x._1+y._1,x._2+y._2)&#125;).map(x=&gt;x._1+&quot;\t&quot;+x._2._1+&quot;\t&quot;+x._2._2+&quot;\t&quot;)</span></span><br><span class="line"></span><br><span class="line">    etlData<span class="selector-class">.reduceByKey</span>((x,y)=&gt;&#123;</span><br><span class="line">      (x._1+y._1,x._2+y._2)</span><br><span class="line">    &#125;)<span class="selector-class">.collect</span>()<span class="selector-class">.foreach</span>(println)</span><br></pre></td></tr></table></figure><h3 id="spark持久化"><a href="#spark持久化" class="headerlink" title="spark持久化:"></a>spark持久化:</h3><ul><li>RDD持久化 &#x3D;》 一个操作会有很多次的生成rdd，比如会有100个rdd，我们为了节省时间以及链路资源，可以把第99个rdd持久化，然后只用对第99个操作就好了</li><li>持久化也是可以容错的</li><li>就是保存在内存中</li><li>是针对rdd的每个分区来的</li><li>持久化操作，是下次操作的时候才会从持久化的地方加载数据</li><li>默认存储级别是在内存中存储</li><li>用persist或者cache都可以 &#x3D;》 是lazy的</li><li>当内存不足的时候是不能进行持久化的 我们可以通过序列化，进行配置&#x3D; 》 减少使用空间</li><li>一般我们要在内存和cpu之间做权衡 &#x3D;》4步选择法<ul><li>官方&#x3D;》memory_only</li><li>memory_only_ser &#x3D;&gt; 对空间会节省</li><li>磁盘上 &#x3D; 》 memory_only_desk &#x3D;&gt; 没有不做序列化快</li><li>容错 &#x3D;》 带有副本的方式，的确是更安全可是数据太大对磁盘是负担</li></ul></li><li>移除持久化数据：可以设置自动的级别（<a href="https://blog.csdn.net/qq_46517733/article/details/123092629">LRU</a>），就会过一段时间，然后自动&#x2F;或者通过rdd调用 <code>unpersist(true)</code>他是立即执行的</li><li></li></ul><p>启动spark-shell本身也是一个spark作业</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line">scala&gt; val test = sc<span class="selector-class">.parallelize</span>(<span class="string">&quot;hdfs://bigdata3:9000/flume/events/2022-12-13/events.1670898548750.log&quot;</span>)</span><br><span class="line">test: org<span class="selector-class">.apache</span><span class="selector-class">.spark</span><span class="selector-class">.rdd</span><span class="selector-class">.RDD</span><span class="selector-attr">[Char]</span> = ParallelCollectionRDD<span class="selector-attr">[0]</span> at parallelize at &lt;console&gt;:<span class="number">23</span></span><br><span class="line"></span><br><span class="line">scala&gt; test<span class="selector-class">.collect</span></span><br><span class="line">collect   collectAsync</span><br><span class="line"></span><br><span class="line">scala&gt; test<span class="selector-class">.collect</span></span><br><span class="line">res0: Array<span class="selector-attr">[Char]</span> = <span class="built_in">Array</span>(h, d, f, s, :, /, /, <span class="selector-tag">b</span>, <span class="selector-tag">i</span>, g, d, <span class="selector-tag">a</span>, t, <span class="selector-tag">a</span>, <span class="number">3</span>, :, <span class="number">9</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, /, f, l, u, m, e, /, e, v, e, n, t, s, /, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, -, <span class="number">1</span>, <span class="number">2</span>, -, <span class="number">1</span>, <span class="number">3</span>, /, e, v, e, n, t, s, ., <span class="number">1</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">0</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">5</span>, <span class="number">0</span>, ., l, o, g)</span><br><span class="line"></span><br><span class="line">scala&gt; test<span class="selector-class">.persist</span></span><br><span class="line">res1: test<span class="selector-class">.type</span> = ParallelCollectionRDD<span class="selector-attr">[0]</span> at parallelize at &lt;console&gt;:<span class="number">23</span></span><br><span class="line"></span><br><span class="line">scala&gt; test<span class="selector-class">.ca</span></span><br><span class="line">cache   cartesian</span><br><span class="line"></span><br><span class="line">scala&gt; test<span class="selector-class">.cache</span></span><br><span class="line">res2: test<span class="selector-class">.type</span> = ParallelCollectionRDD<span class="selector-attr">[0]</span> at parallelize at &lt;console&gt;:<span class="number">23</span></span><br><span class="line">-------------------------------------------------------------------------------------<span class="attr">--java</span>的序列化方法</span><br><span class="line">    val names = Array<span class="selector-attr">[String]</span>(<span class="string">&quot;刘子航&quot;</span>,<span class="string">&quot;李信&quot;</span>,<span class="string">&quot;花木兰&quot;</span>,<span class="string">&quot;达摩&quot;</span>,<span class="string">&quot;耀&quot;</span>,<span class="string">&quot;貂蝉&quot;</span>,<span class="string">&quot;吕布&quot;</span>)</span><br><span class="line">    val gar = Array<span class="selector-attr">[String]</span>(<span class="string">&quot;男&quot;</span>,<span class="string">&quot;女&quot;</span>)</span><br><span class="line">    val addres= Array<span class="selector-attr">[String]</span>(<span class="string">&quot;山东&quot;</span>,<span class="string">&quot;广西&quot;</span>,<span class="string">&quot;大连&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    val value1 = sc<span class="selector-class">.parallelize</span>(<span class="number">1</span> to <span class="number">300000</span>)</span><br><span class="line"></span><br><span class="line">    val value2 = new ArrayBuffer<span class="selector-attr">[persion]</span>()</span><br><span class="line">    val value3 = value1<span class="selector-class">.map</span>(x =&gt; &#123;</span><br><span class="line">      val name = <span class="built_in">names</span>(Random<span class="selector-class">.nextInt</span>(<span class="number">6</span>))</span><br><span class="line">      val s = <span class="built_in">gar</span>(Random<span class="selector-class">.nextInt</span>(<span class="number">1</span>))</span><br><span class="line">      val s1 = <span class="built_in">addres</span>(Random<span class="selector-class">.nextInt</span>(<span class="number">2</span>))</span><br><span class="line">      value2 += (<span class="built_in">persion</span>(name, s, s1))</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    value3<span class="selector-class">.persist</span>(StorageLevel.MEMORY_ONLY_SER)</span><br><span class="line">    value3<span class="selector-class">.count</span>()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">case class <span class="built_in">persion</span>(name: String,gre:String,add:String)&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">-----------------------------------------------------<span class="attr">--Kyro</span>序列化</span><br><span class="line">速度比java快，但是不是支持所有的序列化的，有的没有，使用前要加上注册类</span><br><span class="line"></span><br><span class="line">要先在conf里使用它</span><br><span class="line"> conf<span class="selector-class">.set</span>(<span class="string">&quot;spark.serializer&quot;</span>,<span class="string">&quot;org.apache.spark.serializer.KryoSerializer&quot;</span>)</span><br><span class="line">然后要注册所用的case class或者class </span><br><span class="line"> conf<span class="selector-class">.registerKryoClasses</span>(<span class="built_in">Array</span>(classOf<span class="selector-attr">[Info]</span>))</span><br><span class="line">然后其余和上述一样</span><br><span class="line"></span><br><span class="line">    val names = Array<span class="selector-attr">[String]</span>(<span class="string">&quot;刘子航&quot;</span>,<span class="string">&quot;李信&quot;</span>,<span class="string">&quot;花木兰&quot;</span>,<span class="string">&quot;达摩&quot;</span>,<span class="string">&quot;耀&quot;</span>,<span class="string">&quot;貂蝉&quot;</span>,<span class="string">&quot;吕布&quot;</span>)</span><br><span class="line">    val gar = Array<span class="selector-attr">[String]</span>(<span class="string">&quot;男&quot;</span>,<span class="string">&quot;女&quot;</span>)</span><br><span class="line">    val addres= Array<span class="selector-attr">[String]</span>(<span class="string">&quot;山东&quot;</span>,<span class="string">&quot;广西&quot;</span>,<span class="string">&quot;大连&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    val value1 = sc<span class="selector-class">.parallelize</span>(<span class="number">1</span> to <span class="number">300000</span>)</span><br><span class="line"></span><br><span class="line">    val value2 = new ArrayBuffer<span class="selector-attr">[persion]</span>()</span><br><span class="line">    val value3 = value1<span class="selector-class">.map</span>(x =&gt; &#123;</span><br><span class="line">      val name = <span class="built_in">names</span>(Random<span class="selector-class">.nextInt</span>(<span class="number">6</span>))</span><br><span class="line">      val s = <span class="built_in">gar</span>(Random<span class="selector-class">.nextInt</span>(<span class="number">1</span>))</span><br><span class="line">      val s1 = <span class="built_in">addres</span>(Random<span class="selector-class">.nextInt</span>(<span class="number">2</span>))</span><br><span class="line">      value2 += (<span class="built_in">persion</span>(name, s, s1))</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    value3<span class="selector-class">.persist</span>(StorageLevel.MEMORY_ONLY_SER)</span><br><span class="line">    value3<span class="selector-class">.count</span>()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">case class <span class="built_in">persion</span>(name: String,gre:String,add:String)&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="依赖关系和血缘关系"><a href="#依赖关系和血缘关系" class="headerlink" title="依赖关系和血缘关系"></a>依赖关系和血缘关系</h3><p>血缘关系 ： &#x3D;》就是不同rdd之间的转化</p><p>依赖关系 &#x3D;》</p><ul><li>宽依赖 ： 一个父RDD里的parttion会被子RDD的partition使用多次 &#x3D;》 会产生shuffer &#x3D;》 有新的stage产生 &#x3D; 》一个shuffle会划分两个stage &#x3D;》引起shuffle就会产生stage</li><li>窄依赖 ： 同一个父RDD里的分区最多被子RDD使用一次 &#x3D;》一个stage里完成的 &#x3D;》 无shuffle</li></ul><h3 id="补充算子-："><a href="#补充算子-：" class="headerlink" title="补充算子 ："></a>补充算子 ：</h3><p>repartition ： <code>repartition（num）</code>重新分区 ，引起shuffle &#x3D;》 底层调用的是coalesce &#x3D;》 不可以减少分取数</p><p>coalesce ： 一般用于减少RDD的分区数量，<code>coalesce(num)</code>窄依赖的 &#x3D;》 不引起shuffle &#x3D;》 可以增加分区数</p><p>生产上用于调整计算的并行度</p><h3 id="判断执行位置"><a href="#判断执行位置" class="headerlink" title="判断执行位置"></a>判断执行位置</h3><p>判断是不是对rdd里的元素进行操作，如果是操作，则是executor端的，如果不是则是driver端</p><p>例子 ：求top2</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">    val value = sc<span class="selector-class">.parallelize</span>(<span class="built_in">List</span>(</span><br><span class="line">      <span class="string">&quot;www.bvaidu,u01,20&quot;</span>,</span><br><span class="line">      <span class="string">&quot;www.githuba,u02,2&quot;</span>,</span><br><span class="line">      <span class="string">&quot;www.bvaidu,u02,100&quot;</span>,</span><br><span class="line">      <span class="string">&quot;www.bibi,u02,199&quot;</span>,</span><br><span class="line">      <span class="string">&quot;www.githuba,u01,100&quot;</span>,</span><br><span class="line">      <span class="string">&quot;www.githuba,u01,1&quot;</span>,</span><br><span class="line">      <span class="string">&quot;www.githuba,u01,10&quot;</span>,</span><br><span class="line">      <span class="string">&quot;www.bibi,u02,19&quot;</span>,</span><br><span class="line">      <span class="string">&quot;www.bibi,u01,199&quot;</span>,</span><br><span class="line">      <span class="string">&quot;www.baidu.com,uid01,1&quot;</span>,</span><br><span class="line">      <span class="string">&quot;www.baidu.com,uid01,10&quot;</span>,</span><br><span class="line">      <span class="string">&quot;www.baidu.com,uid02,3&quot;</span>,</span><br><span class="line">      <span class="string">&quot;www.baidu.com,uid02,5&quot;</span>,</span><br><span class="line">      <span class="string">&quot;www.github.com,uid01,11&quot;</span>,</span><br><span class="line">      <span class="string">&quot;www.github.com,uid01,10&quot;</span>,</span><br><span class="line">      <span class="string">&quot;www.github.com,uid02,30&quot;</span>,</span><br><span class="line">      <span class="string">&quot;www.github.com,uid02,50&quot;</span>,</span><br><span class="line">      <span class="string">&quot;www.bibili.com,uid01,110&quot;</span>,</span><br><span class="line">      <span class="string">&quot;www.bibili.com,uid01,10&quot;</span>,</span><br><span class="line">      <span class="string">&quot;www.bibili.com,uid02,2&quot;</span>,</span><br><span class="line">      <span class="string">&quot;www.bibili.com,uid02,3&quot;</span>),<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    val etlData = value<span class="selector-class">.map</span>(x=&gt;&#123;</span><br><span class="line">      val strings=x<span class="selector-class">.split</span>(<span class="string">&quot;,&quot;</span>)</span><br><span class="line">      val yuming=<span class="built_in">strings</span>(<span class="number">0</span>)</span><br><span class="line">      val user=<span class="built_in">strings</span>(<span class="number">1</span>)</span><br><span class="line">      val cishu=<span class="built_in">strings</span>(<span class="number">2</span>)<span class="selector-class">.toInt</span></span><br><span class="line">      ((yuming,user),(cishu))</span><br><span class="line">      <span class="comment">//sub(name,(price,store))</span></span><br><span class="line">      <span class="comment">//(name,(price,store))</span></span><br><span class="line">    &#125;)</span><br><span class="line">etlData<span class="selector-class">.reduceByKey</span>((x,y)=&gt;&#123;</span><br><span class="line">      x+y</span><br><span class="line">    &#125;)<span class="selector-class">.sortBy</span>(x=&gt; -x._2,true)<span class="selector-class">.map</span>(x=&gt;&#123;</span><br><span class="line">      (x._1._2,(x._1._1,x._2))</span><br><span class="line">    &#125;)<span class="selector-class">.groupByKey</span>()<span class="selector-class">.map</span>(x=&gt;&#123;</span><br><span class="line">        x._2<span class="selector-class">.map</span>(s=&gt;&#123;</span><br><span class="line">          (x._1,s._1,s._2)</span><br><span class="line">      &#125;)<span class="selector-class">.take</span>(<span class="number">2</span>)&#125;)<span class="selector-class">.saveAsTextFile</span>(<span class="string">&quot;hdfs://bigdata3:9000/input/10.txt&quot;</span>)</span><br><span class="line">------------------------------------------------------------------------------简化版本</span><br><span class="line">    val value = sc<span class="selector-class">.parallelize</span>(<span class="built_in">List</span>(</span><br><span class="line">      <span class="string">&quot;www.bvaidu,u01,20&quot;</span>,</span><br><span class="line">      <span class="string">&quot;www.githuba,u02,2&quot;</span>,</span><br><span class="line">      <span class="string">&quot;www.bvaidu,u02,100&quot;</span>,</span><br><span class="line">      <span class="string">&quot;www.bibi,u02,199&quot;</span>,</span><br><span class="line">      <span class="string">&quot;www.githuba,u01,100&quot;</span>,</span><br><span class="line">      <span class="string">&quot;www.githuba,u01,1&quot;</span>,</span><br><span class="line">      <span class="string">&quot;www.githuba,u01,10&quot;</span>,</span><br><span class="line">      <span class="string">&quot;www.bibi,u02,19&quot;</span>,</span><br><span class="line">      <span class="string">&quot;www.bibi,u01,199&quot;</span>,</span><br><span class="line">      <span class="string">&quot;www.baidu.com,uid01,1&quot;</span>,</span><br><span class="line">      <span class="string">&quot;www.baidu.com,uid01,10&quot;</span>,</span><br><span class="line">      <span class="string">&quot;www.baidu.com,uid02,3&quot;</span>,</span><br><span class="line">      <span class="string">&quot;www.baidu.com,uid02,5&quot;</span>,</span><br><span class="line">      <span class="string">&quot;www.github.com,uid01,11&quot;</span>,</span><br><span class="line">      <span class="string">&quot;www.github.com,uid01,10&quot;</span>,</span><br><span class="line">      <span class="string">&quot;www.github.com,uid02,30&quot;</span>,</span><br><span class="line">      <span class="string">&quot;www.github.com,uid02,50&quot;</span>,</span><br><span class="line">      <span class="string">&quot;www.bibili.com,uid01,110&quot;</span>,</span><br><span class="line">      <span class="string">&quot;www.bibili.com,uid01,10&quot;</span>,</span><br><span class="line">      <span class="string">&quot;www.bibili.com,uid02,2&quot;</span>,</span><br><span class="line">      <span class="string">&quot;www.bibili.com,uid02,3&quot;</span>),<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    val etlData = value<span class="selector-class">.map</span>(x=&gt;&#123;</span><br><span class="line">      val strings=x<span class="selector-class">.split</span>(<span class="string">&quot;,&quot;</span>)</span><br><span class="line">      val yuming=<span class="built_in">strings</span>(<span class="number">0</span>)</span><br><span class="line">      val user=<span class="built_in">strings</span>(<span class="number">1</span>)</span><br><span class="line">      val cishu=<span class="built_in">strings</span>(<span class="number">2</span>)<span class="selector-class">.toInt</span></span><br><span class="line">      ((yuming,user),(cishu))</span><br><span class="line">      <span class="comment">//sub(name,(price,store))</span></span><br><span class="line">      <span class="comment">//(name,(price,store))</span></span><br><span class="line">    &#125;)</span><br><span class="line">    val value4 = etlData<span class="selector-class">.map</span>(x =&gt; &#123;</span><br><span class="line">      (x._1._2)</span><br><span class="line">    &#125;)<span class="selector-class">.distinct</span>()<span class="selector-class">.collect</span>()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (elem &lt;- value4)&#123;</span><br><span class="line">     etlData<span class="selector-class">.filter</span>(_._1._2 == elem)<span class="selector-class">.reduceByKey</span>(_ + _)<span class="selector-class">.sortBy</span>( -_._2)<span class="selector-class">.take</span>(<span class="number">2</span>)<span class="selector-class">.foreach</span>(<span class="built_in">println</span>(_))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>累加器：广播变量&#x3D;》后续再补充</p><p>案例 ： wordcount</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">val wc = sc.textFile(<span class="string">&quot;hdfs://bigdata3:9000/3.log&quot;</span>)</span><br><span class="line"></span><br><span class="line">wc.flatMap(<span class="function"><span class="params">x</span>=&gt;</span>&#123;</span><br><span class="line">  x.<span class="built_in">split</span>(<span class="string">&quot;,&quot;</span>)</span><br><span class="line">&#125;).<span class="built_in">map</span>(<span class="function"><span class="params">x</span>=&gt;</span>&#123;</span><br><span class="line">  (x,<span class="number">1</span>)</span><br><span class="line">&#125;).reduceByKey(<span class="function">(<span class="params">x,y</span>)=&gt;</span>&#123;</span><br><span class="line">  x+y</span><br><span class="line">&#125;).saveAsTextFile(<span class="string">&quot;hdfs://bigdata3:9000/input/11.txt&quot;</span>)</span><br></pre></td></tr></table></figure><p>部署spark作业</p><ul><li>jar</li><li>spark-submit</li></ul><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">spark-submit <span class="string">\</span></span><br><span class="line">--<span class="keyword">class</span> 包名 <span class="string">\</span></span><br><span class="line">--master 模式 <span class="string">\</span></span><br><span class="line">--name 作业名字 <span class="string">\</span></span><br><span class="line">jar包在机器上的路径 <span class="string">\</span></span><br><span class="line">想传的参数</span><br><span class="line">-------------------------------------例子</span><br><span class="line">spark-submit <span class="string">\</span></span><br><span class="line">--<span class="keyword">class</span> <span class="title class_">tool</span>.jdbc.readjdbc <span class="string">\</span></span><br><span class="line">/home/hadoop/project/jar/bigdatajava-<span class="number">1.0</span>-SNAPSHOT.jar <span class="string">\</span></span><br><span class="line"><span class="string">&quot;jdbc:mysql://bigdata2:3306/try&quot;</span> <span class="string">&quot;root&quot;</span> <span class="string">&quot;liuzihan010616&quot;</span> <span class="string">&quot;emp&quot;</span></span><br><span class="line">-----------------------------------------我这里不加msater是因为我再代码里已经加了</span><br></pre></td></tr></table></figure><p>还可以用其内封装的方法进行传值&#x3D;》不用 args</p><p>就是在submit的时候用 <code>--conf</code>传入</p><p>代码如下  :</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.dl2262.sparkcore.day02</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.dl2262.sparkcore.util.&#123;<span class="type">ContextUtils</span>, <span class="type">FileUtils</span>&#125;</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.<span class="type">SparkContext</span></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.internal.<span class="type">Logging</span></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.rdd.<span class="type">RDD</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  *</span></span><br><span class="line"><span class="comment">  * @author sxwang</span></span><br><span class="line"><span class="comment">  *         01 05 8:28</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">WCApp</span> <span class="keyword">extends</span> <span class="title">Logging</span></span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//    if(args.size != 2)&#123;</span></span><br><span class="line">    <span class="comment">//      logError(&quot;请正确输入2个参数：&lt;input&gt; &lt;output&gt;&quot;)</span></span><br><span class="line">    <span class="comment">//      System.exit(0)</span></span><br><span class="line">    <span class="comment">//    &#125;</span></span><br><span class="line">    <span class="comment">//    val in = args(0)</span></span><br><span class="line">    <span class="comment">//    val out = args(1)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> sc: <span class="type">SparkContext</span> = <span class="type">ContextUtils</span>.getSparkContext(<span class="keyword">this</span>.getClass.getSimpleName)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> in = sc.getConf.get(<span class="string">&quot;spark.input.path&quot;</span>,<span class="string">&quot;hdfs://bigdata32:9000/input/&quot;</span>)</span><br><span class="line">    <span class="keyword">val</span> out = sc.getConf.get(<span class="string">&quot;spark.output.path&quot;</span>,<span class="string">&quot;hdfs://bigdata32:9000/output/&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> input = sc.textFile(in)</span><br><span class="line"></span><br><span class="line">    <span class="type">FileUtils</span>.deletePath( sc.hadoopConfiguration,out)</span><br><span class="line"></span><br><span class="line">    input.flatMap(line  =&gt; &#123;</span><br><span class="line">      line.split(<span class="string">&quot;,&quot;</span>)</span><br><span class="line">    &#125;).map(word =&gt; (word,<span class="number">1</span>))</span><br><span class="line">      .reduceByKey(_+_)</span><br><span class="line">      .saveAsTextFile(out)</span><br><span class="line"></span><br><span class="line">    sc.stop()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>例子：</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">数据类型如下：</span><br><span class="line">域名，用户，用户所在地，展示次数，点击次数</span><br><span class="line">求分别按照域名，用户，用户所在地进行统计其top2</span><br><span class="line">-----------------------------------------------------------------------------------制造数据</span><br><span class="line">  val domin = Array<span class="selector-attr">[String]</span>(<span class="string">&quot;www.baidu.com&quot;</span>,<span class="string">&quot;www.taobao.com&quot;</span>,<span class="string">&quot;www.github.com&quot;</span>,<span class="string">&quot;www.bilbil.com&quot;</span>,<span class="string">&quot;www.csdn.com&quot;</span>,<span class="string">&quot;www.zihang.com&quot;</span>)</span><br><span class="line">    val userList = Array<span class="selector-attr">[String]</span>(<span class="string">&quot;zihang&quot;</span>,<span class="string">&quot;zuan&quot;</span>,<span class="string">&quot;zihao&quot;</span>,<span class="string">&quot;shuangxi&quot;</span>,<span class="string">&quot;yuhang&quot;</span>)</span><br><span class="line">    val beianlocal = Array<span class="selector-attr">[String]</span>(<span class="string">&quot;广州&quot;</span>,<span class="string">&quot;江西&quot;</span>,<span class="string">&quot;太原&quot;</span>,<span class="string">&quot;新疆&quot;</span>,<span class="string">&quot;上海&quot;</span>)</span><br><span class="line">    <span class="selector-tag">var</span> stringe:List<span class="selector-attr">[String]</span> = Nil</span><br><span class="line">    <span class="built_in">for</span>(<span class="selector-tag">i</span> &lt;- <span class="number">1</span> <span class="built_in">to</span>(<span class="number">30000</span>))&#123;</span><br><span class="line">      val Randomdomin = <span class="built_in">domin</span>(Random<span class="selector-class">.nextInt</span>(domin.length-<span class="number">1</span>))</span><br><span class="line">      val RandomUserList = <span class="built_in">userList</span>(Random<span class="selector-class">.nextInt</span>(userList.length-<span class="number">1</span>))</span><br><span class="line">      val Randombeianlocal = <span class="built_in">beianlocal</span>(Random<span class="selector-class">.nextInt</span>(beianlocal.length-<span class="number">1</span>))</span><br><span class="line">      val tmp = <span class="built_in">List</span>(Randomdomin + <span class="string">&quot;,&quot;</span> + RandomUserList + <span class="string">&quot;,&quot;</span> + Randombeianlocal )</span><br><span class="line">      stringe = stringe++tmp</span><br><span class="line">    &#125;</span><br><span class="line">-------------------------------------------------------------------------------域名 =&gt;其他有时间再补充把，和这个一样</span><br><span class="line"> val basicdata = sc<span class="selector-class">.parallelize</span>(stringe)</span><br><span class="line">-------------------------------------------------------------------------------解析数据</span><br><span class="line">    val ETLDATA = basicdata<span class="selector-class">.map</span>(x=&gt;&#123;</span><br><span class="line">      val strings = x<span class="selector-class">.split</span>(<span class="string">&quot;,&quot;</span>)</span><br><span class="line">      val currentdomin = <span class="built_in">strings</span>(<span class="number">0</span>)</span><br><span class="line">      val currentuser = <span class="built_in">strings</span>(<span class="number">1</span>)</span><br><span class="line">      val currentadd = <span class="built_in">strings</span>(<span class="number">2</span>)</span><br><span class="line">      val click = Random<span class="selector-class">.nextInt</span>(<span class="number">100</span>)<span class="selector-class">.toInt</span></span><br><span class="line">      val show = Random<span class="selector-class">.nextInt</span>(<span class="number">200</span>)<span class="selector-class">.toInt</span></span><br><span class="line">      ((currentdomin,currentuser,currentadd),(click,show))</span><br><span class="line">    &#125;)</span><br><span class="line">--------------------------------------------------------------------------------处理并排序</span><br><span class="line">      <span class="keyword">for</span> (elem &lt;- domin)&#123;</span><br><span class="line">        ETLDATA<span class="selector-class">.filter</span>(_._1._1==elem)<span class="selector-class">.reduceByKey</span>((x,y)=&gt;&#123;</span><br><span class="line">          (x._1+y._1,x._2+y._2)</span><br><span class="line">        &#125;)<span class="selector-class">.sortBy</span>( -_._2._1)<span class="selector-class">.take</span>(<span class="number">2</span>)<span class="selector-class">.foreach</span>(<span class="built_in">println</span>(_))</span><br><span class="line">      &#125;</span><br><span class="line">---------------------------------------------------------------------------------方法<span class="number">2</span></span><br><span class="line">    ETLDATA<span class="selector-class">.reduceByKey</span>((x,y)=&gt;&#123;</span><br><span class="line">      (x._1+y._1,y._2+x._2)</span><br><span class="line">    &#125;)<span class="selector-class">.sortBy</span>(x=&gt; -x._2._1)<span class="selector-class">.map</span>(x=&gt;&#123;</span><br><span class="line">      (x._1._1,(x._1._2,x._1._3,x._2))</span><br><span class="line">    &#125;)<span class="selector-class">.groupByKey</span>()<span class="selector-class">.map</span>(x=&gt;&#123;</span><br><span class="line">      x._2<span class="selector-class">.map</span>(s=&gt;&#123;</span><br><span class="line">        (x._1,(s._1,s._2,s._3))</span><br><span class="line">      &#125;)<span class="selector-class">.take</span>(<span class="number">2</span>)</span><br><span class="line">    &#125;).collect</span><br></pre></td></tr></table></figure>]]></content:encoded>
      
      
      <category domain="http://zihang.fun/categories/%E6%97%A5%E5%BF%97/">日志</category>
      
      
      <category domain="http://zihang.fun/tags/spark/">spark</category>
      
      
      <comments>http://zihang.fun/2023/01/04/1-4/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>hive调优</title>
      <link>http://zihang.fun/2022/12/28/12-24/</link>
      <guid>http://zihang.fun/2022/12/28/12-24/</guid>
      <pubDate>Wed, 28 Dec 2022 01:46:03 GMT</pubDate>
      
        
        
      <description>&lt;h1 id=&quot;hive的内置function&quot;&gt;&lt;a href=&quot;#hive的内置function&quot; class=&quot;headerlink&quot; title=&quot;hive的内置function&quot;&gt;&lt;/a&gt;hive的内置function&lt;/h1&gt;&lt;p&gt;通过 &lt;code&gt;show func</description>
        
      
      
      
      <content:encoded><![CDATA[<h1 id="hive的内置function"><a href="#hive的内置function" class="headerlink" title="hive的内置function"></a>hive的内置function</h1><p>通过 <code>show functions</code>查看，命令总数以及名称</p><p>通过 <code>show functions like xxx</code>代表模糊查询</p><p>通过 <code>desc function extended xxxx方法名字</code> 查看方法如何使用</p><h2 id="时间函数"><a href="#时间函数" class="headerlink" title="时间函数"></a>时间函数</h2><p>current_date:它打印的是当前时间</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">hive</span> (default)&gt; select current_date;</span><br><span class="line"><span class="attribute">OK</span></span><br><span class="line"><span class="attribute">_c0</span></span><br><span class="line"><span class="attribute">2022</span>-<span class="number">12</span>-<span class="number">28</span></span><br><span class="line"><span class="attribute">Time</span> taken: <span class="number">5</span>.<span class="number">424</span> seconds, Fetched: <span class="number">1</span> row(s)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>current_timestamp:打印当前时间戳</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">hive</span> (default)&gt; select current_timestamp;</span><br><span class="line"><span class="attribute">OK</span></span><br><span class="line"><span class="attribute">_c0</span></span><br><span class="line"><span class="attribute">2022</span>-<span class="number">12</span>-<span class="number">28</span> <span class="number">09</span>:<span class="number">56</span>:<span class="number">56</span>.<span class="number">204</span></span><br><span class="line"><span class="attribute">Time</span> taken: <span class="number">0</span>.<span class="number">23</span> seconds, Fetched: <span class="number">1</span> row(s)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>unix_timestamp:把肉眼可见的时间格式转换成秒值，1970年到指定日子的秒值</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">hive (<span class="keyword">default</span>)&gt; <span class="keyword">desc</span> <span class="keyword">function</span> extended unix_timestamp;</span><br><span class="line">OK</span><br><span class="line">tab_name</span><br><span class="line">unix_timestamp(<span class="type">date</span>[, pattern]) - Converts the <span class="type">time</span> <span class="keyword">to</span> a number</span><br><span class="line">Converts the specified <span class="type">time</span> <span class="keyword">to</span> number <span class="keyword">of</span> seconds since <span class="number">1970</span><span class="number">-01</span><span class="number">-01.</span> The unix_timestamp(<span class="type">void</span>) overload <span class="keyword">is</span> deprecated, use <span class="built_in">current_timestamp</span>.</span><br><span class="line"><span class="keyword">Function</span> <span class="keyword">class</span>:org.apache.hadoop.hive.ql.udf.generic.GenericUDFUnixTimeStamp</span><br><span class="line"><span class="keyword">Function</span> <span class="keyword">type</span>:BUILTIN</span><br><span class="line"><span class="type">Time</span> taken: <span class="number">0.015</span> seconds, Fetched: <span class="number">4</span> <span class="keyword">row</span>(s)</span><br><span class="line"></span><br><span class="line"><span class="comment">---------------------------------------------------------------使用</span></span><br><span class="line">hive (<span class="keyword">default</span>)&gt; <span class="keyword">select</span> unix_timestamp()</span><br><span class="line">              &gt; ;</span><br><span class="line">unix_timestamp(<span class="type">void</span>) <span class="keyword">is</span> deprecated. Use <span class="built_in">current_timestamp</span> <span class="keyword">instead</span>.</span><br><span class="line">unix_timestamp(<span class="type">void</span>) <span class="keyword">is</span> deprecated. Use <span class="built_in">current_timestamp</span> <span class="keyword">instead</span>.</span><br><span class="line">OK</span><br><span class="line">_c0</span><br><span class="line"><span class="number">1672192863</span></span><br><span class="line"><span class="type">Time</span> taken: <span class="number">0.145</span> seconds, Fetched: <span class="number">1</span> <span class="keyword">row</span>(s)</span><br><span class="line"><span class="comment">------------------------------------------------------------------加参数</span></span><br><span class="line">hive (<span class="keyword">default</span>)&gt; <span class="keyword">select</span> unix_timestamp(<span class="string">&#x27;2022-12-28&#x27;</span>);</span><br><span class="line">OK</span><br><span class="line">_c0</span><br><span class="line"><span class="keyword">NULL</span></span><br><span class="line"><span class="type">Time</span> taken: <span class="number">0.146</span> seconds, Fetched: <span class="number">1</span> <span class="keyword">row</span>(s)</span><br><span class="line">hive (<span class="keyword">default</span>)&gt; <span class="keyword">select</span> unix_timestamp(<span class="string">&#x27;2022-12-28 12:00:00&#x27;</span>);</span><br><span class="line">OK</span><br><span class="line">_c0</span><br><span class="line"><span class="number">1672228800</span></span><br><span class="line"><span class="type">Time</span> taken: <span class="number">0.141</span> seconds, Fetched: <span class="number">1</span> <span class="keyword">row</span>(s)</span><br><span class="line">hive (<span class="keyword">default</span>)&gt; </span><br><span class="line">默认加参数的时候要YYYY-MM-dd HH:mm:ss 但是可以加格式 ，通过下述方法添加自定义格式</span><br><span class="line">hive (<span class="keyword">default</span>)&gt; <span class="keyword">select</span> unix_timestamp(<span class="string">&#x27;2022-12-28&#x27;</span>,<span class="string">&#x27;yyyy-MM-dd&#x27;</span>);</span><br><span class="line">OK</span><br><span class="line">_c0</span><br><span class="line"><span class="number">1672185600</span></span><br><span class="line"><span class="type">Time</span> taken: <span class="number">0.149</span> seconds, Fetched: <span class="number">1</span> <span class="keyword">row</span>(s)</span><br><span class="line">其最小的时间是<span class="number">8</span>点，并不是<span class="number">0</span>点</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>from_unixtime：把毫秒数转换成日期</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">hive (<span class="keyword">default</span>)<span class="operator">&gt;</span> <span class="keyword">desc</span> <span class="keyword">function</span> extended from_unixtime;</span><br><span class="line">OK</span><br><span class="line">tab_name</span><br><span class="line">from_unixtime(unix_time, format) <span class="operator">-</span> <span class="keyword">returns</span> unix_time <span class="keyword">in</span> the specified format</span><br><span class="line">Example:</span><br><span class="line">  <span class="operator">&gt;</span> <span class="keyword">SELECT</span> from_unixtime(<span class="number">0</span>, <span class="string">&#x27;yyyy-MM-dd HH:mm:ss&#x27;</span>) <span class="keyword">FROM</span> src LIMIT <span class="number">1</span>;</span><br><span class="line">  <span class="string">&#x27;1970-01-01 00:00:00&#x27;</span></span><br><span class="line"><span class="keyword">Function</span> class:org.apache.hadoop.hive.ql.udf.UDFFromUnixTime</span><br><span class="line"><span class="keyword">Function</span> type:BUILTIN</span><br><span class="line"><span class="type">Time</span> taken: <span class="number">0.016</span> seconds, Fetched: <span class="number">6</span> <span class="type">row</span>(s)</span><br><span class="line"><span class="comment">--------------------------------------------------------使用</span></span><br><span class="line">hive (<span class="keyword">default</span>)<span class="operator">&gt;</span> <span class="keyword">select</span> from_unixtime(<span class="number">1672193662</span>);</span><br><span class="line">OK</span><br><span class="line">_c0</span><br><span class="line"><span class="number">2022</span><span class="number">-12</span><span class="number">-28</span> <span class="number">02</span>:<span class="number">14</span>:<span class="number">22</span></span><br><span class="line"><span class="type">Time</span> taken: <span class="number">0.122</span> seconds, Fetched: <span class="number">1</span> <span class="type">row</span>(s)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>to_date：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">hive (<span class="keyword">default</span>)<span class="operator">&gt;</span> <span class="keyword">desc</span> <span class="keyword">function</span> extended to_date;</span><br><span class="line">OK</span><br><span class="line">tab_name</span><br><span class="line">to_date(expr) <span class="operator">-</span> Extracts the <span class="type">date</span> part <span class="keyword">of</span> the <span class="type">date</span> <span class="keyword">or</span> datetime expression expr</span><br><span class="line">Example:</span><br><span class="line">   <span class="operator">&gt;</span> <span class="keyword">SELECT</span> to_date(<span class="string">&#x27;2009-07-30 04:17:52&#x27;</span>) <span class="keyword">FROM</span> src LIMIT <span class="number">1</span>;</span><br><span class="line">  <span class="string">&#x27;2009-07-30&#x27;</span></span><br><span class="line"><span class="keyword">Function</span> class:org.apache.hadoop.hive.ql.udf.generic.GenericUDFDate</span><br><span class="line"><span class="keyword">Function</span> type:BUILTIN</span><br><span class="line"><span class="type">Time</span> taken: <span class="number">0.015</span> seconds, Fetched: <span class="number">6</span> <span class="type">row</span>(s)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>year:month:day:hour:minute等等 ，是取值日期中的一部分</p><p>quarter ：季度 &#x3D;》 q1,q2,q3,q4 &#x3D;&gt; 第几季度</p><p>默认是三个月一个季度</p><p>month_between : 两个日期差几个月</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">hive (<span class="keyword">default</span>)<span class="operator">&gt;</span> <span class="keyword">desc</span> <span class="keyword">function</span> extended months_between;</span><br><span class="line">OK</span><br><span class="line">tab_name</span><br><span class="line">months_between(date1, date2, roundOff) <span class="operator">-</span> <span class="keyword">returns</span> number <span class="keyword">of</span> months <span class="keyword">between</span> dates date1 <span class="keyword">and</span> date2</span><br><span class="line">If date1 <span class="keyword">is</span> later than date2, <span class="keyword">then</span> the <span class="keyword">result</span> <span class="keyword">is</span> positive. If date1 <span class="keyword">is</span> earlier than date2, <span class="keyword">then</span> the <span class="keyword">result</span> <span class="keyword">is</span> negative. If date1 <span class="keyword">and</span> date2 <span class="keyword">are</span> either the same days <span class="keyword">of</span> the <span class="keyword">month</span> <span class="keyword">or</span> <span class="keyword">both</span> <span class="keyword">last</span> days <span class="keyword">of</span> months, <span class="keyword">then</span> the <span class="keyword">result</span> <span class="keyword">is</span> always an integer. Otherwise the UDF calculates the fractional <span class="keyword">portion</span> <span class="keyword">of</span> the <span class="keyword">result</span> based <span class="keyword">on</span> a <span class="number">31</span><span class="operator">-</span><span class="keyword">day</span> <span class="keyword">month</span> <span class="keyword">and</span> considers the difference <span class="keyword">in</span> <span class="type">time</span> components date1 <span class="keyword">and</span> date2.</span><br><span class="line">date1 <span class="keyword">and</span> date2 type can be <span class="type">date</span>, <span class="type">timestamp</span> <span class="keyword">or</span> string <span class="keyword">in</span> the format <span class="string">&#x27;yyyy-MM-dd&#x27;</span> <span class="keyword">or</span> <span class="string">&#x27;yyyy-MM-dd HH:mm:ss&#x27;</span>. The <span class="keyword">result</span> <span class="keyword">is</span> rounded <span class="keyword">to</span> <span class="number">8</span> <span class="type">decimal</span> places <span class="keyword">by</span> default. <span class="keyword">Set</span> roundOff<span class="operator">=</span><span class="literal">false</span> otherwise.</span><br><span class="line"> Example:</span><br><span class="line">  <span class="operator">&gt;</span> <span class="keyword">SELECT</span> months_between(<span class="string">&#x27;1997-02-28 10:30:00&#x27;</span>, <span class="string">&#x27;1996-10-30&#x27;</span>);</span><br><span class="line"> <span class="number">3.94959677</span></span><br><span class="line"><span class="keyword">Function</span> class:org.apache.hadoop.hive.ql.udf.generic.GenericUDFMonthsBetween</span><br><span class="line"><span class="keyword">Function</span> type:BUILTIN</span><br><span class="line"><span class="type">Time</span> taken: <span class="number">0.016</span> seconds, Fetched: <span class="number">8</span> <span class="type">row</span>(s)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>add_months:当前日期往后加几个月，可以加正数，也可以加负数</p><figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">hive (<span class="keyword">default</span>)&gt; desc <span class="keyword">function</span> extended add_months;</span><br><span class="line">OK</span><br><span class="line">tab_name</span><br><span class="line">add_months(start_date, num_months, output_date_format) - Returns the <span class="type">date</span> that <span class="built_in">is</span> num_months after start_date.</span><br><span class="line">start_date <span class="built_in">is</span> a <span class="type">string</span> <span class="built_in">or</span> timestamp indicating a valid <span class="type">date</span>. num_months <span class="built_in">is</span> a number. output_date_format <span class="built_in">is</span> an <span class="keyword">optional</span> <span class="type">String</span> which specifies the format <span class="keyword">for</span> output.</span><br><span class="line">The <span class="keyword">default</span> output format <span class="built_in">is</span> <span class="comment">&#x27;YYYY-MM-dd&#x27;.</span></span><br><span class="line"><span class="symbol">Example:</span></span><br><span class="line">  &gt; <span class="keyword">SELECT</span> add_months(<span class="comment">&#x27;2009-08-31&#x27;, 1) FROM src LIMIT 1;</span></span><br><span class="line"> <span class="comment">&#x27;2009-09-30&#x27;.</span></span><br><span class="line">  &gt; <span class="keyword">SELECT</span> add_months(<span class="comment">&#x27;2017-12-31 14:15:16&#x27;, 2, &#x27;YYYY-MM-dd HH:mm:ss&#x27;) LIMIT 1;</span></span><br><span class="line"><span class="comment">&#x27;2018-02-28 14:15:16&#x27;.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Function</span> <span class="keyword">class</span>:org.apache.hadoop.hive.ql.udf.generic.GenericUDFAddMonths</span><br><span class="line"><span class="keyword">Function</span> type:BUILTIN</span><br><span class="line">Time taken: <span class="number">0.014</span> seconds, Fetched: <span class="number">11</span> row(s)</span><br></pre></td></tr></table></figure><p>datediff:两个日期相差几天：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">hive (<span class="keyword">default</span>)<span class="operator">&gt;</span> <span class="keyword">desc</span> <span class="keyword">function</span> extended datediff;</span><br><span class="line">OK</span><br><span class="line">tab_name</span><br><span class="line">datediff(date1, date2) <span class="operator">-</span> <span class="keyword">Returns</span> the number <span class="keyword">of</span> days <span class="keyword">between</span> date1 <span class="keyword">and</span> date2</span><br><span class="line">date1 <span class="keyword">and</span> date2 <span class="keyword">are</span> strings <span class="keyword">in</span> the format <span class="string">&#x27;yyyy-MM-dd HH:mm:ss&#x27;</span> <span class="keyword">or</span> <span class="string">&#x27;yyyy-MM-dd&#x27;</span>. The <span class="type">time</span> parts <span class="keyword">are</span> ignored.If date1 <span class="keyword">is</span> earlier than date2, the <span class="keyword">result</span> <span class="keyword">is</span> negative.</span><br><span class="line">Example:</span><br><span class="line">   <span class="operator">&gt;</span> <span class="keyword">SELECT</span> datediff(<span class="string">&#x27;2009-07-30&#x27;</span>, <span class="string">&#x27;2009-07-31&#x27;</span>) <span class="keyword">FROM</span> src LIMIT <span class="number">1</span>;</span><br><span class="line">  <span class="number">1</span></span><br><span class="line"><span class="keyword">Function</span> class:org.apache.hadoop.hive.ql.udf.generic.GenericUDFDateDiff</span><br><span class="line"><span class="keyword">Function</span> type:BUILTIN</span><br><span class="line"><span class="type">Time</span> taken: <span class="number">0.025</span> seconds, Fetched: <span class="number">7</span> <span class="type">row</span>(s)</span><br><span class="line">hive (<span class="keyword">default</span>)<span class="operator">&gt;</span> </span><br><span class="line"></span><br></pre></td></tr></table></figure><p>date_add:数字可以变成-1的</p><figure class="highlight vhdl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">hive (<span class="keyword">default</span>)&gt; desc <span class="keyword">function</span> extended date_add;</span><br><span class="line">OK</span><br><span class="line">tab_name</span><br><span class="line">date_add(start_date, num_days) - Returns the date that <span class="keyword">is</span> num_days <span class="keyword">after</span> start_date.</span><br><span class="line">start_date <span class="keyword">is</span> a <span class="built_in">string</span> <span class="keyword">in</span> the format <span class="symbol">&#x27;yyyy</span>-MM-dd HH:mm:ss&#x27; <span class="keyword">or</span> <span class="symbol">&#x27;yyyy</span>-MM-dd&#x27;. num_days <span class="keyword">is</span> a number. The <span class="built_in">time</span> part <span class="keyword">of</span> start_date <span class="keyword">is</span> ignored.</span><br><span class="line">Example:</span><br><span class="line">   &gt; <span class="keyword">SELECT</span> date_add(&#x27;<span class="number">2009</span>-<span class="number">07</span>-<span class="number">30</span>&#x27;, <span class="number">1</span>) FROM src LIMIT <span class="number">1</span>;</span><br><span class="line">  &#x27;<span class="number">2009</span>-<span class="number">07</span>-<span class="number">31</span>&#x27;</span><br><span class="line"><span class="keyword">Function</span> class:org.apache.hadoop.hive.ql.udf.<span class="keyword">generic</span>.GenericUDFDateAdd</span><br><span class="line"><span class="keyword">Function</span> <span class="keyword">type</span>:BUILTIN</span><br><span class="line"><span class="built_in">Time</span> taken: <span class="number">0.014</span> seconds, Fetched: <span class="number">7</span> row(s)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>last_day:有类型限制</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">hive (<span class="keyword">default</span>)<span class="operator">&gt;</span> <span class="keyword">desc</span> <span class="keyword">function</span> extended last_day;</span><br><span class="line">OK</span><br><span class="line">tab_name</span><br><span class="line">last_day(<span class="type">date</span>) <span class="operator">-</span> <span class="keyword">Returns</span> the <span class="keyword">last</span> <span class="keyword">day</span> <span class="keyword">of</span> the <span class="keyword">month</span> which the <span class="type">date</span> belongs to.</span><br><span class="line"><span class="type">date</span> <span class="keyword">is</span> a string <span class="keyword">in</span> the format <span class="string">&#x27;yyyy-MM-dd HH:mm:ss&#x27;</span> <span class="keyword">or</span> <span class="string">&#x27;yyyy-MM-dd&#x27;</span>. The <span class="type">time</span> part <span class="keyword">of</span> <span class="type">date</span> <span class="keyword">is</span> ignored.</span><br><span class="line">Example:</span><br><span class="line">  <span class="operator">&gt;</span> <span class="keyword">SELECT</span> last_day(<span class="string">&#x27;2009-01-12&#x27;</span>) <span class="keyword">FROM</span> src LIMIT <span class="number">1</span>;</span><br><span class="line"> <span class="string">&#x27;2009-01-31&#x27;</span></span><br><span class="line"><span class="keyword">Function</span> class:org.apache.hadoop.hive.ql.udf.generic.GenericUDFLastDay</span><br><span class="line"><span class="keyword">Function</span> type:BUILTIN</span><br><span class="line"><span class="type">Time</span> taken: <span class="number">0.015</span> seconds, Fetched: <span class="number">7</span> <span class="type">row</span>(s)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>日期格式 ： date_foermat &#x3D;&gt;重要</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">hive (<span class="keyword">default</span>)&gt; <span class="keyword">desc</span> <span class="keyword">function</span> extended date_format;</span><br><span class="line">OK</span><br><span class="line">tab_name</span><br><span class="line">date_format(<span class="type">date</span>/<span class="type">timestamp</span>/string, fmt) - converts a <span class="type">date</span>/<span class="type">timestamp</span>/string <span class="keyword">to</span> a <span class="keyword">value</span> <span class="keyword">of</span> string <span class="keyword">in</span> the <span class="keyword">format</span> specified <span class="keyword">by</span> the <span class="type">date</span> <span class="keyword">format</span> fmt.</span><br><span class="line">Supported formats are SimpleDateFormat formats - https://docs.oracle.com/javase/<span class="number">7</span>/docs/api/java/<span class="type">text</span>/SimpleDateFormat.html. Second argument fmt should be <span class="keyword">constant</span>.</span><br><span class="line">Example: &gt; <span class="keyword">SELECT</span> date_format(<span class="string">&#x27;2015-04-08&#x27;</span>, <span class="string">&#x27;y&#x27;</span>);</span><br><span class="line"> <span class="string">&#x27;2015&#x27;</span></span><br><span class="line"><span class="keyword">Function</span> <span class="keyword">class</span>:org.apache.hadoop.hive.ql.udf.generic.GenericUDFDateFormat</span><br><span class="line"><span class="keyword">Function</span> <span class="keyword">type</span>:BUILTIN</span><br><span class="line"><span class="type">Time</span> taken: <span class="number">0.014</span> seconds, Fetched: <span class="number">6</span> <span class="keyword">row</span>(s)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>内置的时间函数大体over</p><h2 id="算数相关的函数"><a href="#算数相关的函数" class="headerlink" title="算数相关的函数"></a>算数相关的函数</h2><p>round：小数点后面几位</p><figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">hive (<span class="keyword">default</span>)&gt; desc <span class="keyword">function</span> extended round;</span><br><span class="line">OK</span><br><span class="line">tab_name</span><br><span class="line">round(x[, d]) - round x <span class="keyword">to</span> d <span class="type">decimal</span> places</span><br><span class="line"><span class="symbol">Example:</span></span><br><span class="line">  &gt; <span class="keyword">SELECT</span> round(<span class="number">12.3456</span>, <span class="number">1</span>) <span class="keyword">FROM</span> src LIMIT <span class="number">1</span>;</span><br><span class="line">  <span class="number">12.3</span><span class="comment">&#x27;</span></span><br><span class="line"><span class="keyword">Function</span> <span class="keyword">class</span>:org.apache.hadoop.hive.ql.udf.generic.GenericUDFRound</span><br><span class="line"><span class="keyword">Function</span> type:BUILTIN</span><br><span class="line">Time taken: <span class="number">0.021</span> seconds, Fetched: <span class="number">6</span> row(s)</span><br></pre></td></tr></table></figure><p>ceil ： 取整 ，就是返回一个最小的整数，向上取整</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">hive (<span class="keyword">default</span>)<span class="operator">&gt;</span> <span class="keyword">desc</span> <span class="keyword">function</span> extended ceil;</span><br><span class="line">OK</span><br><span class="line">tab_name</span><br><span class="line"><span class="built_in">ceil</span>(x) <span class="operator">-</span> Find the smallest <span class="type">integer</span> <span class="keyword">not</span> smaller than x</span><br><span class="line">Synonyms: ceiling</span><br><span class="line">Example:</span><br><span class="line">  <span class="operator">&gt;</span> <span class="keyword">SELECT</span> <span class="built_in">ceil</span>(<span class="number">-0.1</span>) <span class="keyword">FROM</span> src LIMIT <span class="number">1</span>;</span><br><span class="line">  <span class="number">0</span></span><br><span class="line">  <span class="operator">&gt;</span> <span class="keyword">SELECT</span> <span class="built_in">ceil</span>(<span class="number">5</span>) <span class="keyword">FROM</span> src LIMIT <span class="number">1</span>;</span><br><span class="line">  <span class="number">5</span></span><br><span class="line"><span class="keyword">Function</span> class:org.apache.hadoop.hive.ql.udf.generic.GenericUDFCeil</span><br><span class="line"><span class="keyword">Function</span> type:BUILTIN</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>floor：向下取整</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">hive (<span class="keyword">default</span>)<span class="operator">&gt;</span> <span class="keyword">desc</span> <span class="keyword">function</span> extended floor;</span><br><span class="line">OK</span><br><span class="line">tab_name</span><br><span class="line"><span class="built_in">floor</span>(x) <span class="operator">-</span> Find the largest <span class="type">integer</span> <span class="keyword">not</span> greater than x</span><br><span class="line">Example:</span><br><span class="line">  <span class="operator">&gt;</span> <span class="keyword">SELECT</span> <span class="built_in">floor</span>(<span class="number">-0.1</span>) <span class="keyword">FROM</span> src LIMIT <span class="number">1</span>;</span><br><span class="line">  <span class="number">-1</span></span><br><span class="line">  <span class="operator">&gt;</span> <span class="keyword">SELECT</span> <span class="built_in">floor</span>(<span class="number">5</span>) <span class="keyword">FROM</span> src LIMIT <span class="number">1</span>;</span><br><span class="line">  <span class="number">5</span></span><br><span class="line"><span class="keyword">Function</span> class:org.apache.hadoop.hive.ql.udf.generic.GenericUDFFloor</span><br><span class="line"><span class="keyword">Function</span> type:BUILTIN</span><br><span class="line"><span class="type">Time</span> taken: <span class="number">0.016</span> seconds, Fetched: <span class="number">8</span> <span class="type">row</span>(s)</span><br></pre></td></tr></table></figure><p>rand：随机数</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">hive (<span class="keyword">default</span>)&gt; <span class="keyword">desc</span> <span class="keyword">function</span> extended rand;</span><br><span class="line">OK</span><br><span class="line">tab_name</span><br><span class="line">rand([seed]) - <span class="keyword">Returns</span> a pseudorandom number <span class="keyword">between</span> <span class="number">0</span> <span class="keyword">and</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">Function</span> <span class="keyword">class</span>:org.apache.hadoop.hive.ql.udf.UDFRand</span><br><span class="line"><span class="keyword">Function</span> <span class="keyword">type</span>:BUILTIN</span><br><span class="line"><span class="type">Time</span> taken: <span class="number">0.016</span> seconds, Fetched: <span class="number">3</span> <span class="keyword">row</span>(s)</span><br></pre></td></tr></table></figure><h2 id="字符串相关的"><a href="#字符串相关的" class="headerlink" title="字符串相关的"></a>字符串相关的</h2><p>upper，lower,length</p><p>length:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">hive (<span class="keyword">default</span>)<span class="operator">&gt;</span> <span class="keyword">desc</span> <span class="keyword">function</span> extended length;</span><br><span class="line">OK</span><br><span class="line">tab_name</span><br><span class="line">length(str <span class="operator">|</span> <span class="type">binary</span>) <span class="operator">-</span> <span class="keyword">Returns</span> the length <span class="keyword">of</span> str <span class="keyword">or</span> number <span class="keyword">of</span> bytes <span class="keyword">in</span> <span class="type">binary</span> data</span><br><span class="line">Example:</span><br><span class="line">  <span class="operator">&gt;</span> <span class="keyword">SELECT</span> length(<span class="string">&#x27;Facebook&#x27;</span>) <span class="keyword">FROM</span> src LIMIT <span class="number">1</span>;</span><br><span class="line">  <span class="number">8</span></span><br><span class="line"><span class="keyword">Function</span> class:org.apache.hadoop.hive.ql.udf.generic.GenericUDFLength</span><br><span class="line"><span class="keyword">Function</span> type:BUILTIN</span><br><span class="line"><span class="type">Time</span> taken: <span class="number">0.014</span> seconds, Fetched: <span class="number">6</span> <span class="type">row</span>(s)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>trim:去除前后空格</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">hive (<span class="keyword">default</span>)<span class="operator">&gt;</span> <span class="keyword">desc</span> <span class="keyword">function</span> extended trim;</span><br><span class="line">OK</span><br><span class="line">tab_name</span><br><span class="line"><span class="built_in">trim</span>(str) <span class="operator">-</span> Removes the <span class="keyword">leading</span> <span class="keyword">and</span> <span class="keyword">trailing</span> space characters <span class="keyword">from</span> str </span><br><span class="line">Example:</span><br><span class="line">  <span class="operator">&gt;</span> <span class="keyword">SELECT</span> <span class="built_in">trim</span>(<span class="string">&#x27;   facebook  &#x27;</span>) <span class="keyword">FROM</span> src LIMIT <span class="number">1</span>;</span><br><span class="line">  <span class="string">&#x27;facebook&#x27;</span></span><br><span class="line"><span class="keyword">Function</span> class:org.apache.hadoop.hive.ql.udf.generic.GenericUDFTrim</span><br><span class="line"><span class="keyword">Function</span> type:BUILTIN</span><br><span class="line"><span class="type">Time</span> taken: <span class="number">0.014</span> seconds, Fetched: <span class="number">6</span> <span class="type">row</span>(s)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>upper:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">hive (<span class="keyword">default</span>)<span class="operator">&gt;</span> <span class="keyword">desc</span> <span class="keyword">function</span> extended upper;</span><br><span class="line">OK</span><br><span class="line">tab_name</span><br><span class="line"><span class="built_in">upper</span>(str) <span class="operator">-</span> <span class="keyword">Returns</span> str <span class="keyword">with</span> <span class="keyword">all</span> characters changed <span class="keyword">to</span> uppercase</span><br><span class="line">Synonyms: ucase</span><br><span class="line">Example:</span><br><span class="line">  <span class="operator">&gt;</span> <span class="keyword">SELECT</span> <span class="built_in">upper</span>(<span class="string">&#x27;Facebook&#x27;</span>) <span class="keyword">FROM</span> src LIMIT <span class="number">1</span>;</span><br><span class="line">  <span class="string">&#x27;FACEBOOK&#x27;</span></span><br><span class="line"><span class="keyword">Function</span> class:org.apache.hadoop.hive.ql.udf.generic.GenericUDFUpper</span><br><span class="line"><span class="keyword">Function</span> type:BUILTIN</span><br><span class="line"><span class="type">Time</span> taken: <span class="number">0.018</span> seconds, Fetched: <span class="number">7</span> <span class="type">row</span>(s)</span><br></pre></td></tr></table></figure><p>lower:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">hive (<span class="keyword">default</span>)<span class="operator">&gt;</span> <span class="keyword">desc</span> <span class="keyword">function</span> extended lower;</span><br><span class="line">OK</span><br><span class="line">tab_name</span><br><span class="line"><span class="built_in">lower</span>(str) <span class="operator">-</span> <span class="keyword">Returns</span> str <span class="keyword">with</span> <span class="keyword">all</span> characters changed <span class="keyword">to</span> lowercase</span><br><span class="line">Synonyms: lcase</span><br><span class="line">Example:</span><br><span class="line">  <span class="operator">&gt;</span> <span class="keyword">SELECT</span> <span class="built_in">lower</span>(<span class="string">&#x27;Facebook&#x27;</span>) <span class="keyword">FROM</span> src LIMIT <span class="number">1</span>;</span><br><span class="line">  <span class="string">&#x27;facebook&#x27;</span></span><br><span class="line"><span class="keyword">Function</span> class:org.apache.hadoop.hive.ql.udf.generic.GenericUDFLower</span><br><span class="line"><span class="keyword">Function</span> type:BUILTIN</span><br><span class="line"><span class="type">Time</span> taken: <span class="number">0.013</span> seconds, Fetched: <span class="number">7</span> <span class="type">row</span>(s)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>lpad:左边补齐</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">hive (<span class="keyword">default</span>)<span class="operator">&gt;</span> <span class="keyword">desc</span> <span class="keyword">function</span> extended lpad;</span><br><span class="line">OK</span><br><span class="line">tab_name</span><br><span class="line">lpad(str, len, pad) <span class="operator">-</span> <span class="keyword">Returns</span> str, <span class="keyword">left</span><span class="operator">-</span>padded <span class="keyword">with</span> pad <span class="keyword">to</span> a length <span class="keyword">of</span> len</span><br><span class="line">If str <span class="keyword">is</span> longer than len, the <span class="keyword">return</span> <span class="keyword">value</span> <span class="keyword">is</span> shortened <span class="keyword">to</span> len characters.</span><br><span class="line"><span class="keyword">In</span> <span class="keyword">case</span> <span class="keyword">of</span> <span class="keyword">empty</span> pad string, the <span class="keyword">return</span> <span class="keyword">value</span> <span class="keyword">is</span> null.</span><br><span class="line">Example:</span><br><span class="line">  <span class="operator">&gt;</span> <span class="keyword">SELECT</span> lpad(<span class="string">&#x27;hi&#x27;</span>, <span class="number">5</span>, <span class="string">&#x27;??&#x27;</span>) <span class="keyword">FROM</span> src LIMIT <span class="number">1</span>;</span><br><span class="line">  <span class="string">&#x27;???hi&#x27;</span></span><br><span class="line">  <span class="operator">&gt;</span> <span class="keyword">SELECT</span> lpad(<span class="string">&#x27;hi&#x27;</span>, <span class="number">1</span>, <span class="string">&#x27;??&#x27;</span>) <span class="keyword">FROM</span> src LIMIT <span class="number">1</span>;</span><br><span class="line">  <span class="string">&#x27;h&#x27;</span></span><br><span class="line">  <span class="operator">&gt;</span> <span class="keyword">SELECT</span> lpad(<span class="string">&#x27;hi&#x27;</span>, <span class="number">5</span>, <span class="string">&#x27;&#x27;</span>) <span class="keyword">FROM</span> src LIMIT <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">null</span></span><br><span class="line"><span class="keyword">Function</span> class:org.apache.hadoop.hive.ql.udf.generic.GenericUDFLpad</span><br><span class="line"><span class="keyword">Function</span> type:BUILTIN</span><br><span class="line"><span class="type">Time</span> taken: <span class="number">0.012</span> seconds, Fetched: <span class="number">12</span> <span class="type">row</span>(s)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>rpad:右边补齐</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">hive (<span class="keyword">default</span>)<span class="operator">&gt;</span> <span class="keyword">desc</span> <span class="keyword">function</span> extended rpad;</span><br><span class="line">OK</span><br><span class="line">tab_name</span><br><span class="line">rpad(str, len, pad) <span class="operator">-</span> <span class="keyword">Returns</span> str, <span class="keyword">right</span><span class="operator">-</span>padded <span class="keyword">with</span> pad <span class="keyword">to</span> a length <span class="keyword">of</span> len</span><br><span class="line">If str <span class="keyword">is</span> longer than len, the <span class="keyword">return</span> <span class="keyword">value</span> <span class="keyword">is</span> shortened <span class="keyword">to</span> len characters.</span><br><span class="line"><span class="keyword">In</span> <span class="keyword">case</span> <span class="keyword">of</span> <span class="keyword">empty</span> pad string, the <span class="keyword">return</span> <span class="keyword">value</span> <span class="keyword">is</span> null.</span><br><span class="line">Example:</span><br><span class="line">  <span class="operator">&gt;</span> <span class="keyword">SELECT</span> rpad(<span class="string">&#x27;hi&#x27;</span>, <span class="number">5</span>, <span class="string">&#x27;??&#x27;</span>) <span class="keyword">FROM</span> src LIMIT <span class="number">1</span>;</span><br><span class="line">  <span class="string">&#x27;hi???&#x27;</span></span><br><span class="line">  <span class="operator">&gt;</span> <span class="keyword">SELECT</span> rpad(<span class="string">&#x27;hi&#x27;</span>, <span class="number">1</span>, <span class="string">&#x27;??&#x27;</span>) <span class="keyword">FROM</span> src LIMIT <span class="number">1</span>;</span><br><span class="line">  <span class="string">&#x27;h&#x27;</span></span><br><span class="line">  <span class="operator">&gt;</span> <span class="keyword">SELECT</span> rpad(<span class="string">&#x27;hi&#x27;</span>, <span class="number">5</span>, <span class="string">&#x27;&#x27;</span>) <span class="keyword">FROM</span> src LIMIT <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">null</span></span><br><span class="line"><span class="keyword">Function</span> class:org.apache.hadoop.hive.ql.udf.generic.GenericUDFRpad</span><br><span class="line"><span class="keyword">Function</span> type:BUILTIN</span><br><span class="line"><span class="type">Time</span> taken: <span class="number">0.013</span> seconds, Fetched: <span class="number">12</span> <span class="type">row</span>(s)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>replace:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">hive (<span class="keyword">default</span>)<span class="operator">&gt;</span> <span class="keyword">desc</span> <span class="keyword">function</span> extended replace;</span><br><span class="line">OK</span><br><span class="line">tab_name</span><br><span class="line">replace(str, <span class="keyword">search</span>, rep) <span class="operator">-</span> replace <span class="keyword">all</span> substrings <span class="keyword">of</span> <span class="string">&#x27;str&#x27;</span> that <span class="keyword">match</span> <span class="string">&#x27;search&#x27;</span> <span class="keyword">with</span> <span class="string">&#x27;rep&#x27;</span></span><br><span class="line">Example:</span><br><span class="line">  <span class="operator">&gt;</span> <span class="keyword">SELECT</span> replace(<span class="string">&#x27;Hack and Hue&#x27;</span>, <span class="string">&#x27;H&#x27;</span>, <span class="string">&#x27;BL&#x27;</span>) <span class="keyword">FROM</span> src LIMIT <span class="number">1</span>;</span><br><span class="line">  <span class="string">&#x27;BLack and BLue&#x27;</span></span><br><span class="line"><span class="keyword">Function</span> class:org.apache.hadoop.hive.ql.udf.UDFReplace</span><br><span class="line"><span class="keyword">Function</span> type:BUILTIN</span><br><span class="line"><span class="type">Time</span> taken: <span class="number">0.014</span> seconds, Fetched: <span class="number">6</span> <span class="type">row</span>(s)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>regexp_replace:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">hive (<span class="keyword">default</span>)<span class="operator">&gt;</span> <span class="keyword">desc</span> <span class="keyword">function</span> extended regexp_replace;</span><br><span class="line">OK</span><br><span class="line">tab_name</span><br><span class="line">regexp_replace(str, regexp, rep) <span class="operator">-</span> replace <span class="keyword">all</span> substrings <span class="keyword">of</span> str that <span class="keyword">match</span> regexp <span class="keyword">with</span> rep</span><br><span class="line">Example:</span><br><span class="line">  <span class="operator">&gt;</span> <span class="keyword">SELECT</span> regexp_replace(<span class="string">&#x27;100-200&#x27;</span>, <span class="string">&#x27;(\d+)&#x27;</span>, <span class="string">&#x27;num&#x27;</span>) <span class="keyword">FROM</span> src LIMIT <span class="number">1</span>;</span><br><span class="line">  <span class="string">&#x27;num-num&#x27;</span></span><br><span class="line"><span class="keyword">Function</span> class:org.apache.hadoop.hive.ql.udf.UDFRegExpReplace</span><br><span class="line"><span class="keyword">Function</span> type:BUILTIN</span><br><span class="line"><span class="type">Time</span> taken: <span class="number">0.013</span> seconds, Fetched: <span class="number">6</span> <span class="type">row</span>(s)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>substr:字符串截取</p><figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">hive (<span class="keyword">default</span>)&gt; desc <span class="keyword">function</span> extended substr;</span><br><span class="line">OK</span><br><span class="line">tab_name</span><br><span class="line">substr(str, pos[, len]) - returns the substring <span class="keyword">of</span> str that starts at pos <span class="built_in">and</span> <span class="built_in">is</span> <span class="keyword">of</span> length len orsubstr(bin, pos[, len]) - returns the slice <span class="keyword">of</span> <span class="type">byte</span> array that starts at pos <span class="built_in">and</span> <span class="built_in">is</span> <span class="keyword">of</span> length len</span><br><span class="line"><span class="symbol">Synonyms:</span> substring</span><br><span class="line">pos <span class="built_in">is</span> a <span class="number">1</span>-based index. <span class="keyword">If</span> pos&lt;<span class="number">0</span> the starting position <span class="built_in">is</span> determined <span class="keyword">by</span> counting backwards <span class="keyword">from</span> the <span class="keyword">end</span> <span class="keyword">of</span> str.</span><br><span class="line"><span class="symbol">Example:</span></span><br><span class="line">   &gt; <span class="keyword">SELECT</span> substr(<span class="comment">&#x27;Facebook&#x27;, 5) FROM src LIMIT 1;</span></span><br><span class="line">  <span class="comment">&#x27;book&#x27;</span></span><br><span class="line">  &gt; <span class="keyword">SELECT</span> substr(<span class="comment">&#x27;Facebook&#x27;, -5) FROM src LIMIT 1;</span></span><br><span class="line">  <span class="comment">&#x27;ebook&#x27;</span></span><br><span class="line">  &gt; <span class="keyword">SELECT</span> substr(<span class="comment">&#x27;Facebook&#x27;, 5, 1) FROM src LIMIT 1;</span></span><br><span class="line">  <span class="comment">&#x27;b&#x27;</span></span><br><span class="line"><span class="keyword">Function</span> <span class="keyword">class</span>:org.apache.hadoop.hive.ql.udf.UDFSubstr</span><br><span class="line"><span class="keyword">Function</span> type:BUILTIN</span><br><span class="line">Time taken: <span class="number">0.014</span> seconds, Fetched: <span class="number">12</span> row(s)</span><br></pre></td></tr></table></figure><p>concat：字符串拼接</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">hive (<span class="keyword">default</span>)<span class="operator">&gt;</span> <span class="keyword">desc</span> <span class="keyword">function</span> extended concat;</span><br><span class="line">OK</span><br><span class="line">tab_name</span><br><span class="line">concat(str1, str2, ... strN) <span class="operator">-</span> <span class="keyword">returns</span> the concatenation <span class="keyword">of</span> str1, str2, ... strN <span class="keyword">or</span> concat(bin1, bin2, ... binN) <span class="operator">-</span> <span class="keyword">returns</span> the concatenation <span class="keyword">of</span> bytes <span class="keyword">in</span> <span class="type">binary</span> data  bin1, bin2, ... binN</span><br><span class="line"><span class="keyword">Returns</span> <span class="keyword">NULL</span> if <span class="keyword">any</span> argument <span class="keyword">is</span> NULL.</span><br><span class="line">Example:</span><br><span class="line">  <span class="operator">&gt;</span> <span class="keyword">SELECT</span> concat(<span class="string">&#x27;abc&#x27;</span>, <span class="string">&#x27;def&#x27;</span>) <span class="keyword">FROM</span> src LIMIT <span class="number">1</span>;</span><br><span class="line">  <span class="string">&#x27;abcdef&#x27;</span></span><br><span class="line"><span class="keyword">Function</span> class:org.apache.hadoop.hive.ql.udf.generic.GenericUDFConcat</span><br><span class="line"><span class="keyword">Function</span> type:BUILTIN</span><br><span class="line"><span class="type">Time</span> taken: <span class="number">0.013</span> seconds, Fetched: <span class="number">7</span> <span class="type">row</span>(s)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>concat_ws:上个的高级版</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">hive (<span class="keyword">default</span>)<span class="operator">&gt;</span> <span class="keyword">desc</span> <span class="keyword">function</span> extended concat_ws;</span><br><span class="line">OK</span><br><span class="line">tab_name</span><br><span class="line">concat_ws(separator, [string <span class="operator">|</span> <span class="keyword">array</span>(string)]<span class="operator">+</span>) <span class="operator">-</span> <span class="keyword">returns</span> the concatenation <span class="keyword">of</span> the strings separated <span class="keyword">by</span> the separator.</span><br><span class="line">Example:</span><br><span class="line">  <span class="operator">&gt;</span> <span class="keyword">SELECT</span> concat_ws(<span class="string">&#x27;.&#x27;</span>, <span class="string">&#x27;www&#x27;</span>, <span class="keyword">array</span>(<span class="string">&#x27;facebook&#x27;</span>, <span class="string">&#x27;com&#x27;</span>)) <span class="keyword">FROM</span> src LIMIT <span class="number">1</span>;</span><br><span class="line">  <span class="string">&#x27;www.facebook.com&#x27;</span></span><br><span class="line"><span class="keyword">Function</span> class:org.apache.hadoop.hive.ql.udf.generic.GenericUDFConcatWS</span><br><span class="line"><span class="keyword">Function</span> type:BUILTIN</span><br><span class="line"><span class="type">Time</span> taken: <span class="number">0.013</span> seconds, Fetched: <span class="number">6</span> <span class="type">row</span>(s)</span><br><span class="line">hive (<span class="keyword">default</span>)<span class="operator">&gt;</span> </span><br><span class="line"></span><br></pre></td></tr></table></figure><p>split：字符串分割</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">hive (<span class="keyword">default</span>)<span class="operator">&gt;</span> <span class="keyword">desc</span> <span class="keyword">function</span> extended split;</span><br><span class="line">OK</span><br><span class="line">tab_name</span><br><span class="line">split(str, regex) <span class="operator">-</span> Splits str around occurances that <span class="keyword">match</span> regex</span><br><span class="line">Example:</span><br><span class="line">  <span class="operator">&gt;</span> <span class="keyword">SELECT</span> split(<span class="string">&#x27;oneAtwoBthreeC&#x27;</span>, <span class="string">&#x27;[ABC]&#x27;</span>) <span class="keyword">FROM</span> src LIMIT <span class="number">1</span>;</span><br><span class="line">  [&quot;one&quot;, &quot;two&quot;, &quot;three&quot;]</span><br><span class="line"><span class="keyword">Function</span> class:org.apache.hadoop.hive.ql.udf.generic.GenericUDFSplit</span><br><span class="line"><span class="keyword">Function</span> type:BUILTIN</span><br><span class="line"><span class="type">Time</span> taken: <span class="number">0.015</span> seconds, Fetched: <span class="number">6</span> <span class="type">row</span>(s)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="json相关的数据处理"><a href="#json相关的数据处理" class="headerlink" title="json相关的数据处理"></a>json相关的数据处理</h2><p>get_json_object</p><figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">hive (<span class="keyword">default</span>)&gt; desc <span class="keyword">function</span> extended get_json_object;</span><br><span class="line">OK</span><br><span class="line">tab_name</span><br><span class="line">get_json_object(json_txt, path) - Extract a json <span class="type">object</span> <span class="keyword">from</span> path </span><br><span class="line">Extract json <span class="type">object</span> <span class="keyword">from</span> a json <span class="type">string</span> based <span class="keyword">on</span> json path specified, <span class="built_in">and</span> <span class="keyword">return</span> json <span class="type">string</span> <span class="keyword">of</span> the extracted json <span class="type">object</span>. It will <span class="keyword">return</span> null <span class="keyword">if</span> the input json <span class="type">string</span> <span class="built_in">is</span> invalid.</span><br><span class="line">A limited version <span class="keyword">of</span> JSONPath supported:</span><br><span class="line">  $   : Root <span class="type">object</span></span><br><span class="line">  .   : Child <span class="keyword">operator</span></span><br><span class="line">  []  : Subscript <span class="keyword">operator</span> <span class="keyword">for</span> array</span><br><span class="line">  *   : Wildcard <span class="keyword">for</span> []</span><br><span class="line">Syntax <span class="built_in">not</span> supported that<span class="comment">&#x27;s worth noticing:</span></span><br><span class="line">  <span class="comment">&#x27;&#x27;  : Zero length string as key</span></span><br><span class="line">  ..  : Recursive descent</span><br><span class="line">  @   : Current <span class="type">object</span>/element</span><br><span class="line">  ()  : Script expression</span><br><span class="line">  ?() : Filter (script) expression.</span><br><span class="line">  [,] : Union <span class="keyword">operator</span></span><br><span class="line">  [start:<span class="keyword">end</span>:<span class="keyword">step</span>] : array slice <span class="keyword">operator</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Function</span> <span class="keyword">class</span>:org.apache.hadoop.hive.ql.udf.UDFJson</span><br><span class="line"><span class="keyword">Function</span> type:BUILTIN</span><br><span class="line">Time taken: <span class="number">0.016</span> seconds, Fetched: <span class="number">18</span> row(s)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>json_tuple:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">hive (<span class="keyword">default</span>)<span class="operator">&gt;</span> <span class="keyword">desc</span> <span class="keyword">function</span> extended json_tuple;</span><br><span class="line">OK</span><br><span class="line">tab_name</span><br><span class="line">json_tuple(jsonStr, p1, p2, ..., pn) <span class="operator">-</span> <span class="keyword">like</span> get_json_object, but it takes multiple names <span class="keyword">and</span> <span class="keyword">return</span> a tuple. <span class="keyword">All</span> the input parameters <span class="keyword">and</span> output <span class="keyword">column</span> types <span class="keyword">are</span> string.</span><br><span class="line"><span class="keyword">Function</span> class:org.apache.hadoop.hive.ql.udf.generic.GenericUDTFJSONTuple</span><br><span class="line"><span class="keyword">Function</span> type:BUILTIN</span><br><span class="line"><span class="type">Time</span> taken: <span class="number">0.014</span> seconds, Fetched: <span class="number">3</span> <span class="type">row</span>(s)</span><br><span class="line"><span class="comment">----------------------------------------</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>例子：现在我的数据库里有如下数据：</p><figure class="highlight wren"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">hive</span> (<span class="variable">bigdata_hive3</span>)<span class="operator">&gt;</span> <span class="variable">select</span> <span class="operator">*</span> <span class="variable">from</span> <span class="variable">skill</span> <span class="variable">limit</span> <span class="number">10</span>;</span><br><span class="line"><span class="variable">OK</span></span><br><span class="line"><span class="variable">skill</span>.<span class="property">json</span></span><br><span class="line">[</span><br><span class="line">    <span class="literal">null</span>,</span><br><span class="line">    &#123; <span class="string">&quot;id&quot;</span>: <span class="number">1</span>, <span class="string">&quot;animationId&quot;</span>: <span class="number">1</span>, <span class="string">&quot;damage&quot;</span>: &#123; <span class="string">&quot;critical&quot;</span>: <span class="literal">true</span>, <span class="string">&quot;elementId&quot;</span>: <span class="number">-1</span>, <span class="string">&quot;formula&quot;</span>: <span class="string">&quot;a.atk * 4 - b.def * 2&quot;</span>, <span class="string">&quot;type&quot;</span>: <span class="number">1</span>, <span class="string">&quot;variance&quot;</span>: <span class="number">20</span> &#125;, <span class="string">&quot;description&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="string">&quot;effects&quot;</span>: [&#123; <span class="string">&quot;code&quot;</span>: <span class="number">21</span>, <span class="string">&quot;dataId&quot;</span>: <span class="number">0</span>, <span class="string">&quot;value1&quot;</span>: <span class="number">1</span>, <span class="string">&quot;value2&quot;</span>: <span class="number">0</span> &#125;], <span class="string">&quot;hitType&quot;</span>: <span class="number">1</span>, <span class="string">&quot;iconIndex&quot;</span>: <span class="number">880</span>, <span class="string">&quot;message1&quot;</span>: <span class="string">&quot;%1的攻击！&quot;</span>, <span class="string">&quot;message2&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="string">&quot;mpCost&quot;</span>: <span class="number">0</span>, <span class="string">&quot;name&quot;</span>: <span class="string">&quot;攻击&quot;</span>, <span class="string">&quot;note&quot;</span>: <span class="string">&quot;1 号技能会在选择“攻击”指令时使用。<span class="char escape_">\n</span><span class="char escape_">\n</span>&lt;setup action&gt;<span class="char escape_">\n</span>display action<span class="char escape_">\n</span>immortal: targets, true<span class="char escape_">\n</span>&lt;/setup action&gt;<span class="char escape_">\n</span><span class="char escape_">\n</span>&lt;target action&gt;<span class="char escape_">\n</span>if user.attackMotion() !== &#x27;missile&#x27;<span class="char escape_">\n</span>move user: targets, front, 20<span class="char escape_">\n</span>else<span class="char escape_">\n</span>perform start<span class="char escape_">\n</span>end<span class="char escape_">\n</span>wait for movement<span class="char escape_">\n</span>motion attack: user<span class="char escape_">\n</span><span class="char escape_">\n</span>attack animation: target<span class="char escape_">\n</span>wait for animation<span class="char escape_">\n</span>action effect<span class="char escape_">\n</span>&lt;/target action&gt;&quot;</span>, <span class="string">&quot;occasion&quot;</span>: <span class="number">1</span>, <span class="string">&quot;repeats&quot;</span>: <span class="number">1</span>, <span class="string">&quot;requiredWtypeId1&quot;</span>: <span class="number">0</span>, <span class="string">&quot;requiredWtypeId2&quot;</span>: <span class="number">0</span>, <span class="string">&quot;scope&quot;</span>: <span class="number">1</span>, <span class="string">&quot;speed&quot;</span>: <span class="number">0</span>, <span class="string">&quot;stypeId&quot;</span>: <span class="number">0</span>, <span class="string">&quot;successRate&quot;</span>: <span class="number">100</span>, <span class="string">&quot;tpCost&quot;</span>: <span class="number">0</span>, <span class="string">&quot;tpGain&quot;</span>: <span class="number">10</span>, <span class="string">&quot;messageType&quot;</span>: <span class="number">1</span> &#125;,</span><br><span class="line">    &#123; <span class="string">&quot;id&quot;</span>: <span class="number">2</span>, <span class="string">&quot;animationId&quot;</span>: <span class="number">0</span>, <span class="string">&quot;damage&quot;</span>: &#123; <span class="string">&quot;critical&quot;</span>: <span class="literal">false</span>, <span class="string">&quot;elementId&quot;</span>: <span class="number">0</span>, <span class="string">&quot;formula&quot;</span>: <span class="string">&quot;0&quot;</span>, <span class="string">&quot;type&quot;</span>: <span class="number">0</span>, <span class="string">&quot;variance&quot;</span>: <span class="number">20</span> &#125;, <span class="string">&quot;description&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="string">&quot;effects&quot;</span>: [&#123; <span class="string">&quot;code&quot;</span>: <span class="number">21</span>, <span class="string">&quot;dataId&quot;</span>: <span class="number">2</span>, <span class="string">&quot;value1&quot;</span>: <span class="number">1</span>, <span class="string">&quot;value2&quot;</span>: <span class="number">0</span> &#125;], <span class="string">&quot;hitType&quot;</span>: <span class="number">0</span>, <span class="string">&quot;iconIndex&quot;</span>: <span class="number">688</span>, <span class="string">&quot;message1&quot;</span>: <span class="string">&quot;%1正在保护自己。&quot;</span>, <span class="string">&quot;message2&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="string">&quot;mpCost&quot;</span>: <span class="number">0</span>, <span class="string">&quot;name&quot;</span>: <span class="string">&quot;防御&quot;</span>, <span class="string">&quot;note&quot;</span>: <span class="string">&quot;1 号技能会在选择“防御”指令时使用。&quot;</span>, <span class="string">&quot;occasion&quot;</span>: <span class="number">1</span>, <span class="string">&quot;repeats&quot;</span>: <span class="number">1</span>, <span class="string">&quot;requiredWtypeId1&quot;</span>: <span class="number">0</span>, <span class="string">&quot;requiredWtypeId2&quot;</span>: <span class="number">0</span>, <span class="string">&quot;scope&quot;</span>: <span class="number">11</span>, <span class="string">&quot;speed&quot;</span>: <span class="number">10</span>, <span class="string">&quot;stypeId&quot;</span>: <span class="number">0</span>, <span class="string">&quot;successRate&quot;</span>: <span class="number">100</span>, <span class="string">&quot;tpCost&quot;</span>: <span class="number">0</span>, <span class="string">&quot;tpGain&quot;</span>: <span class="number">10</span>, <span class="string">&quot;messageType&quot;</span>: <span class="number">1</span> &#125;,</span><br><span class="line">    &#123; <span class="string">&quot;id&quot;</span>: <span class="number">3</span>, <span class="string">&quot;animationId&quot;</span>: <span class="number">-1</span>, <span class="string">&quot;damage&quot;</span>: &#123; <span class="string">&quot;critical&quot;</span>: <span class="literal">true</span>, <span class="string">&quot;elementId&quot;</span>: <span class="number">-1</span>, <span class="string">&quot;formula&quot;</span>: <span class="string">&quot;a.atk * 4 - b.def * 2&quot;</span>, <span class="string">&quot;type&quot;</span>: <span class="number">1</span>, <span class="string">&quot;variance&quot;</span>: <span class="number">20</span> &#125;, <span class="string">&quot;description&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="string">&quot;effects&quot;</span>: [&#123; <span class="string">&quot;code&quot;</span>: <span class="number">21</span>, <span class="string">&quot;dataId&quot;</span>: <span class="number">0</span>, <span class="string">&quot;value1&quot;</span>: <span class="number">1</span>, <span class="string">&quot;value2&quot;</span>: <span class="number">0</span> &#125;], <span class="string">&quot;hitType&quot;</span>: <span class="number">1</span>, <span class="string">&quot;iconIndex&quot;</span>: <span class="number">880</span>, <span class="string">&quot;message1&quot;</span>: <span class="string">&quot;%1的攻击！&quot;</span>, <span class="string">&quot;message2&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="string">&quot;mpCost&quot;</span>: <span class="number">0</span>, <span class="string">&quot;name&quot;</span>: <span class="string">&quot;连续攻击&quot;</span>, <span class="string">&quot;note&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="string">&quot;occasion&quot;</span>: <span class="number">1</span>, <span class="string">&quot;repeats&quot;</span>: <span class="number">2</span>, <span class="string">&quot;requiredWtypeId1&quot;</span>: <span class="number">0</span>, <span class="string">&quot;requiredWtypeId2&quot;</span>: <span class="number">0</span>, <span class="string">&quot;scope&quot;</span>: <span class="number">1</span>, <span class="string">&quot;speed&quot;</span>: <span class="number">0</span>, <span class="string">&quot;stypeId&quot;</span>: <span class="number">2</span>, <span class="string">&quot;successRate&quot;</span>: <span class="number">100</span>, <span class="string">&quot;tpCost&quot;</span>: <span class="number">0</span>, <span class="string">&quot;tpGain&quot;</span>: <span class="number">5</span>, <span class="string">&quot;messageType&quot;</span>: <span class="number">1</span> &#125;,</span><br><span class="line">    &#123; <span class="string">&quot;id&quot;</span>: <span class="number">4</span>, <span class="string">&quot;animationId&quot;</span>: <span class="number">-1</span>, <span class="string">&quot;damage&quot;</span>: &#123; <span class="string">&quot;critical&quot;</span>: <span class="literal">true</span>, <span class="string">&quot;elementId&quot;</span>: <span class="number">-1</span>, <span class="string">&quot;formula&quot;</span>: <span class="string">&quot;a.atk * 4 - b.def * 2&quot;</span>, <span class="string">&quot;type&quot;</span>: <span class="number">1</span>, <span class="string">&quot;variance&quot;</span>: <span class="number">20</span> &#125;, <span class="string">&quot;description&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="string">&quot;effects&quot;</span>: [&#123; <span class="string">&quot;code&quot;</span>: <span class="number">21</span>, <span class="string">&quot;dataId&quot;</span>: <span class="number">0</span>, <span class="string">&quot;value1&quot;</span>: <span class="number">1</span>, <span class="string">&quot;value2&quot;</span>: <span class="number">0</span> &#125;], <span class="string">&quot;hitType&quot;</span>: <span class="number">1</span>, <span class="string">&quot;iconIndex&quot;</span>: <span class="number">880</span>, <span class="string">&quot;message1&quot;</span>: <span class="string">&quot;%1的攻击！&quot;</span>, <span class="string">&quot;message2&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="string">&quot;mpCost&quot;</span>: <span class="number">0</span>, <span class="string">&quot;name&quot;</span>: <span class="string">&quot;两次攻击&quot;</span>, <span class="string">&quot;note&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="string">&quot;occasion&quot;</span>: <span class="number">1</span>, <span class="string">&quot;repeats&quot;</span>: <span class="number">1</span>, <span class="string">&quot;requiredWtypeId1&quot;</span>: <span class="number">0</span>, <span class="string">&quot;requiredWtypeId2&quot;</span>: <span class="number">0</span>, <span class="string">&quot;scope&quot;</span>: <span class="number">4</span>, <span class="string">&quot;speed&quot;</span>: <span class="number">0</span>, <span class="string">&quot;stypeId&quot;</span>: <span class="number">0</span>, <span class="string">&quot;successRate&quot;</span>: <span class="number">100</span>, <span class="string">&quot;tpCost&quot;</span>: <span class="number">0</span>, <span class="string">&quot;tpGain&quot;</span>: <span class="number">5</span>, <span class="string">&quot;messageType&quot;</span>: <span class="number">1</span> &#125;,</span><br><span class="line">    &#123; <span class="string">&quot;id&quot;</span>: <span class="number">5</span>, <span class="string">&quot;animationId&quot;</span>: <span class="number">-1</span>, <span class="string">&quot;damage&quot;</span>: &#123; <span class="string">&quot;critical&quot;</span>: <span class="literal">true</span>, <span class="string">&quot;elementId&quot;</span>: <span class="number">-1</span>, <span class="string">&quot;formula&quot;</span>: <span class="string">&quot;a.atk * 4 - b.def * 2&quot;</span>, <span class="string">&quot;type&quot;</span>: <span class="number">1</span>, <span class="string">&quot;variance&quot;</span>: <span class="number">20</span> &#125;, <span class="string">&quot;description&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="string">&quot;effects&quot;</span>: [&#123; <span class="string">&quot;code&quot;</span>: <span class="number">21</span>, <span class="string">&quot;dataId&quot;</span>: <span class="number">0</span>, <span class="string">&quot;value1&quot;</span>: <span class="number">1</span>, <span class="string">&quot;value2&quot;</span>: <span class="number">0</span> &#125;], <span class="string">&quot;hitType&quot;</span>: <span class="number">1</span>, <span class="string">&quot;iconIndex&quot;</span>: <span class="number">849</span>, <span class="string">&quot;message1&quot;</span>: <span class="string">&quot;%1的攻击！&quot;</span>, <span class="string">&quot;message2&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="string">&quot;mpCost&quot;</span>: <span class="number">0</span>, <span class="string">&quot;name&quot;</span>: <span class="string">&quot;三次攻击&quot;</span>, <span class="string">&quot;note&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="string">&quot;occasion&quot;</span>: <span class="number">1</span>, <span class="string">&quot;repeats&quot;</span>: <span class="number">1</span>, <span class="string">&quot;requiredWtypeId1&quot;</span>: <span class="number">0</span>, <span class="string">&quot;requiredWtypeId2&quot;</span>: <span class="number">0</span>, <span class="string">&quot;scope&quot;</span>: <span class="number">5</span>, <span class="string">&quot;speed&quot;</span>: <span class="number">0</span>, <span class="string">&quot;stypeId&quot;</span>: <span class="number">0</span>, <span class="string">&quot;successRate&quot;</span>: <span class="number">100</span>, <span class="string">&quot;tpCost&quot;</span>: <span class="number">0</span>, <span class="string">&quot;tpGain&quot;</span>: <span class="number">4</span>, <span class="string">&quot;messageType&quot;</span>: <span class="number">1</span> &#125;,</span><br><span class="line">    &#123; <span class="string">&quot;id&quot;</span>: <span class="number">6</span>, <span class="string">&quot;animationId&quot;</span>: <span class="number">0</span>, <span class="string">&quot;damage&quot;</span>: &#123; <span class="string">&quot;critical&quot;</span>: <span class="literal">false</span>, <span class="string">&quot;elementId&quot;</span>: <span class="number">0</span>, <span class="string">&quot;formula&quot;</span>: <span class="string">&quot;0&quot;</span>, <span class="string">&quot;type&quot;</span>: <span class="number">0</span>, <span class="string">&quot;variance&quot;</span>: <span class="number">20</span> &#125;, <span class="string">&quot;description&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="string">&quot;effects&quot;</span>: [&#123; <span class="string">&quot;code&quot;</span>: <span class="number">41</span>, <span class="string">&quot;dataId&quot;</span>: <span class="number">0</span>, <span class="string">&quot;value1&quot;</span>: <span class="number">0</span>, <span class="string">&quot;value2&quot;</span>: <span class="number">0</span> &#125;], <span class="string">&quot;hitType&quot;</span>: <span class="number">0</span>, <span class="string">&quot;iconIndex&quot;</span>: <span class="number">883</span>, <span class="string">&quot;message1&quot;</span>: <span class="string">&quot;%1逃跑了。&quot;</span>, <span class="string">&quot;message2&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="string">&quot;mpCost&quot;</span>: <span class="number">0</span>, <span class="string">&quot;name&quot;</span>: <span class="string">&quot;逃跑&quot;</span>, <span class="string">&quot;note&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="string">&quot;occasion&quot;</span>: <span class="number">1</span>, <span class="string">&quot;repeats&quot;</span>: <span class="number">1</span>, <span class="string">&quot;requiredWtypeId1&quot;</span>: <span class="number">0</span>, <span class="string">&quot;requiredWtypeId2&quot;</span>: <span class="number">0</span>, <span class="string">&quot;scope&quot;</span>: <span class="number">11</span>, <span class="string">&quot;speed&quot;</span>: <span class="number">0</span>, <span class="string">&quot;stypeId&quot;</span>: <span class="number">0</span>, <span class="string">&quot;successRate&quot;</span>: <span class="number">100</span>, <span class="string">&quot;tpCost&quot;</span>: <span class="number">0</span>, <span class="string">&quot;tpGain&quot;</span>: <span class="number">0</span>, <span class="string">&quot;messageType&quot;</span>: <span class="number">1</span> &#125;,</span><br><span class="line">    &#123; <span class="string">&quot;id&quot;</span>: <span class="number">7</span>, <span class="string">&quot;animationId&quot;</span>: <span class="number">0</span>, <span class="string">&quot;damage&quot;</span>: &#123; <span class="string">&quot;critical&quot;</span>: <span class="literal">false</span>, <span class="string">&quot;elementId&quot;</span>: <span class="number">0</span>, <span class="string">&quot;formula&quot;</span>: <span class="string">&quot;0&quot;</span>, <span class="string">&quot;type&quot;</span>: <span class="number">0</span>, <span class="string">&quot;variance&quot;</span>: <span class="number">20</span> &#125;, <span class="string">&quot;description&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="string">&quot;effects&quot;</span>: [], <span class="string">&quot;hitType&quot;</span>: <span class="number">0</span>, <span class="string">&quot;iconIndex&quot;</span>: <span class="number">979</span>, <span class="string">&quot;message1&quot;</span>: <span class="string">&quot;%1正在观望。&quot;</span>, <span class="string">&quot;message2&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="string">&quot;mpCost&quot;</span>: <span class="number">0</span>, <span class="string">&quot;name&quot;</span>: <span class="string">&quot;观望&quot;</span>, <span class="string">&quot;note&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="string">&quot;occasion&quot;</span>: <span class="number">1</span>, <span class="string">&quot;repeats&quot;</span>: <span class="number">1</span>, <span class="string">&quot;requiredWtypeId1&quot;</span>: <span class="number">0</span>, <span class="string">&quot;requiredWtypeId2&quot;</span>: <span class="number">0</span>, <span class="string">&quot;scope&quot;</span>: <span class="number">0</span>, <span class="string">&quot;speed&quot;</span>: <span class="number">0</span>, <span class="string">&quot;stypeId&quot;</span>: <span class="number">0</span>, <span class="string">&quot;successRate&quot;</span>: <span class="number">100</span>, <span class="string">&quot;tpCost&quot;</span>: <span class="number">0</span>, <span class="string">&quot;tpGain&quot;</span>: <span class="number">10</span>, <span class="string">&quot;messageType&quot;</span>: <span class="number">1</span> &#125;,</span><br><span class="line">    &#123; <span class="string">&quot;id&quot;</span>: <span class="number">8</span>, <span class="string">&quot;animationId&quot;</span>: <span class="number">41</span>, <span class="string">&quot;damage&quot;</span>: &#123; <span class="string">&quot;critical&quot;</span>: <span class="literal">false</span>, <span class="string">&quot;elementId&quot;</span>: <span class="number">0</span>, <span class="string">&quot;formula&quot;</span>: <span class="string">&quot;200 + a.mat&quot;</span>, <span class="string">&quot;type&quot;</span>: <span class="number">3</span>, <span class="string">&quot;variance&quot;</span>: <span class="number">20</span> &#125;, <span class="string">&quot;description&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="string">&quot;effects&quot;</span>: [&#123; <span class="string">&quot;code&quot;</span>: <span class="number">21</span>, <span class="string">&quot;dataId&quot;</span>: <span class="number">4</span>, <span class="string">&quot;value1&quot;</span>: <span class="number">1</span>, <span class="string">&quot;value2&quot;</span>: <span class="number">0</span> &#125;, &#123; <span class="string">&quot;code&quot;</span>: <span class="number">21</span>, <span class="string">&quot;dataId&quot;</span>: <span class="number">7</span>, <span class="string">&quot;value1&quot;</span>: <span class="number">1</span>, <span class="string">&quot;value2&quot;</span>: <span class="number">0</span> &#125;, &#123; <span class="string">&quot;code&quot;</span>: <span class="number">21</span>, <span class="string">&quot;dataId&quot;</span>: <span class="number">8</span>, <span class="string">&quot;value1&quot;</span>: <span class="number">1</span>, <span class="string">&quot;value2&quot;</span>: <span class="number">0</span> &#125;, &#123; <span class="string">&quot;code&quot;</span>: <span class="number">21</span>, <span class="string">&quot;dataId&quot;</span>: <span class="number">8</span>, <span class="string">&quot;value1&quot;</span>: <span class="number">1</span>, <span class="string">&quot;value2&quot;</span>: <span class="number">0</span> &#125;, &#123; <span class="string">&quot;code&quot;</span>: <span class="number">21</span>, <span class="string">&quot;dataId&quot;</span>: <span class="number">6</span>, <span class="string">&quot;value1&quot;</span>: <span class="number">1</span>, <span class="string">&quot;value2&quot;</span>: <span class="number">0</span> &#125;], <span class="string">&quot;hitType&quot;</span>: <span class="number">0</span>, <span class="string">&quot;iconIndex&quot;</span>: <span class="number">72</span>, <span class="string">&quot;message1&quot;</span>: <span class="string">&quot;%1吟唱了%2！&quot;</span>, <span class="string">&quot;message2&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="string">&quot;mpCost&quot;</span>: <span class="number">5</span>, <span class="string">&quot;name&quot;</span>: <span class="string">&quot;治愈&quot;</span>, <span class="string">&quot;note&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="string">&quot;occasion&quot;</span>: <span class="number">0</span>, <span class="string">&quot;repeats&quot;</span>: <span class="number">1</span>, <span class="string">&quot;requiredWtypeId1&quot;</span>: <span class="number">0</span>, <span class="string">&quot;requiredWtypeId2&quot;</span>: <span class="number">0</span>, <span class="string">&quot;scope&quot;</span>: <span class="number">1</span>, <span class="string">&quot;speed&quot;</span>: <span class="number">0</span>, <span class="string">&quot;stypeId&quot;</span>: <span class="number">1</span>, <span class="string">&quot;successRate&quot;</span>: <span class="number">100</span>, <span class="string">&quot;tpCost&quot;</span>: <span class="number">0</span>, <span class="string">&quot;tpGain&quot;</span>: <span class="number">10</span>, <span class="string">&quot;messageType&quot;</span>: <span class="number">1</span> &#125;,</span><br><span class="line"><span class="title class_">Time</span> <span class="variable">taken</span>: <span class="number">0.103</span> <span class="variable">seconds</span>, <span class="title class_">Fetched</span>: <span class="number">10</span> <span class="title function_">row</span>(<span class="variable">s</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>然后我们通过json_tuple来解析它</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">hive (bigdata_hive3)&gt; <span class="keyword">select</span> json_tuple(<span class="type">json</span> , <span class="string">&#x27;id&#x27;</span> , <span class="string">&#x27;animationId&#x27;</span> , <span class="string">&#x27;damage&#x27;</span>,<span class="string">&#x27;description&#x27;</span>,<span class="string">&#x27;effects&#x27;</span>,<span class="string">&#x27;hitType&#x27;</span>,<span class="string">&#x27;iconIndex&#x27;</span>,<span class="string">&#x27;message1&#x27;</span>,<span class="string">&#x27;message2&#x27;</span>,<span class="string">&#x27;mpCost&#x27;</span>,<span class="string">&#x27;name&#x27;</span>,<span class="string">&#x27;note&#x27;</span>,<span class="string">&#x27;occasion&#x27;</span>,<span class="string">&#x27;repeats&#x27;</span>,<span class="string">&#x27;requiredWtypeId1&#x27;</span>,<span class="string">&#x27;requiredWtypeId2&#x27;</span>,<span class="string">&#x27;scope&#x27;</span>,<span class="string">&#x27;speed&#x27;</span>,<span class="string">&#x27;stypeId&#x27;</span>,<span class="string">&#x27;successRate&#x27;</span>,<span class="string">&#x27;tpCost&#x27;</span>,<span class="string">&#x27;tpGain&#x27;</span>,<span class="string">&#x27;messageType&#x27;</span>) <span class="keyword">from</span> skill <span class="keyword">limit</span> <span class="number">10</span> ;</span><br><span class="line">OK</span><br><span class="line">c0c1c2c3c4c5c6c7c8c9c10c11c12c13c14c15c16c17c18c19c20c21c22</span><br><span class="line"><span class="keyword">NULL</span><span class="keyword">NULL</span><span class="keyword">NULL</span><span class="keyword">NULL</span><span class="keyword">NULL</span><span class="keyword">NULL</span><span class="keyword">NULL</span><span class="keyword">NULL</span><span class="keyword">NULL</span><span class="keyword">NULL</span><span class="keyword">NULL</span><span class="keyword">NULL</span><span class="keyword">NULL</span><span class="keyword">NULL</span><span class="keyword">NULL</span><span class="keyword">NULL</span><span class="keyword">NULL</span><span class="keyword">NULL</span><span class="keyword">NULL</span><span class="keyword">NULL</span><span class="keyword">NULL</span><span class="keyword">NULL</span><span class="keyword">NULL</span></span><br><span class="line"><span class="keyword">NULL</span><span class="keyword">NULL</span><span class="keyword">NULL</span><span class="keyword">NULL</span><span class="keyword">NULL</span><span class="keyword">NULL</span><span class="keyword">NULL</span><span class="keyword">NULL</span><span class="keyword">NULL</span><span class="keyword">NULL</span><span class="keyword">NULL</span><span class="keyword">NULL</span><span class="keyword">NULL</span><span class="keyword">NULL</span><span class="keyword">NULL</span><span class="keyword">NULL</span><span class="keyword">NULL</span><span class="keyword">NULL</span><span class="keyword">NULL</span><span class="keyword">NULL</span><span class="keyword">NULL</span><span class="keyword">NULL</span><span class="keyword">NULL</span></span><br><span class="line"><span class="number">1</span><span class="number">1</span>&#123;&quot;critical&quot;:<span class="keyword">true</span>,&quot;elementId&quot;:<span class="number">-1</span>,&quot;formula&quot;:&quot;a.atk * 4 - b.def * 2&quot;,&quot;type&quot;:<span class="number">1</span>,&quot;variance&quot;:<span class="number">20</span>&#125;[&#123;&quot;code&quot;:<span class="number">21</span>,&quot;dataId&quot;:<span class="number">0</span>,&quot;value1&quot;:<span class="number">1</span>,&quot;value2&quot;:<span class="number">0</span>&#125;]<span class="number">1</span><span class="number">880</span>%<span class="number">1</span>的攻击！<span class="number">0</span>攻击<span class="number">1</span> 号技能会在选择“攻击”指令时使用。</span><br><span class="line"></span><br><span class="line">&lt;setup action&gt;</span><br><span class="line">display action</span><br><span class="line">immortal: targets, <span class="keyword">true</span></span><br><span class="line">&lt;/setup action&gt;</span><br><span class="line"></span><br><span class="line">&lt;target action&gt;</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">user</span>.attackMotion() !== <span class="string">&#x27;missile&#x27;</span></span><br><span class="line"><span class="keyword">move</span> <span class="keyword">user</span>: targets, front, <span class="number">20</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="keyword">perform</span> <span class="keyword">start</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">wait <span class="keyword">for</span> movement</span><br><span class="line">motion attack: <span class="keyword">user</span></span><br><span class="line"></span><br><span class="line">attack animation: target</span><br><span class="line">wait <span class="keyword">for</span> animation</span><br><span class="line">action effect</span><br><span class="line">&lt;/target action&gt;<span class="number">1</span><span class="number">1</span><span class="number">0</span><span class="number">0</span><span class="number">1</span><span class="number">0</span><span class="number">0</span><span class="number">100</span><span class="number">0</span><span class="number">10</span><span class="number">1</span></span><br><span class="line"><span class="number">2</span><span class="number">0</span>&#123;&quot;critical&quot;:<span class="keyword">false</span>,&quot;elementId&quot;:<span class="number">0</span>,&quot;formula&quot;:&quot;0&quot;,&quot;type&quot;:<span class="number">0</span>,&quot;variance&quot;:<span class="number">20</span>&#125;[&#123;&quot;code&quot;:<span class="number">21</span>,&quot;dataId&quot;:<span class="number">2</span>,&quot;value1&quot;:<span class="number">1</span>,&quot;value2&quot;:<span class="number">0</span>&#125;]<span class="number">0</span><span class="number">688</span>%<span class="number">1</span>正在保护自己。<span class="number">0</span>防御<span class="number">1</span> 号技能会在选择“防御”指令时使用。<span class="number">1</span><span class="number">1</span><span class="number">0</span><span class="number">0</span><span class="number">11</span><span class="number">10</span><span class="number">0</span><span class="number">100</span><span class="number">0</span><span class="number">10</span><span class="number">1</span></span><br><span class="line"><span class="number">3</span><span class="number">-1</span>&#123;&quot;critical&quot;:<span class="keyword">true</span>,&quot;elementId&quot;:<span class="number">-1</span>,&quot;formula&quot;:&quot;a.atk * 4 - b.def * 2&quot;,&quot;type&quot;:<span class="number">1</span>,&quot;variance&quot;:<span class="number">20</span>&#125;[&#123;&quot;code&quot;:<span class="number">21</span>,&quot;dataId&quot;:<span class="number">0</span>,&quot;value1&quot;:<span class="number">1</span>,&quot;value2&quot;:<span class="number">0</span>&#125;]<span class="number">1</span><span class="number">880</span>%<span class="number">1</span>的攻击！<span class="number">0</span>连续攻击<span class="number">1</span><span class="number">2</span><span class="number">0</span><span class="number">0</span><span class="number">1</span><span class="number">0</span><span class="number">2</span><span class="number">100</span><span class="number">0</span><span class="number">5</span><span class="number">1</span></span><br><span class="line"><span class="number">4</span><span class="number">-1</span>&#123;&quot;critical&quot;:<span class="keyword">true</span>,&quot;elementId&quot;:<span class="number">-1</span>,&quot;formula&quot;:&quot;a.atk * 4 - b.def * 2&quot;,&quot;type&quot;:<span class="number">1</span>,&quot;variance&quot;:<span class="number">20</span>&#125;[&#123;&quot;code&quot;:<span class="number">21</span>,&quot;dataId&quot;:<span class="number">0</span>,&quot;value1&quot;:<span class="number">1</span>,&quot;value2&quot;:<span class="number">0</span>&#125;]<span class="number">1</span><span class="number">880</span>%<span class="number">1</span>的攻击！<span class="number">0</span>两次攻击<span class="number">1</span><span class="number">1</span><span class="number">0</span><span class="number">0</span><span class="number">4</span><span class="number">0</span><span class="number">0</span><span class="number">100</span><span class="number">0</span><span class="number">5</span><span class="number">1</span></span><br><span class="line"><span class="number">5</span><span class="number">-1</span>&#123;&quot;critical&quot;:<span class="keyword">true</span>,&quot;elementId&quot;:<span class="number">-1</span>,&quot;formula&quot;:&quot;a.atk * 4 - b.def * 2&quot;,&quot;type&quot;:<span class="number">1</span>,&quot;variance&quot;:<span class="number">20</span>&#125;[&#123;&quot;code&quot;:<span class="number">21</span>,&quot;dataId&quot;:<span class="number">0</span>,&quot;value1&quot;:<span class="number">1</span>,&quot;value2&quot;:<span class="number">0</span>&#125;]<span class="number">1</span><span class="number">849</span>%<span class="number">1</span>的攻击！<span class="number">0</span>三次攻击<span class="number">1</span><span class="number">1</span><span class="number">0</span><span class="number">0</span><span class="number">5</span><span class="number">0</span><span class="number">0</span><span class="number">100</span><span class="number">0</span><span class="number">4</span><span class="number">1</span></span><br><span class="line"><span class="number">6</span><span class="number">0</span>&#123;&quot;critical&quot;:<span class="keyword">false</span>,&quot;elementId&quot;:<span class="number">0</span>,&quot;formula&quot;:&quot;0&quot;,&quot;type&quot;:<span class="number">0</span>,&quot;variance&quot;:<span class="number">20</span>&#125;[&#123;&quot;code&quot;:<span class="number">41</span>,&quot;dataId&quot;:<span class="number">0</span>,&quot;value1&quot;:<span class="number">0</span>,&quot;value2&quot;:<span class="number">0</span>&#125;]<span class="number">0</span><span class="number">883</span>%<span class="number">1</span>逃跑了。<span class="number">0</span>逃跑<span class="number">11</span><span class="number">0</span><span class="number">0</span><span class="number">100</span><span class="number">0</span><span class="number">0</span><span class="number">1</span></span><br><span class="line"><span class="number">7</span><span class="number">0</span>&#123;&quot;critical&quot;:<span class="keyword">false</span>,&quot;elementId&quot;:<span class="number">0</span>,&quot;formula&quot;:&quot;0&quot;,&quot;type&quot;:<span class="number">0</span>,&quot;variance&quot;:<span class="number">20</span>&#125;[]<span class="number">0</span><span class="number">979</span>%<span class="number">1</span>正在观望。<span class="number">0</span>观望<span class="number">1</span><span class="number">1</span><span class="number">0</span><span class="number">0</span><span class="number">0</span><span class="number">100</span><span class="number">0</span><span class="number">10</span><span class="number">1</span></span><br><span class="line"><span class="number">8</span><span class="number">41</span>&#123;&quot;critical&quot;:<span class="keyword">false</span>,&quot;elementId&quot;:<span class="number">0</span>,&quot;formula&quot;:&quot;200 + a.mat&quot;,&quot;type&quot;:<span class="number">3</span>,&quot;variance&quot;:<span class="number">20</span>&#125;[&#123;&quot;code&quot;:<span class="number">21</span>,&quot;dataId&quot;:<span class="number">4</span>,&quot;value1&quot;:<span class="number">1</span>,&quot;value2&quot;:<span class="number">0</span>&#125;,&#123;&quot;code&quot;:<span class="number">21</span>,&quot;dataId&quot;:<span class="number">7</span>,&quot;value1&quot;:<span class="number">1</span>,&quot;value2&quot;:<span class="number">0</span>&#125;,&#123;&quot;code&quot;:<span class="number">21</span>,&quot;dataId&quot;:<span class="number">8</span>,&quot;value1&quot;:<span class="number">1</span>,&quot;value2&quot;:<span class="number">0</span>&#125;,&#123;&quot;code&quot;:<span class="number">21</span>,&quot;dataId&quot;:<span class="number">8</span>,&quot;value1&quot;:<span class="number">1</span>,&quot;value2&quot;:<span class="number">0</span>&#125;,&#123;&quot;code&quot;:<span class="number">21</span>,&quot;dataId&quot;:<span class="number">6</span>,&quot;value1&quot;:<span class="number">1</span>,&quot;value2&quot;:<span class="number">0</span>&#125;]<span class="number">0</span><span class="number">72</span>%<span class="number">1</span>吟唱了%<span class="number">2</span>！<span class="number">5</span>治愈<span class="number">0</span><span class="number">1</span><span class="number">100</span><span class="number">0</span><span class="number">10</span><span class="number">1</span></span><br><span class="line"><span class="type">Time</span> taken: <span class="number">0.129</span> seconds, Fetched: <span class="number">10</span> <span class="keyword">row</span>(s)</span><br><span class="line"><span class="comment">----------------------------------------------------------------这样是因为数据太多了，我们简单筛选出来几条数据如下</span></span><br><span class="line">hive (bigdata_hive3)&gt; <span class="keyword">select</span> json_tuple(<span class="type">json</span> , <span class="string">&#x27;id&#x27;</span> , <span class="string">&#x27;animationId&#x27;</span> , <span class="string">&#x27;damage&#x27;</span>) <span class="keyword">from</span> skill <span class="keyword">limit</span> <span class="number">10</span> ;</span><br><span class="line">OK</span><br><span class="line">c0c1c2</span><br><span class="line"><span class="keyword">NULL</span><span class="keyword">NULL</span><span class="keyword">NULL</span></span><br><span class="line"><span class="keyword">NULL</span><span class="keyword">NULL</span><span class="keyword">NULL</span></span><br><span class="line"><span class="number">1</span><span class="number">1</span>&#123;&quot;critical&quot;:<span class="keyword">true</span>,&quot;elementId&quot;:<span class="number">-1</span>,&quot;formula&quot;:&quot;a.atk * 4 - b.def * 2&quot;,&quot;type&quot;:<span class="number">1</span>,&quot;variance&quot;:<span class="number">20</span>&#125;</span><br><span class="line"><span class="number">2</span><span class="number">0</span>&#123;&quot;critical&quot;:<span class="keyword">false</span>,&quot;elementId&quot;:<span class="number">0</span>,&quot;formula&quot;:&quot;0&quot;,&quot;type&quot;:<span class="number">0</span>,&quot;variance&quot;:<span class="number">20</span>&#125;</span><br><span class="line"><span class="number">3</span><span class="number">-1</span>&#123;&quot;critical&quot;:<span class="keyword">true</span>,&quot;elementId&quot;:<span class="number">-1</span>,&quot;formula&quot;:&quot;a.atk * 4 - b.def * 2&quot;,&quot;type&quot;:<span class="number">1</span>,&quot;variance&quot;:<span class="number">20</span>&#125;</span><br><span class="line"><span class="number">4</span><span class="number">-1</span>&#123;&quot;critical&quot;:<span class="keyword">true</span>,&quot;elementId&quot;:<span class="number">-1</span>,&quot;formula&quot;:&quot;a.atk * 4 - b.def * 2&quot;,&quot;type&quot;:<span class="number">1</span>,&quot;variance&quot;:<span class="number">20</span>&#125;</span><br><span class="line"><span class="number">5</span><span class="number">-1</span>&#123;&quot;critical&quot;:<span class="keyword">true</span>,&quot;elementId&quot;:<span class="number">-1</span>,&quot;formula&quot;:&quot;a.atk * 4 - b.def * 2&quot;,&quot;type&quot;:<span class="number">1</span>,&quot;variance&quot;:<span class="number">20</span>&#125;</span><br><span class="line"><span class="number">6</span><span class="number">0</span>&#123;&quot;critical&quot;:<span class="keyword">false</span>,&quot;elementId&quot;:<span class="number">0</span>,&quot;formula&quot;:&quot;0&quot;,&quot;type&quot;:<span class="number">0</span>,&quot;variance&quot;:<span class="number">20</span>&#125;</span><br><span class="line"><span class="number">7</span><span class="number">0</span>&#123;&quot;critical&quot;:<span class="keyword">false</span>,&quot;elementId&quot;:<span class="number">0</span>,&quot;formula&quot;:&quot;0&quot;,&quot;type&quot;:<span class="number">0</span>,&quot;variance&quot;:<span class="number">20</span>&#125;</span><br><span class="line"><span class="number">8</span><span class="number">41</span>&#123;&quot;critical&quot;:<span class="keyword">false</span>,&quot;elementId&quot;:<span class="number">0</span>,&quot;formula&quot;:&quot;200 + a.mat&quot;,&quot;type&quot;:<span class="number">3</span>,&quot;variance&quot;:<span class="number">20</span>&#125;</span><br><span class="line"><span class="type">Time</span> taken: <span class="number">0.11</span> seconds, Fetched: <span class="number">10</span> <span class="keyword">row</span>(s)</span><br><span class="line"><span class="comment">----------------------------------------------------------------------对于嵌套的json，就是上面的[&#123;&quot;code&quot;:21,&quot;dataId&quot;:4,&quot;value1&quot;:1,&quot;value2&quot;:0&#125;,&#123;&quot;code&quot;:21,&quot;dataId&quot;:7,&quot;value1&quot;:1,&quot;value2&quot;:0&#125;,&#123;&quot;code&quot;:21,&quot;dataId&quot;:8,&quot;value1&quot;:1,&quot;value2&quot;:0&#125;,&#123;&quot;code&quot;:21,&quot;dataId&quot;:8,&quot;value1&quot;:1,&quot;value2&quot;:0&#125;,&#123;&quot;code&quot;:21,&quot;dataId&quot;:6,&quot;value1&quot;:1,&quot;value2&quot;:0&#125;]这种数据用下面的方法 通过get_json_object</span></span><br><span class="line"></span><br><span class="line">hive (bigdata_hive3)&gt; <span class="keyword">select</span> get_json_object(<span class="type">json</span> , <span class="string">&#x27;$.effects[0]&#x27;</span>) <span class="keyword">from</span> skill <span class="keyword">limit</span> <span class="number">10</span>;</span><br><span class="line">OK</span><br><span class="line">_c0</span><br><span class="line"><span class="keyword">NULL</span></span><br><span class="line"><span class="keyword">NULL</span></span><br><span class="line">&#123;&quot;code&quot;:<span class="number">21</span>,&quot;dataId&quot;:<span class="number">0</span>,&quot;value1&quot;:<span class="number">1</span>,&quot;value2&quot;:<span class="number">0</span>&#125;</span><br><span class="line">&#123;&quot;code&quot;:<span class="number">21</span>,&quot;dataId&quot;:<span class="number">2</span>,&quot;value1&quot;:<span class="number">1</span>,&quot;value2&quot;:<span class="number">0</span>&#125;</span><br><span class="line">&#123;&quot;code&quot;:<span class="number">21</span>,&quot;dataId&quot;:<span class="number">0</span>,&quot;value1&quot;:<span class="number">1</span>,&quot;value2&quot;:<span class="number">0</span>&#125;</span><br><span class="line">&#123;&quot;code&quot;:<span class="number">21</span>,&quot;dataId&quot;:<span class="number">0</span>,&quot;value1&quot;:<span class="number">1</span>,&quot;value2&quot;:<span class="number">0</span>&#125;</span><br><span class="line">&#123;&quot;code&quot;:<span class="number">21</span>,&quot;dataId&quot;:<span class="number">0</span>,&quot;value1&quot;:<span class="number">1</span>,&quot;value2&quot;:<span class="number">0</span>&#125;</span><br><span class="line">&#123;&quot;code&quot;:<span class="number">41</span>,&quot;dataId&quot;:<span class="number">0</span>,&quot;value1&quot;:<span class="number">0</span>,&quot;value2&quot;:<span class="number">0</span>&#125;</span><br><span class="line"><span class="keyword">NULL</span></span><br><span class="line">&#123;&quot;code&quot;:<span class="number">21</span>,&quot;dataId&quot;:<span class="number">4</span>,&quot;value1&quot;:<span class="number">1</span>,&quot;value2&quot;:<span class="number">0</span>&#125;</span><br><span class="line"><span class="type">Time</span> taken: <span class="number">0.103</span> seconds, Fetched: <span class="number">10</span> <span class="keyword">row</span>(s)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>parse_url_tuple:解析url可能会用到&#x3D;》这个是单纯对url解析</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">hive (bigdata_hive3)<span class="operator">&gt;</span> <span class="keyword">desc</span> <span class="keyword">function</span> extended parse_url_tuple;</span><br><span class="line">OK</span><br><span class="line">tab_name</span><br><span class="line">parse_url_tuple(url, partname1, partname2, ..., partnameN) <span class="operator">-</span> extracts N (N<span class="operator">&gt;=</span><span class="number">1</span>) parts <span class="keyword">from</span> a URL.</span><br><span class="line">It takes a URL <span class="keyword">and</span> <span class="keyword">one</span> <span class="keyword">or</span> multiple partnames, <span class="keyword">and</span> <span class="keyword">returns</span> a tuple. <span class="keyword">All</span> the input parameters <span class="keyword">and</span> output <span class="keyword">column</span> types <span class="keyword">are</span> string.</span><br><span class="line">Partname: HOST, PATH, QUERY, <span class="keyword">REF</span>, PROTOCOL, AUTHORITY, FILE, USERINFO, QUERY:<span class="operator">&lt;</span>KEY_NAME<span class="operator">&gt;</span></span><br><span class="line">Note: Partnames <span class="keyword">are</span> <span class="keyword">case</span><span class="operator">-</span><span class="keyword">sensitive</span>, <span class="keyword">and</span> should <span class="keyword">not</span> contain unnecessary white spaces.</span><br><span class="line">Example:</span><br><span class="line">  <span class="operator">&gt;</span> <span class="keyword">SELECT</span> b.<span class="operator">*</span> <span class="keyword">FROM</span> src <span class="keyword">LATERAL</span> <span class="keyword">VIEW</span> parse_url_tuple(fullurl, <span class="string">&#x27;HOST&#x27;</span>, <span class="string">&#x27;PATH&#x27;</span>, <span class="string">&#x27;QUERY&#x27;</span>, <span class="string">&#x27;QUERY:id&#x27;</span>) b <span class="keyword">as</span> host, path, query, query_id LIMIT <span class="number">1</span>;</span><br><span class="line">  <span class="operator">&gt;</span> <span class="keyword">SELECT</span> parse_url_tuple(a.fullurl, <span class="string">&#x27;HOST&#x27;</span>, <span class="string">&#x27;PATH&#x27;</span>, <span class="string">&#x27;QUERY&#x27;</span>, <span class="string">&#x27;REF&#x27;</span>, <span class="string">&#x27;PROTOCOL&#x27;</span>, <span class="string">&#x27;FILE&#x27;</span>,  <span class="string">&#x27;AUTHORITY&#x27;</span>, <span class="string">&#x27;USERINFO&#x27;</span>, <span class="string">&#x27;QUERY:k1&#x27;</span>) <span class="keyword">as</span> (ho, pa, qu, re, pr, fi, au, us, qk1) <span class="keyword">from</span> src a;</span><br><span class="line"><span class="keyword">Function</span> class:org.apache.hadoop.hive.ql.udf.generic.GenericUDTFParseUrlTuple</span><br><span class="line"><span class="keyword">Function</span> type:BUILTIN</span><br><span class="line"><span class="type">Time</span> taken: <span class="number">0.017</span> seconds, Fetched: <span class="number">9</span> <span class="type">row</span>(s)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="判断类的"><a href="#判断类的" class="headerlink" title="判断类的"></a>判断类的</h2><p>case when &#x2F; if</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">首先随便创建表</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> emp_info(</span><br><span class="line">id <span class="type">int</span>,</span><br><span class="line"><span class="type">name</span> string</span><br><span class="line">)</span><br><span class="line"><span class="keyword">row</span> formatted fields terminated <span class="keyword">by</span> <span class="string">&#x27;,&#x27;</span></span><br><span class="line"><span class="comment">------------------------------数据如下</span></span><br><span class="line"><span class="number">1</span>,zihang</span><br><span class="line"><span class="number">2</span>,zuan</span><br><span class="line"><span class="number">3</span>,zihan</span><br><span class="line"><span class="number">4</span>,shuangxi</span><br><span class="line"><span class="number">4</span>,mengke</span><br><span class="line"><span class="comment">-----------------------------数据筛选</span></span><br><span class="line"><span class="keyword">select</span> <span class="type">name</span> , sum(<span class="keyword">case</span> <span class="keyword">when</span> <span class="type">name</span>=<span class="string">&#x27;zihan&#x27;</span> <span class="keyword">then</span> <span class="number">1</span> <span class="keyword">else</span> <span class="number">0</span> <span class="keyword">end</span>) <span class="keyword">from</span> emp_info</span><br><span class="line"><span class="comment">----------------------------if</span></span><br><span class="line"><span class="keyword">select</span> sum(<span class="keyword">if</span>(<span class="type">name</span>=<span class="string">&#x27;sz&#x27;</span>,<span class="number">1</span> ,<span class="number">0</span>))<span class="keyword">from</span> emp_info</span><br></pre></td></tr></table></figure><p>udf:</p><p>spark ,flink…都有</p><p>使用场景：内置函数不可以帮助我们解决问题了</p><p>udf的种类：</p><ul><li><p>udf ：一进一出</p><ul><li>继承udf类&#x3D;》实现evaLuate&#x3D;》打包上传服务器&#x3D;》<ul><li>使用临时函数 &#x3D;&gt;<code>add jar 路径</code>&#x3D;&gt; 创建临时函数 &#x3D; &gt;<code> create function  方法名字 as  &#39; 包名&#39;</code>&#x3D;&gt; 就可以直接使用了，但是临时函数添加的只对当前的session有用，包括add jar  也是临时的</li><li>另外一种使用方式  &#x3D;》 把jar包上传到 hive的auxlib下，然后就不用add jar 了&#x3D;》直接创建临时函数就ok&#x3D;》因为hive在启动的时候会有脚本自动add jar</li><li>永久函数：一般不建议 &#x3D;》 除非业务稳定udf函数才会不懂，但是会经常改动就没必要了<ul><li>永久函数在元数据里是可以找到的</li><li><code>create temporary function 方法名字 as &#39;包名&#39; 文件类型 文件的地址（可以在uri上）</code>本地路径会出问题&#x3D;》最好在hdfs上<ul><li>文件类型</li><li>using jar</li><li>File</li><li>archive</li></ul></li><li>在mysql中的元数据里面，可以查看Funcs表，里面存放着我们的永久函数</li><li>删除 <code>drop function functionname</code>但是元数据可能会有不同步的问题</li></ul></li></ul></li><li>临时函数用的比较多但是最推荐&#x3D;》 <code>hive -e/f </code></li><li><code>hive -i xxxx.sql</code>初始化hive的时候添加的一些依赖还可以和-f联用，在spark里也是<br>例子如下</li></ul><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">hive (bigdata_hive3)&gt; <span class="keyword">add</span> jar /home/hadoop/data/bigdatajava<span class="number">-1.0</span>-<span class="keyword">SNAPSHOT</span>.jar;</span><br><span class="line">Added [/home/hadoop/data/bigdatajava<span class="number">-1.0</span>-<span class="keyword">SNAPSHOT</span>.jar] <span class="keyword">to</span> <span class="keyword">class</span> <span class="type">path</span></span><br><span class="line">Added resources: [/home/hadoop/data/bigdatajava<span class="number">-1.0</span>-<span class="keyword">SNAPSHOT</span>.jar] </span><br><span class="line">hive (bigdata_hive3)&gt; <span class="keyword">create</span> <span class="keyword">temporary</span> <span class="keyword">function</span> hello_udf <span class="keyword">as</span> <span class="string">&#x27;udf.udftest&#x27;</span>;</span><br><span class="line">OK</span><br><span class="line">hive (bigdata_hive3)&gt; <span class="keyword">select</span> hello_udf(<span class="string">&#x27;jjjj&#x27;</span>);</span><br><span class="line">OK</span><br><span class="line">_c0</span><br><span class="line">jjjjhello</span><br><span class="line"><span class="type">Time</span> taken: <span class="number">0.108</span> seconds, Fetched: <span class="number">1</span> <span class="keyword">row</span>(s)</span><br><span class="line"><span class="comment">-----------------------------------------------------------------------------永久函数和这个差不多</span></span><br></pre></td></tr></table></figure></li><li><p>udaf：多进一出</p></li><li><p>udtf：一进多出</p></li></ul><h2 id="调优："><a href="#调优：" class="headerlink" title="调优："></a>调优：</h2><p>模式限制 ：<code>hive.mapred.mode =stricted/unstricted</code>严格模式&#x3D;》一些风险操作不被允许&#x3D;》order by 等 &#x3D;》 原因 order by 做全局排序的时候是一个reduce task的当数据量特别多的时候 可能会卡死</p><p>推测式执行：</p><ul><li>假设 node1 ,node2,node3</li><li>机器上运行我们的task</li><li>假设node3机器负载不较高&#x3D;》cpu利用率高&#x3D;》mem被别的作业占用</li></ul><p>思考&#x3D;》task 1 ， task2 很快运行完了&#x3D;》但是因为node3负载高比较慢 &#x3D;》木桶效应 &#x3D;》 短板效应 ：桶中能装多少水是由最短的短板决定的&#x3D;》大数据里task完成的时间是由最慢的task时间决定的</p><p>所以很多多大数据框架都有一个机制&#x3D;》推测式执行机制 &#x3D;&gt;解决这个问题&#x3D;&gt;比如node3节点上跑了一定时间，超过了这个一定时间，就会启动推测式执行，就是会在另外一个节点上再启动个一样的task继续执行&#x3D;》启动参数（默认打开的）</p><ul><li>mapreduce &#x3D;》<ul><li>map <code>mapreduce.map.speculative</code></li><li>reduce <code>mapreduce.reduce.speculative</code></li></ul></li><li>hive &#x3D;&gt;<ul><li><code>hive.mapred.reduce.tasks.speculative.execution</code></li></ul></li></ul><p>新的问题：</p><p>map端：正常</p><p>reduce端： reduce task key 不够分散[skew] &#x3D;&gt; 数据倾斜如何解决？</p><h3 id="裁剪：了解"><a href="#裁剪：了解" class="headerlink" title="裁剪：了解"></a>裁剪：了解</h3><p>参数：<code>hive.optimize.cp</code>是不是开启列裁剪默认就是开启&#x3D;》进行列式存储的时候：行式存储则没有用，因为无论如何都全部加载&#x3D;》就是选则列的时候选几列就加载几列，不会像以前一样全加载，在进行筛选自己想要的列</p><p>参数 ：<code>hive.optimize.ppd</code>是不是开启了谓词下压&#x3D;》和上面一样节省网络io和磁盘io&#x3D;》减少首次加载的数据量&#x3D;》如果开启，hive的底层会进行优化&#x3D;》针对列式存储的时候如果开启，然后用where会直接定位到那个数据，而行式存储则是会对sql进行优化，让其首次加载的数据量变小</p><ul><li>谓词：where等条件</li><li>下压：数据源头</li></ul><p>mapreduce和hive进行整合的时候可以进行设置maptask的数量以及reduce task数量</p><p>map task 个数 取决于 切片的个数 &#x3D;》文件个数，文件大小，blocksize ， 是不是可以被切分</p><p>hive参数 <code>mapreduce.input.fileinputformat.split.minsize</code>和 <code>mapreduce.input.fileinputformat.split.maxsize</code></p><p>map task越多越好吗？&#x3D;》并不是&#x3D;》jvm开启耗费资源&#x3D;》所以并部署越多越好</p><p>设置reduce task 个数 &#x3D;》 决定了最终的文件的个数 &#x3D;》</p><ul><li>用户指定 <code>set mapreduce.job.reduce=number</code></li><li>用户自己设置参数hive自己算 <code>set hive.exec.reducers.bytes.per.reduce</code>&#x3D;&gt;每个reduce处理的数据量 <code>set hive.exec.reduces.max</code> &#x3D;&gt;reduce task最多有多少个</li></ul><p>reduce数量设置按照作业复杂度进行判断</p><p>hive 小文件合并问题？<br>为什么说hdfs不适合处理&#x2F;存储小文件？</p><p>存储角度&#x3D;》nn压力</p><p>处理角度：一个小文件一个reduce task</p><p>如何处理小文件？</p><p>hdfs api 处理 &#x3D;&gt; 行式存储 &#x3D;》</p><p>hive 里 合并 DDL &#x3D;》rc 或者orc文件形式存储 &#x3D;》 Alter table&#x2F;Partition Concatenate &#x3D;》走mr</p><p>hive可以mr1-》mr2-》mr3 explain可以查看</p><p>hive ：sql &#x3D;》mr sql的复杂度不一样 &#x3D;》 翻译成 mr的个数以及依赖都不一样</p><p>执行计划：</p><p>查看sql计划</p><ul><li>sql的语法树：现在没了</li><li>sql的依赖stage</li><li>以及mr的数量</li></ul><p>就是在要执行的sql语句前面加上explain</p><p>并行执行即sql可以转换成多个mr 的job执行这些job可能是串行执行，也可能是并行执行</p><p>假如sql &#x3D;》 4个job</p><p>1，2，3无依赖关系，那么他可以并行跑（资源足够的情况下） &#x3D;》 减少时间&#x3D;》参数 ：<code>hive.exec.parallel</code>&#x3D;》<code>hive.exec.parallel.thread.number</code>允许并行的数量</p><p>比如 ： emp e leftjoin depton on xxx</p><p>就关联之前是可以并行跑的，可以减少时间</p><h2 id="数据倾斜"><a href="#数据倾斜" class="headerlink" title="数据倾斜"></a>数据倾斜</h2><p>wc为例：</p><p>map：输出（word ，1）</p><p>shuffle ： 按照分区规则，对map端进行数据的重新分发</p><p>reduce ： 对shuffle的数据进行处理</p><p>但是&#x3D;》当reduce的数据量严重倾斜的时候 会导致&#x3D;》</p><ul><li>能跑完，但是会特别慢</li><li>跑不完，会卡死</li></ul><p>由于某一个或者某几个key对应的数据量特别大，从而导致对应的task处理非常慢，或者卡死&#x3D;》导致的原因shuffle再分配导致的</p><p>走shuffle的</p><ul><li>join</li><li>group by</li><li>count</li><li>distinct</li></ul><p>解决 ： 思想-》先打散再聚合</p><p>group by 导致的 &#x3D;&gt; map 输出的一些key数据量过大从而导致数据倾斜</p><p>通过参数&#x3D;》</p><p><code>hive.groupby.skewindata</code>当出现数据倾斜的时候我们hive会自动对我们的group by 进行优化</p><p><code>hive.map.aggr</code>map端开启了一个聚合</p><p>不通过参数&#x3D;》udf &#x3D;》 相当于先把我们的数据打散之后，对数据进行更改，原来经过shuffle都到一个reduce上，现在，你把数据的匹配规则改一下，让原本10亿的a变成2亿的1_a,2亿的2_a等等，通过上述，把数量，或者操作做完了，然后再次执行一个mr进行去前缀，然后再输出结果上输出a…</p><p>&#x3D;》udf:</p><p>add_shuffix</p><p>pre_shuffix</p><p>例子：</p><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line">pre_suffix(n_deptno) <span class="keyword">as</span> pre_deptno,</span><br><span class="line"><span class="keyword">sum</span>(cnt) <span class="keyword">as</span> cnt_sum</span><br><span class="line"><span class="keyword">from</span> </span><br><span class="line">(</span><br><span class="line"><span class="keyword">select</span> </span><br><span class="line">add_suffix(deptno) <span class="keyword">as</span> n_deptno,</span><br><span class="line"><span class="keyword">count</span>(<span class="number">1</span>) <span class="keyword">as</span> cnt </span><br><span class="line"><span class="keyword">from</span> emp </span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span>  add_suffix(deptno)</span><br><span class="line">) <span class="keyword">as</span> <span class="keyword">as</span> </span><br><span class="line"> <span class="keyword">group</span> <span class="keyword">by</span> pre_suffix(n_deptno);</span><br></pre></td></tr></table></figure><p>count（distinct）导致的数据倾斜 &#x3D;》</p><p>distinct&#x3D;》一个reduce task 来完成 &#x3D;》 必然会导致数据倾斜&#x3D;》设置reduce 的个数是没有用的&#x3D;》建议未来不用distinct去重&#x3D;》用group by 进行</p><p>join</p><p>shuffle join &#x2F;普通的join &#x3D;》会导致</p><p>map join &#x3D;》 不会导致数据倾斜</p><p>可以使用map join 但是有个前提 &#x3D;》 有一个表是小表 &#x3D;》 小表是条件</p><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">（<span class="number">1</span>）没有reducer处理，就不会产生数据倾斜；</span><br><span class="line"></span><br><span class="line">（<span class="number">2</span>）没有Map -&gt; Reduce中间的shuffle操作，避免了IO</span><br><span class="line"></span><br><span class="line"><span class="number">1</span>. 开启MapJoin设置</span><br><span class="line">（<span class="number">1</span>）设置自动选择MapJoin，默认是<span class="literal">true</span></span><br><span class="line">set hive.auto.<span class="built_in">convert</span>.<span class="built_in">join</span> = <span class="literal">true</span>;</span><br><span class="line"> </span><br><span class="line">（<span class="number">2</span>）设置小表阈值，默认是25M</span><br><span class="line">set hive.mapjoin.smalltable.filesize=<span class="number">25000000</span>;</span><br><span class="line"> </span><br><span class="line"><span class="number">2</span>. 再大表<span class="built_in">join</span>小表，与小表<span class="built_in">join</span>大表，执行速率几乎相等</span><br><span class="line"></span><br><span class="line">Hive中mapjoin的原理：</span><br><span class="line"></span><br><span class="line"><span class="built_in">map</span>-side <span class="built_in">join</span>：</span><br><span class="line"></span><br><span class="line">小表数据映射成一张hashtable，再上传到分布式节点的内存中；</span><br><span class="line">大表进行分片，每个节点一部分数据，大表数据文件作为<span class="built_in">map</span>端输入，对<span class="built_in">map</span>()函数每一对输入的kv都与已加载到内存中的小表数据连接，</span><br><span class="line">把连接结果按<span class="built_in">key</span>输出，有多少个<span class="built_in">map</span> task，产生多少个结果文件；</span><br><span class="line">由于<span class="built_in">join</span>操作在<span class="built_in">map</span> task中完成，所以无需启动reduce task，没有shuffle操作和reduce端，避免io和数据倾斜</span><br><span class="line"></span><br><span class="line">reduce-side <span class="built_in">join</span>：</span><br><span class="line"></span><br><span class="line"><span class="built_in">map</span>端把结果按<span class="built_in">key</span>输出，并在value中标记出数据来源于table1还是table2</span><br><span class="line">因为在shuffle阶段已经按<span class="built_in">key</span>分组，reduce阶段会判断每个value来自哪张表，然后两表相同<span class="built_in">key</span>的记录连接</span><br><span class="line"><span class="built_in">join</span>操作在reduce task中完成</span><br><span class="line"></span><br><span class="line">缺点<span class="number">1</span>：在<span class="built_in">map</span>阶段没有对数据瘦身，shuffle的网络传输和排序性能很低</span><br><span class="line">缺点<span class="number">2</span>：reduce对<span class="number">2</span>个集合做城际计算，很耗内存，容易造成oom</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>参数设置（上述）</p><p>hints写法</p><p>select &#x2F;* + MAPJOIN(product_info) *&#x2F;</p><p>a.*,</p><p>b.*</p><p>from user_click as a left join product_info as b</p><p>on a.product_id&#x3D;b.product_id</p><p>思路 &#x3D;》 美团的关于数据倾斜的解决方法</p><p>a表 &#x3D;》 有可能会导致数据倾斜的key 和不会导致数据倾斜的</p><p>b表 &#x3D;》 有可能会导致数据倾斜的key 和不会导致数据倾斜的</p><p>然后让他们join的时候无数据倾斜的时候，让他们正常关联，有数据倾斜的要加前缀-》关联join-》减前缀-》聚合</p><p>或者直接抽取skew数据 -》 一个sql专门关联skew的-》一个是无数据倾斜的key</p><p>分桶解决 -》 一般不太纠结这个</p><p>通过idea进行加前缀以及减少前缀</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">加前缀--------------------------------------------------------------</span><br><span class="line"><span class="keyword">package</span> udf;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hive.ql.exec.UDF;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">addqianzhui</span> <span class="keyword">extends</span> <span class="title class_">UDF</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">addqianzhui</span> <span class="variable">addqianzhui</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">addqianzhui</span>();</span><br><span class="line">        System.out.println(addqianzhui.evaluate(args[<span class="number">0</span>], args[<span class="number">1</span>],args[<span class="number">2</span>]));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">evaluate</span><span class="params">(String input,String num,String biaoshifu)</span>&#123; <span class="comment">// object 类型 肯定不会出问题</span></span><br><span class="line">        <span class="type">Random</span> <span class="variable">random</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>();</span><br><span class="line">        <span class="type">int</span> <span class="variable">suijinum</span> <span class="operator">=</span> random.nextInt(Integer.parseInt(num));</span><br><span class="line">        <span class="keyword">return</span> num+biaoshifu+input;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">----------------------------------------------------------------减前缀</span><br><span class="line"><span class="keyword">package</span> udf;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hive.ql.exec.UDF;</span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.common.protocol.types.Field;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">cutqianzhui</span> <span class="keyword">extends</span> <span class="title class_">UDF</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">cutqianzhui</span> <span class="variable">cutqianzhui</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">cutqianzhui</span>();</span><br><span class="line">        System.out.println(cutqianzhui.evaluate(args[<span class="number">0</span>], args[<span class="number">1</span>]));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">evaluate</span><span class="params">(String input,String biaoshifu)</span>&#123; <span class="comment">// object 类型 肯定不会出问题</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">data</span> <span class="operator">=</span> input.split(biaoshifu)[<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>或者我们还可以对hive底层源码进行二次编译，然后打包上传进行函数的添加</p><p>美团文章：</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">没找到</span><br></pre></td></tr></table></figure>]]></content:encoded>
      
      
      <category domain="http://zihang.fun/categories/%E6%97%A5%E5%BF%97/">日志</category>
      
      
      <category domain="http://zihang.fun/tags/hive/">hive</category>
      
      
      <comments>http://zihang.fun/2022/12/28/12-24/#disqus_thread</comments>
      
    </item>
    
  </channel>
</rss>
