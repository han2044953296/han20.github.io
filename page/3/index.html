<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/%E6%A0%91%E5%8F%B6_sleaves%20(1).png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/%E6%A0%91%E5%8F%B6_sleaves.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-flash.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"zihang.fun","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"hide","padding":18,"offset":15,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"flat"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"manual","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="只有努力不会辜负你">
<meta property="og:type" content="website">
<meta property="og:title" content="枫叶冢">
<meta property="og:url" content="http://zihang.fun/page/3/index.html">
<meta property="og:site_name" content="枫叶冢">
<meta property="og:description" content="只有努力不会辜负你">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="liu zihang">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://zihang.fun/page/3/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>枫叶冢</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/rss2.xml" title="枫叶冢" type="application/rss+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>
    <a target="_blank" rel="noopener" href="https://github.com/han2044953296" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#fff; color:#151513; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">枫叶冢</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-schedule">

    <a href="/schedule/" rel="section"><i class="fa fa-calendar fa-fw"></i>日程表</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://zihang.fun/2022/12/06/12-06/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="liu zihang">
      <meta itemprop="description" content="只有努力不会辜负你">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="枫叶冢">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/12/06/12-06/" class="post-title-link" itemprop="url">项目可视化框架</a>
        </h2>

        <div class="post-meta">
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-12-06 08:48:06" itemprop="dateCreated datePublished" datetime="2022-12-06T08:48:06+08:00">2022-12-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-01-11 09:12:11" itemprop="dateModified" datetime="2023-01-11T09:12:11+08:00">2023-01-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%97%A5%E5%BF%97/" itemprop="url" rel="index"><span itemprop="name">日志</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>12k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>11 分钟</span>
            </span>

        </div>
      </header>

    
    
    

   

    <div class="post-body" itemprop="articleBody">

      
          <h1 id="superset"><a href="#superset" class="headerlink" title="superset"></a>superset</h1><p>官网 ： superset ： <a target="_blank" rel="noopener" href="https://superset.apache.org/">https://superset.apache.org/</a></p>
<p>类似于otb ： 开箱即用</p>
<p>把图弄到一个dashboard中 ，显示出来</p>
<p>底层源码  ： python编译的 ： 建议先安装python 然后再安装它 ，不要把superset和mysql在一起</p>
<p>因为原生的superset，需要一个和mysql冲突的包</p>
<p>但是docker还是可以的</p>
<p>先安装python环境</p>
<p>anconda -》 python</p>
<p>python原生 ： 建议</p>
<h2 id="docker安装"><a href="#docker安装" class="headerlink" title="docker安装"></a>docker安装</h2><p>毫无疑问docker安装是最快速的而且，不用担心依赖等</p>
<p>docker安装的步骤如下  ：</p>
<p>先安装yarn工具集</p>
<p><code>yum -y install yum-utils</code></p>
<p>然后把docker源添加到镜像里</p>
<p><code>yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</code></p>
<p>我这里添加的是阿里的镜像源</p>
<p>然后更新软件包索引</p>
<p><code>yum makecache fast</code></p>
<p>接下来我们就要开始安装docker了</p>
<p><code>yum -y install docker-ce docker-ce-cli containerd.io</code></p>
<p>设置一下docker开机自启</p>
<p><code>systemctl enable docker</code></p>
<p>然后我们启动docker</p>
<p><code>systemctl start docker</code></p>
<p>我们搜索superset镜像</p>
<p><code>docker search superset</code></p>
<p>直接拉去自己想要的版本 ，我这里拉去的是0.37.2的</p>
<p><code>docker pull amancevice/superset:0.37.2</code></p>
<p>接下来我们要创建存储superset配置文件及数据文件的文件夹</p>
<p><code>mkdir -p /opt/module/docker/superset/conf </code></p>
<p><code>mkdir -p /opt/module/docker/superset/data</code></p>
<p>接下来我们要创建superset的容器，并把端口映射出来</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --name superset -u <span class="number">0</span> -d -p <span class="number">8088</span>:<span class="number">8088</span> -v <span class="regexp">/opt/m</span>odule<span class="regexp">/docker/</span>superset<span class="regexp">/conf:/</span>etc<span class="regexp">/superset -v /</span>opt<span class="regexp">/module/</span>docker<span class="regexp">/superset/</span>data:<span class="regexp">/var/</span>lib<span class="regexp">/superset amancevice/</span>superset:<span class="number">0.37</span>.<span class="number">2</span></span><br></pre></td></tr></table></figure>

<p>然后初始化我们的superset数据库</p>
<p><code>docker exec -it superset superset db upgrade</code></p>
<p>创建superset的管理员账号</p>
<p><code>docker exec -it superset superset fab create-admin</code></p>
<p>创建成功之后可以对其进行初始化了</p>
<p><code>docker exec -it superset superset init </code></p>
<p>最后执行开启服务</p>
<p><code>docker exec -it superset superset run --with-threads --reload --debugger</code></p>
<p>就可以啦 ，我们可以通过web页面 ip:8088访问 因为我们映射的端口是8088嘛</p>
<p>但是要注意一点，就是我们在我们的superset添加数据库的时候不能用修改了host里的别名进行IP替代</p>
<p>因为我们的superset是安装在我们的docker里的哪里的host并没有进行修改，识别不了别名，我们可以对其进行修改，但是嫌麻烦可以直接弄个ip</p>
<p>接下来我们简单弄个启动脚本</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">check_log_dir</span></span>()</span><br><span class="line">&#123;</span><br><span class="line">    SUPERSET_LOG_DIR=/usr/local/src/superset/logs</span><br><span class="line">    <span class="keyword">if</span> [ ! -d <span class="variable">$SUPERSET_LOG_DIR</span> ]</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">mkdir</span> -p <span class="variable">$SUPERSET_LOG_DIR</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">superset_start</span></span>()</span><br><span class="line">&#123;</span><br><span class="line">    cmd=<span class="string">&quot;docker start superset;nohup docker exec -it superset superset run --with-threads --reload --debugger &gt;<span class="variable">$SUPERSET_LOG_DIR</span>/superset.log 2&gt;&amp;1 &amp;&quot;</span></span><br><span class="line">    <span class="built_in">eval</span> <span class="variable">$cmd</span> || <span class="built_in">echo</span> <span class="string">&quot;superset服务已启动&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">superset_stop</span></span>()</span><br><span class="line">&#123;</span><br><span class="line">   docker stop superset</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">superset_status</span></span>()</span><br><span class="line">&#123;</span><br><span class="line">  docker ps</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="variable">$1</span> <span class="keyword">in</span></span><br><span class="line"><span class="string">&quot;start&quot;</span>)</span><br><span class="line">     check_log_dir</span><br><span class="line">     superset_start</span><br><span class="line">    ;;</span><br><span class="line"><span class="string">&quot;stop&quot;</span>)</span><br><span class="line">     superset_stop</span><br><span class="line">    ;;</span><br><span class="line"><span class="string">&quot;status&quot;</span>)</span><br><span class="line">      superset_status</span><br><span class="line">    ;;</span><br><span class="line">*)</span><br><span class="line">    <span class="built_in">echo</span> Invalid Args!</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&#x27;Usage: &#x27;</span>$(<span class="built_in">basename</span> <span class="variable">$0</span>)<span class="string">&#x27; start|stop|status&#x27;</span></span><br><span class="line">    ;;</span><br><span class="line"><span class="keyword">esac</span></span><br></pre></td></tr></table></figure>

<h2 id="原生安装"><a href="#原生安装" class="headerlink" title="原生安装"></a>原生安装</h2><p>superset的原生安装是有坑的 ，以下操作只能是root用</p>
<p>在安装superset的时候容易出现gcc的问题，解决方法就是一直重新安装那一步</p>
<p>下面我们一起来进行原生安装</p>
<p>首先我们要安装python3的一些依赖 <code>yum -y install zlib-devel bzip2-devel openssl-devel ncurses-devel sqlite-devel readline-devel tk-devel gdbm-devel db4-devel libpcap-devel xz-devel</code></p>
<p>然后我们要进行安装EPEL源并安装superset必备的包</p>
<p><code>yum install epel-release #安装epel源</code></p>
<p><code>yum install mysql-devel #安装MySQL开发包，属于pymysqlclient依赖</code></p>
<p><code>yum install gcc gcc-c++ libffi-devel python-devel python-pip python-wheel openssl-devel cyrus-sasl-devel openldap-devel</code></p>
<p>接下来我们要上传自己的python安装包到linuxx服务器上</p>
<p> <code>cd /root/公共</code></p>
<p><code>tar -xf ./Python-3.6.6.tgz</code></p>
<p>然后进入到解压出来的文件夹中进行编译</p>
<p><code>./configure</code></p>
<p><code>make &amp;&amp; make install</code></p>
<p>安装python3的virtualenv并建⽴superset的env</p>
<p><code>pip3 install --upgrade pip -i http://pypi.douban.com/simple --trusted-host pypi.douban.com</code></p>
<p><code>virtualenv -i http://pypi.douban.com/simple --trusted-host pypi.douban.com</code></p>
<p><code>pip3 install --upgrade setuptools -i http://pypi.douban.com/simple --trusted-host pypi.douban.com</code></p>
<p>建⽴superset的env&amp;激活</p>
<p><code>python3 -m venv superset-py3</code></p>
<p><code>source superset-py3/bin/activate #激活superset的venv</code></p>
<p>安装superset需要的安装包</p>
<p>这个包的数量很多建议大家创建一个txt文件然后安装</p>
<p>requirement.txt文件添加</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">alembic</span>==<span class="number">1</span>.<span class="number">3</span>.<span class="number">2</span>            # via flask-migrate</span><br><span class="line"><span class="attribute">amqp</span>==<span class="number">2</span>.<span class="number">5</span>.<span class="number">2</span>               # via kombu</span><br><span class="line"><span class="attribute">apispec</span>[yaml]==<span class="number">1</span>.<span class="number">3</span>.<span class="number">3</span>      # via flask-appbuilder</span><br><span class="line"><span class="attribute">attrs</span>==<span class="number">19</span>.<span class="number">3</span>.<span class="number">0</span>             # via jsonschema</span><br><span class="line"><span class="attribute">babel</span>==<span class="number">2</span>.<span class="number">8</span>.<span class="number">0</span>              # via flask-babel</span><br><span class="line"><span class="attribute">backoff</span>==<span class="number">1</span>.<span class="number">10</span>.<span class="number">0</span>           # via apache-superset (setup.py)</span><br><span class="line"><span class="attribute">billiard</span>==<span class="number">3.6.3.0</span>         # via celery</span><br><span class="line"><span class="attribute">bleach</span>==<span class="number">3</span>.<span class="number">1</span>.<span class="number">0</span>             # via apache-superset (setup.py)     ---</span><br><span class="line"><span class="attribute">celery</span>==<span class="number">4</span>.<span class="number">4</span>.<span class="number">1</span>             # via apache-superset (setup.py)</span><br><span class="line"><span class="attribute">cffi</span>==<span class="number">1</span>.<span class="number">13</span>.<span class="number">2</span>              # via cryptography</span><br><span class="line"><span class="attribute">click</span>==<span class="number">7</span>.<span class="number">1</span>.<span class="number">1</span>              # via apache-superset (setup.py), flask, flask-appbuilder</span><br><span class="line"><span class="attribute">colorama</span>==<span class="number">0</span>.<span class="number">4</span>.<span class="number">3</span>           # via apache-superset (setup.py), flask-appbuilder</span><br><span class="line"><span class="attribute">contextlib2</span>==<span class="number">0</span>.<span class="number">6</span>.<span class="number">0</span>.post1  # via apache-superset (setup.py)</span><br><span class="line"><span class="attribute">croniter</span>==<span class="number">0</span>.<span class="number">3</span>.<span class="number">31</span>          # via apache-superset (setup.py)</span><br><span class="line"><span class="attribute">cryptography</span>==<span class="number">2</span>.<span class="number">8</span>         # via apache-superset (setup.py)</span><br><span class="line"><span class="attribute">decorator</span>==<span class="number">4</span>.<span class="number">4</span>.<span class="number">1</span>          # via retry</span><br><span class="line"><span class="attribute">defusedxml</span>==<span class="number">0</span>.<span class="number">6</span>.<span class="number">0</span>         # via python3-openid</span><br><span class="line"><span class="attribute">flask</span>-appbuilder==<span class="number">2</span>.<span class="number">2</span>.<span class="number">4</span>   # via apache-superset (setup.py)</span><br><span class="line"><span class="attribute">flask</span>-babel==<span class="number">1</span>.<span class="number">0</span>.<span class="number">0</span>        # via flask-appbuilder</span><br><span class="line"><span class="attribute">flask</span>-caching==<span class="number">1</span>.<span class="number">8</span>.<span class="number">0</span>      # via apache-superset (setup.py)</span><br><span class="line"><span class="attribute">flask</span>-compress==<span class="number">1</span>.<span class="number">4</span>.<span class="number">0</span>     # via apache-superset (setup.py)</span><br><span class="line"><span class="attribute">flask</span>-jwt-extended==<span class="number">3</span>.<span class="number">24</span>.<span class="number">1</span>  # via flask-appbuilder</span><br><span class="line"><span class="attribute">flask</span>-login==<span class="number">0</span>.<span class="number">4</span>.<span class="number">1</span>        # via flask-appbuilder</span><br><span class="line"><span class="attribute">flask</span>-migrate==<span class="number">2</span>.<span class="number">5</span>.<span class="number">2</span>      # via apache-superset (setup.py)</span><br><span class="line"><span class="attribute">flask</span>-openid==<span class="number">1</span>.<span class="number">2</span>.<span class="number">5</span>       # via flask-appbuilder</span><br><span class="line"><span class="attribute">flask</span>-sqlalchemy==<span class="number">2</span>.<span class="number">4</span>.<span class="number">1</span>   # via flask-appbuilder, flask-migrate</span><br><span class="line"><span class="attribute">flask</span>-talisman==<span class="number">0</span>.<span class="number">7</span>.<span class="number">0</span>     # via apache-superset (setup.py)</span><br><span class="line"><span class="attribute">flask</span>-wtf==<span class="number">0</span>.<span class="number">14</span>.<span class="number">2</span>         # via apache-superset (setup.py), flask-appbuilder</span><br><span class="line"><span class="attribute">flask</span>==<span class="number">1</span>.<span class="number">1</span>.<span class="number">1</span>              # via apache-superset (setup.py), flask-appbuilder, flask-babel, flask-caching, flask-compress, flask-jwt-extended, flask-login, flask-migrate, flask-openid, flask-sqlalchemy, flask-wtf</span><br><span class="line"><span class="attribute">geographiclib</span>==<span class="number">1</span>.<span class="number">50</span>       # via geopy</span><br><span class="line"><span class="attribute">geopy</span>==<span class="number">1</span>.<span class="number">20</span>.<span class="number">0</span>             # via apache-superset (setup.py)</span><br><span class="line"><span class="attribute">gunicorn</span>==<span class="number">20</span>.<span class="number">0</span>.<span class="number">4</span>          # via apache-superset (setup.py)</span><br><span class="line"><span class="attribute">humanize</span>==<span class="number">0</span>.<span class="number">5</span>.<span class="number">1</span>           # via apache-superset (setup.py)</span><br><span class="line"><span class="attribute">importlib</span>-metadata==<span class="number">1</span>.<span class="number">4</span>.<span class="number">0</span>  # via jsonschema, kombu</span><br><span class="line"><span class="attribute">isodate</span>==<span class="number">0</span>.<span class="number">6</span>.<span class="number">0</span>            # via apache-superset (setup.py)</span><br><span class="line"><span class="attribute">itsdangerous</span>==<span class="number">1</span>.<span class="number">1</span>.<span class="number">0</span>       # via flask</span><br><span class="line"><span class="attribute">jinja2</span>==<span class="number">2</span>.<span class="number">10</span>.<span class="number">3</span>            # via flask, flask-babel</span><br><span class="line"><span class="attribute">jsonschema</span>==<span class="number">3</span>.<span class="number">2</span>.<span class="number">0</span>         # via flask-appbuilder</span><br><span class="line"><span class="attribute">kombu</span>==<span class="number">4</span>.<span class="number">6</span>.<span class="number">8</span>              # via celery</span><br><span class="line"><span class="attribute">mako</span>==<span class="number">1</span>.<span class="number">1</span>.<span class="number">1</span>               # via alembic</span><br><span class="line"><span class="attribute">markdown</span>==<span class="number">3</span>.<span class="number">1</span>.<span class="number">1</span>           # via apache-superset (setup.py)</span><br><span class="line"><span class="attribute">markupsafe</span>==<span class="number">1</span>.<span class="number">1</span>.<span class="number">1</span>         # via jinja2, mako</span><br><span class="line"><span class="attribute">marshmallow</span>-enum==<span class="number">1</span>.<span class="number">5</span>.<span class="number">1</span>   # via flask-appbuilder</span><br><span class="line"><span class="attribute">marshmallow</span>-sqlalchemy==<span class="number">0</span>.<span class="number">21</span>.<span class="number">0</span>  # via flask-appbuilder</span><br><span class="line"><span class="attribute">marshmallow</span>==<span class="number">2</span>.<span class="number">19</span>.<span class="number">5</span>       # via flask-appbuilder, marshmallow-enum, marshmallow-sqlalchemy</span><br><span class="line"><span class="attribute">more</span>-itertools==<span class="number">8</span>.<span class="number">1</span>.<span class="number">0</span>     # via zipp</span><br><span class="line"><span class="attribute">msgpack</span>==<span class="number">0</span>.<span class="number">6</span>.<span class="number">2</span>            # via apache-superset (setup.py)</span><br><span class="line"><span class="attribute">numpy</span>==<span class="number">1</span>.<span class="number">18</span>.<span class="number">1</span>             # via pandas, pyarrow</span><br><span class="line"><span class="attribute">pandas</span>==<span class="number">0</span>.<span class="number">25</span>.<span class="number">3</span>            # via apache-superset (setup.py)</span><br><span class="line"><span class="attribute">parsedatetime</span>==<span class="number">2</span>.<span class="number">5</span>        # via apache-superset (setup.py)</span><br><span class="line"><span class="attribute">pathlib2</span>==<span class="number">2</span>.<span class="number">3</span>.<span class="number">5</span>           # via apache-superset (setup.py)</span><br><span class="line"><span class="attribute">polyline</span>==<span class="number">1</span>.<span class="number">4</span>.<span class="number">0</span>           # via apache-superset (setup.py)</span><br><span class="line"><span class="attribute">prison</span>==<span class="number">0</span>.<span class="number">1</span>.<span class="number">2</span>             # via flask-appbuilder</span><br><span class="line"><span class="attribute">py</span>==<span class="number">1</span>.<span class="number">8</span>.<span class="number">1</span>                 # via retry</span><br><span class="line"><span class="attribute">pyarrow</span>==<span class="number">0</span>.<span class="number">16</span>.<span class="number">0</span>           # via apache-superset (setup.py)</span><br><span class="line"><span class="attribute">pycparser</span>==<span class="number">2</span>.<span class="number">19</span>           # via cffi</span><br><span class="line"><span class="attribute">pyjwt</span>==<span class="number">1</span>.<span class="number">7</span>.<span class="number">1</span>              # via flask-appbuilder, flask-jwt-extended</span><br><span class="line"><span class="attribute">python</span>-dateutil==<span class="number">2</span>.<span class="number">8</span>.<span class="number">1</span>    # via alembic, apache-superset (setup.py), croniter, flask-appbuilder, pandas</span><br><span class="line"><span class="attribute">python</span>-dotenv==<span class="number">0</span>.<span class="number">10</span>.<span class="number">5</span>     # via apache-superset (setup.py)</span><br><span class="line"><span class="attribute">python</span>-editor==<span class="number">1</span>.<span class="number">0</span>.<span class="number">4</span>      # via alembic</span><br><span class="line"><span class="attribute">python</span>-geohash==<span class="number">0</span>.<span class="number">8</span>.<span class="number">5</span>     # via apache-superset (setup.py)</span><br><span class="line"><span class="attribute">python3</span>-openid==<span class="number">3</span>.<span class="number">1</span>.<span class="number">0</span>     # via flask-openid</span><br><span class="line"><span class="attribute">pytz</span>==<span class="number">2019</span>.<span class="number">3</span>              # via babel, celery, flask-babel, pandas</span><br><span class="line"><span class="attribute">pyyaml</span>==<span class="number">5</span>.<span class="number">3</span>               # via apache-superset (setup.py), apispec</span><br><span class="line"><span class="attribute">retry</span>==<span class="number">0</span>.<span class="number">9</span>.<span class="number">2</span>              # via apache-superset (setup.py)</span><br><span class="line"><span class="attribute">selenium</span>==<span class="number">3</span>.<span class="number">141</span>.<span class="number">0</span>         # via apache-superset (setup.py)</span><br><span class="line"><span class="attribute">simplejson</span>==<span class="number">3</span>.<span class="number">17</span>.<span class="number">0</span>        # via apache-superset (setup.py)</span><br><span class="line"><span class="attribute">six</span>==<span class="number">1</span>.<span class="number">14</span>.<span class="number">0</span>               # via bleach, cryptography, flask-jwt-extended, flask-talisman, isodate, jsonschema, pathlib2, polyline, prison, pyarrow, pyrsistent, python-dateutil, sqlalchemy-utils, wtforms-json</span><br><span class="line"><span class="attribute">sqlalchemy</span>-utils==<span class="number">0</span>.<span class="number">36</span>.<span class="number">1</span>  # via apache-superset (setup.py), flask-appbuilder</span><br><span class="line"><span class="attribute">sqlalchemy</span>==<span class="number">1</span>.<span class="number">3</span>.<span class="number">12</span>        # via alembic, apache-superset (setup.py), flask-sqlalchemy, marshmallow-sqlalchemy, sqlalchemy-utils</span><br><span class="line"><span class="attribute">sqlparse</span>==<span class="number">0</span>.<span class="number">3</span>.<span class="number">0</span>           # via apache-superset (setup.py)</span><br><span class="line"><span class="attribute">urllib3</span>==<span class="number">1</span>.<span class="number">25</span>.<span class="number">8</span>           # via selenium</span><br><span class="line"><span class="attribute">vine</span>==<span class="number">1</span>.<span class="number">3</span>.<span class="number">0</span>               # via amqp, celery</span><br><span class="line"><span class="attribute">webencodings</span>==<span class="number">0</span>.<span class="number">5</span>.<span class="number">1</span>       # via bleach</span><br><span class="line"><span class="attribute">werkzeug</span>==<span class="number">0</span>.<span class="number">16</span>.<span class="number">0</span>          # via flask, flask-jwt-extended</span><br><span class="line"><span class="attribute">wtforms</span>-json==<span class="number">0</span>.<span class="number">3</span>.<span class="number">3</span>       # via apache-superset (setup.py)</span><br><span class="line"><span class="attribute">wtforms</span>==<span class="number">2</span>.<span class="number">2</span>.<span class="number">1</span>            # via flask-wtf, wtforms-json</span><br><span class="line"><span class="attribute">zipp</span>==<span class="number">2</span>.<span class="number">0</span>.<span class="number">0</span>               # via importlib-metadata</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>然后执行 ：</p>
<p><code> pip3 install -i http://mirrors.aliyun.com/pypi/simple/ --trusted-host mirrors.aliyun.com -r requirement.txt</code></p>
<p>从阿里的镜像源安装这些依赖</p>
<p>接下来是安装Superset</p>
<p>到了这一步，就可能会报错，就是gcc的错误，那是因为安装没有成功，我安装了6次才成功，</p>
<p>执行 ；</p>
<p><code>pip3 install apache-superset==0.37.1  -i http://mirrors.aliyun.com/pypi/simple/ --trusted-host mirrors.aliyun.com</code></p>
<p>然后<strong>安装Mysql数据包</strong></p>
<p><code>install sqlalchemy==1.3.24 -i http://pypi.douban.com/simple --trusted-host pypi.douban.com</code></p>
<p><code>pip3 install mysqlclient -i http://pypi.douban.com/simple --trusted-host pypi.douban.com</code></p>
<p><code>pip3 install &quot;pymssql&lt;3.0&quot; -i http://pypi.douban.com/simple --trusted-host pypi.douban.com </code></p>
<p>接下来我们去我们的mysql里执行</p>
<p><code>CREATE DATABASE </code>superset <code>/*!40100 DEFAULT CHARACTER SET utf8 */;</code></p>
<p>创建其源数据库</p>
<p><strong>修改superset元数据库</strong></p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> vim superset-py3<span class="regexp">/lib/</span>python3.<span class="number">6</span><span class="regexp">/site-packages/</span>superset/config.py</span><br><span class="line"></span><br><span class="line">修改：</span><br><span class="line">SQLALCHEMY_DATABASE_URI = <span class="string">&#x27;mysql://root:123456@hadoop102/superset?charset=utf8&#x27;</span></span><br></pre></td></tr></table></figure>

<p>如果没有这个文件的同学，就是上面安装superset的那一步出问题了，要重新执行</p>
<p><strong>初始化Supetset数据库（Supetset是一个web应用，自带数据库，需要初始化）</strong></p>
<p><code> superset db upgrade</code></p>
<p><strong>创建管理员用户</strong></p>
<p><code>export FLASK_APP=superset</code></p>
<p><code>flask fab create-admin</code></p>
<p><strong>说明：</strong> flask是一个python web框架，Superset使用的就是flask</p>
<p><strong>Superset初始化</strong></p>
<p><code> superset init</code></p>
<p>然后我们要修改mysql里的表</p>
<p><code>alter table superset.table_columns modify type varchar(255);</code></p>
<p>然后就可以启动我们的superset了</p>
<p><code> superset run -h 自己的机器名或者ip  -p 启动端口</code></p>
<p>然后访问</p>
<p><code>http://机器ip或者机器名字:端口/</code></p>
<p>老规矩接下来我们创建个启动脚本</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">check_log_dir</span></span>()</span><br><span class="line">&#123;</span><br><span class="line">    SUPERSET_LOG_DIR=/usr/local/src/superset/logs</span><br><span class="line">    <span class="keyword">if</span> [ ! -d <span class="variable">$SUPERSET_LOG_DIR</span> ]</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">mkdir</span> -p <span class="variable">$SUPERSET_LOG_DIR</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#检查进程是否运行正常，参数1为进程名，参数2为进程端口</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">check_process</span></span>()</span><br><span class="line">&#123;</span><br><span class="line">    pid=$(ps -ef 2&gt;/dev/null | grep -v grep | grep -i <span class="variable">$1</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>)</span><br><span class="line">    ppid=$(netstat -nltp 2&gt;/dev/null | grep <span class="variable">$2</span> | awk <span class="string">&#x27;&#123;print $7&#125;&#x27;</span> | <span class="built_in">cut</span> -d <span class="string">&#x27;/&#x27;</span> -f 1)</span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$pid</span></span><br><span class="line">    [ <span class="string">&quot;<span class="variable">$ppid</span>&quot;</span> ] &amp;&amp; <span class="built_in">return</span> 0 || <span class="built_in">return</span> 1</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">superset_start</span></span>()</span><br><span class="line">&#123;</span><br><span class="line">    metapid=$(check_process superset 8889)</span><br><span class="line">    cmd=<span class="string">&quot;cd /root/公共/Python-3.6.6;source superset-py3/bin/activate;nohup superset run -h bigdata4 -p 8889 &gt;<span class="variable">$SUPERSET_LOG_DIR</span>/superset.log 2&gt;&amp;1 &amp;&quot;</span></span><br><span class="line">    <span class="built_in">eval</span> <span class="variable">$cmd</span> || <span class="built_in">echo</span> <span class="string">&quot;superset服务已启动&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">superset_stop</span></span>()</span><br><span class="line">&#123;</span><br><span class="line">    metapid=$(check_process superset 8889)</span><br><span class="line">    [ <span class="string">&quot;<span class="variable">$metapid</span>&quot;</span> ] &amp;&amp; <span class="built_in">kill</span> <span class="variable">$metapid</span> || <span class="built_in">echo</span> <span class="string">&quot;superset服务未启动&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="variable">$1</span> <span class="keyword">in</span></span><br><span class="line"><span class="string">&quot;start&quot;</span>)</span><br><span class="line">     check_log_dir</span><br><span class="line">     superset_start</span><br><span class="line">    ;;</span><br><span class="line"><span class="string">&quot;stop&quot;</span>)</span><br><span class="line">     superset_stop</span><br><span class="line">    ;;</span><br><span class="line"><span class="string">&quot;status&quot;</span>)</span><br><span class="line">     check_process superset 8889 &gt;/dev/null &amp;&amp; <span class="built_in">echo</span> <span class="string">&quot;superset服务运行正常&quot;</span> || <span class="built_in">echo</span> <span class="string">&quot;superset服务运行异常&quot;</span></span><br><span class="line">    ;;</span><br><span class="line">*)</span><br><span class="line">    <span class="built_in">echo</span> Invalid Args!</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&#x27;Usage: &#x27;</span>$(<span class="built_in">basename</span> <span class="variable">$0</span>)<span class="string">&#x27; start|stop|status&#x27;</span></span><br><span class="line">    ;;</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>关于superset的原生安装就ok了</p>
<h1 id="dataease"><a href="#dataease" class="headerlink" title="dataease"></a>dataease</h1><p>先在官网下载官网地址 ： <a target="_blank" rel="noopener" href="https://www.fit2cloud.com/dataease/features.html">https://www.fit2cloud.com/dataease/features.html</a></p>
<p>目前没有时间等周六周日补上</p>
<p>dataease安装特别简单而且图形炫酷，首推</p>
<p>但是有问题：安装dataease的机器上不能有mysql或者你把mysql的端口改掉，因为它要占用3306端口</p>
<p>不管是在线安装还是离线安装对我们的数据库都有要求，mysql 5.7起步</p>
<p>而且要求我们编辑&#x2F;etc&#x2F;my.cnf文件</p>
<p>然后添加以下内容</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line"><span class="attribute">datadir</span>=/var/lib/mysql</span><br><span class="line"></span><br><span class="line"><span class="attribute">default-storage-engine</span>=INNODB</span><br><span class="line"><span class="attribute">character_set_server</span>=utf8</span><br><span class="line"><span class="attribute">lower_case_table_names</span>=1</span><br><span class="line"><span class="attribute">table_open_cache</span>=128</span><br><span class="line"><span class="attribute">max_connections</span>=2000</span><br><span class="line"><span class="attribute">max_connect_errors</span>=6000</span><br><span class="line"><span class="attribute">innodb_file_per_table</span>=1</span><br><span class="line"><span class="attribute">innodb_buffer_pool_size</span>=1G</span><br><span class="line"><span class="attribute">max_allowed_packet</span>=64M</span><br><span class="line"><span class="attribute">transaction_isolation</span>=READ-COMMITTED</span><br><span class="line"><span class="attribute">innodb_flush_method</span>=O_DIRECT</span><br><span class="line"><span class="attribute">innodb_lock_wait_timeout</span>=1800</span><br><span class="line"><span class="attribute">innodb_flush_log_at_trx_commit</span>=0</span><br><span class="line"><span class="attribute">sync_binlog</span>=0</span><br><span class="line"><span class="attribute">group_concat_max_len</span>=1024000</span><br><span class="line"><span class="attribute">sql_mode</span>=STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION</span><br><span class="line">skip-name-resolve</span><br><span class="line"></span><br><span class="line">[mysql]</span><br><span class="line"><span class="attribute">default-character-set</span>=utf8</span><br><span class="line"></span><br><span class="line">[mysql.server]</span><br><span class="line"><span class="attribute">default-character-set</span>=utf8</span><br></pre></td></tr></table></figure>

<p>在线安装 ：<code>curl -sSL https://github.com/dataease/dataease/releases/latest/download/quick_start.sh | sh</code></p>
<p>就可以了</p>
<p>离线安装：</p>
<p>先下载好安装包然后解压，之后到解压的目录，然后编辑install.conf文件下面是install.conf的配置</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 基础配置</span></span><br><span class="line"><span class="comment">## 安装目录</span></span><br><span class="line"><span class="attr">DE_BASE</span>=/opt</span><br><span class="line"><span class="comment">## Service 端口</span></span><br><span class="line"><span class="attr">DE_PORT</span>=<span class="number">80</span></span><br><span class="line"><span class="comment">## 部署及运行模式，可选值有 local、simple、cluster，分别对应 本地模式、精简模式、集群模式</span></span><br><span class="line"><span class="attr">DE_ENGINE_MODE</span>=simple</span><br><span class="line"><span class="comment">## docker 网段设置</span></span><br><span class="line"><span class="attr">DE_DOCKER_SUBNET</span>=<span class="number">172.19</span>.<span class="number">0.0</span>/<span class="number">16</span></span><br><span class="line"><span class="comment">## docker 网关 IP</span></span><br><span class="line"><span class="attr">DE_DOCKER_GATEWAY</span>=<span class="number">172.19</span>.<span class="number">0.1</span></span><br><span class="line"><span class="comment">## Apache Doris FE IP (外部 Doris 此参数无效)</span></span><br><span class="line"><span class="attr">DE_DORIS_FE_IP</span>=<span class="number">172.19</span>.<span class="number">0.198</span></span><br><span class="line"><span class="comment">## Apache Doris BE IP (外部 Doris 此参数无效)</span></span><br><span class="line"><span class="attr">DE_DORIS_BE_IP</span>=<span class="number">172.19</span>.<span class="number">0.199</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 数据库配置</span></span><br><span class="line"><span class="comment">## 是否使用外部数据库</span></span><br><span class="line"><span class="attr">DE_EXTERNAL_MYSQL</span>=<span class="literal">false</span></span><br><span class="line"><span class="comment">## 数据库地址</span></span><br><span class="line"><span class="attr">DE_MYSQL_HOST</span>=mysql</span><br><span class="line"><span class="comment">## 数据库端口</span></span><br><span class="line"><span class="attr">DE_MYSQL_PORT</span>=<span class="number">3306</span></span><br><span class="line"><span class="comment">## DataEase 数据库库名</span></span><br><span class="line"><span class="attr">DE_MYSQL_DB</span>=dataease</span><br><span class="line"><span class="comment">## 数据库用户名</span></span><br><span class="line"><span class="attr">DE_MYSQL_USER</span>=root</span><br><span class="line"><span class="comment">## 数据库密码</span></span><br><span class="line"><span class="attr">DE_MYSQL_PASSWORD</span>=Password123@mysql</span><br><span class="line"></span><br><span class="line"><span class="comment"># Apache Doris 配置</span></span><br><span class="line"><span class="comment">## 是否使用外部 Apache Doris</span></span><br><span class="line"><span class="attr">DE_EXTERNAL_DORIS</span>=<span class="literal">false</span></span><br><span class="line"><span class="comment">## Doris 地址</span></span><br><span class="line"><span class="attr">DE_DORIS_HOST</span>=doris-fe</span><br><span class="line"><span class="comment">## Doris 查询连接端口</span></span><br><span class="line"><span class="attr">DE_DORIS_PORT</span>=<span class="number">9030</span></span><br><span class="line"><span class="comment">## Doris http端口</span></span><br><span class="line"><span class="attr">DE_DORIS_HTTPPORT</span>=<span class="number">8030</span></span><br><span class="line"><span class="comment">## Doris 数据库名称</span></span><br><span class="line"><span class="attr">DE_DORIS_DB</span>=dataease</span><br><span class="line"><span class="comment">## Doris 用户名</span></span><br><span class="line"><span class="attr">DE_DORIS_USER</span>=root</span><br><span class="line"><span class="comment">## Doris 密码</span></span><br><span class="line"><span class="attr">DE_DORIS_PASSWORD</span>=Password123@doris</span><br><span class="line"></span><br><span class="line"><span class="comment"># Kettle 配置</span></span><br><span class="line"><span class="comment">## 是否使用外部 Kettle - (目前还不支持外部Kettle，除非不需运行Kettle，否则请不要修改此参数)</span></span><br><span class="line"><span class="attr">DE_EXTERNAL_KETTLE</span>=<span class="literal">false</span></span><br><span class="line"><span class="comment">## Kettle 服务器地址</span></span><br><span class="line"><span class="attr">DE_CARTE_HOST</span>=kettle</span><br><span class="line"><span class="comment">## Kettle 访问端口</span></span><br><span class="line"><span class="attr">DE_CARTE_PORT</span>=<span class="number">18080</span></span><br><span class="line"><span class="comment">## Kettle 用户名</span></span><br><span class="line"><span class="attr">DE_CARTE_USER</span>=cluster</span><br><span class="line"><span class="comment">## Kettle 密码</span></span><br><span class="line"><span class="attr">DE_CARTE_PASSWORD</span>=cluster</span><br></pre></td></tr></table></figure>

<p>安装模式有三种 ：</p>
<p><strong>DE_ENGINE_MODE&#x3D;local</strong><br>使用本地模式安装，DataEase 会自带 Doris 与 Kettle 组件，无需再做额外配置，但各组件均为单点，不具备高可用特性。<br>在此模式下，Excel 数据集、API 数据集以及定时同步的数据默认保存在自带的 Doris 组件中。</p>
<p><strong>DE_ENGINE_MODE&#x3D;simple</strong><br>使用精简模式安装，系统不会额外安装 Doris 与 Kettle 组件，提供用户轻量级的应用系统，尤其是对接数据量较小的情况。<br>在此模式下，若用户需要使用 Excel 数据集或 API 数据集可在系统管理界面配置数据引擎（目前仅支持 MySQL 类型），相关数据会存储到该数据引擎中。若只需使用数据库直连则无需做此配置。<br><strong>注意：由于精简模式未配置 Kettle 与 Doris，故相关 SQL 数据集&#x2F;数据库数据集不提供定时同步模式。</strong></p>
<p><strong>DE_ENGINE_MODE&#x3D;cluster</strong><br>使用集群模式安装，系统不会额外安装 Doris 与 Kettle 组件，但会在系统管理模块提供 Doris 与 Kettle 的链接配置界面（请参考【系统管理】的【系统参数】说明），用户可独立安装 Doris 集群及 Kettle 并配置在 DataEase 中。集群模式下 Excel 数据集，API 数据集以及定时同步的数据通过 Kettle 抽取到 Doris 集群中。<br>Doris 安装部署可参考：<a target="_blank" rel="noopener" href="http://doris.incubator.apache.org/zh-CN/">http://doris.incubator.apache.org/zh-CN/</a><br>Kettle 安装部署可参考：<a target="_blank" rel="noopener" href="http://www.kettle.org.cn/">http://www.kettle.org.cn/</a></p>
<p>然后对于离线安装执行</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 进入安装包目录</span></span><br><span class="line">cd dataease-v1.<span class="number">5.0</span>-offline</span><br><span class="line"><span class="comment"># 运行安装脚本</span></span><br><span class="line"><span class="regexp">/bin/</span>bash install.sh</span><br></pre></td></tr></table></figure>

<p>就可以了，效果个很酷炫</p>
<h1 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h1><p>有一个城市表 ： mysql中</p>
<p>有一个商品表 ： mysql中</p>
<p>用户行为数据 ： hdfs上的</p>
<p>求： 最受欢迎的商品 的 top3</p>

      
    </div>

    
    
    

      
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://zihang.fun/2022/12/05/12-05/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="liu zihang">
      <meta itemprop="description" content="只有努力不会辜负你">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="枫叶冢">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/12/05/12-05/" class="post-title-link" itemprop="url">大数据的简单构架</a>
        </h2>

        <div class="post-meta">
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-12-05 09:12:53" itemprop="dateCreated datePublished" datetime="2022-12-05T09:12:53+08:00">2022-12-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-01-11 09:11:34" itemprop="dateModified" datetime="2023-01-11T09:11:34+08:00">2023-01-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%97%A5%E5%BF%97/" itemprop="url" rel="index"><span itemprop="name">日志</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>11k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>10 分钟</span>
            </span>

        </div>
      </header>

    
    
    

   

    <div class="post-body" itemprop="articleBody">

      
          <h1 id="大数据的三件事"><a href="#大数据的三件事" class="headerlink" title="大数据的三件事"></a>大数据的三件事</h1><p>数据采集  ：</p>
<ul>
<li>采集业务数据 ： sqoop ,datax,实时采集maxwell ,flinkdoc</li>
<li>采集日志数据 ： flume ，logstush</li>
</ul>
<p>数据存储 :</p>
<ul>
<li>hdfs (hadoop中的)</li>
<li>hive</li>
<li>hbase【大数据】</li>
<li>数据分析之后的结果数据 ：<ul>
<li>mysql</li>
<li>clickhouse</li>
<li>drios</li>
</ul>
</li>
</ul>
<p>数据分析：</p>
<ul>
<li>map reduce 但是现在不怎么用了，但是思想最重要</li>
<li>hive ： 主要是离线数仓</li>
<li>hbase</li>
<li>spark</li>
<li>flink</li>
</ul>
<p>数据可视化 ：</p>
<ul>
<li>如果有前端开发人员，可以让他们来帮忙</li>
<li>但是如果没有 要自己做<ul>
<li>superset</li>
<li>dataease</li>
<li>echarts</li>
<li>env</li>
<li>anv</li>
</ul>
</li>
<li>收费 : 简历上最好不要写这个<ul>
<li>quickbi</li>
<li>sugar</li>
</ul>
</li>
</ul>
<p>消息中间键 ：</p>
<ul>
<li>kafka</li>
<li>pular</li>
</ul>
<p>(即席查询 ： 临时查询) : presto是最好用的 clickhouse 是有bug的 对内存有要求</p>
<ul>
<li>sparksql , presto , druid , clickhouse ,kylin(cube)</li>
</ul>
<p>数据种类 ：</p>
<ul>
<li>业务数据【mysql ， es】app</li>
<li>日志数据 【log】linux 磁盘上 ，工作中处理的一个重点<ul>
<li>展现日志，点击日志，跳转日志</li>
</ul>
</li>
<li>其他数据</li>
</ul>
<p>架构图  ：</p>
<ul>
<li>业务数据 ： mysql -》sqoop ， datax -》 hds&#x2F;hive</li>
<li>日志数据 ： log文件 -》 flume -》 hdfs&#x2F;hive</li>
<li>hive : 构建离线数仓<ul>
<li>数据分层</li>
<li>维度建模</li>
<li>指标输出</li>
</ul>
</li>
<li>数据可实话<ul>
<li>hive -》 sqoop -》 mysql &#x2F; clickhouse -》数据可视化</li>
</ul>
</li>
</ul>
<p>大数据的基础平台架构</p>
<p>提升 ：大数据的数据平台</p>
<p>大数据基础是相当于 从  0-1 搭建 -》 可以学到以上的所有框架</p>
<p>大数据的数据平台 是基于基础平台再提升了升级 -》 这个学不到什么东西</p>
<p>大数据升级平台</p>
<p>大数据数据开发</p>
<ul>
<li>离线数仓</li>
<li>实时数仓</li>
<li>临时查询</li>
</ul>
<p>大数据的etl工程师</p>
<ul>
<li>数据清洗</li>
<li>数据抽取</li>
<li>数据转换</li>
</ul>
<p>大数据运维工程师</p>
<ul>
<li>上述的框架是它负责安装以及部署的</li>
<li>以及后续的维护</li>
<li>云原生 ， docker ，k8s</li>
</ul>
<p>大数据算法组（数据分析师sql + 数学知识统计 。数据科学家）</p>
<ul>
<li>用户画像</li>
<li>数据挖掘<ul>
<li>python</li>
<li>spark , flink 自带的组件 机器学习相关的组件 ： 速度要比py快</li>
</ul>
</li>
</ul>
<p>新颖的</p>
<ul>
<li>数据湖 -》主要研究方向</li>
<li>云原生 -》 docker ，k8s<ul>
<li>job -》 申请资源 是再yarn上的 ，但是当yarn 做资源隔离的时候万一有三台机器 ，到时候如果所有container 都集中在一台机器上，则会造成机器得负载太大</li>
<li>解决方法 ：<ul>
<li>yarn 的底层编码重写</li>
<li>联合云原生</li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id="sqoop"><a href="#sqoop" class="headerlink" title="sqoop"></a>sqoop</h1><p>简介 ： 可以把数据和hadoop生态圈进行数据库同步，数据传输</p>
<p>sqoop</p>
<ul>
<li>我们可以通过sqoop这个组件 ，把mysql 里的表 同步到 hdfs，hive ，hbase</li>
<li>反之也可以</li>
<li>原理<ul>
<li>sqoop 是只用map阶段 ，无reduce 阶段 （通过mapreduce 实现的）</li>
</ul>
</li>
<li>指定的参数<ul>
<li>url</li>
<li>username</li>
<li>password</li>
<li>驱动</li>
</ul>
</li>
<li>sqoop版本<ul>
<li>sqoop 1 ：1.4.7</li>
<li>sqoop 2 ：1.99.7</li>
<li>注意这两个是没有任何联系的</li>
<li>建议用1</li>
</ul>
</li>
</ul>
<h1 id="部署sqoop"><a href="#部署sqoop" class="headerlink" title="部署sqoop"></a>部署sqoop</h1><p>这里我使用的是1.4.7的sqoop包</p>
<p>首先我们上传到linux上</p>
<p>然后解压</p>
<p>解压之后我们进入到conf目录下，这个里面存的是我们的 配置文件</p>
<p>我们把sqoop-env-template.sh 改名字成 sqoop-env.sh</p>
<p>然后vim 它进行编辑</p>
<p>把hadoop home 的路径放上 ，以及 hive的路经</p>
<p>然后保存退出</p>
<p>我们接下来在全局变量中注册一下sqoop的bin目录</p>
<p>然后把mysql的connect包给到lib文件夹下</p>
<p>然后执行</p>
<figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">1</span>.查看可用的数据库 【<span class="string">mysql</span>】</span><br><span class="line"><span class="string">sqoop</span> <span class="built_in">list-databases</span> \</span><br><span class="line"><span class="built_in">--connect</span> <span class="string">jdbc:mysql:</span>//<span class="string">bigdata2:3306 </span> \</span><br><span class="line"><span class="built_in">--username</span> <span class="string">root</span>  \</span><br><span class="line"><span class="built_in">--password</span> <span class="string">liuzihan010616</span></span><br></pre></td></tr></table></figure>

<p>1.4.7会报错 ，因为 缺少java.commons.lang包</p>
<p>我们把这个包上传到lib下就好了</p>
<h1 id="导入和导出"><a href="#导入和导出" class="headerlink" title="导入和导出"></a>导入和导出</h1><p>sqoop的导入和导出</p>
<p>从mysql里导出数据的时候，会默认导入到&#x2F;user&#x2F;hadoop&#x2F;*</p>
<p>hdfs 文件存储 默认是用 ，进行分割每个字段的</p>
<p>hdfs上有几个文件就是有几个map task 和reduce task</p>
<p>其默认的数量是4</p>
<p>导出</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sqoop <span class="keyword">import</span> \</span><br><span class="line">--connect jdbc:mysql:<span class="comment">//bigdata2:3306/hive  \</span></span><br><span class="line"><span class="comment">--username root  \</span></span><br><span class="line"><span class="comment">--password liuzihan010616 \</span></span><br><span class="line"><span class="comment">--table TBLS</span></span><br></pre></td></tr></table></figure>

<p>设置导出的列的参数</p>
<p><code>--columns</code></p>
<p>设置字段筛选的参数</p>
<p><code>--where</code></p>
<p>设置再yarn上的作业名称</p>
<p><code>--mapreduce-job-name</code></p>
<p>设置 map 和 reduce task 的个数</p>
<p><code>-m,--num-mappers &lt;n&gt; </code></p>
<p>用-m 或者后面的都行</p>
<p>设置hdfs上的文件夹</p>
<p><code>--target-dir</code></p>
<p>设置hdfs上存储的分隔符</p>
<p><code>--fields-terminated-by </code></p>
<p>删除目标文件夹</p>
<p><code>--delete-target-dir </code></p>
<p>总体应用</p>
<figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">sqoop</span>  <span class="string">import</span> \</span><br><span class="line"><span class="built_in">--connect</span> <span class="string">jdbc:mysql:</span>//<span class="string">bigdata2:3306/</span><span class="string">hive</span>  \</span><br><span class="line"><span class="built_in">--username</span> <span class="string">root</span>  \</span><br><span class="line"><span class="built_in">--password</span> <span class="string">liuzihan010616</span> \</span><br><span class="line"><span class="built_in">--delete-target-dir</span> \</span><br><span class="line"><span class="built_in">--fields-terminated-by</span> <span class="string">&#x27;\&#x27;</span> \</span><br><span class="line"><span class="built_in">--target-dir</span> /<span class="string">ghk</span> \</span><br><span class="line">-<span class="string">m</span> <span class="string">1</span> \</span><br><span class="line"><span class="built_in">--mapreduce-job-name</span> <span class="string">&#x27;mysql 的数据try&#x27;</span> \</span><br><span class="line"><span class="built_in">--where</span> <span class="string">&#x27;TBL_ID &gt;= 10&#x27;</span> \</span><br><span class="line"><span class="built_in">--columns</span> <span class="string">&#x27;TBL_ID , OWNER&#x27;</span> \</span><br><span class="line"><span class="built_in">--table</span> <span class="string">TBLS</span></span><br></pre></td></tr></table></figure>

<p>有主键的表可以直接按照上述同步</p>
<p>但是没主键的，要转化</p>
<p>如果是没有主键的表，有两种转换方法</p>
<p>首先是可以通过  ： -m 设置为1 或者 –split-by 列的名字</p>
<p>如下 ：</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">sqoop  import \</span><br><span class="line"><span class="params">--connect</span> jdbc<span class="function">:mysql</span>:<span class="string">//bigdata2</span><span class="function">:3306</span>/<span class="keyword">try</span>  \</span><br><span class="line"><span class="params">--username</span> root  \</span><br><span class="line"><span class="params">--password</span> liuzihan010616 \</span><br><span class="line"><span class="params">--delete-target-dir</span> \</span><br><span class="line"><span class="params">--fields-terminated-by</span> &#x27;\&#x27; \</span><br><span class="line"><span class="params">--target-dir</span> <span class="string">/ghk</span> \</span><br><span class="line"><span class="params">--split-by</span> empno \</span><br><span class="line"><span class="params">--mapreduce-job-name</span> &#x27;mysql 的数据<span class="keyword">try</span>&#x27; \</span><br><span class="line"><span class="params">--table</span> emp</span><br></pre></td></tr></table></figure>

<p>空值处理 ：</p>
<p><code>--null-non-string 0</code></p>
<p>上面的那个是不是string的处理</p>
<p><code>--null-string &#39;&#39;</code></p>
<h2 id="嵌套sql"><a href="#嵌套sql" class="headerlink" title="嵌套sql"></a>嵌套sql</h2><p>用 –query</p>
<p>但是有注意的点</p>
<p>有–query 的时候，不能放–table</p>
<p>且–query 后面只能接单引号</p>
<p>如下</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">sqoop  import \</span><br><span class="line"><span class="params">--connect</span> jdbc<span class="function">:mysql</span>:<span class="string">//bigdata2</span><span class="function">:3306</span>/<span class="keyword">try</span>  \</span><br><span class="line"><span class="params">--username</span> root  \</span><br><span class="line"><span class="params">--password</span> liuzihan010616 \</span><br><span class="line"><span class="params">--delete-target-dir</span> \</span><br><span class="line"><span class="params">--fields-terminated-by</span> &#x27;\&#x27; \</span><br><span class="line"><span class="params">--target-dir</span> <span class="string">/ghk</span> \</span><br><span class="line"><span class="params">--split-by</span> empno \</span><br><span class="line"><span class="params">--mapreduce-job-name</span> &#x27;mysql 的数据<span class="keyword">try</span>&#x27; \</span><br><span class="line"><span class="params">--query</span> &#x27;select * from emp where $CONDITIONS&#x27;</span><br></pre></td></tr></table></figure>

<h1 id="简化"><a href="#简化" class="headerlink" title="简化"></a>简化</h1><p>如上述</p>
<p>我们发现太繁琐了</p>
<p>我们可以进行封装到一起</p>
<p>然后直接调用文件就行</p>
<p><code>sqoop --options-file 文件路径</code></p>
<p>文件内容如下 ：</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">import </span><br><span class="line"><span class="params">--connect</span> </span><br><span class="line">jdbc<span class="function">:mysql</span>:<span class="string">//bigdata2</span><span class="function">:3306</span>/<span class="keyword">try</span>  </span><br><span class="line"><span class="params">--username</span> </span><br><span class="line">root  </span><br><span class="line"><span class="params">--password</span> </span><br><span class="line">liuzihan010616 </span><br><span class="line"><span class="params">--delete-target-dir</span> </span><br><span class="line"><span class="params">--fields-terminated-by</span> </span><br><span class="line">&#x27;\&#x27; </span><br><span class="line"><span class="params">--target-dir</span></span><br><span class="line"><span class="string">/ghk</span> </span><br><span class="line"><span class="params">--split-by</span> </span><br><span class="line">empno </span><br><span class="line"><span class="params">--mapreduce-job-name</span> </span><br><span class="line">&#x27;mysql 的数据<span class="keyword">try</span>&#x27; </span><br><span class="line"><span class="params">--query</span> </span><br><span class="line">&#x27;select * from emp where $CONDITIONS&#x27;</span><br></pre></td></tr></table></figure>

<h3 id="sqoop-job"><a href="#sqoop-job" class="headerlink" title="sqoop job"></a>sqoop job</h3><ul>
<li>create 创建job</li>
<li>list&#x2F;show 查看job list 是查看列表 show 是查看详情</li>
<li>exec 执行job</li>
</ul>
<p>代码如下 ：</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">scoop job <span class="params">--create</span> mysqltry -- \</span><br><span class="line">import \</span><br><span class="line"><span class="params">--connect</span> </span><br><span class="line">jdbc<span class="function">:mysql</span>:<span class="string">//bigdata2</span><span class="function">:3306</span>/<span class="keyword">try</span>  \</span><br><span class="line"><span class="params">--username</span> root  \</span><br><span class="line"><span class="params">--password</span> liuzihan010616 \</span><br><span class="line"><span class="params">--delete-target-dir</span> \</span><br><span class="line"><span class="params">--fields-terminated-by</span> &#x27;\&#x27; \</span><br><span class="line"><span class="params">--target-dir</span> <span class="string">/ghk</span> \</span><br><span class="line"><span class="params">--split-by</span> empno \</span><br><span class="line"><span class="params">--mapreduce-job-name</span> &#x27;mysql 的数据<span class="keyword">try</span>&#x27; \</span><br><span class="line"><span class="params">--query</span> &#x27;select * from emp where $CONDITIONS&#x27;</span><br></pre></td></tr></table></figure>

<h2 id="shell脚本"><a href="#shell脚本" class="headerlink" title="shell脚本"></a>shell脚本</h2><p>也可以通过shell脚本调用 sqoop</p>
<p>如下 ：普通表的</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$#</span> -lt <span class="number">6</span> ];then</span><br><span class="line"> echo <span class="string">&quot;$0 use sync mysql 2 hive&quot;</span></span><br><span class="line"> echo <span class="string">&quot;USAGE:$0 mysqldb sql hivedb hivetable idautocreatetable fengefu&quot;</span></span><br><span class="line"> echo <span class="string">&quot;Example mysql的数据库 sql语句 hive的数据库  hive的表 分隔符 是不是自动创建表&quot;</span></span><br><span class="line"> <span class="keyword">exit</span> <span class="number">1</span>;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"><span class="comment">#mysql parm</span></span><br><span class="line">mysqldb=<span class="variable">$1</span></span><br><span class="line">sql=<span class="string">&quot;$2&quot;</span></span><br><span class="line"><span class="comment">#hive parms </span></span><br><span class="line">hivedb=<span class="variable">$3</span></span><br><span class="line">hivetable=<span class="variable">$4</span></span><br><span class="line">flag =<span class="variable">$6</span></span><br><span class="line"></span><br><span class="line">try <span class="string">&#x27;select * from emp&#x27;</span> bigdata_hive3 emp6 , <span class="number">1</span></span><br><span class="line"></span><br><span class="line">MySQL_URL=<span class="string">&quot;jdbc:mysql://bigdata2:3306/$&#123;mysqldb&#125;&quot;</span> </span><br><span class="line">MySQL_USER=root</span><br><span class="line">MySQL_PASSWD=liuzihan010616</span><br><span class="line">FIELDS_TERMINATED=<span class="variable">$5</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$&#123;flag&#125;</span> -eq <span class="number">1</span> ];then</span><br><span class="line">sqoop import \</span><br><span class="line">--connect <span class="variable">$&#123;MySQL_URL&#125;</span>  \</span><br><span class="line">--username <span class="variable">$&#123;MySQL_USER&#125;</span>  \</span><br><span class="line">--password <span class="variable">$&#123;MySQL_PASSWD&#125;</span> \</span><br><span class="line">--mapreduce-job-name <span class="string">&#x27;mysql2hive&#x27;</span> \</span><br><span class="line">--<span class="keyword">delete</span>-target-dir \</span><br><span class="line">--target-dir <span class="regexp">/sqoop/</span>emp_tmp \</span><br><span class="line">--fields-terminated-by <span class="variable">$&#123;FIELDS_TERMINATED&#125;</span> \</span><br><span class="line">-m <span class="number">1</span> \</span><br><span class="line">--query <span class="string">&quot;$&#123;sql&#125; and \$CONDITIONS &quot;</span> \</span><br><span class="line">--hive-import \</span><br><span class="line">--create-hive-table \</span><br><span class="line">--hive-overwrite \</span><br><span class="line">--hive-database <span class="variable">$&#123;hivedb&#125;</span> \</span><br><span class="line">--hive-table <span class="variable">$&#123;hivetable&#125;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">sqoop import \</span><br><span class="line">--connect <span class="variable">$&#123;MySQL_URL&#125;</span>  \</span><br><span class="line">--username <span class="variable">$&#123;MySQL_USER&#125;</span>  \</span><br><span class="line">--password <span class="variable">$&#123;MySQL_PASSWD&#125;</span> \</span><br><span class="line">--mapreduce-job-name <span class="string">&#x27;mysql2hive&#x27;</span> \</span><br><span class="line">--<span class="keyword">delete</span>-target-dir \</span><br><span class="line">--target-dir <span class="regexp">/sqoop/</span>emp_tmp \</span><br><span class="line">--fields-terminated-by <span class="variable">$&#123;FIELDS_TERMINATED&#125;</span> \</span><br><span class="line">-m <span class="number">1</span> \</span><br><span class="line">--query <span class="string">&quot;$&#123;sql&#125; and \$CONDITIONS &quot;</span> \</span><br><span class="line">--hive-import \</span><br><span class="line">--hive-overwrite \</span><br><span class="line">--hive-database <span class="variable">$&#123;hivedb&#125;</span> \</span><br><span class="line">--hive-table <span class="variable">$&#123;hivetable&#125;</span></span><br><span class="line"><span class="keyword">exit</span> <span class="number">200</span>;</span><br><span class="line">fi</span><br><span class="line">---------------------------------分区表--------------------------------------------</span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$#</span> -lt <span class="number">8</span> ];then</span><br><span class="line"> echo <span class="string">&quot;$0 use sync mysql 2 hive&quot;</span></span><br><span class="line"> echo <span class="string">&quot;USAGE:$0 mysqldb sql hivedb hivetable idautocreatetable fengefu hivepartition hivepartitionvalue&quot;</span></span><br><span class="line"> echo <span class="string">&quot;Example mysql的数据库 sql语句 hive的数据库  hive的table 分隔符  hive的分区属性 分区属性的值 是不是自动创建表&quot;</span></span><br><span class="line"> <span class="keyword">exit</span> <span class="number">1</span>;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"><span class="comment">#mysql parm</span></span><br><span class="line">mysqldb=<span class="variable">$1</span></span><br><span class="line">sql=<span class="string">&quot;$2&quot;</span></span><br><span class="line"><span class="comment">#hive parms </span></span><br><span class="line">hivedb=<span class="variable">$3</span></span><br><span class="line">hivetable=<span class="variable">$4</span></span><br><span class="line">hivepartition=<span class="variable">$6</span></span><br><span class="line">hivepartitionvalue=<span class="variable">$7</span></span><br><span class="line">flag=<span class="variable">$8</span></span><br><span class="line">MySQL_URL=<span class="string">&quot;jdbc:mysql://bigdata2:3306/$&#123;mysqldb&#125;&quot;</span> </span><br><span class="line">MySQL_USER=root</span><br><span class="line">MySQL_PASSWD=liuzihan010616</span><br><span class="line">FIELDS_TERMINATED=<span class="variable">$5</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$&#123;flag&#125;</span> -eq <span class="number">1</span> ];then</span><br><span class="line">sqoop import \</span><br><span class="line">--connect <span class="variable">$&#123;MySQL_URL&#125;</span>  \</span><br><span class="line">--username <span class="variable">$&#123;MySQL_USER&#125;</span>  \</span><br><span class="line">--password <span class="variable">$&#123;MySQL_PASSWD&#125;</span> \</span><br><span class="line">--mapreduce-job-name <span class="string">&#x27;mysql2hive&#x27;</span> \</span><br><span class="line">--<span class="keyword">delete</span>-target-dir \</span><br><span class="line">--target-dir <span class="regexp">/sqoop/</span>emp_tmp \</span><br><span class="line">--fields-terminated-by <span class="variable">$&#123;FIELDS_TERMINATED&#125;</span> \</span><br><span class="line">-m <span class="number">1</span> \</span><br><span class="line">--query <span class="string">&quot;$&#123;sql&#125; and \$CONDITIONS &quot;</span> \</span><br><span class="line">--hive-import \</span><br><span class="line">--hive-overwrite \</span><br><span class="line">--create-hive-table \ </span><br><span class="line">--hive-database <span class="variable">$&#123;hivedb&#125;</span> \</span><br><span class="line">--hive-table <span class="variable">$&#123;hivetable&#125;</span> \</span><br><span class="line">--hive-partition-key <span class="variable">$&#123;hivepartition&#125;</span> \</span><br><span class="line">--hive-partition-value <span class="variable">$&#123;hivepartitionvalue&#125;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">sqoop import \</span><br><span class="line">--connect <span class="variable">$&#123;MySQL_URL&#125;</span>  \</span><br><span class="line">--username <span class="variable">$&#123;MySQL_USER&#125;</span>  \</span><br><span class="line">--password <span class="variable">$&#123;MySQL_PASSWD&#125;</span> \</span><br><span class="line">--mapreduce-job-name <span class="string">&#x27;mysql2hive&#x27;</span> \</span><br><span class="line">--<span class="keyword">delete</span>-target-dir \</span><br><span class="line">--target-dir <span class="regexp">/sqoop/</span>emp_tmp \</span><br><span class="line">--fields-terminated-by <span class="variable">$&#123;FIELDS_TERMINATED&#125;</span> \</span><br><span class="line">-m <span class="number">1</span> \</span><br><span class="line">--query <span class="string">&quot;$&#123;sql&#125; and \$CONDITIONS &quot;</span> \</span><br><span class="line">--hive-import \</span><br><span class="line">--hive-overwrite \</span><br><span class="line">--hive-database <span class="variable">$&#123;hivedb&#125;</span> \</span><br><span class="line">--hive-table <span class="variable">$&#123;hivetable&#125;</span> \</span><br><span class="line">--hive-partition-key <span class="variable">$&#123;hivepartition&#125;</span> \</span><br><span class="line">--hive-partition-value <span class="variable">$&#123;hivepartitionvalue&#125;</span></span><br><span class="line">fi</span><br><span class="line">-----------------------------------------------------hivetomysql的----------------------------------------------------</span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$#</span> -lt <span class="number">4</span> ];then</span><br><span class="line">echo <span class="string">&quot;error 变量小于4个&quot;</span></span><br><span class="line">echo <span class="string">&quot;example try , /user/hive/warehouse/bigdata_hive3.db/emp_partition/deptno=20 emp1&quot;</span></span><br><span class="line">echo <span class="string">&quot;mysql数据库 分隔符 hdfs上的路径 mysql里的表名&quot;</span></span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">mysqldb=<span class="variable">$1</span></span><br><span class="line">fengefu=<span class="variable">$2</span></span><br><span class="line">hdfslujing=<span class="variable">$3</span></span><br><span class="line">mysqltable=<span class="variable">$4</span></span><br><span class="line"></span><br><span class="line">hive -e <span class="string">&quot;use bigdata_hive3 ; create table &quot;</span></span><br><span class="line"></span><br><span class="line">sqoop export \</span><br><span class="line">--connect jdbc:mysql:<span class="regexp">//</span>bigdata2:<span class="number">3306</span>/<span class="variable">$&#123;mysqldb&#125;</span>  \</span><br><span class="line">--username root  \</span><br><span class="line">--password liuzihan010616 \</span><br><span class="line">--fields-terminated-by <span class="variable">$&#123;fengefu&#125;</span> \</span><br><span class="line">--export-dir <span class="variable">$&#123;hdfslujing&#125;</span> \</span><br><span class="line">--null-non-string <span class="number">0</span></span><br><span class="line">--null-string <span class="string">&#x27;&#x27;</span></span><br><span class="line">--table <span class="variable">$&#123;mysqltable&#125;</span> </span><br><span class="line">----------------------------------------------hivetomysql的分区表如何同步-----------------------</span><br><span class="line">先把hive的分区表用create table zz as elect * from xxx(分区表的名字) </span><br><span class="line">然后把zz当成普通表传过去 ，但是在sqoop1.<span class="number">4.7</span> 目前这个功能出现了些问题</span><br><span class="line"> </span><br></pre></td></tr></table></figure>

<h1 id="从mysql-到-hive等工具中"><a href="#从mysql-到-hive等工具中" class="headerlink" title="从mysql 到 hive等工具中"></a>从mysql 到 hive等工具中</h1><p>大部分都和上述一样的</p>
<p>只不过要换个链接以及表名字</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">sqoop import \</span><br><span class="line"><span class="params">--connect</span> jdbc<span class="function">:mysql</span>:<span class="string">//bigdata2</span><span class="function">:3306</span>/<span class="keyword">try</span>  \</span><br><span class="line"><span class="params">--username</span> root  \</span><br><span class="line"><span class="params">--password</span> liuzihan010616 \</span><br><span class="line"><span class="params">--delete-target-dir</span> \</span><br><span class="line"><span class="params">--fields-terminated-by</span> &#x27;\&#x27; \</span><br><span class="line"><span class="params">--target-dir</span> <span class="string">/ghk</span> \</span><br><span class="line"><span class="params">--split-by</span> empno \</span><br><span class="line"><span class="params">--mapreduce-job-name</span> &#x27;mysql 的数据<span class="keyword">try</span>&#x27; \</span><br><span class="line"><span class="params">--query</span> &#x27;select * from emp where $CONDITIONS&#x27; \</span><br><span class="line"><span class="params">--hive-import</span> \</span><br><span class="line"><span class="params">--hive-overwrite</span> \</span><br><span class="line"><span class="params">--create-hive-table</span> \ </span><br><span class="line"><span class="params">--hive-database</span> bigdata_hive3 \</span><br><span class="line"><span class="params">--hive-table</span> emp_hive1</span><br></pre></td></tr></table></figure>

<p>在1.4.7的版本中其要求必须 加上 <code>--target dir 属性</code></p>
<p>且要从hive的lib文件夹下，把所有jar包给sqoop的lib下</p>
<p>上述 create-hive-table 是自动创建表</p>
<p>但是因为mysql里的属性只有几个 ，没hive特有的decmical等，可能会造成丢失数据</p>
<p>所以提议先在hive中创建表，然后再导入</p>
<h2 id="创建分区表"><a href="#创建分区表" class="headerlink" title="创建分区表"></a>创建分区表</h2><p>分区表如上 ；只不过要用</p>
<p><code>--hive-partition-key xxxx（列名）</code></p>
<p><code>--hive-partition-value xxx(分区字段的数值)</code></p>
<p>或者可以直接用–query 用代码的方式进行分区</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">sqoop import \</span><br><span class="line"><span class="params">--connect</span> jdbc<span class="function">:mysql</span>:<span class="string">//bigdata2</span><span class="function">:3306</span>/<span class="keyword">try</span>  \</span><br><span class="line"><span class="params">--username</span> root  \</span><br><span class="line"><span class="params">--password</span> liuzihan010616 \</span><br><span class="line"><span class="params">--delete-target-dir</span> \</span><br><span class="line"><span class="params">--fields-terminated-by</span> &#x27;\&#x27; \</span><br><span class="line"><span class="params">--target-dir</span> <span class="string">/ghk</span> \</span><br><span class="line"><span class="params">--split-by</span> empno \</span><br><span class="line"><span class="params">--mapreduce-job-name</span> &#x27;mysql 的数据<span class="keyword">try</span>&#x27; \</span><br><span class="line"><span class="params">--query</span> &#x27;select empno,ename,job,mgr,hiredate,sal,comm from emp where deptno=20 and $CONDITIONS &#x27; \</span><br><span class="line"><span class="params">--hive-import</span> \</span><br><span class="line"><span class="params">--hive-overwrite</span> \</span><br><span class="line"><span class="params">--create-hive-table</span> \</span><br><span class="line"><span class="params">--hive-database</span> bigdata_hive3 \</span><br><span class="line"><span class="params">--hive-table</span> emp_partition \</span><br><span class="line"><span class="params">--hive-partition-key</span> deptno \</span><br><span class="line"><span class="params">--hive-partition-value</span> 20</span><br></pre></td></tr></table></figure>

<h2 id="数据导出"><a href="#数据导出" class="headerlink" title="数据导出"></a>数据导出</h2><p>不管是hdfs 或者是hive 都是基于路径导出</p>
<p>通过export导出</p>
<p>代码 ：</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sqoop <span class="keyword">export</span> \</span><br><span class="line">--connect jdbc:mysql:<span class="comment">//bigdata2:3306/try  \</span></span><br><span class="line"><span class="comment">--username root  \</span></span><br><span class="line"><span class="comment">--password liuzihan010616 \</span></span><br><span class="line"><span class="comment">--table xxxX \</span></span><br><span class="line"><span class="comment">--fields-terminated-by &#x27;分隔符&#x27; \</span></span><br><span class="line"><span class="comment">--export-dir hdfs上的数据的路径 \</span></span><br></pre></td></tr></table></figure>

<p>这个是hdfs导入到mysql</p>
<p>sqoop导入hive到mysql的时候空值要先进行处理，</p>
<h1 id="开启历史日志"><a href="#开启历史日志" class="headerlink" title="开启历史日志"></a>开启历史日志</h1><p>开启开关 ：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.log-aggregation-enable<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>上述是日志收集的开关</p>
<p>下面是日志在hdfs上存储的lujing</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.log.server.url<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>http://bigdata3:19888/jobhistory/logs<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>下面是设置日志收集的时间</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.log-aggregation.retain-seconds<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>259200<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>接下来我们要配置mapred -site.xml</p>
<p>如下 ：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.jobhistory.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>bigdata3:10020<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.jobhistory.webapp.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>bigdata3:19888<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>然后通过命令行的方式执行命令</p>
<p><code>yarn timelineserver   [bigdata4]</code></p>
<p><code>mapred historyserver  [bigdata3] </code></p>
<p>提示 ： 我的namenode在bigdata3上 ，而resourcemanager 在 bigdata4上</p>
<p>Hive建表时，默认使用的分隔符时候一个特殊的字符，查看表决结构时候是一个’\001’</p>
<p>这不是真正的’\001’，其实是使用八进制编码\001表示</p>
<h2 id="hive-table-gt-mysql-多次导入-数据结果不同"><a href="#hive-table-gt-mysql-多次导入-数据结果不同" class="headerlink" title="hive table -&gt; mysql 多次导入 数据结果不同"></a>hive table -&gt; mysql 多次导入 数据结果不同</h2><p>幂等性 ： 多次操作 ，数据结果是不变的</p>
<p>mysql - &gt; hive -&gt; hive-overwrite</p>
<p>hive -&gt; mysql 幂等性 如何解决</p>
<p>方法 ：</p>
<p>可以通过 <code>mysql -u root -p xxx -e sql语句</code></p>
<p>或者 <code>mysql -uroot -pliuzihan010616 &lt; ./try.sql 这个是执行sql文件</code></p>
<p>上述两个语句是可以在MySQL外部直接进行执行的，不用进入到mysql里</p>
<p>数据库唯一主键</p>
<p>缺点：无法使用change buffer，InnoDB为了进行唯一性检查，必须有一次磁盘IO读页</p>
<p>业务状态校验</p>
<p>业务上根据业务ID的唯一性和业务处理的结果去做判断，但是这部分判断的逻辑需要考虑原子性。否则会因为并发问题导致幂等失效。解决途径（一）加锁，根据当前的服务环境选择单机或分布式锁。（二）采用现成方案Tomato，通过滑动窗口或者固定窗口拦截控制时间内的请求</p>
<p>数据库乐观锁实现幂等性</p>
<p>缺点：操作业务前，需要先查询出当前的version版本。会增加操作</p>
<p>防重 Token 令牌实现幂等性</p>
<p>缺点：</p>
<p>产生过多额外请求</p>
<p>先删除token，如果业务处理出现异常但token已经删除掉了，再来请求会被认定为重复请求</p>
<p>后删除token，如果删除redis中的token失败了，再来请求不会拦截，发生了重复请求</p>
<p>下游传递唯一序列号实现幂等性</p>
<p>缺点：无法控制下游唯一序列号的生成规则，如果序列号由时间戳生成，那么无法拦截类似重复点击这种情况下的重复请求</p>

      
    </div>

    
    
    

      
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://zihang.fun/2022/12/02/12-02/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="liu zihang">
      <meta itemprop="description" content="只有努力不会辜负你">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="枫叶冢">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/12/02/12-02/" class="post-title-link" itemprop="url">hive-4</a>
        </h2>

        <div class="post-meta">
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-12-02 08:59:25" itemprop="dateCreated datePublished" datetime="2022-12-02T08:59:25+08:00">2022-12-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-01-11 09:11:10" itemprop="dateModified" datetime="2023-01-11T09:11:10+08:00">2023-01-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%97%A5%E5%BF%97/" itemprop="url" rel="index"><span itemprop="name">日志</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>6.1k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>6 分钟</span>
            </span>

        </div>
      </header>

    
    
    

   

    <div class="post-body" itemprop="articleBody">

      
          <p>维度组合分析 ：</p>
<p>sql 关键字 ： grouping sets</p>
<p>例子  ：</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> table user_shop (</span><br><span class="line">user_id <span class="keyword">String</span>,</span><br><span class="line">shop_name <span class="keyword">String</span>,</span><br><span class="line">channe <span class="keyword">String</span>,</span><br><span class="line">os <span class="keyword">String</span></span><br><span class="line">)</span><br><span class="line">row format delimited fields terminated <span class="keyword">by</span> <span class="string">&#x27;,&#x27;</span></span><br></pre></td></tr></table></figure>

<p>一般我们进行维度计算的时候，我们可以通过group by 的方式进行</p>
<p>但是假如我们每次都要处理一个维度，那么我们难道要写很多个sql语句吗</p>
<p>这明显是不行的</p>
<p>那么我们如何解决呢</p>
<p>通过grouping sets 就可以解决了</p>
<p>代码如下  ：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> empid,custid,</span><br><span class="line">       sum(qty) <span class="keyword">as</span> sumqty</span><br><span class="line"><span class="keyword">FROM</span> Orders</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span></span><br><span class="line">    <span class="keyword">GROUPING SETS</span></span><br><span class="line">    (</span><br><span class="line">        (empid,custid),</span><br><span class="line">        (empid),(custid),</span><br><span class="line">        ()</span><br><span class="line">    );</span><br></pre></td></tr></table></figure>

<p>上面代码的意思就是 ：我要按照ｇｒｏｕｐ　ｂｙ　的方法　把empid,custid和empid和custid这几个维度都选出来，然后是上下在一起的　相当于用ｕｎｉｏｎ在一起</p>
<p>如果是这次选择的维度中未选择的维度，比如说　，我只选择了　维度empid　，那么custid列就会是空，但是这个比多次重复性写ｓｑｌ语句要好的多</p>
<h1 id="数据转换"><a href="#数据转换" class="headerlink" title="数据转换"></a>数据转换</h1><p>针对以下数据</p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">+--------------+--------------------+</span><br><span class="line">|<span class="string"> hanglie.ame  </span>|<span class="string"> hanglie.teresting  </span>|</span><br><span class="line">+--------------+--------------------+</span><br><span class="line">|<span class="string"> zuan         </span>|<span class="string"> 王者荣耀               </span>|</span><br><span class="line">|<span class="string"> zuan         </span>|<span class="string"> 吃饭                 </span>|</span><br><span class="line">|<span class="string"> zuan         </span>|<span class="string"> rap                </span>|</span><br><span class="line">|<span class="string"> zuan         </span>|<span class="string"> 唱歌                 </span>|</span><br><span class="line">|<span class="string"> chaofeng     </span>|<span class="string"> 王者荣耀               </span>|</span><br><span class="line">|<span class="string"> chaofeng     </span>|<span class="string"> 睡觉                 </span>|</span><br><span class="line">|<span class="string"> chaofeng     </span>|<span class="string"> 方亚                 </span>|</span><br><span class="line">+--------------+--------------------+</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>我们可以把后面散开的数据转化成一个array存起来</p>
<p>通过 collect_list 函数转化成array 而且可以通过 concat_ws函数设置每个参数之间的分隔符</p>
<p>如下</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line">ame,</span><br><span class="line">collect_list(teresting) <span class="keyword">as</span> interesting,</span><br><span class="line">concat_ws(<span class="string">&#x27;:&#x27;</span> , collect_list(teresting)) <span class="keyword">as</span> newin</span><br><span class="line"><span class="keyword">from</span> hanglie</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> ame</span><br></pre></td></tr></table></figure>

<p>结果如下：</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+<span class="params">-----------</span>+<span class="params">---------------------------</span>+<span class="params">-----------------</span>+</span><br><span class="line">|    ame    |        interesting        |      newin      |</span><br><span class="line">+<span class="params">-----------</span>+<span class="params">---------------------------</span>+<span class="params">-----------------</span>+</span><br><span class="line">| chaofeng  | [<span class="string">&quot;王者荣耀&quot;</span>,<span class="string">&quot;睡觉&quot;</span>,<span class="string">&quot;方亚&quot;</span>]        | 王者荣耀:睡觉:方亚      |</span><br><span class="line">| zuan      | [<span class="string">&quot;王者荣耀&quot;</span>,<span class="string">&quot;吃饭&quot;</span>,<span class="string">&quot;rap&quot;</span>,<span class="string">&quot;唱歌&quot;</span>]  | 王者荣耀:吃饭<span class="function">:rap</span>:唱歌  |</span><br><span class="line">+<span class="params">-----------</span>+<span class="params">---------------------------</span>+<span class="params">-----------------</span>+</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="concat"><a href="#concat" class="headerlink" title="concat"></a>concat</h2><p>concat是可以更改数组分隔符的一个函数</p>
<p>例子 ：</p>
<p>拼接：</p>
<ul>
<li>concat  &#x3D;》 字符串拼接</li>
<li>select concat(“zuan”,”|”,”zihang”,”|”,”chaofeng”)</li>
<li>结果是 ：zuan|zihang|chaofeng</li>
<li>concat_ws(string SEP, string A, string B…) &#x3D;》 字符串拼接</li>
<li>select concat_ws(“|”,”zuan”,”zihang”,”chaofeng”)</li>
<li>可变参数 &#x3D;》 array【String】</li>
<li>select concat_ws(“|”,split(“a,a,a”,’,’)</li>
<li>select  split(“a,a,a”,’,’)  ： 这个就是切割字符串</li>
</ul>
<p>所有类型的可以转换成字符串</p>
<p>字符串有好处也有坏处</p>
<p>因为无法排序</p>
<p>但是经过hive优化，字符串是可以进行四则运算的</p>
<p>字符串排序： 按照字典序进行排序的 a-z</p>
<h2 id="BY"><a href="#BY" class="headerlink" title="BY"></a>BY</h2><p>四个by</p>
<h3 id="order-by"><a href="#order-by" class="headerlink" title="order by"></a>order by</h3><p>全局排序 ，且reduce只有一个</p>
<p>order by会对输入进行全局排序，因此只有一个Reducer（多个Reducer无法保证全局有序），然而只有一个Reducer会导致计算效率非常低，使用较少。事实上，在生产环境中，order by 很容易造成OOM。</p>
<p>如下  ：</p>
<figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span>  *  <span class="keyword">from</span> emp <span class="keyword">order</span> <span class="keyword">by</span> empno;</span><br></pre></td></tr></table></figure>

<p>执行上述语句要开启个开关才可以</p>
<p>hive.mapred.mode &#x3D;&gt;some risky queries are not allowed to run 【关闭】</p>
<p>如果用order by 推荐和 limit搭配</p>
<h3 id="sort-by"><a href="#sort-by" class="headerlink" title="sort by"></a>sort by</h3><p>分区排序 ： 不能保证 全局有序</p>
<p>sort by不是全局排序，它会在数据进入Reducer之前完成排序。因此如果使用sort by进行排序，并且设置mapreduce.job.reduces多于一个，则sort by只会保证每个reducer的输出有序，不能保证全局有序。但是可以对最后的结果进行归并排序实现全局排序。</p>
<p>假如你的reduce task 个数 是 1 则它和order by 是一样的</p>
<p>调制reduce task 个数 ：</p>
<ul>
<li>mapred.reduce.tasks</li>
<li>set  mapred.reduce.tasks;</li>
</ul>
<h3 id="Distribute-By"><a href="#Distribute-By" class="headerlink" title="Distribute  By"></a>Distribute  By</h3><p>数据开发的时候会用到</p>
<p>distribute by的作用是控制map端如何拆分数据给reduce端。hive会根据distribute by后面的字段，对reduce的个数进行分发，默认采用的是hash算法。sort by保证每个reduce内有序，因此distribute by经常和sort by配合使用。生产环境中 distribute by + sort by用的多。</p>
<p>数据 如下 ：</p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">2020,1w</span><br><span class="line">2020,2w</span><br><span class="line">2020,1w</span><br><span class="line">2020,0.5w</span><br><span class="line">2021,10w</span><br><span class="line">2021,20w</span><br><span class="line">2021,19w</span><br><span class="line">2021,1.5w</span><br><span class="line">2022,1.3w</span><br><span class="line">2022,2w</span><br><span class="line">2022,1w</span><br><span class="line">2022,0.5w</span><br><span class="line"></span><br><span class="line">+-----------------------+--------------------------+</span><br><span class="line">|<span class="string"> hive_distribute.year  </span>|<span class="string"> hive_distribute.earning  </span>|</span><br><span class="line">+-----------------------+--------------------------+</span><br><span class="line">|<span class="string"> 2020                  </span>|<span class="string"> 1w                       </span>|</span><br><span class="line">|<span class="string"> 2020                  </span>|<span class="string"> 2w                       </span>|</span><br><span class="line">|<span class="string"> 2020                  </span>|<span class="string"> 1w                       </span>|</span><br><span class="line">|<span class="string"> 2020                  </span>|<span class="string"> 0.5w                     </span>|</span><br><span class="line">|<span class="string"> 2021                  </span>|<span class="string"> 10w                      </span>|</span><br><span class="line">|<span class="string"> 2021                  </span>|<span class="string"> 20w                      </span>|</span><br><span class="line">|<span class="string"> 2021                  </span>|<span class="string"> 19w                      </span>|</span><br><span class="line">|<span class="string"> 2021                  </span>|<span class="string"> 1.5w                     </span>|</span><br><span class="line">|<span class="string"> 2022                  </span>|<span class="string"> 1.3w                     </span>|</span><br><span class="line">|<span class="string"> 2022                  </span>|<span class="string"> 2w                       </span>|</span><br><span class="line">|<span class="string"> 2022                  </span>|<span class="string"> 1w                       </span>|</span><br><span class="line">|<span class="string"> 2022                  </span>|<span class="string"> 0.5w                     </span>|</span><br><span class="line">+-----------------------+--------------------------+</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>建表 ：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">create</span> <span class="built_in">table</span> hive_distribute(</span><br><span class="line">year <span class="built_in">string</span>,</span><br><span class="line">earning <span class="built_in">string</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>执行语句 ：</p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">select  <span class="symbol">*</span>  from hive_distribute distribute by year   sort by earning;</span><br><span class="line"></span><br><span class="line">+-----------------------+--------------------------+</span><br><span class="line">|<span class="string"> hive_distribute.year  </span>|<span class="string"> hive_distribute.earning  </span>|</span><br><span class="line">+-----------------------+--------------------------+</span><br><span class="line">|<span class="string"> 2022                  </span>|<span class="string"> 0.5w                     </span>|</span><br><span class="line">|<span class="string"> 2020                  </span>|<span class="string"> 0.5w                     </span>|</span><br><span class="line">|<span class="string"> 2022                  </span>|<span class="string"> 1.3w                     </span>|</span><br><span class="line">|<span class="string"> 2021                  </span>|<span class="string"> 1.5w                     </span>|</span><br><span class="line">|<span class="string"> 2021                  </span>|<span class="string"> 10w                      </span>|</span><br><span class="line">|<span class="string"> 2021                  </span>|<span class="string"> 19w                      </span>|</span><br><span class="line">|<span class="string"> 2022                  </span>|<span class="string"> 1w                       </span>|</span><br><span class="line">|<span class="string"> 2020                  </span>|<span class="string"> 1w                       </span>|</span><br><span class="line">|<span class="string"> 2020                  </span>|<span class="string"> 1w                       </span>|</span><br><span class="line">|<span class="string"> 2021                  </span>|<span class="string"> 20w                      </span>|</span><br><span class="line">|<span class="string"> 2022                  </span>|<span class="string"> 2w                       </span>|</span><br><span class="line">|<span class="string"> 2020                  </span>|<span class="string"> 2w                       </span>|</span><br><span class="line">+-----------------------+--------------------------+</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="Cluster-By"><a href="#Cluster-By" class="headerlink" title="Cluster By"></a>Cluster By</h2><p>ClusterByis a short-cut for both DistributeByand Sort By.</p>
<p>distributeby year   sort by year  《&#x3D;》 ClusterBy year 正确</p>
<p>当distribute by 和 sort by字段相同时，可以使用cluster by。<br>cluster by除了具有distribute by的功能外还兼具sort by的排序功能。但是排序只能是默认的升序，无法指定排序规则。</p>
<h3 id="分桶表"><a href="#分桶表" class="headerlink" title="分桶表"></a>分桶表</h3><p>hdfs上的文件 ，本地文件会找不到文件，一般只能识别hdfs上的</p>
<p>分桶表是对列值取哈希值的方式，将不同数据放到不同文件中存储。 对于 hive 中每一个表、分区都可以进一步进行分桶。 由列的哈希值除以桶的个数来决定每条数据划分在哪个桶中。</p>
<p>要先开启分桶支持</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> hive.enforce.<span class="attribute">bucketing</span>=<span class="literal">true</span>;</span><br></pre></td></tr></table></figure>

<p>分桶表的創建</p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">[</span>CLUSTERED <span class="keyword">BY</span> (col_name, col_name, <span class="params">...</span>) </span><br><span class="line"> <span class="keyword">INTO</span> num_buckets BUCKETS<span class="meta">]</span></span><br></pre></td></tr></table></figure>

<p>数据</p>
<figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>,<span class="symbol">name1</span></span><br><span class="line"><span class="number">2</span>,<span class="symbol">name2</span></span><br><span class="line"><span class="number">3</span>,<span class="symbol">name3</span></span><br><span class="line"><span class="number">4</span>,<span class="symbol">name4</span></span><br><span class="line"><span class="number">5</span>,<span class="symbol">name5</span></span><br><span class="line"><span class="number">6</span>,<span class="symbol">name6</span></span><br><span class="line"><span class="number">7</span>,<span class="symbol">name7</span></span><br><span class="line"><span class="number">8</span>,<span class="symbol">name8</span></span><br></pre></td></tr></table></figure>

<p>创建表</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> hive_bucket(</span><br><span class="line">id <span class="type">int</span>,</span><br><span class="line"><span class="type">name</span> string </span><br><span class="line">)</span><br><span class="line">clustered <span class="keyword">by</span> (id) <span class="keyword">into</span> <span class="number">4</span> buckets</span><br><span class="line"><span class="keyword">row</span> <span class="keyword">format</span> delimited fields terminated <span class="keyword">by</span> &quot;,&quot;;</span><br></pre></td></tr></table></figure>

<p>查询桶中数据</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> id,<span class="type">name</span> <span class="keyword">from</span> hive_bucket <span class="keyword">tablesample</span>(bucket <span class="number">4</span> <span class="keyword">out</span> <span class="keyword">of</span> <span class="number">4</span> <span class="keyword">on</span> <span class="type">name</span>); //bucket后面的数字就是我们要查看的桶的编号 <span class="keyword">out</span> <span class="keyword">of</span> 后面的是总数 ，<span class="keyword">on</span> 后面的是我们分桶的属性</span><br></pre></td></tr></table></figure>

<p>mapreduce:</p>
<p>hash % reducetask个数</p>
<p>文件存储格式</p>
<ul>
<li>行式存储  ：<ul>
<li>里面的列 掺杂很多数据类型</li>
<li>一行内容所有的列都在一个 block里面</li>
<li>行式存储加载所 是把所有的列都查询出来 再过滤出 用户需要的列</li>
<li>如果用户 仅仅查几个字段  &#x3D;》 磁盘io 开销比较大</li>
<li>textfile 文本文件</li>
<li>SequenceFile 文本文件</li>
</ul>
</li>
<li>列式存储 ：<ul>
<li>按照列进行存储</li>
<li>前提： 企业 table 字段 几十个 到几百个</li>
<li>RCFile  &#x3D;》 行 &#x3D;》 列</li>
<li>ORC Files + Parquet</li>
<li>查询几个列</li>
<li>加载表中所有字段</li>
</ul>
</li>
<li>列式存储文件 数据量 比 行式存储的数据量少 【前提 都采用压缩】</li>
</ul>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">create</span> table hive_distribute_col(</span><br><span class="line">year <span class="keyword">string</span>,</span><br><span class="line">earning <span class="keyword">string</span></span><br><span class="line">)</span><br><span class="line">row <span class="built_in">format</span> delimited fields terminated <span class="keyword">by</span> <span class="string">&#x27;,&#x27;</span></span><br><span class="line">stored <span class="keyword">as</span> orc;<span class="comment"> // 这个就是存储形式</span></span><br></pre></td></tr></table></figure>

<h2 id="hive-中文件存储格式-vs-压缩"><a href="#hive-中文件存储格式-vs-压缩" class="headerlink" title="hive 中文件存储格式 vs 压缩"></a>hive 中文件存储格式 vs 压缩</h2><p>压缩格式 ：</p>
<p>Hive支持的压缩格式有bzip2、gzip、deflate、snappy、lzo等。Hive依赖Hadoop的压缩方法，所以Hadoop版本越高支持的压缩方法越多，可以在$HADOOP_HOME&#x2F;conf&#x2F;core-site.xml中进行配置：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;property&gt;  </span><br><span class="line">        &lt;name&gt;io<span class="selector-class">.compression</span>.codecs&lt;/name&gt;  </span><br><span class="line">        &lt;value&gt;org<span class="selector-class">.apache</span><span class="selector-class">.hadoop</span><span class="selector-class">.io</span><span class="selector-class">.compress</span><span class="selector-class">.GzipCodec</span>,org<span class="selector-class">.apache</span><span class="selector-class">.hadoop</span><span class="selector-class">.io</span><span class="selector-class">.compress</span><span class="selector-class">.DefaultCodec</span>,com<span class="selector-class">.hadoop</span><span class="selector-class">.compression</span><span class="selector-class">.lzo</span><span class="selector-class">.LzoCodec</span>,com<span class="selector-class">.hadoop</span><span class="selector-class">.compression</span><span class="selector-class">.lzo</span><span class="selector-class">.LzopCodec</span>,org<span class="selector-class">.apache</span><span class="selector-class">.hadoop</span><span class="selector-class">.io</span><span class="selector-class">.compress</span><span class="selector-class">.BZip2Codec</span></span><br><span class="line">        &lt;/value&gt;  </span><br><span class="line">&lt;/property&gt;  </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>常见的压缩格式 ：</p>
<table>
<thead>
<tr>
<th>压缩格式</th>
<th>算法实现</th>
<th>压缩比</th>
<th>效率</th>
<th>可切分</th>
<th>内置</th>
<th>扩展名</th>
<th>Native</th>
<th>Java</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>bzip2</td>
<td>bzip2</td>
<td>最高</td>
<td>慢</td>
<td>yes</td>
<td>Y</td>
<td>.bz2</td>
<td>yes</td>
<td>yes</td>
<td>压缩率最高，一般是源文件的30%左右 ：<br />压缩或者解压效率最慢</td>
</tr>
<tr>
<td>deflate</td>
<td>DEFLATE</td>
<td>高</td>
<td>慢</td>
<td>no</td>
<td>Y</td>
<td>.deflate</td>
<td>no</td>
<td>yes</td>
<td>标准的压缩格式</td>
</tr>
<tr>
<td>gzip</td>
<td>DEFLATE</td>
<td>高</td>
<td>慢</td>
<td>no</td>
<td>Y</td>
<td>.gz</td>
<td>no</td>
<td>yes</td>
<td>相比deflate增加文件头，尾，<br />压缩率比较高，压缩或者解压的效率比较慢</td>
</tr>
<tr>
<td>zlib</td>
<td>DEFLATE</td>
<td>高</td>
<td>慢</td>
<td>no</td>
<td>Y</td>
<td>.zl</td>
<td>yes</td>
<td>no</td>
<td>相比deflate增加文件头，尾</td>
</tr>
<tr>
<td>lz4</td>
<td>lz4</td>
<td>最低</td>
<td>最快</td>
<td>no</td>
<td>Y</td>
<td>.zl4</td>
<td>yes</td>
<td>no</td>
<td>压缩率比较低，不过压缩和解压效率最快</td>
</tr>
<tr>
<td>lzo</td>
<td>lzo</td>
<td>较低</td>
<td>快</td>
<td>yes</td>
<td>N</td>
<td>.lzo_deflate</td>
<td>yes</td>
<td>no</td>
<td>压缩率比较低，不过压缩和解压效率最快</td>
</tr>
<tr>
<td>lzop</td>
<td>snappy</td>
<td>较低</td>
<td>快</td>
<td>yes</td>
<td>N</td>
<td>.lzo</td>
<td>yes</td>
<td>no</td>
<td>压缩率比较低，不过压缩和解压效率最</td>
</tr>
<tr>
<td>snappy</td>
<td>snappy</td>
<td>较低</td>
<td>快</td>
<td>yes</td>
<td>N</td>
<td>.snappy</td>
<td>yes</td>
<td>no</td>
<td>压缩率比较低，不过压缩和解压效率最</td>
</tr>
</tbody></table>
<p>其中压缩比bzip2 &gt; zlib &gt; gzip &gt; deflate &gt; snappy &gt; lzo &gt; lz4，在不同的测试场景中，会有差异，这仅仅是一个大概的排名情况。bzip2、zlib、gzip、deflate可以保证最小的压缩，但在运算中过于消耗时间。</p>
<p>从压缩性能上来看：lz4 &gt; lzo &gt; snappy &gt; deflate &gt; gzip &gt; bzip2，其中lz4、lzo、snappy压缩和解压缩速度快，压缩比低。</p>
<p>所以一般在生产环境中，经常会采用lz4、lzo、snappy压缩，以保证运算效率。</p>
<h2 id="Native-Libraries"><a href="#Native-Libraries" class="headerlink" title="Native Libraries"></a>Native Libraries</h2><p>Hadoop由Java语言开发，所以压缩算法大多由Java实现；但有些压缩算法并不适合Java进行实现，会提供本地库Native Libraries补充支持。Native Libraries除了自带bzip2, lz4, snappy, zlib压缩方法外，还可以自定义安装需要的功能库（snappy、lzo等）进行扩展。</p>
<p>而且使用本地库Native Libraries提供的压缩方式，性能上会有50%左右的提升。</p>
<p>使用命令可以查看native libraries的加载情况：<br><code>hadoop checknative -a</code></p>
<p>完成对Hive表的压缩，有两种方式：配置MapReduce压缩、开启Hive表压缩功能。因为Hive会将SQL作业转换为MapReduce任务，所以直接对MapReduce进行压缩配置，可以达到压缩目的；当然为了方便起见，Hive中的特定表支持压缩属性，自动完成压缩的功能。</p>

      
    </div>

    
    
    

      
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://zihang.fun/2022/12/01/12-01/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="liu zihang">
      <meta itemprop="description" content="只有努力不会辜负你">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="枫叶冢">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/12/01/12-01/" class="post-title-link" itemprop="url">hive-3</a>
        </h2>

        <div class="post-meta">
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-12-01 09:47:23" itemprop="dateCreated datePublished" datetime="2022-12-01T09:47:23+08:00">2022-12-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-01-11 09:11:16" itemprop="dateModified" datetime="2023-01-11T09:11:16+08:00">2023-01-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%97%A5%E5%BF%97/" itemprop="url" rel="index"><span itemprop="name">日志</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>3.5k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>3 分钟</span>
            </span>

        </div>
      </header>

    
    
    

   

    <div class="post-body" itemprop="articleBody">

      
          <h1 id="内部和外部表和普通表和分区表"><a href="#内部和外部表和普通表和分区表" class="headerlink" title="内部和外部表和普通表和分区表"></a>内部和外部表和普通表和分区表</h1><p>分区表 ： 提升查询效率的表</p>
<p>关于hive的查询 ： 对于普通表 则是要先读取所有的数据然后进行筛选的 ， 但是对于分区表，则是把数据进行分区，如果要查询的话，则是针对符合的数据进行查询</p>
<p>往往用分区表进行查询，普通表数据量较少的时候可以用</p>
<p>创建分区表 ：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">order</span>(</span><br><span class="line"></span><br><span class="line">orderid <span class="type">int</span>,</span><br><span class="line"></span><br><span class="line">oredergg String</span><br><span class="line"></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">PARTITIONED <span class="keyword">BY</span> (dt String)</span><br><span class="line"></span><br><span class="line"><span class="keyword">row</span> <span class="keyword">format</span> delimited fields terminated <span class="keyword">by</span> <span class="string">&#x27;\t&#x27;</span></span><br></pre></td></tr></table></figure>

<p>show partitions 表名 &#x2F;&#x2F;查看现在这个表的分区</p>
<p>修改分区  ：</p>
<p>删除分区  ：<code>alter table 表名 drop partition(分区列 = &#39;分区名&#39;)</code></p>
<p>创建分区 ： 在建表的时候创建</p>
<p>导入数据 ： load&#x2F;insert</p>
<ul>
<li>load : load data (local) inpath ‘’ (overwrite) into table 表名 partition (分区名称) ：数据列数如果对不上就会出现问题 : 加上overwrite则是把一个分区的数据给覆盖掉</li>
<li>insert : insert into table partition(分区) …</li>
<li>insert into 是追加的</li>
<li>如果不要追加则要进行覆盖 insert 后面的 into 变成 overwrite</li>
</ul>
<h2 id="使用一个sql让所有数据落到对应的分区里"><a href="#使用一个sql让所有数据落到对应的分区里" class="headerlink" title="使用一个sql让所有数据落到对应的分区里"></a>使用一个sql让所有数据落到对应的分区里</h2><p>动态分区：相当于我们要进行分区的字段是我们的数据的字段，就可以直接用那个字段当我们的分区但是要打开一个开关</p>
<p><code>set hive.exec.dynamic.partition.mode=nonstrict;</code></p>
<p>静态分区：就是自己制定好分区的标题的</p>
<p>离线任务 ： 业务周期性 T+1</p>
<p>就是延迟一天处理</p>
<p>默认底层创建的是内部表</p>
<p>内部表 ： 受hive管控的 ： 如果有删表的操作，那么会清理干净，所有数据都会被删除</p>
<p>外部表 ： 如果被删除的情况下，只是hdfs上指向metastore的索引被删除了，源数据不会被删除 ，而且我们还可通过建表的方式让他们的索引再次关联上</p>
<p>创建外部表 ：</p>
<p>相互转换 ：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">外部转内部</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 外部表名字 <span class="keyword">SET</span> TBLPROPERTIES (&quot;EXTERNAL&quot; <span class="operator">=</span> &quot;true&quot;);</span><br><span class="line"></span><br><span class="line">内部转外部</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 外部表名字 <span class="keyword">SET</span> TBLPROPERTIES (&quot;EXTERNAL&quot; <span class="operator">=</span> &quot;false&quot;);</span><br><span class="line">但是这上述的<span class="keyword">EXTERNAL</span> 是不能小写的会造成失效的问题</span><br></pre></td></tr></table></figure>

<h1 id="复杂的数据类型"><a href="#复杂的数据类型" class="headerlink" title="复杂的数据类型"></a>复杂的数据类型</h1><p>中小企业用的不多，，大企业用的多</p>
<p>会建表 ，会查询</p>
<p>maps: <code>MAP&lt;primitive_type, data_type&gt; </code></p>
<p>数据如下 ：</p>
<figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>,zhangsan,father:xiaoming#mother:xiaohuang#brother:xiaoxu,<span class="number">28</span></span><br><span class="line"><span class="number">2</span>,lisi,father:mayun#mother:huangyi#brother:guanyu,<span class="number">22</span></span><br><span class="line"><span class="number">3</span>,wangwu,father:wangjianlin#mother:ruhua#sister:jingtian,<span class="number">29</span></span><br><span class="line"><span class="number">4</span>,mayun,father:mayongzhen#mother:angelababy,<span class="number">26</span></span><br></pre></td></tr></table></figure>

<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> hive_map(</span><br><span class="line">id <span class="type">int</span>  <span class="keyword">comment</span> <span class="string">&#x27;用户id&#x27;</span>,</span><br><span class="line"><span class="type">name</span> string <span class="keyword">comment</span> <span class="string">&#x27;用户名字&#x27;</span>,</span><br><span class="line">relation map&lt;string,string&gt; <span class="keyword">comment</span> <span class="string">&#x27;家庭成员&#x27;</span>,</span><br><span class="line">age <span class="type">int</span> <span class="keyword">comment</span> <span class="string">&#x27;年龄&#x27;</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">row</span> <span class="keyword">format</span>  delimited fields terminated <span class="keyword">by</span> <span class="string">&#x27;,&#x27;</span></span><br><span class="line">collection items terminated <span class="keyword">by</span> <span class="string">&#x27;#&#x27;</span></span><br><span class="line">map keys terminated <span class="keyword">by</span> <span class="string">&#x27;:&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>arrays:  <code>ARRAY&lt;data_type&gt;</code></p>
<p>数据</p>
<p><code>zihan   beijing,shanghai,chengdu,dalian</code></p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> hive_array(</span><br><span class="line"><span class="type">name</span> String,</span><br><span class="line">locations <span class="keyword">array</span>&lt;String&gt;</span><br><span class="line">)</span><br><span class="line"><span class="keyword">row</span> <span class="keyword">format</span> delimited fields terminated <span class="keyword">by</span> <span class="string">&#x27;\t&#x27;</span></span><br><span class="line">collection items terminated <span class="keyword">by</span> <span class="string">&#x27;,&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>structs:<code>STRUCT&lt;col_name : data_type [COMMENT col_comment], ...&gt;</code></p>
<p>数据</p>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">192.168.1.1</span>#zhangsan:<span class="number">40</span></span><br><span class="line"><span class="number">192.168.1.2</span>#lisi:<span class="number">50</span></span><br><span class="line"><span class="number">192.168.1.3</span>#wangwu:<span class="number">60</span></span><br><span class="line"><span class="number">192.168.1.4</span>#zhaoliu:<span class="number">70</span></span><br></pre></td></tr></table></figure>

<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> hive_struct(</span><br><span class="line">ip string,</span><br><span class="line">userinfo STRUCT&lt;<span class="type">name</span>:string,age:<span class="type">int</span>&gt;</span><br><span class="line">)</span><br><span class="line"><span class="keyword">row</span> <span class="keyword">format</span>  delimited fields terminated <span class="keyword">by</span> <span class="string">&#x27;#&#x27;</span></span><br><span class="line">collection items terminated <span class="keyword">by</span> <span class="string">&#x27;:&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h1 id="数据形式的不同使用方法"><a href="#数据形式的不同使用方法" class="headerlink" title="数据形式的不同使用方法"></a>数据形式的不同使用方法</h1><h2 id="array"><a href="#array" class="headerlink" title="array"></a>array</h2><p>案例分析：</p>
<p>1.查询每个用户第一个工作地点？</p>
<p>select  name ,locations[0] as first_loc_work from  hive_array;</p>
<p>2.查询每个人 工作地点的数量</p>
<p>select  name , size(locations) from  hive_array ;</p>
<p>3.查询在shanghai 工作的有哪些人</p>
<p>select  * from hive_array  where array_contains(locations,’shanghai’);</p>
<h3 id="行转列"><a href="#行转列" class="headerlink" title="行转列"></a>行转列</h3><p>思路是先把一个array的元素炸开，然后通过显示出来</p>
<p>显示手段 ： LATERAL VIEW（侧写视图）</p>
<ul>
<li><p>LATERAL VIEW udtf(expression) tableAlias AS columnAlias</p>
</li>
<li><p>udtf : 一进多出</p>
</li>
<li><p>FROM baseTable (lateralView)*</p>
</li>
<li><p>最终代码 ：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> name,location</span><br><span class="line"><span class="keyword">from</span> hive_array <span class="keyword">lateral</span> <span class="keyword">view</span> explode(locations) loc_table <span class="keyword">as</span> location;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="map"><a href="#map" class="headerlink" title="map"></a>map</h2><p>需求： 1.查询表中每个人的father的名字</p>
<p><code>select id,name,age,relation[&#39;father&#39;] as father from hive_map;</code></p>
<p>2.查询表中 每个人的家庭成员   keys</p>
<p><code>select id,name,age,map_keys(relation) as members from hive_map;</code></p>
<p>3.查询表中 每个人的家庭成员的名字 values</p>
<p><code>select id,name,age,map_values(relation) as members from hive_map;</code></p>
<p>4.查询表中 有brother的人以及brother的名字</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line"> id,<span class="type">name</span>,age,relation[<span class="string">&#x27;brother&#x27;</span>] <span class="keyword">as</span> brother</span><br><span class="line"><span class="keyword">from</span> hive_map</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">relation[<span class="string">&#x27;brother&#x27;</span>] <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">null</span>;或者可以<span class="keyword">select</span></span><br><span class="line"> id,<span class="type">name</span>,age,relation[<span class="string">&#x27;brother&#x27;</span>] <span class="keyword">as</span> brother</span><br><span class="line"><span class="keyword">from</span> hive_map</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">array_contains(map_keys(relation), <span class="string">&#x27;brother&#x27;</span>);// map_key()函数的意思是可以把这个列的map的key当作<span class="keyword">array</span>取出来</span><br></pre></td></tr></table></figure>

<h2 id="structs"><a href="#structs" class="headerlink" title="structs"></a>structs</h2><p>select ip,userinfo.name as name ,userinfo.age as age from hive_struct;</p>
<h2 id="开窗函数-："><a href="#开窗函数-：" class="headerlink" title="开窗函数 ："></a>开窗函数 ：</h2><ul>
<li>分析函数：对开窗函数的分析的函数<ul>
<li>rank : 使用方法 rank()over(partition by xx order by yy) as rk  : 如果有重复的数据，会丢失排名</li>
<li>dense_rank :使用方法同上 ： 如果有重复数据 ，则不会丢失排名 ：</li>
<li>row_number:同上 ： 排名相同且不会重复 ， 就是会顺序往下 ：</li>
</ul>
</li>
</ul>
<p>上述的常用手段 ： 求topn的排名</p>
<p>比如要求top3 的</p>
<p>作业 ：</p>
<p>统计每个店铺的uv</p>
<p>统计top3的用户记录</p>
<p>pv ： 页面的浏览量</p>
<p>uv ： 访客的次数</p>

      
    </div>

    
    
    

      
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://zihang.fun/2022/11/30/11-30/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="liu zihang">
      <meta itemprop="description" content="只有努力不会辜负你">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="枫叶冢">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/11/30/11-30/" class="post-title-link" itemprop="url">hive-2</a>
        </h2>

        <div class="post-meta">
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-11-30 09:57:50" itemprop="dateCreated datePublished" datetime="2022-11-30T09:57:50+08:00">2022-11-30</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-01-11 09:10:43" itemprop="dateModified" datetime="2023-01-11T09:10:43+08:00">2023-01-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%97%A5%E5%BF%97/" itemprop="url" rel="index"><span itemprop="name">日志</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>4.4k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>4 分钟</span>
            </span>

        </div>
      </header>

    
    
    

   

    <div class="post-body" itemprop="articleBody">

      
          <h1 id="关于hive里的数据类型"><a href="#关于hive里的数据类型" class="headerlink" title="关于hive里的数据类型"></a>关于hive里的数据类型</h1><ul>
<li>整数<ul>
<li>int</li>
<li>bigint &#x3D;&#x3D;long</li>
</ul>
</li>
<li>小数 ：<ul>
<li>float</li>
<li>double</li>
<li>Decimal</li>
</ul>
</li>
<li>字符串：<ul>
<li>String (建议统一用String)</li>
<li>varchar</li>
<li>char</li>
</ul>
</li>
<li>时间：<ul>
<li>时间日期 DATE 格式：YYYY-MM-DD</li>
<li>时间戳：TIMESTAMP YYYY-MM-DD HH:MM:SS</li>
</ul>
</li>
</ul>
<h1 id="建表"><a href="#建表" class="headerlink" title="建表"></a>建表</h1><p>CREATE [TEMPORARY] [EXTERNAL] TABLE [IF NOT EXISTS] [db_name.]table_name<br>  [(col_name data_type [column_constraint_specification] [COMMENT col_comment], … [constraint_specification])]<br>  [COMMENT table_comment]<br>  [PARTITIONED BY (col_name data_type [COMMENT col_comment], …)]<br>  [CLUSTERED BY (col_name, col_name, …) [SORTED BY (col_name [ASC|DESC], …)] INTO num_buckets BUCKETS]<br>  [<br>   [ROW FORMAT row_format]<br>   [STORED AS file_format]<br>     | STORED BY ‘storage.handler.class.name’ [WITH SERDEPROPERTIES (…)]  – (Note: Available in Hive 0.6.0 and later)<br>  ]</p>
<p>数据字段名字 字段类型</p>
<p>例如</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> mytest(</span><br><span class="line">	id String <span class="keyword">comment</span> <span class="string">&#x27;用户id&#x27;</span>,</span><br><span class="line">	<span class="type">name</span> string,</span><br><span class="line">	age <span class="type">bigint</span></span><br><span class="line">) <span class="keyword">comment</span> <span class="string">&#x27;第一个表&#x27;</span></span><br><span class="line"><span class="keyword">ROW</span> <span class="keyword">FORMAT</span> delimited fields terminated <span class="keyword">by</span> <span class="string">&#x27;,&#x27;</span> //指定分隔符</span><br><span class="line">STORED <span class="keyword">as</span> TEXTFILE; // 存储形式</span><br><span class="line"></span><br><span class="line">或者</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> emp2 <span class="keyword">like</span> emp;</span><br><span class="line">复制表结构</span><br><span class="line"></span><br><span class="line">或者</span><br></pre></td></tr></table></figure>

<h2 id="为什么要分隔符"><a href="#为什么要分隔符" class="headerlink" title="为什么要分隔符"></a>为什么要分隔符</h2><p>因为我们的元数据都在hdfs上，对于hdfs上的数据可以通过分隔符进行自动导入到hive里，比如上述是，分割的，然后我hdfs上有如下数据</p>
<p>1，zihan,11</p>
<p>2,zhangsan,23</p>
<p>3,liu,33</p>
<p>就会自动按照每一行进行insert</p>
<p>导入数据 ： load data local inpath ‘本地的绝对路径’ into table 表名</p>
<p>清空表的操作 ： truncate table 表名</p>
<h1 id="删除库"><a href="#删除库" class="headerlink" title="删除库"></a>删除库</h1><p>DROP (DATABASE|SCHEMA) [IF EXISTS] database_name [RESTRICT|CASCADE];</p>
<p>DROP DATABASE bigdata_hive4;</p>
<p>DROP DATABASE bigdata_hive2 CASCADE; &#x3D;&gt;删库跑路的操作</p>
<p>CASCADE : 代表联合删除 ，一般删除的时候如果里面有表，会造成无法删除的问题，但是联合删除会直接删除掉</p>
<h1 id="DMl"><a href="#DMl" class="headerlink" title="DMl"></a>DMl</h1><h2 id="load-："><a href="#load-：" class="headerlink" title="load ："></a>load ：</h2><ul>
<li>加载本地数据</li>
<li>加载hdfs上的数据</li>
</ul>
<p>LOAD原本是追加，不是覆盖 ， 但是可以通过 加上 overwrite 关键字 进行 覆盖操作</p>
<h2 id="覆盖例子"><a href="#覆盖例子" class="headerlink" title="覆盖例子"></a>覆盖例子</h2><p>load data local inpath ‘&#x2F;home&#x2F;hadoop&#x2F;tmp&#x2F;emp.txt’ OVERWRITE INTO TABLE emp;</p>
<h2 id="上传"><a href="#上传" class="headerlink" title="上传"></a>上传</h2><p>本地：load data inpath ‘本地路径’ into table 表名</p>
<p>hdfs ： load data inpath ‘hdfs上的路径’ into table 表名</p>
<p>上述的hdfs上的相当于把其路径里的文件移动到table 表名的下面 并且改名，且关联到metastore</p>
<p>但是我们的hdfs mv 是不会关联到metastore的</p>
<p>在hive 里 update 和 delete 不要做 &#x3D;》 因为效率低下</p>
<p>把所有的update和delete都转化成insert和overwrite</p>
<h2 id="插入语句-："><a href="#插入语句-：" class="headerlink" title="插入语句 ："></a>插入语句 ：</h2><p>Inserting data into Hive Tables from queries</p>
<p>insert into|OVERWRITE table tablename selectQury</p>
<p>2.Inserting values into tables from SQL 【不推荐使用】<br>INSERT INTO TABLE tablename<br>VALUES values_row [, values_row …]<br>1.每导入一条数据 就会触发一次 mapreduce job  效率太低</p>
<p>emp2：<br>    insert into table emp2<br>    select *  from emp;<br>insert overwrite table emp2<br>select *  from emp where deptno&#x3D;10;</p>
<h2 id="关于hive里的一些函数以及使用"><a href="#关于hive里的一些函数以及使用" class="headerlink" title="关于hive里的一些函数以及使用"></a>关于hive里的一些函数以及使用</h2><h3 id="1-where-过滤条件"><a href="#1-where-过滤条件" class="headerlink" title="1.where 过滤条件"></a>1.where 过滤条件</h3><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">where_condition</span><br><span class="line">	 &lt;</span><br><span class="line">	 &gt;</span><br><span class="line">	 =</span><br><span class="line">	 &lt;&gt;  !=</span><br><span class="line">	 <span class="keyword">and</span></span><br><span class="line"><span class="keyword"></span>	 <span class="keyword">or</span></span><br><span class="line"><span class="keyword"></span>	 in</span><br><span class="line">	 not in</span><br><span class="line">	 <span class="keyword">between </span> <span class="keyword">and</span></span><br><span class="line"><span class="keyword"></span>	 is</span><br><span class="line">	 is not</span><br></pre></td></tr></table></figure>

<h3 id="需求：查询表中-deptno-20-10"><a href="#需求：查询表中-deptno-20-10" class="headerlink" title="需求：查询表中 deptno 20 10"></a>需求：查询表中 deptno 20 10</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">*</span><br><span class="line"><span class="keyword">from</span> emp</span><br><span class="line"><span class="keyword">where</span> deptno=<span class="number">20</span> <span class="keyword">or</span> deptno =<span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span></span><br><span class="line">*</span><br><span class="line"><span class="function"><span class="keyword">from</span> emp</span></span><br><span class="line"><span class="function"><span class="keyword">where</span> deptno <span class="title">in</span> (<span class="params"><span class="number">10</span>,<span class="number">20</span></span>)</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span></span><br><span class="line">*</span><br><span class="line"><span class="keyword">from</span> emp</span><br><span class="line"><span class="keyword">where</span> deptno &lt;&gt; <span class="number">20</span>;</span><br><span class="line"><span class="keyword">select</span></span><br><span class="line">*</span><br><span class="line"><span class="keyword">from</span> emp</span><br><span class="line"><span class="keyword">where</span> deptno != <span class="number">20</span>;</span><br></pre></td></tr></table></figure>

<h3 id="2-order-by-排序语法"><a href="#2-order-by-排序语法" class="headerlink" title="2.order by  排序语法"></a>2.order by  排序语法</h3><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>默认<span class="keyword">asc</span> 升序</span><br><span class="line"><span class="number">2.</span>降序 <span class="keyword">desc</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span></span><br><span class="line">sal</span><br><span class="line"><span class="keyword">from</span> emp</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> sal <span class="keyword">desc</span>;</span><br></pre></td></tr></table></figure>

<h3 id="3-like-语法-模糊匹配"><a href="#3-like-语法-模糊匹配" class="headerlink" title="3.like 语法 模糊匹配"></a>3.like 语法 模糊匹配</h3><figure class="highlight erlang-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>._  占位符</span><br><span class="line"><span class="number">2</span>.<span class="comment">%  模糊</span></span><br><span class="line">rlike regexp</span><br></pre></td></tr></table></figure>

<h3 id="4-合并表"><a href="#4-合并表" class="headerlink" title="4.合并表"></a>4.合并表</h3><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">union</span>  去重</span><br><span class="line"></span><br><span class="line"><span class="built_in">union</span> <span class="built_in">all</span>  不去重</span><br></pre></td></tr></table></figure>

<h3 id="例子："><a href="#例子：" class="headerlink" title="例子："></a>例子：</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> a(id <span class="type">int</span> ,<span class="type">name</span> string) <span class="keyword">row</span> <span class="keyword">format</span>  delimited fields terminated <span class="keyword">by</span> <span class="string">&#x27;,&#x27;</span> ;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> b(id <span class="type">int</span> ,<span class="type">name</span> string) <span class="keyword">row</span> <span class="keyword">format</span>  delimited fields terminated <span class="keyword">by</span> <span class="string">&#x27;,&#x27;</span> ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">load</span> data <span class="keyword">local</span> inpath &quot;/home/hadoop/tmp/a.txt&quot; <span class="keyword">into</span> <span class="keyword">table</span> a;</span><br><span class="line"><span class="keyword">load</span> data <span class="keyword">local</span> inpath &quot;/home/hadoop/tmp/b.txt&quot; <span class="keyword">into</span> <span class="keyword">table</span> b;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="type">name</span> <span class="keyword">from</span> a</span><br><span class="line"><span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line"><span class="keyword">select</span> <span class="type">name</span> <span class="keyword">from</span> b;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="type">name</span> <span class="keyword">from</span> a</span><br><span class="line"><span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line"><span class="keyword">select</span> <span class="type">name</span> <span class="keyword">from</span> b</span><br><span class="line"><span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line"><span class="keyword">select</span> &quot;lisi&quot; <span class="keyword">as</span> <span class="type">name</span> ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="type">name</span>,&quot;1&quot; <span class="keyword">as</span> pk <span class="keyword">from</span> a</span><br><span class="line"><span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line"><span class="keyword">select</span> <span class="type">name</span>,&quot;2&quot; <span class="keyword">as</span> pk <span class="keyword">from</span> b</span><br><span class="line"><span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line"><span class="keyword">select</span> &quot;lisi&quot; <span class="keyword">as</span> <span class="type">name</span>,&quot;3&quot; <span class="keyword">as</span> id ;</span><br></pre></td></tr></table></figure>

<p>思考： hive建表 默认column 分割符是什么？</p>
<h3 id="5-null-处理"><a href="#5-null-处理" class="headerlink" title="5.null 处理"></a>5.null 处理</h3><pre><code>1. 过滤
    where xxx is not null
is null 作用一样 &lt;=&gt;
2. etl 转换
    ifnull  =&gt; hive里没有
    coalesce =》
    nvl  =》
</code></pre>
<h3 id="补充："><a href="#补充：" class="headerlink" title="补充："></a>补充：</h3><pre><code>查看hive支持的function ：
            y=f(x)
    SHOW FUNCTIONS [LIKE &quot;`&lt;pattern&gt;`&quot;];
    show functions like nvl;  =&gt; 判断 function hive 是否存在
    desc function nvl; =》  查看某个函数具体使用
</code></pre>
<figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">select</span><br><span class="line"><span class="built_in">empno,</span></span><br><span class="line"><span class="built_in">ename,</span></span><br><span class="line"><span class="built_in">job,</span></span><br><span class="line"><span class="built_in">mgr,</span></span><br><span class="line"><span class="built_in">hiredate,</span></span><br><span class="line"><span class="built_in">sal,</span></span><br><span class="line">nvl(comm,<span class="number">0</span>) as comm_alias,</span><br><span class="line">deptno</span><br><span class="line">from emp <span class="comment">;</span></span><br></pre></td></tr></table></figure>

<h2 id="分组-聚合函数-join"><a href="#分组-聚合函数-join" class="headerlink" title="分组 聚合函数 join"></a>分组 聚合函数 join</h2><p>聚合函数 ：</p>
<ul>
<li>sum</li>
<li>max</li>
<li>min</li>
<li>avg</li>
<li>count</li>
</ul>
<h3 id="group-by"><a href="#group-by" class="headerlink" title="group by"></a>group by</h3><ul>
<li>和聚合函数一起使用</li>
<li>一个或者多个colum进行分组</li>
<li>字段必须select出现 和 group by 出现要一致</li>
</ul>
<h3 id="having-："><a href="#having-：" class="headerlink" title="having ："></a>having ：</h3><ul>
<li>在group by 后面使用</li>
</ul>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">select job,</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">sum</span><span class="params">(sal)</span></span> as sal_num,</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">max</span><span class="params">(sal)</span></span>,</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">min</span><span class="params">(sal)</span></span>,</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">avg</span><span class="params">(sal)</span></span>,</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">count</span><span class="params">(<span class="number">1</span>)</span></span> as cnt</span><br><span class="line"></span><br><span class="line">from emp</span><br><span class="line"></span><br><span class="line">group by job</span><br><span class="line"></span><br><span class="line">having sal_num &gt; <span class="number">6000</span></span><br></pre></td></tr></table></figure>

<h3 id="join"><a href="#join" class="headerlink" title="join"></a>join</h3><p>找准关联字段</p>
<ul>
<li>inner join [join]</li>
<li>left join</li>
<li>right join</li>
<li>full join</li>
</ul>
<h3 id="需求：既要显示聚合前的数据，又要显示聚合后的数据？"><a href="#需求：既要显示聚合前的数据，又要显示聚合后的数据？" class="headerlink" title="需求：既要显示聚合前的数据，又要显示聚合后的数据？"></a>需求：既要显示聚合前的数据，又要显示聚合后的数据？</h3><p>函数  over([partition by xxx,…] [order by xxx,….])</p>
<p>over: 以谁进行开窗 table、<br>parition by : 以谁进行分组   table columns<br>order by : 以谁进行排序  table columns</p>
<figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">数据： </span><br><span class="line">haige,2022<span class="string">-11</span><span class="string">-10</span>,1</span><br><span class="line">haige,2022<span class="string">-11</span><span class="string">-11</span>,5</span><br><span class="line">haige,2022<span class="string">-11</span><span class="string">-12</span>,7</span><br><span class="line">haige,2022<span class="string">-11</span><span class="string">-13</span>,3</span><br><span class="line">haige,2022<span class="string">-11</span><span class="string">-14</span>,2</span><br><span class="line">haige,2022<span class="string">-11</span><span class="string">-15</span>,4</span><br><span class="line">haige,2022<span class="string">-11</span><span class="string">-16</span>,4</span><br></pre></td></tr></table></figure>

<p>需求：<br>    统计累计问题 ，每个用户每天累计点外卖次数</p>
<p>[partition by xxx,…] [order by xxx,….]</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line"><span class="type">name</span> ,</span><br><span class="line">dt ,</span><br><span class="line">cnt ,</span><br><span class="line">sum(cnt) <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> <span class="type">name</span>  <span class="keyword">order</span> <span class="keyword">by</span> dt ) <span class="keyword">as</span> sum_cnt</span><br><span class="line"><span class="keyword">from</span> user_mt;</span><br></pre></td></tr></table></figure>

<h3 id="命令行更改"><a href="#命令行更改" class="headerlink" title="命令行更改"></a>命令行更改</h3><p>command line<br>    1.hive shell<br>    2.jdbc &#x3D;&gt; hiveServer2</p>
<pre><code>hive clinet:
    1. hive shell
    2. beeline shell jdbc   开启 hiveServer2 服务 thift
</code></pre>
<p>在beeline中 <code>!connect jdbc:hive2://localhost:10000 hadoop</code></p>
<p>补充：<br>beeline &#x3D;&gt; 连接 hive  &#x3D;》 hdfs<br>对hdfs 做一个设置 代理设置：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">core-site.xml:</span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">name</span>&gt;</span>hadoop.proxyuser.hadoop.hosts<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">value</span>&gt;</span>*<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">name</span>&gt;</span>hadoop.proxyuser.hadoop.groups<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">value</span>&gt;</span>*<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

      
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://zihang.fun/2022/11/29/11-29/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="liu zihang">
      <meta itemprop="description" content="只有努力不会辜负你">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="枫叶冢">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/11/29/11-29/" class="post-title-link" itemprop="url">hive</a>
        </h2>

        <div class="post-meta">
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-11-29 08:36:32" itemprop="dateCreated datePublished" datetime="2022-11-29T08:36:32+08:00">2022-11-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-01-11 09:10:14" itemprop="dateModified" datetime="2023-01-11T09:10:14+08:00">2023-01-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%97%A5%E5%BF%97/" itemprop="url" rel="index"><span itemprop="name">日志</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>5.2k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>5 分钟</span>
            </span>

        </div>
      </header>

    
    
    

   

    <div class="post-body" itemprop="articleBody">

      
          <h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>简单来说就是用sql处理hadoop的数据的</p>
<p>除了hive之外 ： sparksql ，presto ， impala</p>
<h2 id="要求掌握"><a href="#要求掌握" class="headerlink" title="要求掌握"></a>要求掌握</h2><p>sql</p>
<p>udf</p>
<h2 id="hadoop包含"><a href="#hadoop包含" class="headerlink" title="hadoop包含"></a>hadoop包含</h2><p>hdfs ：命令行</p>
<p>mapreduce ：目前工作中几乎不用，但是关于核心类和思想要掌握</p>
<p>yarn：提交作业 xxx （mr&#x2F;spark&#x2F;flink）on yarn ： 必须会</p>
<p>mapreduce的弊端 ：</p>
<ul>
<li>开发大量代码</li>
<li>编程基础不错</li>
<li>部署麻烦</li>
<li>修改code蛮麻烦</li>
<li>对于DBA和RDBMS的小伙伴是不友好的</li>
</ul>
<p>大数据处理来说最终落地最好是sql</p>
<p>大数据开发角度 ：</p>
<ul>
<li>基础平台开发<ul>
<li>涉及很多框架底层的面很广</li>
</ul>
</li>
<li>应用层面开发<ul>
<li>基于基础平台开发 ，写sql</li>
</ul>
</li>
</ul>
<p>根据你的兴趣点 + 公司的定位</p>
<p>必然有新的东西诞生去解决一个场景的问题</p>
<p>mr主要适用于我们的p计算（离线计算）：不要求时效性 ，但是mr开发太麻烦，就诞生了hive</p>
<p>hive 介绍 ：</p>
<p>hive.apache.org</p>
<p>是由什么人提供出来的？</p>
<p>facebook 开源 去解决结构化的数据统计问题</p>
<p>是什么？</p>
<p>构建在hadoop之上的数据仓库</p>
<p>hdfs：hive 的数据是在hdfs之上的</p>
<p>yarn：可以跑在yarn之上</p>
<p>mmapreduce ： 可以用mr形式去运行</p>
<p>如何使用：</p>
<p>定义了一中类sql的语言，类似sql但是又有不同</p>
<p>适用于离线&#x2F;p处理的</p>
<p>开发就是写sql &#x3D;》 mr  &#x3D;》 运行在yarn上</p>
<p>hive的底层引擎是：</p>
<ul>
<li>mr （默认）：sql&#x3D;》mr</li>
<li>Tez：sql&#x3D;》Tez</li>
<li>Spark：sql&#x3D;》Spark</li>
</ul>
<p>hive on spark &#x3D;》生厂上用的用的不多</p>
<p>spark on hive &#x3D;》 用sparksql查看hive的数据</p>
<p>hive的存储格式，压缩格式等</p>
<p>官网：</p>
<ul>
<li>in distributed storage （分布式存储）：hdfs , cos,oss,aws</li>
<li>A command line tool and JDBC driver are provided to connect users to Hive.</li>
</ul>
<p>版本介绍 ：</p>
<p>x.y.z：x是大版本，y是小版本，z是小版本的修复版本</p>
<p>为什么要学习hive</p>
<ul>
<li>简单易用 ： 可以用sql开发</li>
<li>扩展性好：<ul>
<li>用自定义函数udf</li>
<li>数据存储 和 计算角度 ： 如果表中数据存不下，可以加几个节点就好了<ul>
<li>注意hive不是分布式的，它仅仅是个客户端</li>
</ul>
</li>
<li>Metastore ：hive的元数据管理<ul>
<li>sparksql ,presto ,impala 只要可以访问hive的元数据就可以访问里面表的数据</li>
<li>可以分享元数据</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>hive的架构 ：</p>
<ul>
<li>元数据 ： 描述数据的数据<ul>
<li>表的名字，字段的名字，字段的类型，什么人创建的，数据存储在哪里等</li>
<li>元数据的内部内置了一个Derby但是有弊端</li>
<li>元数据都是用mysql进行存储的</li>
<li>测试的时候一个mysql就可以了</li>
<li>但是生产上则一个不够</li>
<li>生产上要遵循 HA ：高可用</li>
<li>就是要一台做备份</li>
<li>两个mysql是主从架构</li>
</ul>
</li>
</ul>
<p>hive和RDBMS的区别</p>
<ul>
<li>共同点 sql</li>
<li>延时性 ： hive 适用于离线计算 慢，千万不要拿hive和mysql的性能做对比，无可比性，mysql要必hive高（数据量小）数据量大的时候就反过来了</li>
<li>事务 ： 都支持</li>
<li>update ，delete<ul>
<li>上面两个语句在hive里基本不用，因为性能太差了</li>
</ul>
</li>
<li>都支持分布式</li>
<li>部署成本 ：<ul>
<li>hive ：廉价</li>
<li>mysql ：成本很高</li>
</ul>
</li>
<li>数据体量<ul>
<li>hive ：Tb</li>
<li>mysql：处理Pb都比较费劲</li>
</ul>
</li>
</ul>
<p>对hive进行部署</p>
<p>分布式部署 ： cwiki.apache.org(官网)</p>
<p>首先把用压缩包上传到linux机器上</p>
<p>然后对linux进行解压</p>
<p>解压完成之后，我们要对他的的配置进行修改在解压之后的</p>
<p><code>vim hive-site.xml</code></p>
<p>编辑完成之后我们把以下内容放进去</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;?xml-stylesheet type=&quot;text/xsl&quot; href=&quot;configuration.xsl&quot;?&gt;</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">&lt;property&gt;</span><br><span class="line">        &lt;name&gt;javax.jdo.option.ConnectionURL&lt;/name&gt;</span><br><span class="line">        &lt;value&gt;jdbc:mysql://bigdata2:3306/hive?createDatabaseIfNotExist=true&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line"></span><br><span class="line">&lt;property&gt;</span><br><span class="line">        &lt;name&gt;javax.jdo.option.ConnectionDriverName&lt;/name&gt;</span><br><span class="line">        &lt;value&gt;com.mysql.jdbc.Driver&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line">&lt;property&gt;</span><br><span class="line">        &lt;name&gt;javax.jdo.option.ConnectionUserName&lt;/name&gt;</span><br><span class="line">        &lt;value&gt;root&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line">&lt;property&gt;</span><br><span class="line">        &lt;name&gt;javax.jdo.option.ConnectionPassword&lt;/name&gt;</span><br><span class="line">        &lt;value&gt;liuzihan010616&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure>

<p>然后在环境变量中编辑我们的hive_home</p>
<p><code>vim ~/.bashrc </code></p>
<p>把下列加进去</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">HIVE_HOME</span></span><br><span class="line">export HIVE_HOME=/home/hadoop/app/hive</span><br><span class="line">export PATH=$&#123;PATH&#125;:$&#123;HIVE_HOME&#125;/bin</span><br></pre></td></tr></table></figure>

<p>然后我们要把我们的mysql链接包放在lib文件夹下</p>
<p>就是 <code>mysql-connector-java-5.1.28.jar</code></p>
<p>要放在hive的lib文件夹下</p>
<p>然后对我们的hive进行初始化</p>
<p><code>schematool -dbType mysql -initSchema</code></p>
<p>初始化成功之后，先启动hdfs ，然后命令行输入 hive 然后输入show databases;</p>
<p>成功就ok了</p>
<p>然后再mysql的数据库里会有hive这个数据库</p>
<p>mysql里\G是格式化的意思</p>
<h2 id="思考-：-表中的字段-存在哪里？"><a href="#思考-：-表中的字段-存在哪里？" class="headerlink" title="思考 ： 表中的字段 存在哪里？"></a>思考 ： 表中的字段 存在哪里？</h2><p>我们先进入hive ： <code>create table test(name String); </code></p>
<p>一个 hive 表 会被拆分成n个表存储再mysql里</p>
<p>比如　： TBl表存放的是我们的表名 <code>select * from tbls \G;</code></p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">**<span class="emphasis">* 1. row *</span>**</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span></span><br><span class="line"><span class="code">            TBL_ID: 1</span></span><br><span class="line"><span class="code">       CREATE_TIME: 1669707861</span></span><br><span class="line"><span class="code">             DB_ID: 1</span></span><br><span class="line"><span class="code">  LAST_ACCESS_TIME: 0</span></span><br><span class="line"><span class="code">             OWNER: hadoop</span></span><br><span class="line"><span class="code">        OWNER_TYPE: USER</span></span><br><span class="line"><span class="code">         RETENTION: 0</span></span><br><span class="line"><span class="code">             SD_ID: 1</span></span><br><span class="line"><span class="code">          TBL_NAME: test</span></span><br><span class="line"><span class="code">          TBL_TYPE: MANAGED_TABLE</span></span><br><span class="line"><span class="code">VIEW_EXPANDED_TEXT: NULL</span></span><br><span class="line"><span class="code">VIEW_ORIGINAL_TEXT: NULL</span></span><br><span class="line"><span class="code">IS_REWRITE_ENABLED:  </span></span><br><span class="line"><span class="code">1 row in set (0.00 sec)</span></span><br><span class="line"><span class="code"></span></span><br></pre></td></tr></table></figure>

<p>比如 ： columns_v2表存放的是我们的字段 <code>select * from columns_v2 \G;</code></p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">**<span class="emphasis">* 1. row *</span>**</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span></span><br><span class="line"><span class="code">      CD_ID: 1</span></span><br><span class="line"><span class="code">    COMMENT: NULL</span></span><br><span class="line"><span class="code">COLUMN_NAME: name</span></span><br><span class="line"><span class="code">  TYPE_NAME: string</span></span><br><span class="line"><span class="code">INTEGER_IDX: 0</span></span><br><span class="line"><span class="code">1 row in set (0.00 sec)</span></span><br><span class="line"><span class="code"></span></span><br></pre></td></tr></table></figure>

<p>比如 ： DBS是存放的我们的物理存储路径的 <code>select * from DBS \G;</code></p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">**<span class="emphasis">* 1. row *</span>**</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span></span><br><span class="line"><span class="code">          DB_ID: 1</span></span><br><span class="line"><span class="code">           DESC: Default Hive database</span></span><br><span class="line"><span class="code">DB_LOCATION_URI: hdfs://bigdata3:9000/user/hive/warehouse</span></span><br><span class="line"><span class="code">           NAME: default</span></span><br><span class="line"><span class="code">     OWNER_NAME: public</span></span><br><span class="line"><span class="code">     OWNER_TYPE: ROLE</span></span><br><span class="line"><span class="code">      CTLG_NAME: hive</span></span><br><span class="line"><span class="code">1 row in set (0.00 sec)</span></span><br></pre></td></tr></table></figure>

<h2 id="DDL"><a href="#DDL" class="headerlink" title="DDL"></a>DDL</h2><p>hive有个默认数据库 是default 路径 ：&#x2F;user&#x2F;hive&#x2F;warehouse</p>
<p>非默认数据库 ： &#x2F;user&#x2F;hive&#x2F;warehouse&#x2F;dbname.db</p>
<h3 id="创建数据库"><a href="#创建数据库" class="headerlink" title="创建数据库"></a>创建数据库</h3><p>CREATE [REMOTE] (DATABASE|SCHEMA) [IF NOT EXISTS] database_name<br>  [COMMENT database_comment]<br>  [LOCATION hdfs_path]<br>  [MANAGEDLOCATION hdfs_path]<br>  [WITH DBPROPERTIES (property_name&#x3D;property_value, …)];</p>
<p>[] 可有可无<br>(|) 选择其中一个即可</p>
<p>CREATE DATABASE 名称；</p>
<p>CREATE DATABASE 名称 LOCATION ‘创建的地方’；</p>
<p>例子 ：</p>
<p>create database if not exists bigdata_hive;<br>create database  bigdata_hive2  LOCATION ‘&#x2F;data&#x2F;bigdata_hive2’;<br>create database  bigdata_hive3 WITH DBPROPERTIES (‘creator’&#x3D;’doublehappy’, ‘create_dt’&#x3D;”2099-11-29”);<br>create database if not exists bigdata_hive4 COMMENT “这是一个数据库4”;</p>
<p>解决此处中文乱码的问题</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> hive.dbs MODIFY <span class="keyword">COLUMN</span> `<span class="keyword">DESC</span>` <span class="type">varchar</span>(<span class="number">4000</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NULL</span>;</span><br></pre></td></tr></table></figure>

<h3 id="显示数据库"><a href="#显示数据库" class="headerlink" title="显示数据库"></a>显示数据库</h3><p>show databases;<br>show databases like “bigdata_hive*”<br>desc database  bigdata_hive3;<br>desc database EXTENDED bigdata_hive3;</p>
<h2 id="思考-：-这个数据库在hdfs的哪一个地方"><a href="#思考-：-这个数据库在hdfs的哪一个地方" class="headerlink" title="思考 ： 这个数据库在hdfs的哪一个地方"></a>思考 ： 这个数据库在hdfs的哪一个地方</h2><p>可以通过查看DBS表</p>
<h1 id="hive-的注释-comment-中文乱码的解决方法"><a href="#hive-的注释-comment-中文乱码的解决方法" class="headerlink" title="hive 的注释(comment) 中文乱码的解决方法"></a>hive 的注释(comment) 中文乱码的解决方法</h1><p>（1）修改表字段注解和表注解</p>
<p>alter table COLUMNS_V2 modify column COMMENT varchar(256) character set utf8;<br>alter table TABLE_PARAMS modify column PARAM_VALUE varchar(4000) character set utf8;</p>
<p>（2）修改分区字段注解</p>
<p>alter table PARTITION_PARAMS modify column PARAM_VALUE varchar(4000) character set utf8 ;<br>alter table PARTITION_KEYS modify column PKEY_COMMENT varchar(4000) character set utf8;</p>
<p>（3）修改索引注解</p>
<p>alter table INDEX_PARAMS modify column PARAM_VALUE varchar(4000) character set utf8;</p>
<p>修改hive-site.xml配置文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionURL<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>jdbc:mysql://IP:3306/db_name?createDatabaseIfNotExist=true&amp;useUnicode=true&amp;characterEncoding=UTF-8<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>JDBC connect string for a JDBC metastore<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>上述的 <code>&amp; 是 &amp;amp; </code></p>

      
    </div>

    
    
    

      
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://zihang.fun/2022/11/28/11-28/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="liu zihang">
      <meta itemprop="description" content="只有努力不会辜负你">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="枫叶冢">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/11/28/11-28/" class="post-title-link" itemprop="url">yarn</a>
        </h2>

        <div class="post-meta">
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-11-28 08:34:31" itemprop="dateCreated datePublished" datetime="2022-11-28T08:34:31+08:00">2022-11-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-01-11 09:10:00" itemprop="dateModified" datetime="2023-01-11T09:10:00+08:00">2023-01-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%97%A5%E5%BF%97/" itemprop="url" rel="index"><span itemprop="name">日志</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>5.4k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>5 分钟</span>
            </span>

        </div>
      </header>

    
    
    

   

    <div class="post-body" itemprop="articleBody">

      
          <h1 id="yarn"><a href="#yarn" class="headerlink" title="yarn"></a>yarn</h1><h2 id="架构"><a href="#架构" class="headerlink" title="架构"></a>架构</h2><p>主从架构 ： resourcemanager(资源的分配) : nodemanager(资源的供给与隔离)</p>
<h3 id="资源调度"><a href="#资源调度" class="headerlink" title="资源调度"></a>资源调度</h3><p>通过rm把nm的资源分配给我们的 task上</p>
<h3 id="资源隔离"><a href="#资源隔离" class="headerlink" title="资源隔离"></a>资源隔离</h3><p>nm按照要求给task提供资源，保证提供的资源具有独占性</p>
<h3 id="资源"><a href="#资源" class="headerlink" title="资源"></a>资源</h3><p>nm指挥分配的资源</p>
<p>一个task对应一个container ： cpu&#x2F;mem（cpu和内存）</p>
<p>每个container之间是相互隔离的</p>
<h2 id="yarn的架构设计"><a href="#yarn的架构设计" class="headerlink" title="yarn的架构设计"></a>yarn的架构设计</h2><p>作业提交的流程：<br>client &#x3D;&gt; 给rm 的apps 发送请求 去运行 jar （app master）</p>
<p>apps 分配一个container 去运行 app master</p>
<p>app master 会向apps manager 去注册我的作业</p>
<p>app master 向resource scheduler 申请资源去运行 我的代码</p>
<p>nodemanager 会开启资源 container 去运行map task 以及reduce task</p>
<p>tsak 会向 app master 汇报代码与运行情况</p>
<p>当代码运行完成 app master 会给apps 发送请求 ，通知我的作业完成了</p>
<p>apps manager 收到请求之后会通知你的客户端 ，告诉已经运行完成</p>
<p>输入阶段 ： map tsak 的个数 &#x3D;》container 的申请个数 redurce task 同理</p>
<h2 id="面试会问"><a href="#面试会问" class="headerlink" title="面试会问"></a>面试会问</h2><p>yarn的架构设计 &#x3D;&#x3D;mr作业提交流程</p>
<h2 id="调度器"><a href="#调度器" class="headerlink" title="调度器"></a>调度器</h2><p>FIFO ：</p>
<ul>
<li>先进先出</li>
<li>单队列</li>
</ul>
<p>Capacity ：容量调度器</p>
<ul>
<li>多队列</li>
<li>先进先出（针对一个队列）</li>
<li>每个队列之间互不影响</li>
<li>每个队列之间是事先定好的</li>
</ul>
<p>Fair：公平调度器</p>
<ul>
<li>多队列</li>
<li>每个队列之间的每个job是有影响的 不是先进先出</li>
<li>哪一个job的优先级高就执行哪一个</li>
<li>如果相同优先级，则是顺序</li>
</ul>
<p>主流的中小企业：Capacity</p>
<p>大公司会用：fair</p>
<h3 id="默认调度器"><a href="#默认调度器" class="headerlink" title="默认调度器"></a>默认调度器</h3><p>3.x：默认是容量调度器</p>
<p>通过调度器进行其作业调度</p>
<p>2.x: 版本是fair（默认）</p>
<h2 id="yarn的web界面的简介"><a href="#yarn的web界面的简介" class="headerlink" title="yarn的web界面的简介"></a>yarn的web界面的简介</h2><p>左侧侧边栏 ： 有几个选项卡 ： 分别是</p>
<h2 id="yarn资源的调优"><a href="#yarn资源的调优" class="headerlink" title="yarn资源的调优"></a>yarn资源的调优</h2><p>container?</p>
<p>一定比例的cpu和mem</p>
<p>刀片服务器的配置 ： 128G 16 core :假设一个机器的配置</p>
<p>刀片服务器 装完系统 消耗内存 1G</p>
<p>系统预留 ： 预留 20%左右 包含装完成系统 消耗的1G</p>
<p>原因 ：给未来部署组件预留空间，防止全部使用 ： 会导致系统夯住 就是卡住 ，oom机制【linux系统】：系统会自己杀死进程当内存不足的时候</p>
<p>预留空间 ： 128 * 0.2 &#x3D; 26G</p>
<p>其余空间用于大数据 102G</p>
<p>hadoop ：</p>
<ul>
<li>datanode  进程内存 ： 默认 1G &#x3D;》 生产上 2G</li>
<li>nodemanager 进程内存 ： ，默认 1G &#x3D;》 生产上 4G</li>
</ul>
<p>接下来还有96G全部给我们的yarn资源 ： 96G</p>
<p>container的资源分配 ：</p>
<p>内存</p>
<p>cpu</p>
<p>相比：cpu更重要一些</p>
<p>container的内存划分 ：默认是86G</p>
<p>其最小是 1G（默认）</p>
<p>最大是 8G（默认） 但是可以设置</p>
<p>注意 container的内存会自动增加 默认以1G递增</p>
<p>container cpu ： 是虚拟核 &#x3D;》 考虑初衷是不同节点的cpu性能不同</p>
<p>比如 ： 一个cpu是另外一个cpu的2倍</p>
<p>第一机器 ： pcore ：vcore &#x3D; 1：2 相当于1个物理核当成两个虚拟核用</p>
<p>给container的核数 ： 默认是8core</p>
<p>总数 ：</p>
<p>最小:1c  (默认)</p>
<p>最大:4c（默认）</p>
<p>实际开发角度 ：</p>
<p>mem：最大不要超过32G ，如果超过32G则会导致压缩指针失效</p>
<p>cpu ： cloudera的公司推荐一个container的core最好不要超过5</p>
<p>配置core  ：在yarn-site.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.resource.memory-mb<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>4096<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.scheduler.minimum-allocation-mb<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>1024<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.scheduler.maximum-allocation-mb<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>2048<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">cpu： </span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.resource.pcores-vcores-multiplier<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>2<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.resource.cpu-vcores<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>4<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.scheduler.minimum-allocation-vcores<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.scheduler.maximum-allocation-vcores<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>2<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="mapreduce"><a href="#mapreduce" class="headerlink" title="mapreduce"></a>mapreduce</h2><p>map task :mem  : 默认是1024m ，一个map task 申请的资源是1024m ， 但是如果实际使用的资源的内存量超过这个值，你的task会强制被杀死 ，reduce task 也一样</p>
<p>map task :vcore ： 默认是1</p>
<p>reduce task :mem : 默认是1024m</p>
<p>reduce task :vcore : 默认是1</p>
<p>mr作业是进程级别 &#x3D;》 jvm</p>
<p>map task</p>
<p>reduce task</p>
<p>jvm参数调优 ：</p>
<p>存储 hdfs</p>
<p>存储文件</p>
<p>压缩</p>
<ul>
<li>为什么使用压缩？</li>
<li>节省空间</li>
<li>节省时间<ul>
<li>网络io核磁盘io会减少</li>
<li>指的是mapreduce数据计算过程中</li>
<li>经过网络传输的数据会变少，</li>
<li>同样到磁盘上的时候，数据量少也会减少磁盘的io</li>
</ul>
</li>
<li>使用场景<ul>
<li>采用压缩 ， 对机器的cpu要求比较高</li>
<li>存储数据的空间不够了，才会用压缩</li>
</ul>
</li>
<li>两面性</li>
<li>采用压缩的确会让空间和时间减少</li>
<li>cpu消耗 cpu利用率高 &#x3D;》会导致处理的时间变长一点</li>
<li>如何使用压缩？</li>
</ul>
<p>常见的压缩格式</p>
<ul>
<li>gzip</li>
<li>bzip2</li>
<li>Lzo</li>
<li>Snappy</li>
<li>LZ4</li>
</ul>
<p>常见的压缩注意点：</p>
<p>压缩比 Bzip2 30%  GZIP    snappy、lzo 50%  ： 这个30%和50%代表能把源文件压缩到源文件的%多少</p>
<p>解压速度 ： snappy、lzo GZIP   Bzip2</p>
<p>压缩文件可不可以一被切分</p>
<p>假设一个 5G文件 不能被切分 split 意味着 只能使用一个map task去处理</p>
<p>map task  5G</p>
<p>假设一个 5G文件 能被切片  splits 10map task 去并行处理</p>
<p>5*1024 &#x2F;10 &#x3D; 一个map task 处理的数据</p>
<p>能否被切分 决定了 你的 一个map task处理的数据量有多少</p>
<p>压缩后的文件是否支持分割？<br>            gzip  不可分割<br>            bzip2  可分割<br>            lzo   带索引的可以分割 (默认是不支持分割的)<br>            snappy 不可分割的</p>
<p>mapreduce 每个阶段该如何采用这些算法？</p>
<p>input &#x3D;》 maps &#x3D;》 reduce &#x3D;》 output</p>
<p>input：<br>    1.Bzip2 ：支持分割 多个map task 进行出</p>
<p>map out：</p>
<ul>
<li>snappy 、lzo</li>
<li>shuffle 过程 要选择一个解压 速度快的压缩格式</li>
</ul>
<p>reduce out ：</p>
<ul>
<li>1.高的压缩比 + 支持分片  &#x3D;》 节省空间</li>
<li>2.bzip2  、lzo带索引的</li>
</ul>
<p>reduce out 数据 作为下一个<br>map 的输入咋办？<br>建议使用bzip2【如果采用压缩的话】</p>
<p>进行压缩配置的两种方式 ：</p>
<p>job &#x3D;》 code 针对少数job生产生效</p>
<p>集群所有的job 在配置文件里配置</p>
<p>对mapreduce 进行配置</p>
<ul>
<li>配置压缩的codec</li>
<li>map reduce 输出配置<ul>
<li>先打开压缩的开关</li>
<li>配置codec即可</li>
</ul>
</li>
<li>hadoop是不是支持哪些压缩 ，通过命令 ：或者配置文件</li>
<li>core-site.xml<ul>
<li>配置支持的压缩有什么</li>
<li>原生的hadoop默认不支持lzo的算法，因为lzo要把整个hadooop重新编译一遍才可以重新实行</li>
<li>&#96;&#96;&#96;<property>
        <name>io.compression.codecs</name>
        <value>org.apache.hadoop.io.compress.BZip2Codec,
        org.apache.hadoop.io.compress.SnappyCodec,
        org.apache.hadoop.io.compress.GzipCodec,
        org.apache.hadoop.io.compress.DefaultCodec
    </value>
</property>
<figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">mapred-site.xml:</span><br><span class="line"></span><br><span class="line">* <span class="number">1</span>.先打开压缩的开关</span><br><span class="line">* <span class="number">2</span>.<span class="keyword">map</span> reduce 输出 压缩算法</span><br><span class="line"></span><br><span class="line">reduce： 开关</span><br><span class="line"></span><br><span class="line">* mapreduce.output.fileoutputformat.compress</span><br><span class="line">* ```</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          </span><span class="language-xml"><span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.output.fileoutputformat.compress<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">          </span><span class="language-xml"><span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li>&#96;&#96;&#96;<property>
        <name>mapreduce.output.fileoutputformat.compress.codec</name>
        <value>org.apache.hadoop.io.compress.BZip2Codec</value>
</property>
<figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="built_in">map</span>阶段的：</span><br><span class="line"></span><br></pre></td></tr></table></figure>
// 设置在map输出阶段压缩
      conf.set("mapreduce.map.output.compress", "true");</li>
</ul>
<p>&#x2F;&#x2F; 设置解压缩编码器<br>        conf.set(“mapreduce.map.output.compress.codec”, “org.apache.hadoop.io.compress.DefaultCodec”);</p>
<figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">各个datanode数据节点的平衡</span><br><span class="line"></span><br><span class="line"><span class="comment">* DN1 存储空间 90%</span></span><br><span class="line"><span class="comment">* DN2 存储空间 60%</span></span><br><span class="line"><span class="comment">* DN3 存储空间 80%</span></span><br><span class="line"></span><br><span class="line">如何做呢？</span><br><span class="line"></span><br><span class="line"><span class="comment">* sbin/start-balancer.sh</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">parameters</span> = Balancer.BalancerParameters</span><br><span class="line"></span><br><span class="line">[BalancingPolicy.Node, threshold <span class="comment">= 10.0, max idle iteration = 5</span></span><br><span class="line"></span><br><span class="line">数据平衡的默认阈值：threshold <span class="comment">= 10.0</span></span><br><span class="line"></span><br><span class="line">每个节点的磁盘使用率 - 平均的磁盘使用率 &lt;10%</span><br><span class="line"></span><br><span class="line">DN1 存储空间 <span class="comment">90%  -76% = 14%</span> 说明这个节点数据多 往别的节点迁移数据 出</span><br><span class="line">DN2 存储空间 <span class="comment">60%  -76% = -12%</span> 说明这个节点数据少 别的节点迁移数据 进</span><br><span class="line">DN3 存储空间 <span class="comment">80%  -76% = 4%</span> 	说明这个节点数据多 往别的节点迁移数据</span><br><span class="line"></span><br><span class="line">avg=90 + 80 +60 /<span class="number">3</span> = <span class="number">76</span>%</span><br><span class="line"></span><br><span class="line">生产上 从现在开始 start-balancer.sh -threshold <span class="number">10</span>  每天要定时做的</span><br><span class="line"></span><br><span class="line">放到业务低谷期去做 数据平衡操作</span><br><span class="line"></span><br><span class="line">注意： 不要在业务高峰期做</span><br><span class="line"></span><br><span class="line"><span class="number">1.</span>数据平衡 数据传输  带宽有关</span><br><span class="line"></span><br><span class="line">调优参数 ：平衡的网络带宽  w</span><br><span class="line"></span><br><span class="line">dfs.datanode.balance.bandwidthPerSec <span class="number">100</span>m 【<span class="number">2.</span>x 默认是<span class="number">10</span>m】</span><br><span class="line"></span><br><span class="line">每个节点数据几十T  需要数据平衡的数据 几十T  可以申请维护窗口时间 ：</span><br><span class="line"></span><br><span class="line">dfs.datanode.balance.bandwidthPerSec 临时调大 <span class="number">200</span>M</span><br><span class="line"></span><br><span class="line">单个DN节点 多块磁盘的数据平衡</span><br><span class="line"></span><br><span class="line">投产前规划：</span><br><span class="line">		DN 机器   <span class="number">10</span>块 <span class="number">2</span>T 【不做raid】  =》 <span class="number">20</span>T   副本的</span><br><span class="line"></span><br><span class="line"><span class="number">1.</span>dn 配置多个磁盘</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<property>
        <name>dfs.datanode.data.dir</name>
        <value>/data01,/data02,/data03</value>
</property>
```

<p>挂载磁盘一般最省钱的是 2W 转数 2T的</p>
<p>2.为什么要使用多块物理磁盘？</p>
<p>1.存储<br>2.因为多个磁盘的io也是叠加的<br>每块磁盘 磁盘io 每秒 100m<br>三块磁盘 1s 能 300m文件内容<br>一块磁盘 1s 100m</p>
<p>3.可以让服务一直运行，加入一个磁盘挂了，服务不会减少</p>
<p>做多个磁盘数据均衡<br>    dfs.disk.balancer.enabled  true 【3.x有这个功能 cdh 2.x 也有】 apache 2.x 没有这个功能</p>
<p>得通过命令去解决磁盘数据均衡？</p>
<p>hdfs diskbalancer</p>
<p>1.步骤</p>
<pre><code>hdfs diskbalancer -plan  bigdata32  =&gt; 生成一个  bigdata32.plan.json 文件
    hdfs diskbalancer -execute bigdata32.plan.json =》 执行disk 数据均衡计划文件
    hdfs diskbalancer -query bigdata32
</code></pre>
<p>生产上 当你发现 磁盘写入不均衡 可以做一下 【一般 一个月 半个月 做一次即可】</p>

      
    </div>

    
    
    

      
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://zihang.fun/2022/11/24/11-24/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="liu zihang">
      <meta itemprop="description" content="只有努力不会辜负你">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="枫叶冢">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/11/24/11-24/" class="post-title-link" itemprop="url">ts</a>
        </h2>

        <div class="post-meta">
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-11-24 08:22:22" itemprop="dateCreated datePublished" datetime="2022-11-24T08:22:22+08:00">2022-11-24</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-01-11 09:09:48" itemprop="dateModified" datetime="2023-01-11T09:09:48+08:00">2023-01-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%9D%82%E8%B4%A7%E6%8A%80%E6%9C%AF%E6%A0%88/" itemprop="url" rel="index"><span itemprop="name">杂货技术栈</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>2.5k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>2 分钟</span>
            </span>

        </div>
      </header>

    
    
    

   

    <div class="post-body" itemprop="articleBody">

      
          <h1 id="typeScript"><a href="#typeScript" class="headerlink" title="typeScript"></a>typeScript</h1><h2 id="简介："><a href="#简介：" class="headerlink" title="简介："></a>简介：</h2><p>ts：typescript ： 简单来说就是js的超集，可以向下兼容js，所以我们使用ts不用对js进行更改，ts会自动转换成js</p>
<p>因为现在的浏览器不支持ts的语法 ： ts的编译环境是node.js</p>
<p>安装运行 ： npm install -g typescript</p>
<p>安装之后用tsv -v 查看</p>
<p>与逆行的时候下载一个json</p>
<p>命令行 : tsc -init</p>
<p>然后运行命令 ： ts-node .&#x2F;文件名</p>
<p>下面是关于ts的简单介绍</p>
<p>首先ts是静态类型，js是动态类型</p>
<h3 id="类型"><a href="#类型" class="headerlink" title="类型"></a>类型</h3><p>静态类型是编译阶段就会发现问题，而动态类型则是直到运行阶段才会问问题的</p>
<p>所以相比较而言，静态类型，比动态类型更加可控</p>
<h2 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h2><p>ts的类型 ：</p>
<p>包括 : 布尔 ， 数值，字符串， null , symbol , BigInt,undefined</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> isDone :<span class="built_in">boolean</span> = <span class="literal">false</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">s</span>: <span class="built_in">number</span> = <span class="number">6</span>;</span><br><span class="line"><span class="keyword">let</span> <span class="attr">a</span>: <span class="built_in">number</span> = <span class="title class_">NaN</span>;</span><br><span class="line"><span class="keyword">let</span> <span class="attr">b</span>: <span class="built_in">number</span> = <span class="title class_">Infinity</span>;</span><br><span class="line"><span class="keyword">let</span> <span class="attr">my</span>: <span class="built_in">string</span> = <span class="string">&#x27;yon&#x27;</span></span><br><span class="line"><span class="keyword">let</span> o : <span class="literal">undefined</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">nme</span>: <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">alertName</span>(<span class="params"></span>) : <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="title function_">alert</span>(<span class="string">&#x27;my first name&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> <span class="attr">arr</span>: <span class="built_in">any</span>[] = [<span class="string">&quot;hello&quot;</span> , <span class="number">1</span> , <span class="literal">true</span>]</span><br><span class="line"><span class="keyword">let</span> <span class="attr">ids</span>:<span class="built_in">number</span>[] = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>];</span><br><span class="line"><span class="keyword">let</span> <span class="attr">names</span>: <span class="title class_">String</span>[] = [<span class="string">&quot;xxx&quot;</span> , <span class="string">&quot;yyy&quot;</span> , <span class="string">&quot;zzzz&quot;</span>];</span><br><span class="line"><span class="keyword">let</span> <span class="attr">book</span>: <span class="title class_">Object</span>[] = [&#123;<span class="attr">name1</span>:<span class="string">&#x27;tom&#x27;</span> , <span class="attr">animal</span>:<span class="string">&#x27;cont&#x27;</span>&#125;,&#123;<span class="attr">name1</span>:<span class="string">&#x27;gggg&#x27;</span>,<span class="attr">animal</span>:<span class="string">&#x27;hhhh&#x27;</span>&#125;];</span><br><span class="line">ids.<span class="title function_">push</span>(<span class="number">6</span>);</span><br><span class="line"><span class="keyword">let</span> <span class="attr">person</span>:(<span class="built_in">string</span>|<span class="built_in">number</span>|<span class="built_in">boolean</span>)[]=[<span class="string">&#x27;aslkdjla&#x27;</span>,<span class="number">1</span>,<span class="literal">true</span>]; <span class="comment">// 这个是三个值</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">person1</span>:[<span class="built_in">string</span>,<span class="built_in">number</span>,<span class="built_in">boolean</span>]=[<span class="string">&#x27;sdfjkl&#x27;</span>,<span class="number">1</span>,<span class="literal">true</span>]; <span class="comment">// 这个是一个值</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">info</span>(isDone)<span class="keyword">let</span> isDone :<span class="built_in">boolean</span> = <span class="literal">false</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">s</span>: <span class="built_in">number</span> = <span class="number">6</span>;</span><br><span class="line"><span class="keyword">let</span> <span class="attr">a</span>: <span class="built_in">number</span> = <span class="title class_">NaN</span>;</span><br><span class="line"><span class="keyword">let</span> <span class="attr">b</span>: <span class="built_in">number</span> = <span class="title class_">Infinity</span>;</span><br><span class="line"><span class="keyword">let</span> <span class="attr">my</span>: <span class="built_in">string</span> = <span class="string">&#x27;yon&#x27;</span></span><br><span class="line"><span class="keyword">let</span> o : <span class="literal">undefined</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">nme</span>: <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">alertName</span>(<span class="params"></span>) : <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="title function_">alert</span>(<span class="string">&#x27;my first name&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">info</span>(isDone)</span><br></pre></td></tr></table></figure>

<h2 id="接口"><a href="#接口" class="headerlink" title="接口"></a>接口</h2><p>我们定义接口的方式如下：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> a&#123;</span><br><span class="line">    <span class="attr">name</span>:<span class="built_in">string</span>;</span><br><span class="line">    <span class="attr">age</span>:<span class="built_in">number</span>;</span><br><span class="line">    <span class="attr">isP</span>:<span class="built_in">boolean</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>和上述数组的作用一样，不过这样定义可以增强复用性，随便让一个东西继承一下他，就可以了</p>
<p>比如：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> a&#123;</span><br><span class="line">    <span class="attr">name</span>:<span class="built_in">string</span>;</span><br><span class="line">    <span class="attr">age</span>:<span class="built_in">number</span>;</span><br><span class="line">    <span class="attr">isP</span>:<span class="built_in">boolean</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="attr">p</span>:a=&#123;</span><br><span class="line">    <span class="attr">name</span>:<span class="string">&#x27;kjds&#x27;</span>,</span><br><span class="line">    <span class="attr">age</span>:<span class="number">11</span>,</span><br><span class="line">    <span class="attr">isP</span>:<span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><p>函数合上述的接口很像，他是在接口创建了几个方法，如下</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> s&#123;</span><br><span class="line">    <span class="attr">name</span>:<span class="built_in">string</span>;</span><br><span class="line">    <span class="title function_">eat</span>(<span class="attr">name</span>:<span class="built_in">string</span>):<span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="attr">j</span>:s=&#123;</span><br><span class="line">    <span class="attr">name</span>:<span class="string">&#x27;lkasdj&#x27;</span>,</span><br><span class="line">    <span class="attr">eat</span>:<span class="keyword">function</span>(<span class="params">name:<span class="built_in">string</span></span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;eat$&#123;name&#125;&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">add</span> = (<span class="params">a:<span class="built_in">number</span>,b:<span class="built_in">number</span>,c?:<span class="built_in">number</span>|<span class="built_in">string</span></span>)=&gt;&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(c)</span><br><span class="line">    <span class="keyword">return</span> a+b</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>问号代表从后面的类型里选数据，这里是number和string</p>
<p>上面的是lambad多</p>
<p>把ts转换成js的语法是any</p>
<h2 id="Dom和类型转换"><a href="#Dom和类型转换" class="headerlink" title="Dom和类型转换"></a>Dom和类型转换</h2><p>ts无法像js一样进行访问dom这个就意味着ts无法确定这些dom是不是存在，所以使用非空断言，我们可用明确的告诉他，这个表达式是null&#x2F;undefined</p>
<p>非空断言 X! 代表把x中的null和undefined给去除了</p>
<p>例如 ：下面是关于ts和获取dom的</p>
<p><code>const link = document.querySelector(&#39;a&#39;);</code></p>
<p>当我们要通过class来选择一个dom元素的时候，可以进行一层转化</p>
<p>例如 ： <code>const from = document.getElementById(&#39;form&#39;) as HTMLAnchorElement</code></p>
<h2 id="类"><a href="#类" class="headerlink" title="类"></a>类</h2><p>和java中的类异常类似</p>
<p>比如 ：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Preson</span> &#123; </span><br><span class="line">    <span class="attr">name</span>:<span class="built_in">string</span>;</span><br><span class="line">    <span class="attr">iscool</span>:<span class="built_in">boolean</span>;</span><br><span class="line">    <span class="attr">age</span>:<span class="built_in">number</span>;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">n:<span class="built_in">string</span>,c:<span class="built_in">boolean</span>,a:<span class="built_in">number</span></span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">name</span>=n</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">iscool</span>=c</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">age</span>=a</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">sayhai</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;hi,wosshi$&#123;this.name&#125;,jinnnan$&#123;this.age&#125;&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>类的修饰符</p>
<p>readonly,privatee,protected,public</p>
<p>简单的介绍就到这里为止，具体以后再慢慢补充</p>

      
    </div>

    
    
    

      
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://zihang.fun/2022/11/21/11-21/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="liu zihang">
      <meta itemprop="description" content="只有努力不会辜负你">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="枫叶冢">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/11/21/11-21/" class="post-title-link" itemprop="url">mapreduce</a>
        </h2>

        <div class="post-meta">
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-11-21 08:47:09" itemprop="dateCreated datePublished" datetime="2022-11-21T08:47:09+08:00">2022-11-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-01-11 09:09:22" itemprop="dateModified" datetime="2023-01-11T09:09:22+08:00">2023-01-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%97%A5%E5%BF%97/" itemprop="url" rel="index"><span itemprop="name">日志</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>4.7k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>4 分钟</span>
            </span>

        </div>
      </header>

    
    
    

   

    <div class="post-body" itemprop="articleBody">

      
          <h1 id="续讲Hadoop"><a href="#续讲Hadoop" class="headerlink" title="续讲Hadoop"></a>续讲Hadoop</h1><h2 id="模板模式"><a href="#模板模式" class="headerlink" title="模板模式"></a>模板模式</h2><p>关于mapreduce的操作模式就是模板模式，加上自定义的变量</p>
<h3 id="模板模式-1"><a href="#模板模式-1" class="headerlink" title="模板模式"></a>模板模式</h3><p>关于模板模式，就是三步走</p>
<p>开始阶段 ： map阶段</p>
<p>处理阶段 ： reduce阶段</p>
<p>结束阶段 ： 关闭流并输出</p>
<h3 id="自定义的变量"><a href="#自定义的变量" class="headerlink" title="自定义的变量"></a>自定义的变量</h3><p>BooleanWriteable : 布尔类型</p>
<p>ByteWriteable : Byte类型</p>
<p>DoubleWriteable : double类型</p>
<p>FloatWriteable ：float类型</p>
<p>intWriteable ： int类型</p>
<p>…（等等）</p>
<h3 id="mapreduce的核心方法"><a href="#mapreduce的核心方法" class="headerlink" title="mapreduce的核心方法"></a>mapreduce的核心方法</h3><ul>
<li>input : InputFormat &#x3D;&gt; 如何加载数据</li>
<li>查看源码发现有DBInputFormat 和 FileInputFormat，代表我们可以从db（数据库中），或者文件中加载数据（上述两个是抽象类，我们实例化的时候其实是实例化其子类）</li>
<li>简单来说就是读取数据的方法</li>
<li>默认实例化的时候是实例化 TextInputFormat</li>
<li>关于TextInputFormat ： 其有两个参数<ul>
<li>key 和 value<ul>
<li>key 是 读取文件的位置</li>
<li>value 是 一行一行的内容<ul>
<li>在value中有个属性 判断文件可不可以被切分 ： isSpiltable<ul>
<li>map task 数据 是由 input 的切片数量决定的 ， 当不可被切片的时候对应的数量就是1，对应一个map task</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>creatRecordReader</p>
<h2 id="一个文件加载的时候会被切分成几个切片"><a href="#一个文件加载的时候会被切分成几个切片" class="headerlink" title="一个文件加载的时候会被切分成几个切片"></a>一个文件加载的时候会被切分成几个切片</h2><p>前提 ： 文件可以被切分</p>
<p>当一个文件 在hdfs上的时候是按我们的大小进行切分的 以128m为基础单位</p>
<p>而我们的map的切片是按照blocksize进行切分的简单来说就是以blocksize的大小进行切分</p>
<p>总结  ：</p>
<ul>
<li>文件大小小于128m<ul>
<li>那么切分成1片</li>
</ul>
</li>
<li>如果文件大于128m<ul>
<li>filesize&#x2F;splitesize &#x3D; num 切片数</li>
<li>filesize剩余的部分 ： 和splitesize的10%比较<ul>
<li>如果大，则开启一个切片文件</li>
<li>如果小，则是和上面最后一个合并到一起</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>不能被切分的文件： 某些被压缩文件</p>
<ul>
<li>关于这个切片大小的标准 ：<ul>
<li>在hdfs上是128m</li>
<li>但是在idea上是32m（在源码里能看）</li>
</ul>
</li>
</ul>
<h2 id="redurce-task-个数是由上面决定"><a href="#redurce-task-个数是由上面决定" class="headerlink" title="redurce task 个数是由上面决定?"></a>redurce task 个数是由上面决定?</h2><p>默认是 1</p>
<p>如果要更改要手动更改</p>
<p>setNumReduceTasks(数量)</p>
<p>如果 reduce阶段数量变多</p>
<p>则会把相同的文件拉到一起，就是按照一个规则进行的分区</p>
<p>默认是走的hashcode ： 这个按照规则来分的就是分区</p>
<p>一般来说 ： 分区的结果是 suffler 的输出结果是 reduce的输入</p>
<h3 id="简单需求"><a href="#简单需求" class="headerlink" title="简单需求"></a>简单需求</h3><p>基于phone的存储数据 ，进行分文件存储</p>
<p>比如</p>
<p>13开头的存储在一个上</p>
<p>15开头的在一个文件上</p>
<p>这就要自定义分区</p>
<p>通过继承Partitioner类实现方法然后导入方法</p>
<p>实现getPartition方法进行分区 ： 以下是一个简单的分区函数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.IntWritable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Partitioner;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">myPartionit</span> <span class="keyword">extends</span> <span class="title class_">Partitioner</span>&lt;Text , IntWritable&gt; &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getPartition</span><span class="params">(Text text, IntWritable intWritable, <span class="type">int</span> i)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (text.toString().equals(<span class="string">&quot;ANALYST&quot;</span>))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span> (text.toString().equals(<span class="string">&quot;CLERK&quot;</span>))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span> (text.toString().equals(<span class="string">&quot;MANAGER&quot;</span>))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span> (text.toString().equals(<span class="string">&quot;PRESIDENT&quot;</span>))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">3</span>;</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span> (text.toString().equals(<span class="string">&quot;SALESMAN&quot;</span>))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">4</span>;</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">5</span>;</span><br><span class="line">&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后我们要在我们的主程序中调用这个类 ， test类：就是我们的主类，如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.conf.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.Path;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.IntWritable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Job;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Mapper;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Reducer;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.input.FileInputFormat;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.StringTokenizer;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> sxwang</span></span><br><span class="line"><span class="comment"> * 11 18 14:00</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">test</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * driver</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> args</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (args.length &lt; <span class="number">2</span>)&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;出现问题最少两个参数&quot;</span>);</span><br><span class="line">System.exit(<span class="number">2</span>);</span><br><span class="line">&#125;</span><br><span class="line">        String input=args[<span class="number">0</span>];</span><br><span class="line">String output=args[<span class="number">1</span>];</span><br><span class="line"><span class="type">Configuration</span> <span class="variable">conf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Configuration</span>();</span><br><span class="line"><span class="comment">//0.todo... 删除目标路径</span></span><br><span class="line">FileUtils.deletePath(conf,output);</span><br><span class="line"></span><br><span class="line"><span class="comment">//1.设置 作业名称</span></span><br><span class="line"><span class="type">Job</span> <span class="variable">job</span> <span class="operator">=</span> Job.getInstance(conf, <span class="string">&quot;WCAPP&quot;</span>);</span><br><span class="line"><span class="comment">//2.设置map reduce 执行代码的主类</span></span><br><span class="line">job.setJarByClass(test.class);</span><br><span class="line">job.setMapperClass(MyMapper.class);</span><br><span class="line">job.setReducerClass(MyReducer.class);</span><br><span class="line"><span class="comment">//3.指定 oupput kv类型</span></span><br><span class="line">job.setOutputKeyClass(Text.class);</span><br><span class="line">job.setOutputValueClass(IntWritable.class);</span><br><span class="line">job.setNumReduceTasks(<span class="number">6</span>);</span><br><span class="line">job.setPartitionerClass(myPartionit.class);</span><br><span class="line"><span class="comment">//4. 设置数据源路径 数据输出路径</span></span><br><span class="line">FileInputFormat.addInputPath(job, <span class="keyword">new</span> <span class="title class_">Path</span>(input));</span><br><span class="line">FileOutputFormat.setOutputPath(job, <span class="keyword">new</span> <span class="title class_">Path</span>(output));</span><br><span class="line"><span class="comment">//5. 提交mr yarn</span></span><br><span class="line">System.exit(job.waitForCompletion(<span class="literal">true</span>) ? <span class="number">0</span> : <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * mapper</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">MyMapper</span></span><br><span class="line">            <span class="keyword">extends</span> <span class="title class_">Mapper</span>&lt;Object, Text, Text, IntWritable&gt; &#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">map</span><span class="params">(Object key, Text value, Context context)</span> <span class="keyword">throws</span> IOException, InterruptedException &#123;</span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * 1.按照分隔符 进行拆分 每个单词 ，每个单词赋值为1</span></span><br><span class="line"><span class="comment">             * (word ,1)</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line"></span><br><span class="line">String[] words = value.toString().split(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (String word : words) &#123;</span><br><span class="line">                String[] split = word.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">context.write(<span class="keyword">new</span> <span class="title class_">Text</span>(split[<span class="number">2</span>]) ,<span class="keyword">new</span> <span class="title class_">IntWritable</span>(<span class="number">1</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * reducer</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">MyReducer</span></span><br><span class="line">            <span class="keyword">extends</span> <span class="title class_">Reducer</span>&lt;Text,IntWritable,Text,IntWritable&gt; &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         *  (word ,1)</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         *  (word,&lt;1,1,1,1&gt;)</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         *  1.聚合value</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         *  2.写出去</span></span><br><span class="line"><span class="comment">*  (word ,3)</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">reduce</span><span class="params">(Text key, Iterable&lt;IntWritable&gt; values, Context context)</span> <span class="keyword">throws</span> IOException, InterruptedException &#123;</span><br><span class="line">            <span class="type">int</span> sum=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (IntWritable value : values) &#123;</span><br><span class="line">                sum +=Integer.parseInt(value.toString());</span><br><span class="line">&#125;</span><br><span class="line">            context.write(key,<span class="keyword">new</span> <span class="title class_">IntWritable</span>(sum));</span><br><span class="line">&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="sql-vs-mr-mapreduce"><a href="#sql-vs-mr-mapreduce" class="headerlink" title="sql vs mr(mapreduce)"></a>sql vs mr(mapreduce)</h2><ul>
<li>sql  :<ul>
<li>group by</li>
<li>distinct</li>
<li>join</li>
<li>order by</li>
<li>union<ul>
<li><p>group by 用mr实现</p>
</li>
<li><p>就是再map阶段进行处理reduce阶段进行合并</p>
</li>
<li><p>distinct</p>
</li>
<li></li>
<li><p>去重 ： sql ：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span>(ename) <span class="keyword">from</span> emp;</span><br><span class="line">#或者可以通过分组进行去重</span><br><span class="line"><span class="keyword">select</span> name <span class="keyword">from</span> <span class="keyword">group</span> <span class="keyword">by</span> name;</span><br></pre></td></tr></table></figure></li>
<li><p>通过上述我们可知group by 也可以进行去重 ，所以后面我们能用group by 就要用group by</p>
</li>
<li><p>因为distinct只有一个task进行处理</p>
</li>
<li><p>而group by 则是多个task 进行处理 ， 所以效率会比较高</p>
</li>
<li><p>接下来是在mr里实现</p>
</li>
<li><p>order by</p>
</li>
<li><p>mr :</p>
</li>
<li><p>全局排序 ： reduce task 是 1</p>
</li>
<li><p>分区排序 ： reduce task 是 多个</p>
</li>
<li><p>mr : 实现</p>
</li>
<li></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="坑"><a href="#坑" class="headerlink" title="坑"></a>坑</h2><p>如果你的reduce task 大于分区数 ： 会有空白文件</p>
<p>如果 reduce task 小于分区数 且大于1 ： 则会报错</p>
<p>如果 reduce task 且分区数 等于 1 ： 则会把东西整合到一个文件</p>
<h2 id="关于mapreduce在linux上运行的学习，官方提供了源码库"><a href="#关于mapreduce在linux上运行的学习，官方提供了源码库" class="headerlink" title="关于mapreduce在linux上运行的学习，官方提供了源码库"></a>关于mapreduce在linux上运行的学习，官方提供了源码库</h2><p>地址在github上：</p>

      
    </div>

    
    
    

      
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://zihang.fun/2022/11/19/jar%E5%88%B0exe/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="liu zihang">
      <meta itemprop="description" content="只有努力不会辜负你">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="枫叶冢">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/11/19/jar%E5%88%B0exe/" class="post-title-link" itemprop="url">把jar包打包成exe</a>
        </h2>

        <div class="post-meta">
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-11-19 11:40:21" itemprop="dateCreated datePublished" datetime="2022-11-19T11:40:21+08:00">2022-11-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-01-11 09:14:48" itemprop="dateModified" datetime="2023-01-11T09:14:48+08:00">2023-01-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%9D%82%E8%B4%A7%E6%8A%80%E6%9C%AF%E6%A0%88/" itemprop="url" rel="index"><span itemprop="name">杂货技术栈</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>768</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    

   

    <div class="post-body" itemprop="articleBody">

      
          <h1 id="使用工具"><a href="#使用工具" class="headerlink" title="使用工具"></a>使用工具</h1><ul>
<li>我们所使用的工具是exe4j 和 inno setup</li>
</ul>
<h2 id="exe4j"><a href="#exe4j" class="headerlink" title="exe4j"></a>exe4j</h2><ul>
<li>简单来说这个就是个工具，可以把java的jar包打包成exe的</li>
<li>可以让其他由java运行环境的机器运行这个jar</li>
<li>而且还可以稍微做到保密的程度</li>
<li>exe4j 是一个帮助你集成 Java 应用程序到 Windows 操作环境的 java 可执行文件生成工具，无论这些应用是用于服务器，还是图形用户界面（GUI）或命令行的应用程序。如果你想在任务管理器中及 Windows XP 分组的用户友好任务栏里以你的进程名取代 java.exe 的出现，那么 exe4j 可以完成这个工作。exe4j 帮助你以一种安全的方式启动你的 java 应用程序，来显示本地启动画面，检测及发布合适的 JRE 和 JDK，以及进行启动时所发生的错误处理等，以至于更多。</li>
<li>关于exe4j的破解我就不多赘述了，懂的都懂</li>
<li>接下来是实际操作</li>
<li>下面是开始界面</li>
<li><img src="https://pic.imgdb.cn/item/6378540416f2c2beb192c11f.jpg" alt="开始界面"></li>
<li>然后接下来</li>
<li>选择jar到exe的模式</li>
<li><img src="https://pic.imgdb.cn/item/6378546916f2c2beb1932dfa.jpg"></li>
<li>然后接下来要选择你的输出路径</li>
<li><img src="https://pic.imgdb.cn/item/637854cd16f2c2beb193c56c.jpg"></li>
<li>接下来选择我们的启动方式，我选择的是控制台启动</li>
<li><img src="https://pic.imgdb.cn/item/6378550616f2c2beb1942a62.jpg"></li>
<li>接下来选择可以在32位和64位机器上都可以运行</li>
<li><img src="https://pic.imgdb.cn/item/6378553316f2c2beb194a3be.jpg"></li>
<li><img src="https://pic.imgdb.cn/item/6378556516f2c2beb1952fa9.jpg"></li>
<li>接下来选择我们exe要执行的主类</li>
<li>我这个项目是boot项目，所以选择的是这个</li>
<li><img src="https://pic.imgdb.cn/item/6378558416f2c2beb195719f.jpg"></li>
<li>然后设置我们的jdk版本</li>
<li><img src="https://pic.imgdb.cn/item/637855bd16f2c2beb195f1d6.jpg"></li>
<li><img src="https://pic.imgdb.cn/item/637855dc16f2c2beb1962843.jpg"></li>
<li>最后一直点击next就好了</li>
<li><img src="https://pic.imgdb.cn/item/6378564016f2c2beb196ce41.jpg"></li>
<li>这样我们就打包完成了</li>
<li>但是这样的打包只能再有jdk的环境中运行</li>
<li>接下来我们要为这个添加依赖</li>
</ul>
<h2 id="inno-setup"><a href="#inno-setup" class="headerlink" title="inno setup"></a>inno setup</h2><ul>
<li>简单来说就是个绑定依赖的程序</li>
<li>打开</li>
<li><img src="https://pic.imgdb.cn/item/6378572316f2c2beb198e2a2.jpg"></li>
<li><img src="https://pic.imgdb.cn/item/6378577616f2c2beb199aecb.jpg"></li>
<li><img src="https://pic.imgdb.cn/item/6378579d16f2c2beb19a1b5f.jpg"></li>
<li>然后配置我们的名称和版本号</li>
<li>然后选择我们，刚刚弄个出来的exe程序</li>
<li><img src="https://pic.imgdb.cn/item/637858cd16f2c2beb19b780b.jpg"></li>
<li>然后就一直傻瓜式next</li>
<li><img src="https://pic.imgdb.cn/item/6378593316f2c2beb19be141.jpg"></li>
<li>设置输出文件夹</li>
<li>图标</li>
<li>以及运行时的密码</li>
<li>然后一直next就好</li>
<li>然后会跳出两个对话框</li>
<li>全部选择是</li>
<li>最后会出现这个东西</li>
<li><img src="https://pic.imgdb.cn/item/637859e916f2c2beb19d21f9.jpg"></li>
<li>就代表导入依赖了</li>
<li>接下来我们要对他进行修改</li>
<li><img src="https://pic.imgdb.cn/item/63785a3d16f2c2beb19d8050.jpg"></li>
<li>这个是自己电脑本机的jdk路径</li>
<li>然后还有要在这里加上MYjrename</li>
<li><img src="https://pic.imgdb.cn/item/63785a8116f2c2beb19dd2fa.jpg"></li>
<li>最后运行就成功了</li>
<li>他会给你成一个setup文件，通过这个文件安装的exe</li>
<li>就会自己带环境了</li>
<li></li>
</ul>

      
    </div>

    
    
    

      
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="liu zihang"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">liu zihang</p>
  <div class="site-description" itemprop="description">只有努力不会辜负你</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">59</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">25</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="sidebar-button motion-element"><i class="fa fa-comment"></i>
    Chat
  </a>
  </div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/yourname" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;yourname" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      链接网站
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://baidu.com/" title="https:&#x2F;&#x2F;baidu.com" rel="noopener" target="_blank">百度</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://fishc.com.cn/" title="https:&#x2F;&#x2F;fishc.com.cn" rel="noopener" target="_blank">鱼C论坛</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">liu zihang</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count">博客全站共191.5k字</span>
</div>


    <script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

    <span id="busuanzi_container_site_pv">总访问量<span id="busuanzi_value_site_pv"></span>次</span>
    <span class="post-meta-divider">|</span>
    <span id="busuanzi_container_site_uv">总访客数<span id="busuanzi_value_site_uv"></span>人</span>
    <span class="post-meta-divider">|</span>
<!-- 不蒜子计数初始值纠正 -->
<script>
$(document).ready(function() {

    var int = setInterval(fixCount, 50);  // 50ms周期检测函数
    var countOffset = 20000;  // 初始化首次数据

    function fixCount() {            
       if (document.getElementById("busuanzi_container_site_pv").style.display != "none")
        {
            $("#busuanzi_value_site_pv").html(parseInt($("#busuanzi_value_site_pv").html()) + countOffset); 
            clearInterval(int);
        }                  
        if ($("#busuanzi_container_site_pv").css("display") != "none")
        {
            $("#busuanzi_value_site_uv").html(parseInt($("#busuanzi_value_site_uv").html()) + countOffset); // 加上初始数据 
            clearInterval(int); // 停止检测
        }  
    }
       	
});
</script> 

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  
  <script color='0,0,255' opacity='0.5' zIndex='-1' count='99' src="/lib/canvas-nest/canvas-nest.min.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>


  <script defer src="/lib/three/three.min.js"></script>
    <script defer src="/lib/three/canvas_lines.min.js"></script>


  




  
<script src="/js/local-search.js"></script>













  

  

  


</body>
</html>
