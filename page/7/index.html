<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/%E6%A0%91%E5%8F%B6_sleaves%20(1).png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/%E6%A0%91%E5%8F%B6_sleaves.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-flash.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"zihang.fun","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"hide","padding":18,"offset":15,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"flat"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"manual","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="只有努力不会辜负你">
<meta property="og:type" content="website">
<meta property="og:title" content="枫叶冢">
<meta property="og:url" content="http://zihang.fun/page/7/index.html">
<meta property="og:site_name" content="枫叶冢">
<meta property="og:description" content="只有努力不会辜负你">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="liu zihang">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://zihang.fun/page/7/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>枫叶冢</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/rss2.xml" title="枫叶冢" type="application/rss+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>
    <a target="_blank" rel="noopener" href="https://github.com/han2044953296" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#fff; color:#151513; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">枫叶冢</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-schedule">

    <a href="/schedule/" rel="section"><i class="fa fa-calendar fa-fw"></i>日程表</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://zihang.fun/2022/10/15/10-15/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="liu zihang">
      <meta itemprop="description" content="只有努力不会辜负你">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="枫叶冢">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/10/15/10-15/" class="post-title-link" itemprop="url">java中异常的相关知识</a>
        </h2>

        <div class="post-meta">
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-10-15 17:44:10" itemprop="dateCreated datePublished" datetime="2022-10-15T17:44:10+08:00">2022-10-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-01-11 08:56:42" itemprop="dateModified" datetime="2023-01-11T08:56:42+08:00">2023-01-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%97%A5%E5%BF%97/" itemprop="url" rel="index"><span itemprop="name">日志</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>1.1k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    

   

    <div class="post-body" itemprop="articleBody">

      
          <h2 id="异常"><a href="#异常" class="headerlink" title="异常"></a>异常</h2><h3 id="因为一些原因导致开发的程序出现问题"><a href="#因为一些原因导致开发的程序出现问题" class="headerlink" title="因为一些原因导致开发的程序出现问题"></a>因为一些原因导致开发的程序出现问题</h3><p>Throwable是error和Exception的父类，是Java里所有异常的父类<br>##error<br>如果出现了error，则代表计算机出现了重大的错误，比如jvm无法解决的问题等。</p>
<h2 id="Exception"><a href="#Exception" class="headerlink" title="Exception"></a>Exception</h2><p>如果出现了Exception，则代表计算机代码出现了问题，编译或者运行的时候出现了问题。但是Exception还分为运行时异常和编译时异常</p>
<h3 id="运行时异常"><a href="#运行时异常" class="headerlink" title="运行时异常"></a>运行时异常</h3><p>运行时异常比如：</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ArrayIndexOutOfBoundsException<span class="regexp">//</span>这就是个数组越界的异常</span><br></pre></td></tr></table></figure>

<p>这些都是运行的时候产生的异常，编译可以通过的，其中最常见的就是数组越界，下表越剧等</p>
<h3 id="编译时异常"><a href="#编译时异常" class="headerlink" title="编译时异常"></a>编译时异常</h3><p>编译时异常比如：</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">The final <span class="built_in">local</span> <span class="built_in">variable</span> m cannot be assigned. It must be blank <span class="keyword">and</span> <span class="keyword">not</span> <span class="keyword">using</span> <span class="keyword">a</span> <span class="built_in">compound</span> assignment<span class="comment"> //这个就是个简单的final修饰的变量不可被改变的异常</span></span><br></pre></td></tr></table></figure>

<p>这些是在程序未被运行之前就报出的错误。会被编译器会进行优先的处理。<br>最常见的就是作用域的问题，比如static变量和非static的变量等。</p>
<h2 id="异常处理"><a href="#异常处理" class="headerlink" title="异常处理"></a>异常处理</h2><h3 id="try-catch"><a href="#try-catch" class="headerlink" title="try catch"></a>try catch</h3><p>我们可以通过try catch的方法进行捕获异常，让异常出现的时候不至于停止程序的运行<br>代码如下：</p>
<figure class="highlight wren"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">try</span> &#123;<span class="comment">//放会报错的语句，这个是个简单数组越界</span></span><br><span class="line">	<span class="variable">a</span>[<span class="variable">m</span>] <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">	<span class="title class_">System</span>.<span class="property">out</span>.<span class="property">println</span>(<span class="string">&quot;输入正确&quot;</span>);</span><br><span class="line">	&#125; <span class="title function_">catch</span> (<span class="title class_">Exception</span> <span class="variable">e</span>) &#123;</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> handle exception</span></span><br><span class="line">	<span class="comment">// 在错误发生时怎么处理</span></span><br><span class="line">	<span class="title class_">System</span>.<span class="property">out</span>.<span class="property">println</span>(<span class="string">&quot;成功抛出异常&quot;</span>);</span><br><span class="line">	&#125; </span><br><span class="line">	<span class="title function_">catch</span>(<span class="params">xxxxx</span>) &#123;</span><br><span class="line">	&#125;<span class="comment">// 这里的catch还可以继续往下写，但是要注意其中异常的类型必须是越在后面类型越大的，因为Exception还分多个子类异常，这样可以更精确的分辨是什么异常，不过直接写Exception也不算错</span></span><br><span class="line">	<span class="title function_">finally</span> &#123;</span><br><span class="line">		<span class="comment">// finally里放一定会执行的代码，不过不写finally也不算错</span></span><br><span class="line">		&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>但是要注意，我们不可以捕获error异常，因为error异常已经超出了代码捕获的范围，我们一般都要进行硬件及软件的处理</p>
<h3 id="throws"><a href="#throws" class="headerlink" title="throws"></a>throws</h3><p>我们可以通过throws把异常向上抛出，让他们的上层去处理，可是一般上层如果不能处理，还会继续向上抛出，这种方法我简称为逃避，我们，一般使用try catch语句较多，一般是抛到main方法里进行try catch处理，<br>如果异常一直不处理，那编译器最后会报错</p>

      
    </div>

    
    
    

      
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://zihang.fun/2022/10/15/java%E4%B8%AD%E7%9A%84%E6%98%93%E9%94%99%E7%82%B9/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="liu zihang">
      <meta itemprop="description" content="只有努力不会辜负你">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="枫叶冢">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/10/15/java%E4%B8%AD%E7%9A%84%E6%98%93%E9%94%99%E7%82%B9/" class="post-title-link" itemprop="url">java面试题</a>
        </h2>

        <div class="post-meta">
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-10-15 17:44:10" itemprop="dateCreated datePublished" datetime="2022-10-15T17:44:10+08:00">2022-10-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-01-11 09:15:00" itemprop="dateModified" datetime="2023-01-11T09:15:00+08:00">2023-01-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java%E4%B8%AD%E7%9A%84%E6%98%93%E9%94%99%E7%82%B9/" itemprop="url" rel="index"><span itemprop="name">Java中的易错点</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>13k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>12 分钟</span>
            </span>

        </div>
      </header>

    
    
    

   

    <div class="post-body" itemprop="articleBody">

      
          <h1 id="重载和重写"><a href="#重载和重写" class="headerlink" title="重载和重写"></a>重载和重写</h1><h2 id="重载"><a href="#重载" class="headerlink" title="重载"></a>重载</h2><p>重载发生在同一个类里，方法名必须相同，参数类型不同，个数不同，顺序不同，方法的返回值和访问修饰符可以不同，发生在编译时</p>
<h2 id="重写"><a href="#重写" class="headerlink" title="重写"></a>重写</h2><p>发生在父类和子类中，方法名，参数列表相同，返回值范围小于等于父类，<br>抛出异常小于等于父类，访问修饰符大于等于父类，若父类的方法是private则不能重写</p>
<h1 id="List和Set的区别"><a href="#List和Set的区别" class="headerlink" title="List和Set的区别"></a>List和Set的区别</h1><h2 id="List"><a href="#List" class="headerlink" title="List"></a>List</h2><p>list是有序的，按照插入对象的顺序进行访问的，可重复，，可以有多个null元素，可以用iterator取出所有元素，在逐一遍历还可以用get（index）获取指定元素</p>
<h2 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h2><p>set是无序的，不可重复，，最多有一个null对象取元素的时候只能用iterator接口取出所有元素，再逐一遍历</p>
<h1 id="谈谈Concurrent-Hash-Map的扩容机制"><a href="#谈谈Concurrent-Hash-Map的扩容机制" class="headerlink" title="谈谈Concurrent Hash Map的扩容机制"></a>谈谈Concurrent Hash Map的扩容机制</h1><h2 id="1-7jdk"><a href="#1-7jdk" class="headerlink" title="1.7jdk"></a>1.7jdk</h2><ul>
<li>1.ConcurrentHashMap是基于Segment来实现的</li>
<li>2.每个Segment相当于是一个小型的HashMap</li>
<li>3.每个Segment内部都会进行扩容，和HashMap的扩容逻辑相同</li>
<li>4.先生成一个新的数组，然后转移元素到新数组中</li>
<li>5.扩容的判断也是每个Segment单独进行判断的</li>
</ul>
<h2 id="1-8jdk"><a href="#1-8jdk" class="headerlink" title="1.8jdk"></a>1.8jdk</h2><ul>
<li>1.到了1.8 就不基于Segment了</li>
<li>2.当某个线程进行put的时，如果发现有扩容的，就会优先跟着一起进行扩容，</li>
<li>3.如果发现没有进行扩容的，就会把key-value添加到ConcurrentHashMap中然后判断超过阈值了吗超过了则进行扩容</li>
<li>4.ConcurrentHashMap是支持多线程同时扩容的</li>
<li>5.扩容之前也先生成一个新数组</li>
<li>6.转移元素之前先将元素分组，将每组分给不同的线程来进行元素的转移，每个线程负责一组或者多组的元素转移工作</li>
</ul>
<h1 id="jdk1-7到1-8HashMap发生了什么变化"><a href="#jdk1-7到1-8HashMap发生了什么变化" class="headerlink" title="jdk1.7到1.8HashMap发生了什么变化"></a>jdk1.7到1.8HashMap发生了什么变化</h1><h2 id="1-7"><a href="#1-7" class="headerlink" title="1.7"></a>1.7</h2><p>其底层是数组加链表<br>使用的是头插法<br>哈希算法比较复杂</p>
<h2 id="1-8"><a href="#1-8" class="headerlink" title="1.8"></a>1.8</h2><p>其底层是数组+链表和红黑树加入红黑树的目的是加快查找效率<br>其用的是尾插法，要先遍历数组的每个元素，判断数组中的元素个数<br>哈希算法进行了优化，节省cpu资源</p>
<h1 id="接口可以多继承接口"><a href="#接口可以多继承接口" class="headerlink" title="接口可以多继承接口"></a>接口可以多继承接口</h1><h1 id="深拷贝和浅拷贝"><a href="#深拷贝和浅拷贝" class="headerlink" title="深拷贝和浅拷贝"></a>深拷贝和浅拷贝</h1><p>浅拷贝是指只会拷贝基础类型的值<br>浅拷贝是指拷贝的地址指向同一目标</p>
<h1 id="CopyOnwriteArrayList底层"><a href="#CopyOnwriteArrayList底层" class="headerlink" title="CopyOnwriteArrayList底层"></a>CopyOnwriteArrayList底层</h1><ul>
<li>1.首先其内部也是通过数组实现的，在向其中加元素的时候时，会复制一个新数组 ， 并在新数组上进行进行写操作 ， 读操作在原数组上进行</li>
<li>2.并且写操作会加锁，防止出现写入数据丢失的问题</li>
<li>3.写操作结束之后会把原数组指向新数组</li>
<li>4.CopyOnWriteArrayList允许在写数据的同时进行读数据，大大提高了效率因此适合读多写少的场景，但其比较占内存，因此读到的数据并不是最新的，因此适用与实时性不强的地方</li>
</ul>
<h1 id="什么是字节码-字节码的好处"><a href="#什么是字节码-字节码的好处" class="headerlink" title="什么是字节码 字节码的好处"></a>什么是字节码 字节码的好处</h1><p>编译器Javac会将java源文件编译为.class可以做到一次编译到此处运行，例如，windows上编译好的.class可以在linux上运行。</p>
<h2 id="采用字节码的好处"><a href="#采用字节码的好处" class="headerlink" title="采用字节码的好处"></a>采用字节码的好处</h2><p>一方面实现了跨平台，另外一方面提高了代码的执行效率，让编译器可以在编译时进行优化</p>
<h1 id="在java的异常处理机制中，什么时候要抛出异常，什么时候捕获异常"><a href="#在java的异常处理机制中，什么时候要抛出异常，什么时候捕获异常" class="headerlink" title="在java的异常处理机制中，什么时候要抛出异常，什么时候捕获异常"></a>在java的异常处理机制中，什么时候要抛出异常，什么时候捕获异常</h1><p>异常相当于一种提示 ， 若我们抛出异常，就相当于告诉上层方法，我抛出了一个异常，我处理不了这个异常给你来处理，如果上层也处理不了，就继续往上抛，或者捕获</p>
<h1 id="java中异常体系是怎么样的"><a href="#java中异常体系是怎么样的" class="headerlink" title="java中异常体系是怎么样的"></a>java中异常体系是怎么样的</h1><p>java中所有异常都来自于顶级父类 Throwable<br>Throwable下有两个子类Exceptio 和 erro<br>error属于重大错误：包括但不限于 虚拟机，磁盘，操作系统层面的问题<br>Exception属于普通编译器报错，其还分为运行时异常和编译时异常</p>
<h1 id="包装类型传参数的时候按照基本类型算，只传值，不传地址"><a href="#包装类型传参数的时候按照基本类型算，只传值，不传地址" class="headerlink" title="包装类型传参数的时候按照基本类型算，只传值，不传地址"></a>包装类型传参数的时候按照基本类型算，只传值，不传地址</h1><h1 id="java中的类加载机制"><a href="#java中的类加载机制" class="headerlink" title="java中的类加载机制"></a>java中的类加载机制</h1><p>jdk中自带了三个类加载器：</p>
<h2 id="BootStrap-ClassLoader"><a href="#BootStrap-ClassLoader" class="headerlink" title="BootStrap ClassLoader"></a>BootStrap ClassLoader</h2><p>BootStrap是Ext的父类加载器默认负责加载%JAVA_HOME%lib下面的lib和class</p>
<h2 id="Ext-ClassLoader"><a href="#Ext-ClassLoader" class="headerlink" title="Ext ClassLoader"></a>Ext ClassLoader</h2><p>Ext ClassLoader是AppClassLoader的父类，默认加载%JAVA_HOME%&#x2F;lib&#x2F;ext文件夹下的jar包和class</p>
<h2 id="AppClassLoader"><a href="#AppClassLoader" class="headerlink" title="AppClassLoader"></a>AppClassLoader</h2><p>AppClassLoader是自定义器的加载器的父类，负责加载classpath下的</p>
<h1 id="双亲委派机制"><a href="#双亲委派机制" class="headerlink" title="双亲委派机制"></a>双亲委派机制</h1><p>简单来说就是当问题从最下面的类加载器进入的时候会先让最上面的类加载器加载，然后逐级往下，最后才是自己定义的类加载器</p>
<h1 id="排查JVM问题"><a href="#排查JVM问题" class="headerlink" title="排查JVM问题"></a>排查JVM问题</h1><h2 id="对于还可以正常运行的系统"><a href="#对于还可以正常运行的系统" class="headerlink" title="对于还可以正常运行的系统"></a>对于还可以正常运行的系统</h2><ul>
<li>可以使用jmap来查看各个区域的情况</li>
<li>可以通过jstack来查看线程的运行情况，比如xxx线程阻塞；是不是死锁等</li>
<li>可以通过jstat命令查看垃圾回收的情况 ， 特别是fullgc若fullgc比较多就要考虑调优了</li>
<li>通过各个命令的结果，或者jvisualvm等工具进行分析</li>
<li>猜测fullgc多的原因：如果无内存溢出，那么表示fullgc是回收了很多对象，所以这些对象最好能在younggc过程中直接回收，避免进入老年代，对于这些情况就要考虑存活区间是不是比较小，导致年轻代放不下，直接到了老年代，尝试加大年轻代的区间若改完fullgc变小，则猜想正确</li>
</ul>
<h2 id="对于已发生了OOM的系统"><a href="#对于已发生了OOM的系统" class="headerlink" title="对于已发生了OOM的系统"></a>对于已发生了OOM的系统</h2><ul>
<li>一般生产中都会设置系统发生了OOM时，生成当时的dump文件（-xx:+HeapDumpOnOutOfMemoryError -xx:HHEapDump Path &#x3D; &#x2F;user&#x2F;local&#x2F;base)</li>
<li>我们可以用jsvisualvm等工具进行分析dump</li>
<li>根据dump找到异常实例和线程（占用cpu高），定位到具体代码。</li>
<li>之后再做细致的分析</li>
</ul>
<h1 id="一个对象从加载到jvm到被Gc清楚都经历了什么"><a href="#一个对象从加载到jvm到被Gc清楚都经历了什么" class="headerlink" title="一个对象从加载到jvm到被Gc清楚都经历了什么"></a>一个对象从加载到jvm到被Gc清楚都经历了什么</h1><ul>
<li>先把字节码文件内容加载到方法区</li>
<li>然后再根据类信息在堆区域创建对象</li>
<li>对象首先会分配在堆中年轻代的Eden区经过一次Minorc之后会进入Survivor区，在后续的每次MinorGC中若一直存活，则会在Suvivor区来回拷贝，每拷贝一次每移动一次年龄加1</li>
<li>当年龄过15，若对象仍存活，会进入老年态</li>
<li>若经过fullgc，被标记为垃圾对象，那么会被gc线程清楚</li>
</ul>
<h1 id="jvm有哪些垃圾回收算法"><a href="#jvm有哪些垃圾回收算法" class="headerlink" title="jvm有哪些垃圾回收算法"></a>jvm有哪些垃圾回收算法</h1><h2 id="标记清除法"><a href="#标记清除法" class="headerlink" title="标记清除法"></a>标记清除法</h2><ul>
<li>标记阶段：把垃圾内存标记出来</li>
<li>清除阶段：直接把垃圾内存回收</li>
<li>问题：会产生大量的内存碎片</li>
</ul>
<h2 id="复制算法"><a href="#复制算法" class="headerlink" title="复制算法"></a>复制算法</h2><ul>
<li>为了解决标记清除的内存碎片的问题</li>
<li>将内存分为两份，每次只使用其中一半，垃圾回收时将当前这一块的存活对象完全拷贝到另外一半，而后当前这一半可直接清除，这种无内存碎片，但是浪费空间，且放弃和存活对象的个数相关</li>
</ul>
<h2 id="标记压缩算法"><a href="#标记压缩算法" class="headerlink" title="标记压缩算法"></a>标记压缩算法</h2><ul>
<li>为了解决复制算法的缺陷，就提出了标记压缩算法，这种算法在标记阶段跟标记清除算法是一样的，但是在完成之后不是直接清理，而是将存活的对象往一端移动，而后面将边界以外的所有内存清除</li>
</ul>
<h1 id="什么是STW"><a href="#什么是STW" class="headerlink" title="什么是STW"></a>什么是STW</h1><p>Stw-stop-the-world,是在垃圾回收算法执行过程中要将JVM内存冻结的一种状态，在STW状态下，java的所有线程都是停止执行的——GC除外，native方法可执行；但是不能与jvm交互GC各种算法的优化的重点便是减少STW,是jvm调优的重点</p>
<h1 id="jvm参数"><a href="#jvm参数" class="headerlink" title="jvm参数"></a>jvm参数</h1><ul>
<li>标注指令：开头这个是所有Hotspot都支持的参数，可以用java-help</li>
<li>非标注指令:-x开头；与特定的hotspot对立的用java-x打印</li>
<li>不稳定参数：-xx开头，与上面一样</li>
</ul>
<h1 id="对守护线程的理解"><a href="#对守护线程的理解" class="headerlink" title="对守护线程的理解"></a>对守护线程的理解</h1><p>线程分为 守护线程和用户线程</p>
<h2 id="守护线程"><a href="#守护线程" class="headerlink" title="守护线程"></a>守护线程</h2><p>是jvm的后台线程，比如垃圾回收器，守护线程会在其他线程都停止之后自动关闭，我们可以通过设置thread.setDemon（true）来把一个线程设置成守护线程</p>
<h2 id="普通线程"><a href="#普通线程" class="headerlink" title="普通线程"></a>普通线程</h2><p>普通用户的线程</p>
<h1 id="ThreadLocal的底层原理"><a href="#ThreadLocal的底层原理" class="headerlink" title="ThreadLocal的底层原理"></a>ThreadLocal的底层原理</h1><p>其是java中所提供的线程本地存储机制，可利用该机制将数据存储到一个线程内部，该线程可在任意时刻，任意的方法，获取其存储的数据</p>
<ul>
<li>其底层是通过ThreadLocalMap来实现的，Map的key为ThreadLocal对象，Map的value为需要缓存的值</li>
<li>如果在线程池中使用ThreadLocal会造成内存泄露，因为当ThreadLoccal对象用完之后应该把设置的key value 也就是Entry的对象进行回收，但是线程池的线程不会进行回收，而线程对象是通过强引用指向ThreadLocalMap而ThreadLocalMap也是通过强引用的方法指向Entry的对象，线程也就不会被回收，从而出现内存泄露。</li>
</ul>
<h2 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h2><ul>
<li>在使用了ThreadLocal对象之后，手动调Thread Local的remove方法，手动清除Entry，其经典应用是用在连接管理上</li>
</ul>
<h1 id="并发-并行-穿行的区别"><a href="#并发-并行-穿行的区别" class="headerlink" title="并发,并行,穿行的区别"></a>并发,并行,穿行的区别</h1><ul>
<li>串行：一个任务执行完才可以执行下一个</li>
<li>并发：两个任务看起来是一起执行的，在底层，两个任务被拆成了很多份，从而后一个执行，但是在更高处看，两个任务是一起执行的</li>
<li>并行：两个可以一起执行</li>
</ul>
<h1 id="java死锁如何避免"><a href="#java死锁如何避免" class="headerlink" title="java死锁如何避免"></a>java死锁如何避免</h1><ul>
<li>一个资源每次只被一个线程调用</li>
<li>一个线程在阻塞资源的时候不释放已经占有的资源</li>
<li>一个线程已经获得的资源在使用之前不可被强行剥夺</li>
<li>若干个线程形成头尾相接的循环等待状</li>
</ul>
<h1 id="说一下HashMap的put方法"><a href="#说一下HashMap的put方法" class="headerlink" title="说一下HashMap的put方法"></a>说一下HashMap的put方法</h1><h2 id="大体流程"><a href="#大体流程" class="headerlink" title="大体流程"></a>大体流程</h2><ul>
<li>1.根据key通过哈希算法与与运算得出数组的下标</li>
<li>2.如果数组下标的元素为空 ， 则将key和value封装为entry对象（1.7中是Entry ， 1.8里是node对象）并放入该位置</li>
</ul>
<h2 id="如果数组下标不为空，分情况讨论"><a href="#如果数组下标不为空，分情况讨论" class="headerlink" title="如果数组下标不为空，分情况讨论"></a>如果数组下标不为空，分情况讨论</h2><h3 id="1-7jdk-1"><a href="#1-7jdk-1" class="headerlink" title="1.7jdk"></a>1.7jdk</h3><ul>
<li>要先判断是不是要扩容，如果不扩容就生成Entry对象，并且用头插法添加到当前位置的链表中</li>
</ul>
<h3 id="1-8jdk-1"><a href="#1-8jdk-1" class="headerlink" title="1.8jdk"></a>1.8jdk</h3><ul>
<li>会先判断当前位置上node的类型，看是红黑树node还是链表node</li>
<li>如果是红黑树node，则会将key和value封装为一个红黑树节点并添加到红黑树中去，这个过程中会判断是不是有当前key，如果存在则更新value</li>
<li>如果此位置是node对象是链表节点，则将key和value封装为一个链表node并通过尾插法插到链表最后去，因为是尾插法所以要遍历整个链表，在遍历链表的过程中会判断是不是存在当前的key如果存在就更新key，当遍历完链表后，将新node插入到链表中，插入链表1后会看到当前链表的节点个数，如果大于等于8就会把这个链表转化为红黑树</li>
<li>将key和value封装为node插入到链表或红黑树中再判断是不是需要扩容如果需要就扩容，不需要就结束put方法</li>
</ul>
<h1 id="线程池的底层工作原理"><a href="#线程池的底层工作原理" class="headerlink" title="线程池的底层工作原理"></a>线程池的底层工作原理</h1><ul>
<li>线程池内部是通过队列＋线程实现的，当我们用线程池执行任务的时候</li>
<li>如果此时线程池中的线程数量小于CorePoolSize，即使线程池中都处于空闲状态，也同样要创建新的线程来处理被添加的任务</li>
<li>如果此时线程池中的线程数量等于CorePoolSize, 但是缓存队列workQueue未满，且线程池中的数量小于maximumPoolsize</li>
</ul>
<h1 id="线程池为什么是先添加队列而不是先创建最大线程"><a href="#线程池为什么是先添加队列而不是先创建最大线程" class="headerlink" title="线程池为什么是先添加队列而不是先创建最大线程"></a>线程池为什么是先添加队列而不是先创建最大线程</h1><p>当线程池中的核心线程在忙时如果继续往线程池中添加任务，那么任务还会放入队列，队列满了之后，才会开始新的线程，这就相当于，一个公司本来有10个程序员，本来这10个程序员能正常处理各种需求，但是随着公司的发展，需求在慢慢增加，但是一开始这些需求只会增加在待开发列表中，然后这10个程序员加班加点的从待开发列表中获取需求并进行处理，但是某一天待开发列表满了，所以员工处理不过来了，所以就开始招募新员工了。</p>
<h1 id="ReentrantLock中的公平锁和非公平锁的底层实现"><a href="#ReentrantLock中的公平锁和非公平锁的底层实现" class="headerlink" title="ReentrantLock中的公平锁和非公平锁的底层实现"></a>ReentrantLock中的公平锁和非公平锁的底层实现</h1><p>首先不管是公平锁还是非公平锁他们的底层都是通过AQS来实现排队的，他们的区别在于：线程使用lock（）方法加锁的时候，如果是公平锁，会先检查AQS队列中是不是存在线程在排队，如果存在，则当前线程也会进行排队，如果是非公平锁，则不会去检查是不是有线程在排队，而是直接竞争锁，不管是公平锁还是非公平锁，一旦没竞争到锁，就会进行排队，当锁释放的时候都是唤醒最前面的线程，所以非公平锁只是体现在了线程加锁的阶段，而没有体现在线程被唤醒的阶段。</p>
<h1 id="ReentrantLock中tryLock-和lock（）方法的区别"><a href="#ReentrantLock中tryLock-和lock（）方法的区别" class="headerlink" title="ReentrantLock中tryLock()和lock（）方法的区别"></a>ReentrantLock中tryLock()和lock（）方法的区别</h1><ul>
<li>tryLock()表示尝试加锁，可能加到，也可能加不到，该方法不会阻止线程，如果加到锁就返回true，没有加到则返回false</li>
<li>lock（）则表示线程阻塞加锁，线程会阻塞直到加上锁，而且也没有返回值</li>
</ul>
<h1 id="CountDownLatch和Semaphore的区别和底层原理"><a href="#CountDownLatch和Semaphore的区别和底层原理" class="headerlink" title="CountDownLatch和Semaphore的区别和底层原理"></a>CountDownLatch和Semaphore的区别和底层原理</h1><ul>
<li>CountDownLatch表示计数器，可以给CountDownLatch设置一个数字，一个线程调用CountDownLatch的await（）将会被阻塞，其他线程可以调用CountDownlatch的countDown（）方法来对CountDownLacth中的数字减一，当一个数字被减为0之后则会将AQS中排队的线程依次唤醒</li>
<li>Semaphore表示信号量，可以设置许可的个数，表示同时允许最多多少个线程使用该信号量，通过acquire来获取许可，如果没有许可可用则用线程阻塞，并通过ASQ来排队，可以通过release的方法释放许可当某一个线程释放死锁之后会从ASQ的第一个线程开始依次唤醒，直到没有空闲许可</li>
</ul>
<h1 id="Sychronized"><a href="#Sychronized" class="headerlink" title="Sychronized"></a>Sychronized</h1><ul>
<li>偏向锁： 在锁对象的对象头中记录下当前获取到该锁的线程id，该线程下次如果又来获取该锁就可以直接获取到了</li>
<li>轻量级锁：由偏向锁升级而来，当一个线程获取到锁之后，此时这把锁是偏向锁，此时如果由第二个线程来竞争这个锁，偏向锁就会升级为轻量级锁，之所以叫轻量级锁是为了和重量级锁分开，轻量级锁底层是通过自旋来实现的，并不会阻塞线程。</li>
<li>如果自旋次数过多扔无法获取锁，则会升级为重量级锁，重量级锁会导致线程阻塞</li>
<li>自旋锁：自旋锁就是在线程获取锁的过程中，不回去阻塞线程，也就无所谓唤醒线程，阻塞和唤醒这两个步骤都是要操作系统中去实现的，比较耗费时间，自旋锁是线程通过CAS获取预期的一个标记，如果没有获取到，则继续循环获取去过获取到，则表式获取到了锁，这个过程线程一直在运行，相对而言没有使用太多的操作系统资源，比较轻量</li>
</ul>
<h1 id="Sychronized和ReentrantLock的区别"><a href="#Sychronized和ReentrantLock的区别" class="headerlink" title="Sychronized和ReentrantLock的区别"></a>Sychronized和ReentrantLock的区别</h1><ul>
<li>前一个是关键字，后一个是一个类</li>
<li>前一个会自动加锁和释放锁，后面一个需要手动加锁和个释放锁</li>
<li>前一个底层是jvm层面 ， 后面一个底层是api层面</li>
<li>前一个是非公平锁 ， 后面一个是可以选非公平或者公平</li>
<li>前一个锁的是对象所信息保存在对象头中，后面一个是通过代码中int型的state标识符状态</li>
<li>前一个底层有个锁升级的过程</li>
</ul>
<h1 id="谈谈你对AQS的理解，AQS如何实现可重入锁"><a href="#谈谈你对AQS的理解，AQS如何实现可重入锁" class="headerlink" title="谈谈你对AQS的理解，AQS如何实现可重入锁"></a>谈谈你对AQS的理解，AQS如何实现可重入锁</h1><ul>
<li>AQS是一个java线程同步的框架，是jdk中很多锁的工具核心框架</li>
<li>在AQS中，维护了信号量state和一个线程的双向链表队列，其中这个线程队列，就是用来给线程排队的而state就像是个红绿灯，用来控制排队</li>
<li>在不同的场景下，有不同的意义</li>
<li>在可重入锁这个场景下state用来保证加锁的次数，0表示标识无锁，每次加锁，states就加1，释放就减少1</li>
</ul>
<h1 id="谈谈你对IOC的理解"><a href="#谈谈你对IOC的理解" class="headerlink" title="谈谈你对IOC的理解"></a>谈谈你对IOC的理解</h1><ul>
<li>通常我们任务spring有两大特性IoC和AOP</li>
<li>IoC进行了对象的反转，就是对象控制权的转移</li>
</ul>
<h1 id="单例和Bean"><a href="#单例和Bean" class="headerlink" title="单例和Bean"></a>单例和Bean</h1><ul>
<li>单例表示这个类只能实例化一次</li>
<li>而bean并不表示jvm里只存在一个类的Bean</li>
</ul>
<h1 id="Spring的事务传播机制"><a href="#Spring的事务传播机制" class="headerlink" title="Spring的事务传播机制"></a>Spring的事务传播机制</h1><ul>
<li>多个事务方法互相调用的时候，事务是如何在这些方法之间传播的</li>
<li>REQUIRED（默认的传播机制）：如果没有事务，就自己创建一个新的事务，如果存在事务，就加入</li>
<li>SUPPIORTS：当前存在事务，则加入，如果不存在就按照不存在的来</li>
<li>MANDATORY：当前存在事务则加入，不存在则抛出异常</li>
<li>REQUIRES_NEW：创建一个新事务，如果存在这个事务，就挂起他</li>
<li>NOT_SUPPORTED:用非事务的方式执行，如果当前存在事务，则挂起事务</li>
<li>NEVER：不使用事务如果事务存在，则会抛出异常</li>
<li>NESTED：如果当前事务存在，则在嵌套事务中执行要不然就和REQUIRED一样</li>
</ul>
<h1 id="线程和协程的区别"><a href="#线程和协程的区别" class="headerlink" title="线程和协程的区别"></a>线程和协程的区别</h1><ul>
<li>线程与协程的区别：</li>
<li>1：包含关系：一个进程可以有多个协程，一个线程也可以有多个协程</li>
<li>2：同步：线程进程是同步，协程是异步</li>
<li>3：协程能保留上一次重入的状态，当程序重新调用时，可以直接进入上一次的调用的位置</li>
<li>4：资源占用：线程是抢占式，协程是非抢占式，也就是会所在同一时间只能有一个协程运行，相当于单线程</li>
<li>5：与线程调用关系：协程并不能代替线程，线程是分割的CPU资源，协程是执行的代码，协程并不会直接调用线程，它会调用线程的执行器</li>
</ul>
<h1 id="myysql的索引以及他们的好处和坏处"><a href="#myysql的索引以及他们的好处和坏处" class="headerlink" title="myysql的索引以及他们的好处和坏处"></a>myysql的索引以及他们的好处和坏处</h1><ul>
<li>优点： 1.大大加快数据的检索速度</li>
<li>2.通过使用索引，可以在查询的过程中使用优化隐藏器，提高系统的性能</li>
<li>缺点： 1.时间方面：创建索引和维护索引要耗费时间，索引需要动态的维护</li>
<li>2.空间方面：需要占物理空间</li>
</ul>
<h1 id="多线程"><a href="#多线程" class="headerlink" title="多线程"></a>多线程</h1><ul>
<li>现代操作系统中，进程是分配资源的最小单位，运行一个程序，就创建一个进程，一个进程里可以包括多个线程，线程是系统调度的基本单位， 每个线程里都拥有各自的程序计数器，堆栈，局部变量表等属性，并且共享进程里面的资源，处理器在这些线程之间高速切换，使使用者误以为这些线程是同时执行的。</li>
<li>对于最简单的输出hello world程序，就包括四个线程， main，清除reference的线程，和finalize方法有关的线程，处理jvm信号的线程，</li>
<li>之所以使用多线程是因为多线程有个好处</li>
<li>1.现代计算机是多核处理器，而一个线程同一时刻只能运行在一个处理器上，对于单线程程序，同一时刻只能使用一个处理器，显然这是一种资源浪费， 而对于多线程程序，可以把计算逻辑分配给不同的处理器，极大的提高的程序的执行效率</li>
<li>2.可以把复杂的业务逻辑种的对数据一致性要求不强的操作，比如生成订单快照分配给其他的线程去处理（也可以使用消息队列），极大的提高了程序的响应时间</li>
<li>3.java提供了一个良好的多线程模型，能是开发者专注于业务的开发</li>
</ul>
<h1 id="怎么保证线程安全"><a href="#怎么保证线程安全" class="headerlink" title="怎么保证线程安全"></a>怎么保证线程安全</h1><ul>
<li>Java保证线程安全的方式有很多,其中较为常用的有三种,按照资源占用情况由轻到重排列,这三种保证线程安全的方式分别是原子类、volatile、锁。</li>
<li>JDK从1.5开始提供了java.util.concurrent.atomic包,这个包中的原子操作类提供了一种用法简单、性能高效、线程安全地更新一个变量的方式。</li>
<li>在atomic包里一共提供了17个类,按功能可以归纳为4种类型的原子更新方式,分别是原子更新基本类型、原子更新引用类型、原子更新属性、原子更新数组。</li>
<li>无论原子更新哪种类型,都要遵循“比较和替换”规则,即比较要更新的值是否等于期望值,如果是则更新,如果不是则失败。</li>
<li>volatile是轻量级的synchronized,它在多处理器开发中保证了共享变量的“可见性”,从而可以保证单个变量读写时的线程安全。</li>
<li>可见性问题是由处理器核心的缓存导致的,每个核心均有各自的缓存,而这些缓存均要与内存进行同步。</li>
<li>volatile具有如下的内存语义：当写一个volatile变量时,该线程本地内存中的共享变量的值会被立刻刷新到主内存；当读一个volatile变量时,该线程本地内存会被置为无效,迫使线程直接从主内存中读取共享变量。</li>
<li>原子类和volatile只能保证单个共享变量的线程安全,锁则可以保证临界区内的多个共享变量的线程安全,Java中加锁的方式有两种,分别是synchronized关键字和Lock接口。</li>
<li>synchronized是比较早期的API,在设计之初没有考虑到超时机制、非阻塞形式,以及多个条件变量。</li>
<li>若想通过升级的方式让它支持这些相对复杂的功能,则需要大改它的语法结构,不利于兼容旧代码。</li>
<li>因此,JDK的开发团队在1.5新增了Lock接口,并通过Lock支持了上述的功能,即：支持响应中断、支持超时机制、支持以非阻塞的方式获取锁、支持多个条件变量（阻塞队列）。</li>
<li>加分回答 实现线程安全的方式有很多,除了上述三种方式之外,还有如下几种方式：</li>
<li><ol>
<li>无状态设计 线程安全问题是由多线程并发修改共享变量引起的,如果在并发环境中没有设计共享变量,则自然就不会出现线程安全问题了。这种代码实现可以称作“无状态实现”,所谓状态就是指共享变量。</li>
</ol>
</li>
<li><ol start="2">
<li>不可变设计 如果在并发环境中不得不设计共享变量,则应该优先考虑共享变量是否为只读的,如果是只读场景就可以将共享变量设计为不可变的,这样自然也不会出现线程安全问题了。具体来说,就是在变量前加final修饰符,使其不可被修改,如果变量是引用类型,则将其设计为不可变类型（参考String类）。</li>
</ol>
</li>
<li><ol start="3">
<li>并发工具 java.util.concurrent包提供了几个有用的并发工具类,一样可以保证线程安全：</li>
</ol>
</li>
<li>Semaphore：就是信号量,可以控制同时访问特定资源的线程数量。</li>
<li>CountDownLatch：允许一个或多个线程等待其他线程完成操作。</li>
<li>CyclicBarrier：让一组线程到达一个屏障时被阻塞,直到最后一个线程到达屏障时,屏障才会打开,所有被屏障拦截的线程才会继续运行。</li>
<li><ol start="4">
<li>本地存储 我们也可以考虑使用ThreadLocal存储变量,ThreadLocal可以很方便地为每一个线程单独存一份数据,也就是将需要并发访问的资源复制成多份。这样一来,就可以避免多线程访问共享变量了,它们访问的是自己独占的资源,它从根本上隔离了多个线程之间的数据共享。</li>
</ol>
</li>
</ul>
<h1 id="死锁"><a href="#死锁" class="headerlink" title="死锁"></a>死锁</h1><ul>
<li><ol>
<li>死锁 两个或两个以上的进程在执行过程中,因争夺共享资源而造成的一种互相等待的现象,若无外力作用,它们都将无法推进下去。此时称系统处于死锁状态或系统产生了死锁。这些永远在互相等待的进程称为死锁进程。</li>
</ol>
</li>
<li><ol start="2">
<li>产生死锁的必要条件 虽然进程在运行过程中,可能发生死锁,但死锁的发生也必须具备一定的条件,死锁的发生必须具备以下四个必要条件：</li>
</ol>
</li>
<li><ul>
<li>互斥条件：指进程对所分配到的资源进行排它性使用,即在一段时间内某资源只由一个进程占用。如果此时还有其它进程请求资源,则请求者只能等待,直至占有资源的进程用毕释放；</li>
</ul>
</li>
<li><ul>
<li>请求和保持条件：指进程已经保持至少一个资源,但又提出了新的资源请求,而该资源已被其它进程占有,此时请求进程阻塞,但又对自己已获得的其它资源保持不放；</li>
</ul>
</li>
<li><ul>
<li>不剥夺条件：指进程已获得的资源,在未使用完之前,不能被剥夺,只能在使用完时由自己释放；</li>
</ul>
</li>
<li><ul>
<li>环路等待条件：指在发生死锁时,必然存在一个进程——资源的环形链,即进程集合 {P0,P1,P2,···,Pn} 中的 P0 正在等待一个 P1 占用的资源；P1 正在等待 P2 占用的资源,……,Pn 正在等待已被 P0 占用的资源。</li>
</ul>
</li>
</ul>
<h1 id="进程间的通信方式"><a href="#进程间的通信方式" class="headerlink" title="进程间的通信方式"></a>进程间的通信方式</h1><ul>
<li>进程间通信主要包括：管道、命名管道、信号、消息队列、共享内存、内存映射、信号量、Socket：</li>
<li><ol>
<li>管道 管道也叫无名（匿名）管道,它是是 UNIX 系统 IPC（进程间通信）的最古老形式,所有的 UNIX 系统都支持这种通信机制。管道本质其实是内核中维护的一块内存缓冲区,Linux 系统中通过 pipe() 函数创建管道,会生成两个文件描述符,分别对应管道的读端和写端。无名管道只能用于具有亲缘关系的进程间的通信。</li>
</ol>
</li>
<li><ol start="2">
<li>命名管道 匿名管道,由于没有名字,只能用于亲缘关系的进程间通信。为了克服这个缺点,提出了有名管道（FIFO）,也叫命名管道、FIFO文件。有名管道（FIFO）不同于匿名管道之处在于它提供了一个路径名与之关联,以 FIFO 的文件形式存在于文件系统中,并且其打开方式与打开一个普通文件是一样的,这样即使与 FIFO 的创建进程不存在亲缘关系的进程,只要可以访问该路径,就能够彼此通过 FIFO 相互通信,因此,通过 FIFO 不相关的进程也能交换数据。</li>
</ol>
</li>
<li><ol start="3">
<li>信号 信号是 Linux 进程间通信的最古老的方式之一,是事件发生时对进程的通知机制,有时也称之为软件中断,它是在软件层次上对中断机制的一种模拟,是一种异步通信的方式。信号可以导致一个正在运行的进程被另一个正在运行的异步进程中断,转而处理某一个突发事件。</li>
</ol>
</li>
<li><ol start="4">
<li>消息队列 消息队列就是一个消息的链表,可以把消息看作一个记录,具有特定的格式以及特定的优先级,对消息队列有写权限的进程可以向消息队列中按照一定的规则添加新消息,对消息队列有读权限的进程则可以从消息队列中读走消息,消息队列是随内核持续的。</li>
</ol>
</li>
<li><ol start="5">
<li>共享内存 共享内存允许两个或者多个进程共享物理内存的同一块区域（通常被称为段）。由于一个共享内存段会称为一个进程用户空间的一部分,因此这种 IPC 机制无需内核介入。所有需要做的就是让一个进程将数据复制进共享内存中,并且这部分数据会对其他所有共享同一个段的进程可用。与管道等要求发送进程将数据从用户空间的缓冲区复制进内核内存和接收进程将数据从内核内存复制进用户空间的缓冲区的做法相比,这种 IPC 技术的速度更快。</li>
</ol>
</li>
<li><ol start="6">
<li>内存映射 内存映射（Memory-mapped I&#x2F;O）是将磁盘文件的数据映射到内存,用户通过修改内存就能修改磁盘文件。</li>
</ol>
</li>
<li><ol start="7">
<li>信号量 信号量主要用来解决进程和线程间并发执行时的同步问题,进程同步是并发进程为了完成共同任务采用某个条件来协调它们的活动。对信号量的操作分为 P 操作和 V 操作,P 操作是将信号量的值减 1,V 操作是将信号量的值加 1。当信号量的值小于等于 0 之后,再进行 P 操作时,当前进程或线程会被阻塞,直到另一个进程或线程执行了 V 操作将信号量的值增加到大于 0 之时。</li>
</ol>
</li>
<li><ol start="8">
<li>Socket 套接字（Socket）,就是对网络中不同主机上的应用进程之间进行双向通信的端点的抽象。一个套接字就是网络上进程通信的一端,提供了应用层进程利用网络协议交换数据的机制。Socket 一般用于网络中不同主机上的进程之间的通信。</li>
</ol>
</li>
</ul>
<h1 id="MVC模式"><a href="#MVC模式" class="headerlink" title="MVC模式"></a>MVC模式</h1><ul>
<li>MVC是一种设计模式,在这种模式下软件被分为三层,即Model（模型）、View（视图）、Controller（控制器）。</li>
<li>Model代表的是数据,View代表的是用户界面,Controller代表的是数据的处理逻辑,它是Model和View这两层的桥梁。</li>
<li>将软件分层的好处是,可以将对象之间的耦合度降低,便于代码的维护。</li>
<li>Model：指从现实世界中抽象出来的对象模型,是应用逻辑的反应；它封装了数据和对数据的操作,是实际进行数据处理的地方（模型层与数据库才有交互）。</li>
<li>在MVC的三个部件中,模型拥有最多的处理任务。被模型返回的数据是中立的,模型与数据格式无关,这样一个模型能为多个视图提供数据,由于应用于模型的代码只需写一次就可以被多个视图重用,所以减少了代码的重复性。</li>
<li>View：负责进行模型的展示,一般就是我们见到的用户界面。</li>
<li>Controller：控制器负责视图和模型之间的交互,控制对用户输入的响应、响应方式和流程；它主要负责两方面的动作,一是把用户的请求分发到相应的模型,二是吧模型的改变及时地反映到视图上。</li>
<li>加分回答 为了解耦以及提升代码的可维护性,服务端开发一般会对代码进行分层,服务端代码一般会分为三层：表现层、业务层、数据访问层。在浏览器访问服务器时,请求会先到达表现层 最典型的MVC就是jsp+servlet+javabean模式。</li>
<li>以JavaBean作为模型,既可以作为数据模型来封装业务数据,又可以作为业务逻辑模型来包含应用的业务操作。 JSP作为视图层,负责提供页面为用户展示数据,提供相应的表单（Form）来用于用户的请求,并在适当的时候（点击按钮）向控制器发出请求来请求模型进行更新。</li>
<li>Serlvet作为控制器,用来接收用户提交的请求,然后获取请求中的数据,将之转换为业务模型需要的数据模型,然后调用业务模型相应的业务方法进行更新,同时根据业务执行结果来选择要返回的视图。 当然,这种方式现在已经不那么流行了,</li>
<li>Spring MVC框架已经成为了MVC模式的最主流实现。</li>
<li>Spring MVC框架是基于Java的实现了MVC框架模式的请求驱动类型的轻量级框架。前端控制器是DispatcherServlet接口实现类,映射处理器是HandlerMapping接口实现类,视图解析器是ViewResolver接口实现类,页面控制器是Controller接口实现类</li>
</ul>
<h1 id="redis的数据类型"><a href="#redis的数据类型" class="headerlink" title="redis的数据类型"></a>redis的数据类型</h1><ul>
<li>Redis主要提供了5种数据结构：字符串(string)、哈希(hash)、列表(list)、集合(set)、有序集合(zset)。Redis还提供了Bitmap、HyperLogLog、Geo类型,但这些类型都是基于上述核心数据类型实现的。</li>
<li>5.0版本中,Redis新增加了Streams数据类型,它是一个功能强大的、支持多播的、可持久化的消息队列。</li>
<li>string可以存储字符串、数字和二进制数据,除了值可以是String以外,所有的键也可以是string,string最大可以存储大小为2M的数据。</li>
<li>list保证数据线性有序且元素可重复,它支持lpush、blpush、rpop、brpop等操作,可以当作简单的消息队列使用,一个list最多可以存储2^32-1个元素 hash的值本身也是一个键值对结构,最多能存储2^32-1个元素</li>
<li>set是无序不可重复的,它支持多个set求交集、并集、差集,适合实现共同关注之类的需求,一个set最多可以存储2^32-1个元素 zset是有序不可重复的,它通过给每个元素设置一个分数来作为排序的依据,一个zset最多可以存储2^32-1个元素。</li>
<li>加分回答 每种类型支持多个编码,每一种编码采取一个特殊的结构来实现 各类数据结构内部的编码及结构：</li>
<li>string：编码分为int、raw、embstr；</li>
<li>int底层实现为long,当数据为整数型并且可以用long类型表示时可以用long存储；</li>
<li>embstr底层实现为占一块内存的SDS结构,当数据为长度不超过32字节的字符串时,选择以此结构连续存储元数据和值；</li>
<li>raw底层实现为占两块内存的SDS,用于存储长度超过32字节的字符串数据,此时会在两块内存中分别存储元数据和值。</li>
<li>list：编码分为ziplist、linkedlist和quicklist（3.2以前版本没有quicklist）。</li>
<li>ziplist底层实现为压缩列表,当元素数量小于2且所有元素长度都小于64字节时,使用这种结构来存储；</li>
<li>linkedlist底层实现为双端链表,当数据不符合ziplist条件时,使用这种结构存储；</li>
<li>3.2版本之后list一般采用quicklist的快速列表结构来代替前两种。</li>
<li>hash：编码分为ziplist、hashtable两种,</li>
<li>其中ziplist底层实现为压缩列表,当键值对数量小于2,并且所有的键值长度都小于64字节时使用这种结构进行存储；</li>
<li>hashtable底层实现为字典,当不符合压缩列表存储条件时,使用字典进行存储。</li>
<li>set：编码分为inset和hashtable,intset底层实现为整数集合,当所有元素都是整数值且数量不超过2个时使用该结构存储,否则使用字典结构存储。</li>
<li>zset：编码分为ziplist和skiplist,当元素数量小于128,并且每个元素长度都小于64字节时,使用ziplist压缩列表结构存储,否则使用skiplist的字典+跳表的结构存储。</li>
</ul>
<h1 id="乐观锁和悲观锁"><a href="#乐观锁和悲观锁" class="headerlink" title="乐观锁和悲观锁"></a>乐观锁和悲观锁</h1><ul>
<li>乐观锁：乐观锁总是假设最好的情况,每次去拿数据的时候都认为别人不会修改,所以不会上锁,但是在更新的时候会判断一下在此期间别人有没有去更新这个数据,可以使用版本号机制和CAS算法实现。乐观锁适用于多读的应用类型,这样可以提高吞吐量**,像数据库提供的类似于write_condition机制,其实都是提供的乐观锁。</li>
<li>悲观锁：悲观锁总是假设最坏的情况,每次去拿数据的时候都认为别人会修改,所以每次在拿数据的时候都会上锁,这样别人想拿这个数据就会阻塞直到它拿到锁（共享资源每次只给一个线程使用,其它线程阻塞,用完后再把资源转让给其它线程）。传统的关系型数据库里边就用到了很多这种锁机制,比如行锁,表锁等,读锁,写锁等,都是在做操作之前先上锁。 加分回答 两种锁的使用场景 乐观锁： GIT,SVN,CVS等代码版本控制管理器,就是一个乐观锁使用很好的场景,</li>
<li>例如：A、B程序员,同时从SVN服务器上下载了code.html文件,当A完成提交后,此时B再提交,那么会报版本冲突,此时需要B进行版本处理合并后,再提交到服务器。这其实就是乐观锁的实现全过程。如果此时使用的是悲观锁,那么意味者所有程序员都必须一个一个等待操作提交完,才能访问文件,这是难以接受的。 悲观锁： 悲观锁的好处在于可以减少并发,但是当并发量非常大的时候,由于锁消耗资源、锁定时间过长等原因,很容易导致系统性能下降,资源消耗严重。因此一般我们可以在并发量不是很大,并且出现并发情况导致的异常用户和系统都很难以接受的情况下,会选择悲观锁进行。</li>
</ul>
<h1 id="设计模式"><a href="#设计模式" class="headerlink" title="设计模式"></a>设计模式</h1><ul>
<li>创建型包括：单例模式、工厂方法模式、抽象工厂模式、建造者模式和原型模式；</li>
<li>结构型包括：代理模式、装饰模式、适配器模式、组合模式、桥梁模式、外观模式和享元模式；</li>
<li>行为型包括：模板方法模式、命令模式、责任链模式、策略模式、迭代器模式、中介者模式、观察者模式、备忘录模式、访问者模式、状态模式和解释器模式。 面试中不要求23种设计模式全部了解,但至少应掌握单例模式和工厂模式。 加分回答 可以说出知道的框架所用到的设计模式或底层设计模式,例如Spring中的单例模式、工厂模式,AQS的模板模式等等。</li>
</ul>

      
    </div>

    
    
    

      
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://zihang.fun/2001/02/21/2-21/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="liu zihang">
      <meta itemprop="description" content="只有努力不会辜负你">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="枫叶冢">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2001/02/21/2-21/" class="post-title-link" itemprop="url">mysqlbinlog</a>
        </h2>

        <div class="post-meta">
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2001-02-21 00:00:00" itemprop="dateCreated datePublished" datetime="2001-02-21T00:00:00+08:00">2001-02-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-02-21 18:50:25" itemprop="dateModified" datetime="2023-02-21T18:50:25+08:00">2023-02-21</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%97%A5%E5%BF%97/" itemprop="url" rel="index"><span itemprop="name">日志</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>2.6k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>2 分钟</span>
            </span>

        </div>
      </header>

    
    
    

   

    <div class="post-body" itemprop="articleBody">

      
          <h1 id="bionlog"><a href="#bionlog" class="headerlink" title="bionlog"></a>bionlog</h1><p>mysql的binlog：它记录了所有的DDL和DML语句（除了数据查询语句select）,以事件形式记录，还包含语句所执行的消耗的时间，MySQL的二进制日志是事务安全型的。</p>
<p>mysqlbinlog常见的选项有一下几个：</p>
<ul>
<li>–start-datetime：从二进制日志中读取指定等于时间戳或者晚于本地计算机的时间</li>
<li>–stop-datetime：从二进制日志中读取指定小于时间戳或者等于本地计算机的时间 取值和上述一样</li>
<li>–start-position：从二进制日志中读取指定position 事件位置作为开始。</li>
<li>–stop-position：从二进制日志中读取指定position 事件位置作为事件截至</li>
</ul>
<p>binlog日志有两个最重要的使用场景:</p>
<ul>
<li>mysql主从复制：mysql replication在master端开启binlog,master把它的二进制日志传递给slaves来达到master-slave数据一致的目的。</li>
<li>数据恢复：通过mysqlbinlog工具来恢复数据。</li>
</ul>
<p>binlog日志包括两类文件</p>
<ul>
<li>二进制日志索引文件(文件名后缀为.index)用于记录所有的二进制文件。</li>
<li>二进制日志文件(文件名后缀为.00000*)记录数据库所有的DDL和DML(除了数据查询语句select)语句事件。</li>
</ul>
<h1 id="开启binlog日志"><a href="#开启binlog日志" class="headerlink" title="开启binlog日志"></a>开启binlog日志</h1><p>打开mysql的配置文件一般是在 <code>/etc/my.cof</code></p>
<p>然后编辑，在mysqld区块加上 -&gt;</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">binlog_format</span>           = MIXED                 //binlog日志格式</span><br><span class="line"><span class="attr">log_bin</span>                     =目录/mysql-bin.log    //binlog日志名</span><br><span class="line"><span class="attr">expire_logs_days</span>     = <span class="number">7</span>                //binlog过期清理时间</span><br><span class="line"><span class="attr">max_binlog_size</span>     = <span class="number">100</span>m                    //binlog每个日志文件大小　　　　log-bin=mysql-bin(也可指定二进制日志生成的路径，如：log-bin=/opt/Data/mysql-bin)</span><br><span class="line"><span class="attr">server-id</span> = <span class="number">1</span></span><br><span class="line">　　　　<span class="attr">server-id</span>=<span class="number">1</span></span><br><span class="line"></span><br><span class="line">　　　　<span class="attr">binlog_format</span>=MIXED(加入此参数才能记录到insert语句)</span><br></pre></td></tr></table></figure>

<p>这里的binlog的格式有三种</p>
<ul>
<li>Statement：每一条会修改数据的sql都会记录在binlog中。</li>
</ul>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">优点：不需要记录每一行的变化，减少了binlog日志量，节约了IO，提高性能。(相比<span class="keyword">row</span>能节约多少性能与日志量，这个取决于应用的<span class="keyword">SQL</span>情况，正常同一条记录修改或者插入<span class="keyword">row</span>格式所产生的日志量还小于<span class="keyword">Statement</span>产生的日志量，但是考虑到如果带条件的<span class="keyword">update</span>操作，以及整表删除，<span class="keyword">alter</span>表等操作，<span class="keyword">ROW</span>格式会产生大量日志，因此在考虑是否使用<span class="keyword">ROW</span>格式日志时应该跟据应用的实际情况，其所产生的日志量会增加多少，以及带来的IO性能问题。)</span><br><span class="line"></span><br><span class="line">缺点：由于记录的只是执行语句，为了这些语句能在slave上正确运行，因此还必须记录每条语句在执行的时候的一些相关信息，以保证所有语句能在slave得到和在master端执行时候相同的结果。另外mysql 的复制,像一些特定函数功能，slave可与master上要保持一致会有很多相关问题(如sleep()函数， last_insert_id()，以及<span class="keyword">user</span>-defined <span class="keyword">functions</span>(udf)会出现问题).</span><br></pre></td></tr></table></figure>

<ul>
<li>Row:不记录sql语句上下文相关信息，仅保存哪条记录被修改。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">优点： binlog中可以不记录执行的<span class="keyword">sql</span>语句的上下文相关的信息，仅需要记录那一条记录被修改成什么了。所以rowlevel的日志内容会非常清楚的记录下每一行数据修改的细节。而且不会出现某些特定情况下的存储过程，或<span class="keyword">function</span>，以及<span class="keyword">trigger</span>的调用和触发无法被正确复制的问题</span><br><span class="line"></span><br><span class="line">缺点:所有的执行的语句当记录到日志中的时候，都将以每行记录的修改来记录，这样可能会产生大量的日志内容,比如一条<span class="keyword">update</span>语句，修改多条记录，则binlog中每一条修改都会有记录，这样造成binlog日志量会很大，特别是当执行<span class="keyword">alter</span> <span class="keyword">table</span>之类的语句的时候，由于表结构修改，每条记录都发生改变，那么该表每一条记录都会记录到日志中。</span><br></pre></td></tr></table></figure>

<ul>
<li>Mixedlevel:</li>
</ul>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.Mixedlevel: 是以上两种<span class="keyword">level</span>的混合使用，一般的语句修改使用statment格式保存binlog，如一些函数，<span class="keyword">statement</span>无法完成主从复制的操作，则采用<span class="keyword">row</span>格式保存binlog,MySQL会根据执行的每一条具体的<span class="keyword">sql</span>语句来区分对待记录的日志形式，也就是在<span class="keyword">Statement</span>和<span class="keyword">Row</span>之间选择一种.新版本的MySQL中队<span class="keyword">row</span> <span class="keyword">level</span>模式也被做了优化，并不是所有的修改都会以<span class="keyword">row</span> <span class="keyword">level</span>来记录，像遇到表结构变更的时候就会以<span class="keyword">statement</span>模式来记录。至于<span class="keyword">update</span>或者<span class="keyword">delete</span>等修改数据的语句，还是会记录所有行的变更。</span><br></pre></td></tr></table></figure>

<h2 id="binlog日志的选择"><a href="#binlog日志的选择" class="headerlink" title="binlog日志的选择"></a>binlog日志的选择</h2><p>Mysql默认是使用Statement日志格式，推荐使用MIXED.</p>
<p>由于一些特殊使用，可以考虑使用ROWED，如自己通过binlog日志来同步数据的修改，这样会节省很多相关操作。对于binlog数据处理会变得非常轻松,相对mixed，解析也会很轻松(当然前提是增加的日志量所带来的IO开销在容忍的范围内即可)。</p>
<h2 id="续讲mysql"><a href="#续讲mysql" class="headerlink" title="续讲mysql"></a>续讲mysql</h2><p>查看binlog日志是不是开启</p>
<p><code>mysql&gt; show variables like &#39;log_%&#39;; </code></p>
<h2 id="常用的binlog日志操作命令"><a href="#常用的binlog日志操作命令" class="headerlink" title="常用的binlog日志操作命令"></a>常用的binlog日志操作命令</h2><p>查看所有binlog日志列表：<br><code>show master logs;</code></p>
<p>查看master状态，即最后（最新）一个binlog日志的编号名称，及其最后一个操作事件pos结束点(Position)值。</p>
<p><code>show master status;</code></p>
<p>flush 刷新log日志，自此刻开始产生一个新编号的binlog日志文件;</p>
<p><code>flush logs;</code></p>
<p>注意：每当mysqld服务重启时，会自动执行此命令，刷新binlog日志；在mysqlddump备份数据时加-F选项也会刷新binlog日志；</p>
<p>重置（清空）所有binlog日志</p>
<p><code>reset master;</code></p>
<h1 id="查看binlog日志"><a href="#查看binlog日志" class="headerlink" title="查看binlog日志"></a>查看binlog日志</h1><p>binlog是二进制文件，普通文件查看器cat、more、vim等都无法打开，必须使用自带的mysqlbinlog命令查看。</p>
<p>binlog日志与数据库文件在同目录中。</p>
<p>在Mysql5.5以下版本使用mysqlbinlog命令时如果报错，就加上”–no-defaults”选项</p>
<p>使用的就是上面的，命令</p>

      
    </div>

    
    
    

      
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://zihang.fun/2001/02/19/2-19/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="liu zihang">
      <meta itemprop="description" content="只有努力不会辜负你">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="枫叶冢">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2001/02/19/2-19/" class="post-title-link" itemprop="url">hbase</a>
        </h2>

        <div class="post-meta">
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2001-02-19 00:00:00" itemprop="dateCreated datePublished" datetime="2001-02-19T00:00:00+08:00">2001-02-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-02-20 21:23:08" itemprop="dateModified" datetime="2023-02-20T21:23:08+08:00">2023-02-20</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%97%A5%E5%BF%97/" itemprop="url" rel="index"><span itemprop="name">日志</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>34k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>31 分钟</span>
            </span>

        </div>
      </header>

    
    
    

   

    <div class="post-body" itemprop="articleBody">

      
          <h1 id="hbase"><a href="#hbase" class="headerlink" title="hbase"></a>hbase</h1><p>在讲HBase之前先说nosql</p>
<h2 id="noql"><a href="#noql" class="headerlink" title="noql"></a>noql</h2><p>不支持sql语法进行查询数据,查询数据比较快</p>
<p>redis,hbase等</p>
<h2 id="RDBMS"><a href="#RDBMS" class="headerlink" title="RDBMS"></a>RDBMS</h2><p>把数据相当于excel表，有表头什么的</p>
<p>mysql，clickhouse等</p>
<h2 id="hbase的概述"><a href="#hbase的概述" class="headerlink" title="hbase的概述"></a>hbase的概述</h2><p>为了解决读取数据慢的场景</p>
<p>官网地址：<a href="hbase.apache.org">hbase</a></p>
<p>通过官网我们进行学习：</p>
<ul>
<li>随机的实时读写数据</li>
<li>大体量 &#x3D;&gt; 10亿多个表</li>
<li>分布式存储系统 &#x3D;&gt; 构建在hadoop之上 &#x3D;&gt; 高扩展</li>
<li>nosql数据库</li>
</ul>
<p>做实时数仓一般可以用hbase来当数仓的存储地方，用phoenix来使用</p>
<p>生产上为什么不用hbase做数仓？</p>
<ul>
<li>不支持sql</li>
<li>api和一些shell不好用</li>
<li>不支持二级索引</li>
<li>不好维护</li>
</ul>
<p>版本：</p>
<ul>
<li>cdh : 5.x &#x3D;&gt; hbase 1.x</li>
<li>cdh: 6.x &#x3D;&gt; hbase 2.x</li>
</ul>
<p>好用的版本1.2.x</p>
<h2 id="部署hbase"><a href="#部署hbase" class="headerlink" title="部署hbase"></a>部署hbase</h2><p>hbase也是个主从架构</p>
<p>老大：hmaster</p>
<p>小弟：hregionserver</p>
<p>hbase 是构建在hadoop基础之上的框架</p>
<ul>
<li>数据存储</li>
<li>数据资源</li>
</ul>
<p>环境：</p>
<ul>
<li>jdk</li>
<li>ZK</li>
<li>hadoop</li>
</ul>
<p><a target="_blank" rel="noopener" href="http://archive.apache.org/dist/">下载地址</a>我们下载的是2.0.5的</p>
<p>然后解压设置软连接，设置环境变量</p>
<p>配置参数：</p>
<p>进入conf目录下</p>
<p>编辑hbase-env.sh &#x3D;&gt; 更改 <code>export HBASE_MANAGES_ZK=false 相当于用外部的zk，不用hbase自己提供的zk</code></p>
<p>然后打开hbase-site.xml其余配置如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.rootdir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>hdfs://bigdata3:9000/hbase<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--hbase集群开关--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.cluster.distributed<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--hbase要在本地存储的临时文件夹--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.tmp.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>/home/hadoop/data/hbase<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--如果就设置一个hmaster下面是主机ip:端口号--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--如果是HA的hmaster，则下面是直接放上端口号，因为Zk会自动帮我们选择ip--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.master<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>bigdata5:60000<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--设置Zk的快照的存储位置，默认位置是/tmp.在重启时会清空，因为zk是独立安装的--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.zookeeper.property.dataDir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>/home/hadoop/app/zookeeper/data<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.zookeeper.quorum<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>bigdata3,bigdata4,bigdata5<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--客户端连接Zk的端口--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.zookeeper.property.clientPort<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>2181<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--zk会话超时的时候hbase把这个值传递给它，向他推荐一个最大的超时时间--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>zookeeper.session.timeout<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>120000<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--当hbase的节点挂了的时候选择重启而不是终止--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.regionserver.restart.on.zk.expire<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>而如果是HA ：则要把 conf&#x2F;backup-masters 配上hostname 如果是HA则这个名字多加几个就行</p>
<p>然后进行小弟的配置：conf&#x2F;regionservers 里ip和名称的映射</p>
<p>启动：<code>start-hbase.sh</code></p>
<p>停止：<code>stop-hbase.sh</code></p>
<p>如果启动的时候报错如下：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2022</span>-<span class="number">05</span>-<span class="number">16</span> <span class="number">21</span>:<span class="number">15</span>:<span class="number">56</span>,<span class="number">450</span> WARN  <span class="selector-attr">[RS-EventLoopGroup-1-2]</span> concurrent<span class="selector-class">.DefaultPromise</span>: An exception was thrown by org<span class="selector-class">.apache</span><span class="selector-class">.hadoop</span><span class="selector-class">.hbase</span><span class="selector-class">.io</span><span class="selector-class">.asyncfs</span>.FanOutOneBlockAsyncDFSOutputHelper$<span class="number">4</span><span class="selector-class">.opera</span></span><br><span class="line"><span class="function"><span class="title">tionComplete</span><span class="params">()</span></span></span><br><span class="line">java<span class="selector-class">.lang</span><span class="selector-class">.IllegalArgumentException</span>: <span class="selector-tag">object</span> is not an instance of declaring class</span><br><span class="line">        at sun<span class="selector-class">.reflect</span><span class="selector-class">.NativeMethodAccessorImpl</span><span class="selector-class">.invoke0</span>(Native Method)</span><br><span class="line">        at sun<span class="selector-class">.reflect</span><span class="selector-class">.NativeMethodAccessorImpl</span><span class="selector-class">.invoke</span>(NativeMethodAccessorImpl<span class="selector-class">.java</span>:<span class="number">62</span>)</span><br><span class="line">        at sun<span class="selector-class">.reflect</span><span class="selector-class">.DelegatingMethodAccessorImpl</span><span class="selector-class">.invoke</span>(DelegatingMethodAccessorImpl<span class="selector-class">.java</span>:<span class="number">43</span>)</span><br><span class="line">        at java<span class="selector-class">.lang</span><span class="selector-class">.reflect</span><span class="selector-class">.Method</span><span class="selector-class">.invoke</span>(Method<span class="selector-class">.java</span>:<span class="number">498</span>)</span><br><span class="line">        at org<span class="selector-class">.apache</span><span class="selector-class">.hadoop</span><span class="selector-class">.hbase</span><span class="selector-class">.io</span><span class="selector-class">.asyncfs</span><span class="selector-class">.ProtobufDecoder</span>.&lt;init&gt;(ProtobufDecoder<span class="selector-class">.java</span>:<span class="number">69</span>)</span><br><span class="line">        at org<span class="selector-class">.apache</span><span class="selector-class">.hadoop</span><span class="selector-class">.hbase</span><span class="selector-class">.io</span><span class="selector-class">.asyncfs</span><span class="selector-class">.FanOutOneBlockAsyncDFSOutputHelper</span><span class="selector-class">.processWriteBlockResponse</span>(FanOutOneBlockAsyncDFSOutputHelper<span class="selector-class">.java</span>:<span class="number">343</span>)</span><br><span class="line">        at org<span class="selector-class">.apache</span><span class="selector-class">.hadoop</span><span class="selector-class">.hbase</span><span class="selector-class">.io</span><span class="selector-class">.asyncfs</span><span class="selector-class">.FanOutOneBlockAsyncDFSOutputHelper</span>.access$<span class="number">100</span>(FanOutOneBlockAsyncDFSOutputHelper<span class="selector-class">.java</span>:<span class="number">112</span>)</span><br><span class="line">        at org<span class="selector-class">.apache</span><span class="selector-class">.hadoop</span><span class="selector-class">.hbase</span><span class="selector-class">.io</span><span class="selector-class">.asyncfs</span>.FanOutOneBlockAsyncDFSOutputHelper$<span class="number">4</span><span class="selector-class">.operationComplete</span>(FanOutOneBlockAsyncDFSOutputHelper<span class="selector-class">.java</span>:<span class="number">425</span>)</span><br><span class="line">        at org<span class="selector-class">.apache</span><span class="selector-class">.hbase</span><span class="selector-class">.thirdparty</span><span class="selector-class">.io</span><span class="selector-class">.netty</span><span class="selector-class">.util</span><span class="selector-class">.concurrent</span><span class="selector-class">.DefaultPromise</span><span class="selector-class">.notifyListener0</span>(DefaultPromise<span class="selector-class">.java</span>:<span class="number">578</span>)</span><br><span class="line">        at org<span class="selector-class">.apache</span><span class="selector-class">.hbase</span><span class="selector-class">.thirdparty</span><span class="selector-class">.io</span><span class="selector-class">.netty</span><span class="selector-class">.util</span><span class="selector-class">.concurrent</span><span class="selector-class">.DefaultPromise</span><span class="selector-class">.notifyListenersNow</span>(DefaultPromise<span class="selector-class">.java</span>:<span class="number">552</span>)</span><br><span class="line">        at org<span class="selector-class">.apache</span><span class="selector-class">.hbase</span><span class="selector-class">.thirdparty</span><span class="selector-class">.io</span><span class="selector-class">.netty</span><span class="selector-class">.util</span><span class="selector-class">.concurrent</span><span class="selector-class">.DefaultPromise</span><span class="selector-class">.notifyListeners</span>(DefaultPromise<span class="selector-class">.java</span>:<span class="number">491</span>)</span><br><span class="line">        at org<span class="selector-class">.apache</span><span class="selector-class">.hbase</span><span class="selector-class">.thirdparty</span><span class="selector-class">.io</span><span class="selector-class">.netty</span><span class="selector-class">.util</span><span class="selector-class">.concurrent</span><span class="selector-class">.DefaultPromise</span><span class="selector-class">.addListener</span>(DefaultPromise<span class="selector-class">.java</span>:<span class="number">184</span>)</span><br><span class="line">        at org<span class="selector-class">.apache</span><span class="selector-class">.hadoop</span><span class="selector-class">.hbase</span><span class="selector-class">.io</span><span class="selector-class">.asyncfs</span><span class="selector-class">.FanOutOneBlockAsyncDFSOutputHelper</span><span class="selector-class">.initialize</span>(FanOutOneBlockAsyncDFSOutputHelper<span class="selector-class">.java</span>:<span class="number">419</span>)</span><br><span class="line">        at org<span class="selector-class">.apache</span><span class="selector-class">.hadoop</span><span class="selector-class">.hbase</span><span class="selector-class">.io</span><span class="selector-class">.asyncfs</span><span class="selector-class">.FanOutOneBlockAsyncDFSOutputHelper</span>.access$<span class="number">300</span>(FanOutOneBlockAsyncDFSOutputHelper<span class="selector-class">.java</span>:<span class="number">112</span>)</span><br><span class="line">        at org<span class="selector-class">.apache</span><span class="selector-class">.hadoop</span><span class="selector-class">.hbase</span><span class="selector-class">.io</span><span class="selector-class">.asyncfs</span>.FanOutOneBlockAsyncDFSOutputHelper$<span class="number">5</span><span class="selector-class">.operationComplete</span>(FanOutOneBlockAsyncDFSOutputHelper<span class="selector-class">.java</span>:<span class="number">477</span>)</span><br><span class="line">        at org<span class="selector-class">.apache</span><span class="selector-class">.hadoop</span><span class="selector-class">.hbase</span><span class="selector-class">.io</span><span class="selector-class">.asyncfs</span>.FanOutOneBlockAsyncDFSOutputHelper$<span class="number">5</span><span class="selector-class">.operationComplete</span>(FanOutOneBlockAsyncDFSOutputHelper<span class="selector-class">.java</span>:<span class="number">472</span>)</span><br><span class="line">        at org<span class="selector-class">.apache</span><span class="selector-class">.hbase</span><span class="selector-class">.thirdparty</span><span class="selector-class">.io</span><span class="selector-class">.netty</span><span class="selector-class">.util</span><span class="selector-class">.concurrent</span><span class="selector-class">.DefaultPromise</span><span class="selector-class">.notifyListener0</span>(DefaultPromise<span class="selector-class">.java</span>:<span class="number">578</span>)</span><br><span class="line">        at org<span class="selector-class">.apache</span><span class="selector-class">.hbase</span><span class="selector-class">.thirdparty</span><span class="selector-class">.io</span><span class="selector-class">.netty</span><span class="selector-class">.util</span><span class="selector-class">.concurrent</span><span class="selector-class">.DefaultPromise</span><span class="selector-class">.notifyListeners0</span>(DefaultPromise<span class="selector-class">.java</span>:<span class="number">571</span>)</span><br><span class="line">        at org<span class="selector-class">.apache</span><span class="selector-class">.hbase</span><span class="selector-class">.thirdparty</span><span class="selector-class">.io</span><span class="selector-class">.netty</span><span class="selector-class">.util</span><span class="selector-class">.concurrent</span><span class="selector-class">.DefaultPromise</span><span class="selector-class">.notifyListenersNow</span>(DefaultPromise<span class="selector-class">.java</span>:<span class="number">550</span>)</span><br><span class="line">        at org<span class="selector-class">.apache</span><span class="selector-class">.hbase</span><span class="selector-class">.thirdparty</span><span class="selector-class">.io</span><span class="selector-class">.netty</span><span class="selector-class">.util</span><span class="selector-class">.concurrent</span><span class="selector-class">.DefaultPromise</span><span class="selector-class">.notifyListeners</span>(DefaultPromise<span class="selector-class">.java</span>:<span class="number">491</span>)</span><br><span class="line">        at org<span class="selector-class">.apache</span><span class="selector-class">.hbase</span><span class="selector-class">.thirdparty</span><span class="selector-class">.io</span><span class="selector-class">.netty</span><span class="selector-class">.util</span><span class="selector-class">.concurrent</span><span class="selector-class">.DefaultPromise</span><span class="selector-class">.setValue0</span>(DefaultPromise<span class="selector-class">.java</span>:<span class="number">616</span>)</span><br><span class="line">        at org<span class="selector-class">.apache</span><span class="selector-class">.hbase</span><span class="selector-class">.thirdparty</span><span class="selector-class">.io</span><span class="selector-class">.netty</span><span class="selector-class">.util</span><span class="selector-class">.concurrent</span><span class="selector-class">.DefaultPromise</span><span class="selector-class">.setSuccess0</span>(DefaultPromise<span class="selector-class">.java</span>:<span class="number">605</span>)</span><br><span class="line">        at org<span class="selector-class">.apache</span><span class="selector-class">.hbase</span><span class="selector-class">.thirdparty</span><span class="selector-class">.io</span><span class="selector-class">.netty</span><span class="selector-class">.util</span><span class="selector-class">.concurrent</span><span class="selector-class">.DefaultPromise</span><span class="selector-class">.trySuccess</span>(DefaultPromise<span class="selector-class">.java</span>:<span class="number">104</span>)</span><br><span class="line">        at org<span class="selector-class">.apache</span><span class="selector-class">.hbase</span><span class="selector-class">.thirdparty</span><span class="selector-class">.io</span><span class="selector-class">.netty</span><span class="selector-class">.channel</span><span class="selector-class">.DefaultChannelPromise</span><span class="selector-class">.trySuccess</span>(DefaultChannelPromise<span class="selector-class">.java</span>:<span class="number">84</span>)</span><br><span class="line">        at org<span class="selector-class">.apache</span><span class="selector-class">.hbase</span><span class="selector-class">.thirdparty</span><span class="selector-class">.io</span><span class="selector-class">.netty</span><span class="selector-class">.channel</span><span class="selector-class">.epoll</span>.AbstractEpollChannel<span class="variable">$AbstractEpollUnsafe</span><span class="selector-class">.fulfillConnectPromise</span>(AbstractEpollChannel<span class="selector-class">.java</span>:<span class="number">653</span>)</span><br><span class="line">        at org<span class="selector-class">.apache</span><span class="selector-class">.hbase</span><span class="selector-class">.thirdparty</span><span class="selector-class">.io</span><span class="selector-class">.netty</span><span class="selector-class">.channel</span><span class="selector-class">.epoll</span>.AbstractEpollChannel<span class="variable">$AbstractEpollUnsafe</span><span class="selector-class">.finishConnect</span>(AbstractEpollChannel<span class="selector-class">.java</span>:<span class="number">691</span>)</span><br><span class="line">        at org<span class="selector-class">.apache</span><span class="selector-class">.hbase</span><span class="selector-class">.thirdparty</span><span class="selector-class">.io</span><span class="selector-class">.netty</span><span class="selector-class">.channel</span><span class="selector-class">.epoll</span>.AbstractEpollChannel<span class="variable">$AbstractEpollUnsafe</span><span class="selector-class">.epollOutReady</span>(AbstractEpollChannel<span class="selector-class">.java</span>:<span class="number">567</span>)</span><br><span class="line">        at org<span class="selector-class">.apache</span><span class="selector-class">.hbase</span><span class="selector-class">.thirdparty</span><span class="selector-class">.io</span><span class="selector-class">.netty</span><span class="selector-class">.channel</span><span class="selector-class">.epoll</span><span class="selector-class">.EpollEventLoop</span><span class="selector-class">.processReady</span>(EpollEventLoop<span class="selector-class">.java</span>:<span class="number">470</span>)</span><br><span class="line">        at org<span class="selector-class">.apache</span><span class="selector-class">.hbase</span><span class="selector-class">.thirdparty</span><span class="selector-class">.io</span><span class="selector-class">.netty</span><span class="selector-class">.channel</span><span class="selector-class">.epoll</span><span class="selector-class">.EpollEventLoop</span><span class="selector-class">.run</span>(EpollEventLoop<span class="selector-class">.java</span>:<span class="number">378</span>)</span><br><span class="line">        at org<span class="selector-class">.apache</span><span class="selector-class">.hbase</span><span class="selector-class">.thirdparty</span><span class="selector-class">.io</span><span class="selector-class">.netty</span><span class="selector-class">.util</span><span class="selector-class">.concurrent</span>.SingleThreadEventExecutor$<span class="number">4</span><span class="selector-class">.run</span>(SingleThreadEventExecutor<span class="selector-class">.java</span>:<span class="number">989</span>)</span><br><span class="line">        at org<span class="selector-class">.apache</span><span class="selector-class">.hbase</span><span class="selector-class">.thirdparty</span><span class="selector-class">.io</span><span class="selector-class">.netty</span><span class="selector-class">.util</span><span class="selector-class">.internal</span>.ThreadExecutorMap$<span class="number">2</span><span class="selector-class">.run</span>(ThreadExecutorMap<span class="selector-class">.java</span>:<span class="number">74</span>)</span><br><span class="line">        at org<span class="selector-class">.apache</span><span class="selector-class">.hbase</span><span class="selector-class">.thirdparty</span><span class="selector-class">.io</span><span class="selector-class">.netty</span><span class="selector-class">.util</span><span class="selector-class">.concurrent</span><span class="selector-class">.FastThreadLocalRunnable</span><span class="selector-class">.run</span>(FastThreadLocalRunnable<span class="selector-class">.java</span>:<span class="number">30</span>)</span><br><span class="line">        at java<span class="selector-class">.lang</span><span class="selector-class">.Thread</span><span class="selector-class">.run</span>(Thread<span class="selector-class">.java</span>:<span class="number">748</span>)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>则是hbase的jar包和hadoop的jar包冲突了</p>
<p>执行如下操作：</p>
<ul>
<li>首先进入 <code>cd app/hbase/lib/client-facing-thirdparty/</code></li>
<li>然后执行备份：<code>mkdir before</code> <code>mv ./slf4j-* ./before/</code></li>
<li>然后把hadoop里的jar包拿过来就行了：<code>cp ~/app/hadoop/share/hadoop/common/lib/slf4j-* ./</code></li>
<li>然后再配置文件里 <code>hbase-env.sh</code>把 <code>export HBASE_DISABLE_HADOOP_CLASSPATH_LOOKUP=&quot;true&quot;打开就行</code></li>
<li>就成功解决了</li>
</ul>
<h2 id="hbase存储"><a href="#hbase存储" class="headerlink" title="hbase存储"></a>hbase存储</h2><p>rowkey：相当于mysql的主键</p>
<p>column family: 列族 简称CF &#x3D;&gt; 一个表里多个column组成一个CF，生产要求尽量不超过三个</p>
<p>column：列</p>
<p>version number： 记录数据插入的时间戳</p>
<p>Region：存储数据的最小单元，按照rowkey划分</p>
<p>如果建表的时候不指定region个数默认是一个region。但是当达到一定阈值会自动切分region。他是放在regionserver上的</p>
<h3 id="逻辑概念："><a href="#逻辑概念：" class="headerlink" title="逻辑概念："></a>逻辑概念：</h3><p>整个数据是按照rowkey进行字典排序的</p>
<p>按照rowkey的范围划分不同的region</p>
<p>region是按照不同的列族划分不同的store</p>
<p>store包含memstore和多个storefile &#x3D;&gt; hfile &#x3D;&gt; hdfs : 当内存存不下，则会存hdfs上，而且storefile最终也是落盘到hdfs上的叫hfile</p>
<h3 id="物理层面"><a href="#物理层面" class="headerlink" title="物理层面"></a>物理层面</h3><p>实际上hbase以key - value 存储数据的和redis类似</p>
<p>key是rowkey value是CF：column：TS：value</p>
<p>一个regionserver管理一个或者多个region</p>
<p>一个region管理一个或者多个CF</p>
<p>TS&#x3D;&gt; 管理相同数据的版本</p>
<p>注意：hbase中使用客户端</p>
<ul>
<li>put： 插入数据</li>
<li>delete： 删除数据</li>
</ul>
<p>其实本质上删除也是插入数据，是插入一条带有删除标记的数据</p>
<p>所以里面没有真正删除的操作，对于有删除标记的数据它不会读取</p>
<p>第一次使用put的时候会产生一个时间戳，就是代表他的版本</p>
<p>只读取最新的时间戳的数据</p>
<p>hbase设计理念&#x3D;&gt; 重写轻读</p>
<p>hbase加列特别方便，随时加列等</p>
<h2 id="hbase基本架构"><a href="#hbase基本架构" class="headerlink" title="hbase基本架构"></a>hbase基本架构</h2><p>了解</p>
<h2 id="hbase-shell"><a href="#hbase-shell" class="headerlink" title="hbase shell"></a>hbase shell</h2><p>hbase api几乎不用因为太难写</p>
<p>生产很少用</p>
<p>hbase shell 如下：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">Usage: hbase [&lt;options&gt;] &lt;command&gt; [&lt;args&gt;]</span><br><span class="line">Options:</span><br><span class="line">  --config DIR         Configuration direction <span class="keyword">to</span> use. Default: ./conf</span><br><span class="line">  --hosts HOSTS        Override the list <span class="keyword">in</span> <span class="string">&#x27;regionservers&#x27;</span> file</span><br><span class="line">  --auth-as-server     Authenticate <span class="keyword">to</span> ZooKeeper using servers configuration</span><br><span class="line">  --internal-classpath Skip attempting <span class="keyword">to</span> use<span class="built_in"> client </span>facing jars (WARNING: unstable results between versions)</span><br><span class="line">  --help <span class="keyword">or</span> -h         <span class="built_in">Print</span> this help message</span><br><span class="line"></span><br><span class="line">Commands:</span><br><span class="line">Some commands take arguments. Pass <span class="literal">no</span> args <span class="keyword">or</span> -h <span class="keyword">for</span> usage.</span><br><span class="line">  shell            <span class="built_in">Run</span> the HBase shell</span><br><span class="line">  hbck             <span class="built_in">Run</span> the HBase <span class="string">&#x27;fsck&#x27;</span> tool. Defaults read-only hbck1.</span><br><span class="line">                   Pass <span class="string">&#x27;-j /path/to/HBCK2.jar&#x27;</span> <span class="keyword">to</span> <span class="built_in">run</span> hbase-2.x HBCK2.</span><br><span class="line">  snapshot        <span class="built_in"> Tool </span><span class="keyword">for</span> managing snapshots</span><br><span class="line">  wal              Write-ahead-log analyzer</span><br><span class="line">  hfile            Store file analyzer</span><br><span class="line">  zkcli            <span class="built_in">Run</span> the ZooKeeper shell</span><br><span class="line">  master           <span class="built_in">Run</span> an HBase HMaster node</span><br><span class="line">  regionserver     <span class="built_in">Run</span> an HBase HRegionServer node</span><br><span class="line">  zookeeper        <span class="built_in">Run</span> a ZooKeeper<span class="built_in"> server</span></span><br><span class="line"><span class="built_in"></span>  rest             <span class="built_in">Run</span> an HBase REST<span class="built_in"> server</span></span><br><span class="line"><span class="built_in"></span>  thrift           <span class="built_in">Run</span> the HBase Thrift<span class="built_in"> server</span></span><br><span class="line"><span class="built_in"></span>  thrift2          <span class="built_in">Run</span> the HBase Thrift2<span class="built_in"> server</span></span><br><span class="line"><span class="built_in"></span>  clean            <span class="built_in">Run</span> the HBase clean up<span class="built_in"> script</span></span><br><span class="line"><span class="built_in"></span>  classpath        Dump hbase CLASSPATH</span><br><span class="line">  mapredcp         Dump CLASSPATH entries required by mapreduce</span><br><span class="line">  pe               <span class="built_in">Run</span> PerformanceEvaluation</span><br><span class="line">  ltt              <span class="built_in">Run</span> LoadTestTool</span><br><span class="line">  canary           <span class="built_in">Run</span> the Canary<span class="built_in"> tool</span></span><br><span class="line"><span class="built_in"></span>  version          <span class="built_in">Print</span> the version</span><br><span class="line">  completebulkload <span class="built_in">Run</span> BulkLoadHFiles<span class="built_in"> tool</span></span><br><span class="line"><span class="built_in"></span>  regionsplitter   <span class="built_in">Run</span> RegionSplitter<span class="built_in"> tool</span></span><br><span class="line"><span class="built_in"></span>  rowcounter       <span class="built_in">Run</span> RowCounter<span class="built_in"> tool</span></span><br><span class="line"><span class="built_in"></span>  cellcounter      <span class="built_in">Run</span> CellCounter<span class="built_in"> tool</span></span><br><span class="line"><span class="built_in"></span>  pre-upgrade      <span class="built_in">Run</span> Pre-Upgrade validator<span class="built_in"> tool</span></span><br><span class="line"><span class="built_in"></span>  hbtop            <span class="built_in">Run</span> HBTop<span class="built_in"> tool</span></span><br><span class="line"><span class="built_in"></span>  CLASSNAME        <span class="built_in">Run</span> the class named CLASSNAME</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>输入 <code>hbase shell</code>就会进入shell界面</p>
<p>如下：</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">[hadoop@bigdata5 ~]$ hbase shell</span><br><span class="line">2023-02-19 12:19:59,274 WARN  [main] util.NativeCodeLoader: Unable to load native-hadoop library for your platform... using builtin-java classes where applicable</span><br><span class="line">HBase Shell</span><br><span class="line">Use &quot;help&quot; to get list of supported commands.</span><br><span class="line">Use &quot;exit&quot; to quit this interactive shell.</span><br><span class="line">For Reference, please visit: http://hbase.apache.org/2.0/book.html#shell</span><br><span class="line">Version 2.4.11, r7e672a0da0586e6b7449310815182695bc6ae193, Tue Mar 15 10:<span class="number">31</span>:<span class="number">00</span> PDT <span class="number">2022</span></span><br><span class="line">Took <span class="number">0.0014</span> seconds                                                                                                                                                                                      </span><br><span class="line">hbase:<span class="number">001</span>:<span class="number">0</span>&gt; help</span><br><span class="line">HBase Shell, version <span class="number">2.4</span><span class="number">.11</span>, r7e672a0da0586e6b7449310815182695bc6ae193, Tue Mar <span class="number">15</span> <span class="number">10</span>:<span class="number">31</span>:<span class="number">00</span> PDT <span class="number">2022</span></span><br><span class="line"><span class="built_in">Type</span> <span class="string">&#x27;help &quot;COMMAND&quot;&#x27;</span>, (<span class="built_in">e</span>.g. <span class="string">&#x27;help &quot;get&quot;&#x27;</span> -- the quotes are necessary) <span class="keyword">for</span> help <span class="keyword">on</span> a specific command.</span><br><span class="line">Commands are grouped. <span class="built_in">Type</span> <span class="string">&#x27;help &quot;COMMAND_GROUP&quot;&#x27;</span>, (<span class="built_in">e</span>.g. <span class="string">&#x27;help &quot;general&quot;&#x27;</span>) <span class="keyword">for</span> help <span class="keyword">on</span> a command <span class="keyword">group</span>.</span><br><span class="line"></span><br><span class="line">COMMAND GROUPS:</span><br><span class="line">  <span class="keyword">Group</span> name: general</span><br><span class="line">  Commands: processlist, status, table_help, version, whoami</span><br><span class="line"></span><br><span class="line">  <span class="keyword">Group</span> name: ddl</span><br><span class="line">  Commands: <span class="keyword">alter</span>, alter_async, alter_status, clone_table_schema, <span class="keyword">create</span>, <span class="keyword">describe</span>, disable, disable_all, <span class="keyword">drop</span>, drop_all, enable, enable_all, <span class="keyword">exists</span>, get_table, is_disabled, is_enabled, list, list_regions, locate_region, show_filters</span><br><span class="line"></span><br><span class="line">  <span class="keyword">Group</span> name: <span class="keyword">namespace</span></span><br><span class="line">  Commands: alter_namespace, create_namespace, describe_namespace, drop_namespace, list_namespace, list_namespace_tables</span><br><span class="line"></span><br><span class="line">  <span class="keyword">Group</span> name: dml</span><br><span class="line">  Commands: append, <span class="built_in">count</span>, <span class="keyword">delete</span>, deleteall, get, get_counter, get_splits, incr, put, scan, <span class="keyword">truncate</span>, truncate_preserve</span><br><span class="line"></span><br><span class="line">  <span class="keyword">Group</span> name: tools</span><br><span class="line">  Commands: assign, balance_switch, balancer, balancer_enabled, catalogjanitor_enabled, catalogjanitor_run, catalogjanitor_switch, cleaner_chore_enabled, cleaner_chore_run, cleaner_chore_switch, clear_block_cache, clear_compaction_queues, clear_deadservers, clear_slowlog_responses, close_region, compact, compact_rs, compaction_state, compaction_switch, decommission_regionservers, flush, get_balancer_decisions, get_balancer_rejections, get_largelog_responses, get_slowlog_responses, hbck_chore_run, is_in_maintenance_mode, list_deadservers, list_decommissioned_regionservers, major_compact, merge_region, move, normalize, normalizer_enabled, normalizer_switch, recommission_regionserver, regioninfo, rit, snapshot_cleanup_enabled, snapshot_cleanup_switch, <span class="built_in">split</span>, splitormerge_enabled, splitormerge_switch, stop_master, stop_regionserver, trace, unassign, wal_roll, zk_dump</span><br><span class="line"></span><br><span class="line">  <span class="keyword">Group</span> name: replication</span><br><span class="line">  Commands: add_peer, append_peer_exclude_namespaces, append_peer_exclude_tableCFs, append_peer_namespaces, append_peer_tableCFs, disable_peer, disable_table_replication, enable_peer, enable_table_replication, get_peer_config, list_peer_configs, list_peers, list_replicated_tables, remove_peer, remove_peer_exclude_namespaces, remove_peer_exclude_tableCFs, remove_peer_namespaces, remove_peer_tableCFs, set_peer_bandwidth, set_peer_exclude_namespaces, set_peer_exclude_tableCFs, set_peer_namespaces, set_peer_replicate_all, set_peer_serial, set_peer_tableCFs, show_peer_tableCFs, update_peer_config</span><br><span class="line"></span><br><span class="line">  <span class="keyword">Group</span> name: snapshots</span><br><span class="line">  Commands: clone_snapshot, delete_all_snapshot, delete_snapshot, delete_table_snapshots, list_snapshots, list_table_snapshots, restore_snapshot, snapshot</span><br><span class="line"></span><br><span class="line">  <span class="keyword">Group</span> name: configuration</span><br><span class="line">  Commands: update_all_config, update_config</span><br><span class="line"></span><br><span class="line">  <span class="keyword">Group</span> name: quotas</span><br><span class="line">  Commands: disable_exceed_throttle_quota, disable_rpc_throttle, enable_exceed_throttle_quota, enable_rpc_throttle, list_quota_snapshots, list_quota_table_sizes, list_quotas, list_snapshot_sizes, set_quota</span><br><span class="line"></span><br><span class="line">  <span class="keyword">Group</span> name: security</span><br><span class="line">  Commands: <span class="keyword">grant</span>, list_security_capabilities, <span class="keyword">revoke</span>, user_permission</span><br><span class="line"></span><br><span class="line">  <span class="keyword">Group</span> name: procedures</span><br><span class="line">  Commands: list_locks, list_procedures</span><br><span class="line"></span><br><span class="line">  <span class="keyword">Group</span> name: visibility labels</span><br><span class="line">  Commands: add_labels, clear_auths, get_auths, list_labels, set_auths, set_visibility</span><br><span class="line"></span><br><span class="line">  <span class="keyword">Group</span> name: rsgroup</span><br><span class="line">  Commands: add_rsgroup, alter_rsgroup_config, balance_rsgroup, get_namespace_rsgroup, get_rsgroup, get_server_rsgroup, get_table_rsgroup, list_rsgroups, move_namespaces_rsgroup, move_servers_namespaces_rsgroup, move_servers_rsgroup, move_servers_tables_rsgroup, move_tables_rsgroup, remove_rsgroup, remove_servers_rsgroup, rename_rsgroup, show_rsgroup_config</span><br><span class="line"></span><br><span class="line">SHELL USAGE:</span><br><span class="line">Quote <span class="keyword">all</span> names <span class="keyword">in</span> HBase Shell such <span class="keyword">as</span> table <span class="keyword">and</span> column names.  Commas delimit</span><br><span class="line">command parameters.  <span class="built_in">Type</span> &lt;<span class="keyword">RETURN</span>&gt; after entering a command <span class="keyword">to</span> run it.</span><br><span class="line">Dictionaries of configuration used <span class="keyword">in</span> the creation <span class="keyword">and</span> alteration of tables are</span><br><span class="line">Ruby Hashes. They look <span class="keyword">like</span> this:</span><br><span class="line"></span><br><span class="line">  &#123;<span class="string">&#x27;key1&#x27;</span> =&gt; <span class="string">&#x27;value1&#x27;</span>, <span class="string">&#x27;key2&#x27;</span> =&gt; <span class="string">&#x27;value2&#x27;</span>, ...&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">and</span> are opened <span class="keyword">and</span> closed <span class="keyword">with</span> curley-braces.  <span class="keyword">Key</span>/<span class="keyword">values</span> are delimited <span class="keyword">by</span> the</span><br><span class="line"><span class="string">&#x27;=&gt;&#x27;</span> character combination.  Usually <span class="keyword">keys</span> are predefined constants such <span class="keyword">as</span></span><br><span class="line">NAME, VERSIONS, COMPRESSION, etc.  Constants <span class="keyword">do</span> <span class="keyword">not</span> need <span class="keyword">to</span> be quoted.  <span class="built_in">Type</span></span><br><span class="line"><span class="string">&#x27;Object.constants&#x27;</span> <span class="keyword">to</span> see a (messy) list of <span class="keyword">all</span> constants <span class="keyword">in</span> the environment.</span><br><span class="line"></span><br><span class="line"><span class="keyword">If</span> you are <span class="keyword">using</span> <span class="keyword">binary</span> <span class="keyword">keys</span> <span class="keyword">or</span> <span class="keyword">values</span> <span class="keyword">and</span> need <span class="keyword">to</span> enter them <span class="keyword">in</span> the shell, <span class="keyword">use</span></span><br><span class="line">double-quote<span class="string">&#x27;d hexadecimal representation. For example:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  hbase&gt; get &#x27;</span>t1<span class="string">&#x27;, &quot;key\x03\x3f\xcd&quot;</span></span><br><span class="line"><span class="string">  hbase&gt; get &#x27;</span>t1<span class="string">&#x27;, &quot;key\003\023\011&quot;</span></span><br><span class="line"><span class="string">  hbase&gt; put &#x27;</span>t1<span class="string">&#x27;, &quot;test\xef\xff&quot;, &#x27;</span>f1:<span class="string">&#x27;, &quot;\x01\x33\x40&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">The HBase shell is the (J)Ruby IRB with the above HBase-specific commands added.</span></span><br><span class="line"><span class="string">For more on the HBase Shell, see http://hbase.apache.org/book.html</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure>

<p>ps：简单介绍：命名空间</p>
<p>对于我们的数据库，无论是hive还是hbase创建DATabase就是创建一个namespace</p>
<h3 id="创建库"><a href="#创建库" class="headerlink" title="创建库"></a>创建库</h3><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">create_namespace</span> <span class="string">&#x27;warehouse&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="创建表"><a href="#创建表" class="headerlink" title="创建表"></a>创建表</h3><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">create</span> <span class="string">&#x27;warehouse:test&#x27;</span>,<span class="string">&#x27;sku&#x27;</span>,<span class="string">&#x27;order&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="查看表"><a href="#查看表" class="headerlink" title="查看表"></a>查看表</h3><figure class="highlight excel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">hba<span class="symbol">se:004</span><span class="symbol">:0</span>&gt; list</span><br><span class="line">TABLE                                                                                                                                                                                                    </span><br><span class="line">warehou<span class="symbol">se:te</span>st                                                                                                                                                                                           </span><br><span class="line"><span class="number">1</span> <span class="built_in">row</span>(s)</span><br><span class="line">Took <span class="number">0.0230</span> seconds                                                                                                                                                                                      </span><br><span class="line">=&gt; [<span class="string">&quot;warehouse:test&quot;</span>]</span><br></pre></td></tr></table></figure>

<h3 id="插入数据"><a href="#插入数据" class="headerlink" title="插入数据"></a>插入数据</h3><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">put</span> <span class="string">&#x27;warehouse:test&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;sku:skuname&#x27;</span>, <span class="string">&#x27;aa&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="查看数据"><a href="#查看数据" class="headerlink" title="查看数据"></a>查看数据</h3><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">hbase</span>:<span class="number">007</span>:<span class="number">0</span>&gt; scan &#x27;warehouse:test&#x27;</span><br><span class="line"><span class="attribute">ROW</span>                                                   COLUMN+CELL                                                                                                                                        </span><br><span class="line"> <span class="attribute">1</span>                                                    column=sku:skuname, timestamp=<span class="number">2023</span>-<span class="number">02</span>-<span class="number">19</span>T12:<span class="number">34</span>:<span class="number">08</span>.<span class="number">225</span>, value=aa                                                                                    </span><br><span class="line"><span class="attribute">1</span> row(s)</span><br><span class="line"><span class="attribute">Took</span> <span class="number">0</span>.<span class="number">0529</span> seconds  </span><br></pre></td></tr></table></figure>

<h3 id="查数据（精准）"><a href="#查数据（精准）" class="headerlink" title="查数据（精准）"></a>查数据（精准）</h3><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">hbase</span>:<span class="number">011</span>:<span class="number">0</span>&gt; get &#x27;warehouse:test&#x27;,&#x27;<span class="number">1</span>&#x27;</span><br><span class="line"><span class="attribute">COLUMN</span>                                                CELL                                                                                                                                               </span><br><span class="line"> <span class="attribute">sku</span>:skuname                                          timestamp=<span class="number">2023</span>-<span class="number">02</span>-<span class="number">19</span>T12:<span class="number">34</span>:<span class="number">08</span>.<span class="number">225</span>, value=aa                                                                                                        </span><br><span class="line"><span class="attribute">1</span> row(s)</span><br><span class="line"><span class="attribute">Took</span> <span class="number">0</span>.<span class="number">0222</span> seconds </span><br></pre></td></tr></table></figure>

<h3 id="删除数据"><a href="#删除数据" class="headerlink" title="删除数据"></a>删除数据</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">delete</span> <span class="string">&#x27;warehouse:test&#x27;</span>,<span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;sku:skuname&#x27;</span> <span class="regexp">//</span> 加时间戳也可以的默认是当前版本，加时间戳默认的话就是时间戳的那个版本</span><br></pre></td></tr></table></figure>

<h3 id="删除所有数据"><a href="#删除所有数据" class="headerlink" title="删除所有数据"></a>删除所有数据</h3><p>因为上面delete要删除多个列的话，太麻烦，用deleteall是直接删除rowkey对应的所有列</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">deleteall</span> <span class="string">&#x27;warehouse:test&#x27;</span>,<span class="string">&#x27;2&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="删除表"><a href="#删除表" class="headerlink" title="删除表"></a>删除表</h3><p>有前提：table本身是不可用的</p>
<p>就是相当于开关</p>
<p>先用describe查看表</p>
<p>然后用disable给予权限</p>
<figure class="highlight sml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">describe <span class="symbol">&#x27;warehouse</span>:test&#x27;</span><br><span class="line">disable <span class="symbol">&#x27;warehouse</span>:test&#x27;</span><br><span class="line">drop <span class="symbol">&#x27;warehouse</span>:test&#x27;</span><br></pre></td></tr></table></figure>

<h3 id="hbase多版本"><a href="#hbase多版本" class="headerlink" title="hbase多版本"></a>hbase多版本</h3><p>就是一个表，可以设置它显示多个版本的数据</p>
<p>通过</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter <span class="string">&#x27;warehouse:test&#x27;</span>,&#123;NAME=&gt;<span class="string">&#x27;列名&#x27;</span>，VERSIONS=&gt;要显示的版本数&#125;</span><br></pre></td></tr></table></figure>

<p>scan ‘table’ &#x3D;&gt; 只是查看最新的数据</p>
<p>如果要看所有的则</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scan <span class="string">&#x27;table&#x27;</span> , &#123;RAW =&gt; <span class="keyword">true</span> , VERSIONS =&gt; 要显示的版本数&#125;</span><br></pre></td></tr></table></figure>

<p>这个查看和scan的关系不大，它走的是自己的versions，但是如果不加这个参数，则走表的</p>
<h2 id="hbase的核心架构"><a href="#hbase的核心架构" class="headerlink" title="hbase的核心架构"></a>hbase的核心架构</h2><p>hmaster:负责hbase里的表的table region管理以及regionserver里的region的负载均衡问题，负责region的分裂以及分裂后region的迁移，regionserver如果挂了，则由它进行迁移</p>
<p>regionserver：负责数据的读写，和数据持久化，部署的时候尽量和datanode再同节点</p>
<p>zk：负责hmaster和rs之间的通信，存储meta表 所在的rs节点，master可以感知小弟的状态</p>
<p>meta表： &#x3D;&gt; hive元数据 &#x3D;&gt; hbase元数据</p>
<p>可以用scan ‘ hbase:meta’来查看</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">hbase</span>:<span class="number">010</span>:<span class="number">0</span>&gt; scan &#x27;hbase:meta&#x27;</span><br><span class="line"><span class="attribute">ROW</span>                                                   COLUMN+CELL                                                                                                                                        </span><br><span class="line"> <span class="attribute">hbase</span>:namespace                                      column=table:state, timestamp=<span class="number">2023</span>-<span class="number">02</span>-<span class="number">19</span>T11:<span class="number">38</span>:<span class="number">17</span>.<span class="number">073</span>, value=\x08\x00                                                                              </span><br><span class="line"> <span class="attribute">hbase</span>:namespace,,<span class="number">1676777271034</span>.ae92042c68118b0558fa2 column=info:regioninfo, timestamp=<span class="number">2023</span>-<span class="number">02</span>-<span class="number">19</span>T12:<span class="number">19</span>:<span class="number">55</span>.<span class="number">180</span>, value=&#123;ENCODED =&gt; ae92042c68118b0558fa2ffc7409a50b, NAME =&gt; &#x27;hbase:namespace,,<span class="number">1676777271034</span>.ae92</span><br><span class="line"> <span class="attribute">ffc7409a50b</span>.                                         <span class="number">042</span>c68118b0558fa2ffc7409a50b.&#x27;, STARTKEY =&gt; &#x27;&#x27;, ENDKEY =&gt; &#x27;&#x27;&#125;                                                                                      </span><br><span class="line"> <span class="attribute">hbase</span>:namespace,,<span class="number">1676777271034</span>.ae92042c68118b0558fa2 column=info:seqnumDuringOpen, timestamp=<span class="number">2023</span>-<span class="number">02</span>-<span class="number">19</span>T12:<span class="number">19</span>:<span class="number">55</span>.<span class="number">180</span>, value=\x00\x00\x00\x00\x00\x00\x00\x0A                                            </span><br><span class="line"> <span class="attribute">ffc7409a50b</span>.                                                                                                                                                                                            </span><br><span class="line"> <span class="attribute">hbase</span>:namespace,,<span class="number">1676777271034</span>.ae92042c68118b0558fa2 column=info:server, timestamp=<span class="number">2023</span>-<span class="number">02</span>-<span class="number">19</span>T12:<span class="number">19</span>:<span class="number">55</span>.<span class="number">180</span>, value=bigdata3:<span class="number">16020</span>                                                                        </span><br><span class="line"> <span class="attribute">ffc7409a50b</span>.                                                                                                                                                                                            </span><br><span class="line"> <span class="attribute">hbase</span>:namespace,,<span class="number">1676777271034</span>.ae92042c68118b0558fa2 column=info:serverstartcode, timestamp=<span class="number">2023</span>-<span class="number">02</span>-<span class="number">19</span>T12:<span class="number">19</span>:<span class="number">55</span>.<span class="number">180</span>, value=<span class="number">1676780385227</span>                                                                </span><br><span class="line"> <span class="attribute">ffc7409a50b</span>.                                                                                                                                                                                            </span><br><span class="line"> <span class="attribute">hbase</span>:namespace,,<span class="number">1676777271034</span>.ae92042c68118b0558fa2 column=info:sn, timestamp=<span class="number">2023</span>-<span class="number">02</span>-<span class="number">19</span>T12:<span class="number">19</span>:<span class="number">54</span>.<span class="number">865</span>, value=bigdata3,<span class="number">16020</span>,<span class="number">1676780385227</span>                                                              </span><br><span class="line"> <span class="attribute">ffc7409a50b</span>.                                                                                                                                                                                            </span><br><span class="line"> <span class="attribute">hbase</span>:namespace,,<span class="number">1676777271034</span>.ae92042c68118b0558fa2 column=info:state, timestamp=<span class="number">2023</span>-<span class="number">02</span>-<span class="number">19</span>T12:<span class="number">19</span>:<span class="number">55</span>.<span class="number">180</span>, value=OPEN                                                                                   </span><br><span class="line"> <span class="attribute">ffc7409a50b</span>.                                                                                                                                                                                            </span><br><span class="line"><span class="attribute">2</span> row(s)</span><br><span class="line"><span class="attribute">Took</span> <span class="number">0</span>.<span class="number">0528</span> seconds </span><br></pre></td></tr></table></figure>

<p>meta表：</p>
<ul>
<li>hbase table:<ul>
<li>regioninfo: region的范围</li>
<li>region所在的机器</li>
</ul>
</li>
</ul>
<p>Hlog：预写日志</p>
<ul>
<li>每次写数据的时候首先会先写数据到Hlog文件和mysql的binlog类似</li>
</ul>
<p>blockCache:</p>
<ul>
<li>一个rs只有一个blockcache 用来读缓存，提高读的性能</li>
</ul>
<p>region:一个或者多个store [cf]</p>
<p>store:</p>
<ul>
<li>memstore<ul>
<li>作为写缓存，读的时候不一定用</li>
<li>当超过一定阈值flush，落盘到hdfs上</li>
</ul>
</li>
<li>storefile &#x3D;&gt; hfile<ul>
<li>以hfile的形式写入到hdfs上，当hfile数量增长到一定个数之后，系统会自动进行合并<ul>
<li>大合并</li>
<li>小合并</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>hbase是没有小文件问题的</p>
<p>一个regionserver包含多个region</p>
<p>一个region根据CF列族划分成多个store</p>
<p>一个store包含一个memstore和0&#x2F;多个storefile</p>
<p>一个region只能属于一个表，在一个rs节点上</p>
<h2 id="读写流程"><a href="#读写流程" class="headerlink" title="读写流程"></a>读写流程</h2><p>写流程：</p>
<ul>
<li>client 向zk &#x2F;hbase&#x2F;meta-region-server 获取hbase:meta所在的rs节点</li>
<li>client 向rs节点获取hbase:meta表<ul>
<li>根据rowkey对比，找到对应的RS节点和region</li>
</ul>
</li>
<li>client将请求发送给节点，写数据</li>
<li>先写Hlog 然后再写region 列族对应的store里的memstore</li>
<li>当memstore达到阈值，就落盘，异步的，将内存中的数据写入文件</li>
</ul>
<p>读流程：</p>
<ul>
<li>client向zk发送请求，获取meta表</li>
<li>client 会发送请求封装成一个scan，发送给节点进行处理</li>
<li>节点会先去memstore里查如果没有，则去blockcache里查，如果还查不到，就去storefile里查</li>
<li>节点处理之后就把结果返回给client</li>
</ul>
<h2 id="写问题"><a href="#写问题" class="headerlink" title="写问题"></a>写问题</h2><p>正常来说写数据的时候是Hlog一份</p>
<p>然后就写到memstore等等</p>
<p><strong>memstore flush 的时候hbase的这个region 会暂停读写</strong></p>
<p>我们必须通过调优解决这个问题，要不然机会出现夯住的时候</p>
<p><strong>memstore flush 最小级别是region而不是memstore</strong></p>
<p>调优：</p>
<ul>
<li><p>当region任意一个memstore的size达到阈值，就会flush</p>
<ul>
<li>参数：<code>hbase.hregion.memstore.flush.size</code></li>
<li>可以再hbase的配置里更改他的大小，它默认是134217728kb &#x3D; 128M</li>
<li>一般调整的时候最好按照他的倍数来，一般是给4倍</li>
</ul>
</li>
<li><p>当region所有的memstore加和达到阈值就会触发memstore flush</p>
<ul>
<li>参数 <code>hbase.hregion.memstore.block.multiplier</code></li>
<li>默认大小是4</li>
<li>当region里的memstore达到这个参数x上面的单个最大阈值的时候</li>
<li>才会开始落盘</li>
<li>所以我们可以通过调大这个参数解决这个问题</li>
</ul>
</li>
<li><p>当regionserver里的所有memstore的和超过 低水位线 则这个regionserver 会强制 进行flush</p>
<ul>
<li>会导致多个表不能进行读写</li>
<li>先从最大的memstore最大的region开始flush，依次flush</li>
<li>如果低于水位线就不会flush</li>
<li>参数<ul>
<li><code>hbase.regionserver.global.memstore.size </code> 这个就是你给hbase的整体容量</li>
<li><code>hbase.regionserver.global.memstore.size.lower.limit</code> 这个就是我们计算低水位线的计算条件</li>
<li><code>hbase.regionserver.global.memstore.size.upper.limit </code> 这个就是我们memstore能用的内存能的多少的条件</li>
</ul>
</li>
<li>一般默认情况下upper是最大容量的40%，lower是这个40%的95%</li>
<li>要进行调整就好</li>
</ul>
</li>
<li><p>不太重要的级别</p>
</li>
<li><p>hlog也有要求 &#x3D;&gt; 当Hlog的数量达到一个阈值的时候就会落盘Hlog 参数 <code>hbase.regionserver.max.logs</code></p>
</li>
<li><p>定期级别 &#x3D;&gt; 检查系统的周期是一小时检查一次，确保memstore及时flush 参数把值给成-1就可以关闭它</p>
</li>
<li><p>手动级别 &#x3D;&gt; 用户可以提前对他进行flush 通过shell命令的flush ‘table&#x2F;region’</p>
</li>
</ul>
<p>上述对业务影响比较小的：</p>
<ul>
<li>定期级别</li>
<li>手动级别</li>
<li>hlog</li>
<li>region</li>
</ul>
<p>影响大的：</p>
<ul>
<li>regionserver：几乎是灾难性的 ，暂停时间几乎是能达到分钟级别</li>
</ul>
<h2 id="合并"><a href="#合并" class="headerlink" title="合并"></a>合并</h2><p>hfile进行合并参数名称：compaction</p>
<p>把多个小的hfile主动合并成一个大的hfile &#x3D;&gt; minor(小合并)</p>
<p>major(大合并) ：</p>
<p>除了上述的我合并文件之外，他还会把之前打上删除标记的数据删除还有TTL数据，以及超过设定的版本号的数据</p>
<p>就是我们建表的时候设定的版本号</p>
<p>大合并消耗的时间可能会比较长的，资源消耗比较多 &#x3D;&gt; 一般生产上要把这两个自动合并给关闭</p>
<p>然后我们手动合并，控制他的时间</p>
<p>minor的触发条件：</p>
<p>和hfile的个数有关系</p>
<p>参数：<code>hbase.hstore.compactionThreshold</code>他的默认值是3</p>
<p>如果超过3个小文件，则会触发这个合并操作</p>
<p>就是再memstore flush之后检查这个文件个数</p>
<p>major触发条件：</p>
<p>自动触发 &#x3D;&gt; 关闭</p>
<p>自动触发的操作：</p>
<p>周期性检查的时间的参数：<code>hbase.hregion.majorcompaction</code> 默认是7天</p>
<p>然后还有浮动值，就是这个周期的时间有浮动：</p>
<p>参数是：<code>hbase.hregion.majorcompaction.jitter</code>默认是0.5</p>
<p>所以他的时间是[7,7-7x0.5&#x2F;7+7x0.5]</p>
<p>手动触发的参数：<code>major_compact</code></p>
<p>然后一般就是通过xxl每半年，或者多久触发一次</p>
<h2 id="rowkey设计"><a href="#rowkey设计" class="headerlink" title="rowkey设计"></a>rowkey设计</h2><p>为什么要设计RK？</p>
<ul>
<li>写性能</li>
<li>读性能</li>
<li>读写数据均衡</li>
</ul>
<p>hbase本身就是key - value的</p>
<p>如果设计不好,则会导致数据写入不均衡,就容易造成数据倾斜之类的问题</p>
<p>数据写入: 是不是均匀的写入region</p>
<p>数据读取:是按照rowkey进行读取的</p>
<p>预分区:</p>
<ul>
<li>默认建表的时候就一个region,当这个region越来越大,所在机器上的压力也就越来越大</li>
<li>然后预分区,就是限定这个region的范围,他只能在一定区间</li>
<li>就相当于分出来很多个region</li>
<li><code>create &#39;lpl&#39;,&#39;user&#39;,SPLITS=&gt;[&#39;a&#39;,&#39;b&#39;,&#39;c&#39;,&#39;d&#39;]</code></li>
<li>相当于在default数据库下创建了一个表,叫lpl,然后有一个user列族,后面则是控制每个region的范围,</li>
<li>上述的region是均匀的分布在各个机器上的</li>
<li>但是这么指定也要注意rowkey的命名,让他均匀的在每个region,要不然如果一个region特别多就和之前一样了</li>
<li>针对于写入是如上 : 并不一定是均衡</li>
<li>针对于读取数据 : 也不一定精准(get)</li>
</ul>
<p>生产上:rk设计 + 二级索引 &#x3D;&gt; 精准get &#x3D;&gt; 这种是hbase本身不支持,要你自己来写的</p>
<p>rowkey设计原则:听听就行</p>
<ul>
<li>别太长 &#x3D;&gt; 占用存储空间</li>
<li>唯一性</li>
<li>散列原则<ul>
<li>rowkey均匀分布到节点上</li>
</ul>
</li>
<li>排序原则</li>
</ul>
<p>rowkey设计:</p>
<ul>
<li>加盐:<ul>
<li>在rowkey前面加上一个固定长度的随机数</li>
<li>缺点 : 第一个region必然是空的 ,不能精准读取(打破之前的数据排序规则)</li>
</ul>
</li>
<li>hash<ul>
<li>rk进行hash &#x3D;&gt; 作为前缀加上去,就形成一个新的rowkey &#x3D;&gt; 不会有重复数据</li>
<li>写入保证数据均衡</li>
<li>get的性能可以保证</li>
<li>scan会变低</li>
<li>但是已经算是最好的方法了</li>
<li>通过hash建表 <code>create &#39;tale&#39; , &#39;列族&#39;,&#123;NUMREGIONS =&gt; region的数量 , SPLITALGO =&gt; &#39;HexStringSplit&#39;&#125;</code></li>
<li>就会自动的按照hash进行分区</li>
</ul>
</li>
<li>反转</li>
</ul>
<h1 id="phoenix"><a href="#phoenix" class="headerlink" title="phoenix"></a>phoenix</h1><p>sql on hbase</p>
<p>支持jdbc链接</p>
<p>建表的时候默认有盐表,可以保证数据写入均衡</p>
<p>读数据的时候加索引就好了</p>
<p><a href="phoenix.apache.org">官网</a></p>
<p>他是一个OLTP的框架 : 联机事务处理</p>
<p>优点:</p>
<ul>
<li>可以用sql的方式链接hbase</li>
<li>hive 和 phoenix整合之后 很方便.表可以互通</li>
<li>spark</li>
</ul>
<p>注意它仅仅是个客户端,提交sql的和hive一样</p>
<p>部署:解压-&gt;软连接-&gt;环境变量-&gt;把phoenix-server-hbase-2.4-5.1.3.jar -&gt; cp到hbase的各个节点lib文件夹下</p>
<p>然后修改hbase配置hbase-site.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.table.sanity.checks<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>false<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.regionserver.wal.codec<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>org.apache.hadoop.hbase.regionserver.wal.IndexedWALEditCodec<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>phoenix.schema.isNamespaceMappingEnabled<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>phoenix.schema.mapSystemTablesToNamespace<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.coprocessor.abortonerror<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>false<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>然后还要再phoenix里的bin中的hbase-site.xml和这个同步</p>
<p>我们直接做软连接了</p>
<p>如果上述报错，则可以试试把三个都cp到hbase的lib下，以及使用命令 <code>hbase-cleanup.sh --cleanAll</code>然后重启hbase和phoenix</p>
<p><a target="_blank" rel="noopener" href="https://phoenix.apache.org/language/index.html">phoenix学习使用</a></p>
<h2 id="简单的应用"><a href="#简单的应用" class="headerlink" title="简单的应用"></a>简单的应用</h2><h3 id="查看表-1"><a href="#查看表-1" class="headerlink" title="查看表"></a>查看表</h3><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">0: jdbc:phoenix:&gt; !tables</span><br><span class="line">+-----------+-------------+------------+--------------+---------+-----------+---------------------------+----------------+-------------+----------------+--------------+--------------+----------------+--------+</span><br><span class="line">|<span class="string"> TABLE_CAT </span>|<span class="string"> TABLE_SCHEM </span>|<span class="string"> TABLE_NAME </span>|<span class="string">  TABLE_TYPE  </span>|<span class="string"> REMARKS </span>|<span class="string"> TYPE_NAME </span>|<span class="string"> SELF_REFERENCING_COL_NAME </span>|<span class="string"> REF_GENERATION </span>|<span class="string"> INDEX_STATE </span>|<span class="string"> IMMUTABLE_ROWS </span>|<span class="string"> SALT_BUCKETS </span>|<span class="string"> MULTI_TENANT </span>|<span class="string"> VIEW_STATEMENT </span>|<span class="string"> VIEW_T </span>|</span><br><span class="line">+-----------+-------------+------------+--------------+---------+-----------+---------------------------+----------------+-------------+----------------+--------------+--------------+----------------+--------+</span><br><span class="line">|<span class="string">           </span>|<span class="string"> SYSTEM      </span>|<span class="string"> CATALOG    </span>|<span class="string"> SYSTEM TABLE </span>|<span class="string">         </span>|<span class="string">           </span>|<span class="string">                           </span>|<span class="string">                </span>|<span class="string">             </span>|<span class="string"> false          </span>|<span class="string"> null         </span>|<span class="string"> false        </span>|<span class="string">                </span>|<span class="string">        </span>|</span><br><span class="line">|<span class="string">           </span>|<span class="string"> SYSTEM      </span>|<span class="string"> CHILD_LINK </span>|<span class="string"> SYSTEM TABLE </span>|<span class="string">         </span>|<span class="string">           </span>|<span class="string">                           </span>|<span class="string">                </span>|<span class="string">             </span>|<span class="string"> false          </span>|<span class="string"> null         </span>|<span class="string"> false        </span>|<span class="string">                </span>|<span class="string">        </span>|</span><br><span class="line">|<span class="string">           </span>|<span class="string"> SYSTEM      </span>|<span class="string"> FUNCTION   </span>|<span class="string"> SYSTEM TABLE </span>|<span class="string">         </span>|<span class="string">           </span>|<span class="string">                           </span>|<span class="string">                </span>|<span class="string">             </span>|<span class="string"> false          </span>|<span class="string"> null         </span>|<span class="string"> false        </span>|<span class="string">                </span>|<span class="string">        </span>|</span><br><span class="line">|<span class="string">           </span>|<span class="string"> SYSTEM      </span>|<span class="string"> LOG        </span>|<span class="string"> SYSTEM TABLE </span>|<span class="string">         </span>|<span class="string">           </span>|<span class="string">                           </span>|<span class="string">                </span>|<span class="string">             </span>|<span class="string"> true           </span>|<span class="string"> 32           </span>|<span class="string"> false        </span>|<span class="string">                </span>|<span class="string">        </span>|</span><br><span class="line">|<span class="string">           </span>|<span class="string"> SYSTEM      </span>|<span class="string"> MUTEX      </span>|<span class="string"> SYSTEM TABLE </span>|<span class="string">         </span>|<span class="string">           </span>|<span class="string">                           </span>|<span class="string">                </span>|<span class="string">             </span>|<span class="string"> true           </span>|<span class="string"> null         </span>|<span class="string"> false        </span>|<span class="string">                </span>|<span class="string">        </span>|</span><br><span class="line">|<span class="string">           </span>|<span class="string"> SYSTEM      </span>|<span class="string"> SEQUENCE   </span>|<span class="string"> SYSTEM TABLE </span>|<span class="string">         </span>|<span class="string">           </span>|<span class="string">                           </span>|<span class="string">                </span>|<span class="string">             </span>|<span class="string"> false          </span>|<span class="string"> null         </span>|<span class="string"> false        </span>|<span class="string">                </span>|<span class="string">        </span>|</span><br><span class="line">|<span class="string">           </span>|<span class="string"> SYSTEM      </span>|<span class="string"> STATS      </span>|<span class="string"> SYSTEM TABLE </span>|<span class="string">         </span>|<span class="string">           </span>|<span class="string">                           </span>|<span class="string">                </span>|<span class="string">             </span>|<span class="string"> false          </span>|<span class="string"> null         </span>|<span class="string"> false        </span>|<span class="string">                </span>|<span class="string">        </span>|</span><br><span class="line">|<span class="string">           </span>|<span class="string"> SYSTEM      </span>|<span class="string"> TASK       </span>|<span class="string"> SYSTEM TABLE </span>|<span class="string">         </span>|<span class="string">           </span>|<span class="string">                           </span>|<span class="string">                </span>|<span class="string">             </span>|<span class="string"> false          </span>|<span class="string"> null         </span>|<span class="string"> false        </span>|<span class="string">                </span>|<span class="string">        </span>|</span><br><span class="line">+-----------+-------------+------------+--------------+---------+-----------+---------------------------+----------------+-------------+----------------+--------------+--------------+----------------+--------</span><br></pre></td></tr></table></figure>

<h3 id="创建数据库"><a href="#创建数据库" class="headerlink" title="创建数据库"></a>创建数据库</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span>: jdbc:phoenix:&gt; <span class="keyword">CREATE</span> <span class="keyword">SCHEMA</span> test</span><br><span class="line">. . . .semicolon&gt; ;</span><br><span class="line"><span class="keyword">No</span> <span class="keyword">rows</span> affected (<span class="number">0.322</span> seconds)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="创建表-1"><a href="#创建表-1" class="headerlink" title="创建表"></a>创建表</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span>: jdbc:phoenix:&gt; <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> test.my_test ( id <span class="type">BIGINT</span> <span class="keyword">not</span> <span class="keyword">null</span> <span class="keyword">primary key</span>, <span class="type">date</span> <span class="type">Date</span>);</span><br><span class="line"><span class="keyword">No</span> <span class="keyword">rows</span> affected (<span class="number">2.661</span> seconds)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>然后去hbase shell 查看</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">hbase:<span class="number">002</span>:<span class="number">0</span>&gt; list</span><br><span class="line"><span class="keyword">TABLE</span>                                                                                                                                                                                                      </span><br><span class="line"><span class="keyword">SYSTEM</span>:CATALOG                                                                                                                                                                                             </span><br><span class="line"><span class="keyword">SYSTEM</span>:CHILD_LINK                                                                                                                                                                                          </span><br><span class="line"><span class="keyword">SYSTEM</span>:<span class="keyword">FUNCTION</span>                                                                                                                                                                                            </span><br><span class="line"><span class="keyword">SYSTEM</span>:<span class="keyword">LOG</span>                                                                                                                                                                                                 </span><br><span class="line"><span class="keyword">SYSTEM</span>:MUTEX                                                                                                                                                                                               </span><br><span class="line"><span class="keyword">SYSTEM</span>:<span class="keyword">SEQUENCE</span>                                                                                                                                                                                            </span><br><span class="line"><span class="keyword">SYSTEM</span>:STATS                                                                                                                                                                                               </span><br><span class="line"><span class="keyword">SYSTEM</span>:TASK                                                                                                                                                                                                </span><br><span class="line">TEST:MY_TEST                                                                                                                                                                                               </span><br><span class="line"><span class="number">9</span> <span class="keyword">row</span>(s)</span><br><span class="line">Took <span class="number">0.0139</span> seconds                                                                                                                                                                                        </span><br><span class="line">=&gt; [&quot;SYSTEM:CATALOG&quot;, &quot;SYSTEM:CHILD_LINK&quot;, &quot;SYSTEM:FUNCTION&quot;, &quot;SYSTEM:LOG&quot;, &quot;SYSTEM:MUTEX&quot;, &quot;SYSTEM:SEQUENCE&quot;, &quot;SYSTEM:STATS&quot;, &quot;SYSTEM:TASK&quot;, &quot;TEST:MY_TEST&quot;]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>出现我们创建的表</p>
<p>注意在hbase里表以及数据库的名字会大写,以及表名</p>
<h3 id="插入数据-1"><a href="#插入数据-1" class="headerlink" title="插入数据"></a>插入数据</h3><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span>: jdbc:phoenix:&gt; UPSERT INTO MY_TEST(id,date) VALUES(<span class="number">1</span>,<span class="comment">&#x27;2020-12-01&#x27;);</span></span><br><span class="line"><span class="symbol">1 </span>row affected (<span class="number">0.498</span> seconds)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在hbase里查看数据</p>
<figure class="highlight moonscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="name">hbase</span>:<span class="number">004</span>:<span class="number">0</span>&gt; scan <span class="string">&#x27;TEST:MY_TEST&#x27;</span></span><br><span class="line">ROW                                                   COLUMN+CELL                                                                                                                                          </span><br><span class="line"> \x80\x00\x00\x00\x00\x00\x00\x01                     column=<span class="number">0</span>:\x00\x00\x00\x00, timestamp=<span class="number">2023</span><span class="number">-02</span><span class="number">-20</span><span class="name">T12</span>:<span class="number">29</span>:<span class="number">36.819</span>, value=x                                                                                </span><br><span class="line"> \x80\x00\x00\x00\x00\x00\x00\x01                     column=<span class="number">0</span>:\x80\x0B, timestamp=<span class="number">2023</span><span class="number">-02</span><span class="number">-20</span><span class="name">T12</span>:<span class="number">29</span>:<span class="number">36.819</span>, value=\x80\x00\x01v\x1B\x99L\x00                                                               </span><br><span class="line"><span class="number">1</span> row(s)</span><br><span class="line">Took <span class="number">0.0540</span> seconds  </span><br></pre></td></tr></table></figure>

<p>这个upsert &#x3D;&gt; insert + update</p>
<h3 id="查询数据"><a href="#查询数据" class="headerlink" title="查询数据"></a>查询数据</h3><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">0: jdbc:phoenix:&gt; select * from test.my_test;</span></span><br><span class="line"><span class="section">+----+------------+</span></span><br><span class="line"><span class="section">| ID |    DATE    |</span></span><br><span class="line"><span class="section">+----+------------+</span></span><br><span class="line"><span class="section">| 1  | 2020-12-01 |</span></span><br><span class="line"><span class="section">+----+------------+</span></span><br><span class="line">1 row selected (0.482 seconds)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="查看字段"><a href="#查看字段" class="headerlink" title="查看字段"></a>查看字段</h3><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">!describe test.my_test;</span><br><span class="line">+-----------+-------------+------------+-------------+-----------+-----------+-------------+---------------+----------------+----------------+----------+---------+------------+---------------+----------------+</span><br><span class="line">|<span class="string"> TABLE_CAT </span>|<span class="string"> TABLE_SCHEM </span>|<span class="string"> TABLE_NAME </span>|<span class="string"> COLUMN_NAME </span>|<span class="string"> DATA_TYPE </span>|<span class="string"> TYPE_NAME </span>|<span class="string"> COLUMN_SIZE </span>|<span class="string"> BUFFER_LENGTH </span>|<span class="string"> DECIMAL_DIGITS </span>|<span class="string"> NUM_PREC_RADIX </span>|<span class="string"> NULLABLE </span>|<span class="string"> REMARKS </span>|<span class="string"> COLUMN_DEF </span>|<span class="string"> SQL_DATA_TYPE </span>|<span class="string"> SQL_DATETIME_S </span>|</span><br><span class="line">+-----------+-------------+------------+-------------+-----------+-----------+-------------+---------------+----------------+----------------+----------+---------+------------+---------------+----------------+</span><br><span class="line">|<span class="string">           </span>|<span class="string"> TEST        </span>|<span class="string"> MY_TEST    </span>|<span class="string"> ID          </span>|<span class="string"> -5        </span>|<span class="string"> BIGINT    </span>|<span class="string"> null        </span>|<span class="string"> null          </span>|<span class="string"> null           </span>|<span class="string"> null           </span>|<span class="string"> 0        </span>|<span class="string">         </span>|<span class="string">            </span>|<span class="string"> null          </span>|<span class="string"> null           </span>|</span><br><span class="line">|<span class="string">           </span>|<span class="string"> TEST        </span>|<span class="string"> MY_TEST    </span>|<span class="string"> DATE        </span>|<span class="string"> 91        </span>|<span class="string"> DATE      </span>|<span class="string"> null        </span>|<span class="string"> null          </span>|<span class="string"> null           </span>|<span class="string"> null           </span>|<span class="string"> 1        </span>|<span class="string">         </span>|<span class="string">            </span>|<span class="string"> null          </span>|<span class="string"> null           </span>|</span><br><span class="line">+-----------+-------------+------------+-------------+-----------+-----------+-------------+---------------+----------------+----------------+----------+---------+------------+---------------+----------------+</span><br><span class="line">0: jdbc:phoenix:&gt; </span><br></pre></td></tr></table></figure>

<h2 id="数据结构"><a href="#数据结构" class="headerlink" title="数据结构"></a>数据结构</h2><p>数值类型</p>
<ul>
<li>整数：bigint，interger，smallint，tinyint</li>
<li>小数： double，float，decimal</li>
<li>无符号：unsigned_int，unsigned_date，unsigned_timestamp，unsigned_long等</li>
</ul>
<p>字符串</p>
<ul>
<li>varchar</li>
</ul>
<p>日期</p>
<ul>
<li>date,time,timestamp</li>
</ul>
<p>复杂类型</p>
<ul>
<li>array</li>
</ul>
<p>其他还有boolean等类型</p>
<p>具体数据类型在<a target="_blank" rel="noopener" href="https://phoenix.apache.org/language/datatypes.html">官网</a>详细请在官网查看</p>
<h2 id="sql语法"><a href="#sql语法" class="headerlink" title="sql语法"></a>sql语法</h2><h3 id="ddl"><a href="#ddl" class="headerlink" title="ddl"></a>ddl</h3><p>非查询的，在phoenix里创建数据库叫创建schema</p>
<p>之前配置的</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>phoenix.schema.isNamespaceMappingEnabled<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>phoenix.schema.mapSystemTablesToNamespace<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>就是要让phoenix和hbase里的库一一对应，他的官网给的参数不全，所以搜不到很正常，我这个是5.1.2的正常使用</p>
<p>配置完之后就相当于是你在phoenix里创建一个，同时也映射到hbase里</p>
<p>在phoenix里我们主要创建的表是盐表，</p>
<p>创建盐表 <code>create table test.test_salt(id bigint primary key,name varchar,age integer,address varchar) SALT_BUCKETS = 3;</code></p>
<p><code>SALT_BUCKETS</code>的数值设置要按照hbase有几台regionserver来进行设置，就和hive里的桶表类似</p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">0: jdbc:phoenix:&gt; create table test.test_salt(id bigint primary key,name varchar,age integer,address varchar) SALT_BUCKETS = 3;</span><br><span class="line">No rows affected (3.269 seconds)</span><br><span class="line">0: jdbc:phoenix:&gt; !describe test.test_salt;</span><br><span class="line">+-----------+-------------+------------+-------------+-----------+-----------+-------------+---------------+----------------+----------------+----------+---------+------------+---------------+----------------+</span><br><span class="line">|<span class="string"> TABLE_CAT </span>|<span class="string"> TABLE_SCHEM </span>|<span class="string"> TABLE_NAME </span>|<span class="string"> COLUMN_NAME </span>|<span class="string"> DATA_TYPE </span>|<span class="string"> TYPE_NAME </span>|<span class="string"> COLUMN_SIZE </span>|<span class="string"> BUFFER_LENGTH </span>|<span class="string"> DECIMAL_DIGITS </span>|<span class="string"> NUM_PREC_RADIX </span>|<span class="string"> NULLABLE </span>|<span class="string"> REMARKS </span>|<span class="string"> COLUMN_DEF </span>|<span class="string"> SQL_DATA_TYPE </span>|<span class="string"> SQL_DATETIME_S </span>|</span><br><span class="line">+-----------+-------------+------------+-------------+-----------+-----------+-------------+---------------+----------------+----------------+----------+---------+------------+---------------+----------------+</span><br><span class="line">|<span class="string">           </span>|<span class="string"> TEST        </span>|<span class="string"> TEST_SALT  </span>|<span class="string"> ID          </span>|<span class="string"> -5        </span>|<span class="string"> BIGINT    </span>|<span class="string"> null        </span>|<span class="string"> null          </span>|<span class="string"> null           </span>|<span class="string"> null           </span>|<span class="string"> 0        </span>|<span class="string">         </span>|<span class="string">            </span>|<span class="string"> null          </span>|<span class="string"> null           </span>|</span><br><span class="line">|<span class="string">           </span>|<span class="string"> TEST        </span>|<span class="string"> TEST_SALT  </span>|<span class="string"> NAME        </span>|<span class="string"> 12        </span>|<span class="string"> VARCHAR   </span>|<span class="string"> null        </span>|<span class="string"> null          </span>|<span class="string"> null           </span>|<span class="string"> null           </span>|<span class="string"> 1        </span>|<span class="string">         </span>|<span class="string">            </span>|<span class="string"> null          </span>|<span class="string"> null           </span>|</span><br><span class="line">|<span class="string">           </span>|<span class="string"> TEST        </span>|<span class="string"> TEST_SALT  </span>|<span class="string"> AGE         </span>|<span class="string"> 4         </span>|<span class="string"> INTEGER   </span>|<span class="string"> null        </span>|<span class="string"> null          </span>|<span class="string"> null           </span>|<span class="string"> null           </span>|<span class="string"> 1        </span>|<span class="string">         </span>|<span class="string">            </span>|<span class="string"> null          </span>|<span class="string"> null           </span>|</span><br><span class="line">|<span class="string">           </span>|<span class="string"> TEST        </span>|<span class="string"> TEST_SALT  </span>|<span class="string"> ADDRESS     </span>|<span class="string"> 12        </span>|<span class="string"> VARCHAR   </span>|<span class="string"> null        </span>|<span class="string"> null          </span>|<span class="string"> null           </span>|<span class="string"> null           </span>|<span class="string"> 1        </span>|<span class="string">         </span>|<span class="string">            </span>|<span class="string"> null          </span>|<span class="string"> null           </span>|</span><br><span class="line">+-----------+-------------+------------+-------------+-----------+-----------+-------------+---------------+----------------+----------------+----------+---------+------------+---------------+----------------+</span><br><span class="line">0: jdbc:phoenix:&gt; </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在hbase的web界面查看如下：<br><img src="https://pic.imgdb.cn/item/63f354ebf144a01007a979e5.jpg"></p>
<p>上述就是phoenix创建的盐表所分的region</p>
<p>如果在hbase里用4个随机数创建的盐表，则是region是5个</p>
<p>而在phoenix里创建盐表的时候region的数量是根据 <code>SALT_BUCKETS</code>来的，就是相当于用几个随机数创建</p>
<h3 id="dml"><a href="#dml" class="headerlink" title="dml"></a>dml</h3><p>数据操作的</p>
<p>upsert：insert + updata</p>
<p>他的使用和insert是一样的和mysql里的insert也类似</p>
<p>它也可以使用hint的写法控制分区</p>
<p>插入数据 <code>upsert into test.test_salt values(1,&#39;zs&#39;,13,&#39;北京&#39;)；</code></p>
<p>我们多插入几条数据查看盐表的region写数据的情况</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">upsert</span> <span class="keyword">into</span> test.test_salt <span class="keyword">values</span>(<span class="number">1</span>,<span class="string">&#x27;zs&#x27;</span>,<span class="number">13</span>,<span class="string">&#x27;北京&#x27;</span>);</span><br><span class="line"><span class="keyword">upsert</span> <span class="keyword">into</span> test.test_salt <span class="keyword">values</span>(<span class="number">2</span>,<span class="string">&#x27;zlisi&#x27;</span>,<span class="number">11</span>,<span class="string">&#x27;上海&#x27;</span>);</span><br><span class="line"><span class="keyword">upsert</span> <span class="keyword">into</span> test.test_salt <span class="keyword">values</span>(<span class="number">3</span>,<span class="string">&#x27;wanghwu&#x27;</span>,<span class="number">18</span>,<span class="string">&#x27;河南&#x27;</span>);</span><br><span class="line"><span class="keyword">upsert</span> <span class="keyword">into</span> test.test_salt <span class="keyword">values</span>(<span class="number">4</span>,<span class="string">&#x27;dam&#x27;</span>,<span class="number">15</span>,<span class="string">&#x27;黑龙江&#x27;</span>);</span><br><span class="line"><span class="keyword">upsert</span> <span class="keyword">into</span> test.test_salt <span class="keyword">values</span>(<span class="number">5</span>,<span class="string">&#x27;huamul&#x27;</span>,<span class="number">14</span>,<span class="string">&#x27;子涵&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>如下图：</p>
<p><img src="https://pic.imgdb.cn/item/63f35801f144a01007ad7320.jpg"></p>
<p>上面有12的是因为我之前写入的时候主键忘记改了，导致一直更新一条数据，所以才写12次</p>
<p>通过图片可知，phoenix所造的是读写均衡的盐表</p>
<h2 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h2><p>索引的好处：</p>
<p>读的速度增加</p>
<p>在phoenix里索引的种类是比较多的<a target="_blank" rel="noopener" href="https://phoenix.apache.org/secondary_indexing.html">索引的分类</a></p>
<p>当我们不加索引的时候执行查看语句，我们，查看下他的执行计划</p>
<p><code>explain select * from test.test_salt;</code></p>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">0: jdbc:phoenix:&gt; explain select * from test.test_salt;</span></span><br><span class="line"><span class="section">+-------------------------------------------------------------------------+----------------+---------------+-------------+</span></span><br><span class="line"><span class="section">|                                  PLAN                                   | EST_BYTES_READ | EST_ROWS_READ | EST_INFO_TS |</span></span><br><span class="line"><span class="section">+-------------------------------------------------------------------------+----------------+---------------+-------------+</span></span><br><span class="line"><span class="section">| CLIENT 3-CHUNK PARALLEL 3-WAY ROUND ROBIN FULL SCAN OVER TEST:TEST_SALT | null           | null          | null        |</span></span><br><span class="line"><span class="section">+-------------------------------------------------------------------------+----------------+---------------+-------------+</span></span><br><span class="line">1 row selected (0.015 seconds)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>无论加不加判断条件他都是全表扫描的</p>
<h3 id="添加索引"><a href="#添加索引" class="headerlink" title="添加索引"></a>添加索引</h3><p>就可以让它根据索引来选择，不用全表扫描</p>
<p>加索引的时候是和报表有关的</p>
<p>索引一般是加到经常使用的维度字段的</p>
<p><code>create index test_salt_index1 on test.test_salt(name,age);</code></p>
<figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span>: jdbc:phoenix:&gt; create index test_salt_index1 <span class="keyword">ON</span> test.test_salt(<span class="keyword">name</span>,age);</span><br><span class="line"><span class="symbol">5 </span>rows affected (<span class="number">6.274</span> seconds)</span><br><span class="line"><span class="number">0</span>: jdbc:phoenix:&gt; </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>但是创建索引之后，要是不使用是没有用的</p>
<p>有的sql是走索引的 有的是不走的</p>
<p>执行以下语句</p>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">0: jdbc:phoenix:&gt; explain select * from test.test_salt;</span></span><br><span class="line"><span class="section">+-------------------------------------------------------------------------+----------------+---------------+-------------+</span></span><br><span class="line"><span class="section">|                                  PLAN                                   | EST_BYTES_READ | EST_ROWS_READ | EST_INFO_TS |</span></span><br><span class="line"><span class="section">+-------------------------------------------------------------------------+----------------+---------------+-------------+</span></span><br><span class="line"><span class="section">| CLIENT 3-CHUNK PARALLEL 3-WAY ROUND ROBIN FULL SCAN OVER TEST:TEST_SALT | null           | null          | null        |</span></span><br><span class="line"><span class="section">+-------------------------------------------------------------------------+----------------+---------------+-------------+</span></span><br><span class="line">1 row selected (0.021 seconds)</span><br><span class="line"><span class="section">0: jdbc:phoenix:&gt; explain select * from test.test_salt where name = &#x27;zs&#x27;;</span></span><br><span class="line"><span class="section">+-------------------------------------------------------------------------+----------------+---------------+-------------+</span></span><br><span class="line"><span class="section">|                                  PLAN                                   | EST_BYTES_READ | EST_ROWS_READ | EST_INFO_TS |</span></span><br><span class="line"><span class="section">+-------------------------------------------------------------------------+----------------+---------------+-------------+</span></span><br><span class="line">| CLIENT 3-CHUNK PARALLEL 3-WAY ROUND ROBIN FULL SCAN OVER TEST:TEST_SALT | null           | null          | null        |</span><br><span class="line"><span class="section">|     SERVER FILTER BY NAME = &#x27;zs&#x27;                                        | null           | null          | null        |</span></span><br><span class="line"><span class="section">+-------------------------------------------------------------------------+----------------+---------------+-------------+</span></span><br><span class="line">2 rows selected (0.019 seconds)</span><br><span class="line">0: jdbc:phoenix:&gt; </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这些都是全表扫描的因为有FULL SCAN</p>
<p>正常如果带*都是不走索引的，我们要选择索引字段，才会走索引</p>
<p>如下：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span>: jdbc:phoenix:&gt; <span class="keyword">explain</span> <span class="keyword">select</span> <span class="type">name</span> <span class="keyword">from</span> test.test_salt; </span><br><span class="line">+<span class="comment">--------------------------------------------------------------------------------+----------------+---------------+-------------+</span></span><br><span class="line">|                                      PLAN                                      | EST_BYTES_READ | EST_ROWS_READ | EST_INFO_TS |</span><br><span class="line">+<span class="comment">--------------------------------------------------------------------------------+----------------+---------------+-------------+</span></span><br><span class="line">| CLIENT <span class="number">3</span>-CHUNK PARALLEL <span class="number">3</span>-WAY ROUND ROBIN <span class="keyword">FULL</span> SCAN <span class="keyword">OVER</span> TEST:TEST_SALT_INDEX1 | <span class="keyword">null</span>           | <span class="keyword">null</span>          | <span class="keyword">null</span>        |</span><br><span class="line">|     <span class="keyword">SERVER</span> <span class="keyword">FILTER</span> <span class="keyword">BY</span> FIRST KEY <span class="keyword">ONLY</span>                                            | <span class="keyword">null</span>           | <span class="keyword">null</span>          | <span class="keyword">null</span>        |</span><br><span class="line">+<span class="comment">--------------------------------------------------------------------------------+----------------+---------------+-------------+</span></span><br><span class="line"><span class="number">2</span> <span class="keyword">rows</span> selected (<span class="number">0.071</span> seconds)</span><br><span class="line"><span class="number">0</span>: jdbc:phoenix:&gt; <span class="keyword">explain</span> <span class="keyword">select</span> age <span class="keyword">from</span> test.test_salt;</span><br><span class="line">+<span class="comment">--------------------------------------------------------------------------------+----------------+---------------+-------------+</span></span><br><span class="line">|                                      PLAN                                      | EST_BYTES_READ | EST_ROWS_READ | EST_INFO_TS |</span><br><span class="line">+<span class="comment">--------------------------------------------------------------------------------+----------------+---------------+-------------+</span></span><br><span class="line">| CLIENT <span class="number">3</span>-CHUNK PARALLEL <span class="number">3</span>-WAY ROUND ROBIN <span class="keyword">FULL</span> SCAN <span class="keyword">OVER</span> TEST:TEST_SALT_INDEX1 | <span class="keyword">null</span>           | <span class="keyword">null</span>          | <span class="keyword">null</span>        |</span><br><span class="line">|     <span class="keyword">SERVER</span> <span class="keyword">FILTER</span> <span class="keyword">BY</span> FIRST KEY <span class="keyword">ONLY</span>                                            | <span class="keyword">null</span>           | <span class="keyword">null</span>          | <span class="keyword">null</span>        |</span><br><span class="line">+<span class="comment">--------------------------------------------------------------------------------+----------------+---------------+-------------+</span></span><br><span class="line"><span class="number">2</span> <span class="keyword">rows</span> selected (<span class="number">0.015</span> seconds)</span><br><span class="line"><span class="number">0</span>: jdbc:phoenix:&gt; <span class="keyword">explain</span> <span class="keyword">select</span> age,<span class="type">name</span> <span class="keyword">from</span> test.test_salt;</span><br><span class="line">+<span class="comment">--------------------------------------------------------------------------------+----------------+---------------+-------------+</span></span><br><span class="line">|                                      PLAN                                      | EST_BYTES_READ | EST_ROWS_READ | EST_INFO_TS |</span><br><span class="line">+<span class="comment">--------------------------------------------------------------------------------+----------------+---------------+-------------+</span></span><br><span class="line">| CLIENT <span class="number">3</span>-CHUNK PARALLEL <span class="number">3</span>-WAY ROUND ROBIN <span class="keyword">FULL</span> SCAN <span class="keyword">OVER</span> TEST:TEST_SALT_INDEX1 | <span class="keyword">null</span>           | <span class="keyword">null</span>          | <span class="keyword">null</span>        |</span><br><span class="line">|     <span class="keyword">SERVER</span> <span class="keyword">FILTER</span> <span class="keyword">BY</span> FIRST KEY <span class="keyword">ONLY</span>                                            | <span class="keyword">null</span>           | <span class="keyword">null</span>          | <span class="keyword">null</span>        |</span><br><span class="line">+<span class="comment">--------------------------------------------------------------------------------+----------------+---------------+-------------+</span></span><br><span class="line"><span class="number">2</span> <span class="keyword">rows</span> selected (<span class="number">0.022</span> seconds)</span><br><span class="line"><span class="number">0</span>: jdbc:phoenix:&gt; <span class="keyword">explain</span> <span class="keyword">select</span> age,<span class="type">name</span> <span class="keyword">from</span> test.test_salt <span class="keyword">where</span> <span class="type">name</span> = <span class="string">&#x27;zs&#x27;</span>;</span><br><span class="line">+<span class="comment">-----------------------------------------------------------------------------------------------------+----------------+---------------+-------------+</span></span><br><span class="line">|                                                PLAN                                                 | EST_BYTES_READ | EST_ROWS_READ | EST_INFO_TS |</span><br><span class="line">+<span class="comment">-----------------------------------------------------------------------------------------------------+----------------+---------------+-------------+</span></span><br><span class="line">| CLIENT <span class="number">3</span>-CHUNK PARALLEL <span class="number">3</span>-WAY ROUND ROBIN RANGE SCAN <span class="keyword">OVER</span> TEST:TEST_SALT_INDEX1 [<span class="number">0</span>,<span class="string">&#x27;zs&#x27;</span>] - [<span class="number">2</span>,<span class="string">&#x27;zs&#x27;</span>] | <span class="keyword">null</span>           | <span class="keyword">null</span>          | <span class="keyword">null</span>        |</span><br><span class="line">|     <span class="keyword">SERVER</span> <span class="keyword">FILTER</span> <span class="keyword">BY</span> FIRST KEY <span class="keyword">ONLY</span>                                                                 | <span class="keyword">null</span>           | <span class="keyword">null</span>          | <span class="keyword">null</span>        |</span><br><span class="line">+<span class="comment">-----------------------------------------------------------------------------------------------------+----------------+---------------+-------------+</span></span><br><span class="line"><span class="number">2</span> <span class="keyword">rows</span> selected (<span class="number">0.016</span> seconds)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>如上述：</p>
<p>我们如果想使用索引，则要在判断条件里加上索引字段，要不然就不会使用索引</p>
<p>phoenix和mysql的索引是不一样的，phoenix的索引是以表存在底层的，mysql是不会存在的</p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">0: jdbc:phoenix:&gt; !tables</span><br><span class="line">+-----------+-------------+------------------+--------------+---------+-----------+---------------------------+----------------+-------------+----------------+--------------+--------------+----------------+--+</span><br><span class="line">|<span class="string"> TABLE_CAT </span>|<span class="string"> TABLE_SCHEM </span>|<span class="string">    TABLE_NAME    </span>|<span class="string">  TABLE_TYPE  </span>|<span class="string"> REMARKS </span>|<span class="string"> TYPE_NAME </span>|<span class="string"> SELF_REFERENCING_COL_NAME </span>|<span class="string"> REF_GENERATION </span>|<span class="string"> INDEX_STATE </span>|<span class="string"> IMMUTABLE_ROWS </span>|<span class="string"> SALT_BUCKETS </span>|<span class="string"> MULTI_TENANT </span>|<span class="string"> VIEW_STATEMENT </span>|<span class="string">  </span>|</span><br><span class="line">+-----------+-------------+------------------+--------------+---------+-----------+---------------------------+----------------+-------------+----------------+--------------+--------------+----------------+--+</span><br><span class="line">|<span class="string">           </span>|<span class="string"> TEST        </span>|<span class="string"> TEST_SALT_INDEX1 </span>|<span class="string"> INDEX        </span>|<span class="string">         </span>|<span class="string">           </span>|<span class="string">                           </span>|<span class="string">                </span>|<span class="string"> ACTIVE      </span>|<span class="string"> false          </span>|<span class="string"> 3            </span>|<span class="string"> false        </span>|<span class="string">                </span>|<span class="string">  </span></span><br></pre></td></tr></table></figure>

<p>查看里面的内容如下</p>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">0: jdbc:phoenix:&gt; select * from test.TEST_SALT_INDEX1;</span></span><br><span class="line"><span class="section">+---------+-------+-----+</span></span><br><span class="line"><span class="section">| 0:NAME  | 0:AGE | :ID |</span></span><br><span class="line"><span class="section">+---------+-------+-----+</span></span><br><span class="line">| dam     | 15    | 4   |</span><br><span class="line">| huamul  | 14    | 5   |</span><br><span class="line">| zs      | 13    | 1   |</span><br><span class="line">| zlisi   | 11    | 2   |</span><br><span class="line"><span class="section">| wanghwu | 18    | 3   |</span></span><br><span class="line"><span class="section">+---------+-------+-----+</span></span><br><span class="line">5 rows selected (0.043 seconds)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>上述自动把id加上了，是因为id是主键，就是hbase里的rowkey</p>
<p>加索引快的原因 &#x3D;&gt; 是把hbase里的rowkey再次进行索引，原本hbase里的rowkey就是相当于一层索引的</p>
<p>这个也就是phoenix的索引被称为二级索引的原因</p>
<p>触发索引流程：</p>
<ul>
<li>先去索引表，然后找到对应的rowkey</li>
<li>然后通过这个rowkey &#x3D;&gt; 进行精准的get操作</li>
</ul>
<p>但是当数据越来越多的时候，索引表也会越来越多，我们该如何解决？</p>
<p>我现在的想法是给这个索引表再创建索引</p>
<p>问！</p>
<h1 id="phoenix和hive打通"><a href="#phoenix和hive打通" class="headerlink" title="phoenix和hive打通"></a>phoenix和hive打通</h1><p>hbase + hive 打通</p>
<p>phoenix + hive 打通</p>
<p>我们选择下面的那种，因为hbase的数据结构到hive里可能会出问题<a target="_blank" rel="noopener" href="https://phoenix.apache.org/hive_storage_handler.html">官网</a></p>
<p>他是有要求的</p>
<ul>
<li>phoenix 4.8+</li>
<li>hive 1.2+</li>
</ul>

      
    </div>

    
    
    

      
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://zihang.fun/2001/02/13/%E6%95%B0%E4%BB%93/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="liu zihang">
      <meta itemprop="description" content="只有努力不会辜负你">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="枫叶冢">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2001/02/13/%E6%95%B0%E4%BB%93/" class="post-title-link" itemprop="url">数仓</a>
        </h2>

        <div class="post-meta">
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2001-02-13 00:00:00" itemprop="dateCreated datePublished" datetime="2001-02-13T00:00:00+08:00">2001-02-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-02-15 09:12:24" itemprop="dateModified" datetime="2023-02-15T09:12:24+08:00">2023-02-15</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%97%A5%E5%BF%97/" itemprop="url" rel="index"><span itemprop="name">日志</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>1.2k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    

   

    <div class="post-body" itemprop="articleBody">

      
          <h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>正常的数据：</p>
<ul>
<li>日志</li>
<li>业务</li>
<li>其他</li>
</ul>
<p>数仓可以做的功能：</p>
<ul>
<li>数据报表：显示数据</li>
<li>用户画像：就是按照消费能力分组</li>
<li>做推荐系统</li>
<li>机器&#x2F;深度学习 ： 预测走向</li>
<li>风控：风险控制 -&gt; 例子：薅羊毛太多进黑名单</li>
</ul>
<p>电商行业为列：</p>
<ul>
<li>展示商品都是业务数据-&gt;存放在业务数据库 mysql&#x2F;es</li>
<li>用户与页面交互的时候发送的数据，据说作用在html上的操作数据，甚至是鼠标停留时间</li>
<li>其他数据包括-&gt; 线下的一些行为，比如签单等，或者excel，hdfs，redis，mongo等</li>
</ul>
<p>数据仓库：</p>
<ul>
<li>数据采集</li>
<li>数仓建设 0-1</li>
<li>数据可视化</li>
</ul>
<p>技术选型：</p>
<ul>
<li>数据采集：flume日志，业务sqoop，datax，自己开发</li>
<li>数据存储：hdfs，hbase，mysql，clickhouse，drios</li>
<li>数据计算：hive，spark，flink，hbase-&gt; phonix</li>
<li>数据可视化：superset&#x2F;dataeases echarts quickbi datav sugar</li>
<li>任务调度：xxl dolphin airflow azkzban oozie 自己开发</li>
<li>报警系统：手写钉钉报警 微信 电话 邮箱 zabbix 普罗米修斯</li>
<li>元数据管理：任务元数据 管理 -&gt; 可做可不做 atlas datahub 自己开发 -&gt; 看airflow里或者原生的antlr4&#x2F;calicete</li>
<li>临时查询工具：ad-hoc 即席查询 -&gt; presto ,sparksql ,kylin ,impala,druid ,phonix</li>
</ul>
<p>impala + kudu &#x3D;&gt; 数仓</p>
<p>hive &#x3D;&gt;  数仓</p>
<p>hbase &#x3D;&gt; 数仓</p>
<p>数据湖 &#x3D;&gt; 数仓</p>
<p>流程 ：</p>
<p>app 产生数据 ：</p>
<ul>
<li>业务数据 ：sqoop&#x2F;datax&#x2F;自己开发的 -&gt; hive&#x2F;hdfs -&gt; 数据分层 -&gt; myqsl&#x2F;Ck -&gt; 可视化</li>
<li>日志数据 ：用户触发埋点则产生日志数据 -&gt; 存到日志落盘机 -&gt; flume -&gt; hdfs（离线）&#x2F;kafka-flume-hdfs(半实时) -&gt; 数据分层-&gt; mysql&#x2F;Ck -&gt; 可视化</li>
</ul>
<p>离线数仓：我们要做的</p>
<ul>
<li>数据采集</li>
<li>数仓搭建</li>
<li>数据质量监控</li>
</ul>
<p>离线数仓：</p>
<ul>
<li>数据分层<ul>
<li>ods operation data store &#x3D;&gt; 原数据层</li>
<li>dw 层<ul>
<li>dwd data warehouse detail： 数据明细层 etl</li>
<li>dwm data warehouse middle：去重以及确定指标需求</li>
<li>dws  data warehouse serive:   构建宽表的</li>
</ul>
</li>
<li>ads&#x2F;rpt层：application data store -&gt; 数据应用层<ul>
<li>出结果的基于dws层<ul>
<li>各个维度的结果表</li>
<li>维度聚合形成的结果表</li>
</ul>
</li>
</ul>
</li>
<li>dim 维度层<ul>
<li>业务字段不够，要补充的表的位置</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>为什么要进行数据分层：</p>
<ul>
<li>复杂问题简单化</li>
<li>增加数据复用性</li>
<li>减少代码运行时间</li>
<li>隔离原始数据 ： 个别公司访问数据有权限</li>
<li>校验数据</li>
</ul>
<p>数据仓库的分层不是越多越好，合理设计最重要</p>

      
    </div>

    
    
    

      
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://zihang.fun/2001/01/16/tool/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="liu zihang">
      <meta itemprop="description" content="只有努力不会辜负你">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="枫叶冢">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2001/01/16/tool/" class="post-title-link" itemprop="url">tool</a>
        </h2>

        <div class="post-meta">
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2001-01-16 17:00:00" itemprop="dateCreated datePublished" datetime="2001-01-16T17:00:00+08:00">2001-01-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-02-02 21:59:24" itemprop="dateModified" datetime="2023-02-02T21:59:24+08:00">2023-02-02</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%97%A5%E5%BF%97/" itemprop="url" rel="index"><span itemprop="name">日志</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>37k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>33 分钟</span>
            </span>

        </div>
      </header>

    
    
    

   

    <div class="post-body" itemprop="articleBody">

      
          <p>这里放的都是我自己写的各种简单的应用包</p>
<h1 id="spark"><a href="#spark" class="headerlink" title="spark"></a>spark</h1><h2 id="tool-readfiles"><a href="#tool-readfiles" class="headerlink" title="tool.readfiles"></a>tool.readfiles</h2><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">package tool</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.<span class="keyword">sql</span>.&#123;DataFrame, SparkSession&#125;</span><br><span class="line"><span class="keyword">import</span> com.crealytics.spark.excel._</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.<span class="keyword">sql</span></span><br><span class="line"><span class="keyword">class</span> readfile &#123;</span><br><span class="line"></span><br><span class="line">  def getmysqldataframe(sparkSession: SparkSession,string: String*) =&#123;</span><br><span class="line"></span><br><span class="line">    val <span class="keyword">sql</span> = string(<span class="number">3</span>)</span><br><span class="line">    val frame: DataFrame = sparkSession.<span class="keyword">read</span>.format(&quot;jdbc&quot;).<span class="keyword">options</span>(Map(&quot;url&quot; -&gt; string(<span class="number">0</span>), &quot;user&quot; -&gt; string(<span class="number">1</span>), &quot;password&quot; -&gt; string(<span class="number">2</span>), &quot;dbtable&quot; -&gt; s&quot;($sql) as tmp&quot;,&quot;driver&quot;-&gt;string(<span class="number">4</span>))).<span class="keyword">load</span>()</span><br><span class="line">    frame</span><br><span class="line">    //    <span class="keyword">if</span> (string(<span class="number">3</span>).contains(&quot; &quot;)) &#123;</span><br><span class="line">    //      val <span class="keyword">sql</span> = string(<span class="number">3</span>)</span><br><span class="line">    //      val frame = sparkSession.<span class="keyword">read</span>.format(&quot;jdbc&quot;).<span class="keyword">options</span>(Map(&quot;url&quot; -&gt; string(<span class="number">0</span>), &quot;user&quot; -&gt; string(<span class="number">1</span>), &quot;password&quot; -&gt; string(<span class="number">2</span>), &quot;dbtable&quot; -&gt; s&quot;$sql&quot;)).<span class="keyword">load</span>()</span><br><span class="line">    //      frame</span><br><span class="line">    //    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">    //      val frame = sparkSession.<span class="keyword">read</span>.format(&quot;jdbc&quot;).<span class="keyword">options</span>(Map(&quot;url&quot; -&gt; string(<span class="number">0</span>), &quot;user&quot; -&gt; string(<span class="number">1</span>), &quot;password&quot; -&gt; string(<span class="number">2</span>), &quot;dbtable&quot; -&gt; string(<span class="number">3</span>))).<span class="keyword">load</span>()</span><br><span class="line">    //      frame</span><br><span class="line">    //    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  def getmyqsldffromMap(sparkSession: SparkSession,map: Map[String,String])=&#123;</span><br><span class="line">    sparkSession.<span class="keyword">read</span>.format(&quot;jdbc&quot;).<span class="keyword">options</span>(map).<span class="keyword">load</span>()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  def readexcel(sparkSession: SparkSession,string: String*)=&#123;</span><br><span class="line">    sparkSession.<span class="keyword">read</span>.excel(<span class="keyword">header</span> = string(<span class="number">0</span>).toBoolean,inferSchema = string(<span class="number">1</span>).toBoolean).<span class="keyword">load</span>(string(<span class="number">3</span>))</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  def readxxxfile(sparkSession: SparkSession,string: String*) =&#123;</span><br><span class="line">    sparkSession.<span class="keyword">read</span>.format(string(<span class="number">0</span>)).<span class="keyword">load</span>(string(<span class="number">1</span>))</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="tool-savefile"><a href="#tool-savefile" class="headerlink" title="tool.savefile"></a>tool.savefile</h2><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line">package tool</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.<span class="keyword">sql</span>.&#123;DataFrame, DataFrameWriter, SparkSession&#125;</span><br><span class="line"><span class="keyword">import</span> com.crealytics.spark.excel._</span><br><span class="line"><span class="keyword">import</span> org.apache.poi.ss.formula.<span class="keyword">functions</span>.T</span><br><span class="line"><span class="keyword">import</span> tool.readfile</span><br><span class="line"><span class="keyword">import</span> tool.getjdbcconnect</span><br><span class="line"><span class="keyword">class</span> savefile()&#123;</span><br><span class="line">  private val jdbcconnect = <span class="built_in">new</span> getjdbcconnect</span><br><span class="line"></span><br><span class="line">  private val mysqldf = <span class="built_in">new</span> getmysqldf</span><br><span class="line">  def saveexcel(spark: DataFrame, string: <span class="keyword">Array</span>[String]) = &#123;</span><br><span class="line">    spark.<span class="keyword">write</span>.mode(string(<span class="number">2</span>)).excel(<span class="keyword">header</span> = string(<span class="number">4</span>).toBoolean,string(<span class="number">5</span>),string(<span class="number">6</span>),string(<span class="number">7</span>),string(<span class="number">8</span>)).save(string(<span class="number">3</span>))</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  def savetojdbc(spark: SparkSession,df: DataFrame, url:String,<span class="keyword">user</span>:String,<span class="keyword">password</span>:String,dbtable:String,driver:String,mideng:String,mode:String)=&#123;</span><br><span class="line">    val map = Map(&quot;url&quot; -&gt; url,</span><br><span class="line">      &quot;user&quot; -&gt; <span class="keyword">user</span>,</span><br><span class="line">      &quot;password&quot; -&gt; <span class="keyword">password</span>,</span><br><span class="line">      &quot;dbtable&quot; -&gt; dbtable,</span><br><span class="line">      &quot;driver&quot;-&gt; driver)</span><br><span class="line"></span><br><span class="line">//    df.<span class="keyword">write</span>.mode(string(<span class="number">2</span>)).format(string(<span class="number">1</span>)).<span class="keyword">options</span>(map).save()</span><br><span class="line">    // <span class="comment">-------------------------------------幂等性</span></span><br><span class="line">    val <span class="keyword">connection</span> = jdbcconnect.getconncet(driver,url,<span class="keyword">user</span>,<span class="keyword">password</span>)</span><br><span class="line">    try&#123;</span><br><span class="line">      val <span class="type">bool</span> = <span class="keyword">connection</span>.createStatement().executeQuery(s&quot;show tables like &#x27;$&#123;dbtable&#125;&#x27;&quot;).next()</span><br><span class="line">      <span class="keyword">if</span> (!<span class="type">bool</span>)&#123;</span><br><span class="line">        throw <span class="built_in">new</span> NullPointerException(s&quot;写入的结果表$&#123;dbtable&#125; 尚未创建！！！&quot;)</span><br><span class="line">      &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        var flag:<span class="keyword">Any</span> = <span class="keyword">null</span></span><br><span class="line">        val flagbool = mysqldf.getmyqsldffromMap(spark, map).<span class="keyword">select</span>(mideng).isEmpty</span><br><span class="line">        <span class="keyword">if</span> (!flagbool)&#123;</span><br><span class="line">         flag = mysqldf.getmyqsldffromMap(spark, map).<span class="keyword">select</span>(mideng).tail(<span class="number">1</span>)(<span class="number">0</span>)(<span class="number">0</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        val tmpresult = df.<span class="keyword">select</span>(mideng).<span class="keyword">filter</span>(<span class="type">line</span> =&gt; &#123;</span><br><span class="line">          <span class="type">line</span>.getString(<span class="number">0</span>) != flag</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (df.isEmpty)&#123;</span><br><span class="line">          println(&quot;数据集为空&quot;)</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">          <span class="keyword">if</span> (tmpresult.isEmpty)&#123;</span><br><span class="line">            println(&quot;你的数据已经插入过&quot;)</span><br><span class="line">            df.<span class="keyword">show</span>(<span class="keyword">false</span>)</span><br><span class="line">          &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">//            df.<span class="keyword">show</span>()</span><br><span class="line">//            println(df.count())</span><br><span class="line">            //val insertresult = tmpresult.<span class="keyword">join</span>(df, string(<span class="number">5</span>))</span><br><span class="line">            tmpresult.<span class="keyword">show</span>()</span><br><span class="line">            println(tmpresult.count())</span><br><span class="line">//            insertresult.<span class="keyword">show</span>()</span><br><span class="line">//            println(insertresult.count())</span><br><span class="line">            tmpresult.<span class="keyword">write</span>.mode(mode).format(&quot;jdbc&quot;).<span class="keyword">options</span>(map).save()</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;finally &#123;</span><br><span class="line">      <span class="keyword">connection</span>.<span class="keyword">close</span>()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  def savetohiveapi(sparkSession: SparkSession,<span class="type">boolean</span>: <span class="type">Boolean</span>,spark: DataFrame,hivetable:String,mode:String,hivepartition:String,changecolnums:<span class="type">Boolean</span>) = &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!<span class="type">boolean</span>)&#123;</span><br><span class="line">      <span class="keyword">if</span> (hivepartition != <span class="keyword">null</span>)&#123;</span><br><span class="line">        spark.<span class="keyword">write</span>.partitionBy(hivepartition.split(&quot;,&quot;):_*).mode(mode).format(&quot;hive&quot;).saveAsTable(hivetable)</span><br><span class="line">      &#125;<span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">        println(hivetable)</span><br><span class="line">        println(hivepartition)</span><br><span class="line">        spark.<span class="keyword">write</span>.mode(mode).format(&quot;hive&quot;).saveAsTable(hivetable)</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      changecolnums match &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="keyword">true</span> =&gt;  &#123;</span><br><span class="line">          <span class="keyword">if</span> (hivepartition != <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(sparkSession.<span class="keyword">table</span>(hivetable).<span class="keyword">columns</span>.length != spark.<span class="keyword">columns</span>.length)&#123;</span><br><span class="line">             sparkSession.<span class="keyword">sql</span>(</span><br><span class="line">               s&quot;&quot;&quot;</span><br><span class="line">                 |drop table $&#123;hivetable&#125;</span><br><span class="line">                 |&quot;&quot;&quot;.stripMargin)</span><br><span class="line">            &#125;</span><br><span class="line">            spark.<span class="keyword">write</span>.partitionBy(hivepartition.split(&quot;,&quot;):_*).mode(mode).format(&quot;hive&quot;).saveAsTable(hivetable)</span><br><span class="line">          &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            spark.<span class="keyword">write</span>.mode(mode).format(&quot;hive&quot;).saveAsTable(hivetable)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="keyword">false</span> =&gt; spark.<span class="keyword">write</span>.mode(mode).format(&quot;hive&quot;).insertInto(hivetable)</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      spark.<span class="keyword">show</span>()</span><br><span class="line">      println(spark.count())</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  def savetohivelocalsource =&#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  def saveastextOrcsvOrjson(spark: DataFrame, string: <span class="keyword">Array</span>[String],map: Map[String,String])= &#123;</span><br><span class="line"></span><br><span class="line">      map.isEmpty match &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="keyword">true</span> =&gt; spark.<span class="keyword">write</span>.mode(string(<span class="number">2</span>)).format(string(<span class="number">1</span>)).save(string(<span class="number">3</span>))</span><br><span class="line">        <span class="keyword">case</span> <span class="keyword">false</span> =&gt; spark.<span class="keyword">write</span>.mode(string(<span class="number">2</span>)).<span class="keyword">options</span>(map).format(string(<span class="number">1</span>)).save(string(<span class="number">3</span>))</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="tool-sqlUtils"><a href="#tool-sqlUtils" class="headerlink" title="tool.sqlUtils"></a>tool.sqlUtils</h2><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br></pre></td><td class="code"><pre><span class="line">package tool</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.System</span><br><span class="line"><span class="keyword">import</span> java.util</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.sql.types.&#123;ArrayType, BooleanType, ByteType, CharType, DataType, DateType, DecimalType, DoubleType, FloatType, IntegerType, LongType, MapType, ShortType, StringType, StructField, StructType, TimestampType&#125;</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.sql.&#123;DataFrame, SparkSession&#125;</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.sql.functions._</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">sqlUtils</span> </span>&#123;</span><br><span class="line">  def hivesqlchoose(hiveconclumns:<span class="built_in">String</span>,hivetable:<span class="built_in">String</span>,hiveoptions:<span class="built_in">String</span>)=&#123;</span><br><span class="line"></span><br><span class="line">    <span class="string">&quot;select&quot;</span> + <span class="string">&quot; &quot;</span> + hiveconclumns + <span class="string">&quot; &quot;</span> + <span class="string">&quot;from&quot;</span> + <span class="string">&quot; &quot;</span> +  hiveconclumns + <span class="string">&quot; &quot;</span> + hiveoptions</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  def descfunctionsql(string: <span class="built_in">String</span>)=&#123;</span><br><span class="line">    s<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">       |desc function extended <span class="subst">$string</span></span></span><br><span class="line"><span class="string">       |&quot;&quot;&quot;</span>.stripMargin</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  def checksql(spark:SparkSession, string: <span class="built_in">String</span>)=&#123;</span><br><span class="line">    spark.sql(string)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">  def mkcreatesql(source:DataFrame,tablename:<span class="built_in">String</span>,fileformat:<span class="built_in">String</span>,otheroptions:<span class="built_in">String</span>*) =&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> arraycolunmstmp:Seq[StructField]= <span class="keyword">null</span></span><br><span class="line">    <span class="keyword">var</span> arrayconcloumnspartition:Seq[StructField] = <span class="keyword">null</span></span><br><span class="line">    <span class="keyword">if</span> (otheroptions.length &gt; <span class="number">1</span>)&#123;</span><br><span class="line">      arraycolunmstmp=  source.schema.filter(x=&gt;&#123;</span><br><span class="line">        !otheroptions(<span class="number">1</span>).split(<span class="string">&quot;,&quot;</span>).contains(x.name)</span><br><span class="line">      &#125;)</span><br><span class="line">      arrayconcloumnspartition = source.schema.filter(x=&gt;&#123;</span><br><span class="line">        otheroptions(<span class="number">1</span>).split(<span class="string">&quot;,&quot;</span>).contains(x.name)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      arraycolunmstmp = source.schema.filter(x=&gt;&#123;</span><br><span class="line">        !otheroptions(<span class="number">0</span>).split(<span class="string">&quot;,&quot;</span>).contains(x.name)</span><br><span class="line">      &#125;)</span><br><span class="line">      arrayconcloumnspartition = source.schema.filter(x=&gt;&#123;</span><br><span class="line">        otheroptions(<span class="number">0</span>).split(<span class="string">&quot;,&quot;</span>).contains(x.name)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    def schematohivedatatype(rraycolunmstmp:Seq[StructField]) =&#123;</span><br><span class="line">      rraycolunmstmp.map(total =&gt; &#123;</span><br><span class="line">        println(total.name)</span><br><span class="line">        println(total.dataType)</span><br><span class="line">        val resultString1 = total.dataType match &#123;</span><br><span class="line">          <span class="keyword">case</span> StringType =&gt; <span class="string">&quot;string&quot;</span></span><br><span class="line">          <span class="keyword">case</span> BooleanType =&gt; <span class="string">&quot;boolean&quot;</span></span><br><span class="line">          <span class="keyword">case</span> TimestampType =&gt; <span class="string">&quot;timestamp&quot;</span></span><br><span class="line">          <span class="keyword">case</span> ByteType =&gt; <span class="string">&quot;byte&quot;</span></span><br><span class="line">          <span class="keyword">case</span> DoubleType =&gt; <span class="string">&quot;Double&quot;</span></span><br><span class="line">          <span class="keyword">case</span> FloatType =&gt; <span class="string">&quot;Float&quot;</span></span><br><span class="line">          <span class="keyword">case</span> IntegerType =&gt; <span class="string">&quot;Int&quot;</span></span><br><span class="line">          <span class="keyword">case</span> LongType =&gt; <span class="string">&quot;bigint&quot;</span></span><br><span class="line">          <span class="keyword">case</span> ShortType =&gt; <span class="string">&quot;smallint&quot;</span></span><br><span class="line">          <span class="keyword">case</span> DecimalType() =&gt; <span class="string">&quot;decimal(38,2)&quot;</span></span><br><span class="line">          <span class="keyword">case</span> DateType =&gt; <span class="string">&quot;datetime&quot;</span></span><br><span class="line"></span><br><span class="line">          <span class="keyword">case</span> ArrayType(BooleanType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;array&lt;boolean&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> ArrayType(IntegerType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;array&lt;int&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> ArrayType(TimestampType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;array&lt;timestamp&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> ArrayType(DoubleType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;array&lt;double&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> ArrayType(FloatType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;array&lt;float&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> ArrayType(LongType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;array&lt;bigint&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> ArrayType(ShortType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;array&lt;smallint&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> ArrayType(ByteType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;array&lt;byte&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> ArrayType(StringType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;array&lt;string&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> ArrayType(DateType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;array&lt;datetime&gt;&quot;</span></span><br><span class="line"></span><br><span class="line">          <span class="keyword">case</span> MapType(StringType, StringType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;string,string&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(StringType, IntegerType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;string,int&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(IntegerType, StringType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;int,string&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(StringType, BooleanType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;string,boolean&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(IntegerType, BooleanType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;int,boolean&gt;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">          <span class="keyword">case</span> MapType(BooleanType, BooleanType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;boolean,boolean&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(BooleanType, StringType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;boolean,string&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(BooleanType, IntegerType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;boolean,int&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(BooleanType, FloatType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;boolean,float&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(BooleanType, LongType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;boolean,bigint&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(BooleanType, ShortType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;boolean,smallint&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(BooleanType, TimestampType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;boolean,timestamp&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(BooleanType, ByteType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;boolean,byte&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(BooleanType, DoubleType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;boolean,double&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(BooleanType, DateType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;boolean,datetime&gt;&quot;</span></span><br><span class="line"></span><br><span class="line">          <span class="keyword">case</span> MapType(BooleanType, ArrayType(BooleanType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;boolean,array&lt;boolean&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(BooleanType, ArrayType(TimestampType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;boolean,array&lt;timestamp&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(BooleanType, ArrayType(DoubleType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;boolean,array&lt;double&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(BooleanType, ArrayType(FloatType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;boolean,array&lt;Float&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(BooleanType, ArrayType(LongType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;boolean,array&lt;bigint&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(BooleanType, ArrayType(ShortType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;boolean,array&lt;smallint&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(BooleanType, ArrayType(ByteType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;boolean,array&lt;byte&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(BooleanType, ArrayType(StringType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;boolean,array&lt;string&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(BooleanType, ArrayType(IntegerType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;boolean,array&lt;int&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(BooleanType, DateType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;boolean,array&lt;datetime&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(BooleanType, StructType(fields: Array[StructField]), <span class="keyword">true</span>) =&gt; s<span class="string">&quot;map&lt;boolean,struct&lt;<span class="subst">$&#123;fields&#125;</span>&gt;&gt;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">          <span class="keyword">case</span> MapType(IntegerType, BooleanType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;int,boolean&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(IntegerType, StringType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;int,string&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(IntegerType, IntegerType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;int,int&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(IntegerType, FloatType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;int,float&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(IntegerType, LongType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;int,bigint&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(IntegerType, ShortType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;int,smallint&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(IntegerType, TimestampType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;int,timestamp&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(IntegerType, ByteType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;int,byte&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(IntegerType, DoubleType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;int,double&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(IntegerType, DateType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;int,datetime&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(IntegerType, ArrayType(BooleanType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;int,array&lt;boolean&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(IntegerType, ArrayType(TimestampType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;int,array&lt;timestamp&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(IntegerType, ArrayType(DoubleType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;int,array&lt;double&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(IntegerType, ArrayType(FloatType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;int,array&lt;Float&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(IntegerType, ArrayType(LongType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;int,array&lt;bigint&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(IntegerType, ArrayType(ShortType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;int,array&lt;smallint&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(IntegerType, ArrayType(ByteType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;int,array&lt;byte&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(IntegerType, ArrayType(StringType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;int,array&lt;string&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(IntegerType, ArrayType(IntegerType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;int,array&lt;int&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(IntegerType, ArrayType(DateType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;int,array&lt;datetime&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(IntegerType, StructType(fields: Array[StructField]), <span class="keyword">true</span>) =&gt; s<span class="string">&quot;map&lt;int,struct&lt;<span class="subst">$&#123;fields&#125;</span>&gt;&gt;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">          <span class="keyword">case</span> MapType(FloatType, BooleanType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;float,boolean&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(FloatType, StringType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;float,string&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(FloatType, IntegerType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;float,int&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(FloatType, FloatType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;float,float&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(FloatType, LongType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;float,bigint&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(FloatType, ShortType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;float,smallint&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(FloatType, TimestampType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;float,timestamp&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(FloatType, ByteType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;float,byte&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(FloatType, DoubleType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;float,double&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(FloatType, DateType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;float,datetime&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(FloatType, ArrayType(BooleanType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;float,array&lt;boolean&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(FloatType, ArrayType(TimestampType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;float,array&lt;timestamp&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(FloatType, ArrayType(DoubleType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;float,array&lt;double&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(FloatType, ArrayType(FloatType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;float,array&lt;Float&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(FloatType, ArrayType(LongType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;float,array&lt;bigint&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(FloatType, ArrayType(ShortType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;float,array&lt;smallint&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(FloatType, ArrayType(ByteType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;float,array&lt;byte&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(FloatType, ArrayType(StringType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;float,array&lt;string&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(FloatType, ArrayType(IntegerType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;float,array&lt;int&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(FloatType, ArrayType(DateType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;float,array&lt;datetime&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(FloatType, StructType(fields: Array[StructField]), <span class="keyword">true</span>) =&gt; s<span class="string">&quot;map&lt;float,struct&lt;<span class="subst">$&#123;fields&#125;</span>&gt;&gt;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">          <span class="keyword">case</span> MapType(TimestampType, BooleanType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;timestamp,boolean&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(TimestampType, StringType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;timestamp,string&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(TimestampType, IntegerType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;timestamp,int&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(TimestampType, FloatType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;timestamp,float&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(TimestampType, LongType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;timestamp,bigint&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(TimestampType, ShortType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;timestamp,smallint&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(TimestampType, TimestampType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;timestamp,timestamp&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(TimestampType, ByteType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;timestamp,byte&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(TimestampType, DoubleType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;timestamp,double&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(TimestampType, DateType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;timestamp,datetime&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(TimestampType, ArrayType(BooleanType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;timestamp,array&lt;boolean&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(TimestampType, ArrayType(TimestampType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;timestamp,array&lt;timestamp&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(TimestampType, ArrayType(DoubleType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;timestamp,array&lt;double&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(TimestampType, ArrayType(FloatType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;timestamp,array&lt;Float&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(TimestampType, ArrayType(LongType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;timestamp,array&lt;bigint&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(TimestampType, ArrayType(ShortType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;timestamp,array&lt;smallint&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(TimestampType, ArrayType(ByteType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;timestamp,array&lt;byte&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(TimestampType, ArrayType(StringType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;timestamp,array&lt;string&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(TimestampType, ArrayType(IntegerType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;timestamp,array&lt;int&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(TimestampType, ArrayType(DateType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;timestamp,array&lt;datetime&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(TimestampType, StructType(fields: Array[StructField]), <span class="keyword">true</span>) =&gt; s<span class="string">&quot;map&lt;timestamp,struct&lt;<span class="subst">$&#123;fields&#125;</span>&gt;&gt;&quot;</span></span><br><span class="line"></span><br><span class="line">          <span class="keyword">case</span> MapType(StringType, BooleanType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;string,boolean&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(StringType, StringType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;string,string&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(StringType, IntegerType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;string,int&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(StringType, FloatType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;string,float&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(StringType, LongType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;string,bigint&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(StringType, ShortType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;string,smallint&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(StringType, TimestampType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;string,timestamp&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(StringType, ByteType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;string,byte&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(StringType, DoubleType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;string,double&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(StringType, DateType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;string,datetime&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(StringType, ArrayType(BooleanType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;string,array&lt;boolean&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(StringType, ArrayType(TimestampType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;string,array&lt;timestamp&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(StringType, ArrayType(DoubleType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;string,array&lt;double&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(StringType, ArrayType(FloatType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;string,array&lt;Float&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(StringType, ArrayType(LongType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;string,array&lt;bigint&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(StringType, ArrayType(ShortType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;string,array&lt;smallint&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(StringType, ArrayType(ByteType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;string,array&lt;byte&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(StringType, ArrayType(StringType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;string,array&lt;string&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(StringType, ArrayType(IntegerType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;string,array&lt;int&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(StringType, ArrayType(DateType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;string,array&lt;datetime&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(StringType, StructType(fields: Array[StructField]), <span class="keyword">true</span>) =&gt; s<span class="string">&quot;map&lt;string,struct&lt;<span class="subst">$&#123;fields&#125;</span>&gt;&gt;&quot;</span></span><br><span class="line"></span><br><span class="line">          <span class="keyword">case</span> MapType(DoubleType, BooleanType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;Double,boolean&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(DoubleType, StringType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;Double,string&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(DoubleType, IntegerType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;Double,int&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(DoubleType, FloatType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;Double,float&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(DoubleType, LongType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;Double,bigint&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(DoubleType, ShortType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;Double,smallint&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(DoubleType, TimestampType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;Double,timestamp&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(DoubleType, ByteType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;Double,byte&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(DoubleType, DoubleType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;Double,double&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(DoubleType, DateType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;Double,datetime&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(DoubleType, ArrayType(BooleanType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;Double,array&lt;boolean&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(DoubleType, ArrayType(TimestampType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;Double,array&lt;timestamp&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(DoubleType, ArrayType(DoubleType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;Double,array&lt;double&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(DoubleType, ArrayType(FloatType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;Double,array&lt;Float&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(DoubleType, ArrayType(LongType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;Double,array&lt;bigint&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(DoubleType, ArrayType(ShortType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;Double,array&lt;smallint&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(DoubleType, ArrayType(ByteType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;Double,array&lt;byte&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(DoubleType, ArrayType(StringType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;Double,array&lt;string&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(DoubleType, ArrayType(IntegerType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;Double,array&lt;int&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(DoubleType, ArrayType(DateType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;Double,array&lt;datetime&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(DoubleType, StructType(fields: Array[StructField]), <span class="keyword">true</span>) =&gt; s<span class="string">&quot;map&lt;Double,struct&lt;<span class="subst">$&#123;fields&#125;</span>&gt;&gt;&quot;</span></span><br><span class="line"></span><br><span class="line">          <span class="keyword">case</span> MapType(LongType, BooleanType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;bigint,boolean&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(LongType, StringType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;bigint,string&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(LongType, IntegerType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;bigint,int&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(LongType, FloatType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;bigint,float&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(LongType, LongType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;bigint,bigint&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(LongType, ShortType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;bigint,smallint&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(LongType, TimestampType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;bigint,timestamp&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(LongType, ByteType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;bigint,byte&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(LongType, DoubleType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;bigint,double&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(LongType, DateType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;bigint,datetime&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(LongType, ArrayType(BooleanType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;bigint,array&lt;boolean&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(LongType, ArrayType(TimestampType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;bigint,array&lt;timestamp&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(LongType, ArrayType(DoubleType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;bigint,array&lt;double&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(LongType, ArrayType(FloatType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;bigint,array&lt;Float&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(LongType, ArrayType(LongType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;bigint,array&lt;bigint&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(LongType, ArrayType(ShortType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;bigint,array&lt;smallint&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(LongType, ArrayType(ByteType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;bigint,array&lt;byte&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(LongType, ArrayType(StringType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;bigint,array&lt;string&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(LongType, ArrayType(IntegerType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;bigint,array&lt;int&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(LongType, ArrayType(DateType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;bigint,array&lt;datetime&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(LongType, StructType(fields: Array[StructField]), <span class="keyword">true</span>) =&gt; s<span class="string">&quot;map&lt;bigint,struct&lt;<span class="subst">$&#123;fields&#125;</span>&gt;&gt;&quot;</span></span><br><span class="line"></span><br><span class="line">          <span class="keyword">case</span> MapType(ShortType, BooleanType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;smallint,boolean&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(ShortType, StringType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;smallint,string&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(ShortType, IntegerType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;smallint,int&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(ShortType, FloatType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;smallint,float&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(ShortType, LongType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;smallint,bigint&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(ShortType, ShortType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;smallint,smallint&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(ShortType, TimestampType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;smallint,timestamp&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(ShortType, ByteType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;smallint,byte&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(ShortType, DoubleType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;smallint,double&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(ShortType, DateType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;smallint,datetime&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(ShortType, ArrayType(BooleanType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;smallint,array&lt;boolean&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(ShortType, ArrayType(TimestampType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;smallint,array&lt;timestamp&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(ShortType, ArrayType(DoubleType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;smallint,array&lt;double&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(ShortType, ArrayType(FloatType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;smallint,array&lt;Float&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(ShortType, ArrayType(LongType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;smallint,array&lt;bigint&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(ShortType, ArrayType(ShortType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;smallint,array&lt;smallint&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(ShortType, ArrayType(ByteType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;smallint,array&lt;byte&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(ShortType, ArrayType(StringType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;smallint,array&lt;string&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(ShortType, ArrayType(IntegerType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;smallint,array&lt;int&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(ShortType, ArrayType(DateType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;smallint,array&lt;datetime&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(ShortType, StructType(fields: Array[StructField]), <span class="keyword">true</span>) =&gt; s<span class="string">&quot;map&lt;smallint,struct&lt;<span class="subst">$&#123;fields&#125;</span>&gt;&gt;&quot;</span></span><br><span class="line"></span><br><span class="line">          <span class="keyword">case</span> MapType(ByteType, BooleanType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;byte,boolean&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(ByteType, StringType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;byte,string&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(ByteType, IntegerType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;byte,int&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(ByteType, FloatType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;byte,float&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(ByteType, LongType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;byte,bigint&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(ByteType, ShortType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;byte,smallint&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(ByteType, TimestampType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;byte,timestamp&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(ByteType, ByteType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;byte,byte&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(ByteType, DoubleType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;byte,double&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(ByteType, DateType, <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;byte,datetime&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(ByteType, ArrayType(BooleanType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;byte,array&lt;boolean&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(ByteType, ArrayType(TimestampType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;byte,array&lt;timestamp&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(ByteType, ArrayType(DoubleType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;byte,array&lt;double&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(ByteType, ArrayType(FloatType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;byte,array&lt;Float&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(ByteType, ArrayType(LongType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;byte,array&lt;bigint&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(ByteType, ArrayType(ShortType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;byte,array&lt;smallint&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(ByteType, ArrayType(ByteType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;byte,array&lt;byte&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(ByteType, ArrayType(StringType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;byte,array&lt;string&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(ByteType, ArrayType(IntegerType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;byte,array&lt;int&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(ByteType, ArrayType(DateType, <span class="keyword">true</span>), <span class="keyword">true</span>) =&gt; <span class="string">&quot;map&lt;byte,array&lt;datetime&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> MapType(ByteType, StructType(fields: Array[StructField]), <span class="keyword">true</span>) =&gt; s<span class="string">&quot;map&lt;byte,struct&lt;<span class="subst">$&#123;fields&#125;</span>&gt;&gt;&quot;</span></span><br><span class="line"></span><br><span class="line">          <span class="keyword">case</span> StructType(fields: Array[StructField]) =&gt; s<span class="string">&quot;struct&lt;<span class="subst">$&#123;fields&#125;</span>&gt;&quot;</span></span><br><span class="line">          <span class="keyword">case</span> _ =&gt; println(<span class="string">&quot;未知的数据类型&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        s<span class="string">&quot;<span class="subst">$&#123;total.name&#125;</span> <span class="subst">$&#123;resultString1&#125;</span>&quot;</span></span><br><span class="line">      &#125;).toArray</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    val arraycolunms = schematohivedatatype(arraycolunmstmp)</span><br><span class="line">    val partitionconclunms = schematohivedatatype(arrayconcloumnspartition)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> fileformatted:<span class="built_in">String</span> = <span class="keyword">null</span></span><br><span class="line">    <span class="keyword">var</span> partitionstring:<span class="built_in">String</span> = <span class="keyword">null</span></span><br><span class="line">    fileformat match &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&quot;text&quot;</span> =&gt;</span><br><span class="line">        makepartitionsql(otheroptions)</span><br><span class="line">        fileformatted = s<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">          |row format delimited fields terminated by <span class="subst">$&#123;otheroptions(<span class="number">0</span>)&#125;</span></span></span><br><span class="line"><span class="string">          |stored as textfile</span></span><br><span class="line"><span class="string">          |&quot;&quot;&quot;</span>.stripMargin</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&quot;orc&quot;</span> =&gt;</span><br><span class="line">        makepartitionsql(otheroptions)</span><br><span class="line">        fileformatted =<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">          |stored as orc</span></span><br><span class="line"><span class="string">          |&quot;&quot;&quot;</span>.stripMargin</span><br><span class="line"></span><br><span class="line">      <span class="keyword">case</span> <span class="string">&quot;parquet&quot;</span> =&gt;</span><br><span class="line">        makepartitionsql(otheroptions)</span><br><span class="line">        fileformatted =<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">          |stored as Parquet</span></span><br><span class="line"><span class="string">          |&quot;&quot;&quot;</span>.stripMargin</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&quot;rcfile&quot;</span> =&gt;</span><br><span class="line">        makepartitionsql(otheroptions)</span><br><span class="line">        fileformatted =<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">          |stored as rcfile</span></span><br><span class="line"><span class="string">          |&quot;&quot;&quot;</span>.stripMargin</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&quot;sequencefile&quot;</span> =&gt;</span><br><span class="line">        makepartitionsql(otheroptions)</span><br><span class="line">        fileformatted =<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">          |stored as sequencefile</span></span><br><span class="line"><span class="string">          |&quot;&quot;&quot;</span>.stripMargin</span><br><span class="line">      <span class="keyword">case</span> _ =&gt; println(<span class="string">&quot;错误的存储格式&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    def makepartitionsql(array: Seq[<span class="built_in">String</span>]) =&#123;</span><br><span class="line"></span><br><span class="line">      array.foreach(println(_))</span><br><span class="line">      println(array.length)</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (otheroptions.isEmpty)&#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;---------------正在创建普通表&quot;</span>)</span><br><span class="line">      &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        partitionstring = fileformatted match &#123;</span><br><span class="line">          <span class="keyword">case</span> text =&gt;</span><br><span class="line">            &#123;</span><br><span class="line">              val strings = array(<span class="number">1</span>).split(<span class="string">&quot;,&quot;</span>)</span><br><span class="line">              <span class="keyword">var</span> <span class="built_in">bool</span>:Boolean  = <span class="keyword">false</span></span><br><span class="line">              <span class="keyword">var</span> tmppartString:<span class="built_in">String</span> = <span class="keyword">null</span></span><br><span class="line">              <span class="keyword">if</span> (!partitionconclunms.isEmpty)&#123;</span><br><span class="line">                tmppartString = partitionconclunms.mkString(<span class="string">&quot;,&quot;</span>)</span><br><span class="line">                <span class="keyword">if</span> (otheroptions.length != <span class="number">2</span>)&#123;</span><br><span class="line">                  tmppartString = tmppartString + <span class="string">&quot;,&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">              &#125;</span><br><span class="line">              <span class="keyword">for</span> (elem &lt;- strings)&#123;</span><br><span class="line">                <span class="built_in">bool</span> = source.columns.contains(elem)</span><br><span class="line">                <span class="keyword">if</span> (!<span class="built_in">bool</span>)&#123;</span><br><span class="line">                  <span class="keyword">if</span> (elem == strings(strings.length<span class="number">-1</span>))&#123;</span><br><span class="line">                    tmppartString = tmppartString + elem +<span class="string">&quot; &quot;</span>+ <span class="string">&quot;string&quot;</span></span><br><span class="line">                  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    tmppartString = tmppartString + elem +<span class="string">&quot; &quot;</span>+ <span class="string">&quot;string&quot;</span> + <span class="string">&quot;,&quot;</span></span><br><span class="line">                  &#125;</span><br><span class="line">                &#125;</span><br><span class="line">              &#125;</span><br><span class="line">              s<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">                |partitioned by (<span class="subst">$&#123;tmppartString&#125;</span>)</span></span><br><span class="line"><span class="string">                |&quot;&quot;&quot;</span>.stripMargin</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">case</span> _ =&gt;</span><br><span class="line">          &#123;</span><br><span class="line">            val strings = array(<span class="number">0</span>).split(<span class="string">&quot;,&quot;</span>)</span><br><span class="line">            <span class="keyword">var</span> <span class="built_in">bool</span>:Boolean  = <span class="keyword">false</span></span><br><span class="line">            <span class="keyword">var</span> tmppartString:<span class="built_in">String</span> = <span class="keyword">null</span></span><br><span class="line">            <span class="keyword">if</span> (!partitionconclunms.isEmpty)&#123;</span><br><span class="line">              tmppartString = partitionconclunms.mkString(<span class="string">&quot;,&quot;</span>)</span><br><span class="line">              <span class="keyword">if</span> (otheroptions.length != <span class="number">2</span>)&#123;</span><br><span class="line">                tmppartString = tmppartString + <span class="string">&quot;,&quot;</span></span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (elem &lt;- strings)&#123;</span><br><span class="line">              <span class="built_in">bool</span> = source.columns.contains(elem)</span><br><span class="line">              <span class="keyword">if</span> (!<span class="built_in">bool</span>)&#123;</span><br><span class="line">                <span class="keyword">if</span> (elem == strings(strings.length<span class="number">-1</span>))&#123;</span><br><span class="line">                  tmppartString = tmppartString + elem +<span class="string">&quot; &quot;</span>+ <span class="string">&quot;string&quot;</span></span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                  tmppartString = tmppartString + elem +<span class="string">&quot; &quot;</span>+ <span class="string">&quot;string&quot;</span> + <span class="string">&quot;,&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            s<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">               |partitioned by (<span class="subst">$&#123;tmppartString&#125;</span>)</span></span><br><span class="line"><span class="string">               |&quot;&quot;&quot;</span>.stripMargin</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    val createsql =</span><br><span class="line">      s<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        |create table</span></span><br><span class="line"><span class="string">        |<span class="subst">$&#123;tablename&#125;</span></span></span><br><span class="line"><span class="string">        |(<span class="subst">$&#123;arraycolunms.mkString(<span class="string">&quot;,\n&quot;</span>)&#125;</span>)<span class="subst">$&#123;partitionstring&#125;</span><span class="subst">$&#123;fileformatted&#125;</span></span></span><br><span class="line"><span class="string">        |&quot;&quot;&quot;</span>.stripMargin</span><br><span class="line">    println(createsql)</span><br><span class="line">    createsql</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  def insertmake(sparkSession: SparkSession,dataFrame: DataFrame,tablename:<span class="built_in">String</span>,otheroptions:<span class="built_in">String</span>*) =&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> strings:Array[<span class="built_in">String</span>] = <span class="keyword">null</span></span><br><span class="line"></span><br><span class="line">      dataFrame.selectExpr(sparkSession.table(tablename).columns:_*).createOrReplaceTempView(<span class="string">&quot;tmp&quot;</span>)</span><br><span class="line"></span><br><span class="line">   <span class="comment">// val partitionstring = sparkSession.table(tablename).columns.tail(sparkSession.table(tablename).columns.length - 2)</span></span><br><span class="line">    otheroptions.length match &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0</span> =&gt; &#123;</span><br><span class="line">        sparkSession.sql(</span><br><span class="line">          s<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">             |insert overwrite <span class="subst">$&#123;tablename&#125;</span></span></span><br><span class="line"><span class="string">             |select * from tmp</span></span><br><span class="line"><span class="string">             |&quot;&quot;&quot;</span>.stripMargin)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">case</span> _ =&gt; &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (otheroptions.length &gt; <span class="number">1</span>)&#123;</span><br><span class="line">          strings = otheroptions(<span class="number">1</span>).split(<span class="string">&quot;,&quot;</span>).filter(conclunms =&gt; &#123;</span><br><span class="line">            !dataFrame.columns.contains(conclunms)</span><br><span class="line">          &#125;)</span><br><span class="line">          val fuzhiarray:Array[<span class="built_in">String</span>] = util.Arrays.copyOfRange(otheroptions.toArray, <span class="number">2</span>, otheroptions.length)</span><br><span class="line">          fuzhiarray.foreach(println(_))</span><br><span class="line">          strings.isEmpty match &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="keyword">true</span> =&gt; &#123;</span><br><span class="line"></span><br><span class="line">          sparkSession.sql(</span><br><span class="line">          s<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">            |insert overwrite <span class="subst">$&#123;tablename&#125;</span> partition(<span class="subst">$&#123;otheroptions(<span class="number">1</span>).split(<span class="string">&quot;,&quot;</span>).map(conclunms =&gt; &#123;s<span class="string">&quot;<span class="subst">$&#123;conclunms&#125;</span>&quot;</span>&#125;</span>).mkString(&quot;,&quot;)&#125;)</span></span><br><span class="line"><span class="string">            |select * from tmp</span></span><br><span class="line"><span class="string">            |&quot;&quot;&quot;</span>.stripMargin)</span><br><span class="line">          &#125;</span><br><span class="line">            <span class="keyword">case</span> <span class="keyword">false</span> =&gt; &#123;</span><br><span class="line">              <span class="keyword">var</span> tmpdf:DataFrame = dataFrame</span><br><span class="line">              <span class="keyword">for</span> (i &lt;- <span class="number">0</span> to strings.length<span class="number">-1</span>)&#123;</span><br><span class="line">                tmpdf = tmpdf.withColumn(strings(i),lit(fuzhiarray(i)))</span><br><span class="line">              &#125;</span><br><span class="line">              tmpdf.<span class="keyword">show</span>()</span><br><span class="line">              tmpdf.printSchema()</span><br><span class="line">              tmpdf = tmpdf.selectExpr(sparkSession.table(tablename).columns: _*)</span><br><span class="line">              tmpdf.<span class="keyword">show</span>()</span><br><span class="line">              tmpdf.printSchema()</span><br><span class="line">              val str = tmpdf.columns.mkString(<span class="string">&quot;,\n&quot;</span>)</span><br><span class="line">              tmpdf.createOrReplaceTempView(<span class="string">&quot;smp&quot;</span>)</span><br><span class="line">              sparkSession.sql(</span><br><span class="line">                s<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">                   |insert overwrite <span class="subst">$&#123;tablename&#125;</span> partition(<span class="subst">$&#123;otheroptions(<span class="number">1</span>).split(<span class="string">&quot;,&quot;</span>).map(conclunms =&gt; &#123;s<span class="string">&quot;<span class="subst">$&#123;conclunms&#125;</span>&quot;</span>&#125;</span>).mkString(&quot;,&quot;)&#125;)</span></span><br><span class="line"><span class="string">                   |select <span class="subst">$&#123;str&#125;</span> from smp</span></span><br><span class="line"><span class="string">                   |&quot;&quot;&quot;</span>.stripMargin)</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">          strings = otheroptions(<span class="number">0</span>).split(<span class="string">&quot;,&quot;</span>).filter(conclunms =&gt; &#123;</span><br><span class="line">            !dataFrame.columns.contains(conclunms)</span><br><span class="line">          &#125;)</span><br><span class="line">          val fuzhiarray:Array[<span class="built_in">String</span>] = util.Arrays.copyOfRange(otheroptions.toArray, <span class="number">1</span>, otheroptions.length)</span><br><span class="line"></span><br><span class="line">          strings.isEmpty match &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="keyword">true</span> =&gt; &#123;</span><br><span class="line">              sparkSession.sql(</span><br><span class="line">                s<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">                   |insert overwrite <span class="subst">$&#123;tablename&#125;</span> partition(<span class="subst">$&#123;otheroptions(<span class="number">0</span>).split(<span class="string">&quot;,&quot;</span>).map(conclunms =&gt; &#123;s<span class="string">&quot;<span class="subst">$&#123;conclunms&#125;</span>&quot;</span>&#125;</span>).mkString(&quot;,&quot;)&#125;)</span></span><br><span class="line"><span class="string">                   |select * from tmp</span></span><br><span class="line"><span class="string">                   |&quot;&quot;&quot;</span>.stripMargin)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">case</span> <span class="keyword">false</span> =&gt; &#123;</span><br><span class="line">              <span class="keyword">var</span> tmpdf:DataFrame = dataFrame</span><br><span class="line"></span><br><span class="line">              <span class="keyword">for</span> (i &lt;- <span class="number">0</span> to strings.length<span class="number">-1</span>)&#123;</span><br><span class="line">                tmpdf = tmpdf.withColumn(strings(i),lit(fuzhiarray(i)))</span><br><span class="line">              &#125;</span><br><span class="line">              tmpdf.<span class="keyword">show</span>()</span><br><span class="line">              tmpdf.printSchema()</span><br><span class="line">              tmpdf = tmpdf.selectExpr(sparkSession.table(tablename).columns: _*)</span><br><span class="line">              val str = tmpdf.columns.mkString(<span class="string">&quot;,\n&quot;</span>)</span><br><span class="line">              tmpdf.createOrReplaceTempView(<span class="string">&quot;smp&quot;</span>)</span><br><span class="line">              sparkSession.sql(</span><br><span class="line">                s<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">                   |insert overwrite <span class="subst">$&#123;tablename&#125;</span> partition(<span class="subst">$&#123;otheroptions(<span class="number">0</span>).split(<span class="string">&quot;,&quot;</span>).map(conclunms =&gt; &#123;s<span class="string">&quot;<span class="subst">$&#123;conclunms&#125;</span>&quot;</span>&#125;</span>).mkString(&quot;,&quot;)&#125;)</span></span><br><span class="line"><span class="string">                   |select <span class="subst">$&#123;str&#125;</span> from smp</span></span><br><span class="line"><span class="string">                   |&quot;&quot;&quot;</span>.stripMargin)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  def maskmake(sparkSession: SparkSession,tablename:<span class="built_in">String</span>)=&#123;</span><br><span class="line">    sparkSession.sql(</span><br><span class="line">      s<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        |msck repair table <span class="subst">$&#123;tablename&#125;</span></span></span><br><span class="line"><span class="string">        |&quot;&quot;&quot;</span>.stripMargin)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  def changecolunms(sparkSession: SparkSession , dataFrame: DataFrame,tablename:<span class="built_in">String</span>) =&#123;</span><br><span class="line"></span><br><span class="line">    val strings = dataFrame.columns.filter(!sparkSession.table(tablename).columns.contains(_))</span><br><span class="line">    println(strings)</span><br><span class="line">    strings.foreach(println(_))</span><br><span class="line"></span><br><span class="line">    val str = strings.map(x =&gt; &#123;</span><br><span class="line">      s<span class="string">&quot;<span class="subst">$&#123;x&#125;</span> string&quot;</span></span><br><span class="line">    &#125;).mkString(<span class="string">&quot;,&quot;</span>)</span><br><span class="line"></span><br><span class="line">    val changesonslunms =</span><br><span class="line">      s<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        |alter table <span class="subst">$&#123;tablename&#125;</span> add COLUMNS (<span class="subst">$&#123;str&#125;</span>)</span></span><br><span class="line"><span class="string">        |&quot;&quot;&quot;</span>.stripMargin</span><br><span class="line">    println(changesonslunms)</span><br><span class="line">    sparkSession.sql(changesonslunms)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="tool-mysqlutils"><a href="#tool-mysqlutils" class="headerlink" title="tool.mysqlutils"></a>tool.mysqlutils</h2><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">package tool</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.<span class="keyword">sql</span>.&#123;<span class="keyword">Connection</span>, DriverManager&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> mysqlutils &#123;</span><br><span class="line"></span><br><span class="line">  def getconnect(string: String*)=&#123;</span><br><span class="line">    var <span class="keyword">connect</span>=<span class="keyword">null</span></span><br><span class="line">    try&#123;</span><br><span class="line">      <span class="keyword">Class</span>.forName(&quot;com.mysql.jdbc.Driver&quot;)</span><br><span class="line">      try &#123;</span><br><span class="line">        DriverManager.getConnection(string(<span class="number">0</span>),string(<span class="number">1</span>),string(<span class="number">2</span>))</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  def closeconnect(<span class="keyword">connect</span>:<span class="keyword">Connection</span>) =&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">connect</span> != <span class="keyword">null</span>)&#123;</span><br><span class="line">      <span class="keyword">connect</span>.<span class="keyword">close</span>()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="tool-getmysqldf"><a href="#tool-getmysqldf" class="headerlink" title="tool.getmysqldf"></a>tool.getmysqldf</h2><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">package tool</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.<span class="keyword">sql</span>.SparkSession</span><br><span class="line"><span class="keyword">import</span> tool._</span><br><span class="line"><span class="keyword">class</span> getmysqldf &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  def getmysqldataframe(sparkSession: SparkSession,string: String*) =&#123;</span><br><span class="line"></span><br><span class="line">      val <span class="keyword">sql</span> = string(<span class="number">3</span>)</span><br><span class="line">      val frame = sparkSession.<span class="keyword">read</span>.format(&quot;jdbc&quot;).<span class="keyword">options</span>(Map(&quot;url&quot; -&gt; string(<span class="number">0</span>), &quot;user&quot; -&gt; string(<span class="number">1</span>), &quot;password&quot; -&gt; string(<span class="number">2</span>), &quot;dbtable&quot; -&gt; s&quot;$sql&quot;,&quot;driver&quot;-&gt;string(<span class="number">4</span>))).<span class="keyword">load</span>()</span><br><span class="line">      frame</span><br><span class="line">//    <span class="keyword">if</span> (string(<span class="number">3</span>).contains(&quot; &quot;)) &#123;</span><br><span class="line">//      val <span class="keyword">sql</span> = string(<span class="number">3</span>)</span><br><span class="line">//      val frame = sparkSession.<span class="keyword">read</span>.format(&quot;jdbc&quot;).<span class="keyword">options</span>(Map(&quot;url&quot; -&gt; string(<span class="number">0</span>), &quot;user&quot; -&gt; string(<span class="number">1</span>), &quot;password&quot; -&gt; string(<span class="number">2</span>), &quot;dbtable&quot; -&gt; s&quot;$sql&quot;)).<span class="keyword">load</span>()</span><br><span class="line">//      frame</span><br><span class="line">//    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">//      val frame = sparkSession.<span class="keyword">read</span>.format(&quot;jdbc&quot;).<span class="keyword">options</span>(Map(&quot;url&quot; -&gt; string(<span class="number">0</span>), &quot;user&quot; -&gt; string(<span class="number">1</span>), &quot;password&quot; -&gt; string(<span class="number">2</span>), &quot;dbtable&quot; -&gt; string(<span class="number">3</span>))).<span class="keyword">load</span>()</span><br><span class="line">//      frame</span><br><span class="line">//    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  def getmyqsldffromMap(sparkSession: SparkSession,map: Map[String,String])=&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    sparkSession.<span class="keyword">read</span>.format(&quot;jdbc&quot;).<span class="keyword">options</span>(map).<span class="keyword">load</span>()</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="tool-getjdbcconnect"><a href="#tool-getjdbcconnect" class="headerlink" title="tool.getjdbcconnect"></a>tool.getjdbcconnect</h2><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">package tool</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.<span class="keyword">sql</span>.&#123;<span class="keyword">Connection</span>, DriverManager&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> getjdbcconnect &#123;</span><br><span class="line"></span><br><span class="line">  def getconncet(drivername:String,url:String,<span class="keyword">user</span>:String,<span class="keyword">password</span>:String)=&#123;</span><br><span class="line">    <span class="keyword">Class</span>.forName(drivername)</span><br><span class="line">    val <span class="keyword">connection</span> = DriverManager.getConnection(url, <span class="keyword">user</span>, <span class="keyword">password</span>)</span><br><span class="line">    <span class="keyword">connection</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="tool-streamingcontext"><a href="#tool-streamingcontext" class="headerlink" title="tool.streamingcontext"></a>tool.streamingcontext</h2><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">package tool</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.SparkConf</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.streaming.&#123;Seconds, StreamingContext&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> streamingcontext &#123;</span><br><span class="line"></span><br><span class="line">  def getstreamcotext(mode: String=&quot;local[4]&quot;,<span class="type">name</span>:String=&quot;example&quot;,<span class="keyword">checkpoint</span>:String=&quot;file:///D:\\checkpoint&quot;)=&#123;</span><br><span class="line">    val conf = <span class="built_in">new</span> SparkConf().setMaster(mode).setAppName(<span class="type">name</span>)</span><br><span class="line">    val ssc = <span class="built_in">new</span> StreamingContext(conf, Seconds(<span class="number">5</span>))</span><br><span class="line">    ssc.<span class="keyword">checkpoint</span>(<span class="keyword">checkpoint</span>)</span><br><span class="line">    ssc</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

      
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/6/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><span class="page-number current">7</span>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="liu zihang"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">liu zihang</p>
  <div class="site-description" itemprop="description">只有努力不会辜负你</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">66</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">31</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="sidebar-button motion-element"><i class="fa fa-comment"></i>
    Chat
  </a>
  </div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/yourname" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;yourname" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      链接网站
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://baidu.com/" title="https:&#x2F;&#x2F;baidu.com" rel="noopener" target="_blank">百度</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://fishc.com.cn/" title="https:&#x2F;&#x2F;fishc.com.cn" rel="noopener" target="_blank">鱼C论坛</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">liu zihang</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count">博客全站共232.4k字</span>
</div>


    <script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

    <span id="busuanzi_container_site_pv">总访问量<span id="busuanzi_value_site_pv"></span>次</span>
    <span class="post-meta-divider">|</span>
    <span id="busuanzi_container_site_uv">总访客数<span id="busuanzi_value_site_uv"></span>人</span>
    <span class="post-meta-divider">|</span>
<!-- 不蒜子计数初始值纠正 -->
<script>
$(document).ready(function() {

    var int = setInterval(fixCount, 50);  // 50ms周期检测函数
    var countOffset = 20000;  // 初始化首次数据

    function fixCount() {            
       if (document.getElementById("busuanzi_container_site_pv").style.display != "none")
        {
            $("#busuanzi_value_site_pv").html(parseInt($("#busuanzi_value_site_pv").html()) + countOffset); 
            clearInterval(int);
        }                  
        if ($("#busuanzi_container_site_pv").css("display") != "none")
        {
            $("#busuanzi_value_site_uv").html(parseInt($("#busuanzi_value_site_uv").html()) + countOffset); // 加上初始数据 
            clearInterval(int); // 停止检测
        }  
    }
       	
});
</script> 

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  
  <script color='0,0,255' opacity='0.5' zIndex='-1' count='99' src="/lib/canvas-nest/canvas-nest.min.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>


  <script defer src="/lib/three/three.min.js"></script>
    <script defer src="/lib/three/canvas_lines.min.js"></script>


  




  
<script src="/js/local-search.js"></script>













  

  

  


</body>
</html>
