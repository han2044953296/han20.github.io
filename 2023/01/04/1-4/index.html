<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/%E6%A0%91%E5%8F%B6_sleaves%20(1).png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/%E6%A0%91%E5%8F%B6_sleaves.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-flash.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"zihang.fun","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"hide","padding":18,"offset":15,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"flat"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"manual","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="sparkspark产生背景？mr,hive批处理，离线处理存在一些局限性：  mr api 开发复杂 只能做离线计算，不能实时计算 性能不高  需求： sql &#x3D;》 mr 会产生多个job去完成一个需求 mr1&#x3D;&gt;mr2&#x3D;&gt;mr3 map &#x3D;&gt; reduce map处理完数据&#x3D;》dask数据落盘 &#x3D;》 reduce m">
<meta property="og:type" content="article">
<meta property="og:title" content="spark">
<meta property="og:url" content="http://zihang.fun/2023/01/04/1-4/index.html">
<meta property="og:site_name" content="枫叶冢">
<meta property="og:description" content="sparkspark产生背景？mr,hive批处理，离线处理存在一些局限性：  mr api 开发复杂 只能做离线计算，不能实时计算 性能不高  需求： sql &#x3D;》 mr 会产生多个job去完成一个需求 mr1&#x3D;&gt;mr2&#x3D;&gt;mr3 map &#x3D;&gt; reduce map处理完数据&#x3D;》dask数据落盘 &#x3D;》 reduce m">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2023-01-04T00:40:48.665Z">
<meta property="article:modified_time" content="2023-01-10T01:04:09.792Z">
<meta property="article:author" content="liu zihang">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://zihang.fun/2023/01/04/1-4/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>spark | 枫叶冢</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/rss2.xml" title="枫叶冢" type="application/rss+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>
    <a target="_blank" rel="noopener" href="https://github.com/han2044953296" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#fff; color:#151513; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">枫叶冢</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-schedule">

    <a href="/schedule/" rel="section"><i class="fa fa-calendar fa-fw"></i>日程表</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://zihang.fun/2023/01/04/1-4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="liu zihang">
      <meta itemprop="description" content="只有努力不会辜负你">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="枫叶冢">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          spark
        </h1>

        <div class="post-meta">
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-01-04 08:40:48" itemprop="dateCreated datePublished" datetime="2023-01-04T08:40:48+08:00">2023-01-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-01-10 09:04:09" itemprop="dateModified" datetime="2023-01-10T09:04:09+08:00">2023-01-10</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%97%A5%E5%BF%97/" itemprop="url" rel="index"><span itemprop="name">日志</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span><br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>49k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>44 分钟</span>
            </span>

        </div>
      </header>

    
    
    

   

    <div class="post-body" itemprop="articleBody">

      
        <h1 id="spark"><a href="#spark" class="headerlink" title="spark"></a>spark</h1><p>spark产生背景？<br>mr,hive批处理，离线处理存在一些局限性：</p>
<ul>
<li>mr api 开发复杂</li>
<li>只能做离线计算，不能实时计算</li>
<li>性能不高</li>
</ul>
<p>需求：</p>
<p>sql &#x3D;》 mr</p>
<p>会产生多个job去完成一个需求</p>
<p>mr1&#x3D;&gt;mr2&#x3D;&gt;mr3</p>
<p>map &#x3D;&gt; reduce</p>
<p>map处理完数据&#x3D;》dask数据落盘 &#x3D;》 reduce mr</p>
<p>kv进行操作 &#x3D;》 k进行排序</p>
<p>什么是spark？</p>
<p>官网：<code>spark.apache.org  </code></p>
<p>计算特点： 不关注数据存储</p>
<h3 id="特点-："><a href="#特点-：" class="headerlink" title="特点 ："></a>特点 ：</h3><ul>
<li>Batch&#x2F;streaming data &#x3D;》 批流一体</li>
<li>SQL analytics</li>
<li>Data science at scale</li>
<li>Machine learning</li>
</ul>
<h3 id="速度快："><a href="#速度快：" class="headerlink" title="速度快："></a>速度快：</h3><ul>
<li>基于内存的运算</li>
<li>DAG &#x3D;》 链式编程&#x3D;》mr1&#x3D;&gt;mr2&#x3D;&gt;mr3</li>
<li>pipline通道的</li>
<li>编程模型 线程级别的</li>
</ul>
<h3 id="易用性"><a href="#易用性" class="headerlink" title="易用性"></a>易用性</h3><ul>
<li>开发语言：java ，Scala ， python ， sql</li>
<li>外部数据源</li>
<li>80多个高级算子&#x3D;》Scala算子</li>
<li>mr&#x3D;》 去读mysql数据库 &#x3D;》 DBinputformat</li>
<li>spark &#x3D;&gt; 封装好了多种外部数据源 &#x3D;》 jdbc ， json ，csv</li>
<li>mr map&#x2F;reduce</li>
<li>spark :80</li>
</ul>
<p>通用性</p>
<ul>
<li>子模块</li>
<li>sparkcore &#x3D;》 ：离线计算</li>
<li>sparksql &#x3D;》 离线计算</li>
<li>sparkstreaming，structstreaming &#x3D;》 实时计算</li>
<li>mllib &#x3D;》 机器学习</li>
<li>图计算 &#x3D;》 图处理</li>
</ul>
<p>对于spark的子模块之间可以用交互式使用</p>
<p>运行作业的地方</p>
<ul>
<li>yarn ***</li>
<li>mesos</li>
<li>k8s ***</li>
<li>standalone</li>
</ul>
<p>hadoop生态圈 vs spark生态圈</p>
<ul>
<li>Batch： mr ， hive vs sparkcore，sparksql</li>
<li>Sql：hive，impala vs sparksql</li>
<li>stream ： Strom vs spark streaming，sss</li>
<li>MLLib：Mahout vs MLLib</li>
<li>real存储 ： HBase，cassandra vs DataSource Api</li>
</ul>
<h3 id="spark-能不能替换hadoop-x3D-》-替换不了-x3D-》spark-x3D-》-可以mr"><a href="#spark-能不能替换hadoop-x3D-》-替换不了-x3D-》spark-x3D-》-可以mr" class="headerlink" title="spark 能不能替换hadoop &#x3D;》 替换不了&#x3D;》spark &#x3D;》 可以mr"></a>spark 能不能替换hadoop &#x3D;》 替换不了&#x3D;》spark &#x3D;》 可以mr</h3><p>spqrk版本：</p>
<ul>
<li>spark 1.x</li>
<li>spark 2.x主流</li>
<li>spark 3.x主流</li>
</ul>
<p>编程模型：</p>
<p>sparkcore &#x3D;》 RDD</p>
<p>sparksql &#x3D;》 dataframe &amp; dataset</p>
<p>sparkstreaming &#x3D;》 DS</p>
<p>sparkcore</p>
<p>RDD：rdd开发 降低开发人员的开发成本 vs mr</p>
<p>什么是rdd？</p>
<p>lower level &#x3D; 》mr</p>
<p>high level &#x3D;》 spark 高级算子</p>
<h3 id="优点："><a href="#优点：" class="headerlink" title="优点："></a>优点：</h3><ul>
<li>弹性 分布式 数据集</li>
<li>数据集 &#x3D;》 partitions 元素 &#x3D;》 一条一条数据</li>
<li>可以用并行的方式进行计算</li>
</ul>
<h3 id="弹性？"><a href="#弹性？" class="headerlink" title="弹性？"></a>弹性？</h3><ul>
<li>容错 &#x3D;》 计算的时候 可以重试</li>
</ul>
<h3 id="分布式？"><a href="#分布式？" class="headerlink" title="分布式？"></a>分布式？</h3><ul>
<li>存储<ul>
<li>rdd：1 2 3 4 5 6<ul>
<li>partition1:1 2 3</li>
<li>partition2: 4 5</li>
<li>partition:6</li>
</ul>
</li>
<li>bigdata3:p1</li>
<li>bigdata4:p2</li>
<li>bigdtat5:p3</li>
</ul>
</li>
<li>计算<ul>
<li>对rdd的操作是操作里面的数据</li>
</ul>
</li>
<li>数据集<ul>
<li>就是构建rdd本身的数据</li>
</ul>
</li>
<li>immutable 不可变的<ul>
<li>scala ： val var</li>
<li>rdda &#x3D;》 rddb</li>
<li>不可变 &#x3D; 》rdda 通过一个计算到新的rdd</li>
</ul>
</li>
<li>partition collection of elements &#x3D;&gt; rdd可以被分区存储&#x2F;计算</li>
<li>一个rdd 是由多个partition所构成的</li>
<li>rdd数据存储是分布式的，是跨节点进行存储的</li>
</ul>
<p>abstract</p>
<p>T泛型 &#x3D;》 限定在人dd里面数据 是什么类型的如：RDD[String] , RDD[Int],RDD[Student]</p>
<p>Serializable序列化&#x3D;》可以经过网络传输</p>
<p>@transient注解 这个属性不用序列化 [了解]</p>
<h3 id="RDD-的特性："><a href="#RDD-的特性：" class="headerlink" title="RDD 的特性："></a>RDD 的特性：</h3><ul>
<li>rdd 的底层存储是系列的partition</li>
<li>针对rdd做计算&#x2F;操作其实就是对rdd底层的partition进行计算&#x2F;操作</li>
<li>rdd之间的依赖关系<ul>
<li>rdda &#x3D;》rddb</li>
<li>rdd 不可变</li>
<li>rdda &#x3D; 》b &#x3D;》 c</li>
</ul>
</li>
<li>Partitioner &#x3D;》 kv类型的rdd</li>
<li>默认分区是hash</li>
<li>数据本地性 &#x3D;》 减少数据传输的io ，优点<ul>
<li>rdd进行操作的好处 ：<ul>
<li>有限的作业调度在数据所在的节点上 &#x3D;》 理想状况</li>
<li>常见计算 &#x3D;》 作业调度在别的节点上 ，数据另外存储在一台节点上，只能把数据通过网络传过去再进行计算</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>在rdd中可以用scala的map和其他高级函数</p>
<p>RDD操作 ：</p>
<p>构建sparkcore 作业 ：idea</p>
<p>添加依赖 ：</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">&lt;dependency&gt;</span></span><br><span class="line">     <span class="section">&lt;groupId&gt;</span><span class="attribute">org</span>.apache.spark&lt;/groupId&gt;</span><br><span class="line">     <span class="section">&lt;artifactId&gt;</span><span class="attribute">spark</span>-core_2.<span class="number">12</span>&lt;/artifactId&gt;</span><br><span class="line">     <span class="section">&lt;version&gt;</span><span class="attribute">3</span>.<span class="number">2</span>.<span class="number">1</span>&lt;/version&gt;</span><br><span class="line">   <span class="section">&lt;/dependency&gt;</span></span><br></pre></td></tr></table></figure>

<p>mapreduce  ：程序入口：job</p>
<h3 id="初始化spark："><a href="#初始化spark：" class="headerlink" title="初始化spark："></a>初始化spark：</h3><ul>
<li><p>sparkContext &#x3D;》 sparkcore 程序入口</p>
</li>
<li><p>SparkConf &#x3D;&gt; 指定spark app 详细信息</p>
<ul>
<li>AppName &#x3D; 》作业名字</li>
<li>Master &#x3D;》作业运行在什么地方 spark作业运行模式<ul>
<li>local，yarn，stanalone，k8s,mesos</li>
<li>公共中：yarn，k8s，local</li>
<li>测试的时候：local</li>
<li>一个spark作业里面只能由一个sparkcontext</li>
</ul>
</li>
</ul>
</li>
<li><p>如和指定Master spark作业运行模式</p>
<ul>
<li><p>local【K】模式</p>
<ul>
<li>k指的是线程数</li>
</ul>
</li>
<li><p>standalone &#x3D;&gt; spark:&#x2F;&#x2F;HOST:PORT</p>
</li>
<li><p>yarn 两种模式：</p>
<ul>
<li>client模式</li>
<li>cluster模式</li>
</ul>
</li>
<li><p>k8s</p>
<ul>
<li>k8s:&#x2F;&#x2F;HOST:PORT</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>rdd进行编程</p>
<p>创建rdd</p>
<p>parallelize existing collection  &#x3D;》 已经存在的集合</p>
<p>referencing a dataset in an external storage system，hdfs、hbase、其他数据存储系统</p>
<p>外部数据源存储<br>            hdfs、local、hbase、s3、cos、<br>数据文件类型：<br>            text files, SequenceFiles, and any other Hadoop InputFormat.</p>
<p>spark部署：</p>
<p>spark不是部署分布式的 参考hive</p>
<p>spark支持分布式部署 &#x3D;》 standalone</p>
<p>步骤 ： 解压 &#x3D;》 软连接 &#x3D;》 source</p>
<p>spark-core的脚本spark-shell</p>
<p>例子 ： <code>spark -shell --master local[2]</code></p>
<p>启动spark-shell：测试code</p>
<ul>
<li>web ui &#x3D;》 每个spark作业的 <a target="_blank" rel="noopener" href="http://bigdata32:4040/">http://bigdata32:4040</a></li>
<li>参数：<code>--master =&gt; spark shell 以什么模式去运行</code></li>
<li>可以用 <code>--name </code>更改spark shell的名字</li>
</ul>
<p>以下是关于参数的详细情况</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">spark-shell : </span><br><span class="line">	<span class="attr">--master</span>  spark作业运行环境 </span><br><span class="line">	<span class="attr">--deploy-mode</span> yarn模式 运行选择</span><br><span class="line">	<span class="attr">--class</span>  spark作业包 运行主类<span class="selector-tag">main</span>  class 包名 </span><br><span class="line">	<span class="attr">--name</span>  指定spark作业的名字 </span><br><span class="line">	<span class="attr">--jars</span> 指定第三方的依赖包</span><br><span class="line">	<span class="attr">--conf</span> 指定spark作业配置参数 </span><br><span class="line">yarn 参数补充： </span><br><span class="line">	<span class="attr">--num-executors</span> 指定 申请资源的参数 </span><br><span class="line">	<span class="attr">--executor-memory</span> 指定 申请资源的参数 </span><br><span class="line">	<span class="attr">--executor-cores</span> 指定 申请资源的参数</span><br><span class="line">	<span class="attr">--queue</span> 指定作业 运行在yarn的哪个队列上 </span><br><span class="line"></span><br><span class="line">spark-shell 交互式命令 底层调用 =》 spark-submit </span><br><span class="line">	开发者 主要使用的脚本 用于提交用户自己开发的spark作业</span><br><span class="line"></span><br><span class="line">spark-shell: </span><br><span class="line">	spark-submit \</span><br><span class="line">	<span class="attr">--class</span> org<span class="selector-class">.apache</span><span class="selector-class">.spark</span><span class="selector-class">.repl</span><span class="selector-class">.Main</span> \</span><br><span class="line">	<span class="attr">--name</span> <span class="string">&quot;Spark shell&quot;</span> <span class="string">&quot;$@&quot;</span></span><br><span class="line"></span><br><span class="line">spark-shell <span class="attr">--master</span> <span class="string">&quot;local[2]&quot;</span>: </span><br><span class="line">	spark-submit \</span><br><span class="line">	<span class="attr">--class</span> org<span class="selector-class">.apache</span><span class="selector-class">.spark</span><span class="selector-class">.repl</span><span class="selector-class">.Main</span> \</span><br><span class="line">	<span class="attr">--name</span> <span class="string">&quot;Spark shell&quot;</span>  <span class="attr">--master</span> <span class="string">&quot;local[2]&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="算子："><a href="#算子：" class="headerlink" title="算子："></a>算子：</h3><p>filter：</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">scala</span>&gt; test.collect</span><br><span class="line"><span class="attribute">res15</span>: Array[Int] = Array(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">17</span>, <span class="number">18</span>, <span class="number">19</span>, <span class="number">20</span>, <span class="number">21</span>, <span class="number">22</span>, <span class="number">23</span>, <span class="number">24</span>, <span class="number">25</span>, <span class="number">26</span>, <span class="number">27</span>, <span class="number">28</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">31</span>, <span class="number">32</span>, <span class="number">33</span>, <span class="number">34</span>, <span class="number">35</span>, <span class="number">36</span>, <span class="number">37</span>, <span class="number">38</span>, <span class="number">39</span>, <span class="number">40</span>, <span class="number">41</span>, <span class="number">42</span>, <span class="number">43</span>, <span class="number">44</span>, <span class="number">45</span>, <span class="number">46</span>, <span class="number">47</span>, <span class="number">48</span>, <span class="number">49</span>, <span class="number">50</span>, <span class="number">51</span>, <span class="number">52</span>, <span class="number">53</span>, <span class="number">54</span>, <span class="number">55</span>, <span class="number">56</span>, <span class="number">57</span>, <span class="number">58</span>, <span class="number">59</span>, <span class="number">60</span>, <span class="number">61</span>, <span class="number">62</span>, <span class="number">63</span>, <span class="number">64</span>, <span class="number">65</span>, <span class="number">66</span>, <span class="number">67</span>, <span class="number">68</span>, <span class="number">69</span>, <span class="number">70</span>, <span class="number">71</span>, <span class="number">72</span>, <span class="number">73</span>, <span class="number">74</span>, <span class="number">75</span>, <span class="number">76</span>, <span class="number">77</span>, <span class="number">78</span>, <span class="number">79</span>, <span class="number">80</span>, <span class="number">81</span>, <span class="number">82</span>, <span class="number">83</span>, <span class="number">84</span>, <span class="number">85</span>, <span class="number">86</span>, <span class="number">87</span>, <span class="number">88</span>, <span class="number">89</span>, <span class="number">90</span>, <span class="number">91</span>, <span class="number">92</span>, <span class="number">93</span>, <span class="number">94</span>, <span class="number">95</span>, <span class="number">96</span>, <span class="number">97</span>, <span class="number">98</span>, <span class="number">99</span>, <span class="number">100</span>, <span class="number">101</span>, <span class="number">102</span>, <span class="number">103</span>, <span class="number">104</span>, <span class="number">105</span>, <span class="number">106</span>, <span class="number">107</span>, <span class="number">108</span>, <span class="number">109</span>, <span class="number">110</span>, <span class="number">111</span>, <span class="number">112</span>, <span class="number">113</span>, <span class="number">114</span>, <span class="number">115</span>, <span class="number">116</span>, <span class="number">117</span>, <span class="number">118</span>, <span class="number">119</span>, <span class="number">120</span>, <span class="number">121</span>, <span class="number">122</span>, <span class="number">123</span>, <span class="number">124</span>, <span class="number">125</span>, <span class="number">126</span>, <span class="number">127</span>, <span class="number">128</span>, <span class="number">129</span>, <span class="number">130</span>, <span class="number">131</span>, <span class="number">132</span>, <span class="number">133</span>, <span class="number">134</span>, <span class="number">135</span>, <span class="number">136</span>, <span class="number">137</span>, <span class="number">138</span>, <span class="number">139</span>, <span class="number">140</span>, <span class="number">141</span>, <span class="number">142</span>, <span class="number">143</span>, <span class="number">144</span>, <span class="number">145</span>, <span class="number">146</span>, <span class="number">147</span>, <span class="number">148</span>, <span class="number">149</span>, <span class="number">150</span>, <span class="number">151</span>, <span class="number">152</span>, <span class="number">153</span>, <span class="number">154</span>, <span class="number">155</span>, <span class="number">156</span>, <span class="number">157</span>, <span class="number">158</span>, <span class="number">159</span>, <span class="number">160</span>, <span class="number">161</span>, <span class="number">162</span>, <span class="number">163</span>, <span class="number">164</span>, <span class="number">165</span>, <span class="number">166</span>, <span class="number">167</span>, <span class="number">168</span>, <span class="number">169</span>, <span class="number">170</span>, <span class="number">171</span>...</span><br><span class="line"></span><br><span class="line"><span class="attribute">scala</span>&gt; test.filter(_&gt;<span class="number">999</span>).collect</span><br><span class="line"><span class="attribute">res16</span>: Array[Int] = Array(<span class="number">1000</span>)</span><br><span class="line"><span class="attribute">scala</span>&gt; test.collect</span><br><span class="line"><span class="attribute">res15</span>: Array[Int] = Array(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">17</span>, <span class="number">18</span>, <span class="number">19</span>, <span class="number">20</span>, <span class="number">21</span>, <span class="number">22</span>, <span class="number">23</span>, <span class="number">24</span>, <span class="number">25</span>, <span class="number">26</span>, <span class="number">27</span>, <span class="number">28</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">31</span>, <span class="number">32</span>, <span class="number">33</span>, <span class="number">34</span>, <span class="number">35</span>, <span class="number">36</span>, <span class="number">37</span>, <span class="number">38</span>, <span class="number">39</span>, <span class="number">40</span>, <span class="number">41</span>, <span class="number">42</span>, <span class="number">43</span>, <span class="number">44</span>, <span class="number">45</span>, <span class="number">46</span>, <span class="number">47</span>, <span class="number">48</span>, <span class="number">49</span>, <span class="number">50</span>, <span class="number">51</span>, <span class="number">52</span>, <span class="number">53</span>, <span class="number">54</span>, <span class="number">55</span>, <span class="number">56</span>, <span class="number">57</span>, <span class="number">58</span>, <span class="number">59</span>, <span class="number">60</span>, <span class="number">61</span>, <span class="number">62</span>, <span class="number">63</span>, <span class="number">64</span>, <span class="number">65</span>, <span class="number">66</span>, <span class="number">67</span>, <span class="number">68</span>, <span class="number">69</span>, <span class="number">70</span>, <span class="number">71</span>, <span class="number">72</span>, <span class="number">73</span>, <span class="number">74</span>, <span class="number">75</span>, <span class="number">76</span>, <span class="number">77</span>, <span class="number">78</span>, <span class="number">79</span>, <span class="number">80</span>, <span class="number">81</span>, <span class="number">82</span>, <span class="number">83</span>, <span class="number">84</span>, <span class="number">85</span>, <span class="number">86</span>, <span class="number">87</span>, <span class="number">88</span>, <span class="number">89</span>, <span class="number">90</span>, <span class="number">91</span>, <span class="number">92</span>, <span class="number">93</span>, <span class="number">94</span>, <span class="number">95</span>, <span class="number">96</span>, <span class="number">97</span>, <span class="number">98</span>, <span class="number">99</span>, <span class="number">100</span>, <span class="number">101</span>, <span class="number">102</span>, <span class="number">103</span>, <span class="number">104</span>, <span class="number">105</span>, <span class="number">106</span>, <span class="number">107</span>, <span class="number">108</span>, <span class="number">109</span>, <span class="number">110</span>, <span class="number">111</span>, <span class="number">112</span>, <span class="number">113</span>, <span class="number">114</span>, <span class="number">115</span>, <span class="number">116</span>, <span class="number">117</span>, <span class="number">118</span>, <span class="number">119</span>, <span class="number">120</span>, <span class="number">121</span>, <span class="number">122</span>, <span class="number">123</span>, <span class="number">124</span>, <span class="number">125</span>, <span class="number">126</span>, <span class="number">127</span>, <span class="number">128</span>, <span class="number">129</span>, <span class="number">130</span>, <span class="number">131</span>, <span class="number">132</span>, <span class="number">133</span>, <span class="number">134</span>, <span class="number">135</span>, <span class="number">136</span>, <span class="number">137</span>, <span class="number">138</span>, <span class="number">139</span>, <span class="number">140</span>, <span class="number">141</span>, <span class="number">142</span>, <span class="number">143</span>, <span class="number">144</span>, <span class="number">145</span>, <span class="number">146</span>, <span class="number">147</span>, <span class="number">148</span>, <span class="number">149</span>, <span class="number">150</span>, <span class="number">151</span>, <span class="number">152</span>, <span class="number">153</span>, <span class="number">154</span>, <span class="number">155</span>, <span class="number">156</span>, <span class="number">157</span>, <span class="number">158</span>, <span class="number">159</span>, <span class="number">160</span>, <span class="number">161</span>, <span class="number">162</span>, <span class="number">163</span>, <span class="number">164</span>, <span class="number">165</span>, <span class="number">166</span>, <span class="number">167</span>, <span class="number">168</span>, <span class="number">169</span>, <span class="number">170</span>, <span class="number">171</span>...</span><br><span class="line"></span><br><span class="line"><span class="attribute">scala</span>&gt; test.filter(_&gt;<span class="number">999</span>).collect</span><br><span class="line"><span class="attribute">res16</span>: Array[Int] = Array(<span class="number">1000</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>mapPartitionsWithIndex：就是和mappartition是基本上一样的就是多了个索引</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> rdd = sc.make<span class="constructor">RDD(List(1,2,3,4)</span>,numSlices = <span class="number">2</span>)<span class="comment">//分区为2</span></span><br><span class="line">scala&gt; rdd.map<span class="constructor">PartitionsWithIndex((<span class="params">index</span>,<span class="params">iter</span>)</span>=&gt; &#123;<span class="keyword">if</span>(index ==<span class="number">1</span>) &#123; iter &#125; <span class="keyword">else</span> &#123; <span class="module-access"><span class="module"><span class="identifier">Nil</span>.</span></span>iterator&#125;&#125;).collect.foreach(println)</span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line">scala&gt; rdd.map<span class="constructor">PartitionsWithIndex((<span class="params">index</span>,<span class="params">iter</span>)</span>=&gt; &#123;iter.map(num =&gt; &#123;(index , num)&#125;)&#125;).collect.foreach(println)</span><br><span class="line">(<span class="number">0</span>,<span class="number">1</span>)</span><br><span class="line">(<span class="number">0</span>,<span class="number">2</span>)</span><br><span class="line">(<span class="number">1</span>,<span class="number">3</span>)</span><br><span class="line">(<span class="number">1</span>,<span class="number">4</span>)</span><br><span class="line">-=--------------------------------------------------------mappartition</span><br><span class="line">scala&gt; test1.map<span class="constructor">Partitions(<span class="params">_</span>.<span class="params">map</span>(<span class="params">_</span>.<span class="params">_2</span>)</span>,<span class="literal">true</span>).collect.foreach(print)</span><br><span class="line"><span class="number">1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798991001011021031041051061071081091101111121131141151161171181191201211221231241251261271281291301311321331341351361371381391401411421431441451461471481491501511521531541551561571581591601611621631641651661671681691701711721731741751761771781791801811821831841851861871881891901911921931941951961971981992002012022032042052062072082092102112122132142152162172182192202212222232242252262272282292302312322332342352362372382392402412422432442452462472482492502512522532542552562572582592602612622632642652662672682692702712722732742752762772782792802812822832842852862872882892902912922932942952962972982993003013023033043053063073083093103113123133143153163173183193203213223233243253263273283293303313323333343353363373383393403413423433443453463473483493503513523533543553563573583593603613623633643653663673683693703713723733743753763773783793803813823833843853863873883893903913923933943953963973983994004014024034044054064074084094104114124134144154164174184194204214224234244254264274284294304314324334344354364374384394404414424434444454464474484494504514524534544554564574584594604614624634644654664674684694704714724734744754764774784794804814824834844854864874884894904914924934944954964974984995005015025035045055065075085095105115125135145155165175185195205215225235245255265275285295305315325335345355365375385395405415425435445455465475485495505515525535545555565575585595605615625635645655665675685695705715725735745755765775785795805815825835845855865875885895905915925935945955965975985996006016026036046056066076086096106116126136146156166176186196206216226236246256266276286296306316326336346356366376386396406416426436446456466476486496506516526536546556566576586596606616626636646656666676686696706716726736746756766776786796806816826836846856866876886896906916926936946956966976986997007017027037047057067077087097107117127137147157167177187197207217227237247257267277287297307317327337347357367377387397407417427437447457467477487497507517527537547557567577587597607617627637647657667677687697707717727737747757767777787797807817827837847857867877887897907917927937947957967977987998008018028038048058068078088098108118128138148158168178188198208218228238248258268278288298308318328338348358368378388398408418428438448458468478488498508518528538548558568578588598608618628638648658668678688698708718728738748758768778788798808818828838848858868878888898908918928938948958968978988999009019029039049059069079089099109119129139149159169179189199209219229239249259269279289299309319329339349359369379389399409419429439449459469479489499509519529539549559569579589599609619629639649659669679689699709719729739749759769779789799809819829839849859869879889899909919929939949959969979989991000</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>一般的使用场景是查看partition里的元素</p>
<p>每个rdd的数据落到是什么分区上，我们不用太管，后面会讲</p>
<p>mapValues：只对kv类型的数据进行操作，相当于是单独对每个values做处理</p>
<figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">scala&gt; test<span class="number">1.</span>mapValues<span class="comment">(_+3)</span>.collect.foreach<span class="comment">(print)</span></span><br><span class="line"><span class="comment">(0,4)</span><span class="comment">(0,5)</span><span class="comment">(0,6)</span><span class="comment">(0,7)</span><span class="comment">(0,8)</span><span class="comment">(0,9)</span><span class="comment">(0,10)</span><span class="comment">(0,11)</span><span class="comment">(0,12)</span><span class="comment">(0,13)</span><span class="comment">(0,14)</span><span class="comment">(0,15)</span><span class="comment">(0,16)</span><span class="comment">(0,17)</span><span class="comment">(0,18)</span><span class="comment">(0,19)</span><span class="comment">(0,20)</span><span class="comment">(0,21)</span><span class="comment">(0,22)</span><span class="comment">(0,23)</span><span class="comment">(0,24)</span><span class="comment">(0,25)</span><span class="comment">(0,26)</span><span class="comment">(0,27)</span><span class="comment">(0,28)</span><span class="comment">(0,29)</span><span class="comment">(0,30)</span><span class="comment">(0,31)</span><span class="comment">(0,32)</span><span class="comment">(0,33)</span><span class="comment">(0,34)</span><span class="comment">(0,35)</span><span class="comment">(0,36)</span><span class="comment">(0,37)</span><span class="comment">(0,38)</span><span class="comment">(0,39)</span><span class="comment">(0,40)</span><span class="comment">(0,41)</span><span class="comment">(0,42)</span><span class="comment">(0,43)</span><span class="comment">(0,44)</span><span class="comment">(0,45)</span><span class="comment">(0,46)</span><span class="comment">(0,47)</span><span class="comment">(0,48)</span><span class="comment">(0,49)</span><span class="comment">(0,50)</span><span class="comment">(0,51)</span><span class="comment">(0,52)</span><span class="comment">(0,53)</span><span class="comment">(0,54)</span><span class="comment">(0,55)</span><span class="comment">(0,56)</span><span class="comment">(0,57)</span><span class="comment">(0,58)</span><span class="comment">(0,59)</span><span class="comment">(0,60)</span><span class="comment">(0,61)</span><span class="comment">(0,62)</span><span class="comment">(0,63)</span><span class="comment">(0,64)</span><span class="comment">(0,65)</span><span class="comment">(0,66)</span><span class="comment">(0,67)</span><span class="comment">(0,68)</span><span class="comment">(0,69)</span><span class="comment">(0,70)</span><span class="comment">(0,71)</span><span class="comment">(0,72)</span><span class="comment">(0,73)</span><span class="comment">(0,74)</span><span class="comment">(0,75)</span><span class="comment">(0,76)</span><span class="comment">(0,77)</span><span class="comment">(0,78)</span><span class="comment">(0,79)</span><span class="comment">(0,80)</span><span class="comment">(0,81)</span><span class="comment">(0,82)</span><span class="comment">(0,83)</span><span class="comment">(0,84)</span><span class="comment">(0,85)</span><span class="comment">(0,86)</span><span class="comment">(0,87)</span><span class="comment">(0,88)</span><span class="comment">(0,89)</span><span class="comment">(0,90)</span><span class="comment">(0,91)</span><span class="comment">(0,92)</span><span class="comment">(0,93)</span><span class="comment">(0,94)</span><span class="comment">(0,95)</span><span class="comment">(0,96)</span><span class="comment">(0,97)</span><span class="comment">(0,98)</span><span class="comment">(0,99)</span><span class="comment">(0,100)</span><span class="comment">(0,101)</span><span class="comment">(0,102)</span><span class="comment">(0,103)</span><span class="comment">(0,104)</span><span class="comment">(0,105)</span><span class="comment">(0,106)</span><span class="comment">(0,107)</span><span class="comment">(0,108)</span><span class="comment">(0,109)</span><span class="comment">(0,110)</span><span class="comment">(0,111)</span><span class="comment">(0,112)</span><span class="comment">(0,113)</span><span class="comment">(0,114)</span><span class="comment">(0,115)</span><span class="comment">(0,116)</span><span class="comment">(0,117)</span><span class="comment">(0,118)</span><span class="comment">(0,119)</span><span class="comment">(0,120)</span><span class="comment">(0,121)</span><span class="comment">(0,122)</span><span class="comment">(0,123)</span><span class="comment">(0,124)</span><span class="comment">(0,125)</span><span class="comment">(0,126)</span><span class="comment">(0,127)</span><span class="comment">(0,128)</span><span class="comment">(0,129)</span><span class="comment">(0,130)</span><span class="comment">(0,131)</span><span class="comment">(0,132)</span><span class="comment">(0,133)</span><span class="comment">(0,134)</span><span class="comment">(0,135)</span><span class="comment">(0,136)</span><span class="comment">(0,137)</span><span class="comment">(0,138)</span><span class="comment">(0,139)</span><span class="comment">(0,140)</span><span class="comment">(0,141)</span><span class="comment">(0,142)</span><span class="comment">(0,143)</span><span class="comment">(0,144)</span><span class="comment">(0,145)</span><span class="comment">(0,146)</span><span class="comment">(0,147)</span><span class="comment">(0,148)</span><span class="comment">(0,149)</span><span class="comment">(0,150)</span><span class="comment">(0,151)</span><span class="comment">(0,152)</span><span class="comment">(0,153)</span><span class="comment">(0,154)</span><span class="comment">(0,155)</span><span class="comment">(0,156)</span><span class="comment">(0,157)</span><span class="comment">(0,158)</span><span class="comment">(0,159)</span><span class="comment">(0,160)</span><span class="comment">(0,161)</span><span class="comment">(0,162)</span><span class="comment">(0,163)</span><span class="comment">(0,164)</span><span class="comment">(0,165)</span><span class="comment">(0,166)</span><span class="comment">(0,167)</span><span class="comment">(0,168)</span><span class="comment">(0,169)</span><span class="comment">(0,170)</span><span class="comment">(0,171)</span><span class="comment">(0,172)</span><span class="comment">(0,173)</span><span class="comment">(0,174)</span><span class="comment">(0,175)</span><span class="comment">(0,176)</span><span class="comment">(0,177)</span><span class="comment">(0,178)</span><span class="comment">(0,179)</span><span class="comment">(0,180)</span><span class="comment">(0,181)</span><span class="comment">(0,182)</span><span class="comment">(0,183)</span><span class="comment">(0,184)</span><span class="comment">(0,185)</span><span class="comment">(0,186)</span><span class="comment">(0,187)</span><span class="comment">(0,188)</span><span class="comment">(0,189)</span><span class="comment">(0,190)</span><span class="comment">(0,191)</span><span class="comment">(0,192)</span><span class="comment">(0,193)</span><span class="comment">(0,194)</span><span class="comment">(0,195)</span><span class="comment">(0,196)</span><span class="comment">(0,197)</span><span class="comment">(0,198)</span><span class="comment">(0,199)</span><span class="comment">(0,200)</span><span class="comment">(0,201)</span><span class="comment">(0,202)</span><span class="comment">(0,203)</span><span class="comment">(0,204)</span><span class="comment">(0,205)</span><span class="comment">(0,206)</span><span class="comment">(0,207)</span><span class="comment">(0,208)</span><span class="comment">(0,209)</span><span class="comment">(0,210)</span><span class="comment">(0,211)</span><span class="comment">(0,212)</span><span class="comment">(0,213)</span><span class="comment">(0,214)</span><span class="comment">(0,215)</span><span class="comment">(0,216)</span><span class="comment">(0,217)</span><span class="comment">(0,218)</span><span class="comment">(0,219)</span><span class="comment">(0,220)</span><span class="comment">(0,221)</span><span class="comment">(0,222)</span><span class="comment">(0,223)</span><span class="comment">(0,224)</span><span class="comment">(0,225)</span><span class="comment">(0,226)</span><span class="comment">(0,227)</span><span class="comment">(0,228)</span><span class="comment">(0,229)</span><span class="comment">(0,230)</span><span class="comment">(0,231)</span><span class="comment">(0,232)</span><span class="comment">(0,233)</span><span class="comment">(0,234)</span><span class="comment">(0,235)</span><span class="comment">(0,236)</span><span class="comment">(0,237)</span><span class="comment">(0,238)</span><span class="comment">(0,239)</span><span class="comment">(0,240)</span><span class="comment">(0,241)</span><span class="comment">(0,242)</span><span class="comment">(0,243)</span><span class="comment">(0,244)</span><span class="comment">(0,245)</span><span class="comment">(0,246)</span><span class="comment">(0,247)</span><span class="comment">(0,248)</span><span class="comment">(0,249)</span><span class="comment">(0,250)</span><span class="comment">(0,251)</span><span class="comment">(0,252)</span><span class="comment">(0,253)</span><span class="comment">(0,254)</span><span class="comment">(0,255)</span><span class="comment">(0,256)</span><span class="comment">(0,257)</span><span class="comment">(0,258)</span><span class="comment">(0,259)</span><span class="comment">(0,260)</span><span class="comment">(0,261)</span><span class="comment">(0,262)</span><span class="comment">(0,263)</span><span class="comment">(0,264)</span><span class="comment">(0,265)</span><span class="comment">(0,266)</span><span class="comment">(0,267)</span><span class="comment">(0,268)</span><span class="comment">(0,269)</span><span class="comment">(0,270)</span><span class="comment">(0,271)</span><span class="comment">(0,272)</span><span class="comment">(0,273)</span><span class="comment">(0,274)</span><span class="comment">(0,275)</span><span class="comment">(0,276)</span><span class="comment">(0,277)</span><span class="comment">(0,278)</span><span class="comment">(0,279)</span><span class="comment">(0,280)</span><span class="comment">(0,281)</span><span class="comment">(0,282)</span><span class="comment">(0,283)</span><span class="comment">(0,284)</span><span class="comment">(0,285)</span><span class="comment">(0,286)</span><span class="comment">(0,287)</span><span class="comment">(0,288)</span><span class="comment">(0,289)</span><span class="comment">(0,290)</span><span class="comment">(0,291)</span><span class="comment">(0,292)</span><span class="comment">(0,293)</span><span class="comment">(0,294)</span><span class="comment">(0,295)</span><span class="comment">(0,296)</span><span class="comment">(0,297)</span><span class="comment">(0,298)</span><span class="comment">(0,299)</span><span class="comment">(0,300)</span><span class="comment">(0,301)</span><span class="comment">(0,302)</span><span class="comment">(0,303)</span><span class="comment">(0,304)</span><span class="comment">(0,305)</span><span class="comment">(0,306)</span><span class="comment">(0,307)</span><span class="comment">(0,308)</span><span class="comment">(0,309)</span><span class="comment">(0,310)</span><span class="comment">(0,311)</span><span class="comment">(0,312)</span><span class="comment">(0,313)</span><span class="comment">(0,314)</span><span class="comment">(0,315)</span><span class="comment">(0,316)</span><span class="comment">(0,317)</span><span class="comment">(0,318)</span><span class="comment">(0,319)</span><span class="comment">(0,320)</span><span class="comment">(0,321)</span><span class="comment">(0,322)</span><span class="comment">(0,323)</span><span class="comment">(0,324)</span><span class="comment">(0,325)</span><span class="comment">(0,326)</span><span class="comment">(0,327)</span><span class="comment">(0,328)</span><span class="comment">(0,329)</span><span class="comment">(0,330)</span><span class="comment">(0,331)</span><span class="comment">(0,332)</span><span class="comment">(0,333)</span><span class="comment">(0,334)</span><span class="comment">(0,335)</span><span class="comment">(0,336)</span><span class="comment">(0,337)</span><span class="comment">(0,338)</span><span class="comment">(0,339)</span><span class="comment">(0,340)</span><span class="comment">(0,341)</span><span class="comment">(0,342)</span><span class="comment">(0,343)</span><span class="comment">(0,344)</span><span class="comment">(0,345)</span><span class="comment">(0,346)</span><span class="comment">(0,347)</span><span class="comment">(0,348)</span><span class="comment">(0,349)</span><span class="comment">(0,350)</span><span class="comment">(0,351)</span><span class="comment">(0,352)</span><span class="comment">(0,353)</span><span class="comment">(0,354)</span><span class="comment">(0,355)</span><span class="comment">(0,356)</span><span class="comment">(0,357)</span><span class="comment">(0,358)</span><span class="comment">(0,359)</span><span class="comment">(0,360)</span><span class="comment">(0,361)</span><span class="comment">(0,362)</span><span class="comment">(0,363)</span><span class="comment">(0,364)</span><span class="comment">(0,365)</span><span class="comment">(0,366)</span><span class="comment">(0,367)</span><span class="comment">(0,368)</span><span class="comment">(0,369)</span><span class="comment">(0,370)</span><span class="comment">(0,371)</span><span class="comment">(0,372)</span><span class="comment">(0,373)</span><span class="comment">(0,374)</span><span class="comment">(0,375)</span><span class="comment">(0,376)</span><span class="comment">(0,377)</span><span class="comment">(0,378)</span><span class="comment">(0,379)</span><span class="comment">(0,380)</span><span class="comment">(0,381)</span><span class="comment">(0,382)</span><span class="comment">(0,383)</span><span class="comment">(0,384)</span><span class="comment">(0,385)</span><span class="comment">(0,386)</span><span class="comment">(0,387)</span><span class="comment">(0,388)</span><span class="comment">(0,389)</span><span class="comment">(0,390)</span><span class="comment">(0,391)</span><span class="comment">(0,392)</span><span class="comment">(0,393)</span><span class="comment">(0,394)</span><span class="comment">(0,395)</span><span class="comment">(0,396)</span><span class="comment">(0,397)</span><span class="comment">(0,398)</span><span class="comment">(0,399)</span><span class="comment">(0,400)</span><span class="comment">(0,401)</span><span class="comment">(0,402)</span><span class="comment">(0,403)</span><span class="comment">(0,404)</span><span class="comment">(0,405)</span><span class="comment">(0,406)</span><span class="comment">(0,407)</span><span class="comment">(0,408)</span><span class="comment">(0,409)</span><span class="comment">(0,410)</span><span class="comment">(0,411)</span><span class="comment">(0,412)</span><span class="comment">(0,413)</span><span class="comment">(0,414)</span><span class="comment">(0,415)</span><span class="comment">(0,416)</span><span class="comment">(0,417)</span><span class="comment">(0,418)</span><span class="comment">(0,419)</span><span class="comment">(0,420)</span><span class="comment">(0,421)</span><span class="comment">(0,422)</span><span class="comment">(0,423)</span><span class="comment">(0,424)</span><span class="comment">(0,425)</span><span class="comment">(0,426)</span><span class="comment">(0,427)</span><span class="comment">(0,428)</span><span class="comment">(0,429)</span><span class="comment">(0,430)</span><span class="comment">(0,431)</span><span class="comment">(0,432)</span><span class="comment">(0,433)</span><span class="comment">(0,434)</span><span class="comment">(0,435)</span><span class="comment">(0,436)</span><span class="comment">(0,437)</span><span class="comment">(0,438)</span><span class="comment">(0,439)</span><span class="comment">(0,440)</span><span class="comment">(0,441)</span><span class="comment">(0,442)</span><span class="comment">(0,443)</span><span class="comment">(0,444)</span><span class="comment">(0,445)</span><span class="comment">(0,446)</span><span class="comment">(0,447)</span><span class="comment">(0,448)</span><span class="comment">(0,449)</span><span class="comment">(0,450)</span><span class="comment">(0,451)</span><span class="comment">(0,452)</span><span class="comment">(0,453)</span><span class="comment">(0,454)</span><span class="comment">(0,455)</span><span class="comment">(0,456)</span><span class="comment">(0,457)</span><span class="comment">(0,458)</span><span class="comment">(0,459)</span><span class="comment">(0,460)</span><span class="comment">(0,461)</span><span class="comment">(0,462)</span><span class="comment">(0,463)</span><span class="comment">(0,464)</span><span class="comment">(0,465)</span><span class="comment">(0,466)</span><span class="comment">(0,467)</span><span class="comment">(0,468)</span><span class="comment">(0,469)</span><span class="comment">(0,470)</span><span class="comment">(0,471)</span><span class="comment">(0,472)</span><span class="comment">(0,473)</span><span class="comment">(0,474)</span><span class="comment">(0,475)</span><span class="comment">(0,476)</span><span class="comment">(0,477)</span><span class="comment">(0,478)</span><span class="comment">(0,479)</span><span class="comment">(0,480)</span><span class="comment">(0,481)</span><span class="comment">(0,482)</span><span class="comment">(0,483)</span><span class="comment">(0,484)</span><span class="comment">(0,485)</span><span class="comment">(0,486)</span><span class="comment">(0,487)</span><span class="comment">(0,488)</span><span class="comment">(0,489)</span><span class="comment">(0,490)</span><span class="comment">(0,491)</span><span class="comment">(0,492)</span><span class="comment">(0,493)</span><span class="comment">(0,494)</span><span class="comment">(0,495)</span><span class="comment">(0,496)</span><span class="comment">(0,497)</span><span class="comment">(0,498)</span><span class="comment">(0,499)</span><span class="comment">(0,500)</span><span class="comment">(0,501)</span><span class="comment">(0,502)</span><span class="comment">(0,503)</span><span class="comment">(1,504)</span><span class="comment">(1,505)</span><span class="comment">(1,506)</span><span class="comment">(1,507)</span><span class="comment">(1,508)</span><span class="comment">(1,509)</span><span class="comment">(1,510)</span><span class="comment">(1,511)</span><span class="comment">(1,512)</span><span class="comment">(1,513)</span><span class="comment">(1,514)</span><span class="comment">(1,515)</span><span class="comment">(1,516)</span><span class="comment">(1,517)</span><span class="comment">(1,518)</span><span class="comment">(1,519)</span><span class="comment">(1,520)</span><span class="comment">(1,521)</span><span class="comment">(1,522)</span><span class="comment">(1,523)</span><span class="comment">(1,524)</span><span class="comment">(1,525)</span><span class="comment">(1,526)</span><span class="comment">(1,527)</span><span class="comment">(1,528)</span><span class="comment">(1,529)</span><span class="comment">(1,530)</span><span class="comment">(1,531)</span><span class="comment">(1,532)</span><span class="comment">(1,533)</span><span class="comment">(1,534)</span><span class="comment">(1,535)</span><span class="comment">(1,536)</span><span class="comment">(1,537)</span><span class="comment">(1,538)</span><span class="comment">(1,539)</span><span class="comment">(1,540)</span><span class="comment">(1,541)</span><span class="comment">(1,542)</span><span class="comment">(1,543)</span><span class="comment">(1,544)</span><span class="comment">(1,545)</span><span class="comment">(1,546)</span><span class="comment">(1,547)</span><span class="comment">(1,548)</span><span class="comment">(1,549)</span><span class="comment">(1,550)</span><span class="comment">(1,551)</span><span class="comment">(1,552)</span><span class="comment">(1,553)</span><span class="comment">(1,554)</span><span class="comment">(1,555)</span><span class="comment">(1,556)</span><span class="comment">(1,557)</span><span class="comment">(1,558)</span><span class="comment">(1,559)</span><span class="comment">(1,560)</span><span class="comment">(1,561)</span><span class="comment">(1,562)</span><span class="comment">(1,563)</span><span class="comment">(1,564)</span><span class="comment">(1,565)</span><span class="comment">(1,566)</span><span class="comment">(1,567)</span><span class="comment">(1,568)</span><span class="comment">(1,569)</span><span class="comment">(1,570)</span><span class="comment">(1,571)</span><span class="comment">(1,572)</span><span class="comment">(1,573)</span><span class="comment">(1,574)</span><span class="comment">(1,575)</span><span class="comment">(1,576)</span><span class="comment">(1,577)</span><span class="comment">(1,578)</span><span class="comment">(1,579)</span><span class="comment">(1,580)</span><span class="comment">(1,581)</span><span class="comment">(1,582)</span><span class="comment">(1,583)</span><span class="comment">(1,584)</span><span class="comment">(1,585)</span><span class="comment">(1,586)</span><span class="comment">(1,587)</span><span class="comment">(1,588)</span><span class="comment">(1,589)</span><span class="comment">(1,590)</span><span class="comment">(1,591)</span><span class="comment">(1,592)</span><span class="comment">(1,593)</span><span class="comment">(1,594)</span><span class="comment">(1,595)</span><span class="comment">(1,596)</span><span class="comment">(1,597)</span><span class="comment">(1,598)</span><span class="comment">(1,599)</span><span class="comment">(1,600)</span><span class="comment">(1,601)</span><span class="comment">(1,602)</span><span class="comment">(1,603)</span><span class="comment">(1,604)</span><span class="comment">(1,605)</span><span class="comment">(1,606)</span><span class="comment">(1,607)</span><span class="comment">(1,608)</span><span class="comment">(1,609)</span><span class="comment">(1,610)</span><span class="comment">(1,611)</span><span class="comment">(1,612)</span><span class="comment">(1,613)</span><span class="comment">(1,614)</span><span class="comment">(1,615)</span><span class="comment">(1,616)</span><span class="comment">(1,617)</span><span class="comment">(1,618)</span><span class="comment">(1,619)</span><span class="comment">(1,620)</span><span class="comment">(1,621)</span><span class="comment">(1,622)</span><span class="comment">(1,623)</span><span class="comment">(1,624)</span><span class="comment">(1,625)</span><span class="comment">(1,626)</span><span class="comment">(1,627)</span><span class="comment">(1,628)</span><span class="comment">(1,629)</span><span class="comment">(1,630)</span><span class="comment">(1,631)</span><span class="comment">(1,632)</span><span class="comment">(1,633)</span><span class="comment">(1,634)</span><span class="comment">(1,635)</span><span class="comment">(1,636)</span><span class="comment">(1,637)</span><span class="comment">(1,638)</span><span class="comment">(1,639)</span><span class="comment">(1,640)</span><span class="comment">(1,641)</span><span class="comment">(1,642)</span><span class="comment">(1,643)</span><span class="comment">(1,644)</span><span class="comment">(1,645)</span><span class="comment">(1,646)</span><span class="comment">(1,647)</span><span class="comment">(1,648)</span><span class="comment">(1,649)</span><span class="comment">(1,650)</span><span class="comment">(1,651)</span><span class="comment">(1,652)</span><span class="comment">(1,653)</span><span class="comment">(1,654)</span><span class="comment">(1,655)</span><span class="comment">(1,656)</span><span class="comment">(1,657)</span><span class="comment">(1,658)</span><span class="comment">(1,659)</span><span class="comment">(1,660)</span><span class="comment">(1,661)</span><span class="comment">(1,662)</span><span class="comment">(1,663)</span><span class="comment">(1,664)</span><span class="comment">(1,665)</span><span class="comment">(1,666)</span><span class="comment">(1,667)</span><span class="comment">(1,668)</span><span class="comment">(1,669)</span><span class="comment">(1,670)</span><span class="comment">(1,671)</span><span class="comment">(1,672)</span><span class="comment">(1,673)</span><span class="comment">(1,674)</span><span class="comment">(1,675)</span><span class="comment">(1,676)</span><span class="comment">(1,677)</span><span class="comment">(1,678)</span><span class="comment">(1,679)</span><span class="comment">(1,680)</span><span class="comment">(1,681)</span><span class="comment">(1,682)</span><span class="comment">(1,683)</span><span class="comment">(1,684)</span><span class="comment">(1,685)</span><span class="comment">(1,686)</span><span class="comment">(1,687)</span><span class="comment">(1,688)</span><span class="comment">(1,689)</span><span class="comment">(1,690)</span><span class="comment">(1,691)</span><span class="comment">(1,692)</span><span class="comment">(1,693)</span><span class="comment">(1,694)</span><span class="comment">(1,695)</span><span class="comment">(1,696)</span><span class="comment">(1,697)</span><span class="comment">(1,698)</span><span class="comment">(1,699)</span><span class="comment">(1,700)</span><span class="comment">(1,701)</span><span class="comment">(1,702)</span><span class="comment">(1,703)</span><span class="comment">(1,704)</span><span class="comment">(1,705)</span><span class="comment">(1,706)</span><span class="comment">(1,707)</span><span class="comment">(1,708)</span><span class="comment">(1,709)</span><span class="comment">(1,710)</span><span class="comment">(1,711)</span><span class="comment">(1,712)</span><span class="comment">(1,713)</span><span class="comment">(1,714)</span><span class="comment">(1,715)</span><span class="comment">(1,716)</span><span class="comment">(1,717)</span><span class="comment">(1,718)</span><span class="comment">(1,719)</span><span class="comment">(1,720)</span><span class="comment">(1,721)</span><span class="comment">(1,722)</span><span class="comment">(1,723)</span><span class="comment">(1,724)</span><span class="comment">(1,725)</span><span class="comment">(1,726)</span><span class="comment">(1,727)</span><span class="comment">(1,728)</span><span class="comment">(1,729)</span><span class="comment">(1,730)</span><span class="comment">(1,731)</span><span class="comment">(1,732)</span><span class="comment">(1,733)</span><span class="comment">(1,734)</span><span class="comment">(1,735)</span><span class="comment">(1,736)</span><span class="comment">(1,737)</span><span class="comment">(1,738)</span><span class="comment">(1,739)</span><span class="comment">(1,740)</span><span class="comment">(1,741)</span><span class="comment">(1,742)</span><span class="comment">(1,743)</span><span class="comment">(1,744)</span><span class="comment">(1,745)</span><span class="comment">(1,746)</span><span class="comment">(1,747)</span><span class="comment">(1,748)</span><span class="comment">(1,749)</span><span class="comment">(1,750)</span><span class="comment">(1,751)</span><span class="comment">(1,752)</span><span class="comment">(1,753)</span><span class="comment">(1,754)</span><span class="comment">(1,755)</span><span class="comment">(1,756)</span><span class="comment">(1,757)</span><span class="comment">(1,758)</span><span class="comment">(1,759)</span><span class="comment">(1,760)</span><span class="comment">(1,761)</span><span class="comment">(1,762)</span><span class="comment">(1,763)</span><span class="comment">(1,764)</span><span class="comment">(1,765)</span><span class="comment">(1,766)</span><span class="comment">(1,767)</span><span class="comment">(1,768)</span><span class="comment">(1,769)</span><span class="comment">(1,770)</span><span class="comment">(1,771)</span><span class="comment">(1,772)</span><span class="comment">(1,773)</span><span class="comment">(1,774)</span><span class="comment">(1,775)</span><span class="comment">(1,776)</span><span class="comment">(1,777)</span><span class="comment">(1,778)</span><span class="comment">(1,779)</span><span class="comment">(1,780)</span><span class="comment">(1,781)</span><span class="comment">(1,782)</span><span class="comment">(1,783)</span><span class="comment">(1,784)</span><span class="comment">(1,785)</span><span class="comment">(1,786)</span><span class="comment">(1,787)</span><span class="comment">(1,788)</span><span class="comment">(1,789)</span><span class="comment">(1,790)</span><span class="comment">(1,791)</span><span class="comment">(1,792)</span><span class="comment">(1,793)</span><span class="comment">(1,794)</span><span class="comment">(1,795)</span><span class="comment">(1,796)</span><span class="comment">(1,797)</span><span class="comment">(1,798)</span><span class="comment">(1,799)</span><span class="comment">(1,800)</span><span class="comment">(1,801)</span><span class="comment">(1,802)</span><span class="comment">(1,803)</span><span class="comment">(1,804)</span><span class="comment">(1,805)</span><span class="comment">(1,806)</span><span class="comment">(1,807)</span><span class="comment">(1,808)</span><span class="comment">(1,809)</span><span class="comment">(1,810)</span><span class="comment">(1,811)</span><span class="comment">(1,812)</span><span class="comment">(1,813)</span><span class="comment">(1,814)</span><span class="comment">(1,815)</span><span class="comment">(1,816)</span><span class="comment">(1,817)</span><span class="comment">(1,818)</span><span class="comment">(1,819)</span><span class="comment">(1,820)</span><span class="comment">(1,821)</span><span class="comment">(1,822)</span><span class="comment">(1,823)</span><span class="comment">(1,824)</span><span class="comment">(1,825)</span><span class="comment">(1,826)</span><span class="comment">(1,827)</span><span class="comment">(1,828)</span><span class="comment">(1,829)</span><span class="comment">(1,830)</span><span class="comment">(1,831)</span><span class="comment">(1,832)</span><span class="comment">(1,833)</span><span class="comment">(1,834)</span><span class="comment">(1,835)</span><span class="comment">(1,836)</span><span class="comment">(1,837)</span><span class="comment">(1,838)</span><span class="comment">(1,839)</span><span class="comment">(1,840)</span><span class="comment">(1,841)</span><span class="comment">(1,842)</span><span class="comment">(1,843)</span><span class="comment">(1,844)</span><span class="comment">(1,845)</span><span class="comment">(1,846)</span><span class="comment">(1,847)</span><span class="comment">(1,848)</span><span class="comment">(1,849)</span><span class="comment">(1,850)</span><span class="comment">(1,851)</span><span class="comment">(1,852)</span><span class="comment">(1,853)</span><span class="comment">(1,854)</span><span class="comment">(1,855)</span><span class="comment">(1,856)</span><span class="comment">(1,857)</span><span class="comment">(1,858)</span><span class="comment">(1,859)</span><span class="comment">(1,860)</span><span class="comment">(1,861)</span><span class="comment">(1,862)</span><span class="comment">(1,863)</span><span class="comment">(1,864)</span><span class="comment">(1,865)</span><span class="comment">(1,866)</span><span class="comment">(1,867)</span><span class="comment">(1,868)</span><span class="comment">(1,869)</span><span class="comment">(1,870)</span><span class="comment">(1,871)</span><span class="comment">(1,872)</span><span class="comment">(1,873)</span><span class="comment">(1,874)</span><span class="comment">(1,875)</span><span class="comment">(1,876)</span><span class="comment">(1,877)</span><span class="comment">(1,878)</span><span class="comment">(1,879)</span><span class="comment">(1,880)</span><span class="comment">(1,881)</span><span class="comment">(1,882)</span><span class="comment">(1,883)</span><span class="comment">(1,884)</span><span class="comment">(1,885)</span><span class="comment">(1,886)</span><span class="comment">(1,887)</span><span class="comment">(1,888)</span><span class="comment">(1,889)</span><span class="comment">(1,890)</span><span class="comment">(1,891)</span><span class="comment">(1,892)</span><span class="comment">(1,893)</span><span class="comment">(1,894)</span><span class="comment">(1,895)</span><span class="comment">(1,896)</span><span class="comment">(1,897)</span><span class="comment">(1,898)</span><span class="comment">(1,899)</span><span class="comment">(1,900)</span><span class="comment">(1,901)</span><span class="comment">(1,902)</span><span class="comment">(1,903)</span><span class="comment">(1,904)</span><span class="comment">(1,905)</span><span class="comment">(1,906)</span><span class="comment">(1,907)</span><span class="comment">(1,908)</span><span class="comment">(1,909)</span><span class="comment">(1,910)</span><span class="comment">(1,911)</span><span class="comment">(1,912)</span><span class="comment">(1,913)</span><span class="comment">(1,914)</span><span class="comment">(1,915)</span><span class="comment">(1,916)</span><span class="comment">(1,917)</span><span class="comment">(1,918)</span><span class="comment">(1,919)</span><span class="comment">(1,920)</span><span class="comment">(1,921)</span><span class="comment">(1,922)</span><span class="comment">(1,923)</span><span class="comment">(1,924)</span><span class="comment">(1,925)</span><span class="comment">(1,926)</span><span class="comment">(1,927)</span><span class="comment">(1,928)</span><span class="comment">(1,929)</span><span class="comment">(1,930)</span><span class="comment">(1,931)</span><span class="comment">(1,932)</span><span class="comment">(1,933)</span><span class="comment">(1,934)</span><span class="comment">(1,935)</span><span class="comment">(1,936)</span><span class="comment">(1,937)</span><span class="comment">(1,938)</span><span class="comment">(1,939)</span><span class="comment">(1,940)</span><span class="comment">(1,941)</span><span class="comment">(1,942)</span><span class="comment">(1,943)</span><span class="comment">(1,944)</span><span class="comment">(1,945)</span><span class="comment">(1,946)</span><span class="comment">(1,947)</span><span class="comment">(1,948)</span><span class="comment">(1,949)</span><span class="comment">(1,950)</span><span class="comment">(1,951)</span><span class="comment">(1,952)</span><span class="comment">(1,953)</span><span class="comment">(1,954)</span><span class="comment">(1,955)</span><span class="comment">(1,956)</span><span class="comment">(1,957)</span><span class="comment">(1,958)</span><span class="comment">(1,959)</span><span class="comment">(1,960)</span><span class="comment">(1,961)</span><span class="comment">(1,962)</span><span class="comment">(1,963)</span><span class="comment">(1,964)</span><span class="comment">(1,965)</span><span class="comment">(1,966)</span><span class="comment">(1,967)</span><span class="comment">(1,968)</span><span class="comment">(1,969)</span><span class="comment">(1,970)</span><span class="comment">(1,971)</span><span class="comment">(1,972)</span><span class="comment">(1,973)</span><span class="comment">(1,974)</span><span class="comment">(1,975)</span><span class="comment">(1,976)</span><span class="comment">(1,977)</span><span class="comment">(1,978)</span><span class="comment">(1,979)</span><span class="comment">(1,980)</span><span class="comment">(1,981)</span><span class="comment">(1,982)</span><span class="comment">(1,983)</span><span class="comment">(1,984)</span><span class="comment">(1,985)</span><span class="comment">(1,986)</span><span class="comment">(1,987)</span><span class="comment">(1,988)</span><span class="comment">(1,989)</span><span class="comment">(1,990)</span><span class="comment">(1,991)</span><span class="comment">(1,992)</span><span class="comment">(1,993)</span><span class="comment">(1,994)</span><span class="comment">(1,995)</span><span class="comment">(1,996)</span><span class="comment">(1,997)</span><span class="comment">(1,998)</span><span class="comment">(1,999)</span><span class="comment">(1,1000)</span><span class="comment">(1,1001)</span><span class="comment">(1,1002)</span><span class="comment">(1,1003)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>flatMap：和Scala里的是一样的</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">scala</span>&gt; test.flatMap(x=&gt;x.to(<span class="number">3</span>)).collect</span><br><span class="line"><span class="attribute">res98</span>: Array[Int] = Array(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>其他的算子</p>
<p>glom：把每个分区的数据形成一个数组，比mapPartitionWithIndex好用</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">scala</span>&gt; test.glom.collect</span><br><span class="line"><span class="attribute">res62</span>: Array[Array[Int]] = Array(Array(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">17</span>, <span class="number">18</span>, <span class="number">19</span>, <span class="number">20</span>, <span class="number">21</span>, <span class="number">22</span>, <span class="number">23</span>, <span class="number">24</span>, <span class="number">25</span>, <span class="number">26</span>, <span class="number">27</span>, <span class="number">28</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">31</span>, <span class="number">32</span>, <span class="number">33</span>, <span class="number">34</span>, <span class="number">35</span>, <span class="number">36</span>, <span class="number">37</span>, <span class="number">38</span>, <span class="number">39</span>, <span class="number">40</span>, <span class="number">41</span>, <span class="number">42</span>, <span class="number">43</span>, <span class="number">44</span>, <span class="number">45</span>, <span class="number">46</span>, <span class="number">47</span>, <span class="number">48</span>, <span class="number">49</span>, <span class="number">50</span>, <span class="number">51</span>, <span class="number">52</span>, <span class="number">53</span>, <span class="number">54</span>, <span class="number">55</span>, <span class="number">56</span>, <span class="number">57</span>, <span class="number">58</span>, <span class="number">59</span>, <span class="number">60</span>, <span class="number">61</span>, <span class="number">62</span>, <span class="number">63</span>, <span class="number">64</span>, <span class="number">65</span>, <span class="number">66</span>, <span class="number">67</span>, <span class="number">68</span>, <span class="number">69</span>, <span class="number">70</span>, <span class="number">71</span>, <span class="number">72</span>, <span class="number">73</span>, <span class="number">74</span>, <span class="number">75</span>, <span class="number">76</span>, <span class="number">77</span>, <span class="number">78</span>, <span class="number">79</span>, <span class="number">80</span>, <span class="number">81</span>, <span class="number">82</span>, <span class="number">83</span>, <span class="number">84</span>, <span class="number">85</span>, <span class="number">86</span>, <span class="number">87</span>, <span class="number">88</span>, <span class="number">89</span>, <span class="number">90</span>, <span class="number">91</span>, <span class="number">92</span>, <span class="number">93</span>, <span class="number">94</span>, <span class="number">95</span>, <span class="number">96</span>, <span class="number">97</span>, <span class="number">98</span>, <span class="number">99</span>, <span class="number">100</span>, <span class="number">101</span>, <span class="number">102</span>, <span class="number">103</span>, <span class="number">104</span>, <span class="number">105</span>, <span class="number">106</span>, <span class="number">107</span>, <span class="number">108</span>, <span class="number">109</span>, <span class="number">110</span>, <span class="number">111</span>, <span class="number">112</span>, <span class="number">113</span>, <span class="number">114</span>, <span class="number">115</span>, <span class="number">116</span>, <span class="number">117</span>, <span class="number">118</span>, <span class="number">119</span>, <span class="number">120</span>, <span class="number">121</span>, <span class="number">122</span>, <span class="number">123</span>, <span class="number">124</span>, <span class="number">125</span>, <span class="number">126</span>, <span class="number">127</span>, <span class="number">128</span>, <span class="number">129</span>, <span class="number">130</span>, <span class="number">131</span>, <span class="number">132</span>, <span class="number">133</span>, <span class="number">134</span>, <span class="number">135</span>, <span class="number">136</span>, <span class="number">137</span>, <span class="number">138</span>, <span class="number">139</span>, <span class="number">140</span>, <span class="number">141</span>, <span class="number">142</span>, <span class="number">143</span>, <span class="number">144</span>, <span class="number">145</span>, <span class="number">146</span>, <span class="number">147</span>, <span class="number">148</span>, <span class="number">149</span>, <span class="number">150</span>, <span class="number">151</span>, <span class="number">152</span>, <span class="number">153</span>, <span class="number">154</span>, <span class="number">155</span>, <span class="number">156</span>, <span class="number">157</span>, <span class="number">158</span>, <span class="number">159</span>, <span class="number">160</span>, <span class="number">161</span>, <span class="number">162</span>, <span class="number">163</span>, <span class="number">164</span>, <span class="number">165</span>, <span class="number">166</span>, <span class="number">167</span>, <span class="number">168</span>, ...</span><br></pre></td></tr></table></figure>

<p>sample：抽样，随机抽样的</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">scala</span>&gt; (<span class="keyword">test</span>.<span class="keyword">sample</span>(false,0.77)).collect.<span class="keyword">foreach</span>(<span class="keyword">print</span>)</span><br><span class="line">236781112141516182022232425262728303132333435363738394041434446474850515254555657596061626364666768697172747576777879818285868789919293969798991001011021031041051061071081091101111121131161181191201211221241251271281301311321331341351361371381391401411441461471491501531541551561611621631641651661671681691701711721731741751761781791801811831841861871891901911931951961971982002012022042052072082092112122132142162172182202212222242252262272282302322332352362372382402412432442452472482502512522532542552562572582602612632642652662672682692702712732742752762772782812822832842892902922932942952962972982993003013023033043053063073083093113123133143153163173183193203213223233263293303313323333343353363373383393403413423443463473483493513523543573583593603613623633663673683693703713723743763773783793803813823833873903913923943954004014024034044054074084094114124134144154164174184194224234244264274284294304314324334344354364374384394404414424454464494504514524534544554564574584604614634644654664674684694714724744754764794804814824834844854864874884904914924934944954974984995005015025065075085105115125135145165175185195225235245255265275295305315325355375385395405415425445455465475485495515525545565575585595605625635645655675685715735755765795805815825835845855895905925935955965975985996016026036046066086096106116126136146156166176206216226236246256266276296316326336346356366376386396406416436446456466476486496506516536546556576586596606616626636646676696706716726736746756766776796806816836846856866876896906916926936946976986997007037047057067087097107117127157167177187197217227237267277297307327337347357367377387417427447457467477487497517527537547557567577587597607627637667677697707727737747757777787797807817827837847867887897907917937957967987998018028038048058068078098108128138148178198208228248258268278288308318328348358368378388408418428438458468478488498508528538548558588598608618628638648658668678688698708718758768778788798808828838848878888898908918958988999009019029039049059069079099129149159179189199209219229249259269279289299309319329339349359369379389399419429439449469489499509519549559569589599609619629639649659679689699709729749759769799809819829839859869879889899909919939949969979989991000</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>union：简单的数据合并，不去重</p>
<p>intersection：两个rdd的交集</p>
<p>subtract：出现在a里的没有出现在b里</p>
<p>.collect:把结果以数组的形式转到控制台</p>
<p>distinct：去重和sql效果一样 &#x3D;》 底层去重的方法是用reduceByKey进行去重的目的</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">scala&gt; val <span class="selector-tag">dd</span> = sc<span class="selector-class">.parallelize</span>(<span class="built_in">List</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>))</span><br><span class="line"><span class="selector-tag">dd</span>: org<span class="selector-class">.apache</span><span class="selector-class">.spark</span><span class="selector-class">.rdd</span><span class="selector-class">.RDD</span><span class="selector-attr">[Int]</span> = ParallelCollectionRDD<span class="selector-attr">[28]</span> at parallelize at &lt;console&gt;:<span class="number">24</span></span><br><span class="line"></span><br><span class="line">scala&gt; <span class="selector-tag">dd</span><span class="selector-class">.collect</span><span class="selector-class">.foreach</span>(print)</span><br><span class="line"><span class="number">122345678</span></span><br><span class="line">scala&gt; <span class="selector-tag">dd</span><span class="selector-class">.collect</span><span class="selector-class">.foreach</span>(println)</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">5</span></span><br><span class="line"><span class="number">6</span></span><br><span class="line"><span class="number">7</span></span><br><span class="line"><span class="number">8</span></span><br><span class="line"></span><br><span class="line">scala&gt; <span class="selector-tag">dd</span><span class="selector-class">.distinct</span><span class="selector-class">.collect</span><span class="selector-class">.foreach</span>(println)</span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">6</span></span><br><span class="line"><span class="number">8</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">7</span></span><br><span class="line"><span class="number">5</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>kv算子 ： groupbykey &#x3D;》 就是对key进行分组，和wordcount里的分组是一样的&#x3D;》工作中不要使用，效率低，不灵活</p>
<p>预聚合：</p>
<ul>
<li>mr ： input &#x3D; &gt; map &#x3D;&gt; combine(调优的过程) &#x3D;&gt; reduce &#x3D;&gt; output</li>
<li>combine &#x3D;&gt; 预聚合 按照map的输出的key进行数据聚合</li>
</ul>
<p>mapSideCombine &#x3D; false 代表预聚合关闭</p>
<p>一般groupbykey是关闭预聚合的，reducebykey是开启的</p>
<figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">scala&gt; test<span class="number">1.</span>collect</span><br><span class="line">res<span class="number">25</span>: Array[<span class="comment">(Int, Int)</span>] = Array<span class="comment">((0,1)</span>, <span class="comment">(0,2)</span>, <span class="comment">(0,3)</span>, <span class="comment">(0,4)</span>, <span class="comment">(0,5)</span>, <span class="comment">(0,6)</span>, <span class="comment">(0,7)</span>, <span class="comment">(0,8)</span>, <span class="comment">(0,9)</span>, <span class="comment">(0,10)</span>, <span class="comment">(0,11)</span>, <span class="comment">(0,12)</span>, <span class="comment">(0,13)</span>, <span class="comment">(0,14)</span>, <span class="comment">(0,15)</span>, <span class="comment">(0,16)</span>, <span class="comment">(0,17)</span>, <span class="comment">(0,18)</span>, <span class="comment">(0,19)</span>, <span class="comment">(0,20)</span>, <span class="comment">(0,21)</span>, <span class="comment">(0,22)</span>, <span class="comment">(0,23)</span>, <span class="comment">(0,24)</span>, <span class="comment">(0,25)</span>, <span class="comment">(0,26)</span>, <span class="comment">(0,27)</span>, <span class="comment">(0,28)</span>, <span class="comment">(0,29)</span>, <span class="comment">(0,30)</span>, <span class="comment">(0,31)</span>, <span class="comment">(0,32)</span>, <span class="comment">(0,33)</span>, <span class="comment">(0,34)</span>, <span class="comment">(0,35)</span>, <span class="comment">(0,36)</span>, <span class="comment">(0,37)</span>, <span class="comment">(0,38)</span>, <span class="comment">(0,39)</span>, <span class="comment">(0,40)</span>, <span class="comment">(0,41)</span>, <span class="comment">(0,42)</span>, <span class="comment">(0,43)</span>, <span class="comment">(0,44)</span>, <span class="comment">(0,45)</span>, <span class="comment">(0,46)</span>, <span class="comment">(0,47)</span>, <span class="comment">(0,48)</span>, <span class="comment">(0,49)</span>, <span class="comment">(0,50)</span>, <span class="comment">(0,51)</span>, <span class="comment">(0,52)</span>, <span class="comment">(0,53)</span>, <span class="comment">(0,54)</span>, <span class="comment">(0,55)</span>, <span class="comment">(0,56)</span>, <span class="comment">(0,57)</span>, <span class="comment">(0,58)</span>, <span class="comment">(0,59)</span>, <span class="comment">(0,60)</span>, <span class="comment">(0,61)</span>, <span class="comment">(0,62)</span>, <span class="comment">(0,63)</span>, <span class="comment">(0,64)</span>, <span class="comment">(0,65)</span>, <span class="comment">(0,66)</span>, <span class="comment">(0,67)</span>, <span class="comment">(0,68)</span>, <span class="comment">(0,69)</span>, <span class="comment">(0,70)</span>, <span class="comment">(0,71)</span>, <span class="comment">(0,72)</span>, <span class="comment">(0,73)</span>, <span class="comment">(0,74)</span>, <span class="comment">(0,75)</span>, <span class="comment">(0,76)</span>, <span class="comment">(0,77)</span>, <span class="comment">(0,78)</span>, <span class="comment">(0,79)</span>, <span class="comment">(0,80)</span>, <span class="comment">(0,81)</span>, <span class="comment">(0,82)</span>, <span class="comment">(0,83)</span>, <span class="comment">(0,84)</span>, <span class="comment">(0,85)</span>, <span class="comment">(0,86)</span>, <span class="comment">(0,87)</span>, <span class="comment">(0,88)</span>, <span class="comment">(0,89)</span>, <span class="comment">(0,90)</span>, <span class="comment">(0,91)</span>, <span class="comment">(0,92)</span>, <span class="comment">(0,93)</span>, <span class="comment">(0,...</span></span><br><span class="line"><span class="comment">scala&gt; test1.groupByKey.collect.foreach(print)</span></span><br><span class="line"><span class="comment">(0,CompactBuffer(1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123, 124, 125, 126, 127, 128, 129, 130, 131, 132, 133, 134, 135, 136, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147, 148, 149, 150, 151, 152, 153, 154, 155, 156, 157, 158, 159, 160, 161, 162, 163, 164, 165, 166, 167, 168, 169, 170, 171, 172, 173, 174, 175, 176, 177, 178, 179, 180, 181, 182, 183, 184, 185, 186, 187, 188, 189, 190, 191, 192, 193, 194, 195, 196, 197, 198, 199, 200, 201, 202, 203, 204, 205, 206, 207, 208, 209, 210, 211, 212, 213, 214, 215, 216, 217, 218, 219, 220, 221, 222, 223, 224, 225, 226, 227, 228, 229, 230, 231, 232, 233, 234, 235, 236, 237, 238, 239, 240, 241, 242, 243, 244, 245, 246, 247, 248, 249, 250, 251, 252, 253, 254, 255, 256, 257, 258, 259, 260, 261, 262, 263, 264, 265, 266, 267, 268, 269, 270, 271, 272, 273, 274, 275, 276, 277, 278, 279, 280, 281, 282, 283, 284, 285, 286, 287, 288, 289, 290, 291, 292, 293, 294, 295, 296, 297, 298, 299, 300, 301, 302, 303, 304, 305, 306, 307, 308, 309, 310, 311, 312, 313, 314, 315, 316, 317, 318, 319, 320, 321, 322, 323, 324, 325, 326, 327, 328, 329, 330, 331, 332, 333, 334, 335, 336, 337, 338, 339, 340, 341, 342, 343, 344, 345, 346, 347, 348, 349, 350, 351, 352, 353, 354, 355, 356, 357, 358, 359, 360, 361, 362, 363, 364, 365, 366, 367, 368, 369, 370, 371, 372, 373, 374, 375, 376, 377, 378, 379, 380, 381, 382, 383, 384, 385, 386, 387, 388, 389, 390, 391, 392, 393, 394, 395, 396, 397, 398, 399, 400, 401, 402, 403, 404, 405, 406, 407, 408, 409, 410, 411, 412, 413, 414, 415, 416, 417, 418, 419, 420, 421, 422, 423, 424, 425, 426, 427, 428, 429, 430, 431, 432, 433, 434, 435, 436, 437, 438, 439, 440, 441, 442, 443, 444, 445, 446, 447, 448, 449, 450, 451, 452, 453, 454, 455, 456, 457, 458, 459, 460, 461, 462, 463, 464, 465, 466, 467, 468, 469, 470, 471, 472, 473, 474, 475, 476, 477, 478, 479, 480, 481, 482, 483, 484, 485, 486, 487, 488, 489, 490, 491, 492, 493, 494, 495, 496, 497, 498, 499, 500)</span>)<span class="comment">(1,CompactBuffer(501, 502, 503, 504, 505, 506, 507, 508, 509, 510, 511, 512, 513, 514, 515, 516, 517, 518, 519, 520, 521, 522, 523, 524, 525, 526, 527, 528, 529, 530, 531, 532, 533, 534, 535, 536, 537, 538, 539, 540, 541, 542, 543, 544, 545, 546, 547, 548, 549, 550, 551, 552, 553, 554, 555, 556, 557, 558, 559, 560, 561, 562, 563, 564, 565, 566, 567, 568, 569, 570, 571, 572, 573, 574, 575, 576, 577, 578, 579, 580, 581, 582, 583, 584, 585, 586, 587, 588, 589, 590, 591, 592, 593, 594, 595, 596, 597, 598, 599, 600, 601, 602, 603, 604, 605, 606, 607, 608, 609, 610, 611, 612, 613, 614, 615, 616, 617, 618, 619, 620, 621, 622, 623, 624, 625, 626, 627, 628, 629, 630, 631, 632, 633, 634, 635, 636, 637, 638, 639, 640, 641, 642, 643, 644, 645, 646, 647, 648, 649, 650, 651, 652, 653, 654, 655, 656, 657, 658, 659, 660, 661, 662, 663, 664, 665, 666, 667, 668, 669, 670, 671, 672, 673, 674, 675, 676, 677, 678, 679, 680, 681, 682, 683, 684, 685, 686, 687, 688, 689, 690, 691, 692, 693, 694, 695, 696, 697, 698, 699, 700, 701, 702, 703, 704, 705, 706, 707, 708, 709, 710, 711, 712, 713, 714, 715, 716, 717, 718, 719, 720, 721, 722, 723, 724, 725, 726, 727, 728, 729, 730, 731, 732, 733, 734, 735, 736, 737, 738, 739, 740, 741, 742, 743, 744, 745, 746, 747, 748, 749, 750, 751, 752, 753, 754, 755, 756, 757, 758, 759, 760, 761, 762, 763, 764, 765, 766, 767, 768, 769, 770, 771, 772, 773, 774, 775, 776, 777, 778, 779, 780, 781, 782, 783, 784, 785, 786, 787, 788, 789, 790, 791, 792, 793, 794, 795, 796, 797, 798, 799, 800, 801, 802, 803, 804, 805, 806, 807, 808, 809, 810, 811, 812, 813, 814, 815, 816, 817, 818, 819, 820, 821, 822, 823, 824, 825, 826, 827, 828, 829, 830, 831, 832, 833, 834, 835, 836, 837, 838, 839, 840, 841, 842, 843, 844, 845, 846, 847, 848, 849, 850, 851, 852, 853, 854, 855, 856, 857, 858, 859, 860, 861, 862, 863, 864, 865, 866, 867, 868, 869, 870, 871, 872, 873, 874, 875, 876, 877, 878, 879, 880, 881, 882, 883, 884, 885, 886, 887, 888, 889, 890, 891, 892, 893, 894, 895, 896, 897, 898, 899, 900, 901, 902, 903, 904, 905, 906, 907, 908, 909, 910, 911, 912, 913, 914, 915, 916, 917, 918, 919, 920, 921, 922, 923, 924, 925, 926, 927, 928, 929, 930, 931, 932, 933, 934, 935, 936, 937, 938, 939, 940, 941, 942, 943, 944, 945, 946, 947, 948, 949, 950, 951, 952, 953, 954, 955, 956, 957, 958, 959, 960, 961, 962, 963, 964, 965, 966, 967, 968, 969, 970, 971, 972, 973, 974, 975, 976, 977, 978, 979, 980, 981, 982, 983, 984, 985, 986, 987, 988, 989, 990, 991, 992, 993, 994, 995, 996, 997, 998, 999, 1000)</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>reducebykey：对比groupby是相当于可以统计之后进行计算的</p>
<figure class="highlight moonscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">scala&gt; test1.reduceByKey(<span class="function"><span class="params">(x,y)</span>=&gt;</span>&#123;x+y&#125;).collect.foreach(<span class="built_in">print</span>)</span><br><span class="line">(<span class="number">0</span>,<span class="number">125250</span>)(<span class="number">1</span>,<span class="number">375250</span>)</span><br><span class="line"><span class="comment">--------------------------------------其中的x+y代表拉完成之后，对他们进行相加</span></span><br><span class="line"><span class="comment">--------------------------------------通过reduceByKey实现distinct</span></span><br><span class="line">scala&gt; test1.reduceByKey(<span class="function"><span class="params">(x,_)</span>=&gt;</span>&#123;x&#125;).map(_._1).collect.foreach(println)</span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>groupby：自定义分组</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">scala</span>&gt; test.groupBy(x=&gt;&#123;if(x%<span class="number">2</span>==<span class="number">0</span>)&#123;<span class="string">&quot;2e&quot;</span>&#125;else&#123;<span class="string">&quot;e2&quot;</span>&#125;&#125;).collect</span><br><span class="line"><span class="attribute">res99</span>: Array[(String, Iterable[Int])] = Array((e2,CompactBuffer(<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">11</span>, <span class="number">13</span>, <span class="number">15</span>, <span class="number">17</span>, <span class="number">19</span>, <span class="number">21</span>, <span class="number">23</span>, <span class="number">25</span>, <span class="number">27</span>, <span class="number">29</span>, <span class="number">31</span>, <span class="number">33</span>, <span class="number">35</span>, <span class="number">37</span>, <span class="number">39</span>, <span class="number">41</span>, <span class="number">43</span>, <span class="number">45</span>, <span class="number">47</span>, <span class="number">49</span>, <span class="number">51</span>, <span class="number">53</span>, <span class="number">55</span>, <span class="number">57</span>, <span class="number">59</span>, <span class="number">61</span>, <span class="number">63</span>, <span class="number">65</span>, <span class="number">67</span>, <span class="number">69</span>, <span class="number">71</span>, <span class="number">73</span>, <span class="number">75</span>, <span class="number">77</span>, <span class="number">79</span>, <span class="number">81</span>, <span class="number">83</span>, <span class="number">85</span>, <span class="number">87</span>, <span class="number">89</span>, <span class="number">91</span>, <span class="number">93</span>, <span class="number">95</span>, <span class="number">97</span>, <span class="number">99</span>, <span class="number">101</span>, <span class="number">103</span>, <span class="number">105</span>, <span class="number">107</span>, <span class="number">109</span>, <span class="number">111</span>, <span class="number">113</span>, <span class="number">115</span>, <span class="number">117</span>, <span class="number">119</span>, <span class="number">121</span>, <span class="number">123</span>, <span class="number">125</span>, <span class="number">127</span>, <span class="number">129</span>, <span class="number">131</span>, <span class="number">133</span>, <span class="number">135</span>, <span class="number">137</span>, <span class="number">139</span>, <span class="number">141</span>, <span class="number">143</span>, <span class="number">145</span>, <span class="number">147</span>, <span class="number">149</span>, <span class="number">151</span>, <span class="number">153</span>, <span class="number">155</span>, <span class="number">157</span>, <span class="number">159</span>, <span class="number">161</span>, <span class="number">163</span>, <span class="number">165</span>, <span class="number">167</span>, <span class="number">169</span>, <span class="number">171</span>, <span class="number">173</span>, <span class="number">175</span>, <span class="number">177</span>, <span class="number">179</span>, <span class="number">181</span>, <span class="number">183</span>, <span class="number">185</span>, <span class="number">187</span>, <span class="number">189</span>, <span class="number">191</span>, <span class="number">193</span>, <span class="number">195</span>, <span class="number">197</span>, <span class="number">199</span>, <span class="number">201</span>, <span class="number">203</span>, <span class="number">205</span>, <span class="number">207</span>, <span class="number">209</span>, <span class="number">211</span>, <span class="number">213</span>, <span class="number">215</span>, <span class="number">217</span>, <span class="number">219</span>, <span class="number">221</span>, <span class="number">223</span>, <span class="number">225</span>, <span class="number">227</span>, <span class="number">229</span>, <span class="number">231</span>, <span class="number">233</span>, <span class="number">235</span>, <span class="number">237</span>, <span class="number">239</span>, <span class="number">241</span>, <span class="number">243</span>, <span class="number">245</span>, <span class="number">247</span>, <span class="number">249</span>, <span class="number">251</span>, <span class="number">253</span>, <span class="number">255</span>, <span class="number">257</span>, <span class="number">259</span>, <span class="number">261</span>, <span class="number">263</span>, <span class="number">265</span>, <span class="number">267</span>, <span class="number">269</span>, <span class="number">271</span>, <span class="number">273</span>, <span class="number">275</span>, <span class="number">277</span>, <span class="number">279</span>, <span class="number">281</span>, <span class="number">283</span>, <span class="number">285</span>, <span class="number">287</span>, <span class="number">289</span>, <span class="number">291</span>, <span class="number">293</span>, <span class="number">295</span>, <span class="number">297</span>, <span class="number">299</span>, <span class="number">301</span>, <span class="number">303</span>, <span class="number">30</span>...</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>sortbykey：按照key进行排序，分区排序，如果想达到全局排序，则要求你rdd里的只有一个的分区，降序就是把true变成false</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">scala&gt; val r2 = sc<span class="selector-class">.parallelize</span>(<span class="built_in">List</span>((<span class="string">&quot;zuan&quot;</span>,<span class="number">18</span>),(<span class="string">&quot;kaige&quot;</span>,<span class="number">20</span>),(<span class="string">&quot;zihang&quot;</span>,<span class="number">21</span>)),<span class="number">1</span>)</span><br><span class="line">r2: org<span class="selector-class">.apache</span><span class="selector-class">.spark</span><span class="selector-class">.rdd</span><span class="selector-class">.RDD</span><span class="selector-attr">[(String, Int)]</span> = ParallelCollectionRDD<span class="selector-attr">[69]</span> at parallelize at &lt;console&gt;:<span class="number">24</span></span><br><span class="line"></span><br><span class="line">scala&gt; r2<span class="selector-class">.sortByKey</span>(true)</span><br><span class="line">res89: org<span class="selector-class">.apache</span><span class="selector-class">.spark</span><span class="selector-class">.rdd</span><span class="selector-class">.RDD</span><span class="selector-attr">[(String, Int)]</span> = ShuffledRDD<span class="selector-attr">[70]</span> at sortByKey at &lt;console&gt;:<span class="number">25</span></span><br><span class="line"></span><br><span class="line">scala&gt; res89<span class="selector-class">.collect</span></span><br><span class="line">res90: Array<span class="selector-attr">[(String, Int)]</span> = <span class="built_in">Array</span>((kaige,<span class="number">20</span>), (zihang,<span class="number">21</span>), (zuan,<span class="number">18</span>))</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>自定义排序：sortby</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">scala&gt; r2.sort<span class="constructor">By(<span class="params">x</span>=&gt;<span class="params">x</span>.<span class="params">_2</span>,<span class="params">true</span>)</span>.collect</span><br><span class="line">res92: Array<span class="literal">[(S<span class="identifier">tring</span>, I<span class="identifier">nt</span>)]</span> = <span class="constructor">Array((<span class="params">zuan</span>,18)</span>, (kaige,<span class="number">20</span>), (zihang,<span class="number">21</span>))</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>join：他默认就是按照key进行关联的&#x3D;》底层调用的是cogroup</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">scala&gt; val r3 = sc<span class="selector-class">.parallelize</span>(<span class="built_in">List</span>((<span class="string">&quot;zuan&quot;</span>,<span class="string">&quot;广西&quot;</span>),(<span class="string">&quot;kaige&quot;</span>,<span class="string">&quot;中国&quot;</span>),(<span class="string">&quot;zihang&quot;</span>,<span class="string">&quot;黑龙江&quot;</span>)))</span><br><span class="line">r3: org<span class="selector-class">.apache</span><span class="selector-class">.spark</span><span class="selector-class">.rdd</span><span class="selector-class">.RDD</span><span class="selector-attr">[(String, String)]</span> = ParallelCollectionRDD<span class="selector-attr">[77]</span> at parallelize at &lt;console&gt;:<span class="number">24</span></span><br><span class="line"></span><br><span class="line">scala&gt; r1<span class="selector-class">.join</span>(r3)<span class="selector-class">.collect</span></span><br><span class="line">res93: Array<span class="selector-attr">[(String, (Int, String))]</span> = <span class="built_in">Array</span>((zuan,(<span class="number">18</span>,广西)), (kaige,(<span class="number">20</span>,中国)), (zihang,(<span class="number">21</span>,黑龙江)))</span><br><span class="line"></span><br><span class="line">-----------------------<span class="attr">--cogroup</span></span><br><span class="line">scala&gt; r1<span class="selector-class">.cogroup</span>(r3)<span class="selector-class">.collect</span></span><br><span class="line">res94: Array<span class="selector-attr">[(String, (Iterable[Int]</span>, Iterable<span class="selector-attr">[String]</span>))] = <span class="built_in">Array</span>((zuan,(<span class="built_in">CompactBuffer</span>(<span class="number">18</span>),<span class="built_in">CompactBuffer</span>(广西))), (kaige,(<span class="built_in">CompactBuffer</span>(<span class="number">20</span>),<span class="built_in">CompactBuffer</span>(中国))), (zihang,(<span class="built_in">CompactBuffer</span>(<span class="number">21</span>),<span class="built_in">CompactBuffer</span>(黑龙江))))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>都是根据key进行关联</p>
<p>但是cogroup的返回是集合当作value的</p>
<p>join则是返回的是值当value</p>
<p>分区规则：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">分区号：0，元素是4 4%<span class="attribute">4</span>=0</span><br><span class="line">分区号：1，元素是9 9%<span class="attribute">4</span>=1</span><br></pre></td></tr></table></figure>

<p>action算子：会执行job的算子</p>
<p>collect&#x3D;》把rdd的数据集拉回控制台 &#x3D; 》driver端</p>
<p>foreach</p>
<p>foreachpartition：对每个分区进行处理&#x3D;》首选的mysql数据集导入是它，因为获取mysql的次数能少一点</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">  def foreach<span class="constructor">Partition(<span class="params">f</span>: Iterator[T] =&gt; Unit)</span>: Unit = withScope &#123;</span><br><span class="line">    <span class="keyword">val</span> cleanF = sc.clean(f)</span><br><span class="line">    sc.run<span class="constructor">Job(<span class="params">this</span>, (<span class="params">iter</span>: Iterator[T])</span> =&gt; clean<span class="constructor">F(<span class="params">iter</span>)</span>)</span><br><span class="line">  &#125;</span><br><span class="line">-----------------------------------使用</span><br><span class="line">scala&gt; test.foreach<span class="constructor">Partition(<span class="params">ax</span>=&gt;<span class="params">ax</span>.<span class="params">foreach</span>(<span class="params">print</span>)</span>)</span><br><span class="line"><span class="number">1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798991001011021031041051061071081091101111121131141151161171181191201211221231241251261271281291301311321331341351361371381391401411421431441451461471481491501511521531541551561571581591601611621631641651661671681691701711721731741751761771781791801811821831841851861871881891901911921931941951961971981992002012022032042052062072082092102112122132142152162172182192202212222232242252262272282292302312322332342352362372382392402412422432442452462472482492502512522532542552562572582592602612622632642652662672682692702712722732742752762772782792802812822832842852862872882892902912922932942952962972982993003013023033043053063073083093103113123133143153163173183193203213223233243253263273283293303313323333343353363373383393403413423433443453463473483493503513523533543553563573583593603613623633643653663673683693703713723733743753763773783793803813823833843853863873883893903913923933943953963973983994004014024034044054064074084094104114124134144154164174184194204214224234244254264274284294304314324334344354364374384394404414424434444454464474484494504514524534544554564574584594604614624634644654664674684694704714724734744754764774784794804814824834844854864874884894904914924934944954964974984995005015025035045055065075085095105115125135145155165175185195205215225235245255265275285295305315325335345355365375385395405415425435445455465475485495505515525535545555565575585595605615625635645655665675685695705715725735745755765775785795805815825835845855865875885895905915925935945955965975985996006016026036046056066076086096106116126136146156166176186196206216226236246256266276286296306316326336346356366376386396406416426436446456466476486496506516526536546556566576586596606616626636646656666676686696706716726736746756766776786796806816826836846856866876886896906916926936946956966976986997007017027037047057067077087097107117127137147157167177187197207217227237247257267277287297307317327337347357367377387397407417427437447457467477487497507517527537547557567577587597607617627637647657667677687697707717727737747757767777787797807817827837847857867877887897907917927937947957967977987998008018028038048058068078088098108118128138148158168178188198208218228238248258268278288298308318328338348358368378388398408418428438448458468478488498508518528538548558568578588598608618628638648658668678688698708718728738748758768778788798808818828838848858868878888898908918928938948958968978988999009019029039049059069079089099109119129139149159169179189199209219229239249259269279289299309319329339349359369379389399409419429439449459469479489499509519529539549559569579589599609619629639649659669679689699709719729739749759769779789799809819829839849859869879889899909919929939949959969979989991000</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>reduce：mr里的reduce，这里不可以接collect，因为已经完成了</p>
<figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">scala&gt; test.<span class="built_in">reduce</span>(<span class="function">(<span class="params">x,y</span>)=&gt;</span>x+y)</span><br><span class="line">res108: Int = <span class="number">500500</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>first：取出数据集里的第一个元素底层是take</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">scala<span class="operator">&gt;</span> test.first()</span><br><span class="line">res109: <span class="type">Int</span> <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"><span class="comment">-------------------------take</span></span><br><span class="line">scala<span class="operator">&gt;</span> test.take(<span class="number">77</span>)</span><br><span class="line">res112: <span class="keyword">Array</span>[<span class="type">Int</span>] <span class="operator">=</span> <span class="keyword">Array</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">17</span>, <span class="number">18</span>, <span class="number">19</span>, <span class="number">20</span>, <span class="number">21</span>, <span class="number">22</span>, <span class="number">23</span>, <span class="number">24</span>, <span class="number">25</span>, <span class="number">26</span>, <span class="number">27</span>, <span class="number">28</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">31</span>, <span class="number">32</span>, <span class="number">33</span>, <span class="number">34</span>, <span class="number">35</span>, <span class="number">36</span>, <span class="number">37</span>, <span class="number">38</span>, <span class="number">39</span>, <span class="number">40</span>, <span class="number">41</span>, <span class="number">42</span>, <span class="number">43</span>, <span class="number">44</span>, <span class="number">45</span>, <span class="number">46</span>, <span class="number">47</span>, <span class="number">48</span>, <span class="number">49</span>, <span class="number">50</span>, <span class="number">51</span>, <span class="number">52</span>, <span class="number">53</span>, <span class="number">54</span>, <span class="number">55</span>, <span class="number">56</span>, <span class="number">57</span>, <span class="number">58</span>, <span class="number">59</span>, <span class="number">60</span>, <span class="number">61</span>, <span class="number">62</span>, <span class="number">63</span>, <span class="number">64</span>, <span class="number">65</span>, <span class="number">66</span>, <span class="number">67</span>, <span class="number">68</span>, <span class="number">69</span>, <span class="number">70</span>, <span class="number">71</span>, <span class="number">72</span>, <span class="number">73</span>, <span class="number">74</span>, <span class="number">75</span>, <span class="number">76</span>, <span class="number">77</span>)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>takeOrderd:升序获取前n个</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">scala</span>&gt; test.takeOrdered(<span class="number">2</span>)</span><br><span class="line"><span class="attribute">res127</span>: Array[Int] = Array(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="attribute">scala</span>&gt; test.takeOrdered(<span class="number">55</span>)</span><br><span class="line"><span class="attribute">res128</span>: Array[Int] = Array(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">17</span>, <span class="number">18</span>, <span class="number">19</span>, <span class="number">20</span>, <span class="number">21</span>, <span class="number">22</span>, <span class="number">23</span>, <span class="number">24</span>, <span class="number">25</span>, <span class="number">26</span>, <span class="number">27</span>, <span class="number">28</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">31</span>, <span class="number">32</span>, <span class="number">33</span>, <span class="number">34</span>, <span class="number">35</span>, <span class="number">36</span>, <span class="number">37</span>, <span class="number">38</span>, <span class="number">39</span>, <span class="number">40</span>, <span class="number">41</span>, <span class="number">42</span>, <span class="number">43</span>, <span class="number">44</span>, <span class="number">45</span>, <span class="number">46</span>, <span class="number">47</span>, <span class="number">48</span>, <span class="number">49</span>, <span class="number">50</span>, <span class="number">51</span>, <span class="number">52</span>, <span class="number">53</span>, <span class="number">54</span>, <span class="number">55</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>top:就是取排名前几的数据底层是takeOrederd&#x3D;》数据量比较小的时候可以使用</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">scala</span>&gt; test.top(<span class="number">1</span>)</span><br><span class="line"><span class="attribute">res113</span>: Array[Int] = Array(<span class="number">1000</span>)</span><br><span class="line"></span><br><span class="line"><span class="attribute">scala</span>&gt; test.top(<span class="number">5</span>)</span><br><span class="line"><span class="attribute">res114</span>: Array[Int] = Array(<span class="number">1000</span>, <span class="number">999</span>, <span class="number">998</span>, <span class="number">997</span>, <span class="number">996</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>saveASTextFile</p>
<p>saveASSequenceFile</p>
<p>saveAsObjectFile</p>
<p>countByKey:统计key的个数</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">scala&gt; test1<span class="selector-class">.countByKey</span></span><br><span class="line">res125: scala<span class="selector-class">.collection</span><span class="selector-class">.Map</span><span class="selector-attr">[Int,Long]</span> = <span class="built_in">Map</span>(<span class="number">0</span> -&gt; <span class="number">500</span>, <span class="number">1</span> -&gt; <span class="number">500</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>collectAsMap：和countByKey有点类似</p>
<p>count:返回rdd里有多少个数</p>
<p>判断action算子和普通算子的方法&#x3D;》源码底层有runjob</p>
<p>&#x3D;》调用collect&#x2F;其他action算子</p>
<h3 id="案例："><a href="#案例：" class="headerlink" title="案例："></a>案例：</h3><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">一张表：</span><br><span class="line">name price num</span><br><span class="line">diar<span class="number"> 300 </span>1000</span><br><span class="line">香奈儿<span class="number"> 4000 </span>2</span><br><span class="line">螺蛳粉<span class="number"> 200 </span>98</span><br><span class="line">30显卡<span class="number"> 200 </span>10</span><br><span class="line">-----------------------------------------------按照价格进行排序【desc】，如果价格相同，按照库存排序【asc】</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>解决：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">数据类型：tuple【推荐】 ， <span class="class"><span class="keyword">class</span> <span class="title">，</span> <span class="title">case</span> <span class="title">class【推荐】</span></span></span><br><span class="line">用tuple做</span><br><span class="line">-----------------------------------------------------------------</span><br><span class="line">    <span class="keyword">val</span> value = sc.parallelize(<span class="type">List</span>(<span class="string">&quot;diar 300 1000&quot;</span>,</span><br><span class="line">      <span class="string">&quot;香奈儿 4000 2&quot;</span>,</span><br><span class="line">      <span class="string">&quot;螺蛳粉 200 98&quot;</span>,</span><br><span class="line">      <span class="string">&quot;30显卡 200 10&quot;</span>)，<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> etlData = value.map(x=&gt;&#123;</span><br><span class="line">      <span class="keyword">val</span> strings=x.split(<span class="string">&quot; &quot;</span>)</span><br><span class="line">      <span class="keyword">val</span> name=strings(<span class="number">0</span>)</span><br><span class="line">      <span class="keyword">val</span> price=strings(<span class="number">1</span>).toInt</span><br><span class="line">      <span class="keyword">val</span> store=strings(<span class="number">2</span>)</span><br><span class="line">      (name,price,store)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    etlData.sortBy(x =&gt; ( -x._2 , x._3)).saveAsTextFile(<span class="string">&quot;hdfs://bigdata3:9000/data&quot;</span>)</span><br><span class="line">----------------------------------------------------------<span class="class"><span class="keyword">class</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.&#123;<span class="type">SparkConf</span>, <span class="type">SparkContext</span>&#125;</span><br><span class="line"><span class="keyword">import</span> sparkfirst.<span class="type">ContextUtils</span></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">sparktest</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">val</span> sc:<span class="type">SparkContext</span> = <span class="type">ContextUtils</span>.getSparkContext(<span class="string">&quot;test&quot;</span>)</span><br><span class="line">    <span class="keyword">val</span> bb = <span class="keyword">new</span> <span class="type">SparkContext</span>(<span class="keyword">new</span> <span class="type">SparkConf</span>().setAppName(<span class="string">&quot;test&quot;</span>).setMaster(<span class="string">&quot;local[2]&quot;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> value = sc.parallelize(<span class="type">List</span>(<span class="string">&quot;diar 300 1000&quot;</span>,</span><br><span class="line">      <span class="string">&quot;香奈儿 4000 2&quot;</span>,</span><br><span class="line">      <span class="string">&quot;螺蛳粉 200 98&quot;</span>,</span><br><span class="line">      <span class="string">&quot;30显卡 200 10&quot;</span>)，<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> etlData = value.map(x=&gt;&#123;</span><br><span class="line">      <span class="keyword">val</span> strings=x.split(<span class="string">&quot; &quot;</span>)</span><br><span class="line">      <span class="keyword">val</span> name=strings(<span class="number">0</span>)</span><br><span class="line">      <span class="keyword">val</span> price=strings(<span class="number">1</span>).toDouble</span><br><span class="line">      <span class="keyword">val</span> store=strings(<span class="number">2</span>).toInt</span><br><span class="line">      <span class="keyword">new</span> skuu(name,price,store)</span><br><span class="line">    &#125;)</span><br><span class="line">    etlData.sortBy(x=&gt;(-x.d,x.str1)).collect.foreach(print(_))</span><br><span class="line"></span><br><span class="line">    sc.stop()</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">skuu</span>(<span class="params">val str: <span class="type">String</span>,val d: <span class="type">Double</span>,val str1: <span class="type">Int</span></span>) <span class="keyword">extends</span> <span class="title">Serializable</span></span>&#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">toString</span></span>: <span class="type">String</span> =str + <span class="string">&quot;\t&quot;</span> + d + <span class="string">&quot;\t&quot;</span> + str1</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">------------------------------------------------------------------------------------------------------<span class="keyword">case</span> <span class="class"><span class="keyword">class</span></span></span><br><span class="line"><span class="keyword">case</span>好处=》重写了toString，hashcode方法，自动实现了序列化，不用实例化</span><br><span class="line"><span class="keyword">package</span> sparkfirst</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.&#123;<span class="type">SparkConf</span>, <span class="type">SparkContext</span>&#125;</span><br><span class="line"><span class="keyword">import</span> sparkfirst.<span class="type">ContextUtils</span></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">sparktest</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">val</span> sc:<span class="type">SparkContext</span> = <span class="type">ContextUtils</span>.getSparkContext(<span class="string">&quot;test&quot;</span>)</span><br><span class="line">    <span class="keyword">val</span> bb = <span class="keyword">new</span> <span class="type">SparkContext</span>(<span class="keyword">new</span> <span class="type">SparkConf</span>().setAppName(<span class="string">&quot;test&quot;</span>).setMaster(<span class="string">&quot;local[2]&quot;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> value = sc.parallelize(<span class="type">List</span>(<span class="string">&quot;diar 300 1000&quot;</span>,</span><br><span class="line">      <span class="string">&quot;香奈儿 4000 2&quot;</span>,</span><br><span class="line">      <span class="string">&quot;螺蛳粉 200 98&quot;</span>,</span><br><span class="line">      <span class="string">&quot;30显卡 200 10&quot;</span>)，<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> etlData = value.map(x=&gt;&#123;</span><br><span class="line">      <span class="keyword">val</span> strings=x.split(<span class="string">&quot; &quot;</span>)</span><br><span class="line">      <span class="keyword">val</span> name=strings(<span class="number">0</span>)</span><br><span class="line">      <span class="keyword">val</span> price=strings(<span class="number">1</span>).toDouble</span><br><span class="line">      <span class="keyword">val</span> store=strings(<span class="number">2</span>).toInt</span><br><span class="line">      skuu(name,price,store)</span><br><span class="line">    &#125;)</span><br><span class="line">    etlData.sortBy(x=&gt;(-x.d,x.str1)).collect.foreach(print(_))</span><br><span class="line"></span><br><span class="line">    sc.stop()</span><br><span class="line">  &#125;</span><br><span class="line"> <span class="keyword">case</span> <span class="class"><span class="keyword">class</span> <span class="title">skuu</span>(<span class="params">val str: <span class="type">String</span>,val d: <span class="type">Double</span>,val str1: <span class="type">Int</span></span>)</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>当用 <code>saveAsTextFile(&quot;hdfs://bigdata3:9000/data/test&quot;)</code></p>
<p>的时候它会根据你的分区数来生成文件</p>
<h3 id="需求：用两类进行-对比："><a href="#需求：用两类进行-对比：" class="headerlink" title="需求：用两类进行 对比："></a>需求：用两类进行 对比：</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> sparkfirst</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.&#123;<span class="type">SparkConf</span>, <span class="type">SparkContext</span>&#125;</span><br><span class="line"><span class="keyword">import</span> sparkfirst.<span class="type">ContextUtils</span></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">sparktest</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">val</span> sc:<span class="type">SparkContext</span> = <span class="type">ContextUtils</span>.getSparkContext(<span class="string">&quot;test&quot;</span>)</span><br><span class="line">    <span class="keyword">val</span> bb = <span class="keyword">new</span> <span class="type">SparkContext</span>(<span class="keyword">new</span> <span class="type">SparkConf</span>().setAppName(<span class="string">&quot;test&quot;</span>).setMaster(<span class="string">&quot;local[2]&quot;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> value = sc.parallelize(<span class="type">List</span>(</span><br><span class="line">      <span class="string">&quot;diar 300 1000&quot;</span>,</span><br><span class="line">      <span class="string">&quot;香奈儿 4000 2&quot;</span>,</span><br><span class="line">      <span class="string">&quot;螺蛳粉 200 98&quot;</span>,</span><br><span class="line">      <span class="string">&quot;30显卡 200 10&quot;</span>),<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> etlData = value.map(x=&gt;&#123;</span><br><span class="line">      <span class="keyword">val</span> strings=x.split(<span class="string">&quot; &quot;</span>)</span><br><span class="line">      <span class="keyword">val</span> name=strings(<span class="number">0</span>)</span><br><span class="line">      <span class="keyword">val</span> price=strings(<span class="number">1</span>).toDouble</span><br><span class="line">      <span class="keyword">val</span> store=strings(<span class="number">2</span>).toInt</span><br><span class="line">      skuu(name,price,store)</span><br><span class="line">    &#125;)</span><br><span class="line">    etlData.sortBy(x=&gt;(-x.d,x.str1)).collect.foreach(print(_))</span><br><span class="line"></span><br><span class="line">    sc.stop()</span><br><span class="line">  &#125;</span><br><span class="line"> <span class="keyword">case</span> <span class="class"><span class="keyword">class</span> <span class="title">skuu</span>(<span class="params">val str: <span class="type">String</span>,val d: <span class="type">Double</span>,val str1: <span class="type">Int</span></span>) <span class="keyword">extends</span> <span class="title">Ordered</span>[skuu]</span>&#123;</span><br><span class="line">   <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">compare</span></span>(that: skuu): <span class="type">Int</span> = &#123;</span><br><span class="line">     <span class="keyword">if</span> (<span class="keyword">this</span>.d == that.d)&#123;</span><br><span class="line">       <span class="keyword">this</span>.str1-that.str1</span><br><span class="line">     &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">       -(<span class="keyword">this</span>.d - that.d).toInt</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>隐式转换</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> sparkfirst</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.&#123;<span class="type">SparkConf</span>, <span class="type">SparkContext</span>&#125;</span><br><span class="line"><span class="keyword">import</span> sparkfirst.<span class="type">ContextUtils</span></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">sparktest</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">val</span> sc:<span class="type">SparkContext</span> = <span class="type">ContextUtils</span>.getSparkContext(<span class="string">&quot;test&quot;</span>)</span><br><span class="line">    <span class="keyword">val</span> bb = <span class="keyword">new</span> <span class="type">SparkContext</span>(<span class="keyword">new</span> <span class="type">SparkConf</span>().setAppName(<span class="string">&quot;test&quot;</span>).setMaster(<span class="string">&quot;local[2]&quot;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> value = sc.parallelize(<span class="type">List</span>(</span><br><span class="line">      <span class="string">&quot;diar 300 1000&quot;</span>,</span><br><span class="line">      <span class="string">&quot;香奈儿 4000 2&quot;</span>,</span><br><span class="line">      <span class="string">&quot;螺蛳粉 200 98&quot;</span>,</span><br><span class="line">      <span class="string">&quot;30显卡 200 10&quot;</span>),<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> etlData = value.map(x=&gt;&#123;</span><br><span class="line">      <span class="keyword">val</span> strings=x.split(<span class="string">&quot; &quot;</span>)</span><br><span class="line">      <span class="keyword">val</span> name=strings(<span class="number">0</span>)</span><br><span class="line">      <span class="keyword">val</span> price=strings(<span class="number">1</span>).toDouble</span><br><span class="line">      <span class="keyword">val</span> store=strings(<span class="number">2</span>).toInt</span><br><span class="line">      skuu(name,price,store)</span><br><span class="line">    &#125;)</span><br><span class="line">    etlData.sortBy(x=&gt;(-x.d,x.str1)).collect.foreach(print(_))</span><br><span class="line"></span><br><span class="line">    sc.stop()</span><br><span class="line"></span><br><span class="line">    implicitly <span class="function"><span class="keyword">def</span> <span class="title">skutooreder</span></span>(sku:skuu):<span class="type">Ordered</span>[skuu]=&#123;</span><br><span class="line">      <span class="keyword">new</span> <span class="type">Ordered</span>[skuu]&#123;</span><br><span class="line">        <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">compare</span></span>(that: skuu): <span class="type">Int</span> = &#123;</span><br><span class="line">          <span class="keyword">if</span> (sku.d == that.d)&#123;</span><br><span class="line">            sku.str1-that.str1</span><br><span class="line">          &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            -(sku.d - that.d).toInt</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"> <span class="keyword">case</span> <span class="class"><span class="keyword">class</span> <span class="title">skuu</span>(<span class="params">val str: <span class="type">String</span>,val d: <span class="type">Double</span>,val str1: <span class="type">Int</span></span>)</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>例子：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">数据：</span><br><span class="line">word <span class="keyword">show</span> click</span><br><span class="line">a,<span class="number">2</span>,<span class="number">3</span></span><br><span class="line">b,<span class="number">1</span>,<span class="number">1</span></span><br><span class="line">c,<span class="number">4</span>,<span class="number">5</span></span><br><span class="line">f,<span class="number">5</span>,<span class="number">6</span></span><br><span class="line">g,<span class="number">7</span>,<span class="number">8</span></span><br><span class="line">k,<span class="number">8</span>,<span class="number">9</span></span><br><span class="line">a,<span class="number">1</span>,<span class="number">2</span></span><br><span class="line">a,<span class="number">1</span>,<span class="number">1</span></span><br><span class="line">a,<span class="number">4</span>,<span class="number">5</span></span><br><span class="line">b,<span class="number">5</span>,<span class="number">6</span></span><br><span class="line"><span class="comment">------------------------------------------------------------------------------</span></span><br><span class="line">package sparkfirst</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.&#123;SparkConf, SparkContext&#125;</span><br><span class="line"><span class="keyword">import</span> sparkfirst.ContextUtils</span><br><span class="line"><span class="keyword">object</span> sparktest &#123;</span><br><span class="line"></span><br><span class="line">  def sub(<span class="type">name</span>: String, tuple: (<span class="type">Double</span>, <span class="type">Int</span>))=&#123;</span><br><span class="line">    (<span class="type">name</span> , tuple)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  def main(args: <span class="keyword">Array</span>[String]): Unit = &#123;</span><br><span class="line">    val sc:SparkContext = ContextUtils.getSparkContext(&quot;test&quot;)</span><br><span class="line">    val bb = <span class="built_in">new</span> SparkContext(<span class="built_in">new</span> SparkConf().setAppName(&quot;test&quot;).setMaster(&quot;local[2]&quot;))</span><br><span class="line"></span><br><span class="line">    val <span class="keyword">value</span> = sc.parallelize(List(</span><br><span class="line">      &quot;a,2,3&quot;,</span><br><span class="line">      &quot;b,1,1&quot;,</span><br><span class="line">      &quot;c,4,5&quot;,</span><br><span class="line">      &quot;f,5,6&quot;,</span><br><span class="line">      &quot;g,7,8&quot;,</span><br><span class="line">      &quot;k,8,9&quot;,</span><br><span class="line">      &quot;a,1,2&quot;,</span><br><span class="line">      &quot;a,1,1&quot;,</span><br><span class="line">      &quot;a,4,5&quot;,</span><br><span class="line">      &quot;b,5,6&quot;),<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    val etlData = <span class="keyword">value</span>.map(x=&gt;&#123;</span><br><span class="line">      val strings=x.split(&quot;,&quot;)</span><br><span class="line">      val <span class="type">name</span>=strings(<span class="number">0</span>)</span><br><span class="line">      val price=strings(<span class="number">1</span>).toDouble</span><br><span class="line">      val store=strings(<span class="number">2</span>).toInt</span><br><span class="line">      sub(<span class="type">name</span>,(price,store))</span><br><span class="line">     // (<span class="type">name</span>,(price,store))</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    etlData.reduceByKey((x,y)=&gt;&#123;</span><br><span class="line">      (x._1+y._1,x._2+y._2)</span><br><span class="line">    &#125;).map(x=&gt;x._1+&quot;\t&quot;+x._2._1+&quot;\t&quot;+x._2._2+&quot;\t&quot;)</span><br><span class="line">   // etlData.reduceByKey((x,y)=&gt;&#123;(x._1+y._1,x._2+y._2)&#125;).map(x=&gt;x._1+&quot;\t&quot;+x._2._1+&quot;\t&quot;+x._2._2+&quot;\t&quot;)</span><br><span class="line">  </span><br><span class="line">    sc.stop()</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h3 id="理论："><a href="#理论：" class="headerlink" title="理论："></a>理论：</h3><p>spark架构：</p>
<ul>
<li>Application &#x3D;》 spark作业 &#x3D;》 driver program 和 executor on the cluster两个进程<ul>
<li>driver：运行sparkContext</li>
<li>exacutor：运行任务并保存数据在内存和磁盘中</li>
</ul>
</li>
<li>web ui</li>
<li>sparkcontext</li>
<li>application jar &#x3D;》 开发好的代码生成的jar包 &#x3D;》 包含spark作业 &#x3D;》 包含 main方法 &#x3D;》 用户自己开发完spark之后可以部署到服务器上</li>
<li>driver program &#x3D;》 运行 jar包里的main方法 &#x3D;》 创建sparkContext</li>
<li>Custer manager &#x3D;》 集群管理者 &#x3D;》 通过集群获取资源</li>
<li>Deploy mode &#x3D;》 当把作业提交到yarn上的时候<ul>
<li>cluster模式：是跑在集群内布的（driver）&#x3D;》 yarn所在的机器里面</li>
<li>client模式：跑在集群外外的</li>
</ul>
</li>
<li>Worker node &#x3D;》 工作节点&#x3D;》打工人&#x3D;》运行集群代码&#x3D;&#x3D;node manager</li>
<li>excutor &#x3D; 》相当于yarn的container&#x3D;》每个spark都有自己的excutor</li>
<li>task &#x3D;》partition &#x3D;》 rdd</li>
<li>job &#x3D;》 spark 里的job &#x3D;》 application里的job &#x3D;》 一个application里可能会有多个job</li>
<li>stage &#x3D;》 job的小单位，且每个stage之间是有依赖关系的</li>
<li>一个application会包含1-n个job，一个job包含1-n个stage</li>
<li>一个stage可以包含1-n个task</li>
<li>task和rdd里的分区数一一对应</li>
</ul>
<h3 id="spark的执行流程"><a href="#spark的执行流程" class="headerlink" title="spark的执行流程"></a>spark的执行流程</h3><p>sc去链接cluster manager</p>
<p>cluster manager 会给spark作业分配资源</p>
<p>spark一旦连接上Custer</p>
<p>启动&#x3D;》exector&#x3D;》存储和计算</p>
<p>sc发送代码 给 exector 发送task给他去运行</p>
<p>每个作业都是有自己的exector的</p>
<p>exector是相当于container&#x3D;》资源隔离&#x3D;》调度隔离</p>
<p>多个作业之间产生的数据是不可以进行共享的，但是当写到一个外部存储上，就可以了</p>
<p>spark-shell简单就是&#x3D;》 提交很多个job &#x3D;》相当于外部存储</p>
<p>用户无感知的连接到集群</p>
<p>可以监听exector的生命周期&#x3D;》和driver之间有 通信</p>
<p>只要driver可以连接到Custer集群上，他就可以&#x3D;》也就是说外部dirver也可以</p>
<p>提议：driver和work节点靠近一点，这样可以减少网络发送的时间，就是可以用本地来实现</p>
<h3 id="spark整合yarn"><a href="#spark整合yarn" class="headerlink" title="spark整合yarn"></a>spark整合yarn</h3><p>首先在spark的conf文件夹里执行 <code>cp spark-env.sh.template spark-env.sh</code></p>
<p>然后 <code>vim spark-env.sh</code></p>
<p>把 <code>HADOOP_CONF_DIR=/home/hadoop/app/hadoop/etc/hadoop 和 YARN_CONF_DIR=/home/hadoop/app/hadoop/etc/hadoop</code></p>
<p>加上之后重新启动spark执行 <code>spark-shell --master yarn</code></p>
<p>就可以了</p>
<p>一般启动之后，不配别的，一般这样是占用5G的内存</p>
<h3 id="案例：-1"><a href="#案例：-1" class="headerlink" title="案例："></a>案例：</h3><p>spark统计用户行为分析</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">    val value = sc<span class="selector-class">.parallelize</span>(<span class="built_in">List</span>(</span><br><span class="line">      <span class="string">&quot;u01,英雄联盟|绝活&amp;职业|云顶|奴神,1,1&quot;</span>,</span><br><span class="line">      <span class="string">&quot;u01,英雄联盟|绝活&amp;职业|云顶|金潺潺,1,1&quot;</span>,</span><br><span class="line">      <span class="string">&quot;u01,英雄联盟|绝活&amp;职业|云顶|带粉上车,1,0&quot;</span>,</span><br><span class="line">      <span class="string">&quot;u02,星秀|好声音|女团|三年一班,1,1&quot;</span>,</span><br><span class="line">      <span class="string">&quot;u02,星秀|好声音|女团|奴神,1,1&quot;</span>,</span><br><span class="line">      <span class="string">&quot;u02,星秀|好声音|女团|将神,1,0&quot;</span>,</span><br><span class="line">      <span class="string">&quot;u02,星秀|好声音|女团|西索,1,1&quot;</span>),<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    val etlData = value<span class="selector-class">.flatMap</span>(x=&gt;&#123;</span><br><span class="line">      val strings=x<span class="selector-class">.split</span>(<span class="string">&quot;,&quot;</span>)</span><br><span class="line">      val name=<span class="built_in">strings</span>(<span class="number">0</span>)</span><br><span class="line">      val type_log_total=<span class="built_in">strings</span>(<span class="number">1</span>)</span><br><span class="line">      val show=<span class="built_in">strings</span>(<span class="number">2</span>)<span class="selector-class">.toInt</span></span><br><span class="line">      val click=<span class="built_in">strings</span>(<span class="number">3</span>)<span class="selector-class">.toInt</span></span><br><span class="line">      val type_log_total_ni=type_log_total<span class="selector-class">.split</span>(<span class="string">&quot;\\|&quot;</span>)</span><br><span class="line">      type_log_total_ni<span class="selector-class">.map</span>(x=&gt;&#123;</span><br><span class="line">        ((name,x),(show,click))</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="comment">//sub(name,(price,store))</span></span><br><span class="line">      <span class="comment">//(name,(price,store))</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//    etlData.reduceByKey((x,y)=&gt;&#123;</span></span><br><span class="line"><span class="comment">//      (x._1+y._1,x._2+y._2)</span></span><br><span class="line"><span class="comment">//    &#125;).map(x=&gt;x._1+&quot;\t&quot;+x._2._1+&quot;\t&quot;+x._2._2+&quot;\t&quot;)</span></span><br><span class="line">   <span class="comment">//etlData.reduceByKey((x,y)=&gt;&#123;(x._1+y._1,x._2+y._2)&#125;).map(x=&gt;x._1+&quot;\t&quot;+x._2._1+&quot;\t&quot;+x._2._2+&quot;\t&quot;)</span></span><br><span class="line"></span><br><span class="line">    etlData<span class="selector-class">.reduceByKey</span>((x,y)=&gt;&#123;</span><br><span class="line">      (x._1+y._1,x._2+y._2)</span><br><span class="line">    &#125;)<span class="selector-class">.collect</span>()<span class="selector-class">.foreach</span>(println)</span><br></pre></td></tr></table></figure>

<h3 id="spark持久化"><a href="#spark持久化" class="headerlink" title="spark持久化:"></a>spark持久化:</h3><ul>
<li>RDD持久化 &#x3D;》 一个操作会有很多次的生成rdd，比如会有100个rdd，我们为了节省时间以及链路资源，可以把第99个rdd持久化，然后只用对第99个操作就好了</li>
<li>持久化也是可以容错的</li>
<li>就是保存在内存中</li>
<li>是针对rdd的每个分区来的</li>
<li>持久化操作，是下次操作的时候才会从持久化的地方加载数据</li>
<li>默认存储级别是在内存中存储</li>
<li>用persist或者cache都可以 &#x3D;》 是lazy的</li>
<li>当内存不足的时候是不能进行持久化的 我们可以通过序列化，进行配置&#x3D; 》 减少使用空间</li>
<li>一般我们要在内存和cpu之间做权衡 &#x3D;》4步选择法<ul>
<li>官方&#x3D;》memory_only</li>
<li>memory_only_ser &#x3D;&gt; 对空间会节省</li>
<li>磁盘上 &#x3D; 》 memory_only_desk &#x3D;&gt; 没有不做序列化快</li>
<li>容错 &#x3D;》 带有副本的方式，的确是更安全可是数据太大对磁盘是负担</li>
</ul>
</li>
<li>移除持久化数据：可以设置自动的级别（<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_46517733/article/details/123092629">LRU</a>），就会过一段时间，然后自动&#x2F;或者通过rdd调用 <code>unpersist(true)</code>他是立即执行的</li>
<li></li>
</ul>
<p>启动spark-shell本身也是一个spark作业</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line">scala&gt; val test = sc<span class="selector-class">.parallelize</span>(<span class="string">&quot;hdfs://bigdata3:9000/flume/events/2022-12-13/events.1670898548750.log&quot;</span>)</span><br><span class="line">test: org<span class="selector-class">.apache</span><span class="selector-class">.spark</span><span class="selector-class">.rdd</span><span class="selector-class">.RDD</span><span class="selector-attr">[Char]</span> = ParallelCollectionRDD<span class="selector-attr">[0]</span> at parallelize at &lt;console&gt;:<span class="number">23</span></span><br><span class="line"></span><br><span class="line">scala&gt; test<span class="selector-class">.collect</span></span><br><span class="line">collect   collectAsync</span><br><span class="line"></span><br><span class="line">scala&gt; test<span class="selector-class">.collect</span></span><br><span class="line">res0: Array<span class="selector-attr">[Char]</span> = <span class="built_in">Array</span>(h, d, f, s, :, /, /, <span class="selector-tag">b</span>, <span class="selector-tag">i</span>, g, d, <span class="selector-tag">a</span>, t, <span class="selector-tag">a</span>, <span class="number">3</span>, :, <span class="number">9</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, /, f, l, u, m, e, /, e, v, e, n, t, s, /, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, -, <span class="number">1</span>, <span class="number">2</span>, -, <span class="number">1</span>, <span class="number">3</span>, /, e, v, e, n, t, s, ., <span class="number">1</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">0</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">5</span>, <span class="number">0</span>, ., l, o, g)</span><br><span class="line"></span><br><span class="line">scala&gt; test<span class="selector-class">.persist</span></span><br><span class="line">res1: test<span class="selector-class">.type</span> = ParallelCollectionRDD<span class="selector-attr">[0]</span> at parallelize at &lt;console&gt;:<span class="number">23</span></span><br><span class="line"></span><br><span class="line">scala&gt; test<span class="selector-class">.ca</span></span><br><span class="line">cache   cartesian</span><br><span class="line"></span><br><span class="line">scala&gt; test<span class="selector-class">.cache</span></span><br><span class="line">res2: test<span class="selector-class">.type</span> = ParallelCollectionRDD<span class="selector-attr">[0]</span> at parallelize at &lt;console&gt;:<span class="number">23</span></span><br><span class="line">-------------------------------------------------------------------------------------<span class="attr">--java</span>的序列化方法</span><br><span class="line">    val names = Array<span class="selector-attr">[String]</span>(<span class="string">&quot;刘子航&quot;</span>,<span class="string">&quot;李信&quot;</span>,<span class="string">&quot;花木兰&quot;</span>,<span class="string">&quot;达摩&quot;</span>,<span class="string">&quot;耀&quot;</span>,<span class="string">&quot;貂蝉&quot;</span>,<span class="string">&quot;吕布&quot;</span>)</span><br><span class="line">    val gar = Array<span class="selector-attr">[String]</span>(<span class="string">&quot;男&quot;</span>,<span class="string">&quot;女&quot;</span>)</span><br><span class="line">    val addres= Array<span class="selector-attr">[String]</span>(<span class="string">&quot;山东&quot;</span>,<span class="string">&quot;广西&quot;</span>,<span class="string">&quot;大连&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    val value1 = sc<span class="selector-class">.parallelize</span>(<span class="number">1</span> to <span class="number">300000</span>)</span><br><span class="line"></span><br><span class="line">    val value2 = new ArrayBuffer<span class="selector-attr">[persion]</span>()</span><br><span class="line">    val value3 = value1<span class="selector-class">.map</span>(x =&gt; &#123;</span><br><span class="line">      val name = <span class="built_in">names</span>(Random<span class="selector-class">.nextInt</span>(<span class="number">6</span>))</span><br><span class="line">      val s = <span class="built_in">gar</span>(Random<span class="selector-class">.nextInt</span>(<span class="number">1</span>))</span><br><span class="line">      val s1 = <span class="built_in">addres</span>(Random<span class="selector-class">.nextInt</span>(<span class="number">2</span>))</span><br><span class="line">      value2 += (<span class="built_in">persion</span>(name, s, s1))</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    value3<span class="selector-class">.persist</span>(StorageLevel.MEMORY_ONLY_SER)</span><br><span class="line">    value3<span class="selector-class">.count</span>()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">case class <span class="built_in">persion</span>(name: String,gre:String,add:String)&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">-----------------------------------------------------<span class="attr">--Kyro</span>序列化</span><br><span class="line">速度比java快，但是不是支持所有的序列化的，有的没有，使用前要加上注册类</span><br><span class="line"></span><br><span class="line">要先在conf里使用它</span><br><span class="line"> conf<span class="selector-class">.set</span>(<span class="string">&quot;spark.serializer&quot;</span>,<span class="string">&quot;org.apache.spark.serializer.KryoSerializer&quot;</span>)</span><br><span class="line">然后要注册所用的case class或者class </span><br><span class="line"> conf<span class="selector-class">.registerKryoClasses</span>(<span class="built_in">Array</span>(classOf<span class="selector-attr">[Info]</span>))</span><br><span class="line">然后其余和上述一样</span><br><span class="line"></span><br><span class="line">    val names = Array<span class="selector-attr">[String]</span>(<span class="string">&quot;刘子航&quot;</span>,<span class="string">&quot;李信&quot;</span>,<span class="string">&quot;花木兰&quot;</span>,<span class="string">&quot;达摩&quot;</span>,<span class="string">&quot;耀&quot;</span>,<span class="string">&quot;貂蝉&quot;</span>,<span class="string">&quot;吕布&quot;</span>)</span><br><span class="line">    val gar = Array<span class="selector-attr">[String]</span>(<span class="string">&quot;男&quot;</span>,<span class="string">&quot;女&quot;</span>)</span><br><span class="line">    val addres= Array<span class="selector-attr">[String]</span>(<span class="string">&quot;山东&quot;</span>,<span class="string">&quot;广西&quot;</span>,<span class="string">&quot;大连&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    val value1 = sc<span class="selector-class">.parallelize</span>(<span class="number">1</span> to <span class="number">300000</span>)</span><br><span class="line"></span><br><span class="line">    val value2 = new ArrayBuffer<span class="selector-attr">[persion]</span>()</span><br><span class="line">    val value3 = value1<span class="selector-class">.map</span>(x =&gt; &#123;</span><br><span class="line">      val name = <span class="built_in">names</span>(Random<span class="selector-class">.nextInt</span>(<span class="number">6</span>))</span><br><span class="line">      val s = <span class="built_in">gar</span>(Random<span class="selector-class">.nextInt</span>(<span class="number">1</span>))</span><br><span class="line">      val s1 = <span class="built_in">addres</span>(Random<span class="selector-class">.nextInt</span>(<span class="number">2</span>))</span><br><span class="line">      value2 += (<span class="built_in">persion</span>(name, s, s1))</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    value3<span class="selector-class">.persist</span>(StorageLevel.MEMORY_ONLY_SER)</span><br><span class="line">    value3<span class="selector-class">.count</span>()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">case class <span class="built_in">persion</span>(name: String,gre:String,add:String)&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="依赖关系和血缘关系"><a href="#依赖关系和血缘关系" class="headerlink" title="依赖关系和血缘关系"></a>依赖关系和血缘关系</h3><p>血缘关系 ： &#x3D;》就是不同rdd之间的转化</p>
<p>依赖关系 &#x3D;》 </p>
<ul>
<li>宽依赖 ： 一个父RDD里的parttion会被子RDD的partition使用多次 &#x3D;》 会产生shuffer &#x3D;》 有新的stage产生 &#x3D; 》一个shuffle会划分两个stage &#x3D;》引起shuffle就会产生stage</li>
<li>窄依赖 ： 同一个父RDD里的分区最多被子RDD使用一次 &#x3D;》一个stage里完成的 &#x3D;》 无shuffle</li>
</ul>
<h3 id="补充算子-："><a href="#补充算子-：" class="headerlink" title="补充算子 ："></a>补充算子 ：</h3><p>repartition ： <code>repartition（num）</code>重新分区 ，引起shuffle &#x3D;》 底层调用的是coalesce &#x3D;》 不可以减少分取数</p>
<p>coalesce ： 一般用于减少RDD的分区数量，<code>coalesce(num)</code>窄依赖的 &#x3D;》 不引起shuffle &#x3D;》 可以增加分区数</p>
<p>生产上用于调整计算的并行度</p>
<h3 id="判断执行位置"><a href="#判断执行位置" class="headerlink" title="判断执行位置"></a>判断执行位置</h3><p>判断是不是对rdd里的元素进行操作，如果是操作，则是executor端的，如果不是则是driver端</p>
<p>例子 ：求top2</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">    val value = sc<span class="selector-class">.parallelize</span>(<span class="built_in">List</span>(</span><br><span class="line">      <span class="string">&quot;www.bvaidu,u01,20&quot;</span>,</span><br><span class="line">      <span class="string">&quot;www.githuba,u02,2&quot;</span>,</span><br><span class="line">      <span class="string">&quot;www.bvaidu,u02,100&quot;</span>,</span><br><span class="line">      <span class="string">&quot;www.bibi,u02,199&quot;</span>,</span><br><span class="line">      <span class="string">&quot;www.githuba,u01,100&quot;</span>,</span><br><span class="line">      <span class="string">&quot;www.githuba,u01,1&quot;</span>,</span><br><span class="line">      <span class="string">&quot;www.githuba,u01,10&quot;</span>,</span><br><span class="line">      <span class="string">&quot;www.bibi,u02,19&quot;</span>,</span><br><span class="line">      <span class="string">&quot;www.bibi,u01,199&quot;</span>,</span><br><span class="line">      <span class="string">&quot;www.baidu.com,uid01,1&quot;</span>,</span><br><span class="line">      <span class="string">&quot;www.baidu.com,uid01,10&quot;</span>,</span><br><span class="line">      <span class="string">&quot;www.baidu.com,uid02,3&quot;</span>,</span><br><span class="line">      <span class="string">&quot;www.baidu.com,uid02,5&quot;</span>,</span><br><span class="line">      <span class="string">&quot;www.github.com,uid01,11&quot;</span>,</span><br><span class="line">      <span class="string">&quot;www.github.com,uid01,10&quot;</span>,</span><br><span class="line">      <span class="string">&quot;www.github.com,uid02,30&quot;</span>,</span><br><span class="line">      <span class="string">&quot;www.github.com,uid02,50&quot;</span>,</span><br><span class="line">      <span class="string">&quot;www.bibili.com,uid01,110&quot;</span>,</span><br><span class="line">      <span class="string">&quot;www.bibili.com,uid01,10&quot;</span>,</span><br><span class="line">      <span class="string">&quot;www.bibili.com,uid02,2&quot;</span>,</span><br><span class="line">      <span class="string">&quot;www.bibili.com,uid02,3&quot;</span>),<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    val etlData = value<span class="selector-class">.map</span>(x=&gt;&#123;</span><br><span class="line">      val strings=x<span class="selector-class">.split</span>(<span class="string">&quot;,&quot;</span>)</span><br><span class="line">      val yuming=<span class="built_in">strings</span>(<span class="number">0</span>)</span><br><span class="line">      val user=<span class="built_in">strings</span>(<span class="number">1</span>)</span><br><span class="line">      val cishu=<span class="built_in">strings</span>(<span class="number">2</span>)<span class="selector-class">.toInt</span></span><br><span class="line">      ((yuming,user),(cishu))</span><br><span class="line">      <span class="comment">//sub(name,(price,store))</span></span><br><span class="line">      <span class="comment">//(name,(price,store))</span></span><br><span class="line">    &#125;)</span><br><span class="line">etlData<span class="selector-class">.reduceByKey</span>((x,y)=&gt;&#123;</span><br><span class="line">      x+y</span><br><span class="line">    &#125;)<span class="selector-class">.sortBy</span>(x=&gt; -x._2,true)<span class="selector-class">.map</span>(x=&gt;&#123;</span><br><span class="line">      (x._1._2,(x._1._1,x._2))</span><br><span class="line">    &#125;)<span class="selector-class">.groupByKey</span>()<span class="selector-class">.map</span>(x=&gt;&#123;</span><br><span class="line">        x._2<span class="selector-class">.map</span>(s=&gt;&#123;</span><br><span class="line">          (x._1,s._1,s._2)</span><br><span class="line">      &#125;)<span class="selector-class">.take</span>(<span class="number">2</span>)&#125;)<span class="selector-class">.saveAsTextFile</span>(<span class="string">&quot;hdfs://bigdata3:9000/input/10.txt&quot;</span>)</span><br><span class="line">------------------------------------------------------------------------------简化版本</span><br><span class="line">    val value = sc<span class="selector-class">.parallelize</span>(<span class="built_in">List</span>(</span><br><span class="line">      <span class="string">&quot;www.bvaidu,u01,20&quot;</span>,</span><br><span class="line">      <span class="string">&quot;www.githuba,u02,2&quot;</span>,</span><br><span class="line">      <span class="string">&quot;www.bvaidu,u02,100&quot;</span>,</span><br><span class="line">      <span class="string">&quot;www.bibi,u02,199&quot;</span>,</span><br><span class="line">      <span class="string">&quot;www.githuba,u01,100&quot;</span>,</span><br><span class="line">      <span class="string">&quot;www.githuba,u01,1&quot;</span>,</span><br><span class="line">      <span class="string">&quot;www.githuba,u01,10&quot;</span>,</span><br><span class="line">      <span class="string">&quot;www.bibi,u02,19&quot;</span>,</span><br><span class="line">      <span class="string">&quot;www.bibi,u01,199&quot;</span>,</span><br><span class="line">      <span class="string">&quot;www.baidu.com,uid01,1&quot;</span>,</span><br><span class="line">      <span class="string">&quot;www.baidu.com,uid01,10&quot;</span>,</span><br><span class="line">      <span class="string">&quot;www.baidu.com,uid02,3&quot;</span>,</span><br><span class="line">      <span class="string">&quot;www.baidu.com,uid02,5&quot;</span>,</span><br><span class="line">      <span class="string">&quot;www.github.com,uid01,11&quot;</span>,</span><br><span class="line">      <span class="string">&quot;www.github.com,uid01,10&quot;</span>,</span><br><span class="line">      <span class="string">&quot;www.github.com,uid02,30&quot;</span>,</span><br><span class="line">      <span class="string">&quot;www.github.com,uid02,50&quot;</span>,</span><br><span class="line">      <span class="string">&quot;www.bibili.com,uid01,110&quot;</span>,</span><br><span class="line">      <span class="string">&quot;www.bibili.com,uid01,10&quot;</span>,</span><br><span class="line">      <span class="string">&quot;www.bibili.com,uid02,2&quot;</span>,</span><br><span class="line">      <span class="string">&quot;www.bibili.com,uid02,3&quot;</span>),<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    val etlData = value<span class="selector-class">.map</span>(x=&gt;&#123;</span><br><span class="line">      val strings=x<span class="selector-class">.split</span>(<span class="string">&quot;,&quot;</span>)</span><br><span class="line">      val yuming=<span class="built_in">strings</span>(<span class="number">0</span>)</span><br><span class="line">      val user=<span class="built_in">strings</span>(<span class="number">1</span>)</span><br><span class="line">      val cishu=<span class="built_in">strings</span>(<span class="number">2</span>)<span class="selector-class">.toInt</span></span><br><span class="line">      ((yuming,user),(cishu))</span><br><span class="line">      <span class="comment">//sub(name,(price,store))</span></span><br><span class="line">      <span class="comment">//(name,(price,store))</span></span><br><span class="line">    &#125;)</span><br><span class="line">    val value4 = etlData<span class="selector-class">.map</span>(x =&gt; &#123;</span><br><span class="line">      (x._1._2)</span><br><span class="line">    &#125;)<span class="selector-class">.distinct</span>()<span class="selector-class">.collect</span>()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (elem &lt;- value4)&#123;</span><br><span class="line">     etlData<span class="selector-class">.filter</span>(_._1._2 == elem)<span class="selector-class">.reduceByKey</span>(_ + _)<span class="selector-class">.sortBy</span>( -_._2)<span class="selector-class">.take</span>(<span class="number">2</span>)<span class="selector-class">.foreach</span>(<span class="built_in">println</span>(_))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>累加器：广播变量&#x3D;》后续再补充</p>
<p>案例 ： wordcount</p>
<figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">val wc = sc.textFile(<span class="string">&quot;hdfs://bigdata3:9000/3.log&quot;</span>)</span><br><span class="line"></span><br><span class="line">wc.flatMap(<span class="function"><span class="params">x</span>=&gt;</span>&#123;</span><br><span class="line">  x.<span class="built_in">split</span>(<span class="string">&quot;,&quot;</span>)</span><br><span class="line">&#125;).<span class="built_in">map</span>(<span class="function"><span class="params">x</span>=&gt;</span>&#123;</span><br><span class="line">  (x,<span class="number">1</span>)</span><br><span class="line">&#125;).reduceByKey(<span class="function">(<span class="params">x,y</span>)=&gt;</span>&#123;</span><br><span class="line">  x+y</span><br><span class="line">&#125;).saveAsTextFile(<span class="string">&quot;hdfs://bigdata3:9000/input/11.txt&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>部署spark作业</p>
<ul>
<li>jar</li>
<li>spark-submit</li>
</ul>
<figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">spark-submit <span class="string">\</span></span><br><span class="line">--<span class="keyword">class</span> 包名 <span class="string">\</span></span><br><span class="line">--master 模式 <span class="string">\</span></span><br><span class="line">--name 作业名字 <span class="string">\</span></span><br><span class="line">jar包在机器上的路径 <span class="string">\</span></span><br><span class="line">想传的参数</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>还可以用其内封装的方法进行传值&#x3D;》不用 args</p>
<p>就是在submit的时候用 <code>--conf</code>传入</p>
<p>代码如下  : </p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.dl2262.sparkcore.day02</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.dl2262.sparkcore.util.&#123;<span class="type">ContextUtils</span>, <span class="type">FileUtils</span>&#125;</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.<span class="type">SparkContext</span></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.internal.<span class="type">Logging</span></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.rdd.<span class="type">RDD</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  *</span></span><br><span class="line"><span class="comment">  * @author sxwang</span></span><br><span class="line"><span class="comment">  *         01 05 8:28</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">WCApp</span> <span class="keyword">extends</span> <span class="title">Logging</span></span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//    if(args.size != 2)&#123;</span></span><br><span class="line">    <span class="comment">//      logError(&quot;请正确输入2个参数：&lt;input&gt; &lt;output&gt;&quot;)</span></span><br><span class="line">    <span class="comment">//      System.exit(0)</span></span><br><span class="line">    <span class="comment">//    &#125;</span></span><br><span class="line">    <span class="comment">//    val in = args(0)</span></span><br><span class="line">    <span class="comment">//    val out = args(1)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> sc: <span class="type">SparkContext</span> = <span class="type">ContextUtils</span>.getSparkContext(<span class="keyword">this</span>.getClass.getSimpleName)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> in = sc.getConf.get(<span class="string">&quot;spark.input.path&quot;</span>,<span class="string">&quot;hdfs://bigdata32:9000/input/&quot;</span>)</span><br><span class="line">    <span class="keyword">val</span> out = sc.getConf.get(<span class="string">&quot;spark.output.path&quot;</span>,<span class="string">&quot;hdfs://bigdata32:9000/output/&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> input = sc.textFile(in)</span><br><span class="line"></span><br><span class="line">    <span class="type">FileUtils</span>.deletePath( sc.hadoopConfiguration,out)</span><br><span class="line"></span><br><span class="line">    input.flatMap(line  =&gt; &#123;</span><br><span class="line">      line.split(<span class="string">&quot;,&quot;</span>)</span><br><span class="line">    &#125;).map(word =&gt; (word,<span class="number">1</span>))</span><br><span class="line">      .reduceByKey(_+_)</span><br><span class="line">      .saveAsTextFile(out)</span><br><span class="line"></span><br><span class="line">    sc.stop()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>例子：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">数据类型如下：</span><br><span class="line">域名，用户，用户所在地，展示次数，点击次数</span><br><span class="line">求分别按照域名，用户，用户所在地进行统计其top2</span><br><span class="line">-----------------------------------------------------------------------------------制造数据</span><br><span class="line">  val domin = Array<span class="selector-attr">[String]</span>(<span class="string">&quot;www.baidu.com&quot;</span>,<span class="string">&quot;www.taobao.com&quot;</span>,<span class="string">&quot;www.github.com&quot;</span>,<span class="string">&quot;www.bilbil.com&quot;</span>,<span class="string">&quot;www.csdn.com&quot;</span>,<span class="string">&quot;www.zihang.com&quot;</span>)</span><br><span class="line">    val userList = Array<span class="selector-attr">[String]</span>(<span class="string">&quot;zihang&quot;</span>,<span class="string">&quot;zuan&quot;</span>,<span class="string">&quot;zihao&quot;</span>,<span class="string">&quot;shuangxi&quot;</span>,<span class="string">&quot;yuhang&quot;</span>)</span><br><span class="line">    val beianlocal = Array<span class="selector-attr">[String]</span>(<span class="string">&quot;广州&quot;</span>,<span class="string">&quot;江西&quot;</span>,<span class="string">&quot;太原&quot;</span>,<span class="string">&quot;新疆&quot;</span>,<span class="string">&quot;上海&quot;</span>)</span><br><span class="line">    <span class="selector-tag">var</span> stringe:List<span class="selector-attr">[String]</span> = Nil</span><br><span class="line">    <span class="built_in">for</span>(<span class="selector-tag">i</span> &lt;- <span class="number">1</span> <span class="built_in">to</span>(<span class="number">30000</span>))&#123;</span><br><span class="line">      val Randomdomin = <span class="built_in">domin</span>(Random<span class="selector-class">.nextInt</span>(domin.length-<span class="number">1</span>))</span><br><span class="line">      val RandomUserList = <span class="built_in">userList</span>(Random<span class="selector-class">.nextInt</span>(userList.length-<span class="number">1</span>))</span><br><span class="line">      val Randombeianlocal = <span class="built_in">beianlocal</span>(Random<span class="selector-class">.nextInt</span>(beianlocal.length-<span class="number">1</span>))</span><br><span class="line">      val tmp = <span class="built_in">List</span>(Randomdomin + <span class="string">&quot;,&quot;</span> + RandomUserList + <span class="string">&quot;,&quot;</span> + Randombeianlocal )</span><br><span class="line">      stringe = stringe++tmp</span><br><span class="line">    &#125;</span><br><span class="line">-------------------------------------------------------------------------------域名 =&gt;其他有时间再补充把，和这个一样</span><br><span class="line"> val basicdata = sc<span class="selector-class">.parallelize</span>(stringe)</span><br><span class="line">-------------------------------------------------------------------------------解析数据</span><br><span class="line">    val ETLDATA = basicdata<span class="selector-class">.map</span>(x=&gt;&#123;</span><br><span class="line">      val strings = x<span class="selector-class">.split</span>(<span class="string">&quot;,&quot;</span>)</span><br><span class="line">      val currentdomin = <span class="built_in">strings</span>(<span class="number">0</span>)</span><br><span class="line">      val currentuser = <span class="built_in">strings</span>(<span class="number">1</span>)</span><br><span class="line">      val currentadd = <span class="built_in">strings</span>(<span class="number">2</span>)</span><br><span class="line">      val click = Random<span class="selector-class">.nextInt</span>(<span class="number">100</span>)<span class="selector-class">.toInt</span></span><br><span class="line">      val show = Random<span class="selector-class">.nextInt</span>(<span class="number">200</span>)<span class="selector-class">.toInt</span></span><br><span class="line">      ((currentdomin,currentuser,currentadd),(click,show))</span><br><span class="line">    &#125;)</span><br><span class="line">--------------------------------------------------------------------------------处理并排序</span><br><span class="line">      <span class="keyword">for</span> (elem &lt;- domin)&#123;</span><br><span class="line">        ETLDATA<span class="selector-class">.filter</span>(_._1._1==elem)<span class="selector-class">.reduceByKey</span>((x,y)=&gt;&#123;</span><br><span class="line">          (x._1+y._1,x._2+y._2)</span><br><span class="line">        &#125;)<span class="selector-class">.sortBy</span>( -_._2._1)<span class="selector-class">.take</span>(<span class="number">2</span>)<span class="selector-class">.foreach</span>(<span class="built_in">println</span>(_))</span><br><span class="line">      &#125;</span><br><span class="line">---------------------------------------------------------------------------------方法<span class="number">2</span></span><br><span class="line">    ETLDATA<span class="selector-class">.reduceByKey</span>((x,y)=&gt;&#123;</span><br><span class="line">      (x._1+y._1,y._2+x._2)</span><br><span class="line">    &#125;)<span class="selector-class">.sortBy</span>(x=&gt; -x._2._1)<span class="selector-class">.map</span>(x=&gt;&#123;</span><br><span class="line">      (x._1._1,(x._1._2,x._1._3,x._2))</span><br><span class="line">    &#125;)<span class="selector-class">.groupByKey</span>()<span class="selector-class">.map</span>(x=&gt;&#123;</span><br><span class="line">      x._2<span class="selector-class">.map</span>(s=&gt;&#123;</span><br><span class="line">        (x._1,(s._1,s._2,s._3))</span><br><span class="line">      &#125;)<span class="selector-class">.take</span>(<span class="number">2</span>)</span><br><span class="line">    &#125;).collect</span><br></pre></td></tr></table></figure>

    </div>

    
    
    

      
   <div>
     <div>
    
        <div style="text-align:center;color: #ccc;font-size:24px;">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div>
    
</div>

   </div>
     
        <div class="reward-container">
  <div>你们的鼓励是对我最大的支持</div>
  <button onclick="var qr = document.getElementById('qr'); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    打赏
  </button>
  <div id="qr" style="display: none;">
      
      <div style="display: inline-block;">
        <img src="/images/wechatpay.png" alt="liu zihang 微信支付">
        <p>微信支付</p>
      </div>

  </div>
</div>

        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>liu zihang
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="http://zihang.fun/2023/01/04/1-4/" title="spark">http://zihang.fun/2023/01/04/1-4/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

        

  <div class="followme">
    <p>欢迎关注我的其它发布渠道</p>

    <div class="social-list">

        <div class="social-item">
          <a target="_blank" class="social-link" href="/images/wechat_channel.jpg">
            <span class="icon">
              <i class="fab fa-weixin"></i>
            </span>

            <span class="label">WeChat</span>
          </a>
        </div>

        <div class="social-item">
          <a target="_blank" class="social-link" href="/atom.xml">
            <span class="icon">
              <i class="fa fa-rss"></i>
            </span>

            <span class="label">RSS</span>
          </a>
        </div>
    </div>
  </div>

     
    
      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/12/28/12-24/" rel="prev" title="hive调优">
      <i class="fa fa-chevron-left"></i> hive调优
    </a></div>
      <div class="post-nav-item">
    <a href="/2023/01/10/1-10/" rel="next" title="sparksql">
      sparksql <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    
  <div class="comments">
    <div id="lv-container" data-id="city" data-uid="MTAyMC81NzQzNy8zMzkwMQ=="></div>
  </div>
  

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#spark"><span class="nav-number">1.</span> <span class="nav-text">spark</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%89%B9%E7%82%B9-%EF%BC%9A"><span class="nav-number">1.0.1.</span> <span class="nav-text">特点 ：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%80%9F%E5%BA%A6%E5%BF%AB%EF%BC%9A"><span class="nav-number">1.0.2.</span> <span class="nav-text">速度快：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%98%93%E7%94%A8%E6%80%A7"><span class="nav-number">1.0.3.</span> <span class="nav-text">易用性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#spark-%E8%83%BD%E4%B8%8D%E8%83%BD%E6%9B%BF%E6%8D%A2hadoop-x3D-%E3%80%8B-%E6%9B%BF%E6%8D%A2%E4%B8%8D%E4%BA%86-x3D-%E3%80%8Bspark-x3D-%E3%80%8B-%E5%8F%AF%E4%BB%A5mr"><span class="nav-number">1.0.4.</span> <span class="nav-text">spark 能不能替换hadoop &#x3D;》 替换不了&#x3D;》spark &#x3D;》 可以mr</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BC%98%E7%82%B9%EF%BC%9A"><span class="nav-number">1.0.5.</span> <span class="nav-text">优点：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%B9%E6%80%A7%EF%BC%9F"><span class="nav-number">1.0.6.</span> <span class="nav-text">弹性？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%86%E5%B8%83%E5%BC%8F%EF%BC%9F"><span class="nav-number">1.0.7.</span> <span class="nav-text">分布式？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#RDD-%E7%9A%84%E7%89%B9%E6%80%A7%EF%BC%9A"><span class="nav-number">1.0.8.</span> <span class="nav-text">RDD 的特性：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96spark%EF%BC%9A"><span class="nav-number">1.0.9.</span> <span class="nav-text">初始化spark：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AE%97%E5%AD%90%EF%BC%9A"><span class="nav-number">1.0.10.</span> <span class="nav-text">算子：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A1%88%E4%BE%8B%EF%BC%9A"><span class="nav-number">1.0.11.</span> <span class="nav-text">案例：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9C%80%E6%B1%82%EF%BC%9A%E7%94%A8%E4%B8%A4%E7%B1%BB%E8%BF%9B%E8%A1%8C-%E5%AF%B9%E6%AF%94%EF%BC%9A"><span class="nav-number">1.0.12.</span> <span class="nav-text">需求：用两类进行 对比：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%90%86%E8%AE%BA%EF%BC%9A"><span class="nav-number">1.0.13.</span> <span class="nav-text">理论：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#spark%E7%9A%84%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B"><span class="nav-number">1.0.14.</span> <span class="nav-text">spark的执行流程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#spark%E6%95%B4%E5%90%88yarn"><span class="nav-number">1.0.15.</span> <span class="nav-text">spark整合yarn</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A1%88%E4%BE%8B%EF%BC%9A-1"><span class="nav-number">1.0.16.</span> <span class="nav-text">案例：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#spark%E6%8C%81%E4%B9%85%E5%8C%96"><span class="nav-number">1.0.17.</span> <span class="nav-text">spark持久化:</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BE%9D%E8%B5%96%E5%85%B3%E7%B3%BB%E5%92%8C%E8%A1%80%E7%BC%98%E5%85%B3%E7%B3%BB"><span class="nav-number">1.0.18.</span> <span class="nav-text">依赖关系和血缘关系</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A1%A5%E5%85%85%E7%AE%97%E5%AD%90-%EF%BC%9A"><span class="nav-number">1.0.19.</span> <span class="nav-text">补充算子 ：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%A4%E6%96%AD%E6%89%A7%E8%A1%8C%E4%BD%8D%E7%BD%AE"><span class="nav-number">1.0.20.</span> <span class="nav-text">判断执行位置</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="liu zihang"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">liu zihang</p>
  <div class="site-description" itemprop="description">只有努力不会辜负你</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">56</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="sidebar-button motion-element"><i class="fa fa-comment"></i>
    Chat
  </a>
  </div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/yourname" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;yourname" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      链接网站
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://baidu.com/" title="https:&#x2F;&#x2F;baidu.com" rel="noopener" target="_blank">百度</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://fishc.com.cn/" title="https:&#x2F;&#x2F;fishc.com.cn" rel="noopener" target="_blank">鱼C论坛</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">liu zihang</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count">博客全站共173.9k字</span>
</div>


    <script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

    <span id="busuanzi_container_site_pv">总访问量<span id="busuanzi_value_site_pv"></span>次</span>
    <span class="post-meta-divider">|</span>
    <span id="busuanzi_container_site_uv">总访客数<span id="busuanzi_value_site_uv"></span>人</span>
    <span class="post-meta-divider">|</span>
<!-- 不蒜子计数初始值纠正 -->
<script>
$(document).ready(function() {

    var int = setInterval(fixCount, 50);  // 50ms周期检测函数
    var countOffset = 20000;  // 初始化首次数据

    function fixCount() {            
       if (document.getElementById("busuanzi_container_site_pv").style.display != "none")
        {
            $("#busuanzi_value_site_pv").html(parseInt($("#busuanzi_value_site_pv").html()) + countOffset); 
            clearInterval(int);
        }                  
        if ($("#busuanzi_container_site_pv").css("display") != "none")
        {
            $("#busuanzi_value_site_uv").html(parseInt($("#busuanzi_value_site_uv").html()) + countOffset); // 加上初始数据 
            clearInterval(int); // 停止检测
        }  
    }
       	
});
</script> 

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  
  <script color='0,0,255' opacity='0.5' zIndex='-1' count='99' src="/lib/canvas-nest/canvas-nest.min.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>


  <script defer src="/lib/three/three.min.js"></script>
    <script defer src="/lib/three/canvas_lines.min.js"></script>


  




  
<script src="/js/local-search.js"></script>













  

  

  
  <script src="//cdn.jsdelivr.net/npm/quicklink@1/dist/quicklink.umd.js"></script>
  <script>
      window.addEventListener('load', () => {
      quicklink({
        timeout : 3000,
        priority: true,
        ignores : [uri => uri.includes('#'),uri => uri === 'http://zihang.fun/2023/01/04/1-4/',]
      });
      });
  </script>

<script>
NexT.utils.loadComments(document.querySelector('#lv-container'), () => {
  window.livereOptions = {
    refer: location.pathname.replace(CONFIG.root, '').replace('index.html', '')
  };
  (function(d, s) {
    var j, e = d.getElementsByTagName(s)[0];
    if (typeof LivereTower === 'function') { return; }
    j = d.createElement(s);
    j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
    j.async = true;
    e.parentNode.insertBefore(j, e);
  })(document, 'script');
});
</script>

</body>
</html>
