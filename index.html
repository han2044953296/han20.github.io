<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/%E6%A0%91%E5%8F%B6_sleaves%20(1).png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/%E6%A0%91%E5%8F%B6_sleaves.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-flash.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"zihang.fun","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"hide","padding":18,"offset":15,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"flat"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"manual","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="只有努力不会辜负你">
<meta property="og:type" content="website">
<meta property="og:title" content="枫叶冢">
<meta property="og:url" content="http://zihang.fun/index.html">
<meta property="og:site_name" content="枫叶冢">
<meta property="og:description" content="只有努力不会辜负你">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="liu zihang">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://zihang.fun/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>枫叶冢</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/rss2.xml" title="枫叶冢" type="application/rss+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>
    <a target="_blank" rel="noopener" href="https://github.com/han2044953296" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#fff; color:#151513; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">枫叶冢</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-schedule">

    <a href="/schedule/" rel="section"><i class="fa fa-calendar fa-fw"></i>日程表</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://zihang.fun/2022/11/03/hello-world/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="liu zihang">
      <meta itemprop="description" content="只有努力不会辜负你">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="枫叶冢">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/11/03/hello-world/" class="post-title-link" itemprop="url">Hello World</a>
        </h2>

        <div class="post-meta">
          
          <i class="fa fa-thumb-tack"></i>
          <font color=7D26CD>置顶</font>
          <span class="post-meta-divider">|</span>
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-11-03 13:38:31" itemprop="dateCreated datePublished" datetime="2022-11-03T13:38:31+08:00">2022-11-03</time>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>372</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    

   

    <div class="post-body" itemprop="articleBody">

      
          <p>Welcome to <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a target="_blank" rel="noopener" href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a target="_blank" rel="noopener" href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a target="_blank" rel="noopener" href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bash</span><br><span class="line">$ hexo <span class="keyword">new</span> <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>

      
    </div>

    
    
    

      
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://zihang.fun/2022/12/28/12-24/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="liu zihang">
      <meta itemprop="description" content="只有努力不会辜负你">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="枫叶冢">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/12/28/12-24/" class="post-title-link" itemprop="url">hive调优</a>
        </h2>

        <div class="post-meta">
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-12-28 09:46:03 / 修改时间：15:55:38" itemprop="dateCreated datePublished" datetime="2022-12-28T09:46:03+08:00">2022-12-28</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%97%A5%E5%BF%97/" itemprop="url" rel="index"><span itemprop="name">日志</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>31k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>28 分钟</span>
            </span>

        </div>
      </header>

    
    
    

   

    <div class="post-body" itemprop="articleBody">

      
          <h1 id="hive的内置function"><a href="#hive的内置function" class="headerlink" title="hive的内置function"></a>hive的内置function</h1><p>通过 <code>show functions</code>查看，命令总数以及名称</p>
<p>通过 <code>show functions like xxx</code>代表模糊查询</p>
<p>通过 <code>desc function extended xxxx方法名字</code> 查看方法如何使用</p>
<h2 id="时间函数"><a href="#时间函数" class="headerlink" title="时间函数"></a>时间函数</h2><p>current_date:它打印的是当前时间</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">hive</span> (default)&gt; select current_date;</span><br><span class="line"><span class="attribute">OK</span></span><br><span class="line"><span class="attribute">_c0</span></span><br><span class="line"><span class="attribute">2022</span>-<span class="number">12</span>-<span class="number">28</span></span><br><span class="line"><span class="attribute">Time</span> taken: <span class="number">5</span>.<span class="number">424</span> seconds, Fetched: <span class="number">1</span> row(s)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>current_timestamp:打印当前时间戳</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">hive</span> (default)&gt; select current_timestamp;</span><br><span class="line"><span class="attribute">OK</span></span><br><span class="line"><span class="attribute">_c0</span></span><br><span class="line"><span class="attribute">2022</span>-<span class="number">12</span>-<span class="number">28</span> <span class="number">09</span>:<span class="number">56</span>:<span class="number">56</span>.<span class="number">204</span></span><br><span class="line"><span class="attribute">Time</span> taken: <span class="number">0</span>.<span class="number">23</span> seconds, Fetched: <span class="number">1</span> row(s)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>unix_timestamp:把肉眼可见的时间格式转换成秒值，1970年到指定日子的秒值</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">hive (<span class="keyword">default</span>)&gt; <span class="keyword">desc</span> <span class="keyword">function</span> extended unix_timestamp;</span><br><span class="line">OK</span><br><span class="line">tab_name</span><br><span class="line">unix_timestamp(<span class="type">date</span>[, pattern]) - Converts the <span class="type">time</span> <span class="keyword">to</span> a number</span><br><span class="line">Converts the specified <span class="type">time</span> <span class="keyword">to</span> number <span class="keyword">of</span> seconds since <span class="number">1970</span><span class="number">-01</span><span class="number">-01.</span> The unix_timestamp(<span class="type">void</span>) overload <span class="keyword">is</span> deprecated, use <span class="built_in">current_timestamp</span>.</span><br><span class="line"><span class="keyword">Function</span> <span class="keyword">class</span>:org.apache.hadoop.hive.ql.udf.generic.GenericUDFUnixTimeStamp</span><br><span class="line"><span class="keyword">Function</span> <span class="keyword">type</span>:BUILTIN</span><br><span class="line"><span class="type">Time</span> taken: <span class="number">0.015</span> seconds, Fetched: <span class="number">4</span> <span class="keyword">row</span>(s)</span><br><span class="line"></span><br><span class="line"><span class="comment">---------------------------------------------------------------使用</span></span><br><span class="line">hive (<span class="keyword">default</span>)&gt; <span class="keyword">select</span> unix_timestamp()</span><br><span class="line">              &gt; ;</span><br><span class="line">unix_timestamp(<span class="type">void</span>) <span class="keyword">is</span> deprecated. Use <span class="built_in">current_timestamp</span> <span class="keyword">instead</span>.</span><br><span class="line">unix_timestamp(<span class="type">void</span>) <span class="keyword">is</span> deprecated. Use <span class="built_in">current_timestamp</span> <span class="keyword">instead</span>.</span><br><span class="line">OK</span><br><span class="line">_c0</span><br><span class="line"><span class="number">1672192863</span></span><br><span class="line"><span class="type">Time</span> taken: <span class="number">0.145</span> seconds, Fetched: <span class="number">1</span> <span class="keyword">row</span>(s)</span><br><span class="line"><span class="comment">------------------------------------------------------------------加参数</span></span><br><span class="line">hive (<span class="keyword">default</span>)&gt; <span class="keyword">select</span> unix_timestamp(<span class="string">&#x27;2022-12-28&#x27;</span>);</span><br><span class="line">OK</span><br><span class="line">_c0</span><br><span class="line"><span class="keyword">NULL</span></span><br><span class="line"><span class="type">Time</span> taken: <span class="number">0.146</span> seconds, Fetched: <span class="number">1</span> <span class="keyword">row</span>(s)</span><br><span class="line">hive (<span class="keyword">default</span>)&gt; <span class="keyword">select</span> unix_timestamp(<span class="string">&#x27;2022-12-28 12:00:00&#x27;</span>);</span><br><span class="line">OK</span><br><span class="line">_c0</span><br><span class="line"><span class="number">1672228800</span></span><br><span class="line"><span class="type">Time</span> taken: <span class="number">0.141</span> seconds, Fetched: <span class="number">1</span> <span class="keyword">row</span>(s)</span><br><span class="line">hive (<span class="keyword">default</span>)&gt; </span><br><span class="line">默认加参数的时候要YYYY-MM-dd HH:mm:ss 但是可以加格式 ，通过下述方法添加自定义格式</span><br><span class="line">hive (<span class="keyword">default</span>)&gt; <span class="keyword">select</span> unix_timestamp(<span class="string">&#x27;2022-12-28&#x27;</span>,<span class="string">&#x27;yyyy-MM-dd&#x27;</span>);</span><br><span class="line">OK</span><br><span class="line">_c0</span><br><span class="line"><span class="number">1672185600</span></span><br><span class="line"><span class="type">Time</span> taken: <span class="number">0.149</span> seconds, Fetched: <span class="number">1</span> <span class="keyword">row</span>(s)</span><br><span class="line">其最小的时间是<span class="number">8</span>点，并不是<span class="number">0</span>点</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>from_unixtime：把毫秒数转换成日期</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">hive (<span class="keyword">default</span>)<span class="operator">&gt;</span> <span class="keyword">desc</span> <span class="keyword">function</span> extended from_unixtime;</span><br><span class="line">OK</span><br><span class="line">tab_name</span><br><span class="line">from_unixtime(unix_time, format) <span class="operator">-</span> <span class="keyword">returns</span> unix_time <span class="keyword">in</span> the specified format</span><br><span class="line">Example:</span><br><span class="line">  <span class="operator">&gt;</span> <span class="keyword">SELECT</span> from_unixtime(<span class="number">0</span>, <span class="string">&#x27;yyyy-MM-dd HH:mm:ss&#x27;</span>) <span class="keyword">FROM</span> src LIMIT <span class="number">1</span>;</span><br><span class="line">  <span class="string">&#x27;1970-01-01 00:00:00&#x27;</span></span><br><span class="line"><span class="keyword">Function</span> class:org.apache.hadoop.hive.ql.udf.UDFFromUnixTime</span><br><span class="line"><span class="keyword">Function</span> type:BUILTIN</span><br><span class="line"><span class="type">Time</span> taken: <span class="number">0.016</span> seconds, Fetched: <span class="number">6</span> <span class="type">row</span>(s)</span><br><span class="line"><span class="comment">--------------------------------------------------------使用</span></span><br><span class="line">hive (<span class="keyword">default</span>)<span class="operator">&gt;</span> <span class="keyword">select</span> from_unixtime(<span class="number">1672193662</span>);</span><br><span class="line">OK</span><br><span class="line">_c0</span><br><span class="line"><span class="number">2022</span><span class="number">-12</span><span class="number">-28</span> <span class="number">02</span>:<span class="number">14</span>:<span class="number">22</span></span><br><span class="line"><span class="type">Time</span> taken: <span class="number">0.122</span> seconds, Fetched: <span class="number">1</span> <span class="type">row</span>(s)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>to_date：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">hive (<span class="keyword">default</span>)<span class="operator">&gt;</span> <span class="keyword">desc</span> <span class="keyword">function</span> extended to_date;</span><br><span class="line">OK</span><br><span class="line">tab_name</span><br><span class="line">to_date(expr) <span class="operator">-</span> Extracts the <span class="type">date</span> part <span class="keyword">of</span> the <span class="type">date</span> <span class="keyword">or</span> datetime expression expr</span><br><span class="line">Example:</span><br><span class="line">   <span class="operator">&gt;</span> <span class="keyword">SELECT</span> to_date(<span class="string">&#x27;2009-07-30 04:17:52&#x27;</span>) <span class="keyword">FROM</span> src LIMIT <span class="number">1</span>;</span><br><span class="line">  <span class="string">&#x27;2009-07-30&#x27;</span></span><br><span class="line"><span class="keyword">Function</span> class:org.apache.hadoop.hive.ql.udf.generic.GenericUDFDate</span><br><span class="line"><span class="keyword">Function</span> type:BUILTIN</span><br><span class="line"><span class="type">Time</span> taken: <span class="number">0.015</span> seconds, Fetched: <span class="number">6</span> <span class="type">row</span>(s)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>year:month:day:hour:minute等等 ，是取值日期中的一部分</p>
<p>quarter ：季度 &#x3D;》 q1,q2,q3,q4 &#x3D;&gt; 第几季度</p>
<p>默认是三个月一个季度</p>
<p>month_between : 两个日期差几个月</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">hive (<span class="keyword">default</span>)<span class="operator">&gt;</span> <span class="keyword">desc</span> <span class="keyword">function</span> extended months_between;</span><br><span class="line">OK</span><br><span class="line">tab_name</span><br><span class="line">months_between(date1, date2, roundOff) <span class="operator">-</span> <span class="keyword">returns</span> number <span class="keyword">of</span> months <span class="keyword">between</span> dates date1 <span class="keyword">and</span> date2</span><br><span class="line">If date1 <span class="keyword">is</span> later than date2, <span class="keyword">then</span> the <span class="keyword">result</span> <span class="keyword">is</span> positive. If date1 <span class="keyword">is</span> earlier than date2, <span class="keyword">then</span> the <span class="keyword">result</span> <span class="keyword">is</span> negative. If date1 <span class="keyword">and</span> date2 <span class="keyword">are</span> either the same days <span class="keyword">of</span> the <span class="keyword">month</span> <span class="keyword">or</span> <span class="keyword">both</span> <span class="keyword">last</span> days <span class="keyword">of</span> months, <span class="keyword">then</span> the <span class="keyword">result</span> <span class="keyword">is</span> always an integer. Otherwise the UDF calculates the fractional <span class="keyword">portion</span> <span class="keyword">of</span> the <span class="keyword">result</span> based <span class="keyword">on</span> a <span class="number">31</span><span class="operator">-</span><span class="keyword">day</span> <span class="keyword">month</span> <span class="keyword">and</span> considers the difference <span class="keyword">in</span> <span class="type">time</span> components date1 <span class="keyword">and</span> date2.</span><br><span class="line">date1 <span class="keyword">and</span> date2 type can be <span class="type">date</span>, <span class="type">timestamp</span> <span class="keyword">or</span> string <span class="keyword">in</span> the format <span class="string">&#x27;yyyy-MM-dd&#x27;</span> <span class="keyword">or</span> <span class="string">&#x27;yyyy-MM-dd HH:mm:ss&#x27;</span>. The <span class="keyword">result</span> <span class="keyword">is</span> rounded <span class="keyword">to</span> <span class="number">8</span> <span class="type">decimal</span> places <span class="keyword">by</span> default. <span class="keyword">Set</span> roundOff<span class="operator">=</span><span class="literal">false</span> otherwise.</span><br><span class="line"> Example:</span><br><span class="line">  <span class="operator">&gt;</span> <span class="keyword">SELECT</span> months_between(<span class="string">&#x27;1997-02-28 10:30:00&#x27;</span>, <span class="string">&#x27;1996-10-30&#x27;</span>);</span><br><span class="line"> <span class="number">3.94959677</span></span><br><span class="line"><span class="keyword">Function</span> class:org.apache.hadoop.hive.ql.udf.generic.GenericUDFMonthsBetween</span><br><span class="line"><span class="keyword">Function</span> type:BUILTIN</span><br><span class="line"><span class="type">Time</span> taken: <span class="number">0.016</span> seconds, Fetched: <span class="number">8</span> <span class="type">row</span>(s)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>add_months:当前日期往后加几个月，可以加正数，也可以加负数</p>
<figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">hive (<span class="keyword">default</span>)&gt; desc <span class="keyword">function</span> extended add_months;</span><br><span class="line">OK</span><br><span class="line">tab_name</span><br><span class="line">add_months(start_date, num_months, output_date_format) - Returns the <span class="type">date</span> that <span class="built_in">is</span> num_months after start_date.</span><br><span class="line">start_date <span class="built_in">is</span> a <span class="type">string</span> <span class="built_in">or</span> timestamp indicating a valid <span class="type">date</span>. num_months <span class="built_in">is</span> a number. output_date_format <span class="built_in">is</span> an <span class="keyword">optional</span> <span class="type">String</span> which specifies the format <span class="keyword">for</span> output.</span><br><span class="line">The <span class="keyword">default</span> output format <span class="built_in">is</span> <span class="comment">&#x27;YYYY-MM-dd&#x27;.</span></span><br><span class="line"><span class="symbol">Example:</span></span><br><span class="line">  &gt; <span class="keyword">SELECT</span> add_months(<span class="comment">&#x27;2009-08-31&#x27;, 1) FROM src LIMIT 1;</span></span><br><span class="line"> <span class="comment">&#x27;2009-09-30&#x27;.</span></span><br><span class="line">  &gt; <span class="keyword">SELECT</span> add_months(<span class="comment">&#x27;2017-12-31 14:15:16&#x27;, 2, &#x27;YYYY-MM-dd HH:mm:ss&#x27;) LIMIT 1;</span></span><br><span class="line"><span class="comment">&#x27;2018-02-28 14:15:16&#x27;.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Function</span> <span class="keyword">class</span>:org.apache.hadoop.hive.ql.udf.generic.GenericUDFAddMonths</span><br><span class="line"><span class="keyword">Function</span> type:BUILTIN</span><br><span class="line">Time taken: <span class="number">0.014</span> seconds, Fetched: <span class="number">11</span> row(s)</span><br></pre></td></tr></table></figure>

<p>datediff:两个日期相差几天：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">hive (<span class="keyword">default</span>)<span class="operator">&gt;</span> <span class="keyword">desc</span> <span class="keyword">function</span> extended datediff;</span><br><span class="line">OK</span><br><span class="line">tab_name</span><br><span class="line">datediff(date1, date2) <span class="operator">-</span> <span class="keyword">Returns</span> the number <span class="keyword">of</span> days <span class="keyword">between</span> date1 <span class="keyword">and</span> date2</span><br><span class="line">date1 <span class="keyword">and</span> date2 <span class="keyword">are</span> strings <span class="keyword">in</span> the format <span class="string">&#x27;yyyy-MM-dd HH:mm:ss&#x27;</span> <span class="keyword">or</span> <span class="string">&#x27;yyyy-MM-dd&#x27;</span>. The <span class="type">time</span> parts <span class="keyword">are</span> ignored.If date1 <span class="keyword">is</span> earlier than date2, the <span class="keyword">result</span> <span class="keyword">is</span> negative.</span><br><span class="line">Example:</span><br><span class="line">   <span class="operator">&gt;</span> <span class="keyword">SELECT</span> datediff(<span class="string">&#x27;2009-07-30&#x27;</span>, <span class="string">&#x27;2009-07-31&#x27;</span>) <span class="keyword">FROM</span> src LIMIT <span class="number">1</span>;</span><br><span class="line">  <span class="number">1</span></span><br><span class="line"><span class="keyword">Function</span> class:org.apache.hadoop.hive.ql.udf.generic.GenericUDFDateDiff</span><br><span class="line"><span class="keyword">Function</span> type:BUILTIN</span><br><span class="line"><span class="type">Time</span> taken: <span class="number">0.025</span> seconds, Fetched: <span class="number">7</span> <span class="type">row</span>(s)</span><br><span class="line">hive (<span class="keyword">default</span>)<span class="operator">&gt;</span> </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>date_add:数字可以变成-1的</p>
<figure class="highlight vhdl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">hive (<span class="keyword">default</span>)&gt; desc <span class="keyword">function</span> extended date_add;</span><br><span class="line">OK</span><br><span class="line">tab_name</span><br><span class="line">date_add(start_date, num_days) - Returns the date that <span class="keyword">is</span> num_days <span class="keyword">after</span> start_date.</span><br><span class="line">start_date <span class="keyword">is</span> a <span class="built_in">string</span> <span class="keyword">in</span> the format <span class="symbol">&#x27;yyyy</span>-MM-dd HH:mm:ss&#x27; <span class="keyword">or</span> <span class="symbol">&#x27;yyyy</span>-MM-dd&#x27;. num_days <span class="keyword">is</span> a number. The <span class="built_in">time</span> part <span class="keyword">of</span> start_date <span class="keyword">is</span> ignored.</span><br><span class="line">Example:</span><br><span class="line">   &gt; <span class="keyword">SELECT</span> date_add(&#x27;<span class="number">2009</span>-<span class="number">07</span>-<span class="number">30</span>&#x27;, <span class="number">1</span>) FROM src LIMIT <span class="number">1</span>;</span><br><span class="line">  &#x27;<span class="number">2009</span>-<span class="number">07</span>-<span class="number">31</span>&#x27;</span><br><span class="line"><span class="keyword">Function</span> class:org.apache.hadoop.hive.ql.udf.<span class="keyword">generic</span>.GenericUDFDateAdd</span><br><span class="line"><span class="keyword">Function</span> <span class="keyword">type</span>:BUILTIN</span><br><span class="line"><span class="built_in">Time</span> taken: <span class="number">0.014</span> seconds, Fetched: <span class="number">7</span> row(s)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>last_day:有类型限制</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">hive (<span class="keyword">default</span>)<span class="operator">&gt;</span> <span class="keyword">desc</span> <span class="keyword">function</span> extended last_day;</span><br><span class="line">OK</span><br><span class="line">tab_name</span><br><span class="line">last_day(<span class="type">date</span>) <span class="operator">-</span> <span class="keyword">Returns</span> the <span class="keyword">last</span> <span class="keyword">day</span> <span class="keyword">of</span> the <span class="keyword">month</span> which the <span class="type">date</span> belongs to.</span><br><span class="line"><span class="type">date</span> <span class="keyword">is</span> a string <span class="keyword">in</span> the format <span class="string">&#x27;yyyy-MM-dd HH:mm:ss&#x27;</span> <span class="keyword">or</span> <span class="string">&#x27;yyyy-MM-dd&#x27;</span>. The <span class="type">time</span> part <span class="keyword">of</span> <span class="type">date</span> <span class="keyword">is</span> ignored.</span><br><span class="line">Example:</span><br><span class="line">  <span class="operator">&gt;</span> <span class="keyword">SELECT</span> last_day(<span class="string">&#x27;2009-01-12&#x27;</span>) <span class="keyword">FROM</span> src LIMIT <span class="number">1</span>;</span><br><span class="line"> <span class="string">&#x27;2009-01-31&#x27;</span></span><br><span class="line"><span class="keyword">Function</span> class:org.apache.hadoop.hive.ql.udf.generic.GenericUDFLastDay</span><br><span class="line"><span class="keyword">Function</span> type:BUILTIN</span><br><span class="line"><span class="type">Time</span> taken: <span class="number">0.015</span> seconds, Fetched: <span class="number">7</span> <span class="type">row</span>(s)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>日期格式 ： date_foermat &#x3D;&gt;重要</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">hive (<span class="keyword">default</span>)&gt; <span class="keyword">desc</span> <span class="keyword">function</span> extended date_format;</span><br><span class="line">OK</span><br><span class="line">tab_name</span><br><span class="line">date_format(<span class="type">date</span>/<span class="type">timestamp</span>/string, fmt) - converts a <span class="type">date</span>/<span class="type">timestamp</span>/string <span class="keyword">to</span> a <span class="keyword">value</span> <span class="keyword">of</span> string <span class="keyword">in</span> the <span class="keyword">format</span> specified <span class="keyword">by</span> the <span class="type">date</span> <span class="keyword">format</span> fmt.</span><br><span class="line">Supported formats are SimpleDateFormat formats - https://docs.oracle.com/javase/<span class="number">7</span>/docs/api/java/<span class="type">text</span>/SimpleDateFormat.html. Second argument fmt should be <span class="keyword">constant</span>.</span><br><span class="line">Example: &gt; <span class="keyword">SELECT</span> date_format(<span class="string">&#x27;2015-04-08&#x27;</span>, <span class="string">&#x27;y&#x27;</span>);</span><br><span class="line"> <span class="string">&#x27;2015&#x27;</span></span><br><span class="line"><span class="keyword">Function</span> <span class="keyword">class</span>:org.apache.hadoop.hive.ql.udf.generic.GenericUDFDateFormat</span><br><span class="line"><span class="keyword">Function</span> <span class="keyword">type</span>:BUILTIN</span><br><span class="line"><span class="type">Time</span> taken: <span class="number">0.014</span> seconds, Fetched: <span class="number">6</span> <span class="keyword">row</span>(s)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>内置的时间函数大体over</p>
<h2 id="算数相关的函数"><a href="#算数相关的函数" class="headerlink" title="算数相关的函数"></a>算数相关的函数</h2><p>round：小数点后面几位</p>
<figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">hive (<span class="keyword">default</span>)&gt; desc <span class="keyword">function</span> extended round;</span><br><span class="line">OK</span><br><span class="line">tab_name</span><br><span class="line">round(x[, d]) - round x <span class="keyword">to</span> d <span class="type">decimal</span> places</span><br><span class="line"><span class="symbol">Example:</span></span><br><span class="line">  &gt; <span class="keyword">SELECT</span> round(<span class="number">12.3456</span>, <span class="number">1</span>) <span class="keyword">FROM</span> src LIMIT <span class="number">1</span>;</span><br><span class="line">  <span class="number">12.3</span><span class="comment">&#x27;</span></span><br><span class="line"><span class="keyword">Function</span> <span class="keyword">class</span>:org.apache.hadoop.hive.ql.udf.generic.GenericUDFRound</span><br><span class="line"><span class="keyword">Function</span> type:BUILTIN</span><br><span class="line">Time taken: <span class="number">0.021</span> seconds, Fetched: <span class="number">6</span> row(s)</span><br></pre></td></tr></table></figure>

<p>ceil ： 取整 ，就是返回一个最小的整数，向上取整</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">hive (<span class="keyword">default</span>)<span class="operator">&gt;</span> <span class="keyword">desc</span> <span class="keyword">function</span> extended ceil;</span><br><span class="line">OK</span><br><span class="line">tab_name</span><br><span class="line"><span class="built_in">ceil</span>(x) <span class="operator">-</span> Find the smallest <span class="type">integer</span> <span class="keyword">not</span> smaller than x</span><br><span class="line">Synonyms: ceiling</span><br><span class="line">Example:</span><br><span class="line">  <span class="operator">&gt;</span> <span class="keyword">SELECT</span> <span class="built_in">ceil</span>(<span class="number">-0.1</span>) <span class="keyword">FROM</span> src LIMIT <span class="number">1</span>;</span><br><span class="line">  <span class="number">0</span></span><br><span class="line">  <span class="operator">&gt;</span> <span class="keyword">SELECT</span> <span class="built_in">ceil</span>(<span class="number">5</span>) <span class="keyword">FROM</span> src LIMIT <span class="number">1</span>;</span><br><span class="line">  <span class="number">5</span></span><br><span class="line"><span class="keyword">Function</span> class:org.apache.hadoop.hive.ql.udf.generic.GenericUDFCeil</span><br><span class="line"><span class="keyword">Function</span> type:BUILTIN</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>floor：向下取整</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">hive (<span class="keyword">default</span>)<span class="operator">&gt;</span> <span class="keyword">desc</span> <span class="keyword">function</span> extended floor;</span><br><span class="line">OK</span><br><span class="line">tab_name</span><br><span class="line"><span class="built_in">floor</span>(x) <span class="operator">-</span> Find the largest <span class="type">integer</span> <span class="keyword">not</span> greater than x</span><br><span class="line">Example:</span><br><span class="line">  <span class="operator">&gt;</span> <span class="keyword">SELECT</span> <span class="built_in">floor</span>(<span class="number">-0.1</span>) <span class="keyword">FROM</span> src LIMIT <span class="number">1</span>;</span><br><span class="line">  <span class="number">-1</span></span><br><span class="line">  <span class="operator">&gt;</span> <span class="keyword">SELECT</span> <span class="built_in">floor</span>(<span class="number">5</span>) <span class="keyword">FROM</span> src LIMIT <span class="number">1</span>;</span><br><span class="line">  <span class="number">5</span></span><br><span class="line"><span class="keyword">Function</span> class:org.apache.hadoop.hive.ql.udf.generic.GenericUDFFloor</span><br><span class="line"><span class="keyword">Function</span> type:BUILTIN</span><br><span class="line"><span class="type">Time</span> taken: <span class="number">0.016</span> seconds, Fetched: <span class="number">8</span> <span class="type">row</span>(s)</span><br></pre></td></tr></table></figure>

<p>rand：随机数</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">hive (<span class="keyword">default</span>)&gt; <span class="keyword">desc</span> <span class="keyword">function</span> extended rand;</span><br><span class="line">OK</span><br><span class="line">tab_name</span><br><span class="line">rand([seed]) - <span class="keyword">Returns</span> a pseudorandom number <span class="keyword">between</span> <span class="number">0</span> <span class="keyword">and</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">Function</span> <span class="keyword">class</span>:org.apache.hadoop.hive.ql.udf.UDFRand</span><br><span class="line"><span class="keyword">Function</span> <span class="keyword">type</span>:BUILTIN</span><br><span class="line"><span class="type">Time</span> taken: <span class="number">0.016</span> seconds, Fetched: <span class="number">3</span> <span class="keyword">row</span>(s)</span><br></pre></td></tr></table></figure>

<h2 id="字符串相关的"><a href="#字符串相关的" class="headerlink" title="字符串相关的"></a>字符串相关的</h2><p>upper，lower,length</p>
<p>length:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">hive (<span class="keyword">default</span>)<span class="operator">&gt;</span> <span class="keyword">desc</span> <span class="keyword">function</span> extended length;</span><br><span class="line">OK</span><br><span class="line">tab_name</span><br><span class="line">length(str <span class="operator">|</span> <span class="type">binary</span>) <span class="operator">-</span> <span class="keyword">Returns</span> the length <span class="keyword">of</span> str <span class="keyword">or</span> number <span class="keyword">of</span> bytes <span class="keyword">in</span> <span class="type">binary</span> data</span><br><span class="line">Example:</span><br><span class="line">  <span class="operator">&gt;</span> <span class="keyword">SELECT</span> length(<span class="string">&#x27;Facebook&#x27;</span>) <span class="keyword">FROM</span> src LIMIT <span class="number">1</span>;</span><br><span class="line">  <span class="number">8</span></span><br><span class="line"><span class="keyword">Function</span> class:org.apache.hadoop.hive.ql.udf.generic.GenericUDFLength</span><br><span class="line"><span class="keyword">Function</span> type:BUILTIN</span><br><span class="line"><span class="type">Time</span> taken: <span class="number">0.014</span> seconds, Fetched: <span class="number">6</span> <span class="type">row</span>(s)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>trim:去除前后空格</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">hive (<span class="keyword">default</span>)<span class="operator">&gt;</span> <span class="keyword">desc</span> <span class="keyword">function</span> extended trim;</span><br><span class="line">OK</span><br><span class="line">tab_name</span><br><span class="line"><span class="built_in">trim</span>(str) <span class="operator">-</span> Removes the <span class="keyword">leading</span> <span class="keyword">and</span> <span class="keyword">trailing</span> space characters <span class="keyword">from</span> str </span><br><span class="line">Example:</span><br><span class="line">  <span class="operator">&gt;</span> <span class="keyword">SELECT</span> <span class="built_in">trim</span>(<span class="string">&#x27;   facebook  &#x27;</span>) <span class="keyword">FROM</span> src LIMIT <span class="number">1</span>;</span><br><span class="line">  <span class="string">&#x27;facebook&#x27;</span></span><br><span class="line"><span class="keyword">Function</span> class:org.apache.hadoop.hive.ql.udf.generic.GenericUDFTrim</span><br><span class="line"><span class="keyword">Function</span> type:BUILTIN</span><br><span class="line"><span class="type">Time</span> taken: <span class="number">0.014</span> seconds, Fetched: <span class="number">6</span> <span class="type">row</span>(s)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>upper:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">hive (<span class="keyword">default</span>)<span class="operator">&gt;</span> <span class="keyword">desc</span> <span class="keyword">function</span> extended upper;</span><br><span class="line">OK</span><br><span class="line">tab_name</span><br><span class="line"><span class="built_in">upper</span>(str) <span class="operator">-</span> <span class="keyword">Returns</span> str <span class="keyword">with</span> <span class="keyword">all</span> characters changed <span class="keyword">to</span> uppercase</span><br><span class="line">Synonyms: ucase</span><br><span class="line">Example:</span><br><span class="line">  <span class="operator">&gt;</span> <span class="keyword">SELECT</span> <span class="built_in">upper</span>(<span class="string">&#x27;Facebook&#x27;</span>) <span class="keyword">FROM</span> src LIMIT <span class="number">1</span>;</span><br><span class="line">  <span class="string">&#x27;FACEBOOK&#x27;</span></span><br><span class="line"><span class="keyword">Function</span> class:org.apache.hadoop.hive.ql.udf.generic.GenericUDFUpper</span><br><span class="line"><span class="keyword">Function</span> type:BUILTIN</span><br><span class="line"><span class="type">Time</span> taken: <span class="number">0.018</span> seconds, Fetched: <span class="number">7</span> <span class="type">row</span>(s)</span><br></pre></td></tr></table></figure>

<p>lower:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">hive (<span class="keyword">default</span>)<span class="operator">&gt;</span> <span class="keyword">desc</span> <span class="keyword">function</span> extended lower;</span><br><span class="line">OK</span><br><span class="line">tab_name</span><br><span class="line"><span class="built_in">lower</span>(str) <span class="operator">-</span> <span class="keyword">Returns</span> str <span class="keyword">with</span> <span class="keyword">all</span> characters changed <span class="keyword">to</span> lowercase</span><br><span class="line">Synonyms: lcase</span><br><span class="line">Example:</span><br><span class="line">  <span class="operator">&gt;</span> <span class="keyword">SELECT</span> <span class="built_in">lower</span>(<span class="string">&#x27;Facebook&#x27;</span>) <span class="keyword">FROM</span> src LIMIT <span class="number">1</span>;</span><br><span class="line">  <span class="string">&#x27;facebook&#x27;</span></span><br><span class="line"><span class="keyword">Function</span> class:org.apache.hadoop.hive.ql.udf.generic.GenericUDFLower</span><br><span class="line"><span class="keyword">Function</span> type:BUILTIN</span><br><span class="line"><span class="type">Time</span> taken: <span class="number">0.013</span> seconds, Fetched: <span class="number">7</span> <span class="type">row</span>(s)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>lpad:左边补齐</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">hive (<span class="keyword">default</span>)<span class="operator">&gt;</span> <span class="keyword">desc</span> <span class="keyword">function</span> extended lpad;</span><br><span class="line">OK</span><br><span class="line">tab_name</span><br><span class="line">lpad(str, len, pad) <span class="operator">-</span> <span class="keyword">Returns</span> str, <span class="keyword">left</span><span class="operator">-</span>padded <span class="keyword">with</span> pad <span class="keyword">to</span> a length <span class="keyword">of</span> len</span><br><span class="line">If str <span class="keyword">is</span> longer than len, the <span class="keyword">return</span> <span class="keyword">value</span> <span class="keyword">is</span> shortened <span class="keyword">to</span> len characters.</span><br><span class="line"><span class="keyword">In</span> <span class="keyword">case</span> <span class="keyword">of</span> <span class="keyword">empty</span> pad string, the <span class="keyword">return</span> <span class="keyword">value</span> <span class="keyword">is</span> null.</span><br><span class="line">Example:</span><br><span class="line">  <span class="operator">&gt;</span> <span class="keyword">SELECT</span> lpad(<span class="string">&#x27;hi&#x27;</span>, <span class="number">5</span>, <span class="string">&#x27;??&#x27;</span>) <span class="keyword">FROM</span> src LIMIT <span class="number">1</span>;</span><br><span class="line">  <span class="string">&#x27;???hi&#x27;</span></span><br><span class="line">  <span class="operator">&gt;</span> <span class="keyword">SELECT</span> lpad(<span class="string">&#x27;hi&#x27;</span>, <span class="number">1</span>, <span class="string">&#x27;??&#x27;</span>) <span class="keyword">FROM</span> src LIMIT <span class="number">1</span>;</span><br><span class="line">  <span class="string">&#x27;h&#x27;</span></span><br><span class="line">  <span class="operator">&gt;</span> <span class="keyword">SELECT</span> lpad(<span class="string">&#x27;hi&#x27;</span>, <span class="number">5</span>, <span class="string">&#x27;&#x27;</span>) <span class="keyword">FROM</span> src LIMIT <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">null</span></span><br><span class="line"><span class="keyword">Function</span> class:org.apache.hadoop.hive.ql.udf.generic.GenericUDFLpad</span><br><span class="line"><span class="keyword">Function</span> type:BUILTIN</span><br><span class="line"><span class="type">Time</span> taken: <span class="number">0.012</span> seconds, Fetched: <span class="number">12</span> <span class="type">row</span>(s)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>rpad:右边补齐</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">hive (<span class="keyword">default</span>)<span class="operator">&gt;</span> <span class="keyword">desc</span> <span class="keyword">function</span> extended rpad;</span><br><span class="line">OK</span><br><span class="line">tab_name</span><br><span class="line">rpad(str, len, pad) <span class="operator">-</span> <span class="keyword">Returns</span> str, <span class="keyword">right</span><span class="operator">-</span>padded <span class="keyword">with</span> pad <span class="keyword">to</span> a length <span class="keyword">of</span> len</span><br><span class="line">If str <span class="keyword">is</span> longer than len, the <span class="keyword">return</span> <span class="keyword">value</span> <span class="keyword">is</span> shortened <span class="keyword">to</span> len characters.</span><br><span class="line"><span class="keyword">In</span> <span class="keyword">case</span> <span class="keyword">of</span> <span class="keyword">empty</span> pad string, the <span class="keyword">return</span> <span class="keyword">value</span> <span class="keyword">is</span> null.</span><br><span class="line">Example:</span><br><span class="line">  <span class="operator">&gt;</span> <span class="keyword">SELECT</span> rpad(<span class="string">&#x27;hi&#x27;</span>, <span class="number">5</span>, <span class="string">&#x27;??&#x27;</span>) <span class="keyword">FROM</span> src LIMIT <span class="number">1</span>;</span><br><span class="line">  <span class="string">&#x27;hi???&#x27;</span></span><br><span class="line">  <span class="operator">&gt;</span> <span class="keyword">SELECT</span> rpad(<span class="string">&#x27;hi&#x27;</span>, <span class="number">1</span>, <span class="string">&#x27;??&#x27;</span>) <span class="keyword">FROM</span> src LIMIT <span class="number">1</span>;</span><br><span class="line">  <span class="string">&#x27;h&#x27;</span></span><br><span class="line">  <span class="operator">&gt;</span> <span class="keyword">SELECT</span> rpad(<span class="string">&#x27;hi&#x27;</span>, <span class="number">5</span>, <span class="string">&#x27;&#x27;</span>) <span class="keyword">FROM</span> src LIMIT <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">null</span></span><br><span class="line"><span class="keyword">Function</span> class:org.apache.hadoop.hive.ql.udf.generic.GenericUDFRpad</span><br><span class="line"><span class="keyword">Function</span> type:BUILTIN</span><br><span class="line"><span class="type">Time</span> taken: <span class="number">0.013</span> seconds, Fetched: <span class="number">12</span> <span class="type">row</span>(s)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>replace:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">hive (<span class="keyword">default</span>)<span class="operator">&gt;</span> <span class="keyword">desc</span> <span class="keyword">function</span> extended replace;</span><br><span class="line">OK</span><br><span class="line">tab_name</span><br><span class="line">replace(str, <span class="keyword">search</span>, rep) <span class="operator">-</span> replace <span class="keyword">all</span> substrings <span class="keyword">of</span> <span class="string">&#x27;str&#x27;</span> that <span class="keyword">match</span> <span class="string">&#x27;search&#x27;</span> <span class="keyword">with</span> <span class="string">&#x27;rep&#x27;</span></span><br><span class="line">Example:</span><br><span class="line">  <span class="operator">&gt;</span> <span class="keyword">SELECT</span> replace(<span class="string">&#x27;Hack and Hue&#x27;</span>, <span class="string">&#x27;H&#x27;</span>, <span class="string">&#x27;BL&#x27;</span>) <span class="keyword">FROM</span> src LIMIT <span class="number">1</span>;</span><br><span class="line">  <span class="string">&#x27;BLack and BLue&#x27;</span></span><br><span class="line"><span class="keyword">Function</span> class:org.apache.hadoop.hive.ql.udf.UDFReplace</span><br><span class="line"><span class="keyword">Function</span> type:BUILTIN</span><br><span class="line"><span class="type">Time</span> taken: <span class="number">0.014</span> seconds, Fetched: <span class="number">6</span> <span class="type">row</span>(s)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>regexp_replace:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">hive (<span class="keyword">default</span>)<span class="operator">&gt;</span> <span class="keyword">desc</span> <span class="keyword">function</span> extended regexp_replace;</span><br><span class="line">OK</span><br><span class="line">tab_name</span><br><span class="line">regexp_replace(str, regexp, rep) <span class="operator">-</span> replace <span class="keyword">all</span> substrings <span class="keyword">of</span> str that <span class="keyword">match</span> regexp <span class="keyword">with</span> rep</span><br><span class="line">Example:</span><br><span class="line">  <span class="operator">&gt;</span> <span class="keyword">SELECT</span> regexp_replace(<span class="string">&#x27;100-200&#x27;</span>, <span class="string">&#x27;(\d+)&#x27;</span>, <span class="string">&#x27;num&#x27;</span>) <span class="keyword">FROM</span> src LIMIT <span class="number">1</span>;</span><br><span class="line">  <span class="string">&#x27;num-num&#x27;</span></span><br><span class="line"><span class="keyword">Function</span> class:org.apache.hadoop.hive.ql.udf.UDFRegExpReplace</span><br><span class="line"><span class="keyword">Function</span> type:BUILTIN</span><br><span class="line"><span class="type">Time</span> taken: <span class="number">0.013</span> seconds, Fetched: <span class="number">6</span> <span class="type">row</span>(s)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>substr:字符串截取</p>
<figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">hive (<span class="keyword">default</span>)&gt; desc <span class="keyword">function</span> extended substr;</span><br><span class="line">OK</span><br><span class="line">tab_name</span><br><span class="line">substr(str, pos[, len]) - returns the substring <span class="keyword">of</span> str that starts at pos <span class="built_in">and</span> <span class="built_in">is</span> <span class="keyword">of</span> length len orsubstr(bin, pos[, len]) - returns the slice <span class="keyword">of</span> <span class="type">byte</span> array that starts at pos <span class="built_in">and</span> <span class="built_in">is</span> <span class="keyword">of</span> length len</span><br><span class="line"><span class="symbol">Synonyms:</span> substring</span><br><span class="line">pos <span class="built_in">is</span> a <span class="number">1</span>-based index. <span class="keyword">If</span> pos&lt;<span class="number">0</span> the starting position <span class="built_in">is</span> determined <span class="keyword">by</span> counting backwards <span class="keyword">from</span> the <span class="keyword">end</span> <span class="keyword">of</span> str.</span><br><span class="line"><span class="symbol">Example:</span></span><br><span class="line">   &gt; <span class="keyword">SELECT</span> substr(<span class="comment">&#x27;Facebook&#x27;, 5) FROM src LIMIT 1;</span></span><br><span class="line">  <span class="comment">&#x27;book&#x27;</span></span><br><span class="line">  &gt; <span class="keyword">SELECT</span> substr(<span class="comment">&#x27;Facebook&#x27;, -5) FROM src LIMIT 1;</span></span><br><span class="line">  <span class="comment">&#x27;ebook&#x27;</span></span><br><span class="line">  &gt; <span class="keyword">SELECT</span> substr(<span class="comment">&#x27;Facebook&#x27;, 5, 1) FROM src LIMIT 1;</span></span><br><span class="line">  <span class="comment">&#x27;b&#x27;</span></span><br><span class="line"><span class="keyword">Function</span> <span class="keyword">class</span>:org.apache.hadoop.hive.ql.udf.UDFSubstr</span><br><span class="line"><span class="keyword">Function</span> type:BUILTIN</span><br><span class="line">Time taken: <span class="number">0.014</span> seconds, Fetched: <span class="number">12</span> row(s)</span><br></pre></td></tr></table></figure>

<p>concat：字符串拼接</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">hive (<span class="keyword">default</span>)<span class="operator">&gt;</span> <span class="keyword">desc</span> <span class="keyword">function</span> extended concat;</span><br><span class="line">OK</span><br><span class="line">tab_name</span><br><span class="line">concat(str1, str2, ... strN) <span class="operator">-</span> <span class="keyword">returns</span> the concatenation <span class="keyword">of</span> str1, str2, ... strN <span class="keyword">or</span> concat(bin1, bin2, ... binN) <span class="operator">-</span> <span class="keyword">returns</span> the concatenation <span class="keyword">of</span> bytes <span class="keyword">in</span> <span class="type">binary</span> data  bin1, bin2, ... binN</span><br><span class="line"><span class="keyword">Returns</span> <span class="keyword">NULL</span> if <span class="keyword">any</span> argument <span class="keyword">is</span> NULL.</span><br><span class="line">Example:</span><br><span class="line">  <span class="operator">&gt;</span> <span class="keyword">SELECT</span> concat(<span class="string">&#x27;abc&#x27;</span>, <span class="string">&#x27;def&#x27;</span>) <span class="keyword">FROM</span> src LIMIT <span class="number">1</span>;</span><br><span class="line">  <span class="string">&#x27;abcdef&#x27;</span></span><br><span class="line"><span class="keyword">Function</span> class:org.apache.hadoop.hive.ql.udf.generic.GenericUDFConcat</span><br><span class="line"><span class="keyword">Function</span> type:BUILTIN</span><br><span class="line"><span class="type">Time</span> taken: <span class="number">0.013</span> seconds, Fetched: <span class="number">7</span> <span class="type">row</span>(s)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>concat_ws:上个的高级版</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">hive (<span class="keyword">default</span>)<span class="operator">&gt;</span> <span class="keyword">desc</span> <span class="keyword">function</span> extended concat_ws;</span><br><span class="line">OK</span><br><span class="line">tab_name</span><br><span class="line">concat_ws(separator, [string <span class="operator">|</span> <span class="keyword">array</span>(string)]<span class="operator">+</span>) <span class="operator">-</span> <span class="keyword">returns</span> the concatenation <span class="keyword">of</span> the strings separated <span class="keyword">by</span> the separator.</span><br><span class="line">Example:</span><br><span class="line">  <span class="operator">&gt;</span> <span class="keyword">SELECT</span> concat_ws(<span class="string">&#x27;.&#x27;</span>, <span class="string">&#x27;www&#x27;</span>, <span class="keyword">array</span>(<span class="string">&#x27;facebook&#x27;</span>, <span class="string">&#x27;com&#x27;</span>)) <span class="keyword">FROM</span> src LIMIT <span class="number">1</span>;</span><br><span class="line">  <span class="string">&#x27;www.facebook.com&#x27;</span></span><br><span class="line"><span class="keyword">Function</span> class:org.apache.hadoop.hive.ql.udf.generic.GenericUDFConcatWS</span><br><span class="line"><span class="keyword">Function</span> type:BUILTIN</span><br><span class="line"><span class="type">Time</span> taken: <span class="number">0.013</span> seconds, Fetched: <span class="number">6</span> <span class="type">row</span>(s)</span><br><span class="line">hive (<span class="keyword">default</span>)<span class="operator">&gt;</span> </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>split：字符串分割</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">hive (<span class="keyword">default</span>)<span class="operator">&gt;</span> <span class="keyword">desc</span> <span class="keyword">function</span> extended split;</span><br><span class="line">OK</span><br><span class="line">tab_name</span><br><span class="line">split(str, regex) <span class="operator">-</span> Splits str around occurances that <span class="keyword">match</span> regex</span><br><span class="line">Example:</span><br><span class="line">  <span class="operator">&gt;</span> <span class="keyword">SELECT</span> split(<span class="string">&#x27;oneAtwoBthreeC&#x27;</span>, <span class="string">&#x27;[ABC]&#x27;</span>) <span class="keyword">FROM</span> src LIMIT <span class="number">1</span>;</span><br><span class="line">  [&quot;one&quot;, &quot;two&quot;, &quot;three&quot;]</span><br><span class="line"><span class="keyword">Function</span> class:org.apache.hadoop.hive.ql.udf.generic.GenericUDFSplit</span><br><span class="line"><span class="keyword">Function</span> type:BUILTIN</span><br><span class="line"><span class="type">Time</span> taken: <span class="number">0.015</span> seconds, Fetched: <span class="number">6</span> <span class="type">row</span>(s)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="json相关的数据处理"><a href="#json相关的数据处理" class="headerlink" title="json相关的数据处理"></a>json相关的数据处理</h2><p>get_json_object</p>
<figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">hive (<span class="keyword">default</span>)&gt; desc <span class="keyword">function</span> extended get_json_object;</span><br><span class="line">OK</span><br><span class="line">tab_name</span><br><span class="line">get_json_object(json_txt, path) - Extract a json <span class="type">object</span> <span class="keyword">from</span> path </span><br><span class="line">Extract json <span class="type">object</span> <span class="keyword">from</span> a json <span class="type">string</span> based <span class="keyword">on</span> json path specified, <span class="built_in">and</span> <span class="keyword">return</span> json <span class="type">string</span> <span class="keyword">of</span> the extracted json <span class="type">object</span>. It will <span class="keyword">return</span> null <span class="keyword">if</span> the input json <span class="type">string</span> <span class="built_in">is</span> invalid.</span><br><span class="line">A limited version <span class="keyword">of</span> JSONPath supported:</span><br><span class="line">  $   : Root <span class="type">object</span></span><br><span class="line">  .   : Child <span class="keyword">operator</span></span><br><span class="line">  []  : Subscript <span class="keyword">operator</span> <span class="keyword">for</span> array</span><br><span class="line">  *   : Wildcard <span class="keyword">for</span> []</span><br><span class="line">Syntax <span class="built_in">not</span> supported that<span class="comment">&#x27;s worth noticing:</span></span><br><span class="line">  <span class="comment">&#x27;&#x27;  : Zero length string as key</span></span><br><span class="line">  ..  : Recursive descent</span><br><span class="line">  @   : Current <span class="type">object</span>/element</span><br><span class="line">  ()  : Script expression</span><br><span class="line">  ?() : Filter (script) expression.</span><br><span class="line">  [,] : Union <span class="keyword">operator</span></span><br><span class="line">  [start:<span class="keyword">end</span>:<span class="keyword">step</span>] : array slice <span class="keyword">operator</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Function</span> <span class="keyword">class</span>:org.apache.hadoop.hive.ql.udf.UDFJson</span><br><span class="line"><span class="keyword">Function</span> type:BUILTIN</span><br><span class="line">Time taken: <span class="number">0.016</span> seconds, Fetched: <span class="number">18</span> row(s)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>json_tuple:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">hive (<span class="keyword">default</span>)<span class="operator">&gt;</span> <span class="keyword">desc</span> <span class="keyword">function</span> extended json_tuple;</span><br><span class="line">OK</span><br><span class="line">tab_name</span><br><span class="line">json_tuple(jsonStr, p1, p2, ..., pn) <span class="operator">-</span> <span class="keyword">like</span> get_json_object, but it takes multiple names <span class="keyword">and</span> <span class="keyword">return</span> a tuple. <span class="keyword">All</span> the input parameters <span class="keyword">and</span> output <span class="keyword">column</span> types <span class="keyword">are</span> string.</span><br><span class="line"><span class="keyword">Function</span> class:org.apache.hadoop.hive.ql.udf.generic.GenericUDTFJSONTuple</span><br><span class="line"><span class="keyword">Function</span> type:BUILTIN</span><br><span class="line"><span class="type">Time</span> taken: <span class="number">0.014</span> seconds, Fetched: <span class="number">3</span> <span class="type">row</span>(s)</span><br><span class="line"><span class="comment">----------------------------------------</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>例子：现在我的数据库里有如下数据：</p>
<figure class="highlight wren"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">hive</span> (<span class="variable">bigdata_hive3</span>)<span class="operator">&gt;</span> <span class="variable">select</span> <span class="operator">*</span> <span class="variable">from</span> <span class="variable">skill</span> <span class="variable">limit</span> <span class="number">10</span>;</span><br><span class="line"><span class="variable">OK</span></span><br><span class="line"><span class="variable">skill</span>.<span class="property">json</span></span><br><span class="line">[</span><br><span class="line">    <span class="literal">null</span>,</span><br><span class="line">    &#123; <span class="string">&quot;id&quot;</span>: <span class="number">1</span>, <span class="string">&quot;animationId&quot;</span>: <span class="number">1</span>, <span class="string">&quot;damage&quot;</span>: &#123; <span class="string">&quot;critical&quot;</span>: <span class="literal">true</span>, <span class="string">&quot;elementId&quot;</span>: <span class="number">-1</span>, <span class="string">&quot;formula&quot;</span>: <span class="string">&quot;a.atk * 4 - b.def * 2&quot;</span>, <span class="string">&quot;type&quot;</span>: <span class="number">1</span>, <span class="string">&quot;variance&quot;</span>: <span class="number">20</span> &#125;, <span class="string">&quot;description&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="string">&quot;effects&quot;</span>: [&#123; <span class="string">&quot;code&quot;</span>: <span class="number">21</span>, <span class="string">&quot;dataId&quot;</span>: <span class="number">0</span>, <span class="string">&quot;value1&quot;</span>: <span class="number">1</span>, <span class="string">&quot;value2&quot;</span>: <span class="number">0</span> &#125;], <span class="string">&quot;hitType&quot;</span>: <span class="number">1</span>, <span class="string">&quot;iconIndex&quot;</span>: <span class="number">880</span>, <span class="string">&quot;message1&quot;</span>: <span class="string">&quot;%1的攻击！&quot;</span>, <span class="string">&quot;message2&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="string">&quot;mpCost&quot;</span>: <span class="number">0</span>, <span class="string">&quot;name&quot;</span>: <span class="string">&quot;攻击&quot;</span>, <span class="string">&quot;note&quot;</span>: <span class="string">&quot;1 号技能会在选择“攻击”指令时使用。<span class="char escape_">\n</span><span class="char escape_">\n</span>&lt;setup action&gt;<span class="char escape_">\n</span>display action<span class="char escape_">\n</span>immortal: targets, true<span class="char escape_">\n</span>&lt;/setup action&gt;<span class="char escape_">\n</span><span class="char escape_">\n</span>&lt;target action&gt;<span class="char escape_">\n</span>if user.attackMotion() !== &#x27;missile&#x27;<span class="char escape_">\n</span>move user: targets, front, 20<span class="char escape_">\n</span>else<span class="char escape_">\n</span>perform start<span class="char escape_">\n</span>end<span class="char escape_">\n</span>wait for movement<span class="char escape_">\n</span>motion attack: user<span class="char escape_">\n</span><span class="char escape_">\n</span>attack animation: target<span class="char escape_">\n</span>wait for animation<span class="char escape_">\n</span>action effect<span class="char escape_">\n</span>&lt;/target action&gt;&quot;</span>, <span class="string">&quot;occasion&quot;</span>: <span class="number">1</span>, <span class="string">&quot;repeats&quot;</span>: <span class="number">1</span>, <span class="string">&quot;requiredWtypeId1&quot;</span>: <span class="number">0</span>, <span class="string">&quot;requiredWtypeId2&quot;</span>: <span class="number">0</span>, <span class="string">&quot;scope&quot;</span>: <span class="number">1</span>, <span class="string">&quot;speed&quot;</span>: <span class="number">0</span>, <span class="string">&quot;stypeId&quot;</span>: <span class="number">0</span>, <span class="string">&quot;successRate&quot;</span>: <span class="number">100</span>, <span class="string">&quot;tpCost&quot;</span>: <span class="number">0</span>, <span class="string">&quot;tpGain&quot;</span>: <span class="number">10</span>, <span class="string">&quot;messageType&quot;</span>: <span class="number">1</span> &#125;,</span><br><span class="line">    &#123; <span class="string">&quot;id&quot;</span>: <span class="number">2</span>, <span class="string">&quot;animationId&quot;</span>: <span class="number">0</span>, <span class="string">&quot;damage&quot;</span>: &#123; <span class="string">&quot;critical&quot;</span>: <span class="literal">false</span>, <span class="string">&quot;elementId&quot;</span>: <span class="number">0</span>, <span class="string">&quot;formula&quot;</span>: <span class="string">&quot;0&quot;</span>, <span class="string">&quot;type&quot;</span>: <span class="number">0</span>, <span class="string">&quot;variance&quot;</span>: <span class="number">20</span> &#125;, <span class="string">&quot;description&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="string">&quot;effects&quot;</span>: [&#123; <span class="string">&quot;code&quot;</span>: <span class="number">21</span>, <span class="string">&quot;dataId&quot;</span>: <span class="number">2</span>, <span class="string">&quot;value1&quot;</span>: <span class="number">1</span>, <span class="string">&quot;value2&quot;</span>: <span class="number">0</span> &#125;], <span class="string">&quot;hitType&quot;</span>: <span class="number">0</span>, <span class="string">&quot;iconIndex&quot;</span>: <span class="number">688</span>, <span class="string">&quot;message1&quot;</span>: <span class="string">&quot;%1正在保护自己。&quot;</span>, <span class="string">&quot;message2&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="string">&quot;mpCost&quot;</span>: <span class="number">0</span>, <span class="string">&quot;name&quot;</span>: <span class="string">&quot;防御&quot;</span>, <span class="string">&quot;note&quot;</span>: <span class="string">&quot;1 号技能会在选择“防御”指令时使用。&quot;</span>, <span class="string">&quot;occasion&quot;</span>: <span class="number">1</span>, <span class="string">&quot;repeats&quot;</span>: <span class="number">1</span>, <span class="string">&quot;requiredWtypeId1&quot;</span>: <span class="number">0</span>, <span class="string">&quot;requiredWtypeId2&quot;</span>: <span class="number">0</span>, <span class="string">&quot;scope&quot;</span>: <span class="number">11</span>, <span class="string">&quot;speed&quot;</span>: <span class="number">10</span>, <span class="string">&quot;stypeId&quot;</span>: <span class="number">0</span>, <span class="string">&quot;successRate&quot;</span>: <span class="number">100</span>, <span class="string">&quot;tpCost&quot;</span>: <span class="number">0</span>, <span class="string">&quot;tpGain&quot;</span>: <span class="number">10</span>, <span class="string">&quot;messageType&quot;</span>: <span class="number">1</span> &#125;,</span><br><span class="line">    &#123; <span class="string">&quot;id&quot;</span>: <span class="number">3</span>, <span class="string">&quot;animationId&quot;</span>: <span class="number">-1</span>, <span class="string">&quot;damage&quot;</span>: &#123; <span class="string">&quot;critical&quot;</span>: <span class="literal">true</span>, <span class="string">&quot;elementId&quot;</span>: <span class="number">-1</span>, <span class="string">&quot;formula&quot;</span>: <span class="string">&quot;a.atk * 4 - b.def * 2&quot;</span>, <span class="string">&quot;type&quot;</span>: <span class="number">1</span>, <span class="string">&quot;variance&quot;</span>: <span class="number">20</span> &#125;, <span class="string">&quot;description&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="string">&quot;effects&quot;</span>: [&#123; <span class="string">&quot;code&quot;</span>: <span class="number">21</span>, <span class="string">&quot;dataId&quot;</span>: <span class="number">0</span>, <span class="string">&quot;value1&quot;</span>: <span class="number">1</span>, <span class="string">&quot;value2&quot;</span>: <span class="number">0</span> &#125;], <span class="string">&quot;hitType&quot;</span>: <span class="number">1</span>, <span class="string">&quot;iconIndex&quot;</span>: <span class="number">880</span>, <span class="string">&quot;message1&quot;</span>: <span class="string">&quot;%1的攻击！&quot;</span>, <span class="string">&quot;message2&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="string">&quot;mpCost&quot;</span>: <span class="number">0</span>, <span class="string">&quot;name&quot;</span>: <span class="string">&quot;连续攻击&quot;</span>, <span class="string">&quot;note&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="string">&quot;occasion&quot;</span>: <span class="number">1</span>, <span class="string">&quot;repeats&quot;</span>: <span class="number">2</span>, <span class="string">&quot;requiredWtypeId1&quot;</span>: <span class="number">0</span>, <span class="string">&quot;requiredWtypeId2&quot;</span>: <span class="number">0</span>, <span class="string">&quot;scope&quot;</span>: <span class="number">1</span>, <span class="string">&quot;speed&quot;</span>: <span class="number">0</span>, <span class="string">&quot;stypeId&quot;</span>: <span class="number">2</span>, <span class="string">&quot;successRate&quot;</span>: <span class="number">100</span>, <span class="string">&quot;tpCost&quot;</span>: <span class="number">0</span>, <span class="string">&quot;tpGain&quot;</span>: <span class="number">5</span>, <span class="string">&quot;messageType&quot;</span>: <span class="number">1</span> &#125;,</span><br><span class="line">    &#123; <span class="string">&quot;id&quot;</span>: <span class="number">4</span>, <span class="string">&quot;animationId&quot;</span>: <span class="number">-1</span>, <span class="string">&quot;damage&quot;</span>: &#123; <span class="string">&quot;critical&quot;</span>: <span class="literal">true</span>, <span class="string">&quot;elementId&quot;</span>: <span class="number">-1</span>, <span class="string">&quot;formula&quot;</span>: <span class="string">&quot;a.atk * 4 - b.def * 2&quot;</span>, <span class="string">&quot;type&quot;</span>: <span class="number">1</span>, <span class="string">&quot;variance&quot;</span>: <span class="number">20</span> &#125;, <span class="string">&quot;description&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="string">&quot;effects&quot;</span>: [&#123; <span class="string">&quot;code&quot;</span>: <span class="number">21</span>, <span class="string">&quot;dataId&quot;</span>: <span class="number">0</span>, <span class="string">&quot;value1&quot;</span>: <span class="number">1</span>, <span class="string">&quot;value2&quot;</span>: <span class="number">0</span> &#125;], <span class="string">&quot;hitType&quot;</span>: <span class="number">1</span>, <span class="string">&quot;iconIndex&quot;</span>: <span class="number">880</span>, <span class="string">&quot;message1&quot;</span>: <span class="string">&quot;%1的攻击！&quot;</span>, <span class="string">&quot;message2&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="string">&quot;mpCost&quot;</span>: <span class="number">0</span>, <span class="string">&quot;name&quot;</span>: <span class="string">&quot;两次攻击&quot;</span>, <span class="string">&quot;note&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="string">&quot;occasion&quot;</span>: <span class="number">1</span>, <span class="string">&quot;repeats&quot;</span>: <span class="number">1</span>, <span class="string">&quot;requiredWtypeId1&quot;</span>: <span class="number">0</span>, <span class="string">&quot;requiredWtypeId2&quot;</span>: <span class="number">0</span>, <span class="string">&quot;scope&quot;</span>: <span class="number">4</span>, <span class="string">&quot;speed&quot;</span>: <span class="number">0</span>, <span class="string">&quot;stypeId&quot;</span>: <span class="number">0</span>, <span class="string">&quot;successRate&quot;</span>: <span class="number">100</span>, <span class="string">&quot;tpCost&quot;</span>: <span class="number">0</span>, <span class="string">&quot;tpGain&quot;</span>: <span class="number">5</span>, <span class="string">&quot;messageType&quot;</span>: <span class="number">1</span> &#125;,</span><br><span class="line">    &#123; <span class="string">&quot;id&quot;</span>: <span class="number">5</span>, <span class="string">&quot;animationId&quot;</span>: <span class="number">-1</span>, <span class="string">&quot;damage&quot;</span>: &#123; <span class="string">&quot;critical&quot;</span>: <span class="literal">true</span>, <span class="string">&quot;elementId&quot;</span>: <span class="number">-1</span>, <span class="string">&quot;formula&quot;</span>: <span class="string">&quot;a.atk * 4 - b.def * 2&quot;</span>, <span class="string">&quot;type&quot;</span>: <span class="number">1</span>, <span class="string">&quot;variance&quot;</span>: <span class="number">20</span> &#125;, <span class="string">&quot;description&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="string">&quot;effects&quot;</span>: [&#123; <span class="string">&quot;code&quot;</span>: <span class="number">21</span>, <span class="string">&quot;dataId&quot;</span>: <span class="number">0</span>, <span class="string">&quot;value1&quot;</span>: <span class="number">1</span>, <span class="string">&quot;value2&quot;</span>: <span class="number">0</span> &#125;], <span class="string">&quot;hitType&quot;</span>: <span class="number">1</span>, <span class="string">&quot;iconIndex&quot;</span>: <span class="number">849</span>, <span class="string">&quot;message1&quot;</span>: <span class="string">&quot;%1的攻击！&quot;</span>, <span class="string">&quot;message2&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="string">&quot;mpCost&quot;</span>: <span class="number">0</span>, <span class="string">&quot;name&quot;</span>: <span class="string">&quot;三次攻击&quot;</span>, <span class="string">&quot;note&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="string">&quot;occasion&quot;</span>: <span class="number">1</span>, <span class="string">&quot;repeats&quot;</span>: <span class="number">1</span>, <span class="string">&quot;requiredWtypeId1&quot;</span>: <span class="number">0</span>, <span class="string">&quot;requiredWtypeId2&quot;</span>: <span class="number">0</span>, <span class="string">&quot;scope&quot;</span>: <span class="number">5</span>, <span class="string">&quot;speed&quot;</span>: <span class="number">0</span>, <span class="string">&quot;stypeId&quot;</span>: <span class="number">0</span>, <span class="string">&quot;successRate&quot;</span>: <span class="number">100</span>, <span class="string">&quot;tpCost&quot;</span>: <span class="number">0</span>, <span class="string">&quot;tpGain&quot;</span>: <span class="number">4</span>, <span class="string">&quot;messageType&quot;</span>: <span class="number">1</span> &#125;,</span><br><span class="line">    &#123; <span class="string">&quot;id&quot;</span>: <span class="number">6</span>, <span class="string">&quot;animationId&quot;</span>: <span class="number">0</span>, <span class="string">&quot;damage&quot;</span>: &#123; <span class="string">&quot;critical&quot;</span>: <span class="literal">false</span>, <span class="string">&quot;elementId&quot;</span>: <span class="number">0</span>, <span class="string">&quot;formula&quot;</span>: <span class="string">&quot;0&quot;</span>, <span class="string">&quot;type&quot;</span>: <span class="number">0</span>, <span class="string">&quot;variance&quot;</span>: <span class="number">20</span> &#125;, <span class="string">&quot;description&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="string">&quot;effects&quot;</span>: [&#123; <span class="string">&quot;code&quot;</span>: <span class="number">41</span>, <span class="string">&quot;dataId&quot;</span>: <span class="number">0</span>, <span class="string">&quot;value1&quot;</span>: <span class="number">0</span>, <span class="string">&quot;value2&quot;</span>: <span class="number">0</span> &#125;], <span class="string">&quot;hitType&quot;</span>: <span class="number">0</span>, <span class="string">&quot;iconIndex&quot;</span>: <span class="number">883</span>, <span class="string">&quot;message1&quot;</span>: <span class="string">&quot;%1逃跑了。&quot;</span>, <span class="string">&quot;message2&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="string">&quot;mpCost&quot;</span>: <span class="number">0</span>, <span class="string">&quot;name&quot;</span>: <span class="string">&quot;逃跑&quot;</span>, <span class="string">&quot;note&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="string">&quot;occasion&quot;</span>: <span class="number">1</span>, <span class="string">&quot;repeats&quot;</span>: <span class="number">1</span>, <span class="string">&quot;requiredWtypeId1&quot;</span>: <span class="number">0</span>, <span class="string">&quot;requiredWtypeId2&quot;</span>: <span class="number">0</span>, <span class="string">&quot;scope&quot;</span>: <span class="number">11</span>, <span class="string">&quot;speed&quot;</span>: <span class="number">0</span>, <span class="string">&quot;stypeId&quot;</span>: <span class="number">0</span>, <span class="string">&quot;successRate&quot;</span>: <span class="number">100</span>, <span class="string">&quot;tpCost&quot;</span>: <span class="number">0</span>, <span class="string">&quot;tpGain&quot;</span>: <span class="number">0</span>, <span class="string">&quot;messageType&quot;</span>: <span class="number">1</span> &#125;,</span><br><span class="line">    &#123; <span class="string">&quot;id&quot;</span>: <span class="number">7</span>, <span class="string">&quot;animationId&quot;</span>: <span class="number">0</span>, <span class="string">&quot;damage&quot;</span>: &#123; <span class="string">&quot;critical&quot;</span>: <span class="literal">false</span>, <span class="string">&quot;elementId&quot;</span>: <span class="number">0</span>, <span class="string">&quot;formula&quot;</span>: <span class="string">&quot;0&quot;</span>, <span class="string">&quot;type&quot;</span>: <span class="number">0</span>, <span class="string">&quot;variance&quot;</span>: <span class="number">20</span> &#125;, <span class="string">&quot;description&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="string">&quot;effects&quot;</span>: [], <span class="string">&quot;hitType&quot;</span>: <span class="number">0</span>, <span class="string">&quot;iconIndex&quot;</span>: <span class="number">979</span>, <span class="string">&quot;message1&quot;</span>: <span class="string">&quot;%1正在观望。&quot;</span>, <span class="string">&quot;message2&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="string">&quot;mpCost&quot;</span>: <span class="number">0</span>, <span class="string">&quot;name&quot;</span>: <span class="string">&quot;观望&quot;</span>, <span class="string">&quot;note&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="string">&quot;occasion&quot;</span>: <span class="number">1</span>, <span class="string">&quot;repeats&quot;</span>: <span class="number">1</span>, <span class="string">&quot;requiredWtypeId1&quot;</span>: <span class="number">0</span>, <span class="string">&quot;requiredWtypeId2&quot;</span>: <span class="number">0</span>, <span class="string">&quot;scope&quot;</span>: <span class="number">0</span>, <span class="string">&quot;speed&quot;</span>: <span class="number">0</span>, <span class="string">&quot;stypeId&quot;</span>: <span class="number">0</span>, <span class="string">&quot;successRate&quot;</span>: <span class="number">100</span>, <span class="string">&quot;tpCost&quot;</span>: <span class="number">0</span>, <span class="string">&quot;tpGain&quot;</span>: <span class="number">10</span>, <span class="string">&quot;messageType&quot;</span>: <span class="number">1</span> &#125;,</span><br><span class="line">    &#123; <span class="string">&quot;id&quot;</span>: <span class="number">8</span>, <span class="string">&quot;animationId&quot;</span>: <span class="number">41</span>, <span class="string">&quot;damage&quot;</span>: &#123; <span class="string">&quot;critical&quot;</span>: <span class="literal">false</span>, <span class="string">&quot;elementId&quot;</span>: <span class="number">0</span>, <span class="string">&quot;formula&quot;</span>: <span class="string">&quot;200 + a.mat&quot;</span>, <span class="string">&quot;type&quot;</span>: <span class="number">3</span>, <span class="string">&quot;variance&quot;</span>: <span class="number">20</span> &#125;, <span class="string">&quot;description&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="string">&quot;effects&quot;</span>: [&#123; <span class="string">&quot;code&quot;</span>: <span class="number">21</span>, <span class="string">&quot;dataId&quot;</span>: <span class="number">4</span>, <span class="string">&quot;value1&quot;</span>: <span class="number">1</span>, <span class="string">&quot;value2&quot;</span>: <span class="number">0</span> &#125;, &#123; <span class="string">&quot;code&quot;</span>: <span class="number">21</span>, <span class="string">&quot;dataId&quot;</span>: <span class="number">7</span>, <span class="string">&quot;value1&quot;</span>: <span class="number">1</span>, <span class="string">&quot;value2&quot;</span>: <span class="number">0</span> &#125;, &#123; <span class="string">&quot;code&quot;</span>: <span class="number">21</span>, <span class="string">&quot;dataId&quot;</span>: <span class="number">8</span>, <span class="string">&quot;value1&quot;</span>: <span class="number">1</span>, <span class="string">&quot;value2&quot;</span>: <span class="number">0</span> &#125;, &#123; <span class="string">&quot;code&quot;</span>: <span class="number">21</span>, <span class="string">&quot;dataId&quot;</span>: <span class="number">8</span>, <span class="string">&quot;value1&quot;</span>: <span class="number">1</span>, <span class="string">&quot;value2&quot;</span>: <span class="number">0</span> &#125;, &#123; <span class="string">&quot;code&quot;</span>: <span class="number">21</span>, <span class="string">&quot;dataId&quot;</span>: <span class="number">6</span>, <span class="string">&quot;value1&quot;</span>: <span class="number">1</span>, <span class="string">&quot;value2&quot;</span>: <span class="number">0</span> &#125;], <span class="string">&quot;hitType&quot;</span>: <span class="number">0</span>, <span class="string">&quot;iconIndex&quot;</span>: <span class="number">72</span>, <span class="string">&quot;message1&quot;</span>: <span class="string">&quot;%1吟唱了%2！&quot;</span>, <span class="string">&quot;message2&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="string">&quot;mpCost&quot;</span>: <span class="number">5</span>, <span class="string">&quot;name&quot;</span>: <span class="string">&quot;治愈&quot;</span>, <span class="string">&quot;note&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="string">&quot;occasion&quot;</span>: <span class="number">0</span>, <span class="string">&quot;repeats&quot;</span>: <span class="number">1</span>, <span class="string">&quot;requiredWtypeId1&quot;</span>: <span class="number">0</span>, <span class="string">&quot;requiredWtypeId2&quot;</span>: <span class="number">0</span>, <span class="string">&quot;scope&quot;</span>: <span class="number">1</span>, <span class="string">&quot;speed&quot;</span>: <span class="number">0</span>, <span class="string">&quot;stypeId&quot;</span>: <span class="number">1</span>, <span class="string">&quot;successRate&quot;</span>: <span class="number">100</span>, <span class="string">&quot;tpCost&quot;</span>: <span class="number">0</span>, <span class="string">&quot;tpGain&quot;</span>: <span class="number">10</span>, <span class="string">&quot;messageType&quot;</span>: <span class="number">1</span> &#125;,</span><br><span class="line"><span class="title class_">Time</span> <span class="variable">taken</span>: <span class="number">0.103</span> <span class="variable">seconds</span>, <span class="title class_">Fetched</span>: <span class="number">10</span> <span class="title function_">row</span>(<span class="variable">s</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>然后我们通过json_tuple来解析它</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">hive (bigdata_hive3)&gt; <span class="keyword">select</span> json_tuple(<span class="type">json</span> , <span class="string">&#x27;id&#x27;</span> , <span class="string">&#x27;animationId&#x27;</span> , <span class="string">&#x27;damage&#x27;</span>,<span class="string">&#x27;description&#x27;</span>,<span class="string">&#x27;effects&#x27;</span>,<span class="string">&#x27;hitType&#x27;</span>,<span class="string">&#x27;iconIndex&#x27;</span>,<span class="string">&#x27;message1&#x27;</span>,<span class="string">&#x27;message2&#x27;</span>,<span class="string">&#x27;mpCost&#x27;</span>,<span class="string">&#x27;name&#x27;</span>,<span class="string">&#x27;note&#x27;</span>,<span class="string">&#x27;occasion&#x27;</span>,<span class="string">&#x27;repeats&#x27;</span>,<span class="string">&#x27;requiredWtypeId1&#x27;</span>,<span class="string">&#x27;requiredWtypeId2&#x27;</span>,<span class="string">&#x27;scope&#x27;</span>,<span class="string">&#x27;speed&#x27;</span>,<span class="string">&#x27;stypeId&#x27;</span>,<span class="string">&#x27;successRate&#x27;</span>,<span class="string">&#x27;tpCost&#x27;</span>,<span class="string">&#x27;tpGain&#x27;</span>,<span class="string">&#x27;messageType&#x27;</span>) <span class="keyword">from</span> skill <span class="keyword">limit</span> <span class="number">10</span> ;</span><br><span class="line">OK</span><br><span class="line">c0	c1	c2	c3	c4	c5	c6	c7	c8	c9	c10	c11	c12	c13	c14	c15	c16	c17	c18	c19	c20	c21	c22</span><br><span class="line"><span class="keyword">NULL</span>	<span class="keyword">NULL</span>	<span class="keyword">NULL</span>	<span class="keyword">NULL</span>	<span class="keyword">NULL</span>	<span class="keyword">NULL</span>	<span class="keyword">NULL</span>	<span class="keyword">NULL</span>	<span class="keyword">NULL</span>	<span class="keyword">NULL</span>	<span class="keyword">NULL</span>	<span class="keyword">NULL</span>	<span class="keyword">NULL</span>	<span class="keyword">NULL</span>	<span class="keyword">NULL</span>	<span class="keyword">NULL</span>	<span class="keyword">NULL</span>	<span class="keyword">NULL</span>	<span class="keyword">NULL</span>	<span class="keyword">NULL</span>	<span class="keyword">NULL</span>	<span class="keyword">NULL</span>	<span class="keyword">NULL</span></span><br><span class="line"><span class="keyword">NULL</span>	<span class="keyword">NULL</span>	<span class="keyword">NULL</span>	<span class="keyword">NULL</span>	<span class="keyword">NULL</span>	<span class="keyword">NULL</span>	<span class="keyword">NULL</span>	<span class="keyword">NULL</span>	<span class="keyword">NULL</span>	<span class="keyword">NULL</span>	<span class="keyword">NULL</span>	<span class="keyword">NULL</span>	<span class="keyword">NULL</span>	<span class="keyword">NULL</span>	<span class="keyword">NULL</span>	<span class="keyword">NULL</span>	<span class="keyword">NULL</span>	<span class="keyword">NULL</span>	<span class="keyword">NULL</span>	<span class="keyword">NULL</span>	<span class="keyword">NULL</span>	<span class="keyword">NULL</span>	<span class="keyword">NULL</span></span><br><span class="line"><span class="number">1</span>	<span class="number">1</span>	&#123;&quot;critical&quot;:<span class="keyword">true</span>,&quot;elementId&quot;:<span class="number">-1</span>,&quot;formula&quot;:&quot;a.atk * 4 - b.def * 2&quot;,&quot;type&quot;:<span class="number">1</span>,&quot;variance&quot;:<span class="number">20</span>&#125;		[&#123;&quot;code&quot;:<span class="number">21</span>,&quot;dataId&quot;:<span class="number">0</span>,&quot;value1&quot;:<span class="number">1</span>,&quot;value2&quot;:<span class="number">0</span>&#125;]	<span class="number">1</span>	<span class="number">880</span>	%<span class="number">1</span>的攻击！		<span class="number">0</span>攻击	<span class="number">1</span> 号技能会在选择“攻击”指令时使用。</span><br><span class="line"></span><br><span class="line">&lt;setup action&gt;</span><br><span class="line">display action</span><br><span class="line">immortal: targets, <span class="keyword">true</span></span><br><span class="line">&lt;/setup action&gt;</span><br><span class="line"></span><br><span class="line">&lt;target action&gt;</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">user</span>.attackMotion() !== <span class="string">&#x27;missile&#x27;</span></span><br><span class="line"><span class="keyword">move</span> <span class="keyword">user</span>: targets, front, <span class="number">20</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="keyword">perform</span> <span class="keyword">start</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">wait <span class="keyword">for</span> movement</span><br><span class="line">motion attack: <span class="keyword">user</span></span><br><span class="line"></span><br><span class="line">attack animation: target</span><br><span class="line">wait <span class="keyword">for</span> animation</span><br><span class="line">action effect</span><br><span class="line">&lt;/target action&gt;	<span class="number">1</span>	<span class="number">1</span>	<span class="number">0</span>	<span class="number">0</span>	<span class="number">1</span>	<span class="number">0</span>	<span class="number">0</span>	<span class="number">100</span>	<span class="number">0</span>	<span class="number">10</span>	<span class="number">1</span></span><br><span class="line"><span class="number">2</span>	<span class="number">0</span>	&#123;&quot;critical&quot;:<span class="keyword">false</span>,&quot;elementId&quot;:<span class="number">0</span>,&quot;formula&quot;:&quot;0&quot;,&quot;type&quot;:<span class="number">0</span>,&quot;variance&quot;:<span class="number">20</span>&#125;		[&#123;&quot;code&quot;:<span class="number">21</span>,&quot;dataId&quot;:<span class="number">2</span>,&quot;value1&quot;:<span class="number">1</span>,&quot;value2&quot;:<span class="number">0</span>&#125;]	<span class="number">0</span>	<span class="number">688</span>	%<span class="number">1</span>正在保护自己。		<span class="number">0</span>	防御	<span class="number">1</span> 号技能会在选择“防御”指令时使用。	<span class="number">1</span>	<span class="number">1</span>	<span class="number">0</span>	<span class="number">0</span>	<span class="number">11</span>	<span class="number">10</span>	<span class="number">0</span>	<span class="number">100</span>	<span class="number">0</span>	<span class="number">10</span>	<span class="number">1</span></span><br><span class="line"><span class="number">3</span>	<span class="number">-1</span>	&#123;&quot;critical&quot;:<span class="keyword">true</span>,&quot;elementId&quot;:<span class="number">-1</span>,&quot;formula&quot;:&quot;a.atk * 4 - b.def * 2&quot;,&quot;type&quot;:<span class="number">1</span>,&quot;variance&quot;:<span class="number">20</span>&#125;		[&#123;&quot;code&quot;:<span class="number">21</span>,&quot;dataId&quot;:<span class="number">0</span>,&quot;value1&quot;:<span class="number">1</span>,&quot;value2&quot;:<span class="number">0</span>&#125;]	<span class="number">1</span>	<span class="number">880</span>	%<span class="number">1</span>的攻击！		<span class="number">0</span>连续攻击		<span class="number">1</span>	<span class="number">2</span>	<span class="number">0</span>	<span class="number">0</span>	<span class="number">1</span>	<span class="number">0</span>	<span class="number">2</span>	<span class="number">100</span>	<span class="number">0</span>	<span class="number">5</span>	<span class="number">1</span></span><br><span class="line"><span class="number">4</span>	<span class="number">-1</span>	&#123;&quot;critical&quot;:<span class="keyword">true</span>,&quot;elementId&quot;:<span class="number">-1</span>,&quot;formula&quot;:&quot;a.atk * 4 - b.def * 2&quot;,&quot;type&quot;:<span class="number">1</span>,&quot;variance&quot;:<span class="number">20</span>&#125;		[&#123;&quot;code&quot;:<span class="number">21</span>,&quot;dataId&quot;:<span class="number">0</span>,&quot;value1&quot;:<span class="number">1</span>,&quot;value2&quot;:<span class="number">0</span>&#125;]	<span class="number">1</span>	<span class="number">880</span>	%<span class="number">1</span>的攻击！		<span class="number">0</span>两次攻击		<span class="number">1</span>	<span class="number">1</span>	<span class="number">0</span>	<span class="number">0</span>	<span class="number">4</span>	<span class="number">0</span>	<span class="number">0</span>	<span class="number">100</span>	<span class="number">0</span>	<span class="number">5</span>	<span class="number">1</span></span><br><span class="line"><span class="number">5</span>	<span class="number">-1</span>	&#123;&quot;critical&quot;:<span class="keyword">true</span>,&quot;elementId&quot;:<span class="number">-1</span>,&quot;formula&quot;:&quot;a.atk * 4 - b.def * 2&quot;,&quot;type&quot;:<span class="number">1</span>,&quot;variance&quot;:<span class="number">20</span>&#125;		[&#123;&quot;code&quot;:<span class="number">21</span>,&quot;dataId&quot;:<span class="number">0</span>,&quot;value1&quot;:<span class="number">1</span>,&quot;value2&quot;:<span class="number">0</span>&#125;]	<span class="number">1</span>	<span class="number">849</span>	%<span class="number">1</span>的攻击！		<span class="number">0</span>三次攻击		<span class="number">1</span>	<span class="number">1</span>	<span class="number">0</span>	<span class="number">0</span>	<span class="number">5</span>	<span class="number">0</span>	<span class="number">0</span>	<span class="number">100</span>	<span class="number">0</span>	<span class="number">4</span>	<span class="number">1</span></span><br><span class="line"><span class="number">6</span>	<span class="number">0</span>	&#123;&quot;critical&quot;:<span class="keyword">false</span>,&quot;elementId&quot;:<span class="number">0</span>,&quot;formula&quot;:&quot;0&quot;,&quot;type&quot;:<span class="number">0</span>,&quot;variance&quot;:<span class="number">20</span>&#125;		[&#123;&quot;code&quot;:<span class="number">41</span>,&quot;dataId&quot;:<span class="number">0</span>,&quot;value1&quot;:<span class="number">0</span>,&quot;value2&quot;:<span class="number">0</span>&#125;]	<span class="number">0</span>	<span class="number">883</span>	%<span class="number">1</span>逃跑了。		<span class="number">0</span>	逃跑		<span class="number">11</span>	<span class="number">0</span>	<span class="number">0</span>	<span class="number">100</span>	<span class="number">0</span>	<span class="number">0</span>	<span class="number">1</span></span><br><span class="line"><span class="number">7</span>	<span class="number">0</span>	&#123;&quot;critical&quot;:<span class="keyword">false</span>,&quot;elementId&quot;:<span class="number">0</span>,&quot;formula&quot;:&quot;0&quot;,&quot;type&quot;:<span class="number">0</span>,&quot;variance&quot;:<span class="number">20</span>&#125;		[]	<span class="number">0</span>	<span class="number">979</span>	%<span class="number">1</span>正在观望。		<span class="number">0</span>	观望		<span class="number">1</span>	<span class="number">1</span>	<span class="number">0</span>	<span class="number">0</span>	<span class="number">0</span>	<span class="number">100</span>	<span class="number">0</span>	<span class="number">10</span>	<span class="number">1</span></span><br><span class="line"><span class="number">8</span>	<span class="number">41</span>	&#123;&quot;critical&quot;:<span class="keyword">false</span>,&quot;elementId&quot;:<span class="number">0</span>,&quot;formula&quot;:&quot;200 + a.mat&quot;,&quot;type&quot;:<span class="number">3</span>,&quot;variance&quot;:<span class="number">20</span>&#125;		[&#123;&quot;code&quot;:<span class="number">21</span>,&quot;dataId&quot;:<span class="number">4</span>,&quot;value1&quot;:<span class="number">1</span>,&quot;value2&quot;:<span class="number">0</span>&#125;,&#123;&quot;code&quot;:<span class="number">21</span>,&quot;dataId&quot;:<span class="number">7</span>,&quot;value1&quot;:<span class="number">1</span>,&quot;value2&quot;:<span class="number">0</span>&#125;,&#123;&quot;code&quot;:<span class="number">21</span>,&quot;dataId&quot;:<span class="number">8</span>,&quot;value1&quot;:<span class="number">1</span>,&quot;value2&quot;:<span class="number">0</span>&#125;,&#123;&quot;code&quot;:<span class="number">21</span>,&quot;dataId&quot;:<span class="number">8</span>,&quot;value1&quot;:<span class="number">1</span>,&quot;value2&quot;:<span class="number">0</span>&#125;,&#123;&quot;code&quot;:<span class="number">21</span>,&quot;dataId&quot;:<span class="number">6</span>,&quot;value1&quot;:<span class="number">1</span>,&quot;value2&quot;:<span class="number">0</span>&#125;]	<span class="number">0</span>	<span class="number">72</span>	%<span class="number">1</span>吟唱了%<span class="number">2</span>！		<span class="number">5</span>	治愈		<span class="number">0</span>	<span class="number">1</span>	<span class="number">100</span>	<span class="number">0</span>	<span class="number">10</span>	<span class="number">1</span></span><br><span class="line"><span class="type">Time</span> taken: <span class="number">0.129</span> seconds, Fetched: <span class="number">10</span> <span class="keyword">row</span>(s)</span><br><span class="line"><span class="comment">----------------------------------------------------------------这样是因为数据太多了，我们简单筛选出来几条数据如下</span></span><br><span class="line">hive (bigdata_hive3)&gt; <span class="keyword">select</span> json_tuple(<span class="type">json</span> , <span class="string">&#x27;id&#x27;</span> , <span class="string">&#x27;animationId&#x27;</span> , <span class="string">&#x27;damage&#x27;</span>) <span class="keyword">from</span> skill <span class="keyword">limit</span> <span class="number">10</span> ;</span><br><span class="line">OK</span><br><span class="line">c0	c1	c2</span><br><span class="line"><span class="keyword">NULL</span>	<span class="keyword">NULL</span>	<span class="keyword">NULL</span></span><br><span class="line"><span class="keyword">NULL</span>	<span class="keyword">NULL</span>	<span class="keyword">NULL</span></span><br><span class="line"><span class="number">1</span>	<span class="number">1</span>	&#123;&quot;critical&quot;:<span class="keyword">true</span>,&quot;elementId&quot;:<span class="number">-1</span>,&quot;formula&quot;:&quot;a.atk * 4 - b.def * 2&quot;,&quot;type&quot;:<span class="number">1</span>,&quot;variance&quot;:<span class="number">20</span>&#125;</span><br><span class="line"><span class="number">2</span>	<span class="number">0</span>	&#123;&quot;critical&quot;:<span class="keyword">false</span>,&quot;elementId&quot;:<span class="number">0</span>,&quot;formula&quot;:&quot;0&quot;,&quot;type&quot;:<span class="number">0</span>,&quot;variance&quot;:<span class="number">20</span>&#125;</span><br><span class="line"><span class="number">3</span>	<span class="number">-1</span>	&#123;&quot;critical&quot;:<span class="keyword">true</span>,&quot;elementId&quot;:<span class="number">-1</span>,&quot;formula&quot;:&quot;a.atk * 4 - b.def * 2&quot;,&quot;type&quot;:<span class="number">1</span>,&quot;variance&quot;:<span class="number">20</span>&#125;</span><br><span class="line"><span class="number">4</span>	<span class="number">-1</span>	&#123;&quot;critical&quot;:<span class="keyword">true</span>,&quot;elementId&quot;:<span class="number">-1</span>,&quot;formula&quot;:&quot;a.atk * 4 - b.def * 2&quot;,&quot;type&quot;:<span class="number">1</span>,&quot;variance&quot;:<span class="number">20</span>&#125;</span><br><span class="line"><span class="number">5</span>	<span class="number">-1</span>	&#123;&quot;critical&quot;:<span class="keyword">true</span>,&quot;elementId&quot;:<span class="number">-1</span>,&quot;formula&quot;:&quot;a.atk * 4 - b.def * 2&quot;,&quot;type&quot;:<span class="number">1</span>,&quot;variance&quot;:<span class="number">20</span>&#125;</span><br><span class="line"><span class="number">6</span>	<span class="number">0</span>	&#123;&quot;critical&quot;:<span class="keyword">false</span>,&quot;elementId&quot;:<span class="number">0</span>,&quot;formula&quot;:&quot;0&quot;,&quot;type&quot;:<span class="number">0</span>,&quot;variance&quot;:<span class="number">20</span>&#125;</span><br><span class="line"><span class="number">7</span>	<span class="number">0</span>	&#123;&quot;critical&quot;:<span class="keyword">false</span>,&quot;elementId&quot;:<span class="number">0</span>,&quot;formula&quot;:&quot;0&quot;,&quot;type&quot;:<span class="number">0</span>,&quot;variance&quot;:<span class="number">20</span>&#125;</span><br><span class="line"><span class="number">8</span>	<span class="number">41</span>	&#123;&quot;critical&quot;:<span class="keyword">false</span>,&quot;elementId&quot;:<span class="number">0</span>,&quot;formula&quot;:&quot;200 + a.mat&quot;,&quot;type&quot;:<span class="number">3</span>,&quot;variance&quot;:<span class="number">20</span>&#125;</span><br><span class="line"><span class="type">Time</span> taken: <span class="number">0.11</span> seconds, Fetched: <span class="number">10</span> <span class="keyword">row</span>(s)</span><br><span class="line"><span class="comment">----------------------------------------------------------------------对于嵌套的json，就是上面的[&#123;&quot;code&quot;:21,&quot;dataId&quot;:4,&quot;value1&quot;:1,&quot;value2&quot;:0&#125;,&#123;&quot;code&quot;:21,&quot;dataId&quot;:7,&quot;value1&quot;:1,&quot;value2&quot;:0&#125;,&#123;&quot;code&quot;:21,&quot;dataId&quot;:8,&quot;value1&quot;:1,&quot;value2&quot;:0&#125;,&#123;&quot;code&quot;:21,&quot;dataId&quot;:8,&quot;value1&quot;:1,&quot;value2&quot;:0&#125;,&#123;&quot;code&quot;:21,&quot;dataId&quot;:6,&quot;value1&quot;:1,&quot;value2&quot;:0&#125;]这种数据用下面的方法 通过get_json_object</span></span><br><span class="line"></span><br><span class="line">hive (bigdata_hive3)&gt; <span class="keyword">select</span> get_json_object(<span class="type">json</span> , <span class="string">&#x27;$.effects[0]&#x27;</span>) <span class="keyword">from</span> skill <span class="keyword">limit</span> <span class="number">10</span>;</span><br><span class="line">OK</span><br><span class="line">_c0</span><br><span class="line"><span class="keyword">NULL</span></span><br><span class="line"><span class="keyword">NULL</span></span><br><span class="line">&#123;&quot;code&quot;:<span class="number">21</span>,&quot;dataId&quot;:<span class="number">0</span>,&quot;value1&quot;:<span class="number">1</span>,&quot;value2&quot;:<span class="number">0</span>&#125;</span><br><span class="line">&#123;&quot;code&quot;:<span class="number">21</span>,&quot;dataId&quot;:<span class="number">2</span>,&quot;value1&quot;:<span class="number">1</span>,&quot;value2&quot;:<span class="number">0</span>&#125;</span><br><span class="line">&#123;&quot;code&quot;:<span class="number">21</span>,&quot;dataId&quot;:<span class="number">0</span>,&quot;value1&quot;:<span class="number">1</span>,&quot;value2&quot;:<span class="number">0</span>&#125;</span><br><span class="line">&#123;&quot;code&quot;:<span class="number">21</span>,&quot;dataId&quot;:<span class="number">0</span>,&quot;value1&quot;:<span class="number">1</span>,&quot;value2&quot;:<span class="number">0</span>&#125;</span><br><span class="line">&#123;&quot;code&quot;:<span class="number">21</span>,&quot;dataId&quot;:<span class="number">0</span>,&quot;value1&quot;:<span class="number">1</span>,&quot;value2&quot;:<span class="number">0</span>&#125;</span><br><span class="line">&#123;&quot;code&quot;:<span class="number">41</span>,&quot;dataId&quot;:<span class="number">0</span>,&quot;value1&quot;:<span class="number">0</span>,&quot;value2&quot;:<span class="number">0</span>&#125;</span><br><span class="line"><span class="keyword">NULL</span></span><br><span class="line">&#123;&quot;code&quot;:<span class="number">21</span>,&quot;dataId&quot;:<span class="number">4</span>,&quot;value1&quot;:<span class="number">1</span>,&quot;value2&quot;:<span class="number">0</span>&#125;</span><br><span class="line"><span class="type">Time</span> taken: <span class="number">0.103</span> seconds, Fetched: <span class="number">10</span> <span class="keyword">row</span>(s)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>parse_url_tuple:解析url可能会用到&#x3D;》这个是单纯对url解析</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">hive (bigdata_hive3)<span class="operator">&gt;</span> <span class="keyword">desc</span> <span class="keyword">function</span> extended parse_url_tuple;</span><br><span class="line">OK</span><br><span class="line">tab_name</span><br><span class="line">parse_url_tuple(url, partname1, partname2, ..., partnameN) <span class="operator">-</span> extracts N (N<span class="operator">&gt;=</span><span class="number">1</span>) parts <span class="keyword">from</span> a URL.</span><br><span class="line">It takes a URL <span class="keyword">and</span> <span class="keyword">one</span> <span class="keyword">or</span> multiple partnames, <span class="keyword">and</span> <span class="keyword">returns</span> a tuple. <span class="keyword">All</span> the input parameters <span class="keyword">and</span> output <span class="keyword">column</span> types <span class="keyword">are</span> string.</span><br><span class="line">Partname: HOST, PATH, QUERY, <span class="keyword">REF</span>, PROTOCOL, AUTHORITY, FILE, USERINFO, QUERY:<span class="operator">&lt;</span>KEY_NAME<span class="operator">&gt;</span></span><br><span class="line">Note: Partnames <span class="keyword">are</span> <span class="keyword">case</span><span class="operator">-</span><span class="keyword">sensitive</span>, <span class="keyword">and</span> should <span class="keyword">not</span> contain unnecessary white spaces.</span><br><span class="line">Example:</span><br><span class="line">  <span class="operator">&gt;</span> <span class="keyword">SELECT</span> b.<span class="operator">*</span> <span class="keyword">FROM</span> src <span class="keyword">LATERAL</span> <span class="keyword">VIEW</span> parse_url_tuple(fullurl, <span class="string">&#x27;HOST&#x27;</span>, <span class="string">&#x27;PATH&#x27;</span>, <span class="string">&#x27;QUERY&#x27;</span>, <span class="string">&#x27;QUERY:id&#x27;</span>) b <span class="keyword">as</span> host, path, query, query_id LIMIT <span class="number">1</span>;</span><br><span class="line">  <span class="operator">&gt;</span> <span class="keyword">SELECT</span> parse_url_tuple(a.fullurl, <span class="string">&#x27;HOST&#x27;</span>, <span class="string">&#x27;PATH&#x27;</span>, <span class="string">&#x27;QUERY&#x27;</span>, <span class="string">&#x27;REF&#x27;</span>, <span class="string">&#x27;PROTOCOL&#x27;</span>, <span class="string">&#x27;FILE&#x27;</span>,  <span class="string">&#x27;AUTHORITY&#x27;</span>, <span class="string">&#x27;USERINFO&#x27;</span>, <span class="string">&#x27;QUERY:k1&#x27;</span>) <span class="keyword">as</span> (ho, pa, qu, re, pr, fi, au, us, qk1) <span class="keyword">from</span> src a;</span><br><span class="line"><span class="keyword">Function</span> class:org.apache.hadoop.hive.ql.udf.generic.GenericUDTFParseUrlTuple</span><br><span class="line"><span class="keyword">Function</span> type:BUILTIN</span><br><span class="line"><span class="type">Time</span> taken: <span class="number">0.017</span> seconds, Fetched: <span class="number">9</span> <span class="type">row</span>(s)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="判断类的"><a href="#判断类的" class="headerlink" title="判断类的"></a>判断类的</h2><p>case when &#x2F; if</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">首先随便创建表</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> emp_info(</span><br><span class="line">id <span class="type">int</span>,</span><br><span class="line"><span class="type">name</span> string</span><br><span class="line">)</span><br><span class="line"><span class="keyword">row</span> formatted fields terminated <span class="keyword">by</span> <span class="string">&#x27;,&#x27;</span></span><br><span class="line"><span class="comment">------------------------------数据如下</span></span><br><span class="line"><span class="number">1</span>,zihang</span><br><span class="line"><span class="number">2</span>,zuan</span><br><span class="line"><span class="number">3</span>,zihan</span><br><span class="line"><span class="number">4</span>,shuangxi</span><br><span class="line"><span class="number">4</span>,mengke</span><br><span class="line"><span class="comment">-----------------------------数据筛选</span></span><br><span class="line"><span class="keyword">select</span> <span class="type">name</span> , sum(<span class="keyword">case</span> <span class="keyword">when</span> <span class="type">name</span>=<span class="string">&#x27;zihan&#x27;</span> <span class="keyword">then</span> <span class="number">1</span> <span class="keyword">else</span> <span class="number">0</span> <span class="keyword">end</span>) <span class="keyword">from</span> emp_info</span><br><span class="line"><span class="comment">----------------------------if</span></span><br><span class="line"><span class="keyword">select</span> sum(<span class="keyword">if</span>(<span class="type">name</span>=<span class="string">&#x27;sz&#x27;</span>,<span class="number">1</span> ,<span class="number">0</span>))<span class="keyword">from</span> emp_info</span><br></pre></td></tr></table></figure>

<p>udf:</p>
<p>spark ,flink…都有</p>
<p>使用场景：内置函数不可以帮助我们解决问题了</p>
<p>udf的种类：</p>
<ul>
<li><p>udf ：一进一出</p>
<ul>
<li>继承udf类&#x3D;》实现evaLuate&#x3D;》打包上传服务器&#x3D;》<ul>
<li>使用临时函数 &#x3D;&gt;<code>add jar 路径</code>&#x3D;&gt; 创建临时函数 &#x3D; &gt;<code> create function  方法名字 as  &#39; 包名&#39;</code>&#x3D;&gt; 就可以直接使用了，但是临时函数添加的只对当前的session有用，包括add jar  也是临时的</li>
<li>另外一种使用方式  &#x3D;》 把jar包上传到 hive的auxlib下，然后就不用add jar 了&#x3D;》直接创建临时函数就ok&#x3D;》因为hive在启动的时候会有脚本自动add jar</li>
<li>永久函数：一般不建议 &#x3D;》 除非业务稳定udf函数才会不懂，但是会经常改动就没必要了<ul>
<li>永久函数在元数据里是可以找到的</li>
<li><code>create temporary function 方法名字 as &#39;包名&#39; 文件类型 文件的地址（可以在uri上）</code>本地路径会出问题&#x3D;》最好在hdfs上<ul>
<li>文件类型</li>
<li>using jar</li>
<li>File</li>
<li>archive</li>
</ul>
</li>
<li>在mysql中的元数据里面，可以查看Funcs表，里面存放着我们的永久函数</li>
<li>删除 <code>drop function functionname</code>但是元数据可能会有不同步的问题</li>
</ul>
</li>
</ul>
</li>
<li>临时函数用的比较多但是最推荐&#x3D;》 <code>hive -e/f </code></li>
<li><code>hive -i xxxx.sql</code>初始化hive的时候添加的一些依赖还可以和-f联用，在spark里也是<br>例子如下</li>
</ul>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">hive (bigdata_hive3)&gt; <span class="keyword">add</span> jar /home/hadoop/data/bigdatajava<span class="number">-1.0</span>-<span class="keyword">SNAPSHOT</span>.jar;</span><br><span class="line">Added [/home/hadoop/data/bigdatajava<span class="number">-1.0</span>-<span class="keyword">SNAPSHOT</span>.jar] <span class="keyword">to</span> <span class="keyword">class</span> <span class="type">path</span></span><br><span class="line">Added resources: [/home/hadoop/data/bigdatajava<span class="number">-1.0</span>-<span class="keyword">SNAPSHOT</span>.jar] </span><br><span class="line">hive (bigdata_hive3)&gt; <span class="keyword">create</span> <span class="keyword">temporary</span> <span class="keyword">function</span> hello_udf <span class="keyword">as</span> <span class="string">&#x27;udf.udftest&#x27;</span>;</span><br><span class="line">OK</span><br><span class="line">hive (bigdata_hive3)&gt; <span class="keyword">select</span> hello_udf(<span class="string">&#x27;jjjj&#x27;</span>);</span><br><span class="line">OK</span><br><span class="line">_c0</span><br><span class="line">jjjjhello</span><br><span class="line"><span class="type">Time</span> taken: <span class="number">0.108</span> seconds, Fetched: <span class="number">1</span> <span class="keyword">row</span>(s)</span><br><span class="line"><span class="comment">-----------------------------------------------------------------------------永久函数和这个差不多</span></span><br></pre></td></tr></table></figure></li>
<li><p>udaf：多进一出</p>
</li>
<li><p>udtf：一进多出</p>
</li>
</ul>
<h2 id="调优："><a href="#调优：" class="headerlink" title="调优："></a>调优：</h2>
      
    </div>

    
    
    

      
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://zihang.fun/2022/12/22/12-23/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="liu zihang">
      <meta itemprop="description" content="只有努力不会辜负你">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="枫叶冢">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/12/22/12-23/" class="post-title-link" itemprop="url">scala</a>
        </h2>

        <div class="post-meta">
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-12-22 09:29:40" itemprop="dateCreated datePublished" datetime="2022-12-22T09:29:40+08:00">2022-12-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-12-27 14:15:48" itemprop="dateModified" datetime="2022-12-27T14:15:48+08:00">2022-12-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%97%A5%E5%BF%97/" itemprop="url" rel="index"><span itemprop="name">日志</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>19k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>17 分钟</span>
            </span>

        </div>
      </header>

    
    
    

   

    <div class="post-body" itemprop="articleBody">

      
          <h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>Scala是一门多范式的编程语言，一种类似<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/java/85979?fromModule=lemma_inlink">java</a>的编程语言,设计初衷是实现可伸缩的语言,并集成<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B?fromModule=lemma_inlink">面向对象编程</a>和<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B?fromModule=lemma_inlink">函数式编程</a>的各种特性。</p>
<p>官网 ： <code>www.scala-lang.org</code></p>
<p>scala 是运行在jvm上的 ，所以scala是可以兼容java的</p>
<p>scala产生 ： 基于java进行开发而来的</p>
<p>scala安装前提 ： jdk</p>
<p>运行 ： 也需要生成字节码文件 如何再运行</p>
<p>开发 ： scala 的发明者 martin 编译器爱好者</p>
<p>两个语言 ： pizza 和 scala</p>
<p>java ： java 1.5 ： 加了泛型 ，增强for ，自动类型转换以及包装类 &#x3D;》 基于 pizza</p>
<p>java 1.8 ： 类型推断，以及lambel表达式 &#x3D;》 基于scala 加进去的</p>
<h1 id="为什么要学习scala"><a href="#为什么要学习scala" class="headerlink" title="为什么要学习scala"></a>为什么要学习scala</h1><p>首要原因是因为一个框架 Spark  ： 其底层就是scala开发的</p>
<p>Spark ：支持很多的语言 java ，py 等</p>
<p>flink：底层是java+scala &#x3D;》 所以它可以支持java编程，也可以用java编程 ，也支持了py &#x3D;》 现在主流用java</p>
<p>开发效率高且简单容易</p>
<p>scala 和 Java 的代码可以相互调用</p>
<p>在spark里可以，但是会比较奇怪</p>
<h1 id="scala部署"><a href="#scala部署" class="headerlink" title="scala部署"></a>scala部署</h1><h2 id="版本选择"><a href="#版本选择" class="headerlink" title="版本选择"></a>版本选择</h2><p>3.x</p>
<p>2.x</p>
<p>依赖于spark来决定的 ： 对于spark 3.0的时候已经移除了Scala 2.11版本</p>
<p>spark 3.x:scala 2.12&#x2F;2.13</p>
<p>spark 2.x: scala 2.11&#x2F;2.12</p>
<p>我们的spark用的是3.x版本 ，所以我们用的是scala 2.12.14</p>
<p>因为spark底层用的就是这个版本的</p>
<h2 id="安装部署"><a href="#安装部署" class="headerlink" title="安装部署"></a>安装部署</h2><p>win ： 安装 scala &#x3D;》 idea里安装 scala 插件</p>
<p>linux ： 安装 scala &#x3D;》 目的&#x3D;&gt; 调试自己开发的代码  &#x3D;》 和spark 完全无关系</p>
<p>win安装： 解压 -》 配置环境变量</p>
<p>linux ： 解压-》软连接 -》 配置环境变量</p>
<p>输入scala之后进入到交互式界面</p>
<p>结果如下</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">scala</span>&gt; <span class="number">1</span>+<span class="number">2</span></span><br><span class="line"><span class="attribute">res0</span>: Int = <span class="number">3</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>说明我们结果数据的类型在scala里是可以推断出来的 ，前面的我res0是变量的名字</p>
<p>在idea里安装scala的插件 ： 打开idea -》 file -》 setting -》 上方搜索栏目 输入 Plugin -》 点击 Marketplace 搜索 Scala 如何安装第一个插件 ，安装完成之后重启idea即可，重启之后点击file -》 Prtoject Structure -》 点击 -》 global libraries 点击上面的加号 然后点击 Brower 然后选中自己的scala的目录 -》 添加成功应用就ok了 -》 我们验证一下是不是好用-》创建一个文件夹 -》make dir as root -》 创建example 类 -》 创建 test.scala -&gt;在pom文件中添加依赖-》 进入之后，创建 如下代码</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">package example.<span class="property">test</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">object</span> scala &#123;</span><br><span class="line">  def <span class="title function_">main</span>(<span class="attr">args</span>: <span class="title class_">Array</span>[<span class="title class_">String</span>]): <span class="title class_">Unit</span> = &#123;</span><br><span class="line">    <span class="title function_">printf</span>(<span class="string">&quot;撒更何况的客户打&quot;</span>);</span><br><span class="line">    <span class="title function_">printf</span>(<span class="string">&quot;sadkakhjd&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">------------------------pom</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.scala-lang<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>scala-library<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">version</span>&gt;</span>2.12.14<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>执行看看成功</p>
<p>成功如下</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">撒更何况的客户打sadkakhjd</span><br><span class="line">Process finished with <span class="keyword">exit</span> code <span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>maven地址：</p>
<h1 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h1><h2 id="值与变量"><a href="#值与变量" class="headerlink" title="值与变量"></a>值与变量</h2><p>java ：</p>
<ul>
<li>数据类型 变量名&#x3D;值</li>
<li>Int num&#x3D;值</li>
<li>final 值 ： 定义常量</li>
</ul>
<p>scala</p>
<ul>
<li>val 声明之后 不可改变 &#x3D;》 final</li>
<li>var 声明之后 可以改变</li>
</ul>
<h3 id="声明变量和值"><a href="#声明变量和值" class="headerlink" title="声明变量和值"></a>声明变量和值</h3><p>var 变量名 ：数据类型 &#x3D; 值</p>
<p>val 变量名 : 数据类型 &#x3D; 值</p>
<p>其中 <code>val lsdjllsdf= 90</code>和 <code>val lsdjllsdf:Int= 90</code></p>
<p>是一样的因为他会自己进行类型推断</p>
<p>在scala里定义了一个变量要初始化的 ： 显示初始化</p>
<p>在scala虽然不支持隐式初始化，不过可以通过占位符达到这个目的 <code>var name:String=_</code>仅仅是编译不报错，但是运行就会报错了</p>
<p>注意：占位符这种方式一定要明确是什么类型</p>
<p>一般用于定义类里的属性，不知道改怎么赋值的时候的使用的</p>
<h3 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h3><p>scala里没有包装类</p>
<ul>
<li>String</li>
<li>Int</li>
<li>Long</li>
<li>Float</li>
<li>Double</li>
<li>Boolean</li>
<li>Char</li>
<li>Unit</li>
<li>Short</li>
<li>Byte</li>
<li>List</li>
<li>Option</li>
<li>Yourclass</li>
<li>数据类型转换与判断<ul>
<li>在scala里最顶层的是any -》 object</li>
<li>其下有Anyval 和 AnyRef<ul>
<li>Anyval<ul>
<li>Unit ： &#x3D;&gt; void 就是返回值是为空</li>
<li>其余和java都一样</li>
<li>为空则是nothing</li>
</ul>
</li>
<li>AnyRef<ul>
<li>String在引用里</li>
<li>List</li>
<li>Option</li>
<li>Yourclass</li>
<li>如果为空则为null</li>
</ul>
</li>
</ul>
</li>
<li>最底层是nothing 包括null的底层也是nothing</li>
</ul>
</li>
</ul>
<p>转换代码如下</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">val lsdjllsdf:Int= <span class="number">90</span></span><br><span class="line">val num1:Int = <span class="number">10</span></span><br><span class="line">val num2:Double = <span class="number">10.111</span></span><br><span class="line">val num3=num2<span class="selector-class">.asInstanceOf</span><span class="selector-attr">[Int]</span></span><br><span class="line">val num4=num2<span class="selector-class">.toInt</span></span><br><span class="line"><span class="function"><span class="title">println</span><span class="params">(num1)</span></span></span><br><span class="line"><span class="function"><span class="title">println</span><span class="params">(num2)</span></span></span><br><span class="line"><span class="function"><span class="title">println</span><span class="params">(num3)</span></span></span><br><span class="line"><span class="function"><span class="title">println</span><span class="params">(num4)</span></span></span><br></pre></td></tr></table></figure>

<p>注意scala里不能把字符串转换成Int（这里的字符串是非数字类型的）就是如果是11.111等数字类的还是可以的</p>
<p>比如 ：</p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> xiangxiang<span class="operator">:</span>String <span class="operator">=</span> <span class="string">&quot;ads&quot;</span></span><br><span class="line"> <span class="keyword">val</span> num6<span class="operator">=</span>xiangxiang.toInt</span><br><span class="line"> println(num6)</span><br></pre></td></tr></table></figure>

<p>就会报错</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Exception <span class="keyword">in</span> thread <span class="string">&quot;main&quot;</span> java<span class="selector-class">.lang</span><span class="selector-class">.NumberFormatException</span>: For <span class="selector-tag">input</span> string: <span class="string">&quot;ads&quot;</span></span><br><span class="line">	at java<span class="selector-class">.lang</span><span class="selector-class">.NumberFormatException</span><span class="selector-class">.forInputString</span>(NumberFormatException<span class="selector-class">.java</span>:<span class="number">65</span>)</span><br><span class="line">	at java<span class="selector-class">.lang</span><span class="selector-class">.Integer</span><span class="selector-class">.parseInt</span>(Integer<span class="selector-class">.java</span>:<span class="number">580</span>)</span><br><span class="line">	at java<span class="selector-class">.lang</span><span class="selector-class">.Integer</span><span class="selector-class">.parseInt</span>(Integer<span class="selector-class">.java</span>:<span class="number">615</span>)</span><br><span class="line">	at scala<span class="selector-class">.collection</span><span class="selector-class">.immutable</span><span class="selector-class">.StringLike</span><span class="selector-class">.toInt</span>(StringLike<span class="selector-class">.scala</span>:<span class="number">304</span>)</span><br><span class="line">	at scala<span class="selector-class">.collection</span><span class="selector-class">.immutable</span><span class="selector-class">.StringLike</span>.toInt$(StringLike<span class="selector-class">.scala</span>:<span class="number">304</span>)</span><br><span class="line">	at scala<span class="selector-class">.collection</span><span class="selector-class">.immutable</span><span class="selector-class">.StringOps</span><span class="selector-class">.toInt</span>(StringOps<span class="selector-class">.scala</span>:<span class="number">33</span>)</span><br><span class="line">	at example<span class="selector-class">.test</span>.scala$<span class="selector-class">.main</span>(scala<span class="selector-class">.scala</span>:<span class="number">19</span>)</span><br><span class="line">	at example<span class="selector-class">.test</span><span class="selector-class">.scala</span><span class="selector-class">.main</span>(scala.scala)</span><br></pre></td></tr></table></figure>

<h3 id="集合"><a href="#集合" class="headerlink" title="集合"></a>集合</h3><p>array</p>
<p>Range</p>
<p>List</p>
<p>大类的角度上讲：</p>
<ul>
<li>Seq</li>
<li>Set</li>
<li>Map</li>
</ul>
<p>最顶层是Iterable</p>
<ul>
<li>-》Set<ul>
<li>HashSet</li>
<li>ListSet</li>
<li>SorteSet<ul>
<li>TreeSet</li>
<li>BitSet</li>
</ul>
</li>
</ul>
</li>
<li>-》Map<ul>
<li>HashMap</li>
<li>SorteMap<ul>
<li>TreeMap</li>
</ul>
</li>
<li>ListMap</li>
</ul>
</li>
<li>-》Seq<ul>
<li>indexSeq<ul>
<li>Range</li>
<li>String</li>
<li>Array</li>
<li>NumericRange</li>
<li>Vector</li>
</ul>
</li>
<li>LinearSeq<ul>
<li>List</li>
<li>Stream</li>
<li>Queue</li>
<li>Stack</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>快速构建集合的方法：</p>
<p>range：</p>
<ul>
<li>to ： 左闭右闭</li>
<li>until ： 左闭右开的</li>
</ul>
<p>scala api 方法</p>
<p>方法调用 ： 变量打点调用或者xxx按一个空格调用</p>
<p>流程控制：scala里没三目运算符</p>
<ul>
<li>分支结构 ：<ul>
<li>if else</li>
<li>模式匹配</li>
</ul>
</li>
<li>循环<ul>
<li>for</li>
<li>while</li>
<li>算子</li>
</ul>
</li>
</ul>
<p>代码如下</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">    val Scaoe = <span class="number">111</span></span><br><span class="line">    <span class="keyword">if</span> (Scaoe &gt;= <span class="number">90</span>)&#123;</span><br><span class="line">      <span class="built_in">println</span>(<span class="string">&quot;牛皮&quot;</span>)</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span> (Scaoe &gt;= <span class="number">60</span>)&#123;</span><br><span class="line">      <span class="built_in">println</span>(<span class="string">&quot;差点意思&quot;</span>)</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span> (Scaoe &lt;= <span class="number">59</span>)&#123;</span><br><span class="line">      <span class="built_in">println</span>(<span class="string">&quot;欠打了&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">----------------------------------------------------------------------循环</span><br><span class="line">    val ints:Array<span class="selector-attr">[Int]</span> = <span class="built_in">Array</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">89</span>)</span><br><span class="line">    val iterator = ints<span class="selector-class">.toIterator</span></span><br><span class="line">    while (iterator.hasNext)&#123;</span><br><span class="line">      val item = iterator<span class="selector-class">.next</span>()</span><br><span class="line">      <span class="built_in">println</span>(item)</span><br><span class="line">    &#125;</span><br><span class="line">      <span class="keyword">for</span> (item &lt;- ints)&#123;</span><br><span class="line">        <span class="built_in">println</span>(item)</span><br><span class="line">      &#125;</span><br><span class="line">   ints<span class="selector-class">.foreach</span>(<span class="built_in">println</span>(_))</span><br></pre></td></tr></table></figure>

<h3 id="方法与函数"><a href="#方法与函数" class="headerlink" title="方法与函数"></a>方法与函数</h3><p>最简单的理解 ： def 定义方法</p>
<p>函数的本质就是特殊的方法</p>
<p>def 方法名字（参数名字：参数类型）：返回值类型&#x3D;{方法体}</p>
<p>例子如下</p>
<figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sum</span>(num1, num3)</span><br><span class="line">def <span class="built_in">sum</span>(a1:<span class="built_in">Int</span>,a2:<span class="built_in">Int</span>): <span class="keyword">Unit</span> =&#123;</span><br><span class="line">  val i = a1 + a2</span><br><span class="line">  println(i)</span><br><span class="line">&#125;</span><br><span class="line">tery(xiangxiang)</span><br><span class="line">def tery(fff:String): <span class="keyword">Unit</span> =&#123;</span><br><span class="line">  println(fff)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>补充 ： 方法的返回值类型也可以不写，因为它会自动推断的类型和val一样</p>
<p>后面的unit是代表方法的返回值，因为结尾是printf所以返回值是void</p>
<p>函数就是把方法的一些东西进行省略 -》 方法名+ 关键字</p>
<p><code>val ff=(a1:Int,a2:Int)=&gt;( a1 + a2)</code></p>
<p>方法里的参数</p>
<ul>
<li>默认参数 ： 常规传参&#x3D;”xxx”比如 <code> def tery(fff:String=&quot;default&quot;): Unit =&#123; println(fff) &#125;</code>如果有多个参数默认参数不可以放到中间，只能放在最后一个，不传就走默认，传了就走传的值</li>
<li>可变参数 :   * 例子 <code> def sum(num:Int*):Unit =&#123;print(num.size)&#125;</code> 可变参数一般都放在最后一个变量&#x2F;传入一个数组 <code> def sum(arr:_*):Unit =&#123;&#125;</code></li>
</ul>
<p>注意：方法是顺序的，如果没有定义过这个方法的时候调用它是会报错的</p>
<p>它可以不写返回值，因为它最后一行会默认被当成返回值</p>
<p>递归调用的时候一定要指明返回值类型，要不然会报错</p>
<h2 id="类"><a href="#类" class="headerlink" title="类"></a>类</h2><p>类里有属性方法构造器</p>
<p>class：代码如下</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> example.test</span><br><span class="line"></span><br><span class="line"><span class="keyword">object</span> t1 &#123;</span><br><span class="line">  def main(args: Array[String]): <span class="built_in">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">val</span> dl226 =new Dl2262</span><br><span class="line">    dl226.name=<span class="string">&quot;子航&quot;</span></span><br><span class="line">    println(dl226.age)</span><br><span class="line">    println(dl226.name)</span><br><span class="line">    dl226.listening()</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">val</span> hh:<span class="built_in">Int</span>=<span class="number">100</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">class</span> <span class="title class_">Dl2262</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> hs:<span class="built_in">Int</span>=<span class="number">1</span></span><br><span class="line">    <span class="keyword">var</span> name: String = _</span><br><span class="line">    <span class="keyword">val</span> age:<span class="built_in">Int</span>=<span class="number">20</span></span><br><span class="line">    def listening(teacher:String=<span class="string">&quot;双喜&quot;</span>) = &#123;</span><br><span class="line">      println(<span class="string">&quot;教师&quot;</span> + <span class="string">&quot;\t&quot;</span> + teacher +  <span class="string">&quot;正在上课&quot;</span> + <span class="string">&quot;\n&quot;</span> +  name + <span class="string">&quot;\t&quot;</span> +  <span class="string">&quot;正在听课&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>伴生类：class 是object的伴生类 ，object 是class的伴生对象 ：伴生类是相当于class 伴生方法是相当于静态方法</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">object</span> t1 &#123;</span><br><span class="line">  <span class="function">def <span class="title">main</span>(<span class="params">args: Array[String]</span>): Unit</span> = &#123;</span><br><span class="line">    val dd = <span class="keyword">new</span> A</span><br><span class="line">    dd.f01()</span><br><span class="line">    A.f01()</span><br><span class="line">  &#125;  </span><br><span class="line"><span class="keyword">class</span> <span class="title">A</span>&#123;</span><br><span class="line">    <span class="function">def <span class="title">f01</span>()</span>=&#123;</span><br><span class="line">      println(<span class="string">&quot;class ....class A&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">object</span> A&#123;</span><br><span class="line">    <span class="function">def <span class="title">f01</span>()</span>=&#123;</span><br><span class="line">      println(<span class="string">&quot;Class ......object A&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h3 id="常用的操作"><a href="#常用的操作" class="headerlink" title="常用的操作"></a>常用的操作</h3><p>apply方法 ： 这里往往使用object A里的apply方法 去 new 一个class A</p>
<p>如下 ：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">object</span> t1 &#123;</span><br><span class="line">  <span class="function">def <span class="title">main</span>(<span class="params">args: Array[String]</span>): Unit</span> = &#123;</span><br><span class="line">    val dd = <span class="keyword">new</span> A</span><br><span class="line">    dd.f01()</span><br><span class="line">    A.f01()</span><br><span class="line"> val tets:A = A()</span><br><span class="line">    tets.f01()</span><br><span class="line">  &#125;  </span><br><span class="line"><span class="keyword">class</span> <span class="title">A</span>&#123;</span><br><span class="line">    <span class="function">def <span class="title">f01</span>()</span>=&#123;</span><br><span class="line">      println(<span class="string">&quot;class ....class A&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">object</span> A&#123;</span><br><span class="line">    <span class="function">def <span class="title">f01</span>()</span>=&#123;</span><br><span class="line">      println(<span class="string">&quot;Class ......object A&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">	 <span class="function">def <span class="title">apply</span>(<span class="params"> </span>): A</span> = <span class="keyword">new</span> A()</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="构造器"><a href="#构造器" class="headerlink" title="构造器"></a>构造器</h3><p>主构造器 ： <code>class 类名（参数列表）</code></p>
<p>如下 ：</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="symbol">A</span>(<span class="symbol">name:<span class="symbol">String</span></span> , <span class="symbol">age:<span class="symbol">Int</span></span>)&#123;</span><br><span class="line"></span><br><span class="line">  def f01()=&#123;</span><br><span class="line">    println(<span class="string">&quot;class ....class A&quot;</span> + name + age)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>有参构造器，出现的化无参构造器就失效了<br>附属构造器 ： <code>this（）</code>每个附属构造器的第一行必须调用主构造器或者其他附属构造器</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="symbol">A</span>(<span class="symbol">name:<span class="symbol">String</span></span> , <span class="symbol">age:<span class="symbol">Int</span></span>)&#123;</span><br><span class="line">  def <span class="keyword">this</span>()&#123;</span><br><span class="line">    <span class="keyword">this</span>(name,age)</span><br><span class="line">  &#125;</span><br><span class="line">  def f01()=&#123;</span><br><span class="line">    println(<span class="string">&quot;class ....class A&quot;</span> + name + age)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="继承实现"><a href="#继承实现" class="headerlink" title="继承实现"></a>继承实现</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">t1</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> b = <span class="keyword">new</span> <span class="type">B</span>(<span class="string">&quot;dakhsk&quot;</span>, <span class="string">&quot;asdkajsdhas&quot;</span>)</span><br><span class="line">    b.fo2(<span class="string">&quot;kdahjakhd&quot;</span>)</span><br><span class="line">    println(b.age)</span><br><span class="line">    b.foq(<span class="string">&quot;adkshk&quot;</span>)</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">jicheng</span>(<span class="params">name:<span class="type">String</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">val</span> age:<span class="type">Int</span>=<span class="number">10</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">foq</span></span>(parm:<span class="type">String</span>): <span class="type">Unit</span> =&#123;</span><br><span class="line">      println(parm+ age + name)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">B</span>(<span class="params">name:<span class="type">String</span> , gerner:<span class="type">String</span></span>) <span class="keyword">extends</span> <span class="title">jicheng</span>(<span class="params">name</span>)</span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">fo2</span></span>(parm:<span class="type">String</span>): <span class="type">Unit</span> =&#123;</span><br><span class="line">      println(parm+name+gerner)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>先触发父类的构造器，然后才是子类的</p>
<p>抽象类实例化，只能通过子类继承的方式实现如下</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Pression</span></span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">a</span></span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">b</span></span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">c</span></span></span><br><span class="line">  <span class="keyword">var</span> name:<span class="type">String</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">c</span> <span class="keyword">extends</span> <span class="title">Pression</span></span>&#123;</span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">a</span></span>: <span class="type">Unit</span> = &#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">b</span></span>: <span class="type">Unit</span> = &#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">c</span></span>: <span class="type">Unit</span> = &#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">override</span> <span class="keyword">var</span> name: <span class="type">String</span> = _</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>特征：接口</p>
<p>创建一个Trait 就是特征 ，然后子类去继承它 ，不一定要全部实现，继承都用extends关键字</p>
<p>但是这里不能多继承</p>
<p>scala集合包 ：scala.collection</p>
<ul>
<li>可变</li>
<li>不可变</li>
</ul>
<p>主要是针对长度</p>
<p>array ：</p>
<ul>
<li>可变：变长数组</li>
<li>不可变：定长数组<ul>
<li>array：<ul>
<li>new <code>val arr=new Array[String](3)</code><ul>
<li>添加元素 <code>arr(0)=&quot;zahngsan&quot;</code></li>
<li>查看数组长度 <code>arr.length</code></li>
</ul>
</li>
<li>不new <code>val arr2 = Array(&quot;1&quot; ,1 ,&#39;1&#39;)或者指定类型</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<p>数组的遍历</p>
<figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">  <span class="variable">val</span> <span class="variable">Arr</span> = <span class="variable">new</span> <span class="variable">Array</span>[<span class="variable">String</span>](<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">  <span class="variable">for</span> (<span class="variable">elem</span> &lt;- <span class="variable">Arr</span>) &#123;</span><br><span class="line">    <span class="function"><span class="title">println</span>(<span class="variable">elem</span>)</span></span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">// 这个by 就是设置步长，就是每次运行之后是加多少，还是减多少</span></span><br><span class="line">  <span class="variable">for</span> (<span class="variable">i</span> &lt;- <span class="number">0</span> <span class="function"><span class="title">until</span>(<span class="variable">Arr.length</span>) <span class="variable">by</span> <span class="number">1</span>)&#123;</span></span><br><span class="line"><span class="function">    <span class="title">println</span>(<span class="title">Arr</span>(<span class="variable">i</span>))</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="variable">Arr.<span class="keyword">foreach</span></span>(<span class="function"><span class="title">println</span>(<span class="variable">_</span>))</span></span><br></pre></td></tr></table></figure>

<p>数组api</p>
<ul>
<li>反转 ： <code>Arr.reverse</code>会新生成一个数组</li>
<li>两个数组相加 ： <code>Arr ++ arr</code></li>
<li>求和，最大最小等 <code>Arr.max/min/sum</code></li>
<li>把数组内的元素转换成字符串的方式进行输出 <code>Arr.mkString</code>会把数组的元素进行拼接并会变成String<ul>
<li>参数 ： mkString（开始的的符号 ，分隔符 ，结束的符号）</li>
</ul>
</li>
</ul>
<p>变长数组</p>
<ul>
<li>ArrayBuffer ：先导包 ：import scala.collection.mutable.ArrayBuffer<ul>
<li>添加元素 ： <code>a +=1 </code></li>
<li>添加数组 ： <code>a ++=Arr</code></li>
</ul>
</li>
<li>api<ul>
<li>插入数据 ： <code>a.insert(2,3,43,45,5,6)</code>代表从第二个位置来插入后面的数组</li>
<li>移除数据 ： <code>a.remove(0,3)</code>从下表0开始移除三个元素</li>
</ul>
</li>
</ul>
<p>高阶函数：scala里的高级的api 重要的和spark core 比较类似</p>
<p>必须学明白</p>
<p>函数 ：Function 格式 ：<code>var/val 名字 = (参数列表) =&gt; 函数体</code>如果函数体内只有一行代码，是可以省略大括号的</p>
<p>调用： <code>名字(参数)</code>关于函数的类型 是 <code>(入参类型，有几个参数就有几个)=&gt;返回值类型</code></p>
<p>函数是特殊的方法</p>
<p>scala里是可以方法套方法的</p>
<p>相互转化 ：</p>
<p>hello 方法 可以通过 hello_变成函数</p>
<p>方法里也可以嵌套函数 ： 就是高阶函数</p>
<p>例子 ：</p>
<figure class="highlight moonscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">val a = <span class="function"><span class="params">()</span> =&gt;</span> println(<span class="string">&quot;dl2262....&quot;</span>)</span><br><span class="line">val b = <span class="function"><span class="params">(x:Int , y:Int)</span> =&gt;</span> &#123;x+y&#125;</span><br><span class="line">def foo(<span class="name">f</span>:<span class="function"><span class="params">()</span>=&gt;</span>Unit)=&#123;</span><br><span class="line">f()</span><br><span class="line">&#125;</span><br><span class="line">foo(a)</span><br><span class="line">还可以这么传</span><br><span class="line">foo(<span class="function"><span class="params">()</span> =&gt;</span> println(<span class="string">&quot;scala厉害&quot;</span>))</span><br><span class="line"><span class="comment">-----------------------------------------高阶函数</span></span><br><span class="line"></span><br><span class="line">def test05()=&#123;</span><br><span class="line">def cal(<span class="name">a</span>:Int,<span class="name">b</span>:Int,<span class="name">op</span>:<span class="function"><span class="params">(Int,Int)</span>=&gt;</span>Int)=&#123;</span><br><span class="line">op(a,b)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">println(cal(<span class="number">10</span>,<span class="number">20</span>,<span class="function"><span class="params">(x:Int,y:Int)</span>=&gt;</span>x+y))</span><br><span class="line">println(cal(<span class="number">10</span>,<span class="number">20</span>,<span class="function"><span class="params">(x,y)</span>=&gt;</span>x+y))</span><br><span class="line">println(cal(<span class="number">10</span>,<span class="number">20</span>,_+_))</span><br></pre></td></tr></table></figure>

<h3 id="map"><a href="#map" class="headerlink" title="map"></a>map</h3><p>map是一一映射的</p>
<p>比如 ： f:a&#x3D;&gt;b 类似 y&#x3D;f（x）</p>
<p>例子 ：数组成2</p>
<figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">val arr = <span class="built_in">Array</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>)</span><br><span class="line">arr.<span class="built_in">map</span>(<span class="function">(<span class="params">x:Int</span>)=&gt;</span>x*<span class="number">2</span>)</span><br><span class="line">简写 </span><br><span class="line">arr.<span class="built_in">map</span>(<span class="function">(<span class="params">x</span>)=&gt;</span>x*<span class="number">2</span>)</span><br><span class="line">arr.<span class="built_in">map</span>(<span class="function"><span class="params">x</span>=&gt;</span>x*<span class="number">2</span>) <span class="comment">//传入参数只有一个，括号可以省略</span></span><br><span class="line">arr.<span class="built_in">map</span>(_*<span class="number">2</span>) <span class="comment">// 前后只出现一次x，就是执行方法里，可以用_代替</span></span><br></pre></td></tr></table></figure>

<p>例子：</p>
<p>把数组中的 <code> var arr1 = Array(&quot;Flink&quot; , &quot;zihan&quot;)</code>变成小写</p>
<p>执行 <code>arr1.map(_.toLowerCase)</code>就ok了</p>
<p>补充数据类型 ：tuple元组 ： 定义方式 ： <code> private val tuple: (Int, Int, Int) = (1, 2, 3)</code></p>
<p>元素下标从1开始取用 <code>名称._num</code>取值</p>
<h3 id="foreach"><a href="#foreach" class="headerlink" title="foreach"></a>foreach</h3><p>map最好不要进行打印，因为map会制造一个结果集，括号里面速度Unit的</p>
<h3 id="filter"><a href="#filter" class="headerlink" title="filter"></a>filter</h3><p>有返回值。返回值是一个Any的集合，过滤，括号内放布尔类型的值</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">val</span> arr1 = List(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">78</span>)</span><br><span class="line"><span class="attribute">scala</span>&gt; arr1.filter(_%<span class="number">2</span>!=<span class="number">1</span>).filter(_&gt;<span class="number">3</span>)</span><br><span class="line"><span class="attribute">res9</span>: List[Int] = List(<span class="number">4</span>, <span class="number">6</span>, <span class="number">78</span>)</span><br></pre></td></tr></table></figure>

<h3 id="flatMap"><a href="#flatMap" class="headerlink" title="flatMap"></a>flatMap</h3><p>和map的区别：首先 FlatMap会打破原来的数据结构 ，map不会</p>
<p>对比结果如下</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">scala</span>&gt; val arr3 = Array(Array(<span class="number">1</span>,<span class="number">2</span>),Array(<span class="number">3</span>,<span class="number">4</span>),Array(<span class="number">5</span>,<span class="number">6</span>))</span><br><span class="line"><span class="attribute">arr3</span>: Array[Array[Int]] = Array(Array(<span class="number">1</span>, <span class="number">2</span>), Array(<span class="number">3</span>, <span class="number">4</span>), Array(<span class="number">5</span>, <span class="number">6</span>))</span><br><span class="line"></span><br><span class="line"><span class="attribute">scala</span>&gt; arr3.map(x =&gt; x.map(_*<span class="number">2</span>))</span><br><span class="line"><span class="attribute">res20</span>: Array[Array[Int]] = Array(Array(<span class="number">2</span>, <span class="number">4</span>), Array(<span class="number">6</span>, <span class="number">8</span>), Array(<span class="number">10</span>, <span class="number">12</span>))</span><br><span class="line"></span><br><span class="line"><span class="attribute">scala</span>&gt; arr3.flatMap(x=&gt;x.map(_*<span class="number">2</span>))</span><br><span class="line"><span class="attribute">res21</span>: Array[Int] = Array(<span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">12</span>)</span><br><span class="line"></span><br><span class="line"><span class="attribute">scala</span>&gt; </span><br></pre></td></tr></table></figure>

<h3 id="flatten"><a href="#flatten" class="headerlink" title="flatten"></a>flatten</h3><p>把数组打平就是拆散，使用方法 <code>arr.flatten</code></p>
<h3 id="reduce"><a href="#reduce" class="headerlink" title="reduce"></a>reduce</h3><p>规约的：把指定的业务逻辑作用两两的数据上</p>
<p>先对元素一和元素二进行操作，再把结果和元素三进行操作，以此类推</p>
<p>例子如下</p>
<figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">scala&gt; val arrr = <span class="built_in">Array</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">89</span>,<span class="number">99</span>)</span><br><span class="line">arrr: <span class="built_in">Array</span>[Int] = <span class="built_in">Array</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">89</span>, <span class="number">99</span>)</span><br><span class="line"></span><br><span class="line">scala&gt; arrr.<span class="built_in">reduce</span>(<span class="function">(<span class="params">x,y</span>)=&gt;</span>x+y)</span><br><span class="line">res24: Int = <span class="number">224</span></span><br><span class="line"></span><br><span class="line">scala&gt; arrr.<span class="built_in">reduce</span>(<span class="function">(<span class="params">x,y</span>)=&gt;</span>&#123;</span><br><span class="line">   println(x,y)</span><br><span class="line">   x+y</span><br><span class="line"> &#125;)</span><br><span class="line">     |      |      | (<span class="number">1</span>,<span class="number">2</span>)</span><br><span class="line">(<span class="number">3</span>,<span class="number">3</span>)</span><br><span class="line">(<span class="number">6</span>,<span class="number">4</span>)</span><br><span class="line">(<span class="number">10</span>,<span class="number">5</span>)</span><br><span class="line">(<span class="number">15</span>,<span class="number">6</span>)</span><br><span class="line">(<span class="number">21</span>,<span class="number">7</span>)</span><br><span class="line">(<span class="number">28</span>,<span class="number">8</span>)</span><br><span class="line">(<span class="number">36</span>,<span class="number">89</span>)</span><br><span class="line">(<span class="number">125</span>,<span class="number">99</span>)</span><br><span class="line">res25: Int = <span class="number">224</span></span><br><span class="line"></span><br><span class="line">scala&gt; </span><br></pre></td></tr></table></figure>

<p>reduce算子默认底层走的是reduceleft ，但是相应的也会有从右面的</p>
<p>如下</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">scala&gt; arrr.reduceRight(<span class="function"><span class="params">(x,y)</span>=&gt;</span>&#123;</span><br><span class="line">   println(x,y)</span><br><span class="line">   x+y</span><br><span class="line"> &#125;)</span><br><span class="line">     |      |      | (<span class="number">89</span>,<span class="number">99</span>)</span><br><span class="line">(<span class="number">8</span>,<span class="number">188</span>)</span><br><span class="line">(<span class="number">7</span>,<span class="number">196</span>)</span><br><span class="line">(<span class="number">6</span>,<span class="number">203</span>)</span><br><span class="line">(<span class="number">5</span>,<span class="number">209</span>)</span><br><span class="line">(<span class="number">4</span>,<span class="number">214</span>)</span><br><span class="line">(<span class="number">3</span>,<span class="number">218</span>)</span><br><span class="line">(<span class="number">2</span>,<span class="number">221</span>)</span><br><span class="line">(<span class="number">1</span>,<span class="number">223</span>)</span><br><span class="line">res26: Int = <span class="number">224</span></span><br><span class="line"></span><br><span class="line">scala&gt; </span><br></pre></td></tr></table></figure>

<h3 id="groupBy"><a href="#groupBy" class="headerlink" title="groupBy"></a>groupBy</h3><p>用于分组：自定义分组 ，和sql里的group by 有点类似 ，</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">scala&gt; val arr6 = <span class="built_in">Array</span>((<span class="string">&quot;a&quot;</span>,<span class="number">100</span>),(<span class="string">&quot;b&quot;</span>,<span class="number">20</span>),(<span class="string">&quot;c&quot;</span>,<span class="number">15</span>),(<span class="string">&quot;d&quot;</span>,<span class="number">100</span>))</span><br><span class="line">arr6: Array<span class="selector-attr">[(String, Int)]</span> = <span class="built_in">Array</span>((<span class="selector-tag">a</span>,<span class="number">100</span>), (<span class="selector-tag">b</span>,<span class="number">20</span>), (c,<span class="number">15</span>), (d,<span class="number">100</span>))</span><br><span class="line"></span><br><span class="line">scala&gt; arr6<span class="selector-class">.groupBy</span>(_._1)</span><br><span class="line">res27: scala<span class="selector-class">.collection</span><span class="selector-class">.immutable</span><span class="selector-class">.Map</span><span class="selector-attr">[String,Array[(String, Int)]</span>] = <span class="built_in">Map</span>(<span class="selector-tag">a</span> -&gt; <span class="built_in">Array</span>((<span class="selector-tag">a</span>,<span class="number">100</span>)), <span class="selector-tag">b</span> -&gt; <span class="built_in">Array</span>((<span class="selector-tag">b</span>,<span class="number">20</span>)), c -&gt; <span class="built_in">Array</span>((c,<span class="number">15</span>)), d -&gt; <span class="built_in">Array</span>((d,<span class="number">100</span>)))</span><br></pre></td></tr></table></figure>

<h3 id="MapValues"><a href="#MapValues" class="headerlink" title="MapValues"></a>MapValues</h3><p>也是一一映射 ： 但是map的作用是作用在values上的，首先数据必须是kv的，map键值对&#x2F;tuple2</p>
<p>补充map(k-&gt;v):一对一对的 <code>val a = Map(&quot;a&quot; -&gt; 24,&quot;b&quot;-&gt;33)</code></p>
<p>就是单独取出其中的values，如下</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> arr6 = <span class="constructor">Array((<span class="string">&quot;a&quot;</span>,100)</span>,(<span class="string">&quot;b&quot;</span>,<span class="number">20</span>),(<span class="string">&quot;c&quot;</span>,<span class="number">15</span>),(<span class="string">&quot;d&quot;</span>,<span class="number">100</span>))</span><br><span class="line">arr6.group<span class="constructor">By(<span class="params">_</span>.<span class="params">_1</span>)</span>.map<span class="constructor">Values(<span class="params">_</span>.<span class="params">map</span>(<span class="params">_</span>.<span class="params">_2</span>)</span>.sum)</span><br></pre></td></tr></table></figure>

<h3 id="sortby"><a href="#sortby" class="headerlink" title="sortby"></a>sortby</h3><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">val</span> arr7 = Array(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">6</span>)</span><br><span class="line"><span class="attribute">arr7</span>.sortBy(x =&gt; x)</span><br><span class="line"><span class="attribute">arr7</span>.sortBy(x =&gt; -x)</span><br></pre></td></tr></table></figure>

<p>自动排序，升序不加负号，加了就是降序</p>
<h3 id="实现wordcount"><a href="#实现wordcount" class="headerlink" title="实现wordcount"></a>实现wordcount</h3><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">object</span> Test&#123;</span><br><span class="line">  def main( args:Array<span class="literal">[S<span class="identifier">tring</span>]</span>): Unit =&#123;</span><br><span class="line">    var lines = <span class="constructor">Array(<span class="string">&quot;wo men shi hao hai zi&quot;</span>,<span class="string">&quot;wo jiao liu shen&quot;</span>,<span class="string">&quot;what&#x27;s your name&quot;</span>)</span></span><br><span class="line">    var words = <span class="constructor">Array(<span class="string">&quot;Hello world&quot;</span>,<span class="string">&quot;Hello scala&quot;</span>,<span class="string">&quot;Hello bigdata&quot;</span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*1.为什么这里使用空格就可以将数组lines分开？</span></span><br><span class="line"><span class="comment">    2.这里的map(_.split(&quot; &quot;))可以这么理解，_.split(&quot; &quot;)中的_可以理解成&quot;wo men shi hao hai zi&quot;,&quot;wo jiao liu shen&quot;,&quot;what&#x27;s your name&quot;中每个</span></span><br><span class="line"><span class="comment">    冒号的内容，然后将每个冒号的内容用空格分割。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    var result1 = words.map(<span class="module-access"><span class="module"><span class="identifier">_</span>.</span></span>split(<span class="string">&quot; &quot;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    1.将这个result1压平，压平的意思就是将多个Array数组压成一个Array数组</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    var result2 = result1.flatten</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    1.将result2中的每个元素拿出来和1形成map元组</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    var result3 = result2.map((_,<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    1.通过每个元组的第一个值来分组</span></span><br><span class="line"><span class="comment">    2.这里的分组方法因Scala/Spark等编程语言的不同而不同</span></span><br><span class="line"><span class="comment">    3.在scala中是groupBy，但是在spark中就是reduceByKey</span></span><br><span class="line"><span class="comment">    4.这里面的result4中的每个元素  都是一个元组</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    var result4 = result3.group<span class="constructor">By((<span class="params">_</span>.<span class="params">_1</span>)</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    1.这里的t._1中的t指的是元组中的一个元素，t._1指的是元组中第一个元素的第一部分</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    var result5 = result4.map(t =&gt;(t._1,t.<span class="module-access"><span class="module"><span class="identifier">_2</span>.</span></span>length))<span class="comment">//唯一不明白的地方</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    1.将得到的map转换成list，然后将list按照元组的第二部分来降序排序</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    var result6 = result5.toList.sort<span class="constructor">By(<span class="params">_</span>.<span class="params">_2</span>)</span>.reverse</span><br><span class="line"></span><br><span class="line">    println(result6);</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 1.flatMap()是通过切分开再压平  切分是通过.split(&quot; &quot;)方法</span></span><br><span class="line"><span class="comment">     * 2.map()方法是切分  map((_,1))是形成map序列 每个序列的value都是1</span></span><br><span class="line"><span class="comment">     * 3.groupBy()方法分组 groupBy((_._1))是通过每个元组的第一个值来分组</span></span><br><span class="line"><span class="comment">     * 4.toList()方法是转化成List序列  因为map是不支持排序的，所以使用List</span></span><br><span class="line"><span class="comment">     * 5.sortBy()方法是排序方法  sortBy(_._2)是通过元组的第二个元素来排序</span></span><br><span class="line"><span class="comment">     * 6.reverse()方法是倒转   将排序的结果降序排列</span></span><br><span class="line"><span class="comment">     * */</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">----------------------------------------上面是网上的-------------------------------------------</span><br><span class="line">----------------------------------------下面是我们自己写的-------------------------------------</span><br><span class="line">worcountSource.map(<span class="module-access"><span class="module"><span class="identifier">_</span>.</span></span>split(<span class="string">&quot;,&quot;</span>)).flatten.map((_,<span class="number">1</span>)).group<span class="constructor">By(<span class="params">_</span>.<span class="params">_1</span>)</span>.map((x=&gt;(x._1,x.<span class="module-access"><span class="module"><span class="identifier">_2</span>.</span></span>length))).toArray.sort<span class="constructor">By(<span class="params">_</span>.<span class="params">_2</span>)</span> <span class="comment">// 第一版</span></span><br><span class="line">然后进行优化 ， 上述把字符串炸开的时候，.splite和.flatten =》替换成flatMap</span><br><span class="line">mapValues =》可以替换后面进行数据统计的情况</span><br><span class="line">worcountSource.flat<span class="constructor">Map(<span class="params">_</span>.<span class="params">split</span>(<span class="string">&quot;,&quot;</span>)</span>).map((_,<span class="number">1</span>)).group<span class="constructor">By(<span class="params">_</span>.<span class="params">_1</span>)</span>.map<span class="constructor">Values(<span class="params">_</span>.<span class="params">map</span>(<span class="params">_</span>.<span class="params">_2</span>)</span>.sum).toArray.sort<span class="constructor">By(<span class="params">x</span>=&gt; -<span class="params">x</span>.<span class="params">_2</span>)</span> <span class="comment">// 第二版</span></span><br></pre></td></tr></table></figure>

<h3 id="字符串插值："><a href="#字符串插值：" class="headerlink" title="字符串插值："></a>字符串插值：</h3><p>shell ,python , scala 都有</p>
<figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">scala&gt; val hello:<span class="built_in">String</span> = <span class="string">&quot;hello&quot;</span></span><br><span class="line"> val <span class="built_in">str</span>:<span class="built_in">String</span> = hello + <span class="string">&quot;scala&quot;</span></span><br><span class="line">hello: <span class="built_in">String</span> = hello</span><br><span class="line"></span><br><span class="line">scala&gt; <span class="built_in">str</span>: <span class="built_in">String</span> = helloscala</span><br><span class="line"></span><br><span class="line">scala&gt; <span class="built_in">print</span>(s<span class="string">&quot;xxx_$str&quot;</span>)</span><br><span class="line">xxx_helloscala</span><br><span class="line">scala&gt; </span><br></pre></td></tr></table></figure>

<h3 id="多行字符串"><a href="#多行字符串" class="headerlink" title="多行字符串"></a>多行字符串</h3><p><code>val mes = &quot;&quot;&quot; sdhaskdj&quot;&quot;&quot;</code></p>
<p>就是三次””,其中多行的字符串每行之间加上，就可以</p>
<h2 id="集合-1"><a href="#集合-1" class="headerlink" title="集合"></a>集合</h2><h3 id="List-：和Array类似"><a href="#List-：和Array类似" class="headerlink" title="List ：和Array类似"></a>List ：和Array类似</h3><ul>
<li>长度不可变 list</li>
<li>长度可变 listBuffer</li>
</ul>
<p>Nil 是不可变的size为0的List</p>
<p>添加元素 ：<code>::追加元素 </code>这样是新生成一个数组，并不是再原来的数组上添加的</p>
<ul>
<li><code>val a = 1::Nil</code></li>
<li><code>li ++ List(1,2,3,4)</code></li>
</ul>
<p>取值 ：根据下标来取</p>
<p>api ：</p>
<ul>
<li>head：取出List的第一个元素</li>
<li>tail：取出List的非第一个的所有元素</li>
</ul>
<p>需求 ：使用scala求和的方法</p>
<figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">def <span class="built_in">sum</span>(nums:<span class="built_in">Int</span>*):<span class="built_in">Int</span>=&#123;</span><br><span class="line">  <span class="keyword">if</span> (nums.length==<span class="number">0</span>)&#123;</span><br><span class="line">    <span class="number">0</span></span><br><span class="line">  &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">    nums.head+<span class="built_in">sum</span>(nums.tail:_*)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>创建 可变的buffer：</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">val <span class="keyword">a</span> = ListBuffer[Int]()<span class="comment"></span></span><br><span class="line"><span class="comment">//添加元素</span></span><br><span class="line"><span class="keyword">a</span>+=<span class="number">2</span></span><br><span class="line"><span class="keyword">a</span>+=(<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>)</span><br><span class="line"><span class="keyword">a</span>++=List(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>)</span><br></pre></td></tr></table></figure>

<h3 id="set"><a href="#set" class="headerlink" title="set"></a>set</h3><p>创建 ：<code>val a = Set</code></p>
<p>无序不可重复的</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">scala</span>&gt; val hh = Set(<span class="number">111</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">545</span>)</span><br><span class="line"><span class="attribute">hh</span>: scala.collection.immutable.Set[Int] = Set(<span class="number">1</span>, <span class="number">2</span>, <span class="number">545</span>, <span class="number">3</span>, <span class="number">111</span>)</span><br></pre></td></tr></table></figure>

<h3 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h3><p>创建 ：<code>val a = Map (&quot;zs&quot;-&gt;123,&quot;lisi&quot;-&gt;22)</code></p>
<ul>
<li>可变 ：可以重新进行赋值</li>
<li>不可变 ：不可以重新赋值 ：默认是不可变 创建的时候用可变map <code>val a =  scala.collection.mutable.Map()</code></li>
</ul>
<p>取值 ：</p>
<ul>
<li>a(zs) :通过key来取值</li>
<li>a.get(“zs”):api取值方法，查看这个map里的key，有则取出，无则是null</li>
<li>a.getOrElse（”zs”,”默认值”）：取到就是map里的，取不到就是默认</li>
</ul>
<p>更改 ：针对可变map</p>
<ul>
<li>a(“zs”)&#x3D;18</li>
<li>a.get(“zs”)&#x3D;18</li>
<li>等等</li>
</ul>
<p>添加元素 ：和上面List和Array是一样的 <code>a += ((&quot;zss&quot; , 11))</code>或者 <code>a += (&quot;fff&quot;-&gt;111)</code>或者其他的方式，不止这些</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">scala&gt; val t1 =  scala<span class="selector-class">.collection</span><span class="selector-class">.mutable</span><span class="selector-class">.Map</span><span class="selector-attr">[String,String]</span>()</span><br><span class="line">t1: scala<span class="selector-class">.collection</span><span class="selector-class">.mutable</span><span class="selector-class">.Map</span><span class="selector-attr">[String,String]</span> = <span class="built_in">Map</span>()</span><br><span class="line"></span><br><span class="line">scala&gt; t1 += (<span class="string">&quot;ss&quot;</span> -&gt; <span class="string">&quot;sdlaks&quot;</span>)</span><br><span class="line">res54: t1<span class="selector-class">.type</span> = <span class="built_in">Map</span>(ss -&gt; sdlaks)</span><br><span class="line"></span><br><span class="line">scala&gt; t1</span><br><span class="line">res55: scala<span class="selector-class">.collection</span><span class="selector-class">.mutable</span><span class="selector-class">.Map</span><span class="selector-attr">[String,String]</span> = <span class="built_in">Map</span>(ss -&gt; sdlaks)</span><br><span class="line"></span><br><span class="line">scala&gt; <span class="built_in">t1</span>(<span class="string">&quot;ss&quot;</span>)</span><br><span class="line">res56: String = sdlaks</span><br><span class="line"></span><br><span class="line">scala&gt; t1<span class="selector-class">.get</span>(<span class="string">&quot;ss&quot;</span>)</span><br><span class="line">res57: Option<span class="selector-attr">[String]</span> = <span class="built_in">Some</span>(sdlaks)</span><br><span class="line"></span><br><span class="line">scala&gt; <span class="built_in">t1</span>(<span class="string">&quot;ss&quot;</span>)=<span class="string">&quot;1111&quot;</span></span><br><span class="line"></span><br><span class="line">scala&gt; t1</span><br><span class="line">res59: scala<span class="selector-class">.collection</span><span class="selector-class">.mutable</span><span class="selector-class">.Map</span><span class="selector-attr">[String,String]</span> = <span class="built_in">Map</span>(ss -&gt; <span class="number">1111</span>)</span><br><span class="line"></span><br><span class="line">scala&gt; t1<span class="selector-class">.getOrElse</span>(<span class="string">&quot;ss&quot;</span>,<span class="string">&quot;nihao&quot;</span>)</span><br><span class="line">res60: String = <span class="number">1111</span></span><br><span class="line"></span><br><span class="line">scala&gt; t1<span class="selector-class">.getOrElse</span>(<span class="string">&quot;ss1&quot;</span>,<span class="string">&quot;nihao&quot;</span>)</span><br><span class="line">res61: String = nihao</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="case-class"><a href="#case-class" class="headerlink" title="case class"></a>case class</h2><p>和普通的class的区别</p>
<p>以后用样例类偏多 ， case class 不用new</p>
<p>case class 默认实现了序列化 ：重要</p>
<p>case class 底层重写了，toString ，equals , hashcode</p>
<figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">case</span> <span class="variable">class</span> <span class="function"><span class="title">Dog</span>(<span class="variable">name</span>:<span class="variable">String</span>)&#123;</span></span><br><span class="line"><span class="function">  <span class="variable">def</span> <span class="title">fo1</span>(<span class="variable">name</span>:<span class="variable">String</span>): <span class="variable">Unit</span> =&#123;</span></span><br><span class="line"><span class="function">    <span class="title">print</span>(<span class="variable">name</span>)</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-----------------------------------------主方法----------------</span><br><span class="line">    <span class="variable">val</span> <span class="variable">dog</span> = <span class="function"><span class="title">Dog</span>(<span class="string">&quot;旺财&quot;</span>)</span></span><br><span class="line">    <span class="variable">dog.fo1</span>(<span class="string">&quot;daksjhakl&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line"><span class="variable">scala</span>&gt; <span class="variable">case</span> <span class="variable">class</span> <span class="function"><span class="title">Dog</span>(<span class="variable">name</span>:<span class="variable">String</span>)&#123;</span></span><br><span class="line"><span class="function">   <span class="variable">def</span> <span class="title">fo1</span>(<span class="variable">name</span>:<span class="variable">String</span>): <span class="variable">Unit</span> =&#123;</span></span><br><span class="line"><span class="function">     <span class="title">print</span>(<span class="variable">name</span>)</span></span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br><span class="line">     |      |      |      | <span class="variable">defined</span> <span class="variable">class</span> <span class="variable">Dog</span></span><br><span class="line"></span><br><span class="line"><span class="variable">scala</span>&gt; <span class="variable">import</span> <span class="variable">example.test.Dog</span></span><br><span class="line"> </span><br><span class="line"> <span class="variable">val</span> <span class="variable">dog</span> = <span class="function"><span class="title">Dog</span>(<span class="string">&quot;旺财&quot;</span>)</span></span><br><span class="line"> </span><br><span class="line"> <span class="variable">val</span> <span class="variable">dog</span> = <span class="function"><span class="title">Dog</span>(<span class="string">&quot;旺财&quot;</span>)</span></span><br><span class="line">&lt;<span class="variable">console</span>&gt;:<span class="number">11</span>: <span class="variable">error</span>: <span class="variable"><span class="class">object</span></span> <span class="variable">Dog</span> <span class="variable">is</span> <span class="variable"><span class="keyword">not</span></span> <span class="variable">a</span> <span class="variable">member</span> <span class="variable">of</span> <span class="variable">package</span> <span class="variable">example.test</span></span><br><span class="line">       <span class="variable">import</span> <span class="variable">example.test.Dog</span></span><br><span class="line">              ^</span><br><span class="line"></span><br><span class="line"><span class="variable">scala</span>&gt; </span><br><span class="line"><span class="variable">scala</span>&gt; <span class="variable">dog</span>: <span class="variable">Dog</span> = <span class="function"><span class="title">Dog</span>(����)</span></span><br><span class="line"></span><br><span class="line"><span class="variable">scala</span>&gt; </span><br><span class="line"><span class="variable">scala</span>&gt; <span class="variable">dog</span>: <span class="variable">Dog</span> = <span class="function"><span class="title">Dog</span>(����)</span></span><br><span class="line"></span><br><span class="line"><span class="variable">scala</span>&gt; <span class="variable">val</span> <span class="variable">dog1</span> = <span class="function"><span class="title">Dog</span>(<span class="string">&quot;旺财&quot;</span>)</span></span><br><span class="line"><span class="variable">dog1</span>: <span class="variable">Dog</span> = <span class="function"><span class="title">Dog</span>(����)</span></span><br><span class="line"></span><br><span class="line"><span class="variable">scala</span>&gt; <span class="variable">dog</span> == <span class="variable">dog1</span></span><br><span class="line"><span class="variable">res87</span>: <span class="variable">Boolean</span> = <span class="variable"><span class="literal">true</span></span></span><br><span class="line"></span><br><span class="line"><span class="variable">scala</span>&gt; <span class="function"><span class="title">print</span>(<span class="variable">dog</span>)</span></span><br><span class="line"><span class="function"><span class="title">Dog</span>(����)</span></span><br><span class="line"><span class="variable">scala</span>&gt; </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="模式匹配"><a href="#模式匹配" class="headerlink" title="模式匹配"></a>模式匹配</h2><p>类似java中的switch case</p>
<p>匹配的内容</p>
<ul>
<li>匹配内容<ul>
<li><code>xxx.match&#123;case xxx =&gt; xxxx case yyy =&gt; yyy case_ =&gt; xxxx&#125;</code>等</li>
</ul>
</li>
<li>匹配类型<ul>
<li><code>xxx.match&#123;case x:Int =&gt; xxxx case y:String =&gt;yyy case_ =&gt; zzzz&#125;</code></li>
</ul>
</li>
<li>匹配集合<ul>
<li><code>xxx.match&#123;case x::y::Nil =&gt; println(&quot;集合中只有两个元素&quot; case &quot;zihang&quot;::Nil =&gt; println(集合中只有一个元素就是子航)) case_ =&gt; println(&quot;other&quot;)&#125;</code></li>
</ul>
</li>
<li>匹配样例类<ul>
<li>源码中用的比较多 ： 如下</li>
</ul>
</li>
</ul>
<figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="keyword">class</span> <span class="title class_">Submak</span>()&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">case</span> <span class="keyword">class</span> <span class="title class_">hearetbeat</span>(int: Int)&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">case</span> <span class="keyword">class</span> <span class="title class_">hhh</span>(string: <span class="built_in">String</span>)&#123;</span><br><span class="line">&#125;</span><br><span class="line">-------main</span><br><span class="line">    val rrr = <span class="built_in">Array</span>(Submak , hearetbeat(<span class="number">111</span>) , hhh(<span class="string">&quot;sdajkd&quot;</span>))</span><br><span class="line"></span><br><span class="line">    rrr match &#123;</span><br><span class="line">      <span class="keyword">case</span> Submak() =&gt; <span class="built_in">print</span>(<span class="string">&quot;Submak&quot;</span>)</span><br><span class="line">      <span class="keyword">case</span>  hearetbeat(int: Int) =&gt; <span class="built_in">print</span>(<span class="string">&quot;sdahjd&quot;</span>)</span><br><span class="line">      <span class="keyword">case</span>  hhh(string: <span class="built_in">String</span>) =&gt; <span class="built_in">print</span>(<span class="string">&quot;hh&quot;</span>)</span><br><span class="line">      <span class="keyword">case</span> _ =&gt; <span class="built_in">print</span>(<span class="string">&quot;没有&quot;</span>)</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>简单例子</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">worcountSource.flatten.map(_.toString).map(<span class="function"><span class="params">(_, <span class="number">1</span>)</span>).groupBy<span class="params">(_._1)</span>.mapValues<span class="params">(_.map(_._2).sum)</span>.toArray.sortBy<span class="params">(_._2)</span>.map<span class="params">(_ match &#123; <span class="keyword">case</span> (<span class="string">&quot;n&quot;</span> , int: Int) =&gt; <span class="built_in">print</span>(<span class="string">&quot;找到&quot;</span>) <span class="keyword">case</span> _ =&gt; <span class="built_in">print</span>(<span class="string">&quot;bus&quot;</span>)&#125;)</span></span></span><br><span class="line"><span class="function"></span></span><br></pre></td></tr></table></figure>

<p>代表可以和wordcount联用</p>
<h3 id="偏函数"><a href="#偏函数" class="headerlink" title="偏函数"></a>偏函数</h3><p>用法 ：定义一个方法，且他的返回值是偏函数</p>
<p>方法体里是一堆的case表达式</p>
<p>A是输入参数的类型，B是输出参数的类型</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">    def teacher:PartialFunction[<span class="built_in">String</span>（A）,<span class="built_in">String</span>（B）]=&#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&quot;spark&quot;</span> =&gt; <span class="string">&quot;dsadljaksld&quot;</span></span><br><span class="line">      <span class="keyword">case</span> <span class="string">&quot;hive&quot;</span>=&gt; <span class="string">&quot;asdad&quot;</span></span><br><span class="line">      <span class="keyword">case</span> _ =&gt; <span class="string">&quot;其他&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">------------------------------------调用</span><br><span class="line">teacher（<span class="string">&quot;xxx&quot;</span>）</span><br></pre></td></tr></table></figure>

<p>一般用的很少</p>
<p>柯力化 &#x3D;》 必然发生的结果 ，没有任何意义</p>
<p>例如 ：<code>def sum(x:Int,y:Int) =&gt; def sum(x:Int)(y:Int)</code></p>
<p>上述就是柯力化，可以进行隐式转换来使用 -》 调用的时候也可以用柯力化的写法</p>
<h3 id="io-x3D-》-读写文件-url"><a href="#io-x3D-》-读写文件-url" class="headerlink" title="io &#x3D;》 读写文件 url"></a>io &#x3D;》 读写文件 url</h3><p>如下：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">scala&gt; import scala<span class="selector-class">.io</span><span class="selector-class">.Source</span></span><br><span class="line"> </span><br><span class="line"> val source = Source<span class="selector-class">.fromFile</span>(<span class="string">&quot;F:\\bigdatajava\\src\\main\\resources\\wc.data&quot;</span>)</span><br><span class="line">import scala<span class="selector-class">.io</span><span class="selector-class">.Source</span></span><br><span class="line"></span><br><span class="line">scala&gt; </span><br><span class="line">scala&gt; source: scala<span class="selector-class">.io</span><span class="selector-class">.BufferedSource</span> = &lt;iterator&gt;</span><br><span class="line"></span><br><span class="line">scala&gt; val strings = source<span class="selector-class">.getLines</span>()</span><br><span class="line">strings: Iterator<span class="selector-attr">[String]</span> = &lt;iterator&gt;</span><br><span class="line"></span><br><span class="line">scala&gt; strings<span class="selector-class">.foreach</span>(<span class="built_in">println</span>(_))</span><br><span class="line">spark,linux</span><br><span class="line">hadoop</span><br><span class="line">linux,hive</span><br><span class="line">flume</span><br><span class="line"></span><br><span class="line">scala&gt; </span><br></pre></td></tr></table></figure>

<p>上述这么读数据的话，数据只能使用一次，不管进行什么操作，甚至是比较，数据都会消失</p>
<p>需求 ：读取文件内容，统计文件每个单词出现的次数</p>
<p>如下：</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> source = <span class="module-access"><span class="module"><span class="identifier">Source</span>.</span></span>from<span class="constructor">File(<span class="string">&quot;F:\\bigdatajava\\src\\main\\resources\\wc.data&quot;</span>)</span></span><br><span class="line"><span class="keyword">val</span> strings = source.get<span class="constructor">Lines()</span></span><br><span class="line">strings.toArray.flat<span class="constructor">Map(<span class="params">_</span>.<span class="params">split</span>(<span class="string">&quot;,&quot;</span>)</span>).map((_,<span class="number">1</span>)).group<span class="constructor">By(<span class="params">_</span>.<span class="params">_1</span>)</span>.map(x =&gt; (x._1 , x.<span class="module-access"><span class="module"><span class="identifier">_2</span>.</span></span>length)).toArray.sort<span class="constructor">By(<span class="params">s</span> =&gt; -<span class="params">s</span>.<span class="params">_2</span>)</span>.foreach(println(_))</span><br></pre></td></tr></table></figure>

<h3 id="隐式转换"><a href="#隐式转换" class="headerlink" title="隐式转换"></a>隐式转换</h3><p>类似于java力的动态代理 &#x3D;》 为了增强</p>
<p>例子 ：A的一个类 -》 B类 B对A已经有的东西进行增强 -》 通过转换之后 B可以使用A已有的功能</p>
<p>场景 ：</p>
<ul>
<li>隐式参数</li>
<li>隐式类 ： 高危</li>
<li>隐式类转换 ：</li>
</ul>
<p>如下</p>
<figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">package example.test</span><br><span class="line"></span><br><span class="line">object te2 &#123;</span><br><span class="line"></span><br><span class="line">  def main(args: Array[String]): <span class="keyword">Unit</span> = &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">implicit</span> def mantoSuper(man: Man):SuperMan=&#123;</span><br><span class="line">      new SuperMan(man.<span class="keyword">Name</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    val zk = new Man(<span class="string">&quot;子涵 &quot;</span>)</span><br><span class="line">    zk.fly()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> Man(val <span class="keyword">Name</span>:String)&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> SuperMan(<span class="keyword">Name</span>:String)&#123;</span><br><span class="line">  def fly()=&#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="keyword">Name</span>+<span class="string">&quot;can fly&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>隐式转换可以作用于基本类型如下</p>
<figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> Cal(X:<span class="built_in">Int</span>)&#123;</span><br><span class="line">  def add(a:<span class="built_in">Int</span>): <span class="keyword">Unit</span> =&#123;</span><br><span class="line">    <span class="built_in">print</span>(a+X)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">---------------------------main</span><br><span class="line"> <span class="keyword">implicit</span> def INttoadd(x:<span class="built_in">Int</span>):Cal=&#123;</span><br><span class="line">      new Cal(x)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="number">4.</span>add(<span class="number">7</span>)</span><br></pre></td></tr></table></figure>

<p>通过隐式的方法往javaio中添加read方法</p>
<figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> RichFile(<span class="keyword">file</span>:<span class="keyword">File</span>)&#123;</span><br><span class="line"></span><br><span class="line">  def read()=&#123;</span><br><span class="line">    Source.fromFile(<span class="keyword">file</span>.getPath).getLines().mkString(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">---------------------------------------------------main</span><br><span class="line"> <span class="keyword">implicit</span> def ADDREAD(<span class="keyword">file</span>:<span class="keyword">File</span>):RichFile=&#123;</span><br><span class="line">      new RichFile(<span class="keyword">file</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    var q = new <span class="keyword">File</span>(<span class="string">&quot;F:\\bigdatajava\\src\\main\\resources\\wc.data&quot;</span>)</span><br><span class="line">    println(q.read())</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>🐂的</p>
<h2 id="泛型"><a href="#泛型" class="headerlink" title="泛型"></a>泛型</h2><p>方法中的泛型：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">MsG</span>[<span class="type">T</span>](<span class="params">content:<span class="type">T</span></span>)</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Wechat</span>(<span class="params">conte:<span class="type">String</span></span>) <span class="keyword">extends</span> <span class="title">MsG</span>(<span class="params">conte</span>)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">QQChat</span>[<span class="type">Int</span>](<span class="params">cont:<span class="type">Int</span></span>) <span class="keyword">extends</span> <span class="title">MsG</span>(<span class="params">cont</span>)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ZFBchat</span>(<span class="params">con:<span class="type">BigInt</span></span>) <span class="keyword">extends</span> <span class="title">MsG</span>[<span class="type">BigInt</span>](<span class="params">con</span>)</span></span><br></pre></td></tr></table></figure>

<p>例子 ：</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="symbol">boy</span>[<span class="symbol">A,<span class="symbol">B</span>,<span class="symbol">C</span></span>](<span class="symbol">val</span> <span class="symbol">hashband:<span class="symbol">A</span>,<span class="symbol">val</span></span> <span class="symbol">heigtt:<span class="symbol">B</span>,<span class="symbol">val</span></span> <span class="symbol">chuanzhuio:<span class="symbol">C</span></span>)&#123;</span><br><span class="line">  <span class="keyword">override</span> def toString: String = hashband +<span class="string">&quot;\t&quot;</span>+ heigtt+<span class="string">&quot;\t&quot;</span>+chuanzhuio</span><br><span class="line">&#125;</span><br><span class="line">----------------------------------枚举</span><br><span class="line">  object Facevalue extends Enumeration&#123;</span><br><span class="line">    type Face = Value</span><br><span class="line">    val A,B,C,D = Value</span><br><span class="line">  &#125;</span><br><span class="line">---------------------------main</span><br><span class="line">new boy[example.test.te2.Facevalue,Int,Double](Facevalue.A,<span class="number">181</span>,<span class="number">9</span>)</span><br></pre></td></tr></table></figure>

<p>上下界 ：</p>
<ul>
<li>上界：<code>&lt;T extends Test&gt;</code>:T是Test的子类 &#x2F; <code>&lt;? extends Test&gt;</code></li>
<li>下界：<code>&lt;T extends Test&gt;</code>:T可以说Test的父类 &#x2F; <code>&lt;? extends Test&gt;</code></li>
<li>逆变 vs 协变 &#x3D;》 + -</li>
</ul>
<h3 id="排序-："><a href="#排序-：" class="headerlink" title="排序 ："></a>排序 ：</h3><p>scala </p>
<ul>
<li>Ordering -&gt; comparator</li>
<li>Ordered -&gt; comparable</li>
</ul>
<p>重点 ：</p>
<ul>
<li>高级api</li>
<li>基本类型使用</li>
<li>模式匹配</li>
<li>隐式转换</li>
<li>类的定义</li>
</ul>

      
    </div>

    
    
    

      
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://zihang.fun/2022/12/21/12-21/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="liu zihang">
      <meta itemprop="description" content="只有努力不会辜负你">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="枫叶冢">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/12/21/12-21/" class="post-title-link" itemprop="url">SSM</a>
        </h2>

        <div class="post-meta">
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-12-21 09:01:44" itemprop="dateCreated datePublished" datetime="2022-12-21T09:01:44+08:00">2022-12-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-12-28 11:49:52" itemprop="dateModified" datetime="2022-12-28T11:49:52+08:00">2022-12-28</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%9D%82%E8%B4%A7%E6%8A%80%E6%9C%AF%E6%A0%88/" itemprop="url" rel="index"><span itemprop="name">杂货技术栈</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>26k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>23 分钟</span>
            </span>

        </div>
      </header>

    
    
    

   

    <div class="post-body" itemprop="articleBody">

      
          <h1 id="spring"><a href="#spring" class="headerlink" title="spring"></a>spring</h1><p>官网 ： spring.io</p>
<p>到今天它已经成为了一个生态圈，可以通过官网进行查看</p>
<p>先学习spring Framework  ： 底层的框架，是设计性框架</p>
<p>然后是spring boot ： 提高开发速度</p>
<p>而后是spring cloud ： 分布式开发相关技术</p>
<h1 id="spring-FrameWork"><a href="#spring-FrameWork" class="headerlink" title="spring FrameWork"></a>spring FrameWork</h1><p>2004年spring 1.0 问世</p>
<p>spring 1.0 是纯配置 2.0 引入了注解 3.0 引入了可以不写注解的 ，4.0 spring对jdk进行支持，5.0的时候要jdk8</p>
<h1 id="spring思想"><a href="#spring思想" class="headerlink" title="spring思想"></a>spring思想</h1><p>我们现在的用纯javase的时候耦合度过高，则要改一点东西的时候要重新编译，解决方案，适用对象的时候会不要在主动用new对象，从外传进来，就可以把方法当作一个工具这个思想就是ioc（控制反转）</p>
<p>spring就做到了，spring容器：ioc容器，它用这个充当了ioc的外部，ioc容器要管理创建和初始化的过程，被创建或者被管理的对象叫bean</p>
<p>如果服务的依赖也在容器里，则ioc容器会自动把他们的关系绑好，绑关系的过程叫Di，基本思想就是充分解耦</p>
<h2 id="Ioc的入门案例思路"><a href="#Ioc的入门案例思路" class="headerlink" title="Ioc的入门案例思路"></a>Ioc的入门案例思路</h2><h3 id="管理什么？"><a href="#管理什么？" class="headerlink" title="管理什么？"></a>管理什么？</h3><p>对应的bean：比如service 和 dao</p>
<h3 id="如何告知被管理的文件？"><a href="#如何告知被管理的文件？" class="headerlink" title="如何告知被管理的文件？"></a>如何告知被管理的文件？</h3><p>通过配置文件</p>
<h3 id="被管理的对象交给ioc容器，如何获取到ioc？"><a href="#被管理的对象交给ioc容器，如何获取到ioc？" class="headerlink" title="被管理的对象交给ioc容器，如何获取到ioc？"></a>被管理的对象交给ioc容器，如何获取到ioc？</h3><p>接口</p>
<h3 id="如何从容器中获取bean"><a href="#如何从容器中获取bean" class="headerlink" title="如何从容器中获取bean"></a>如何从容器中获取bean</h3><p>接口方法</p>
<h3 id="spring如何导入坐标"><a href="#spring如何导入坐标" class="headerlink" title="spring如何导入坐标"></a>spring如何导入坐标</h3><p>pom.xml</p>
<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><p>先导入spring-context:在pom文件里导入</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.2.10.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>然后在resource文件夹里创建xml中选择spring的xml。随便命名</p>
<p>接下来我们编辑这个xml文件的内容</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;hellobean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.example.testbean.test&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>其中 class后面的包名里如下 ，上述的id是我们引出这个bean的依据，就是id 这个id在一个xml文件中是不可以重复的，后面的class代表我们要用这个id代表的类，也就是告诉ioc容器，是哪一个类被它管理了，其内部只是一个普通的方法</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">package org.example.testbean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">test</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printhello</span>()</span>&#123;</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">&quot;hellospringbean&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>然后我们在一个java类里如下实现</p>
<figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.example.testbean.test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Hello world!</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> </span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> void main( <span class="keyword">String</span>[] args )</span><br><span class="line">    &#123;</span><br><span class="line">        ApplicationContext stx = <span class="keyword">new</span> <span class="type">ClassPathXmlApplicationContext</span>(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">        test hellobean = (test) stx.getBean(<span class="string">&quot;hellobean&quot;</span>);</span><br><span class="line">        hellobean.printhello();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>就可以了，上述ApplicationContext是一个接口，然后通过ClassPathXmlApplicationContext(“applicationContext.xml”)把我们的配置文件载入</p>
<h2 id="Di的入门案例"><a href="#Di的入门案例" class="headerlink" title="Di的入门案例"></a>Di的入门案例</h2><p>提供方法让其进入到对应的依赖中，以及添加配置</p>
<p>首先创建两个类 如下</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">package org.example.testbean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">test2</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> test tx;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span>  <span class="title">printhellobean</span>()</span>&#123;</span><br><span class="line">        tx.printhello();</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">&quot;Secondly hello &quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> test <span class="title">getTx</span>()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> tx;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTx</span>(<span class="params">test tx</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.tx = tx;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">------------------------------------------------------------------------------------</span><br><span class="line">package org.example.testbean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">test</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printhello</span>()</span>&#123;</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">&quot;hellospringbean&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>然后再spring的配置文件中加上，先添加上两个类的bean，然后进行关联 ，其中name是那一个类里的变量，ref是那个变量指向那一个bean所指向的类，就是bean的id</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;hellobean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.example.testbean.test&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;hellobean2&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.example.testbean.test2&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;tx&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;hellobean&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>然后再app方法，就是我们要执行的方法中加上</p>
<figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.example.testbean.test;</span><br><span class="line"><span class="keyword">import</span> org.example.testbean.test2;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Hello world!</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> </span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> void main( <span class="keyword">String</span>[] args )</span><br><span class="line">    &#123;</span><br><span class="line">        ApplicationContext stx = <span class="keyword">new</span> <span class="type">ClassPathXmlApplicationContext</span>(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">        test2 hellobean = (test2) stx.getBean(<span class="string">&quot;hellobean2&quot;</span>);</span><br><span class="line">        hellobean.printhellobean();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这就是DI ，其实以前就自己用纯javaee代码实现过这个思想</p>
<h3 id="bean的别名"><a href="#bean的别名" class="headerlink" title="bean的别名"></a>bean的别名</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> &lt;bean <span class="attribute">id</span>=<span class="string">&quot;hellobean&quot;</span> <span class="attribute">name</span>=<span class="string">&quot;test1 test3&quot;</span> <span class="attribute">class</span>=<span class="string">&quot;org.example.testbean.test&quot;</span>&gt;&lt;/bean&gt;</span><br><span class="line">然后其他的地方调用它和id是一样的</span><br></pre></td></tr></table></figure>

<p>可以用， ； 空格分割</p>
<p>spring 默认创建的bean是单例，就是一个对象无论是哪一个程序使用的相同的bean的id，它都是一个对象，可以进行设置</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean <span class="attribute">id</span>=<span class="string">&quot;hellobean&quot;</span> <span class="attribute">class</span>=<span class="string">&quot;org.example.testbean.test&quot;</span> <span class="attribute">scope</span>=<span class="string">&quot;prototype&quot;</span>&gt;&lt;/bean&gt;</span><br><span class="line">这样他就会创建多个对象</span><br><span class="line">如果想创建单个对象，可以执行默认 ，或者singleton</span><br></pre></td></tr></table></figure>

<p>为什么bean默认为单例？</p>
<ul>
<li>为了控制bean的数量，以及减轻负担</li>
</ul>
<p>spring管理对象的时候就是管理的复用的对象</p>
<p>适合其管理的对象 ：</p>
<ul>
<li>表现层对象</li>
<li>业务层对象</li>
<li>数据层对象</li>
<li>工具对象</li>
</ul>
<p>不适合的</p>
<ul>
<li>封装实体的域对象</li>
</ul>
<h2 id="bean实例化"><a href="#bean实例化" class="headerlink" title="bean实例化"></a>bean实例化</h2><h3 id="bean是如何创建的"><a href="#bean是如何创建的" class="headerlink" title="bean是如何创建的"></a>bean是如何创建的</h3><p>bean的本质是对象，创建bean是使用方法</p>
<p>spring 创建bean的是无参的，无论是public 或者是private ，都可以调用，因为它是用反射调用的构造，但是如果你没有无参的构造方法，他会报错，就是bean创建的异常</p>
<p>spring的报错信息，我们一般是从后面往前看</p>
<h3 id="工厂方法创建bean"><a href="#工厂方法创建bean" class="headerlink" title="工厂方法创建bean"></a>工厂方法创建bean</h3><p>使用静态工厂的方式创建bean</p>
<p>先创建testFactory类</p>
<figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.testbean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">testFactory</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> test testfac()&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="type">test</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>然后我们在配置文件中写下</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean <span class="attribute">id</span>=<span class="string">&quot;factory&quot;</span> <span class="attribute">class</span>=<span class="string">&quot;org.example.testbean.testFactory&quot;</span> <span class="attribute">factory-method</span>=<span class="string">&quot;testfac&quot;</span>&gt;&lt;/bean&gt;</span><br></pre></td></tr></table></figure>

<p>然后再app类中执行的方法和上面一样</p>
<h3 id="实例工厂初始化bean"><a href="#实例工厂初始化bean" class="headerlink" title="实例工厂初始化bean"></a>实例工厂初始化bean</h3><p>创建个工厂类</p>
<figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.testbean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">testFactory</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span>  test testfac()&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="type">test</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>修改配置如下</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean <span class="attribute">id</span>=<span class="string">&quot;factory&quot;</span> <span class="attribute">class</span>=<span class="string">&quot;org.example.testbean.testFactory&quot;</span>&gt;&lt;/bean&gt;</span><br><span class="line">&lt;bean <span class="attribute">id</span>=<span class="string">&quot;test&quot;</span> <span class="attribute">factory-method</span>=<span class="string">&quot;testfac&quot;</span> <span class="attribute">factory-bean</span>=<span class="string">&quot;factory&quot;</span>&gt;&lt;/bean&gt;</span><br></pre></td></tr></table></figure>

<p>然后正常调用test就ok了</p>
<h3 id="使用接口创建"><a href="#使用接口创建" class="headerlink" title="使用接口创建"></a>使用接口创建</h3><p>我们思考，因为上面两种每次改一次就要去配置文件进行修改，有点太麻烦了，我们可以创建一个类实现FactorBean的接口如下</p>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.testbean;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">import</span> org.springframework.beans.factory.FactoryBean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">testFactory2</span> <span class="keyword">implements</span> <span class="title">FactoryBean</span>&lt;<span class="title">test</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function">test <span class="title">getObject</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> test(); <span class="comment">// 要返回的对象</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Class&lt;?&gt; getObjectType() &#123;</span><br><span class="line">        <span class="keyword">return</span> test.class;<span class="comment">//new 的对象的class</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">boolean</span> <span class="title">isSingleton</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;<span class="comment">//是不是单例</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>如上：然后再配置文件里写入，</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean <span class="attribute">id</span>=<span class="string">&quot;factory2&quot;</span> <span class="attribute">class</span>=<span class="string">&quot;org.example.testbean.testFactory2&quot;</span>&gt;&lt;/bean&gt;</span><br></pre></td></tr></table></figure>

<p>正常调用即可</p>
<p>经过上述，我们知道，我们实例化bean的方式大体上有三种，但是细分则是四种，因为最后一个是第三种的变种</p>
<h2 id="bean的生命周期"><a href="#bean的生命周期" class="headerlink" title="bean的生命周期"></a>bean的生命周期</h2><p>生命周期 ： 从创建到消亡的完整过程</p>
<p>bean生命周期 ： bean从创建到销毁的整体过程</p>
<p>bean生命周期的控制：再bean创建后到销毁前做的一些事情</p>
<p>代码及思路如下 ：</p>
<p>要进行生命周期的控制，我们就是控制bean创建的时候和销毁的时候做一些事情</p>
<p>我们在test中加入如下代码</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">package org.example.testbean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">test</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printhello</span>()</span>&#123;</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">&quot;hellospringbean&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span>  <span class="title">init</span>()</span>&#123;</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">&quot;init&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destory</span>()</span>&#123;</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">&quot;destory&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>上面定义的init以及destory就是我们定义的初始化方法和销毁方法</p>
<p>然后我们要告诉我们的容器，我们的初始化方法和销毁方法</p>
<p>在配置文件里如下写</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean <span class="attribute">id</span>=<span class="string">&quot;hellobean&quot;</span> <span class="attribute">class</span>=<span class="string">&quot;org.example.testbean.test&quot;</span> <span class="attribute">init-method</span>=<span class="string">&quot;init&quot;</span> <span class="attribute">destroy-method</span>=<span class="string">&quot;destory&quot;</span>&gt;&lt;/bean&gt;</span><br></pre></td></tr></table></figure>

<p>最后在主程序调用的时候如下写</p>
<figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.example.testbean.test;</span><br><span class="line"><span class="keyword">import</span> org.example.testbean.test2;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Hello world!</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> </span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> void main( <span class="keyword">String</span>[] args )</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这里不用ApplicationContext的原因是它并没有close的方法，是它的子类实现的接口有这个方法，所以就换成它的子类   </span></span><br><span class="line"><span class="comment">// ApplicationContext stx = new ClassPathXmlApplicationContext(&quot;applicationContext.xml&quot;);</span></span><br><span class="line">        ClassPathXmlApplicationContext stx = <span class="keyword">new</span> <span class="type">ClassPathXmlApplicationContext</span>(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">        test hellobean = (test) stx.getBean(<span class="string">&quot;hellobean&quot;</span>);</span><br><span class="line">        hellobean.printhello();</span><br><span class="line">        <span class="comment">// 这个是比较暴力的方法直接杀死容器</span></span><br><span class="line">        <span class="comment">//stx.close();</span></span><br><span class="line">        <span class="comment">// 这个是告诉jvm当退出的时候关闭容器</span></span><br><span class="line">        stx.registerShutdownHook();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>运行程序结果如下</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">init</span><br><span class="line">hellospringbean</span><br><span class="line">destory</span><br><span class="line"></span><br><span class="line">Process finished with <span class="keyword">exit</span> code <span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>但是我觉得上述的步骤还是有点麻烦</p>
<p>我们可以让它在创建方法的时候就是直接把它标记为初始化方法以及销毁方法</p>
<p>在test2中进行如下操作</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">package org.example.testbean;</span><br><span class="line"></span><br><span class="line">import org.springframework.beans.factory.DisposableBean;</span><br><span class="line">import org.springframework.beans.factory.InitializingBean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">test2</span> <span class="title">implements</span> <span class="title">InitializingBean</span> , <span class="title">DisposableBean</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> test tx;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span>  <span class="title">printhellobean</span>()</span>&#123;</span><br><span class="line">        tx.printhello();</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">&quot;Secondly hello &quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">test2</span>()</span> &#123;</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">&quot;Constru&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> test <span class="title">getTx</span>()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> tx;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTx</span>(<span class="params">test tx</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.tx = tx;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span>() throws Exception</span> &#123;</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">&quot;destrory test2&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterPropertiesSet</span>() throws Exception</span> &#123;</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">&quot;init test2&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>然后我们在主程序中调用test2所对应的beanid</p>
<figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.example.testbean.test;</span><br><span class="line"><span class="keyword">import</span> org.example.testbean.test2;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Hello world!</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> </span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> void main( <span class="keyword">String</span>[] args )</span><br><span class="line">    &#123;</span><br><span class="line"><span class="comment">//        ApplicationContext stx = new ClassPathXmlApplicationContext(&quot;applicationContext.xml&quot;);</span></span><br><span class="line">        ClassPathXmlApplicationContext stx = <span class="keyword">new</span> <span class="type">ClassPathXmlApplicationContext</span>(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">        test2 hellobean = (test2) stx.getBean(<span class="string">&quot;hellobean2&quot;</span>);</span><br><span class="line">        hellobean.printhellobean();</span><br><span class="line">        <span class="comment">// 这个是比较暴力的方法直接杀死容器</span></span><br><span class="line">        <span class="comment">//stx.close();</span></span><br><span class="line">        <span class="comment">// 这个是告诉jvm当退出的时候关闭容器</span></span><br><span class="line">        stx.registerShutdownHook();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>执行结果如下</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">init</span></span><br><span class="line">Constru</span><br><span class="line"><span class="keyword">init</span> test2</span><br><span class="line">hellospringbean</span><br><span class="line">Secondly hello </span><br><span class="line">destrory test2</span><br><span class="line">destory</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>解释：</p>
<p>第一个init是test中的初始化方法，第二个是test2的构造器方法，然后才是test2的bean方法销毁也是同理，最后销毁test容器</p>
<p>所以bean的初始化方法的执行时间是在test的构造器方法之后的</p>
<h2 id="依赖的注入方式"><a href="#依赖的注入方式" class="headerlink" title="依赖的注入方式"></a>依赖的注入方式</h2><p>有几种方式可以传递数据往类里传递</p>
<ul>
<li>普通方法 ： set</li>
<li>构造方法</li>
</ul>
<p>在bean创建对象的时候如果我们一个类里需要的并不是引用类型，就是要基本类型改怎么办？</p>
<ul>
<li>Setter 注入<ul>
<li>简单类型</li>
<li>引用类型</li>
</ul>
</li>
<li>构造器注入<ul>
<li>简单类型</li>
<li>引用类型</li>
</ul>
</li>
</ul>
<h2 id="Setter注入"><a href="#Setter注入" class="headerlink" title="Setter注入"></a>Setter注入</h2><h3 id="注入引用类型"><a href="#注入引用类型" class="headerlink" title="注入引用类型"></a>注入引用类型</h3><p>上述已经实现过了，通过在配置里写入</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean <span class="built_in">id</span>=<span class="string">&quot;hellobean2&quot;</span> <span class="built_in">class</span>=<span class="string">&quot;org.example.testbean.test2&quot;</span>&gt;</span><br><span class="line">    &lt;<span class="keyword">property</span> <span class="built_in">name</span>=<span class="string">&quot;tx&quot;</span> <span class="keyword">ref</span>=<span class="string">&quot;hellobean&quot;</span>&gt;&lt;/<span class="keyword">property</span>&gt;</span><br><span class="line">&lt;/bean&gt;</span><br></pre></td></tr></table></figure>

<p>就可以但是当他是多个的时候我们可以在中间再加上一样的语句，就可以就是多加几个这 <code>&lt;property name=&quot;tx&quot; ref=&quot;hellobean&quot;&gt;&lt;/property&gt;</code></p>
<h3 id="注入基本类型"><a href="#注入基本类型" class="headerlink" title="注入基本类型"></a>注入基本类型</h3><p>我们先在test中编写如下代码</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">package org.example.testbean;</span><br><span class="line"></span><br><span class="line">import java.util.stream.StreamSupport;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">test</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String mysqlname;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">int</span> maxConnection;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getMysqlname</span>()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> mysqlname;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMysqlname</span>(<span class="params">String mysqlname</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.mysqlname = mysqlname;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">int</span> <span class="title">getMaxConnection</span>()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> maxConnection;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMaxConnection</span>(<span class="params"><span class="built_in">int</span> maxConnection</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.maxConnection = maxConnection;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printhello</span>()</span>&#123;</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">&quot;hellospringbean&quot;</span> + mysqlname + maxConnection);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span>  <span class="title">init</span>()</span>&#123;</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">&quot;init&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destory</span>()</span>&#123;</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">&quot;destory&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>然后我们在配置中编写</p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean id<span class="operator">=</span><span class="string">&quot;hellobean&quot;</span> class<span class="operator">=</span><span class="string">&quot;org.example.testbean.test&quot;</span> init-method<span class="operator">=</span><span class="string">&quot;init&quot;</span> destroy-method<span class="operator">=</span><span class="string">&quot;destory&quot;</span>&gt;</span><br><span class="line">    &lt;property name<span class="operator">=</span><span class="string">&quot;mysqlname&quot;</span> value<span class="operator">=</span><span class="string">&quot;dl2262&quot;</span>&gt;&lt;/property&gt;</span><br><span class="line">    &lt;property name<span class="operator">=</span><span class="string">&quot;maxConnection&quot;</span> value<span class="operator">=</span><span class="string">&quot;10&quot;</span>&gt;&lt;/property&gt;</span><br><span class="line">&lt;/bean&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这里value传值是什么类型的我们不用多管因为spring会自动帮我们转换类型</p>
<p>运行主程序结果</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">init</span></span><br><span class="line">Constru</span><br><span class="line"><span class="keyword">init</span> test2</span><br><span class="line">hellospringbeandl226210</span><br><span class="line">destrory test2</span><br><span class="line">destory</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>解释 ： spring关联两个容器的时候，并不是说你调用其中一个容器另外一个容器就完全没反应，它本质上还是初始化两个容器，只不过根据你调用的方法不同显示和不显示而已</p>
<p>因为在配置中</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean <span class="built_in">id</span>=<span class="string">&quot;hellobean2&quot;</span> <span class="built_in">class</span>=<span class="string">&quot;org.example.testbean.test2&quot;</span>&gt;</span><br><span class="line">    &lt;<span class="keyword">property</span> <span class="built_in">name</span>=<span class="string">&quot;tx&quot;</span> <span class="keyword">ref</span>=<span class="string">&quot;hellobean&quot;</span>&gt;&lt;/<span class="keyword">property</span>&gt;</span><br><span class="line">&lt;/bean&gt;</span><br></pre></td></tr></table></figure>

<p>test2是和test关联在一起的，所以test2的初始化bean和销毁bean也在这里，但是它并没有执行test2的构造器方法，也就是并没有实力这个类，它只是走了容器的初始和销毁</p>
<h2 id="构造器注入"><a href="#构造器注入" class="headerlink" title="构造器注入"></a>构造器注入</h2><p>首先构造器注入分为三种</p>
<h3 id="最标准的构造器注入"><a href="#最标准的构造器注入" class="headerlink" title="最标准的构造器注入"></a>最标准的构造器注入</h3><p>首先我们在test中编写如下</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">package org.<span class="property">example</span>.<span class="property">testbean</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.<span class="property">util</span>.<span class="property">stream</span>.<span class="property">StreamSupport</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">test</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">String</span> mysqlname;</span><br><span class="line">    <span class="keyword">private</span> int maxConnection;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">test</span>(<span class="params"><span class="built_in">String</span> mysqlname, int maxConnection</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">mysqlname</span> = mysqlname;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">maxConnection</span> = maxConnection;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">String</span> <span class="title function_">getMysqlname</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> mysqlname;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">setMysqlname</span>(<span class="params"><span class="built_in">String</span> mysqlname</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">mysqlname</span> = mysqlname;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> int <span class="title function_">getMaxConnection</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> maxConnection;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">setMaxConnection</span>(<span class="params">int maxConnection</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">maxConnection</span> = maxConnection;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">printhello</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="title class_">System</span>.<span class="property">out</span>.<span class="title function_">println</span>(<span class="string">&quot;hellospringbean&quot;</span> + mysqlname + maxConnection);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span>  <span class="title function_">init</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="title class_">System</span>.<span class="property">out</span>.<span class="title function_">println</span>(<span class="string">&quot;init&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">destory</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="title class_">System</span>.<span class="property">out</span>.<span class="title function_">println</span>(<span class="string">&quot;destory&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>然后再在配置文件中编写</p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean id<span class="operator">=</span><span class="string">&quot;hellobean&quot;</span> class<span class="operator">=</span><span class="string">&quot;org.example.testbean.test&quot;</span> init-method<span class="operator">=</span><span class="string">&quot;init&quot;</span> destroy-method<span class="operator">=</span><span class="string">&quot;destory&quot;</span>&gt;</span><br><span class="line">    &lt;constructor-arg name<span class="operator">=</span><span class="string">&quot;maxConnection&quot;</span> value<span class="operator">=</span><span class="string">&quot;1000&quot;</span>&gt;</span><br><span class="line">    &lt;/constructor-arg&gt;</span><br><span class="line">    &lt;constructor-arg name<span class="operator">=</span><span class="string">&quot;mysqlname&quot;</span> value<span class="operator">=</span><span class="string">&quot;dl2262&quot;</span>&gt;&lt;/constructor-arg&gt;</span><br><span class="line">&lt;/bean&gt;</span><br></pre></td></tr></table></figure>

<p>执行主程序的app</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">init</span></span><br><span class="line">Constru</span><br><span class="line"><span class="keyword">init</span> test2</span><br><span class="line">hellospringbeandl22621000</span><br><span class="line">destrory test2</span><br><span class="line">destory</span><br></pre></td></tr></table></figure>

<p>然后是传入引用类型</p>
<p>先在test2中如下编写</p>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example.testbean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.DisposableBean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.InitializingBean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">test2</span> <span class="keyword">implements</span> <span class="title">InitializingBean</span> , <span class="title">DisposableBean</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> test tx;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span>  <span class="title">printhellobean</span><span class="params">()</span></span>&#123;</span><br><span class="line">        tx.printhello();</span><br><span class="line">        System.out.println(<span class="string">&quot;Secondly hello &quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">test2</span><span class="params">(test tx)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.tx = tx;</span><br><span class="line">        System.out.println(<span class="string">&quot;Constru&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function">test <span class="title">getTx</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> tx;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">setTx</span><span class="params">(test tx)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.tx = tx;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;destrory test2&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">afterPropertiesSet</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;init test2&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>然后在配置文件中编写</p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean id<span class="operator">=</span><span class="string">&quot;hellobean2&quot;</span> class<span class="operator">=</span><span class="string">&quot;org.example.testbean.test2&quot;</span>&gt;</span><br><span class="line">    &lt;constructor-arg name<span class="operator">=</span><span class="string">&quot;tx&quot;</span> ref<span class="operator">=</span><span class="string">&quot;hellobean&quot;</span>&gt;&lt;/constructor-arg&gt;</span><br><span class="line">&lt;/bean&gt;</span><br></pre></td></tr></table></figure>

<p>执行主程序中的app</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">init</span></span><br><span class="line">Constru</span><br><span class="line"><span class="keyword">init</span> test2</span><br><span class="line">hellospringbeandl22621000</span><br><span class="line">Secondly hello </span><br><span class="line">destrory test2</span><br><span class="line">destory</span><br></pre></td></tr></table></figure>

<p>结果如上</p>
<p>上述在配置里传入的参数是形参，就是构造器方法的变量的名字，有人就说这样传参，会不会导致偶合过高，和spring的初衷不符合，事实也是如此</p>
<h3 id="第二种构造器"><a href="#第二种构造器" class="headerlink" title="第二种构造器"></a>第二种构造器</h3><p>在配置文件中如下</p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean id<span class="operator">=</span><span class="string">&quot;hellobean&quot;</span> class<span class="operator">=</span><span class="string">&quot;org.example.testbean.test&quot;</span> init-method<span class="operator">=</span><span class="string">&quot;init&quot;</span> destroy-method<span class="operator">=</span><span class="string">&quot;destory&quot;</span>&gt;</span><br><span class="line">    &lt;constructor-arg type<span class="operator">=</span><span class="string">&quot;java.lang.Integer&quot;</span> value<span class="operator">=</span><span class="string">&quot;1000&quot;</span>&gt;</span><br><span class="line">    &lt;/constructor-arg&gt;</span><br><span class="line">    &lt;constructor-arg type<span class="operator">=</span><span class="string">&quot;java.lang.String&quot;</span> value<span class="operator">=</span><span class="string">&quot;dl2262&quot;</span>&gt;&lt;/constructor-arg&gt;</span><br><span class="line">&lt;/bean&gt;</span><br></pre></td></tr></table></figure>

<p>这种的确在某种程度上解决了偶合问题，不过却又引发出一种新问题，就是因为他说按照类型来给值的，如果构造器种有两个一样类型的值？如何解决</p>
<h3 id="第三种构造器"><a href="#第三种构造器" class="headerlink" title="第三种构造器"></a>第三种构造器</h3><p>配置文件如下</p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean id<span class="operator">=</span><span class="string">&quot;hellobean2&quot;</span> class<span class="operator">=</span><span class="string">&quot;org.example.testbean.test2&quot;</span>&gt;</span><br><span class="line">    &lt;constructor-arg index<span class="operator">=</span><span class="string">&quot;0&quot;</span> ref<span class="operator">=</span><span class="string">&quot;hellobean&quot;</span>&gt;&lt;/constructor-arg&gt;</span><br><span class="line">&lt;/bean&gt;</span><br></pre></td></tr></table></figure>

<p>就是用下标来控制</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>构造器方法相比于setter方法是更快速，但是相对而言，如果出错也危害更大</p>
<p>自己定义的模块一般都采用setter，而官方的框架之类的一般都采用构造器的</p>
<h2 id="自动装入"><a href="#自动装入" class="headerlink" title="自动装入"></a>自动装入</h2><p>spring帮我们自动装配</p>
<p>自动装配的方式：</p>
<ul>
<li>按类型：常用</li>
<li>按名称</li>
<li>按构造方法</li>
<li>不启用自动装配</li>
</ul>
<p>我们先查看配置文件</p>
<p>如下</p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean id<span class="operator">=</span><span class="string">&quot;hellobean2&quot;</span> class<span class="operator">=</span><span class="string">&quot;org.example.testbean.test2&quot;</span>&gt;</span><br><span class="line">    &lt;constructor-arg index<span class="operator">=</span><span class="string">&quot;0&quot;</span> ref<span class="operator">=</span><span class="string">&quot;hellobean&quot;</span>&gt;&lt;/constructor-arg&gt;</span><br><span class="line">&lt;/bean&gt;</span><br></pre></td></tr></table></figure>

<p>我们把其改成</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">    &lt;bean <span class="attribute">id</span>=<span class="string">&quot;hellobean2&quot;</span> <span class="attribute">class</span>=<span class="string">&quot;org.example.testbean.test2&quot;</span> <span class="attribute">autowire</span>=<span class="string">&quot;byType&quot;</span>&gt;&lt;/bean&gt;</span><br><span class="line">或者</span><br><span class="line">    &lt;bean <span class="attribute">id</span>=<span class="string">&quot;hellobean2&quot;</span> <span class="attribute">class</span>=<span class="string">&quot;org.example.testbean.test2&quot;</span> <span class="attribute">autowire</span>=<span class="string">&quot;byName&quot;</span>&gt;&lt;/bean&gt;</span><br><span class="line">等等</span><br></pre></td></tr></table></figure>

<p>就变成自动装配了</p>
<p>注意点：</p>
<p>关于自动装配一般不装配基本数据，而且如果自动装配是装配byname ，则要求你构造器的形参和bean的id是一样的，如果是bytype则要求不能有一样的类</p>
<h2 id="传递参数数组集合的"><a href="#传递参数数组集合的" class="headerlink" title="传递参数数组集合的"></a>传递参数数组集合的</h2><p>数组</p>
<p>List</p>
<p>Set</p>
<p>Map</p>
<p>Properties</p>
<p>在test中写下</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line">package org.<span class="property">example</span>.<span class="property">testbean</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.<span class="property">util</span>.<span class="property">List</span>;</span><br><span class="line"><span class="keyword">import</span> java.<span class="property">util</span>.<span class="property">Map</span>;</span><br><span class="line"><span class="keyword">import</span> java.<span class="property">util</span>.<span class="property">Properties</span>;</span><br><span class="line"><span class="keyword">import</span> java.<span class="property">util</span>.<span class="property">Set</span>;</span><br><span class="line"><span class="keyword">import</span> java.<span class="property">util</span>.<span class="property">stream</span>.<span class="property">StreamSupport</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">test</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">String</span> mysqlname;</span><br><span class="line">    <span class="keyword">private</span> int maxConnection;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> int[] array;</span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">List</span>&lt;<span class="title class_">String</span>&gt; <span class="title class_">List</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">Set</span>&lt;<span class="title class_">String</span>&gt; <span class="title class_">Set</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">Map</span>&lt;<span class="title class_">String</span> , <span class="title class_">String</span>&gt; <span class="title class_">Map</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">Properties</span> properties;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> int[] <span class="title function_">getArray</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> array;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">setArray</span>(<span class="params">int[] array</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">array</span> = array;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> java.<span class="property">util</span>.<span class="property">List</span>&lt;<span class="title class_">String</span>&gt; <span class="title function_">getList</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">List</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">setList</span>(<span class="params">java.util.List&lt;<span class="built_in">String</span>&gt; list</span>) &#123;</span><br><span class="line">        <span class="title class_">List</span> = list;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> java.<span class="property">util</span>.<span class="property">Set</span>&lt;<span class="title class_">String</span>&gt; <span class="title function_">getSet</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Set</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">setSet</span>(<span class="params">java.util.<span class="built_in">Set</span>&lt;<span class="built_in">String</span>&gt; set</span>) &#123;</span><br><span class="line">        <span class="title class_">Set</span> = set;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> java.<span class="property">util</span>.<span class="property">Map</span>&lt;<span class="title class_">String</span>, <span class="title class_">String</span>&gt; <span class="title function_">getMap</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Map</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">setMap</span>(<span class="params">java.util.<span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="built_in">String</span>&gt; map</span>) &#123;</span><br><span class="line">        <span class="title class_">Map</span> = map;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">Properties</span> <span class="title function_">getProperties</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> properties;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">setProperties</span>(<span class="params">Properties properties</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">properties</span> = properties;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">test</span>(<span class="params"><span class="built_in">String</span> mysqlname, int maxConnection</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">mysqlname</span> = mysqlname;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">maxConnection</span> = maxConnection;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">String</span> <span class="title function_">getMysqlname</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> mysqlname;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">setMysqlname</span>(<span class="params"><span class="built_in">String</span> mysqlname</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">mysqlname</span> = mysqlname;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> int <span class="title function_">getMaxConnection</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> maxConnection;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">setMaxConnection</span>(<span class="params">int maxConnection</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">maxConnection</span> = maxConnection;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">printhello</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="title class_">System</span>.<span class="property">out</span>.<span class="title function_">println</span>(<span class="string">&quot;hellospringbean&quot;</span> + mysqlname + maxConnection);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span>  <span class="title function_">init</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="title class_">System</span>.<span class="property">out</span>.<span class="title function_">println</span>(<span class="string">&quot;init&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">destory</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="title class_">System</span>.<span class="property">out</span>.<span class="title function_">println</span>(<span class="string">&quot;destory&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>然后再配置文件中写下</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;tx&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.example.testbean.test&quot;</span> <span class="attr">init-method</span>=<span class="string">&quot;init&quot;</span> <span class="attr">destroy-method</span>=<span class="string">&quot;destory&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">&quot;1&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1000&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;array&quot;</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">value</span>&gt;</span>100<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">value</span>&gt;</span>200<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">value</span>&gt;</span>300<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;set&quot;</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">value</span>&gt;</span>hdkjdsfhjk<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">value</span>&gt;</span>daskhkash<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;list&quot;</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">value</span>&gt;</span>dksahjdhak<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">value</span>&gt;</span>daskhkash<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;map&quot;</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">map</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;1&quot;</span> <span class="attr">value</span>=<span class="string">&quot;dfslkjfl&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;2&quot;</span> <span class="attr">value</span>=<span class="string">&quot;dfslkjfl&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;properties&quot;</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">props</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">&quot;sdakjl&quot;</span>&gt;</span>adslald<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">&quot;sdakjlw&quot;</span>&gt;</span>adslald<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;/<span class="name">props</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">type</span>=<span class="string">&quot;java.lang.String&quot;</span> <span class="attr">value</span>=<span class="string">&quot;dl2262&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>就成功了</p>
<h2 id="数据源对象管理"><a href="#数据源对象管理" class="headerlink" title="数据源对象管理"></a>数据源对象管理</h2><p>在pom文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.16<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>然后在配置文件中加入</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span>  <span class="attr">class</span>=<span class="string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClassName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://bigdata2:3306/try&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;liuzihan010616&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>然后主方法写入</p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ClassPathXmlApplicationContext stx <span class="operator">=</span> new ClassPathXmlApplicationContext(<span class="string">&quot;applicationContext.xml&quot;</span>)<span class="comment">;</span></span><br><span class="line">        DataSource hellobean <span class="operator">=</span> (DataSource) stx.getBean(<span class="string">&quot;dataSource&quot;</span>)<span class="comment">;</span></span><br><span class="line">        System.out.println(hellobean)<span class="comment">;</span></span><br></pre></td></tr></table></figure>

<p>结果如下 ：</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="symbol">	CreateTime:</span><span class="string">&quot;2022-12-28 08:49:29&quot;</span>,</span><br><span class="line"><span class="symbol">	ActiveCount:</span><span class="number">0</span>,</span><br><span class="line"><span class="symbol">	PoolingCount:</span><span class="number">0</span>,</span><br><span class="line"><span class="symbol">	CreateCount:</span><span class="number">0</span>,</span><br><span class="line"><span class="symbol">	DestroyCount:</span><span class="number">0</span>,</span><br><span class="line"><span class="symbol">	CloseCount:</span><span class="number">0</span>,</span><br><span class="line"><span class="symbol">	ConnectCount:</span><span class="number">0</span>,</span><br><span class="line"><span class="symbol">	Connections:</span>[</span><br><span class="line">	]</span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>代表我们用druid成功</p>
<p>接下来我们换一个</p>
<p>在pom文件中加入</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>c3p0<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>c3p0<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.9.1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>然后再配置文件中写入</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span>  <span class="attr">class</span>=<span class="string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClassName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://bigdata2:3306/try&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;liuzihan010616&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.mchange.v2.c3p0.ComboPooledDataSource&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClass&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jdbcUrl&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://bigdata2:3306/try&quot;</span> &gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;user&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;liuzihan010616&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>主方法没变</p>
<p>执行结果如下：</p>
<figure class="highlight xl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">com</span>.mchange.v2.c3p0.ComboPooledDataSource [ acquireIncrement -&gt;</span> <span class="number">3</span>, <span class="function"><span class="title">acquireRetryAttempts</span> -&gt;</span> <span class="number">30</span>, <span class="function"><span class="title">acquireRetryDelay</span> -&gt;</span> <span class="number">1000</span>, <span class="function"><span class="title">autoCommitOnClose</span> -&gt;</span> <span class="function"><span class="title">false</span>, automaticTestTable -&gt;</span> <span class="function"><span class="title">null</span>, breakAfterAcquireFailure -&gt;</span> <span class="function"><span class="title">false</span>, checkoutTimeout -&gt;</span> <span class="number">0</span>, <span class="function"><span class="title">connectionCustomizerClassName</span> -&gt;</span> <span class="function"><span class="title">null</span>, connectionTesterClassName -&gt;</span> <span class="function"><span class="title">com</span>.mchange.v2.c3p0.impl.DefaultConnectionTester, dataSourceName -&gt;</span> <span class="number">1</span><span class="function"><span class="title">hge16gatnx5ejf144h6k9</span>|5a4aa2f2, debugUnreturnedConnectionStackTraces -&gt;</span> <span class="function"><span class="title">false</span>, description -&gt;</span> <span class="function"><span class="title">null</span>, driverClass -&gt;</span> <span class="function"><span class="title">com</span>.mysql.jdbc.Driver, factoryClassLocation -&gt;</span> <span class="function"><span class="title">null</span>, forceIgnoreUnresolvedTransactions -&gt;</span> <span class="function"><span class="title">false</span>, identityToken -&gt;</span> <span class="number">1</span><span class="function"><span class="title">hge16gatnx5ejf144h6k9</span>|5a4aa2f2, idleConnectionTestPeriod -&gt;</span> <span class="number">0</span>, <span class="function"><span class="title">initialPoolSize</span> -&gt;</span> <span class="number">3</span>, <span class="function"><span class="title">jdbcUrl</span> -&gt;</span> <span class="function"><span class="title">jdbc</span>:mysql://bigdata2:3306/try, maxAdministrativeTaskTime -&gt;</span> <span class="number">0</span>, <span class="function"><span class="title">maxConnectionAge</span> -&gt;</span> <span class="number">0</span>, <span class="function"><span class="title">maxIdleTime</span> -&gt;</span> <span class="number">0</span>, <span class="function"><span class="title">maxIdleTimeExcessConnections</span> -&gt;</span> <span class="number">0</span>, <span class="function"><span class="title">maxPoolSize</span> -&gt;</span> <span class="number">15</span>, <span class="function"><span class="title">maxStatements</span> -&gt;</span> <span class="number">0</span>, <span class="function"><span class="title">maxStatementsPerConnection</span> -&gt;</span> <span class="number">0</span>, <span class="function"><span class="title">minPoolSize</span> -&gt;</span> <span class="number">3</span>, <span class="function"><span class="title">numHelperThreads</span> -&gt;</span> <span class="number">3</span>, <span class="function"><span class="title">numThreadsAwaitingCheckoutDefaultUser</span> -&gt;</span> <span class="number">0</span>, <span class="function"><span class="title">preferredTestQuery</span> -&gt;</span> <span class="function"><span class="title">null</span>, properties -&gt;</span> &#123;<span class="function"><span class="title">user</span>=******, password=******&#125;, propertyCycle -&gt;</span> <span class="number">0</span>, <span class="function"><span class="title">testConnectionOnCheckin</span> -&gt;</span> <span class="function"><span class="title">false</span>, testConnectionOnCheckout -&gt;</span> <span class="function"><span class="title">false</span>, unreturnedConnectionTimeout -&gt;</span> <span class="number">0</span>, <span class="function"><span class="title">usesTraditionalReflectiveProxies</span> -&gt;</span> <span class="literal">false</span> ]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>上述的所有都是可以再配置文件里进行设置的</p>
<p>如下：</p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean id<span class="operator">=</span><span class="string">&quot;dataSource&quot;</span> class<span class="operator">=</span><span class="string">&quot;com.mchange.v2.c3p0.ComboPooledDataSource&quot;</span>&gt;</span><br><span class="line">    &lt;property name<span class="operator">=</span><span class="string">&quot;driverClass&quot;</span> value<span class="operator">=</span><span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>&gt;&lt;/property&gt;</span><br><span class="line">    &lt;property name<span class="operator">=</span><span class="string">&quot;jdbcUrl&quot;</span> value<span class="operator">=</span><span class="string">&quot;jdbc:mysql://bigdata2:3306/try&quot;</span> &gt;&lt;/property&gt;</span><br><span class="line">    &lt;property name<span class="operator">=</span><span class="string">&quot;user&quot;</span> value<span class="operator">=</span><span class="string">&quot;root&quot;</span>&gt;&lt;/property&gt;</span><br><span class="line">    &lt;property name<span class="operator">=</span><span class="string">&quot;password&quot;</span> value<span class="operator">=</span><span class="string">&quot;liuzihan010616&quot;</span>&gt;&lt;/property&gt;</span><br><span class="line">    &lt;property name<span class="operator">=</span><span class="string">&quot;maxPoolSize&quot;</span> value<span class="operator">=</span><span class="string">&quot;1000&quot;</span>&gt;&lt;/property&gt;</span><br><span class="line">&lt;/bean&gt;</span><br></pre></td></tr></table></figure>

<p>上述就是简单的通过bean使用连接池的方法</p>
<h3 id="加载properties"><a href="#加载properties" class="headerlink" title="加载properties"></a>加载properties</h3><p>通过bean加载properties</p>
<p>首先创建一个properties文件</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">jdbc.driver</span>=com.mysql.jdbc.Driver</span><br><span class="line"><span class="attr">jdbc.url</span>=dbc:mysql://bigdata2:<span class="number">3306</span>/try</span><br><span class="line"><span class="attr">jdbc.user</span>=root</span><br><span class="line"><span class="attr">jdbc.password</span>=liuzihan010616</span><br></pre></td></tr></table></figure>

<p>然后要在配置文件中新建个命名空间如下，我们新建的命名空间是context</p>
<figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans </span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">       http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">       http://www.springframework.org/schema/context  </span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">       http://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">------------------------------------使用命名空间</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;classpath:jdbc.properties&quot;</span> <span class="attr">system-properties-mode</span>=<span class="string">&quot;NEVER&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">context:property-placeholder</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">// 其中system-properties-mode 是设置系统变量的优先级，要不然系统变量如果和properties变量和名称重复，则会用系统变量的名</span></span><br><span class="line"><span class="language-xml">// location是设置要加载的properties的地址，这里可以用正则的,比如 *.properties</span></span><br><span class="line"><span class="language-xml">// 多个properties文件的时候用，分割</span></span><br><span class="line"><span class="language-xml">------------------------------------使用配置文件</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.mchange.v2.c3p0.ComboPooledDataSource&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClass&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$</span></span></span><span class="template-variable">&#123;jdbc.driver&#125;</span><span class="language-xml"><span class="tag"><span class="string">&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jdbcUrl&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$</span></span></span><span class="template-variable">&#123;jdbc.url&#125;</span><span class="language-xml"><span class="tag"><span class="string">&quot;</span> &gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;user&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$</span></span></span><span class="template-variable">&#123;jdbc.user&#125;</span><span class="language-xml"><span class="tag"><span class="string">&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$</span></span></span><span class="template-variable">&#123;jdbc.password&#125;</span><span class="language-xml"><span class="tag"><span class="string">&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxPoolSize&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1000&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br></pre></td></tr></table></figure>

<h2 id="容器"><a href="#容器" class="headerlink" title="容器"></a>容器</h2><p>初始化容器的两种方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.example.testbean.test;</span><br><span class="line"><span class="keyword">import</span> org.example.testbean.test2;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.FileSystemXmlApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.sql.DataSource;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Hello world!</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">App</span> </span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">( String[] args )</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//加载类路径下的配置文件</span></span><br><span class="line"><span class="comment">//        ApplicationContext stx = new ClassPathXmlApplicationContext(&quot;applicationContext.xml&quot;);</span></span><br><span class="line">        <span class="type">ClassPathXmlApplicationContext</span> <span class="variable">stx</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">        <span class="comment">// 加载绝对路径下的配置文件</span></span><br><span class="line">        <span class="type">FileSystemXmlApplicationContext</span> <span class="variable">stx2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileSystemXmlApplicationContext</span>(<span class="string">&quot;F:\\bigdatajava\\src\\main\\resources\\applicationContext.xml&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//下面三种都行</span></span><br><span class="line">        <span class="type">DataSource</span> <span class="variable">hellobean</span> <span class="operator">=</span> (DataSource) stx.getBean(<span class="string">&quot;dataSource&quot;</span>);</span><br><span class="line">  </span><br><span class="line">        <span class="type">DataSource</span> <span class="variable">dataSource</span> <span class="operator">=</span> stx.getBean(<span class="string">&quot;dataSource&quot;</span> , DataSource.class);</span><br><span class="line">  </span><br><span class="line">        <span class="type">DataSource</span> <span class="variable">dataSource1</span> <span class="operator">=</span> stx.getBean(DataSource.class);</span><br><span class="line">	<span class="comment">//_------------------------------------------------------------------------------------------</span></span><br><span class="line">        System.out.println(hellobean);</span><br><span class="line">        <span class="comment">//hellobean.printhello();</span></span><br><span class="line">        <span class="comment">// 这个是比较暴力的方法直接杀死容器</span></span><br><span class="line">        <span class="comment">//stx.close();</span></span><br><span class="line">        <span class="comment">// 这个是告诉jvm当退出的时候关闭容器</span></span><br><span class="line">        stx.registerShutdownHook();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>BeanFactory 是ApplicationContext的最顶层接口，所以用这个也可以达到容器的效果，不过因为他有缺陷，所以后来不用了</p>
<p>通过以下方法实例容器：</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Resource resource = <span class="keyword">new</span> <span class="constructor">ClassPathResource(<span class="string">&quot;applicationContext.xml&quot;</span>)</span>;</span><br><span class="line">BeanFactory bf = <span class="keyword">new</span> <span class="constructor">XmlBeanFactory(<span class="params">resource</span>)</span>;</span><br></pre></td></tr></table></figure>

<p>BeanFactory是延迟加载 ：就是不是之间把所用的类初始化，等到用到才会加载</p>
<p>我们可以在配置文件里加上 <code>lazy-init=&quot;true&quot;</code></p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean <span class="attribute">id</span>=<span class="string">&quot;tx&quot;</span> <span class="attribute">class</span>=<span class="string">&quot;org.example.testbean.test&quot;</span> <span class="attribute">init-method</span>=<span class="string">&quot;init&quot;</span> <span class="attribute">destroy-method</span>=<span class="string">&quot;destory&quot;</span> <span class="attribute">lazy-init</span>=<span class="string">&quot;true&quot;</span>&gt;</span><br></pre></td></tr></table></figure>

<p>就可以了</p>

      
    </div>

    
    
    

      
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://zihang.fun/2022/12/19/12-19/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="liu zihang">
      <meta itemprop="description" content="只有努力不会辜负你">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="枫叶冢">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/12/19/12-19/" class="post-title-link" itemprop="url">clickHouse</a>
        </h2>

        <div class="post-meta">
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-12-19 13:14:27" itemprop="dateCreated datePublished" datetime="2022-12-19T13:14:27+08:00">2022-12-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-12-22 14:18:33" itemprop="dateModified" datetime="2022-12-22T14:18:33+08:00">2022-12-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%9D%82%E8%B4%A7%E6%8A%80%E6%9C%AF%E6%A0%88/" itemprop="url" rel="index"><span itemprop="name">杂货技术栈</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>6.4k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>6 分钟</span>
            </span>

        </div>
      </header>

    
    
    

   

    <div class="post-body" itemprop="articleBody">

      
          <h1 id="为什么选择CK"><a href="#为什么选择CK" class="headerlink" title="为什么选择CK"></a>为什么选择CK</h1><ol>
<li><strong>目前企业用户行为日志每天百亿量级，虽然经过数仓的分层以及数据汇总层通用维度指标的预计算，但有些个性化的分析场景还是需要直接编写程序或sql查询，这种情况下hive sql和spark sql的查询性能已无法满足用户需求，我们迫切的需要一个OLAP引擎来支持快速的即席查询。</strong></li>
<li><strong>BI存储库主要采用的是Infobright，在千万量级能很快的响应BI的查询请求，但随着时间推移和业务的发展，Infobright的并发量与查询瓶颈日益凸显，我们尝试将大数据量级的表导入TiDB、Hbase、ES等存储库，虽然对查询有一定的提速，但是也存在着相应的问题（后续章节会详细介绍），这时我们考虑到Clickhouse。</strong></li>
<li><strong>Clickhouse社区活跃度高、版本迭代非常快,几乎几天到十几天更新一个小版本，我们非常看好它以后的发展。</strong></li>
</ol>
<h1 id="ck特性"><a href="#ck特性" class="headerlink" title="ck特性"></a>ck特性</h1><p><strong>Clickhouse是俄罗斯yandex公司于2016年开源的一个列式数据库管理系统，在OLAP领域像一匹黑马一样，以其超高的性能受到业界的青睐。</strong>特性：</p>
<ul>
<li><strong>基于shard+replica实现的线性扩展和高可靠</strong></li>
<li><strong>采用列式存储，数据类型一致，压缩性能更高</strong></li>
<li><strong>硬件利用率高，连续IO，提高了磁盘驱动器的效率</strong></li>
<li><strong>向量化引擎与SIMD提高了CPU利用率，多核多节点并行化大查询</strong></li>
</ul>
<p><strong>不足：</strong></p>
<ul>
<li><strong>不支持事务、异步删除与更新</strong></li>
<li><strong>不适用高并发场景</strong></li>
</ul>
<h1 id="数据接入层"><a href="#数据接入层" class="headerlink" title="数据接入层"></a>数据接入层</h1><p><strong>提供了数据导入相关的服务及功能，按照数据的量级和特性我们抽象出三种Clickhouse导入数据的方式。</strong></p>
<ul>
<li><strong>方式一：数仓应用层小表导入</strong>这类数据量级相对较小，且分布在不同的数据源如hdfs、es、hbase等，这时我们提供基于DataX自研的TaskPlus数据流转+调度平台导入数据，单分区数据无并发写入，多分区数据小并发写入，且能和线上任务形成依赖关系，确保导入程序的可靠性。</li>
<li><strong>方式二：离线多维明细宽表导入</strong>这类数据一般是汇总层的明细数据或者是用户基于Hadoop生产的大量级数据，我们基于Spark开发了一个导入工具包，用户可以根据配置直接拉取hdfs或者hive上的数据到clickhouse，同时还能基于配置sql对数据进行ETL处理，工具包会根据配置集群的节点数以及Clickhouse集群负载情况(merges、processes)对local表进行高并发的写入，达到快速导数的目的。</li>
<li><strong>方式三：实时多维明细宽表导入</strong>实时数据接入场景比较固定，我们封装了通用的ClickhouseSink，将app、pc、m三端每日百亿级的数据通过Flink接入clickhouse，ClickhouseSink也提供了batchSize(单次导入数据量)及batchTime(单次导入时间间隔)供用户选择。</li>
</ul>
<h1 id="数据存储层"><a href="#数据存储层" class="headerlink" title="数据存储层"></a>数据存储层</h1><p><strong>数据存储层这里我们采用双副本机制来保证数据的高可靠，同时用nginx代理clickhouse集群，通过域名的方式进行读写操作，实现了数据均衡及高可靠写入，且对于域名的响应时间及流量有对应的实时监控，一旦响应速度出现波动或异常我们能在第一时间收到报警通知。</strong></p>
<ul>
<li><strong>nginx_one_replication：代理集群一半节点即一个完整副本，常用于写操作，在每次提交数据时由nginx均衡路由到对应的shard表，当某一个节点出现异常导致写入失败时，nginx会暂时剔除异常节点并报警，然后另选一台节点重新写入。</strong></li>
<li><strong>nginx_two_replication：代理集群所有节点，一般用作查询和无副本表数据写入，同时也会有对于异常节点的剔除和报警机制。</strong></li>
</ul>
<h1 id="数据服务层"><a href="#数据服务层" class="headerlink" title="数据服务层"></a>数据服务层</h1><ul>
<li><strong>对外：将集群查询统一封装为scf服务(RPC)，供外部调用。</strong></li>
<li><strong>对内：提供了客户端工具直接供分析师及开发人员使用。</strong></li>
</ul>
<h1 id="数据应用层"><a href="#数据应用层" class="headerlink" title="数据应用层"></a>数据应用层</h1><ul>
<li><strong>埋点系统：对接实时clickhouse集群，提供秒级别的OLAP查询功能。</strong></li>
<li><strong>用户分析平台：通过标签筛选的方式，从用户访问总集合中根据特定的用户行为捕获所需用户集。</strong></li>
<li><strong>BI：提供数据应用层的可视化展示，对接单分片多副本Clickhouse集群，可横向扩展。</strong></li>
</ul>
<h1 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h1><p>进行集群部署clickhouse的步骤很简单，不过有很多坑</p>
<p>首先执行</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install yum-utils</span><br><span class="line">sudo rpm --import https:<span class="regexp">//</span>repo.clickhouse.com/CLICKHOUSE-KEY.GPG</span><br><span class="line">sudo yum-config-manager --add-repo https:<span class="regexp">//</span>repo.clickhouse.com<span class="regexp">/rpm/</span>stable/x86_64</span><br></pre></td></tr></table></figure>

<p>然后用命令安装</p>
<figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install clickhouse-<span class="keyword">server</span> clickhouse-<span class="keyword">client</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>然后执行</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="regexp">/etc/i</span>nit.d/clickhouse-server start</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>启动服务后，可以使用命令行客户端连接到它:</p>
<figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#默认没有密码：</span></span><br><span class="line">clickhouse-<span class="keyword">client</span></span><br><span class="line"><span class="meta">#有密码：</span></span><br><span class="line">clickhouse-<span class="keyword">client</span> -u <span class="literal">default</span> --password</span><br></pre></td></tr></table></figure>

<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">:) <span class="keyword">SELECT</span> <span class="number">1</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">SELECT</span> <span class="number">1</span></span><br><span class="line"> </span><br><span class="line">┌─<span class="number">1</span>─┐</span><br><span class="line">│ <span class="number">1</span> │</span><br><span class="line">└───┘</span><br><span class="line"> </span><br><span class="line"><span class="number">1</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="built_in">set</span>. Elapsed: <span class="number">0.003</span> sec.</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>则基本完成，接下来我们修改配置文件进行集群部署</p>
<p>注意：接下来的操作要换成root用户</p>
<p>vi &#x2F;etc&#x2F;clickhouse-server&#x2F;users.xml修改我们的password</p>
<p>vi &#x2F;etc&#x2F;clickhouse-server&#x2F;config.xml 修改如下</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">#配置3分片2副本集群</span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">remote_servers</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">ck_cluster</span>&gt;</span>  <span class="comment">&lt;!--集群的名字，随意起 --&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 集群第一个分片 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">shard</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">weight</span>&gt;</span>1<span class="tag">&lt;/<span class="name">weight</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">internal_replication</span>&gt;</span>true<span class="tag">&lt;/<span class="name">internal_replication</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">replica</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">host</span>&gt;</span>ip1<span class="tag">&lt;/<span class="name">host</span>&gt;</span>   </span><br><span class="line">                    <span class="tag">&lt;<span class="name">port</span>&gt;</span>9000<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">replica</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">replica</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">host</span>&gt;</span>ip2<span class="tag">&lt;/<span class="name">host</span>&gt;</span>  </span><br><span class="line">                    <span class="tag">&lt;<span class="name">port</span>&gt;</span>9000<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">replica</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">shard</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 集群第二个分片 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">shard</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">weight</span>&gt;</span>1<span class="tag">&lt;/<span class="name">weight</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">internal_replication</span>&gt;</span>true<span class="tag">&lt;/<span class="name">internal_replication</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">replica</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">host</span>&gt;</span>ip3<span class="tag">&lt;/<span class="name">host</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">port</span>&gt;</span>9000<span class="tag">&lt;/<span class="name">port</span>&gt;</span> </span><br><span class="line">                <span class="tag">&lt;/<span class="name">replica</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">replica</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">host</span>&gt;</span>ip4<span class="tag">&lt;/<span class="name">host</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">port</span>&gt;</span>9000<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">replica</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">shard</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 集群第三个分片 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">shard</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">weight</span>&gt;</span>1<span class="tag">&lt;/<span class="name">weight</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">internal_replication</span>&gt;</span>true<span class="tag">&lt;/<span class="name">internal_replication</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">replica</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">host</span>&gt;</span>ip5<span class="tag">&lt;/<span class="name">host</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">port</span>&gt;</span>9000<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">replica</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">replica</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">host</span>&gt;</span>ip6<span class="tag">&lt;/<span class="name">host</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">port</span>&gt;</span>9000<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">replica</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">shard</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ck_cluster</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">remote_servers</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">zookeeper</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">node</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">host</span>&gt;</span>ip1<span class="tag">&lt;/<span class="name">host</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">port</span>&gt;</span>2181<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">node</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">node</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">host</span>&gt;</span>ip2<span class="tag">&lt;/<span class="name">host</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">port</span>&gt;</span>2181<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">node</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">node</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">host</span>&gt;</span>ip3<span class="tag">&lt;/<span class="name">host</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">port</span>&gt;</span>2181<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">node</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">zookeeper</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">&lt;!-- 定义该clickhouse实例存放什么 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">macros</span>&gt;</span></span><br><span class="line">              <span class="comment">&lt;!-- 几号分片 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">shard</span>&gt;</span>01<span class="tag">&lt;/<span class="name">shard</span>&gt;</span></span><br><span class="line">              <span class="comment">&lt;!-- 1分片的2副本 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">replica</span>&gt;</span>集群名-01-2<span class="tag">&lt;/<span class="name">replica</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">macros</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>还可以进行修改我们的数据文件以及日志存放的位置，不过有问题，因为clickhouse自己创建的文件默认分组和用户是clickhouse的所以要把权限赋值给我们的文件夹，chmod 777</p>
<p>然后我们进行重新启动我们的clickhouse，通过 <code>sudo systemctl restart clickhouse-server.service</code></p>
<p>然后通过命令登录clickhouse <code>clickhouse-client -u default --password liuzihan010616</code></p>
<p>然后我们输入select * from system.clusters; 查看一下自己的集群出现如下结果就成功了</p>
<figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Query id: a8bda66b-0e9b-4e52-a2ef-bf4450796d91</span><br><span class="line"></span><br><span class="line">┌─cluster────┬─shard_num─┬─shard_weight─┬─replica_num─┬─host_name─┬─host_address───┬─port─┬─is_local─┬─user────┬─default_database─┬─errors_count─┬─slowdowns_count─┬─estimated_recovery_time─┐</span><br><span class="line">│ ck_cluster │        <span class="number"> 1 </span>│           <span class="number"> 1 </span>│          <span class="number"> 1 </span>│ bigdata5  │ 192.168.41.134 │<span class="number"> 9000 </span>│       <span class="number"> 1 </span>│ default │                  │           <span class="number"> 0 </span>│              <span class="number"> 0 </span>│                      <span class="number"> 0 </span>│</span><br><span class="line">│ ck_cluster │        <span class="number"> 2 </span>│           <span class="number"> 1 </span>│          <span class="number"> 1 </span>│ bigdata4  │ 192.168.41.133 │<span class="number"> 9000 </span>│       <span class="number"> 0 </span>│ default │                  │           <span class="number"> 0 </span>│              <span class="number"> 0 </span>│                      <span class="number"> 0 </span>│</span><br><span class="line">│ ck_cluster │        <span class="number"> 3 </span>│           <span class="number"> 1 </span>│          <span class="number"> 1 </span>│ bigdata3  │ 192.168.41.132 │<span class="number"> 9000 </span>│       <span class="number"> 0 </span>│ default │                  │           <span class="number"> 0 </span>│              <span class="number"> 0 </span>│                      <span class="number"> 0 </span>│</span><br><span class="line">└────────────┴───────────┴──────────────┴─────────────┴───────────┴────────────────┴──────┴──────────┴─────────┴──────────────────┴──────────────┴─────────────────┴─────────────────────────┘</span><br><span class="line"></span><br><span class="line">3 rows in set. Elapsed: 0.001 sec. </span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>如果启动不成功，就输入 <code>journalctl -xe</code></p>
<p>查看系统日志，然后看报错信息解决</p>
<h1 id="mongo"><a href="#mongo" class="headerlink" title="mongo"></a>mongo</h1><p>mongo是一个非关系型的数据库，进而mysql不同，他的值都是key - &gt; value的</p>
<p>非关系型数据库(nosql ),属于文档型数据库。先解释一下文档的数据库，即可以存放xml、json、bson类型系那个的数据。这些数据具备自述性，呈现分层的树状数据结构。数据结构由键值(key&#x3D;&gt;value)对组成。</p>
<p>1、存储方式：虚拟内存+持久化。</p>
<p>2、查询语句：是独特的MongoDB的查询方式。</p>
<p>3、适合场景：事件的记录，内容管理或者博客平台等等。</p>
<p>4、架构特点：可以通过副本集，以及分片来实现高可用。</p>
<p>5、数据处理：数据是存储在硬盘上的，只不过需要经常读取的数据会被加载到内存中，将数据存储在物理内存中，从而达到高速读写。</p>
<p>6、成熟度与广泛度：新兴数据库，成熟度较低，Nosql数据库中最为接近关系型数据库，比较完善的DB之一，适用人群不断在增长。</p>
<h2 id="MongoDB优势与劣势"><a href="#MongoDB优势与劣势" class="headerlink" title="MongoDB优势与劣势"></a>MongoDB优势与劣势</h2><p>优势：</p>
<p>1、在适量级的内存的MongoDB的性能是非常迅速的，它将热数据存储在物理内存中，使得热数据的读写变得十分快。</p>
<p>2、MongoDB的高可用和集群架构拥有十分高的扩展性。</p>
<p>3、在副本集中，当主库遇到问题，无法继续提供服务的时候，副本集将选举一个新的主库继续提供服务。</p>
<p>4、MongoDB的Bson和JSon格式的数据十分适合文档格式的存储与查询。</p>
<p>劣势：</p>
<p>1、 不支持事务操作。MongoDB本身没有自带事务机制，若需要在MongoDB中实现事务机制，需通过一个额外的表，从逻辑上自行实现事务。 ACID</p>
<p>2、 应用经验少，由于NoSQL兴起时间短，应用经验相比关系型数据库较少。</p>
<p>3、MongoDB占用空间过大。</p>
<p>4、无join</p>
<p>其和mysql的对比如下<br><img src="https://pic.imgdb.cn/item/63a01e84b1fccdcd3663566e.jpg"></p>
<h2 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h2><p>1）表结构不明确且数据不断变大</p>
<p>MongoDB是非结构化文档数据库，扩展字段很容易且不会影响原有数据。内容管理或者博客平台等，例如圈子系统，存储用户评论之类的。</p>
<p>2）更高的写入负载</p>
<p>MongoDB侧重高数据写入的性能，而非事务安全，适合业务系统中有大量“低价值”数据的场景。本身存的就是json格式数据。例如做日志系统。</p>
<p>3）数据量很大或者将来会变得很大</p>
<p>Mysql单表数据量达到5-10G时会出现明显的性能降级，需要做数据的水平和垂直拆分、库的拆分完成扩展，MongoDB内建了sharding、很多数据分片的特性，容易水平扩展，比较好的适应大数据量增长的需求。</p>
<p>4）高可用性</p>
<p>自带高可用，自动主从切换（副本集）</p>
<p>不适用的场景</p>
<p>1）MongoDB不支持事务操作，需要用到事务的应用建议不用MongoDB。</p>
<p>2）MongoDB目前不支持join操作，需要复杂查询的应用也不建议使用MongoDB。</p>
<h2 id="关系型数据库和非关系型数据库的应用场景对比、"><a href="#关系型数据库和非关系型数据库的应用场景对比、" class="headerlink" title="关系型数据库和非关系型数据库的应用场景对比、"></a>关系型数据库和非关系型数据库的应用场景对比、</h2><p>关系型数据库适合存储结构化数据，如用户的帐号、地址：</p>
<p>1）这些数据通常需要做结构化查询，比如join，这时候，关系型数据库就要胜出一筹</p>
<p>2）这些数据的规模、增长的速度通常是可以预期的</p>
<p>3）事务性、一致性</p>
<p>　　</p>
<p>NoSQL适合存储非结构化数据，如文章、评论：</p>
<p>1）这些数据通常用于模糊处理，如全文搜索、机器学习</p>
<p>2）这些数据是海量的，而且增长的速度是难以预期的，</p>
<p>3）根据数据的特点，NoSQL数据库通常具有无限（至少接近）伸缩性</p>
<p>4）按key获取数据效率很高，但是对join或其他结构化查询的支持就比较差</p>
<p>相比较MySQL，MongoDB数据库更适合那些#读作业较重的任务模型。MongoDB能充分利用机器的内存资源。如果机器的内存资源丰富的话，MongoDB的查询效率会快很多。</p>
<p>在带”_id”插入数据的时候，MongoDB的插入效率其实并不高。如果想充分利用MongoDB性能的话，推荐采取不带”_id”的插入方式，然后对相关字段作索引来查询。</p>

      
    </div>

    
    
    

      
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://zihang.fun/2022/12/18/12-18/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="liu zihang">
      <meta itemprop="description" content="只有努力不会辜负你">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="枫叶冢">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/12/18/12-18/" class="post-title-link" itemprop="url">datax</a>
        </h2>

        <div class="post-meta">
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-12-18 09:35:34" itemprop="dateCreated datePublished" datetime="2022-12-18T09:35:34+08:00">2022-12-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-12-21 09:02:33" itemprop="dateModified" datetime="2022-12-21T09:02:33+08:00">2022-12-21</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%9D%82%E8%B4%A7%E6%8A%80%E6%9C%AF%E6%A0%88/" itemprop="url" rel="index"><span itemprop="name">杂货技术栈</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>10k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>9 分钟</span>
            </span>

        </div>
      </header>

    
    
    

   

    <div class="post-body" itemprop="articleBody">

      
          <h1 id="datax"><a href="#datax" class="headerlink" title="datax"></a>datax</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p><a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=DataX&spm=1001.2101.3001.7020">DataX</a> 是阿里开源的一个异构数据源离线同步工具，致力于实现包括关系型数据库(MySQL、Oracle等)、HDFS、Hive、ODPS、HBase、FTP等各种异构数据源之间稳定高效的数据同步功能。</p>
<h2 id="理念"><a href="#理念" class="headerlink" title="理念"></a>理念</h2><p>DataX本身作为数据同步框架，将不同数据源的同步抽象为从源头数据源读取数据的Reader插件，以及向目标端写入数据的Writer插件，理论上DataX框架可以支持任意数据源类型的数据同步工作。同时DataX插件体系作为一套生态系统, 每接入一套新数据源该新加入的数据源即可实现和现有的数据源互通</p>
<h2 id="框架设计"><a href="#框架设计" class="headerlink" title="框架设计"></a>框架设计</h2><p>DataX本身作为离线数据同步框架，采用Framework + plugin架构构建。将数据源读取和写入抽象成为Reader&#x2F;Writer插件，纳入到整个同步框架中。</p>
<p>Reader：Reader为数据采集模块，负责采集数据源的数据，将数据发送给Framework。</p>
<p>Writer： Writer为数据写入模块，负责不断向Framework取数据，并将数据写入到目的端</p>
<p>Framework：Framework用于连接reader和writer，作为两者的数据传输通道，并处理缓冲，流控，并发，数据转换等核心技术问题。</p>
<p>DataX目前已经有了比较全面的插件体系，主流的RDBMS数据库、NOSQL、大数据计算系统都已经接入，目前支持数据如下，详情请点击：<a target="_blank" rel="noopener" href="https://github.com/alibaba/DataX/wiki/DataX-all-data-channels">DataX数据源参考指南</a></p>
<table>
<thead>
<tr>
<th>类型</th>
<th>数据源</th>
<th align="center">Reader(读)</th>
<th align="center">Writer(写)</th>
<th align="center">文档</th>
</tr>
</thead>
<tbody><tr>
<td>RDBMS 关系型数据库</td>
<td>MySQL</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center"><a target="_blank" rel="noopener" href="https://github.com/alibaba/DataX/blob/master/mysqlreader/doc/mysqlreader.md">读</a> 、<a target="_blank" rel="noopener" href="https://github.com/alibaba/DataX/blob/master/mysqlwriter/doc/mysqlwriter.md">写</a></td>
</tr>
<tr>
<td></td>
<td>Oracle</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center"><a target="_blank" rel="noopener" href="https://github.com/alibaba/DataX/blob/master/oraclereader/doc/oraclereader.md">读</a> 、<a target="_blank" rel="noopener" href="https://github.com/alibaba/DataX/blob/master/oraclewriter/doc/oraclewriter.md">写</a></td>
</tr>
<tr>
<td></td>
<td>OceanBase</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center"><a target="_blank" rel="noopener" href="https://open.oceanbase.com/docs/community/oceanbase-database/V3.1.0/use-datax-to-full-migration-data-to-oceanbase">读</a> 、<a target="_blank" rel="noopener" href="https://open.oceanbase.com/docs/community/oceanbase-database/V3.1.0/use-datax-to-full-migration-data-to-oceanbase">写</a></td>
</tr>
<tr>
<td></td>
<td>SQLServer</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center"><a target="_blank" rel="noopener" href="https://github.com/alibaba/DataX/blob/master/sqlserverreader/doc/sqlserverreader.md">读</a> 、<a target="_blank" rel="noopener" href="https://github.com/alibaba/DataX/blob/master/sqlserverwriter/doc/sqlserverwriter.md">写</a></td>
</tr>
<tr>
<td></td>
<td>PostgreSQL</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center"><a target="_blank" rel="noopener" href="https://github.com/alibaba/DataX/blob/master/postgresqlreader/doc/postgresqlreader.md">读</a> 、<a target="_blank" rel="noopener" href="https://github.com/alibaba/DataX/blob/master/postgresqlwriter/doc/postgresqlwriter.md">写</a></td>
</tr>
<tr>
<td></td>
<td>DRDS</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center"><a target="_blank" rel="noopener" href="https://github.com/alibaba/DataX/blob/master/drdsreader/doc/drdsreader.md">读</a> 、<a target="_blank" rel="noopener" href="https://github.com/alibaba/DataX/blob/master/drdswriter/doc/drdswriter.md">写</a></td>
</tr>
<tr>
<td></td>
<td>Kingbase</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center"><a target="_blank" rel="noopener" href="https://github.com/alibaba/DataX/blob/master/drdsreader/doc/drdsreader.md">读</a> 、<a target="_blank" rel="noopener" href="https://github.com/alibaba/DataX/blob/master/drdswriter/doc/drdswriter.md">写</a></td>
</tr>
<tr>
<td></td>
<td>通用RDBMS(支持所有关系型数据库)</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center"><a target="_blank" rel="noopener" href="https://github.com/alibaba/DataX/blob/master/rdbmsreader/doc/rdbmsreader.md">读</a> 、<a target="_blank" rel="noopener" href="https://github.com/alibaba/DataX/blob/master/rdbmswriter/doc/rdbmswriter.md">写</a></td>
</tr>
<tr>
<td>阿里云数仓数据存储</td>
<td>ODPS</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center"><a target="_blank" rel="noopener" href="https://github.com/alibaba/DataX/blob/master/odpsreader/doc/odpsreader.md">读</a> 、<a target="_blank" rel="noopener" href="https://github.com/alibaba/DataX/blob/master/odpswriter/doc/odpswriter.md">写</a></td>
</tr>
<tr>
<td></td>
<td>ADS</td>
<td align="center"></td>
<td align="center">√</td>
<td align="center"><a target="_blank" rel="noopener" href="https://github.com/alibaba/DataX/blob/master/adswriter/doc/adswriter.md">写</a></td>
</tr>
<tr>
<td></td>
<td>OSS</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center"><a target="_blank" rel="noopener" href="https://github.com/alibaba/DataX/blob/master/ossreader/doc/ossreader.md">读</a> 、<a target="_blank" rel="noopener" href="https://github.com/alibaba/DataX/blob/master/osswriter/doc/osswriter.md">写</a></td>
</tr>
<tr>
<td></td>
<td>OCS</td>
<td align="center"></td>
<td align="center">√</td>
<td align="center"><a target="_blank" rel="noopener" href="https://github.com/alibaba/DataX/blob/master/ocswriter/doc/ocswriter.md">写</a></td>
</tr>
<tr>
<td></td>
<td>Hologres</td>
<td align="center"></td>
<td align="center">√</td>
<td align="center"><a target="_blank" rel="noopener" href="https://github.com/alibaba/DataX/blob/master/hologresjdbcwriter/doc/hologresjdbcwriter.md">写</a></td>
</tr>
<tr>
<td></td>
<td>AnalyticDB For PostgreSQL</td>
<td align="center"></td>
<td align="center">√</td>
<td align="center">写</td>
</tr>
<tr>
<td>阿里云中间件</td>
<td>datahub</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">读 、写</td>
</tr>
<tr>
<td></td>
<td>SLS</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">读 、写</td>
</tr>
<tr>
<td>阿里云图数据库</td>
<td>GDB</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center"><a target="_blank" rel="noopener" href="https://github.com/alibaba/DataX/blob/master/gdbreader/doc/gdbreader.md">读</a> 、<a target="_blank" rel="noopener" href="https://github.com/alibaba/DataX/blob/master/gdbwriter/doc/gdbwriter.md">写</a></td>
</tr>
<tr>
<td>NoSQL数据存储</td>
<td>OTS</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center"><a target="_blank" rel="noopener" href="https://github.com/alibaba/DataX/blob/master/otsreader/doc/otsreader.md">读</a> 、<a target="_blank" rel="noopener" href="https://github.com/alibaba/DataX/blob/master/otswriter/doc/otswriter.md">写</a></td>
</tr>
<tr>
<td></td>
<td>Hbase0.94</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center"><a target="_blank" rel="noopener" href="https://github.com/alibaba/DataX/blob/master/hbase094xreader/doc/hbase094xreader.md">读</a> 、<a target="_blank" rel="noopener" href="https://github.com/alibaba/DataX/blob/master/hbase094xwriter/doc/hbase094xwriter.md">写</a></td>
</tr>
<tr>
<td></td>
<td>Hbase1.1</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center"><a target="_blank" rel="noopener" href="https://github.com/alibaba/DataX/blob/master/hbase11xreader/doc/hbase11xreader.md">读</a> 、<a target="_blank" rel="noopener" href="https://github.com/alibaba/DataX/blob/master/hbase11xwriter/doc/hbase11xwriter.md">写</a></td>
</tr>
<tr>
<td></td>
<td>Phoenix4.x</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center"><a target="_blank" rel="noopener" href="https://github.com/alibaba/DataX/blob/master/hbase11xsqlreader/doc/hbase11xsqlreader.md">读</a> 、<a target="_blank" rel="noopener" href="https://github.com/alibaba/DataX/blob/master/hbase11xsqlwriter/doc/hbase11xsqlwriter.md">写</a></td>
</tr>
<tr>
<td></td>
<td>Phoenix5.x</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center"><a target="_blank" rel="noopener" href="https://github.com/alibaba/DataX/blob/master/hbase20xsqlreader/doc/hbase20xsqlreader.md">读</a> 、<a target="_blank" rel="noopener" href="https://github.com/alibaba/DataX/blob/master/hbase20xsqlwriter/doc/hbase20xsqlwriter.md">写</a></td>
</tr>
<tr>
<td></td>
<td>MongoDB</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center"><a target="_blank" rel="noopener" href="https://github.com/alibaba/DataX/blob/master/mongodbreader/doc/mongodbreader.md">读</a> 、<a target="_blank" rel="noopener" href="https://github.com/alibaba/DataX/blob/master/mongodbwriter/doc/mongodbwriter.md">写</a></td>
</tr>
<tr>
<td></td>
<td>Cassandra</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center"><a target="_blank" rel="noopener" href="https://github.com/alibaba/DataX/blob/master/cassandrareader/doc/cassandrareader.md">读</a> 、<a target="_blank" rel="noopener" href="https://github.com/alibaba/DataX/blob/master/cassandrawriter/doc/cassandrawriter.md">写</a></td>
</tr>
<tr>
<td>数仓数据存储</td>
<td>StarRocks</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">读 、<a target="_blank" rel="noopener" href="https://github.com/alibaba/DataX/blob/master/starrockswriter/doc/starrockswriter.md">写</a></td>
</tr>
<tr>
<td></td>
<td>ApacheDoris</td>
<td align="center"></td>
<td align="center">√</td>
<td align="center"><a target="_blank" rel="noopener" href="https://github.com/alibaba/DataX/blob/master/doriswriter/doc/doriswriter.md">写</a></td>
</tr>
<tr>
<td></td>
<td>ClickHouse</td>
<td align="center"></td>
<td align="center">√</td>
<td align="center">写</td>
</tr>
<tr>
<td></td>
<td>Hive</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center"><a target="_blank" rel="noopener" href="https://github.com/alibaba/DataX/blob/master/hdfsreader/doc/hdfsreader.md">读</a> 、<a target="_blank" rel="noopener" href="https://github.com/alibaba/DataX/blob/master/hdfswriter/doc/hdfswriter.md">写</a></td>
</tr>
<tr>
<td></td>
<td>kudu</td>
<td align="center"></td>
<td align="center">√</td>
<td align="center"><a target="_blank" rel="noopener" href="https://github.com/alibaba/DataX/blob/master/hdfswriter/doc/hdfswriter.md">写</a></td>
</tr>
<tr>
<td>无结构化数据存储</td>
<td>TxtFile</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center"><a target="_blank" rel="noopener" href="https://github.com/alibaba/DataX/blob/master/txtfilereader/doc/txtfilereader.md">读</a> 、<a target="_blank" rel="noopener" href="https://github.com/alibaba/DataX/blob/master/txtfilewriter/doc/txtfilewriter.md">写</a></td>
</tr>
<tr>
<td></td>
<td>FTP</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center"><a target="_blank" rel="noopener" href="https://github.com/alibaba/DataX/blob/master/ftpreader/doc/ftpreader.md">读</a> 、<a target="_blank" rel="noopener" href="https://github.com/alibaba/DataX/blob/master/ftpwriter/doc/ftpwriter.md">写</a></td>
</tr>
<tr>
<td></td>
<td>HDFS</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center"><a target="_blank" rel="noopener" href="https://github.com/alibaba/DataX/blob/master/hdfsreader/doc/hdfsreader.md">读</a> 、<a target="_blank" rel="noopener" href="https://github.com/alibaba/DataX/blob/master/hdfswriter/doc/hdfswriter.md">写</a></td>
</tr>
<tr>
<td></td>
<td>Elasticsearch</td>
<td align="center"></td>
<td align="center">√</td>
<td align="center"><a target="_blank" rel="noopener" href="https://github.com/alibaba/DataX/blob/master/elasticsearchwriter/doc/elasticsearchwriter.md">写</a></td>
</tr>
<tr>
<td>时间序列数据库</td>
<td>OpenTSDB</td>
<td align="center">√</td>
<td align="center"></td>
<td align="center"><a target="_blank" rel="noopener" href="https://github.com/alibaba/DataX/blob/master/opentsdbreader/doc/opentsdbreader.md">读</a></td>
</tr>
<tr>
<td></td>
<td>TSDB</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center"><a target="_blank" rel="noopener" href="https://github.com/alibaba/DataX/blob/master/tsdbreader/doc/tsdbreader.md">读</a> 、<a target="_blank" rel="noopener" href="https://github.com/alibaba/DataX/blob/master/tsdbwriter/doc/tsdbhttpwriter.md">写</a></td>
</tr>
<tr>
<td></td>
<td>TDengine</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center"><a target="_blank" rel="noopener" href="https://github.com/alibaba/DataX/blob/master/tdenginereader/doc/tdenginereader-CN.md">读</a> 、<a target="_blank" rel="noopener" href="https://github.com/alibaba/DataX/blob/master/tdenginewriter/doc/tdenginewriter-CN.md">写</a></td>
</tr>
</tbody></table>
<h2 id="部署需求"><a href="#部署需求" class="headerlink" title="部署需求"></a>部署需求</h2><ul>
<li>Linux</li>
<li><a target="_blank" rel="noopener" href="http://www.oracle.com/technetwork/cn/java/javase/downloads/index.html">JDK(1.8以上，推荐1.8)</a></li>
<li><a target="_blank" rel="noopener" href="https://www.python.org/downloads/">Python(2或3都可以)</a></li>
<li><a target="_blank" rel="noopener" href="https://maven.apache.org/download.cgi">Apache Maven 3.x</a> (Compile DataX)</li>
</ul>
<h2 id="部署步骤以及问题"><a href="#部署步骤以及问题" class="headerlink" title="部署步骤以及问题"></a>部署步骤以及问题</h2><p>解压datax的安装包 -》 制作软连接 -》 修改环境变量并source -》 执行自检脚本 <code>datax.py $&#123;DATAX_HOME&#125;/job/job.json</code></p>
<p>如果出现</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">DataX (DATAX-OPENSOURCE-3.0), <span class="keyword">From</span> Alibaba !</span><br><span class="line">Copyright (C) 2010-2017, Alibaba Group. All Rights Reserved.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2022-12-18 10:01:32.806 [main] <span class="built_in">INFO</span>  VMInfo - VMInfo# operatingSystem class =&gt; sun.management.OperatingSystemImpl</span><br><span class="line">2022-12-18 10:01:32.825 [main] <span class="built_in">INFO</span>  Engine - the machine <span class="built_in">info</span>  =&gt; </span><br><span class="line"></span><br><span class="line">	osInfo:	Oracle Corporation 1.8 25.45-b02</span><br><span class="line">	jvmInfo:	Linux amd64 3.10.0-1127.el7.x86_64</span><br><span class="line">	cpu num:	2</span><br><span class="line"></span><br><span class="line">	totalPhysicalMemory:	-0.00G</span><br><span class="line">	freePhysicalMemory:	-0.00G</span><br><span class="line">	maxFileDescriptorCount:	-1</span><br><span class="line">	currentOpenFileDescriptorCount:	-1</span><br><span class="line"></span><br><span class="line">	GC Names	[PS MarkSweep, PS Scavenge]</span><br><span class="line"></span><br><span class="line">	MEMORY_NAME                    | allocation_size                | init_size                  </span><br><span class="line">	PS Eden Space                  | 256.00MB                       | 256.00MB                   </span><br><span class="line">	Code Cache                     | 240.00MB                       | 2.44MB                     </span><br><span class="line">	Compressed Class Space         | 1,024.00MB                     | 0.00MB                     </span><br><span class="line">	PS Survivor Space              | 42.50MB                        | 42.50MB                    </span><br><span class="line">	PS Old Gen                     | 683.00MB                       | 683.00MB                   </span><br><span class="line">	Metaspace                      | -0.00MB                        | 0.00MB                     </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2022-12-18 10:01:32.848 [main] <span class="built_in">INFO</span>  Engine - </span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;content&quot;</span>:[</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">&quot;reader&quot;</span>:&#123;</span><br><span class="line">				<span class="string">&quot;name&quot;</span>:<span class="string">&quot;streamreader&quot;</span>,</span><br><span class="line">				<span class="string">&quot;parameter&quot;</span>:&#123;</span><br><span class="line">					<span class="string">&quot;column&quot;</span>:[</span><br><span class="line">						&#123;</span><br><span class="line">							<span class="string">&quot;type&quot;</span>:<span class="string">&quot;string&quot;</span>,</span><br><span class="line">							<span class="string">&quot;value&quot;</span>:<span class="string">&quot;DataX&quot;</span></span><br><span class="line">						&#125;,</span><br><span class="line">						&#123;</span><br><span class="line">							<span class="string">&quot;type&quot;</span>:<span class="string">&quot;long&quot;</span>,</span><br><span class="line">							<span class="string">&quot;value&quot;</span>:19890604</span><br><span class="line">						&#125;,</span><br><span class="line">						&#123;</span><br><span class="line">							<span class="string">&quot;type&quot;</span>:<span class="string">&quot;date&quot;</span>,</span><br><span class="line">							<span class="string">&quot;value&quot;</span>:<span class="string">&quot;1989-06-04 00:00:00&quot;</span></span><br><span class="line">						&#125;,</span><br><span class="line">						&#123;</span><br><span class="line">							<span class="string">&quot;type&quot;</span>:<span class="string">&quot;bool&quot;</span>,</span><br><span class="line">							<span class="string">&quot;value&quot;</span>:true</span><br><span class="line">						&#125;,</span><br><span class="line">						&#123;</span><br><span class="line">							<span class="string">&quot;type&quot;</span>:<span class="string">&quot;bytes&quot;</span>,</span><br><span class="line">							<span class="string">&quot;value&quot;</span>:<span class="string">&quot;test&quot;</span></span><br><span class="line">						&#125;</span><br><span class="line">					],</span><br><span class="line">					<span class="string">&quot;sliceRecordCount&quot;</span>:100000</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="string">&quot;writer&quot;</span>:&#123;</span><br><span class="line">				<span class="string">&quot;name&quot;</span>:<span class="string">&quot;streamwriter&quot;</span>,</span><br><span class="line">				<span class="string">&quot;parameter&quot;</span>:&#123;</span><br><span class="line">					<span class="string">&quot;encoding&quot;</span>:<span class="string">&quot;UTF-8&quot;</span>,</span><br><span class="line">					<span class="string">&quot;print&quot;</span>:false</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	],</span><br><span class="line">	<span class="string">&quot;setting&quot;</span>:&#123;</span><br><span class="line">		<span class="string">&quot;errorLimit&quot;</span>:&#123;</span><br><span class="line">			<span class="string">&quot;percentage&quot;</span>:0.02,</span><br><span class="line">			<span class="string">&quot;record&quot;</span>:0</span><br><span class="line">		&#125;,</span><br><span class="line">		<span class="string">&quot;speed&quot;</span>:&#123;</span><br><span class="line">			<span class="string">&quot;byte&quot;</span>:10485760</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">2022-12-18 10:01:32.889 [main] WARN  Engine - prioriy <span class="built_in">set</span> <span class="keyword">to</span> 0, because NumberFormatException, the value is: <span class="literal">null</span></span><br><span class="line">2022-12-18 10:01:32.890 [main] <span class="built_in">INFO</span>  PerfTrace - PerfTrace <span class="attribute">traceId</span>=job_-1, <span class="attribute">isEnable</span>=<span class="literal">false</span>, <span class="attribute">priority</span>=0</span><br><span class="line">2022-12-18 10:01:32.890 [main] <span class="built_in">INFO</span>  JobContainer - DataX jobContainer starts job.</span><br><span class="line">2022-12-18 10:01:32.891 [main] <span class="built_in">INFO</span>  JobContainer - <span class="built_in">Set</span> jobId = 0</span><br><span class="line">2022-12-18 10:01:32.916 [job-0] <span class="built_in">INFO</span>  JobContainer - jobContainer starts <span class="keyword">to</span> <span class="keyword">do</span> prepare <span class="built_in">..</span>.</span><br><span class="line">2022-12-18 10:01:32.917 [job-0] <span class="built_in">INFO</span>  JobContainer - DataX Reader.Job [streamreader] <span class="keyword">do</span> prepare work .</span><br><span class="line">2022-12-18 10:01:32.917 [job-0] <span class="built_in">INFO</span>  JobContainer - DataX Writer.Job [streamwriter] <span class="keyword">do</span> prepare work .</span><br><span class="line">2022-12-18 10:01:32.917 [job-0] <span class="built_in">INFO</span>  JobContainer - jobContainer starts <span class="keyword">to</span> <span class="keyword">do</span> split <span class="built_in">..</span>.</span><br><span class="line">2022-12-18 10:01:32.918 [job-0] <span class="built_in">INFO</span>  JobContainer - Job <span class="built_in">set</span> Max-Byte-Speed <span class="keyword">to</span> 10485760 bytes.</span><br><span class="line">2022-12-18 10:01:32.919 [job-0] <span class="built_in">INFO</span>  JobContainer - DataX Reader.Job [streamreader] splits <span class="keyword">to</span> [1] tasks.</span><br><span class="line">2022-12-18 10:01:32.919 [job-0] <span class="built_in">INFO</span>  JobContainer - DataX Writer.Job [streamwriter] splits <span class="keyword">to</span> [1] tasks.</span><br><span class="line">2022-12-18 10:01:32.941 [job-0] <span class="built_in">INFO</span>  JobContainer - jobContainer starts <span class="keyword">to</span> <span class="keyword">do</span> schedule <span class="built_in">..</span>.</span><br><span class="line">2022-12-18 10:01:32.945 [job-0] <span class="built_in">INFO</span>  JobContainer -<span class="built_in"> Scheduler </span>starts [1] taskGroups.</span><br><span class="line">2022-12-18 10:01:32.947 [job-0] <span class="built_in">INFO</span>  JobContainer - Running by standalone Mode.</span><br><span class="line">2022-12-18 10:01:32.967 [taskGroup-0] <span class="built_in">INFO</span>  TaskGroupContainer - taskGroupId=[0] start [1] channels <span class="keyword">for</span> [1] tasks.</span><br><span class="line">2022-12-18 10:01:32.978 [taskGroup-0] <span class="built_in">INFO</span>  Channel - Channel <span class="built_in">set</span> byte_speed_limit <span class="keyword">to</span> -1, <span class="literal">No</span> bps activated.</span><br><span class="line">2022-12-18 10:01:32.978 [taskGroup-0] <span class="built_in">INFO</span>  Channel - Channel <span class="built_in">set</span> record_speed_limit <span class="keyword">to</span> -1, <span class="literal">No</span> tps activated.</span><br><span class="line">2022-12-18 10:01:32.999 [taskGroup-0] <span class="built_in">INFO</span>  TaskGroupContainer - taskGroup[0] taskId[0] attemptCount[1] is started</span><br><span class="line">2022-12-18 10:01:33.100 [taskGroup-0] <span class="built_in">INFO</span>  TaskGroupContainer - taskGroup[0] taskId[0] is successed, used[116]ms</span><br><span class="line">2022-12-18 10:01:33.101 [taskGroup-0] <span class="built_in">INFO</span>  TaskGroupContainer - taskGroup[0] completed it<span class="string">&#x27;s tasks.</span></span><br><span class="line"><span class="string">2022-12-18 10:01:43.004 [job-0] INFO  StandAloneJobContainerCommunicator - Total 100000 records, 2600000 bytes | Speed 253.91KB/s, 10000 records/s | Error 0 records, 0 bytes |  All Task WaitWriterTime 0.029s |  All Task WaitReaderTime 0.029s | Percentage 100.00%</span></span><br><span class="line"><span class="string">2022-12-18 10:01:43.005 [job-0] INFO  AbstractScheduler - Scheduler accomplished all tasks.</span></span><br><span class="line"><span class="string">2022-12-18 10:01:43.005 [job-0] INFO  JobContainer - DataX Writer.Job [streamwriter] do post work.</span></span><br><span class="line"><span class="string">2022-12-18 10:01:43.005 [job-0] INFO  JobContainer - DataX Reader.Job [streamreader] do post work.</span></span><br><span class="line"><span class="string">2022-12-18 10:01:43.005 [job-0] INFO  JobContainer - DataX jobId [0] completed successfully.</span></span><br><span class="line"><span class="string">2022-12-18 10:01:43.006 [job-0] INFO  HookInvoker - No hook invoked, because base dir not exists or is a file: /home/hadoop/app/datax/hook</span></span><br><span class="line"><span class="string">2022-12-18 10:01:43.007 [job-0] INFO  JobContainer - </span></span><br><span class="line"><span class="string">	 [total cpu info] =&gt; </span></span><br><span class="line"><span class="string">		averageCpu                     | maxDeltaCpu                    | minDeltaCpu                </span></span><br><span class="line"><span class="string">		-1.00%                         | -1.00%                         | -1.00%</span></span><br><span class="line"><span class="string">                    </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">	 [total gc info] =&gt; </span></span><br><span class="line"><span class="string">		 NAME                 | totalGCCount       | maxDeltaGCCount    | minDeltaGCCount    | totalGCTime        | maxDeltaGCTime     | minDeltaGCTime   </span></span><br><span class="line"><span class="string">		 PS MarkSweep         | 0                  | 0                  | 0                  | 0.000s             | 0.000s             | 0.000s         </span></span><br><span class="line"><span class="string">		 PS Scavenge          | 0                  | 0                  | 0                  | 0.000s             | 0.000s             | 0.000s         </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">2022-12-18 10:01:43.007 [job-0] INFO  JobContainer - PerfTrace not enable!</span></span><br><span class="line"><span class="string">2022-12-18 10:01:43.007 [job-0] INFO  StandAloneJobContainerCommunicator - Total 100000 records, 2600000 bytes | Speed 253.91KB/s, 10000 records/s | Error 0 records, 0 bytes |  All Task WaitWriterTime 0.029s |  All Task WaitReaderTime 0.029s | Percentage 100.00%</span></span><br><span class="line"><span class="string">2022-12-18 10:01:43.011 [job-0] INFO  JobContainer - </span></span><br><span class="line"><span class="string">任务启动时刻                    : 2022-12-18 10:01:32</span></span><br><span class="line"><span class="string">任务结束时刻                    : 2022-12-18 10:01:43</span></span><br><span class="line"><span class="string">任务总计耗时                    :                 10s</span></span><br><span class="line"><span class="string">任务平均流量                    :          253.91KB/s</span></span><br><span class="line"><span class="string">记录写入速度                    :          10000rec/s</span></span><br><span class="line"><span class="string">读出记录总数                    :              100000</span></span><br><span class="line"><span class="string">读写失败总数                    :                   0</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure>

<p>则部署成功</p>
<h2 id="遇见的问题"><a href="#遇见的问题" class="headerlink" title="遇见的问题"></a>遇见的问题</h2><p>自建的时候出现</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Copyright (C) <span class="number">2010</span>-<span class="number">2017</span>, Alibaba Group. All Rights Reserved.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">2022</span>-<span class="number">12</span>-<span class="number">18</span> <span class="number">09</span>:<span class="number">56</span>:<span class="number">52.120</span> <span class="selector-attr">[main]</span> WARN  ConfigParser - 插件<span class="selector-attr">[streamreader,streamwriter]</span>加载失败，<span class="number">1s</span>后重试... Exception:Code:<span class="selector-attr">[Common-00]</span>, Describe:<span class="selector-attr">[您提供的配置文件存在错误信息，请检查您的作业配置 .]</span> - 配置信息错误，您提供的配置文件<span class="selector-attr">[/home/hadoop/app/datax/plugin/reader/._drdsreader/plugin.json]</span>不存在. 请检查您的配置文件. </span><br><span class="line"><span class="number">2022</span>-<span class="number">12</span>-<span class="number">18</span> <span class="number">09</span>:<span class="number">56</span>:<span class="number">53.124</span> <span class="selector-attr">[main]</span> ERROR Engine - </span><br><span class="line"></span><br><span class="line">经DataX智能分析,该任务最可能的错误原因是:</span><br><span class="line">com<span class="selector-class">.alibaba</span><span class="selector-class">.datax</span><span class="selector-class">.common</span><span class="selector-class">.exception</span><span class="selector-class">.DataXException</span>: Code:<span class="selector-attr">[Common-00]</span>, Describe:<span class="selector-attr">[您提供的配置文件存在错误信息，请检查您的作业配置 .]</span> - 配置信息错误，您提供的配置文件<span class="selector-attr">[/home/hadoop/app/datax/plugin/reader/._drdsreader/plugin.json]</span>不存在. 请检查您的配置文件.</span><br><span class="line">	at com<span class="selector-class">.alibaba</span><span class="selector-class">.datax</span><span class="selector-class">.common</span><span class="selector-class">.exception</span><span class="selector-class">.DataXException</span><span class="selector-class">.asDataXException</span>(DataXException<span class="selector-class">.java</span>:<span class="number">26</span>)</span><br><span class="line">	at com<span class="selector-class">.alibaba</span><span class="selector-class">.datax</span><span class="selector-class">.common</span><span class="selector-class">.util</span><span class="selector-class">.Configuration</span><span class="selector-class">.from</span>(Configuration<span class="selector-class">.java</span>:<span class="number">95</span>)</span><br><span class="line">	at com<span class="selector-class">.alibaba</span><span class="selector-class">.datax</span><span class="selector-class">.core</span><span class="selector-class">.util</span><span class="selector-class">.ConfigParser</span><span class="selector-class">.parseOnePluginConfig</span>(ConfigParser<span class="selector-class">.java</span>:<span class="number">153</span>)</span><br><span class="line">	at com<span class="selector-class">.alibaba</span><span class="selector-class">.datax</span><span class="selector-class">.core</span><span class="selector-class">.util</span><span class="selector-class">.ConfigParser</span><span class="selector-class">.parsePluginConfig</span>(ConfigParser<span class="selector-class">.java</span>:<span class="number">125</span>)</span><br><span class="line">	at com<span class="selector-class">.alibaba</span><span class="selector-class">.datax</span><span class="selector-class">.core</span><span class="selector-class">.util</span><span class="selector-class">.ConfigParser</span><span class="selector-class">.parse</span>(ConfigParser<span class="selector-class">.java</span>:<span class="number">63</span>)</span><br><span class="line">	at com<span class="selector-class">.alibaba</span><span class="selector-class">.datax</span><span class="selector-class">.core</span><span class="selector-class">.Engine</span><span class="selector-class">.entry</span>(Engine<span class="selector-class">.java</span>:<span class="number">137</span>)</span><br><span class="line">	at com<span class="selector-class">.alibaba</span><span class="selector-class">.datax</span><span class="selector-class">.core</span><span class="selector-class">.Engine</span><span class="selector-class">.main</span>(Engine<span class="selector-class">.java</span>:<span class="number">204</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h3><p>执行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">find <span class="variable">$&#123;DATAX_HOME&#125;</span>/plugin/reader/ -<span class="built_in">type</span> f -name <span class="string">&quot;._*er&quot;</span> | xargs <span class="built_in">rm</span> -rf</span><br><span class="line">find <span class="variable">$&#123;DATAX_HOME&#125;</span>/plugin/writer/ -<span class="built_in">type</span> f -name <span class="string">&quot;._*er&quot;</span> | xargs <span class="built_in">rm</span> -rf</span><br></pre></td></tr></table></figure>

<p>然后重新自检就成功了</p>
<h1 id="安装datax-web工具"><a href="#安装datax-web工具" class="headerlink" title="安装datax-web工具"></a>安装datax-web工具</h1><p>简介 ： DataX Web是在DataX之上开发的分布式数据同步工具，提供简单易用的操作界面。</p>
<p>相当于多了一个图形化界面</p>
<h2 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h2><p>解压压缩包-&gt; 制作软连接 -&gt; 编辑并导入环境变量</p>
<ul>
<li>-&gt; 修改modules下的datax-admin下的conf下的bootstrap.properties</li>
<li>DB_HOST ： mysql所在的ip</li>
<li>DB_PORT ： mysql的端口</li>
<li>DB_USERNAME ： mysql的用户名</li>
<li>DB_PASSWORD ： mysql的用户名的密码</li>
<li>DB_DATABASE ： datax的配置文件所在的mysql的数据库</li>
<li>-&gt; 修改datax-executor下的bin下的env.properties的PYTOHON_PATH的配置地址，需与我们安装的datax目录一致</li>
<li>比如 ： <code>PYTHON_PATH=/home/hadoop/app/datax/bin/datax.py</code></li>
<li>-&gt; 修改&#x2F;datax-executor&#x2F;conf下的application.yml，把其中的admin下的addresses: <a href="http://ip:${datax.admin.port}">http://ip:${datax.admin.port}</a> ：ip改成自己机器的</li>
<li>然后进入到我们的最外层的bin目录下，执行 <code>start-all.sh</code>ps : 这里的start-all.sh和hadoop的启动脚本冲突，我们可以把它改名就好了</li>
<li>执行 <code>mv ./start-all.sh ./startdatax_web-all.sh停止脚本同理</code></li>
<li>然后启动脚本执行 ： <code> startdatax_web-all.sh</code></li>
<li>然后我们访问 <code>http://服务器IP:9527/index.html</code></li>
<li>初始账号密码 admin  123456</li>
</ul>
<p>使用方法和xxl非常类似</p>
<h1 id="Prometheus"><a href="#Prometheus" class="headerlink" title="Prometheus"></a>Prometheus</h1><p>简介 ： Prometheus(由go语言(golang)开发)是一套开源的监控&amp;报警&amp;时间序列数据库的组合。适合监控容器平台。因为kubernetes(俗称k8s)的流行带动了prometheus的发展</p>
<p>Prometheus的主要特征有:</p>
<ol>
<li>多维度数据模型</li>
<li>灵活的查询语言</li>
<li>不依赖分布式存储，单个服务器节点是自主的</li>
<li>以HTTP方式，通过pull模型拉去时间序列数据</li>
<li>也可以通过中间网关支持push模型</li>
<li>通过服务发现或者静态配置, 来发现目标服务对象</li>
<li>支持多种多样的图表和界面展示</li>
</ol>
<table>
<thead>
<tr>
<th>主机名</th>
<th>ip</th>
<th>身份</th>
</tr>
</thead>
<tbody><tr>
<td>bigdata4</td>
<td>192.168.41.133</td>
<td>prometheus服务器</td>
</tr>
<tr>
<td>bigdata3</td>
<td>192.168.41.132</td>
<td>被监控服务器</td>
</tr>
<tr>
<td>bigdata5</td>
<td>192.168.41.134</td>
<td>granfana服务器</td>
</tr>
</tbody></table>
<p>时间同步</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">systemctl restart ntpd</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">systemctl <span class="built_in">enable</span> ntpd</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>关闭防火墙和seLInux</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">systemctl stop firewalld</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">systemctl <span class="built_in">enable</span> firewalld</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">setenforce 0</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">vim /etc/selinux/config</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">iptables -F</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="部署安装"><a href="#部署安装" class="headerlink" title="部署安装"></a>部署安装</h2><p>去官网下载二进制的安装包这里要下载两个东西 ，一个是prometheus-2.41.0-rc.0.linux-amd64.tar 一个是 node_exporter-1.5.0.linux-amd64.tar.gz</p>
<p>简单来说 prometheus-2.41.0-rc.0.linux-amd64.ta是服务器 而 node_exporter-1.5.0.linux-amd64.tar.gz是监控器</p>
<p>监控器除了服务器以外的机器上都要有，服务器只要在你想部署的服务器上就好</p>
<p>解压 -》 软连接 -》 配置环境变量</p>
<ul>
<li>-》 修改prometheus文件夹下的prometheus.yml文件</li>
<li>job_name ： 代表监控器的名字</li>
<li>targets: [“localhost:9090”] 代表监控器的IP地址以及端口号</li>
<li>监控器的默认端口是9100</li>
<li>我们对其修改，增加几个</li>
</ul>
<p>然后在服务器上执行 <code>prometheus --config.file=&quot;/home/hadoop/app/prometheus/prometheus.yml&quot; &amp;</code></p>
<p>在另外两个机器上执行 <code> node_exporter</code></p>
<p>然后访问IP:9090点击Status然后点击Target就可以看见我们的三台机器以及其名字</p>
<h3 id="监控Zookeeper"><a href="#监控Zookeeper" class="headerlink" title="监控Zookeeper"></a>监控Zookeeper</h3><p>监控Zookeeper和上述监控机器一样，只不过因为github上有开源的<a target="_blank" rel="noopener" href="https://github.com/jiankunking/zookeeper_exporter">zookeeper_exporter</a>然后直接上传到linux上，给他赋权限（执行权限）</p>
<p>然后执行 <code>zookeeper_exporter ip：ZK的端口：监控日志的对接端口</code>就启动了，然后我们在我们的prometheus服务器上修改配置文件，添加上即可</p>
<h3 id="监控kafka"><a href="#监控kafka" class="headerlink" title="监控kafka"></a>监控kafka</h3><p>监控kafka同上</p>
<h3 id="监控flume"><a href="#监控flume" class="headerlink" title="监控flume"></a>监控flume</h3><p>关于监控flume同上步骤，不过，flume的监控器是go语言进行编译的，所以要先安装go语言的环境</p>
<h1 id="granfana"><a href="#granfana" class="headerlink" title="granfana"></a>granfana</h1><p>其是对普罗米修斯收集的数据进行处理以及显示的一个软件</p>
<h2 id="部署-1"><a href="#部署-1" class="headerlink" title="部署"></a>部署</h2><p>下载rpm包 执行以下命令 <code> wget https://dl.grafana.com/enterprise/release/grafana-enterprise-9.1.5-1.x86_64.rpm</code></p>
<p>在完成之后直接执行安装命令要root用户 <code> rpm -ivh grafana-enterprise-9.1.5-1.x86_64.rpm</code></p>
<p>然后执行 <code> systemctl start grafana-server</code></p>
<p>然后用 <code>lsof -i:3000</code> 查看一下3000端口出现如下</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">COMMAND    PID    <span class="keyword">USER</span>   <span class="title">FD</span>   <span class="keyword">TYPE</span> DEVICE SIZE/OFF <span class="keyword">NODE</span> <span class="title">NAME</span></span><br><span class="line">grafana-s <span class="number">6962</span> grafana    <span class="number">8</span>u  IPv6  <span class="number">90355</span>      <span class="number">0</span>t0  TCP *:hbci (LISTEN)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>然后浏览器访问ip:3000就可以了</p>
<p>进去之后选择数据源，选择普罗米修斯的，然后添加上他的链接就ok了（服务器的链接以及端口）</p>

      
    </div>

    
    
    

      
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://zihang.fun/2022/12/16/%E5%91%A8%E5%85%AD%E6%97%A5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="liu zihang">
      <meta itemprop="description" content="只有努力不会辜负你">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="枫叶冢">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/12/16/%E5%91%A8%E5%85%AD%E6%97%A5/" class="post-title-link" itemprop="url">周六周日要补的</a>
        </h2>

        <div class="post-meta">
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-12-16 14:39:31" itemprop="dateCreated datePublished" datetime="2022-12-16T14:39:31+08:00">2022-12-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-12-18 17:30:14" itemprop="dateModified" datetime="2022-12-18T17:30:14+08:00">2022-12-18</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E4%BB%BB%E5%8A%A1/" itemprop="url" rel="index"><span itemprop="name">任务</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>164</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    

   

    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Prometheus框架监控zk"><a href="#Prometheus框架监控zk" class="headerlink" title="Prometheus框架监控zk"></a>Prometheus框架监控zk</h1><p>完成</p>
<h1 id="datax"><a href="#datax" class="headerlink" title="datax"></a>datax</h1><p>完成</p>
<h1 id="flume的fileSink"><a href="#flume的fileSink" class="headerlink" title="flume的fileSink"></a>flume的fileSink</h1><p>完成</p>
<h2 id="kafka-custome-api"><a href="#kafka-custome-api" class="headerlink" title="kafka custome api"></a>kafka custome api</h2><p>完成</p>
<h2 id="flume-gt-kafka-gt-消费"><a href="#flume-gt-kafka-gt-消费" class="headerlink" title="flume-&gt; kafka -&gt; 消费"></a>flume-&gt; kafka -&gt; 消费</h2><p>完成</p>
<h2 id="kafka-gt-flume-gt-hdfs-gt-logger"><a href="#kafka-gt-flume-gt-hdfs-gt-logger" class="headerlink" title="kafka -&gt; flume -&gt; hdfs -&gt;logger"></a>kafka -&gt; flume -&gt; hdfs -&gt;logger</h2><p>完成</p>
<h2 id="clickhouse-，-mongo-，-python-，-go-，-深入jvm，java-机器学习的算法"><a href="#clickhouse-，-mongo-，-python-，-go-，-深入jvm，java-机器学习的算法" class="headerlink" title="clickhouse ， mongo ， python ， go ， 深入jvm，java,机器学习的算法"></a>clickhouse ， mongo ， python ， go ， 深入jvm，java,机器学习的算法</h2>
      
    </div>

    
    
    

      
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://zihang.fun/2022/12/16/12-16/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="liu zihang">
      <meta itemprop="description" content="只有努力不会辜负你">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="枫叶冢">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/12/16/12-16/" class="post-title-link" itemprop="url">kafka</a>
        </h2>

        <div class="post-meta">
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-12-16 08:44:05" itemprop="dateCreated datePublished" datetime="2022-12-16T08:44:05+08:00">2022-12-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-12-22 16:39:12" itemprop="dateModified" datetime="2022-12-22T16:39:12+08:00">2022-12-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%97%A5%E5%BF%97/" itemprop="url" rel="index"><span itemprop="name">日志</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>22k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>20 分钟</span>
            </span>

        </div>
      </header>

    
    
    

   

    <div class="post-body" itemprop="articleBody">

      
          <p>MQ:消息中间件</p>
<ul>
<li>java -》 rabbitMq kafka</li>
<li>大数据 -》 kafka，pular ， solar</li>
</ul>
<h1 id="kafka："><a href="#kafka：" class="headerlink" title="kafka："></a>kafka：</h1><ul>
<li>在cdh平台叫cdk</li>
</ul>
<p>官网：kafka.apache.org</p>
<p>他是一个流式的分布式平台，构建实时的数据通道，流式数据分析，流式的app</p>
<p>实时处理&#x2F;流式处理</p>
<p>离线处理&#x2F;批处理</p>
<p>消息中间件：</p>
<ul>
<li>消息：event-》事件-》数据</li>
<li>数据存储的地方：中间件</li>
</ul>
<p>kafka的特性</p>
<ul>
<li>高吞吐量</li>
<li>可扩展性：支持分布式</li>
<li>永久性存储 ：有数据过期时间</li>
<li>高可用</li>
</ul>
<p>kafka的特点：</p>
<ul>
<li>读写（发布和订阅）</li>
<li>存储流式的数据</li>
<li>可以进行数据的处理<ul>
<li>正常的kafka处理，是在它后面接一个实时处理的框架 spark&#x2F;fink</li>
<li>kafkaStreaming ：是kafka自带的专门处理数据的功能（性能：以及数据的丢包什么的差距会比较大）</li>
</ul>
</li>
</ul>
<p>部署：kafka的版本要选择</p>
<ul>
<li>apache</li>
<li>cdk</li>
</ul>
<p>一般选择稳定版，最新版bug多</p>
<p>还可以根据后面的框架选择 ：根据sparkStreaming 来选择kafka的版本 ： spark对kafka的最低的版本是0.10.0 （目前3.x的spark）</p>
<p>kafka：</p>
<ul>
<li>0.10之后都可以</li>
</ul>
<p>kafka用的是scala写的</p>
<p>kafka2.8版本bug多，因为2.8版本做了个尝试，就是抛去zk，但是尝试失败了，最终出现多个bug</p>
<p>我们目前用2.2.1的版本</p>
<p>kafka的架构：</p>
<ul>
<li>生产者 ： producer 发送数据的</li>
<li>kafka ：broker 真正是属于卡夫卡的，其余是不属于kafka的组件的</li>
<li>消费者 ：customer 取出数据 ，但是数据并不会传出去，只是把副本发出去</li>
</ul>
<p>这里的数据也叫events</p>
<p>扩展架构：</p>
<ul>
<li>broker kafka的集群的一个节点 ，相当于我们的机器</li>
<li>broker：topic 主题<ul>
<li>负责存储events</li>
<li>订阅和发送都是基于topic来实现的<ul>
<li>只要订阅了这个topic，就可以知道他里面的数据</li>
<li>发送也是同理</li>
<li>一个kafka里可以有多个topic</li>
<li>相当于这个是个有编号的数据仓库</li>
<li>关于kafka的topic，我们是和他的效率成一个曲线波动的，比如在一定区间上升的比较多，一定区间反而下降</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>topic ：</p>
<ul>
<li>partition：分区<ul>
<li>一个topic可以有多个paitition</li>
<li>每个partition是一个有序的序列</li>
<li>分区并不是越多越好，最好是可以被我们的机器整除的，避免数据倾斜</li>
<li>其分区中每个分区都有一个标记信息，叫offset，在offset规定的时间里，我们可以随意的消费这个数据，他会一直在</li>
<li>而且和可以对offset的值进行修改</li>
</ul>
</li>
<li>topic的数据是放在不同的目录下面的，就是分区下面</li>
</ul>
<p>部署 ：</p>
<p>解压 - 》 软连接 -》 环境变量 -》 vim server.properties</p>
<ul>
<li>borker.id : id编号</li>
<li>log.retention.huors:数据保留的时间</li>
<li>zookeeper.connect:zk的链接</li>
<li>log.dirs：数据的存储文件夹</li>
<li>hostname：机器的名字</li>
<li>port：kafka对外的端口</li>
</ul>
<p>更改成功之后，我们启动我们的kafka</p>
<p>kafka的启动有两种方式，然后我们可以通过jps进行查看它</p>
<p>简单的命令：<code>kafka-server-start.sh  -daemon $KAFKA_HOME/config/server.properties</code></p>
<h2 id="查看kafka的topic"><a href="#查看kafka的topic" class="headerlink" title="查看kafka的topic"></a>查看kafka的topic</h2><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kafka-topics<span class="selector-class">.sh</span> \</span><br><span class="line"><span class="attr">--list</span> \</span><br><span class="line"><span class="attr">--zookeeper</span> bigdata3:<span class="number">2181</span>,bigdata4:<span class="number">2181</span>,bigdata5:<span class="number">2181</span>/kafka</span><br></pre></td></tr></table></figure>

<h2 id="创建topic"><a href="#创建topic" class="headerlink" title="创建topic"></a>创建topic</h2><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">kafka-topics<span class="selector-class">.sh</span> \</span><br><span class="line"><span class="attr">--create</span> \</span><br><span class="line"><span class="attr">--zookeeper</span> bigdata3:<span class="number">2181</span>,bigdata4:<span class="number">2181</span>,bigdata5:<span class="number">2181</span>/kafka \</span><br><span class="line"><span class="attr">--topic</span> dl2262 \</span><br><span class="line"><span class="attr">--partitions</span> <span class="number">6</span> \</span><br><span class="line"><span class="attr">--replication-factor</span> <span class="number">3</span></span><br></pre></td></tr></table></figure>

<p>注意 ：</p>
<p>partition的随便指定，最好是机器的倍数</p>
<p>副本-》容错</p>
<p>replication-factor topic的副本数小于等于机器数</p>
<h2 id="查看详细的topic信息"><a href="#查看详细的topic信息" class="headerlink" title="查看详细的topic信息"></a>查看详细的topic信息</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">kafka-topics.sh</span> <span class="string">\</span></span><br><span class="line"><span class="string">--describe</span> <span class="string">\</span></span><br><span class="line"><span class="string">--zookeeper</span> <span class="string">bigdata3:2181,bigdata4:2181,bigdata5:2181/kafka</span> <span class="string">\</span></span><br><span class="line"><span class="string">--topic</span> <span class="string">dl2262</span> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">Topic:dl2262</span>	<span class="string">PartitionCount:6</span>	<span class="string">ReplicationFactor:3</span>	<span class="attr">Configs:</span></span><br><span class="line">	<span class="attr">Topic:</span> <span class="string">dl2262</span>	<span class="attr">Partition:</span> <span class="number">0</span>	<span class="attr">Leader:</span> <span class="number">1</span>	<span class="attr">Replicas:</span> <span class="number">1</span><span class="string">,0,2</span>	<span class="attr">Isr:</span> <span class="number">1</span><span class="string">,0,2</span></span><br><span class="line">	<span class="attr">Topic:</span> <span class="string">dl2262</span>	<span class="attr">Partition:</span> <span class="number">1</span>	<span class="attr">Leader:</span> <span class="number">2</span>	<span class="attr">Replicas:</span> <span class="number">2</span><span class="string">,1,0</span>	<span class="attr">Isr:</span> <span class="number">2</span><span class="string">,1,0</span></span><br><span class="line">	<span class="attr">Topic:</span> <span class="string">dl2262</span>	<span class="attr">Partition:</span> <span class="number">2</span>	<span class="attr">Leader:</span> <span class="number">0</span>	<span class="attr">Replicas:</span> <span class="number">0</span><span class="string">,2,1</span>	<span class="attr">Isr:</span> <span class="number">0</span><span class="string">,2,1</span></span><br><span class="line">	<span class="attr">Topic:</span> <span class="string">dl2262</span>	<span class="attr">Partition:</span> <span class="number">3</span>	<span class="attr">Leader:</span> <span class="number">1</span>	<span class="attr">Replicas:</span> <span class="number">1</span><span class="string">,2,0</span>	<span class="attr">Isr:</span> <span class="number">1</span><span class="string">,2,0</span></span><br><span class="line">	<span class="attr">Topic:</span> <span class="string">dl2262</span>	<span class="attr">Partition:</span> <span class="number">4</span>	<span class="attr">Leader:</span> <span class="number">2</span>	<span class="attr">Replicas:</span> <span class="number">2</span><span class="string">,0,1</span>	<span class="attr">Isr:</span> <span class="number">2</span><span class="string">,0,1</span></span><br><span class="line">	<span class="attr">Topic:</span> <span class="string">dl2262</span>	<span class="attr">Partition:</span> <span class="number">5</span>	<span class="attr">Leader:</span> <span class="number">0</span>	<span class="attr">Replicas:</span> <span class="number">0</span><span class="string">,1,2</span>	<span class="attr">Isr:</span> <span class="number">0</span><span class="string">,1,2</span></span><br><span class="line"></span><br><span class="line"><span class="string">第一行</span> <span class="string">：</span> <span class="string">topic的总体情况</span> <span class="string">topic的名字</span> <span class="string">分区数量</span> <span class="string">分区数量</span> <span class="string">副本数量</span></span><br><span class="line"><span class="string">第二行及以下</span> <span class="string">：</span> <span class="string">topic名字</span> <span class="string">分区的编号</span> <span class="string">leader的编号：负责对外进行读写的kafka的编号</span> <span class="string">Replicas:当前分区副本在哪些机器上是编号</span> <span class="string">isr：</span> <span class="string">负责对外进行读写请求的读写的顺序（机器编号）</span></span><br><span class="line"><span class="string">实际上是有个顺序的，leader的分配以及，读写的顺序</span></span><br></pre></td></tr></table></figure>

<h2 id="删除topic"><a href="#删除topic" class="headerlink" title="删除topic"></a>删除topic</h2><p>个人建议生产上不要删除topic</p>
<p>当topic的数量变多的时候，如果你删除了一个，则它可能会崩掉</p>
<p>修改也同上 ：</p>
<figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kafka-topics.sh <span class="string">\</span></span><br><span class="line">--<span class="keyword">delete</span> <span class="string">\</span></span><br><span class="line">--zookeeper bigdata3:<span class="number">2181</span>,bigdata4:<span class="number">2181</span>,bigdata5:<span class="number">2181</span>/kafka <span class="string">\</span></span><br><span class="line">--topic dl2262 </span><br></pre></td></tr></table></figure>

<p>topic ： 有俩个数据</p>
<ul>
<li>磁盘上</li>
<li>zk中的</li>
</ul>
<p>执行之后，那个topic会被打上删除的标记，但是实际上数据还是在磁盘上的</p>
<p>如果真的想删除，可以在conf里加上 ，delete.topic.enable&#x3D;true</p>
<h2 id="修改topic"><a href="#修改topic" class="headerlink" title="修改topic"></a>修改topic</h2><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">kafka-topics<span class="selector-class">.sh</span> \</span><br><span class="line"><span class="attr">--alter</span> \</span><br><span class="line"><span class="attr">--zookeeper</span> bigdata3:<span class="number">2181</span>,bigdata4:<span class="number">2181</span>,bigdata5:<span class="number">2181</span>/kafka \</span><br><span class="line"><span class="attr">--topic</span> dl2262 \</span><br><span class="line"><span class="attr">--partitions</span> <span class="number">6</span> \</span><br><span class="line"><span class="attr">--replication-factor</span> <span class="number">3</span></span><br></pre></td></tr></table></figure>

<p>想修改什么就加什么参数</p>
<p>但是生产上也不要用：因为可能会导致kafka崩</p>
<p>补充：</p>
<ul>
<li>kafka如何进行数据迁移</li>
<li>kafka进行压力测试</li>
</ul>
<h2 id="生产数据"><a href="#生产数据" class="headerlink" title="生产数据"></a>生产数据</h2><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kafka-console-producer.<span class="keyword">sh </span>\ </span><br><span class="line">--<span class="keyword">broker-list </span><span class="keyword">bigdata3:9092,bigdata4:9092,bigdata35:9092 </span>\</span><br><span class="line">--topic test</span><br></pre></td></tr></table></figure>

<p>正常我们是通过代码的方式进行编写的</p>
<p>官网的wproduceapi里有详细的介绍</p>
<p>首先要加入我们的代码</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.kafka<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>kafka-clients<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>而对于Streaming要添加</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.kafka<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>kafka-streams<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>kafka封装了一套二进制通信协议，用于对外提供各种各样的服务，对于producer而言，用户可以使用任意编程语言按照该协议的格式进行编程，从而实现向kafka发送消息。这组协议本质上为不同的协议类型分别定义了专属的紧凑二进制字节数组格式，然后通过socket发送给合适的broker，之后等待broker处理完成后返还响应给producer。</p>
<p>每个producer都是独立进行工作的，与其他producer之间没有关联，目前producer的首要功能就是向某个topic的某个分区发送一条消息，所以它首先需要确认到底向topic的哪个分区写入消息，这就是分区器（partitioner）的事情。kafka producer提供了一个默认的分区器，对于每条待发送的消息，如果该消息指定了key，那么该partitioner会根据key的哈希值来选择目标分区，若没有，会使用轮询的方式确认目标分区。当然，producer的API赋予了用户自行指定目标分区的权力。</p>
<p>在确认了目标分区后，producer要做的第二件事就是要寻找这个分区对应的leader，只有leader才能响应客户端发送过来的请求，而剩下的从节点中有一部分会同步该消息。因此在发送消息时，producer有不等待任何副本的响应便返回成功，或者只等待leader响应写入操作之后再返回成功。<br>代码如下 ；</p>
<figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.producer.KafkaProducer;</span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.producer.Producer;</span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.producer.ProducerRecord;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProducerTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> void main(<span class="keyword">String</span>[] args) &#123;</span><br><span class="line">        Properties props = <span class="keyword">new</span> <span class="type">Properties</span>();</span><br><span class="line">        <span class="comment">// 必须</span></span><br><span class="line">        props.put(<span class="string">&quot;bootstrap.servers&quot;</span>,<span class="string">&quot;121.5.240.148:9092&quot;</span>);</span><br><span class="line">        <span class="comment">// 被发送到broker的任何消息的格式都必须是字节数组</span></span><br><span class="line">        props.put(<span class="string">&quot;key.serializer&quot;</span>,<span class="string">&quot;org.apache.kafka.common.serialization.StringSerializer&quot;</span>);</span><br><span class="line">        props.put(<span class="string">&quot;value.serializer&quot;</span>,<span class="string">&quot;org.apache.kafka.common.serialization.StringSerializer&quot;</span>);</span><br><span class="line">        <span class="comment">// 非必须参数配置</span></span><br><span class="line">        <span class="comment">// acks=0表明producer完全不管发送结果；</span></span><br><span class="line">        <span class="comment">// acks=all或-1表明producer会等待ISR所有节点均写入后的响应结果；</span></span><br><span class="line">        <span class="comment">// acks=1，表明producer会等待leader写入后的响应结果</span></span><br><span class="line">        props.put(<span class="string">&quot;acks&quot;</span>,<span class="string">&quot;-1&quot;</span>);</span><br><span class="line">        <span class="comment">// 发生可重试异常时的重试次数</span></span><br><span class="line">        props.put(<span class="string">&quot;retries&quot;</span>,<span class="number">3</span>);</span><br><span class="line">         <span class="comment">// producer会将发往同一分区的多条消息封装进一个batch中，</span></span><br><span class="line">        <span class="comment">// 当batch满了的时候，发送其中的所有消息,不过并不总是等待batch满了才发送消息；</span></span><br><span class="line">        props.put(<span class="string">&quot;batch.size&quot;</span>,<span class="number">323840</span>);</span><br><span class="line">         <span class="comment">// 控制消息发送延时，默认为0，即立即发送，无需关心batch是否已被填满。</span></span><br><span class="line">        props.put(<span class="string">&quot;linger.ms&quot;</span>,<span class="number">10</span>);</span><br><span class="line">        <span class="comment">// 指定了producer用于缓存消息的缓冲区大小，单位字节，默认32MB</span></span><br><span class="line">        <span class="comment">// producer启动时会首先创建一块内存缓冲区用于保存待发送的消息，然后由另一个专属线程负责从缓冲区中读取消息执行真正的发送</span></span><br><span class="line">        props.put(<span class="string">&quot;buffer.memory&quot;</span>,<span class="number">33554432</span>);</span><br><span class="line">        <span class="comment">// 设置producer能发送的最大消息大小</span></span><br><span class="line">        props.put(<span class="string">&quot;max.request.size&quot;</span>,<span class="number">10485760</span>);</span><br><span class="line">        <span class="comment">// 设置是否压缩消息，默认none</span></span><br><span class="line">        props.put(<span class="string">&quot;compression.type&quot;</span>,<span class="string">&quot;lz4&quot;</span>);</span><br><span class="line">        <span class="comment">// 设置消息发送后，等待响应的最大时间</span></span><br><span class="line">        props.put(<span class="string">&quot;request.timeout.ms&quot;</span>,<span class="number">30</span>);</span><br><span class="line"></span><br><span class="line">        Producer&lt;<span class="keyword">String</span>,<span class="keyword">String</span>&gt; producer = <span class="keyword">new</span> <span class="type">KafkaProducer</span>&lt;<span class="keyword">String</span>, <span class="keyword">String</span>&gt;(props);</span><br><span class="line">        <span class="keyword">for</span>(int i = <span class="number">0</span>;i&lt;<span class="number">5</span>;i++)&#123;</span><br><span class="line">            producer.send(<span class="keyword">new</span> <span class="type">ProducerRecord</span>&lt;&gt;(<span class="string">&quot;my-replicated-topic&quot;</span>,<span class="string">&quot;key&quot;</span>+i,<span class="string">&quot;value&quot;</span>+i));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        producer.close();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>kafka producer发送消息的主方法是send方法，在底层完全地实现了异步化发送，并且通过Java提供的Future同时实现了同步发送和异步发送+回调两种发送方式。而上述代码使用的是第三种方式，即发送之后便不再理会发送结果，这种方式在实际中是不被推荐使用的。</p>
<p><strong>如果发送时连接不上，需要修改kafka配置文件重启</strong></p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">listeners</span>=PLAINTEXT : 外网ip</span><br><span class="line"><span class="attr">advertised.listeners</span>=PLAINTEXT : 外网ip</span><br></pre></td></tr></table></figure>

<p>异步发送 ：</p>
<p>实际上所有的写入操作默认都是异步的，send方法会返回一个Java Future对象供用户稍后获取发送结果，这就是所谓的回调机制。具体代码如下：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">producer.send(<span class="type">record</span>,<span class="built_in">new</span> Callback()&#123;</span><br><span class="line">  @Override</span><br><span class="line">  <span class="built_in">public</span> <span class="type">void</span> onCompletion(RecordMetadata metadata,<span class="keyword">Exception</span> <span class="keyword">exception</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">exception</span> == <span class="keyword">null</span>)&#123;</span><br><span class="line">      <span class="keyword">System</span>.<span class="keyword">out</span>.println(&quot;消息发送成功&quot;);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">System</span>.<span class="keyword">out</span>.println(&quot;消息发送失败&quot;);</span><br><span class="line">    &#125;  </span><br><span class="line">  &#125;</span><br><span class="line">&#125;);  </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>上面的代码中，Callback就是发送消息后的回调类，其onCompletion方法的两个输入参数metadata和exception不会同时非空，当消息发送成功时，exception为null，当消息发送失败时，metadata就是null。Callback实际上是一个Java接口，因此可创建自定义的Callback实现类来处理消息发送后的逻辑。</p>
<p>同步发送</p>
<p>同步发送和异步发送其实就是通过Java的Future来区分的，调用Future.get()等待返回结果，即是同步发送，具体代码如下：</p>
<figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ProducerRecord&lt;<span class="keyword">String</span>, <span class="keyword">String</span>&gt; record = <span class="keyword">new</span> <span class="type">ProducerRecord</span>&lt;&gt;(<span class="string">&quot;my-replicated-topic&quot;</span>,<span class="string">&quot;key&quot;</span>+i,<span class="string">&quot;value&quot;</span>+i);</span><br><span class="line"> RecordMetadata recordMetadata = producer.send(record).<span class="keyword">get</span>();</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>使用Future.get()方法会一直等待下去直到broker将结果返回给producer程序，当结果返回时，get()方法要么返回发送结果，要么抛出异常交由producer自行处理。如果没有错误，get将返回对应的RecordMetadata实例。</p>
<h3 id="消息分区机制"><a href="#消息分区机制" class="headerlink" title="消息分区机制"></a>消息分区机制</h3><p>producer发送过程中需要确定将消息发送到topic的哪一个分区，默认的分区器会尽力确保具有相同key的所有消息都被发送到相同的分区上；若没有指定key，会以轮询的方式来确保消息在topic的分区上均匀分配。</p>
<h3 id="kafka的发送异常"><a href="#kafka的发送异常" class="headerlink" title="kafka的发送异常"></a>kafka的发送异常</h3><p>当前kafka的错误类型包含了两类：可重试异常和不可重试异常，常见的可重试异常如下：</p>
<ul>
<li>LeaderNotAvailableException：分区对应的leader不可用，通常出现在leader换届选举时，因此是瞬时的异常，重试之后可自行恢复。</li>
<li>NotControllerException：表明controller当前不可用，在经历新一轮的选举，重试之后可自行恢复。</li>
<li>NetworkException：网络瞬时异常，可重试。</li>
</ul>
<p>所有可重试的异常都继承自or.apache.kafka.common.errors.RetriableException，对于这些可重试的异常，如果在producer程序中配置了重试次数，那么只要在规定的重试次数内自行恢复了，便不会出现在onCompletion的exception中。若超过了重试次数仍没成功，就会被封装到exception中，此时就需要producer程序自行处理这种异常。</p>
<p>没有继承自RetriableException的其他异常都属于不可重试异常，这类异常表明了一些非常严重或kafka无法处理的问题。</p>
<h3 id="自定义分区机制"><a href="#自定义分区机制" class="headerlink" title="自定义分区机制"></a>自定义分区机制</h3><p>自定义分区器需要实现org.apache.kafka.clients.producer.Partitioner接口，分区逻辑写在partition()方法中，例如：</p>
<figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AuditPartitioner</span> implements Partitioner &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Random <span class="built_in">random</span>;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">configure</span>(Map&lt;<span class="built_in">String</span>, ?&gt; <span class="built_in">map</span>) &#123;</span><br><span class="line">        <span class="comment">// 该方法实现必要资源的初始化工作</span></span><br><span class="line">        <span class="built_in">random</span> = <span class="keyword">new </span><span class="class title_">Random</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">partition</span>(<span class="built_in">String</span> topic, <span class="built_in">Object</span> keyObj, <span class="type">byte</span>[] keyBytes, <span class="built_in">Object</span> value, <span class="type">byte</span>[] valueBytes, Cluster cluster) &#123;</span><br><span class="line">        <span class="built_in">String</span> <span class="built_in">key</span> = (<span class="built_in">String</span>)keyObj;</span><br><span class="line">        <span class="comment">// 获取该topic可用的所有分区</span></span><br><span class="line">        List&lt;PartitionInfo&gt; partitionInfoList = cluster.<span class="property">availablePartitionsForTopic</span>(topic);</span><br><span class="line">        <span class="type">int</span> partitionCount = partitionInfoList.<span class="property">size</span>();</span><br><span class="line">        <span class="type">int</span> auditPartition = partitionCount <span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">key</span> == <span class="literal">null</span> || !<span class="built_in">key</span>.<span class="property">contains</span>(<span class="string">&quot;audit&quot;</span>) ? <span class="built_in">random</span>.<span class="property">nextInt</span>(auditPartition) : auditPartition;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">close</span>() &#123;</span><br><span class="line">         <span class="comment">// 该方法实现必要资源的清理</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>使用自定义分区器：<code>props.put(&quot;partitioner.class&quot;,&quot;xx.xx.AuditPartitioner&quot;); </code></p>
<h3 id="自定义序列化器"><a href="#自定义序列化器" class="headerlink" title="自定义序列化器"></a>自定义序列化器</h3><p>自定义序列化器需要实现org.apache.kafka.common.serialization.Serializer接口，在serializer方法中实现序列化逻辑，例如：</p>
<p>首先定义一个POJO对象</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="type">String</span> firstName;</span><br><span class="line">  <span class="keyword">private</span> <span class="type">String</span> lastName;</span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">  <span class="keyword">private</span> <span class="type">String</span> address;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">(<span class="type">String</span> firstName,<span class="type">String</span> lastName,<span class="type">int</span> age,<span class="type">String</span> address)</span></span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.firstName=firstName;</span><br><span class="line">  <span class="keyword">this</span>.lastName=lastName;</span><br><span class="line">  <span class="keyword">this</span>.age=age;</span><br><span class="line">  <span class="keyword">this</span>.address=address;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">&#125;  </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>由于要用jackson-mapper-asl包中的ObjectMapper来将对象转成字节数组，因此需要将其依赖引入：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.codehaus.jackson<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-mapper-asl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.9.13<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>  </span><br></pre></td></tr></table></figure>

<p>接下来创建serializer</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserSerializer</span> <span class="keyword">implements</span> <span class="title class_">Serializer</span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="title class_">ObjectMapper</span> objectMapper;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">configure</span>(<span class="params"><span class="built_in">Map</span> config,<span class="built_in">boolean</span> isKey</span>)&#123;</span><br><span class="line">      objectMapper = <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> byte[] <span class="title function_">serialize</span>(<span class="params"><span class="built_in">String</span> topic,<span class="built_in">Object</span> data</span>)&#123;</span><br><span class="line">    byte[] res = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">      res = objectMapper.<span class="title function_">writeValueAsString</span>(data).<span class="title function_">getBytes</span>(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">    &#125;<span class="keyword">catch</span>(<span class="title class_">Exception</span> e)&#123;</span><br><span class="line">      logger.<span class="title function_">warn</span>(<span class="string">&quot;failed to serialize the object: &#123;&#125;&quot;</span>, data, e);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">close</span>(<span class="params"></span>)&#123;&#125;</span><br><span class="line">&#125;   </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>使用自定义的序列化器 <code>props.put(&quot;value.serializer&quot;,&quot;xx.xx.UserSerializer&quot;); </code></p>
<h3 id="producer拦截器"><a href="#producer拦截器" class="headerlink" title="producer拦截器"></a>producer<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E6%8B%A6%E6%88%AA%E5%99%A8&spm=1001.2101.3001.7020">拦截器</a></h3><p>producer拦截器使得用户在消息发送前和producer回调逻辑执行前可对消息做一些定制化处理，允许使用多个拦截器构成拦截器链。拦截器的实现接口是org.apache.kafka.clients.producer.ProducerInterceptor。interceptor可能运行在多个线程中，因此在具体实现时用户需要确保线程安全。下面以一个简单的双interceptor组成的拦截链为例。第一个interceptor会在消息发送前将时间戳信息加到消息value的最前部，第二个interceptor会在消息发送后更新成功发送消息或失败发送消息数。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TimeStampPrependerInterceptor</span> <span class="keyword">implements</span> <span class="title class_">ProducerInterceptor</span>&lt;<span class="title class_">String</span>,<span class="title class_">String</span>&gt; &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * producer确保在消息被序列化前调用该方法</span></span><br><span class="line"><span class="comment">     * 可以在该方法中对消息做任何操作</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">ProducerRecord</span> <span class="title function_">onSend</span>(<span class="params">ProducerRecord record</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ProducerRecord</span>(record.<span class="title function_">topic</span>(),record.<span class="title function_">partition</span>(),record.<span class="title function_">timestamp</span>(),record.<span class="title function_">key</span>(),<span class="title class_">System</span>.<span class="title function_">currentTimeMillis</span>() +<span class="string">&quot;,&quot;</span>+record.<span class="title function_">value</span>().<span class="title function_">toString</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 该方法会在消息被应答之前或消息发送时调用</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">onAcknowledgement</span>(<span class="params">RecordMetadata recordMetadata, Exception e</span>) &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">close</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">configure</span>(<span class="params"><span class="built_in">Map</span>&lt;<span class="built_in">String</span>, ?&gt; map</span>) &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CounterInterceptor</span> <span class="keyword">implements</span> <span class="title class_">ProducerInterceptor</span>&lt;<span class="title class_">String</span>,<span class="title class_">String</span>&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> int errorCounter = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> int successCounter = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">ProducerRecord</span>&lt;<span class="title class_">String</span>, <span class="title class_">String</span>&gt; <span class="title function_">onSend</span>(<span class="params">ProducerRecord&lt;<span class="built_in">String</span>, <span class="built_in">String</span>&gt; record</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> record;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">onAcknowledgement</span>(<span class="params">RecordMetadata recordMetadata, Exception e</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (e == <span class="literal">null</span>) &#123;</span><br><span class="line">            successCounter++;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            errorCounter++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">close</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title class_">System</span>.<span class="property">out</span>.<span class="title function_">println</span>(<span class="string">&quot;Successful sent: &quot;</span> + successCounter);</span><br><span class="line">        <span class="title class_">System</span>.<span class="property">out</span>.<span class="title function_">println</span>(<span class="string">&quot;Failed sent: &quot;</span> + errorCounter);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">configure</span>(<span class="params"><span class="built_in">Map</span>&lt;<span class="built_in">String</span>, ?&gt; map</span>) &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>使用自定义interceptor：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; interceptors = new ArrayList&lt;&gt;();</span><br><span class="line">interceptors.<span class="built_in">add</span>(<span class="string">&quot;xx.xx.TimeStampPrependerInterceptor&quot;</span>);</span><br><span class="line">interceptors.<span class="built_in">add</span>(<span class="string">&quot;xx.xx.CounterInterceptor&quot;</span>);</span><br><span class="line">props.put(ProducerConfig.INTERCEPTOR_CLASSES_CONFIG,interceptors);</span><br></pre></td></tr></table></figure>

<h3 id="消息的可靠发送"><a href="#消息的可靠发送" class="headerlink" title="消息的可靠发送"></a>消息的可靠发送</h3><p>Java版本的producer采用异步发送机制，send方法将消息放入缓冲区，由一个专属I&#x2F;O线程负责从缓冲区中提取消息并封装进消息batch中，然后发送出去。这个过程存在着数据丢失的窗口，即若I&#x2F;O线程发送之前producer崩溃，则存储缓冲区中的消息会全部丢失。producer的另一个问题就是消息的乱序，假设现发送record1和record2两条消息，由于某些原因导致record1未发送成功，同时kafka又配置了重试机制，那么producer重试record1成功后，record1在日志中的位置可能反而位于record2之后。</p>
<h3 id="无消息丢失配置"><a href="#无消息丢失配置" class="headerlink" title="无消息丢失配置"></a>无消息丢失配置</h3><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 该配置控制 KafkaProducer.send() 和 KafkaProducer.partitionsFor() 将阻塞多长时间。此外这些方法被阻止，也可能是因为缓冲区已满或元数据不可用。在用户提供的序列化程序或分区器中的锁定不会计入此超时。默认为60000ms。</span></span><br><span class="line">max<span class="selector-class">.block</span>.ms=<span class="number">60000</span></span><br><span class="line"></span><br><span class="line">acks=<span class="attribute">all</span></span><br><span class="line">retries=Integer<span class="selector-class">.MAX_VALUE</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 该参数设置为1使producer在某个broker发送响应之前将无法再给broker发送请求，可防止topic同分区下的消息乱序问题，</span></span><br><span class="line">max<span class="selector-class">.in</span><span class="selector-class">.flight</span><span class="selector-class">.requests</span><span class="selector-class">.per</span>.connection=<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置不允许非ISR中的副本被选举为leader，从而避免broker端因日志问题造成消息的丢失</span></span><br><span class="line">unclean<span class="selector-class">.leader</span>.electionenable=false</span><br><span class="line"></span><br><span class="line">replication.factor=<span class="number">3</span></span><br><span class="line"><span class="comment">// 用于控制某条消息至少被写入到ISR中的多少个副本才算成功</span></span><br><span class="line">min<span class="selector-class">.insync</span>.replicas=<span class="number">2</span></span><br><span class="line"></span><br><span class="line">enable<span class="selector-class">.auto</span>.commit=false</span><br><span class="line"></span><br><span class="line">使用带回调机制的send发送消息</span><br><span class="line">Callback逻辑中显式立即关闭producer</span><br></pre></td></tr></table></figure>

<h2 id="消费数据"><a href="#消费数据" class="headerlink" title="消费数据"></a>消费数据</h2><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kafka-console-consumer.sh <span class="string">\</span></span><br><span class="line">--bootstrap-server bigdata3:<span class="number">9092</span>,bigdata4:<span class="number">9092</span>,bigdata5:<span class="number">9092</span> <span class="string">\</span></span><br><span class="line">--topic dl2262 <span class="string">\</span></span><br><span class="line">--<span class="keyword">from</span>-beginning </span><br></pre></td></tr></table></figure>

<p>–from.beginning :开始消费的位置</p>
<p>问题：消费乱序 ：数据产生的问题和消费顺序不一致</p>
<p>如何保证kafka消费全局有序</p>
<ul>
<li>多分区：不可能<ul>
<li>可以解决，spark ， flink 计算的结果是不对的</li>
<li>source ：mysql  id &#x3D; 1 进行的操作 ： insert delete update</li>
<li>然后把mysql里的binlog采集到kafka -》 flink&#x2F;spark -》hbase&#x2F;phonenix</li>
<li>因为消费乱序，可能会出现问题</li>
<li>思路：<ul>
<li>单分区 ：会影响spark或者flink的吞吐量 原因 ： 原来3个分区，三个并行度 ，现在一个，就慢了</li>
<li>多分区 ：可以利用单分区有序解决全局有序</li>
</ul>
</li>
</ul>
</li>
<li>单分区：可以，单分区数据是有序的</li>
</ul>
<p>消费者消费kafka的数据是以消费者组的方式进行消费的</p>
<p>消费者组 ：</p>
<ul>
<li>一个组内共享一个消费者组的id</li>
<li>组内的所有消费者协调在一起去消费指定的topic的分区数据</li>
<li>每个分区只能由一个消费者组的一个消费者消费</li>
<li>不能由一个消费者组的多个消费者进行重复消费</li>
<li>生产上<ul>
<li>一般是一个消费者，在一个消费者组里</li>
<li>就是可以消费全部分区数据</li>
<li>上述是小公司和一般情况的大公司</li>
<li>大公司 ：<ul>
<li>会用到消费者组 不同消费者处理不同分区数据</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>java api custome</p>
<figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> kafkacustome;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.consumer.ConsumerRecord;</span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.consumer.ConsumerRecords;</span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.consumer.KafkaConsumer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">customertestautooffset</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> void main(<span class="keyword">String</span>[] args) throws IOException, InterruptedException &#123;</span><br><span class="line">        <span class="comment">//1 新建一个consumer对象</span></span><br><span class="line">        Properties properties = <span class="keyword">new</span> <span class="type">Properties</span>();</span><br><span class="line">        properties.load(customertestautooffset.class.getClassLoader().getResourceAsStream(<span class="string">&quot;consumer1.properties&quot;</span>));</span><br><span class="line">        KafkaConsumer&lt;<span class="keyword">String</span>, <span class="keyword">String</span>&gt; consumer = <span class="keyword">new</span> <span class="type">KafkaConsumer</span>&lt;<span class="keyword">String</span>, <span class="keyword">String</span>&gt;(properties);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2 用这个对象接收消息</span></span><br><span class="line">        <span class="comment">//发布订阅模式接收消息，先订阅</span></span><br><span class="line">        consumer.subscribe(Collections.singleton(<span class="string">&quot;dl2262&quot;</span>));</span><br><span class="line">        <span class="keyword">while</span>(<span class="literal">true</span>)&#123;</span><br><span class="line">            <span class="comment">//从订阅的话题中拉取数据</span></span><br><span class="line">            ConsumerRecords&lt;<span class="keyword">String</span>, <span class="keyword">String</span>&gt; poll = consumer.poll(<span class="number">2000</span>);</span><br><span class="line">            <span class="keyword">if</span>(poll.count() == <span class="number">0</span>)&#123;</span><br><span class="line">                Thread.sleep(<span class="number">100</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//消费拉取到的数据</span></span><br><span class="line">            <span class="keyword">for</span> (ConsumerRecord&lt;<span class="keyword">String</span>, <span class="keyword">String</span>&gt; record : <span class="type">poll</span>) &#123;</span><br><span class="line">                System.out.println(record);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3 关闭资源</span></span><br><span class="line">        <span class="comment">//consumer.close();</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>其中“dl2262”是名为的topic的名字，其中groupid一样的就会分配到一起</p>
<p>其中 ： consumer1.properties内容是</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">key.deserializer</span>=org.apache.kafka.common.serialization.StringDeserializer</span><br><span class="line"><span class="attr">value.deserializer</span>=org.apache.kafka.common.serialization.StringDeserializer</span><br><span class="line"><span class="attr">bootstrap.servers</span>=bigdata3:<span class="number">9092</span>,bigdata4:<span class="number">9092</span>,bigdata5:<span class="number">9092</span> </span><br><span class="line"><span class="attr">enable.auto.commit</span>=<span class="literal">true</span></span><br><span class="line"><span class="attr">group.id</span>=test1</span><br><span class="line"><span class="attr">auto.offset.reset</span>=earliest</span><br></pre></td></tr></table></figure>

<p>上述是自动offset的</p>
<p>然后接下来是我们自己提交offset的</p>
<p>手动提交offset的方法有两种：分别是commitSync（同步提交）和commitAsync（异步提交）。两者的相同点是，都会将本次poll的一批数据最高的偏移量提交；不同点是，commitSync阻塞当前线程，一直到提交成功，并且会自动失败重试（由不可控因素导致，也会出现提交失败）；而commitAsync则没有失败重试机制，故有可能提交失败。</p>
<p>修改配置文件中的enable.auto.commit&#x3D;false选项并在消费拉取到的数据之后添加consumer.commitSync();语句即可。由于同步提交offset有失败重试机制，故更加可靠</p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">//消费拉取到的数据</span><br><span class="line">        <span class="keyword">for</span> (ConsumerRecord&lt;String, String&gt; <span class="keyword">record</span> : <span class="type">poll</span>) &#123;</span><br><span class="line">            System.<span class="keyword">out</span>.println(<span class="keyword">record</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        consumer.commitSync();</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>同步提交offset更可靠一些，但是由于其会阻塞当前线程，直到提交成功。因此吞吐量会收到很大的影响。在更多的情况下，会选用异步提交offset的方式。</p>
<h2 id="kafka数据存储"><a href="#kafka数据存储" class="headerlink" title="kafka数据存储"></a>kafka数据存储</h2><p>partition：下面存储就是数据，一段一段相同大小的Segment文件</p>
<p>Segment ：逻辑概念</p>
<ul>
<li>它由log 和index文件组成<ul>
<li>log :实实在在的数据 ，包括元数据 默认大小 1G是由 <code>log.segment.bytes控制单位是字节在配置文件里</code></li>
<li>index：是我们的位置信息</li>
</ul>
</li>
<li>segment的命名规则<ul>
<li>offset.index和offset.log</li>
<li>offset : 偏移量 -》数据event的标号，在topic下的编号</li>
<li>比如 ： <code>00000000000000000000.index 00000000000000000000.log</code></li>
<li>然后如果达到后面最大值，则按照临界的offset来延续比如 <code>0000000000000003333333.index</code>等</li>
</ul>
</li>
</ul>
<p>借助脚本命令查看.log文件</p>
<ul>
<li>因为kafka对数据的存储是按照他自己的存储方式来的，所有我们要查看.log文件的话要用其提供的脚本文件</li>
</ul>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">kafka-run-<span class="keyword">class</span>.sh \</span><br><span class="line">kafka.tools.DumpLogSegments \</span><br><span class="line">--files <span class="regexp">/home/</span>hadoop<span class="regexp">/data/</span>kafka<span class="regexp">/dl2262-0/</span><span class="number">00000000000000000000</span>.log \</span><br><span class="line">--<span class="keyword">print</span>-data-log \</span><br><span class="line">&gt; <span class="number">0</span>.log</span><br></pre></td></tr></table></figure>

<p>上述就是把其文件进行翻译，并存储在0.log中</p>
<p>在index文件中其中是offset：物理地址的形式</p>
<p>它是以稀疏表的方式进行维护的并不是每一条的都维护</p>
<h2 id="面试题"><a href="#面试题" class="headerlink" title="面试题"></a>面试题</h2><p>如何查找offset为11865的数据？简述过程</p>
<p>解答 ：</p>
<ul>
<li>通过二分查找算法 ， 查找offset为11865的最大Segment的文件组</li>
<li>去临近的最大的的index文件里再再用二分查找，找到对应的offset</li>
<li>如何看见其对应的partition：就是其物理地址</li>
<li>根据物理地址去迅速定位位置，按顺序查找，一直找到它</li>
</ul>
<h2 id="交付语义"><a href="#交付语义" class="headerlink" title="交付语义"></a>交付语义</h2><p>消息交付语义 （生产者消费者都有）：</p>
<ul>
<li><p>at most once : 消息可能会丢，不会重复</p>
</li>
<li><p>at least once ：不会丢失，但是可能会重复 ，没有事务，交付和记录是分开的，如果交付完成，再记录的时候挂了，下次启动就会继续从没有记录的位置进行交付，数据会重复</p>
</li>
<li><p>exactly once ： 每个数据仅仅交付一次,增加了一个事务的情况，只有交付和记录都完成才可以继续往下</p>
</li>
<li><p>producer ：</p>
<ul>
<li>发送数据的时候也有交付语义的</li>
<li>kafka 0.11.0 之前至少一次 会导致数据重复 ：at least once</li>
<li>但是 0.11.0之后，包括0.11.0 ，会变成精准交付 : exactly once</li>
</ul>
</li>
<li><p>kafka版本，大于等于0.11.0版本</p>
</li>
<li><p>customer：</p>
<ul>
<li>问题 ：如何存储上次消费到哪一个offset<ul>
<li>取决于，你的消费者组件，看他们支持什么消费者对应的交付语义<ul>
<li>sparkStreaming ： 如上的三种<ul>
<li>at most once</li>
<li>at least once</li>
<li>exactly once</li>
<li>所以我们可以选择至少一次，精准一次，但是至少一次可能由重复问题</li>
<li>但是90%sparkingStream和struedstreaming用至少一次，因为精准一次操作起来比较复杂</li>
</ul>
</li>
<li>flink同理</li>
<li>其他再议</li>
</ul>
</li>
<li>offset信息如何维护？<ul>
<li>先了解</li>
<li>CheckPoints ：很简单，但是弊端也很多 ：生产上不能用 ，因为问题多<ul>
<li>首先会有小文件问题 ，代码变更整个spark项目就不能用了，就是之前记录的chackpoint信息就失效了</li>
</ul>
</li>
<li>kafka itself ：比较推荐 ，简单不用自己写，人家给你生成好的 ，就是最少一次的</li>
<li>use your own data store ： 自己开发 ，用外部的数据源存储offset ，redis ，mysql ，hbase，建议使用hbase是最好的，但是另外两个也可以用的，但是有要求，每分钟的请求次数，mysql可能扛不住，redis可以 ，hbase可以 ， 不推荐用 redis<ul>
<li>可以达到精准一次的语义</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>总的来说工作中用至少一次和精准一次用的很多，flink用的精准一次比较多,其他的至少一次就比较多</li>
</ul>
</li>
</ul>
<h2 id="副本和数据同步"><a href="#副本和数据同步" class="headerlink" title="副本和数据同步"></a>副本和数据同步</h2><p>例子 ：8个分区 1个副本 8节点</p>
<p>kafka ：</p>
<ul>
<li>log 数据 ：topic 三份数据副本<ul>
<li>hdfs 100多个节点 3副本ok</li>
<li>但是kafka才8个节点，3副本大概会崩坏</li>
<li>所以一般是一天或者三天</li>
<li>每个kafka集群都有leader和follower</li>
</ul>
</li>
<li>leader 和 follower<ul>
<li>leader ： 负责对外读写的节点</li>
<li>follower ： 拉取分区上对应的数据 ，进行备份的</li>
</ul>
</li>
<li>机制ack：<ul>
<li>消息发送确认机制</li>
<li>针对produce的</li>
<li>ack 的值有 all 1,0,-1</li>
<li>1<ul>
<li>只要一个分区副本成功写入通知就认为生产者推送消息成功了</li>
</ul>
</li>
<li>0<ul>
<li>完全就不管发送的结果</li>
</ul>
</li>
<li>-1<ul>
<li>其是收到所有分区副本写入成功的通知才认为成功</li>
</ul>
</li>
<li>all<ul>
<li>和-1一样</li>
</ul>
</li>
</ul>
</li>
<li>工作中的选择</li>
<li>大部分时间选择all ，-1</li>
<li>其次是1</li>
<li>最后是0</li>
<li>速度关系0是最快的，1是中间的，-1是最慢的当是多个节点的时候，如果是单个leader和follower的时候1和-1是一样的</li>
</ul>
<p>kafka监控</p>
<ul>
<li>kafka manager首选  二开kafkamanager 可以自己加上 官网 <code>https://github.com/yahoo/CMAK</code></li>
<li>kafka eagle -》 也好用 不过相对上面的那个，就是lower点 ，部署简单好用 官网 <code>https://github.com/smartloli/EFAK</code></li>
</ul>
<h2 id="kafka测试"><a href="#kafka测试" class="headerlink" title="kafka测试"></a>kafka测试</h2><p>用Kafka官方自带的脚本，对Kafka进行压测。Kafka压测时，可以查看到哪个地方出现了瓶颈（CPU，内存，网络IO）。一般都是网络IO达到瓶颈。</p>
<p>kafka-consumer-<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=perf&spm=1001.2101.3001.7020">perf</a>-test.sh</p>
<p>kafka-producer-perf-test.sh</p>
<h3 id="Kafka-Producer压力测试"><a href="#Kafka-Producer压力测试" class="headerlink" title="Kafka Producer压力测试"></a>Kafka Producer压力测试</h3><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">bin/kafka-producer-perf-test.sh  \</span><br><span class="line">--topic test \</span><br><span class="line">--record-size <span class="number">100</span> \</span><br><span class="line">--num-records <span class="number">100000</span> \</span><br><span class="line">--throughput -<span class="number">1</span> \</span><br><span class="line">--producer-props bootstrap.<span class="attr">servers=</span>bigdata3:<span class="number">9092</span>,bigdata4:<span class="number">9092</span>,bigdata5:<span class="number">9092</span></span><br><span class="line"></span><br><span class="line">record-size是一条信息有多大，单位是字节。</span><br><span class="line">num-records是总共发送多少条信息。</span><br><span class="line">throughput 是每秒多少条信息，设成-<span class="number">1</span>，表示不限流，可测出生产者最大吞吐量。</span><br><span class="line"></span><br><span class="line">他会打印下面的语句</span><br><span class="line"><span class="number">100000</span> records sent, <span class="number">149253.731343</span> records/sec (<span class="number">14.23</span> MB/sec), <span class="number">112.02</span> <span class="keyword">ms</span> <span class="title">avg</span> latency, <span class="number">207.00</span> <span class="keyword">ms</span> <span class="title">max</span> latency, <span class="number">97</span> <span class="keyword">ms</span> <span class="title">50th</span>, <span class="number">190</span> <span class="keyword">ms</span> <span class="title">95th</span>, <span class="number">206</span> <span class="keyword">ms</span> <span class="title">99th</span>, <span class="number">207</span> <span class="keyword">ms</span> <span class="title">99</span>.<span class="number">9</span>th.</span><br><span class="line">参数解析：本例中一共写入<span class="number">10</span>w条消息，吞吐量为<span class="number">14.23</span> MB/sec，每次写入的平均延迟为<span class="number">112.02</span>毫秒，最大的延迟为<span class="number">207</span>毫秒</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="Kafka-Consumer压力测试"><a href="#Kafka-Consumer压力测试" class="headerlink" title="Kafka Consumer压力测试"></a>Kafka Consumer压力测试</h3><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">kafka-consumer-perf-test.sh </span><br><span class="line"><span class="comment">--broker-list bigdata3:9092,bigdata4:9092,bigdata35:9092 </span></span><br><span class="line"><span class="comment">--topic test </span></span><br><span class="line"><span class="comment">--fetch-size 10000 </span></span><br><span class="line"><span class="comment">--messages 10000000 </span></span><br><span class="line"><span class="comment">--threads 1</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">--zookeeper 指定zookeeper的链接信息</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--topic 指定topic的名称</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--fetch-size 指定每次fetch的数据的大小</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--messages 总共要消费的消息个数</span></span><br><span class="line">测试结果说明：</span><br><span class="line"></span><br><span class="line"><span class="built_in">start</span>.<span class="built_in">time</span>, <span class="keyword">end</span>.<span class="built_in">time</span>, data.consumed.<span class="keyword">in</span>.MB, MB.<span class="built_in">sec</span>, data.consumed.<span class="keyword">in</span>.nMsg, nMsg.<span class="built_in">sec</span></span><br><span class="line"><span class="number">2020</span><span class="number">-03</span><span class="number">-10</span> <span class="number">03</span>:<span class="number">18</span>:<span class="number">51</span>:<span class="number">773</span>, <span class="number">2020</span><span class="number">-03</span><span class="number">-10</span> <span class="number">03</span>:<span class="number">18</span>:<span class="number">53</span>:<span class="number">815</span>, <span class="number">19.0735</span>, <span class="number">9.3406</span>, <span class="number">200000</span>, <span class="number">97943.192</span></span><br></pre></td></tr></table></figure>

<h2 id="Kafka-集群数据迁移"><a href="#Kafka-集群数据迁移" class="headerlink" title="Kafka 集群数据迁移"></a>Kafka 集群数据迁移</h2><h3 id="同集群迁移"><a href="#同集群迁移" class="headerlink" title="同集群迁移"></a>同集群迁移</h3><p>同集群之间数据迁移，比如在已有的集群中新增了一个Broker节点，此时需要将原来集群中已有的Topic的数据迁移部分到新的集群中，缓解集群压力。</p>
<p>将新的节点添加到Kafka集群很简单，只需为它们分配一个唯一的Broker ID，并在新<a target="_blank" rel="noopener" href="https://cloud.tencent.com/product/cvm?from=10680">服务器</a>上启动Kafka。但是，这些新服务器节点不会自动分配任何数据分区，因此除非将分区移动到新增的节点，否则在创建新Topic之前新节点不会执行任何操作。因此，通常在将新服务器节点添加到Kafka集群时，需要将一些现有数据迁移到这些新的节点。</p>
<p>迁移数据的过程是手动启动的，执行过程是完全自动化的。在Kafka后台服务中，Kafka将添加新服务器作为其正在迁移的分区的Follower，并允许新增节点完全复制该分区中的现有数据。当新服务器节点完全复制此分区的内容并加入同步副本（ISR）时，其中一个现有副本将删除其分区的数据。</p>
<p>Kafka系统提供了一个分区重新分配工具（kafka-reassign-partitions.sh），该工具可用于在Broker之间迁移分区。理想情况下，将确保所有Broker的数据和分区均匀分配。分区重新分配工具无法自动分析Kafka群集中的数据分布并迁移分区以实现均匀的<a target="_blank" rel="noopener" href="https://cloud.tencent.com/product/clb?from=10680">负载均衡</a>。因此，管理员在操作的时候，必须弄清楚应该迁移哪些Topic或分区。</p>
<p>分区重新分配工具可以在3种互斥模式下运行：</p>
<ul>
<li>–generate：在此模式下，给定Topic列表和Broker列表，该工具会生成候选重新分配，以将指定Topic的所有分区迁移到新Broker中。此选项仅提供了一种方便的方法，可在给定Topic和目标Broker列表的情况下生成分区重新分配计划。</li>
<li>–execute：在此模式下，该工具将根据用户提供的重新分配计划启动分区的重新分配。 （使用–reassignment-json-file选项）。由管理员手动制定自定义重新分配计划，也可以使用–generate选项提供。</li>
<li>–verify：在此模式下，该工具将验证最后一次–execute期间列出的所有分区的重新分配状态。状态可以有成功、失败或正在进行等状态。</li>
</ul>
<h3 id="迁移过程实现"><a href="#迁移过程实现" class="headerlink" title="迁移过程实现"></a>迁移过程实现</h3><p>分区重新分配工具可用于将一些Topic从当前的Broker节点中迁移到新添加的Broker中。这在扩展现有集群时通常很有用，因为将整个Topic移动到新的Broker变得更容易，而不是一次移动一个分区。当执行此操作时，用户需要提供已有的Broker节点的Topic列表，以及到新节点的Broker列表（源Broker到新Broker的映射关系）。然后，该工具在新的Broker中均匀分配给指定Topic列表的所有分区。在迁移过程中，Topic的复制因子保持不变。</p>
<p>现有如下实例，将Topic为ke01，ke02的所有分区从Broker1中移动到新增的Broker2和Broker3中。由于该工具接受Topic的输入列表作为JSON文件，因此需要明确迁移的Topic并创建json文件，如下所示：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; cat topic-<span class="keyword">to</span>-<span class="keyword">move</span>.json</span><br><span class="line">&#123;&quot;topics&quot;: [&#123;&quot;topic&quot;: &quot;ke01&quot;&#125;,</span><br><span class="line">            &#123;&quot;topic&quot;: &quot;ke02&quot;&#125;],</span><br><span class="line">&quot;version&quot;:<span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>准备好JSON文件，然后使用分区重新分配工具生成候选分配，命令如下：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; bin/kafka-<span class="keyword">reassign</span>-partitions.sh <span class="comment">--zookeeper bigdata3:2181,bigdata4:2181,bigdata5:2181/kafka  --topics-to-move-json-file topics-to-move.json --broker-list &quot;1,2&quot; --generate</span></span><br></pre></td></tr></table></figure>

<p>该工具生成一个候选分配，将所有分区从Topic ke01，ke02移动到Broker1和Broker2。需求注意的是，此时分区移动尚未开始，它只是告诉你当前的分配和建议。保存当前分配，以防你想要回滚它。新的赋值应保存在JSON文件（例如expand-cluster-reassignment.json）中，以使用–execute选项执行。JSON文件如下：</p>
<figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&quot;version&quot;</span>:<span class="number">1</span>,<span class="string">&quot;partitions&quot;</span>:[&#123;<span class="string">&quot;topic&quot;</span>:<span class="string">&quot;ke02&quot;</span>,<span class="string">&quot;partition&quot;</span>:<span class="number">0</span>,<span class="string">&quot;replicas&quot;</span>:[<span class="number">2</span>]&#125;,&#123;<span class="string">&quot;topic&quot;</span>:<span class="string">&quot;ke02&quot;</span>,<span class="string">&quot;partition&quot;</span>:<span class="number">1</span>,<span class="string">&quot;replicas&quot;</span>:[<span class="number">1</span>]&#125;,&#123;<span class="string">&quot;topic&quot;</span>:<span class="string">&quot;ke02&quot;</span>,<span class="string">&quot;partition&quot;</span>:<span class="number">2</span>,<span class="string">&quot;replicas&quot;</span>:[<span class="number">2</span>]&#125;,&#123;<span class="string">&quot;topic&quot;</span>:<span class="string">&quot;ke01&quot;</span>,<span class="string">&quot;partition&quot;</span>:<span class="number">0</span>,<span class="string">&quot;replicas&quot;</span>:[<span class="number">2</span>]&#125;,&#123;<span class="string">&quot;topic&quot;</span>:<span class="string">&quot;ke01&quot;</span>,<span class="string">&quot;partition&quot;</span>:<span class="number">1</span>,<span class="string">&quot;replicas&quot;</span>:[<span class="number">1</span>]&#125;,&#123;<span class="string">&quot;topic&quot;</span>:<span class="string">&quot;ke01&quot;</span>,<span class="string">&quot;partition&quot;</span>:<span class="number">2</span>,<span class="string">&quot;replicas&quot;</span>:[<span class="number">2</span>]&#125;]&#125;</span><br></pre></td></tr></table></figure>

<p>命令</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; ./kafka-<span class="keyword">reassign</span>-partitions.sh <span class="comment">--zookeeper bigdata3:2181,bigdata4:2181,bigdata5:2181/kafka --reassignment-json-file expand-cluster-reassignment.json --execute</span></span><br></pre></td></tr></table></figure>

<p>最后，–verify选项可与该工具一起使用，以检查分区重新分配的状态。需要注意的是，相同的expand-cluster-reassignment.json（与–execute选项一起使用）应与–verify选项一起使用，执行命令如下：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; ./kafka-<span class="keyword">reassign</span>-partitions.sh <span class="comment">--zookeeper bigdata3:2181,bigdata4:2181,bigdata5:2181/kafka --reassignment-json-file expand-cluster-reassignment.json --verify</span></span><br></pre></td></tr></table></figure>

<p>同时，我们可以通过<a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_63722685?spm=1011.2124.3001.5343">Kafka Eagle</a>工具来查看Topic的分区情况。</p>
<h2 id="跨集群迁移"><a href="#跨集群迁移" class="headerlink" title="跨集群迁移"></a>跨集群迁移</h2><p>这里跨集群迁移，我们指的是在Kafka多个集群之间复制数据“镜像”的过程，以避免与单个集群中的节点之间发生的复制混淆。 Kafka附带了一个用于在Kafka集群之间镜像数据的工具。该工具从源集群使用并生成到目标集群。这种镜像的一个常见用例是在另一个数据中心提供副本。</p>
<p>另外，你可以运行许多此类镜像进程以提高吞吐量和容错（如果一个进程终止，其他进程将占用额外负载）。将从源集群中的Topic读取数据，并将其写入目标集群中具有相同名称的主题。事实上，“镜像”数据只不过是一个Kafka将消费者和生产者联系在了一起。</p>
<p>源集群和目标集群是完全独立的实体，它们可以具有不同数量的分区，并且偏移量将不相同。出于这个原因，镜像集群并不是真正意图作为容错机制（因为消费者的位置会有所不同）;为此，建议使用正常的集群内复制。但是，镜像进程将保留并使用消息Key进行分区，因此可以按Key保留顺序。</p>
<p>下面是一个跨集群的单Topic实例，命令如下：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; ./kafka-mirror-maker<span class="selector-class">.sh</span> <span class="attr">--consumer</span><span class="selector-class">.config</span> consumer<span class="selector-class">.properties</span> <span class="attr">--producer</span><span class="selector-class">.config</span> producer<span class="selector-class">.properties</span> <span class="attr">--whitelist</span> ke03</span><br></pre></td></tr></table></figure>

<p>需要注意的是，consumer.properties文件配置源Kafka集群Broker地址，producer.properties文件配置目标Kafka集群地址。如果需要迁移多个Topic，可以使用 –whitelist ‘A|B’，如果需要迁移所有的Topic，可以使用 –whitelist ‘*’。</p>
<p>执行跨集群迁移命令后，目标集群中使用Kafka Eagle中查看Topic Size大小看是否与源集群的Topic Size大小相等，或者使用SQL语句，验证是否有数据迁移过来，</p>
<p>跨集群迁移数据的本质是，Kafka启动了消费者读取源集群数据，并将消费后的数据写入到目标集群，在迁移的过程中，可以启动多个实例，提供迁出的吞吐量。</p>

      
    </div>

    
    
    

      
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://zihang.fun/2022/12/15/%E6%8A%80%E6%9C%AF%E7%82%B9/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="liu zihang">
      <meta itemprop="description" content="只有努力不会辜负你">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="枫叶冢">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/12/15/%E6%8A%80%E6%9C%AF%E7%82%B9/" class="post-title-link" itemprop="url">自我认为的知识点</a>
        </h2>

        <div class="post-meta">
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-12-15 16:31:20" itemprop="dateCreated datePublished" datetime="2022-12-15T16:31:20+08:00">2022-12-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-12-16 14:42:28" itemprop="dateModified" datetime="2022-12-16T14:42:28+08:00">2022-12-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%B4%E7%90%86/" itemprop="url" rel="index"><span itemprop="name">整理</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>1.9k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>2 分钟</span>
            </span>

        </div>
      </header>

    
    
    

   

    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h1><h2 id="问题1"><a href="#问题1" class="headerlink" title="问题1"></a>问题1</h2><p>awk为什么会被称作linux三剑客之一，相比于cut如何？</p>
<p>场景 ： 通过ssh bigdata2 “jps | xxx | awk ‘{print $1}’” :结果如何 ？前提条件 ：bigdata2的密钥已经添加在当前的机器上，且jps能查到xxx的进程号</p>
<h2 id="问题2"><a href="#问题2" class="headerlink" title="问题2"></a>问题2</h2><p>场景 ： 当所有命令都提示找不到命令 ，是什么原因 ，如何解决 ？</p>
<p>场景 ： 当有命令提示找不到命令 ，是什么原因 ，如何解决 ？</p>
<h2 id="问题3"><a href="#问题3" class="headerlink" title="问题3"></a>问题3</h2><p>众所周知 ，root用户有最高的权限 ，那么当我们在hadoop用户启动程序通过jps能查看到信息的，切换到root用户我们可以看见信息吗</p>
<h2 id="问题4"><a href="#问题4" class="headerlink" title="问题4"></a>问题4</h2><p>一台机器里有hadoop ,zihang ,root 三个用户 ，你所在的用户是root ，当你执行su - zihang 的时候什么也没出现并且你还在root用户，这个是什么原因，如何修复</p>
<h2 id="问题5"><a href="#问题5" class="headerlink" title="问题5"></a>问题5</h2><p>linux里查看内存负载，以及所用内存，以及设置swap分区的命令及步骤，</p>
<h1 id="shell"><a href="#shell" class="headerlink" title="shell"></a>shell</h1><h2 id="问题1-1"><a href="#问题1-1" class="headerlink" title="问题1"></a>问题1</h2><p>shell里如何控制从控制台输入的参数，传进函数里的个数</p>
<h2 id="问题2-1"><a href="#问题2-1" class="headerlink" title="问题2"></a>问题2</h2><p>shell 里截取字符串以及替换字符串是如何实现的</p>
<h2 id="问题3-1"><a href="#问题3-1" class="headerlink" title="问题3"></a>问题3</h2><p>shell里的$全家桶</p>
<h2 id="问题4-1"><a href="#问题4-1" class="headerlink" title="问题4"></a>问题4</h2><p>shell里单引号，双引号，漂号的区别，以及两种括号的形式（）和{}的区别</p>
<h2 id="问题5-1"><a href="#问题5-1" class="headerlink" title="问题5"></a>问题5</h2><p>shell脚本执行不了，但是代码毫无问题，只是单纯提示最后一行结尾不对，原因有几种，解决办法是什么</p>
<h1 id="mysql"><a href="#mysql" class="headerlink" title="mysql"></a>mysql</h1><h2 id="问题1-2"><a href="#问题1-2" class="headerlink" title="问题1"></a>问题1</h2><p>mysql中where和having的区别</p>
<h2 id="问题2-2"><a href="#问题2-2" class="headerlink" title="问题2"></a>问题2</h2><p>mysql中我如果想把竖着的一列变成横着的如何操作：</p>
<table>
<thead>
<tr>
<th>人数</th>
<th>部门</th>
</tr>
</thead>
<tbody><tr>
<td>11</td>
<td>a</td>
</tr>
</tbody></table>
<p>其中5人生病，6人未生病，如何变成下面的样子:说出大概思路即可</p>
<table>
<thead>
<tr>
<th>人数</th>
<th>部门</th>
<th>生病人数</th>
<th>未生病人数</th>
</tr>
</thead>
<tbody><tr>
<td>11</td>
<td>a</td>
<td>0</td>
<td>6</td>
</tr>
<tr>
<td>11</td>
<td>a</td>
<td>5</td>
<td>0</td>
</tr>
</tbody></table>
<h2 id="问题3-2"><a href="#问题3-2" class="headerlink" title="问题3"></a>问题3</h2><p>mysql中判断空值的方法有什么，以及多路选择的方法</p>
<h2 id="问题4-2"><a href="#问题4-2" class="headerlink" title="问题4"></a>问题4</h2><p>在往mysql的表里插入数据的时候，发现带有中文的字符插入不进去，如何解决，什么原因造成的，mysql8及以后如何</p>
<h2 id="问题5-2"><a href="#问题5-2" class="headerlink" title="问题5"></a>问题5</h2><p>你认为mysql为什么到目前为止都没有被淘汰？</p>
<h1 id="hadoop"><a href="#hadoop" class="headerlink" title="hadoop"></a>hadoop</h1><h2 id="问题1-3"><a href="#问题1-3" class="headerlink" title="问题1"></a>问题1</h2><p>关于hadoop的基础架构，以及mr的流程</p>
<h2 id="问题2-3"><a href="#问题2-3" class="headerlink" title="问题2"></a>问题2</h2><p>关于客户端向hdfs上传输数据的流程，而且它是如何被分块的</p>
<h2 id="问题3-3"><a href="#问题3-3" class="headerlink" title="问题3"></a>问题3</h2><p>hadoop文件存储的放置策略，以及为什么这样放置</p>
<h2 id="问题4-3"><a href="#问题4-3" class="headerlink" title="问题4"></a>问题4</h2><p>Hadoop上的yarn的申请资源的流程，以及为什么要使用多块物理磁盘？</p>
<h2 id="问题5-3"><a href="#问题5-3" class="headerlink" title="问题5"></a>问题5</h2><p>hdfs上的压缩格式，以及优缺点，和我们常用的</p>
<h2 id="问题6"><a href="#问题6" class="headerlink" title="问题6"></a>问题6</h2><p>hadoop序列化</p>
<p>序列化就是把内存中的对象转换成字节序列(或其他数据传输协议)，以便存储于磁盘和网络传输。</p>
<p>优点 ：</p>
<p>紧凑：高效使用存储空间</p>
<p>快速：读写数据额外开销小</p>
<p>可扩展性：随着通讯协议的升级而升级</p>
<p>互操性：支持多语言的交互</p>
<h2 id="问题7"><a href="#问题7" class="headerlink" title="问题7"></a>问题7</h2><p>yarn调度器</p>
<h2 id="问题8"><a href="#问题8" class="headerlink" title="问题8"></a>问题8</h2><p>分区vs分桶</p>
<p>分区表：在逻辑上，将表中的数据按分区放在表目录的对应子目录中，在物理上，分区表和未分区表没有区别，分区表在表创建完成时，也可以通过alter table来添加或者删除，而且分区键一定不是原表中的列。<br>桶表：不同表对同一字段分桶，且当两张表桶数相同时，数据会分配到同一个节点上，join时会减少shuffle，和分区键不同，分桶键必须是原表中的列，分桶表中每个桶的文件作了排序，分桶数应为质数，每个桶文件大小应在100MB~200MB之间，事务表必须指定分桶，且分桶数是不可以被更新的。</p>
<h2 id="问题9"><a href="#问题9" class="headerlink" title="问题9"></a>问题9</h2><p>yarn原理</p>
<h1 id="hive"><a href="#hive" class="headerlink" title="hive"></a>hive</h1><h2 id="问题1-4"><a href="#问题1-4" class="headerlink" title="问题1"></a>问题1</h2><p>你所理解的hive是什么？</p>
<h2 id="问题2-4"><a href="#问题2-4" class="headerlink" title="问题2"></a>问题2</h2><p>hive在mysql中的几个关键表都是什么</p>
<h2 id="问题3-4"><a href="#问题3-4" class="headerlink" title="问题3"></a>问题3</h2><p>hive里空值如何处理，hive中mapjoin如何开启以及开启之后的原理</p>
<h2 id="问题4-4"><a href="#问题4-4" class="headerlink" title="问题4"></a>问题4</h2><p>hive里内部表和外部表的区别，以及如何转化</p>
<h2 id="问题5-4"><a href="#问题5-4" class="headerlink" title="问题5"></a>问题5</h2><p>hive里的开窗函数能用在什么函数上，开窗之后还可以分组吗</p>
<h2 id="问题6-1"><a href="#问题6-1" class="headerlink" title="问题6"></a>问题6</h2><p>hive如何把一列数据转化为数组，并且hive的适用场景是什么</p>
<h1 id="flume"><a href="#flume" class="headerlink" title="flume"></a>flume</h1><h2 id="问题1-5"><a href="#问题1-5" class="headerlink" title="问题1"></a>问题1</h2><p>flume如何设置传输到hdfs上的数据的压缩格式</p>
<h2 id="问题2-5"><a href="#问题2-5" class="headerlink" title="问题2"></a>问题2</h2><p>flume如何控制小文件的数量，以及如何监控flume的采集情况</p>
<h2 id="问题3-5"><a href="#问题3-5" class="headerlink" title="问题3"></a>问题3</h2><p>flume如何控制多个channel和Sink，以及控制形式都有什么</p>
<h2 id="问题4-5"><a href="#问题4-5" class="headerlink" title="问题4"></a>问题4</h2><p>现阶段如何解决日志数据延迟性问题</p>
<h2 id="问题5-5"><a href="#问题5-5" class="headerlink" title="问题5"></a>问题5</h2><p>flume采集的数据文件会丢失吗，为什么以及taildir所谓的断点续传是什么，由什么控制</p>
<h1 id="sqoop"><a href="#sqoop" class="headerlink" title="sqoop"></a>sqoop</h1><h2 id="问题1-6"><a href="#问题1-6" class="headerlink" title="问题1"></a>问题1</h2><p>sqoop同步mysql到hive的时候如何设置分区表</p>
<h2 id="问题2-6"><a href="#问题2-6" class="headerlink" title="问题2"></a>问题2</h2><p>sqoop是走mr程序吗？为什么sqoop运行如此的慢</p>
<h2 id="问题3-6"><a href="#问题3-6" class="headerlink" title="问题3"></a>问题3</h2><p>sqoop同步hive到mysql的时候经常因为不明原因就中断了，如何解决</p>
<h2 id="问题4-6"><a href="#问题4-6" class="headerlink" title="问题4"></a>问题4</h2><p>sqoop同步hive到mysql分区表的思路以及操作是什么</p>
<h2 id="问题5-6"><a href="#问题5-6" class="headerlink" title="问题5"></a>问题5</h2><p>sqoop导入数据的时候如何保证数据的幂等性</p>
<h1 id="zk"><a href="#zk" class="headerlink" title="zk"></a>zk</h1><h2 id="问题1-7"><a href="#问题1-7" class="headerlink" title="问题1"></a>问题1</h2><p>如何创建临时节点和永久节点</p>
<h2 id="问题2-7"><a href="#问题2-7" class="headerlink" title="问题2"></a>问题2</h2><p>四字命令是干什么的</p>
<h2 id="问题3-7"><a href="#问题3-7" class="headerlink" title="问题3"></a>问题3</h2><p>zk命令行监听和api监听的区别，通过上面命令进行监听</p>
<h2 id="问题4-7"><a href="#问题4-7" class="headerlink" title="问题4"></a>问题4</h2><p>如何创建顺序节点</p>
<h2 id="问题5-7"><a href="#问题5-7" class="headerlink" title="问题5"></a>问题5</h2><p>zk如何管理我们的namenode的上位，以及，如何监控的</p>

      
    </div>

    
    
    

      
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://zihang.fun/2022/12/15/12-15/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="liu zihang">
      <meta itemprop="description" content="只有努力不会辜负你">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="枫叶冢">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/12/15/12-15/" class="post-title-link" itemprop="url">zookeeper</a>
        </h2>

        <div class="post-meta">
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-12-15 08:20:33" itemprop="dateCreated datePublished" datetime="2022-12-15T08:20:33+08:00">2022-12-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-12-17 18:39:44" itemprop="dateModified" datetime="2022-12-17T18:39:44+08:00">2022-12-17</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%97%A5%E5%BF%97/" itemprop="url" rel="index"><span itemprop="name">日志</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>11k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>10 分钟</span>
            </span>

        </div>
      </header>

    
    
    

   

    <div class="post-body" itemprop="articleBody">

      
          <h1 id="hive的抓取策略"><a href="#hive的抓取策略" class="headerlink" title="hive的抓取策略"></a>hive的抓取策略</h1><p>什么是hive的抓取策略呢，举个简单的例子,当我们用 <code>select * from xxx</code>的时候它不会走mr阶段，会直接出来，可是有时候会走mr这个是由什么控制的？就是由我们的hive的抓取策略决定的</p>
<p>我们还可以在配置文件中进行更改，把不要mr的代码变多</p>
<p><code>hive/conf/hive-default.xml.template -》 2637行，修改hive.fetch.task.conversion为more；</code></p>
<p>就相当于把全局查找，字段查找，filter查找，limit查找等都不走MR，直接Fetch</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;property&gt;</span><br><span class="line">  &lt;<span class="type">name</span>&gt;hive.<span class="keyword">fetch</span>.task.<span class="keyword">conversion</span>&lt;/<span class="type">name</span>&gt;</span><br><span class="line">  &lt;<span class="keyword">value</span>&gt;more&lt;/<span class="keyword">value</span>&gt;</span><br><span class="line">  &lt;description&gt;</span><br><span class="line">    Expects one <span class="keyword">of</span> [<span class="keyword">none</span>, minimal, more].</span><br><span class="line">    <span class="keyword">Some</span> <span class="keyword">select</span> queries can be converted <span class="keyword">to</span> single <span class="keyword">FETCH</span> task minimizing latency.</span><br><span class="line">    Currently the query should be single sourced <span class="keyword">not</span> <span class="keyword">having</span> <span class="keyword">any</span> subquery <span class="keyword">and</span> should <span class="keyword">not</span> have</span><br><span class="line">    <span class="keyword">any</span> aggregations <span class="keyword">or</span> distincts (which incurs RS), <span class="keyword">lateral</span> views <span class="keyword">and</span> joins.</span><br><span class="line">    <span class="number">0.</span> <span class="keyword">none</span> : <span class="keyword">disable</span> hive.<span class="keyword">fetch</span>.task.<span class="keyword">conversion</span></span><br><span class="line">    <span class="number">1.</span> minimal : <span class="keyword">SELECT</span> STAR, <span class="keyword">FILTER</span> <span class="keyword">on</span> <span class="keyword">partition</span> <span class="keyword">columns</span>, <span class="keyword">LIMIT</span> <span class="keyword">only</span></span><br><span class="line">    <span class="number">2.</span> more    : <span class="keyword">SELECT</span>, <span class="keyword">FILTER</span>, <span class="keyword">LIMIT</span> <span class="keyword">only</span> (support <span class="keyword">TABLESAMPLE</span> <span class="keyword">and</span> virtual <span class="keyword">columns</span>)</span><br><span class="line">  &lt;/description&gt;</span><br><span class="line">&lt;/property&gt;</span><br></pre></td></tr></table></figure>

<p>然后还可以设置 ：</p>
<p> 用户可以通过设置hive.exec.mode.local.auto的值为true，来让Hive在适当的时候自动启动这个优化。</p>
<p>set hive.exec.mode.local.auto&#x3D;true; &#x2F;&#x2F;开启本地mr</p>
<p>设置local mr的最大输入数据量，当输入数据量小于这个值时采用local mr的方式，默认为134217728，即128M</p>
<p>set hive.exec.mode.local.auto.inputbytes.max&#x3D;51234560;</p>
<p>设置local mr的最大输入文件个数，当输入文件个数小于这个值时采用local mr的方式，默认为4</p>
<p>set hive.exec.mode.local.auto.input.files.max&#x3D;10;</p>
<p>调整hive里的切片大小 ：</p>
<p>mapreduce.input.fileinputformat.split.maxsize</p>
<p>mapreduce.input.fileinputformat.split.minsize</p>
<p>maxsize（切片最大值）：参数如果调得比blockSize小，则会让切片变小，而且就等于配置的这个参数的值。<br>minsize（切片最小值）：参数调的比blockSize大，则可以让切片变得比blockSize还大。</p>
<h1 id="sql调优（speed）"><a href="#sql调优（speed）" class="headerlink" title="sql调优（speed）"></a>sql调优（speed）</h1><h2 id="小表join大表"><a href="#小表join大表" class="headerlink" title="小表join大表"></a>小表join大表</h2><p>当小表Join大表时，如果不指定MapJoin，那么hive解析器会将join操作转换为Common Join操作，在Reduce端完成join，容易发生<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E6%95%B0%E6%8D%AE%E5%80%BE%E6%96%9C&spm=1001.2101.3001.7020">数据倾斜</a>。开启MapJoin后可以将小表全部加载到内存中，在map端进行join，避免reducer处理。</p>
<p>优点 ：</p>
<figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">（<span class="number">1</span>）没有reducer处理，就不会产生数据倾斜；</span><br><span class="line"></span><br><span class="line">（<span class="number">2</span>）没有Map -&gt; Reduce中间的shuffle操作，避免了IO</span><br><span class="line"></span><br><span class="line"><span class="number">1</span>. 开启MapJoin设置</span><br><span class="line">（<span class="number">1</span>）设置自动选择MapJoin，默认是<span class="literal">true</span></span><br><span class="line">set hive.auto.<span class="built_in">convert</span>.<span class="built_in">join</span> = <span class="literal">true</span>;</span><br><span class="line"> </span><br><span class="line">（<span class="number">2</span>）设置小表阈值，默认是25M</span><br><span class="line">set hive.mapjoin.smalltable.filesize=<span class="number">25000000</span>;</span><br><span class="line"> </span><br><span class="line"><span class="number">2</span>. 再大表<span class="built_in">join</span>小表，与小表<span class="built_in">join</span>大表，执行速率几乎相等</span><br><span class="line"></span><br><span class="line">Hive中mapjoin的原理：</span><br><span class="line"></span><br><span class="line"><span class="built_in">map</span>-side <span class="built_in">join</span>：</span><br><span class="line"></span><br><span class="line">小表数据映射成一张hashtable，再上传到分布式节点的内存中；</span><br><span class="line">大表进行分片，每个节点一部分数据，大表数据文件作为<span class="built_in">map</span>端输入，对<span class="built_in">map</span>()函数每一对输入的kv都与已加载到内存中的小表数据连接，</span><br><span class="line">把连接结果按<span class="built_in">key</span>输出，有多少个<span class="built_in">map</span> task，产生多少个结果文件；</span><br><span class="line">由于<span class="built_in">join</span>操作在<span class="built_in">map</span> task中完成，所以无需启动reduce task，没有shuffle操作和reduce端，避免io和数据倾斜</span><br><span class="line"></span><br><span class="line">reduce-side <span class="built_in">join</span>：</span><br><span class="line"></span><br><span class="line"><span class="built_in">map</span>端把结果按<span class="built_in">key</span>输出，并在value中标记出数据来源于table1还是table2</span><br><span class="line">因为在shuffle阶段已经按<span class="built_in">key</span>分组，reduce阶段会判断每个value来自哪张表，然后两表相同<span class="built_in">key</span>的记录连接</span><br><span class="line"><span class="built_in">join</span>操作在reduce task中完成</span><br><span class="line"></span><br><span class="line">缺点<span class="number">1</span>：在<span class="built_in">map</span>阶段没有对数据瘦身，shuffle的网络传输和排序性能很低</span><br><span class="line">缺点<span class="number">2</span>：reduce对<span class="number">2</span>个集合做城际计算，很耗内存，容易造成oom</span><br></pre></td></tr></table></figure>

<h2 id="大表join大表"><a href="#大表join大表" class="headerlink" title="大表join大表"></a>大表join大表</h2><p>有时join超时是因为某些key对应的数据太多了。由于相同的key对应的数据都会发送到相同的reducer上，如果出现数据倾斜可能导致内存不足。</p>
<p>常见对于key对应字段为空，可以采取的优化手段包括空值key过滤和空值key转换</p>
<p>首先我们要进行配置，开启历史服务器</p>
<figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>. 首先配置mapred-site.xml</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span><span class="language-xml"><span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.jobhistory.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"></span><span class="language-xml"><span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop100:10020<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    </span><span class="language-xml"><span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.jobhistory.webapp.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    </span><span class="language-xml"><span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop100:19888<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="number">2</span>. 在shell端启动历史服务器</span><br><span class="line">sbin/mr-jobhistory-daemon.sh <span class="keyword">start</span> historyserver</span><br><span class="line"> </span><br><span class="line"><span class="number">3</span>. 查看jobhistory端口</span><br><span class="line">http://hadoop10<span class="number">0</span>:<span class="number">19888</span>/jobhistory</span><br></pre></td></tr></table></figure>

<p>空key过滤</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">不过滤空id列</span><br><span class="line"><span class="keyword">insert</span> overwrite table A </span><br><span class="line"><span class="keyword">select</span> b.* <span class="keyword">from</span> B b <span class="keyword">left</span> <span class="keyword">join</span> C c <span class="keyword">on</span> b.id = c.id;</span><br><span class="line"> </span><br><span class="line">过滤掉空id列</span><br><span class="line"><span class="keyword">insert</span> overwrite table A </span><br><span class="line"><span class="keyword">select</span> b.* <span class="keyword">from</span> (<span class="keyword">select</span> * <span class="keyword">from</span> B <span class="keyword">where</span> id <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">null</span>) b <span class="keyword">left</span> <span class="keyword">join</span> C c <span class="keyword">on</span> b.id = c.id;</span><br><span class="line">过滤掉空id列后，耗费时间会降低很多。</span><br></pre></td></tr></table></figure>

<p><strong>或者把它变成其他的有值的</strong></p>
<p>有时虽然某个key对应的null很多，但null并不是异常数据，不能过滤掉，必须包含在join的结果中，这样就可以考虑把表中key为null的字段赋一个随机值，使得数据随机均匀分到不同的reducer上。</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">首先设置reduce个数</span><br><span class="line"><span class="keyword">set</span> mapreduce.job.reduces = <span class="number">5</span>;</span><br><span class="line"> </span><br><span class="line">然后<span class="keyword">join</span>两张表，随机设置<span class="keyword">null</span>值</span><br><span class="line"><span class="keyword">insert</span> overwrite <span class="keyword">table</span> A</span><br><span class="line"><span class="keyword">select</span> b.* <span class="keyword">from</span> B b <span class="keyword">full</span> <span class="keyword">join</span> C c <span class="keyword">on</span></span><br><span class="line"><span class="keyword">case</span> <span class="keyword">when</span> b.id <span class="keyword">is</span> <span class="keyword">null</span> <span class="keyword">then</span> concat (<span class="string">&#x27;hive&#x27;</span>,rand()) <span class="keyword">else</span> b.id end = c.id;</span><br></pre></td></tr></table></figure>

<p>原理：当表b的字段id为null时，如果null过多所有null对应同一个key即id，都挤到一个reduce上，通过优化将表b的key&#x3D;id换成key&#x3D;hive随机数，这样null分配到不同的key上，避免数据倾斜。</p>
<p>case when A then B else C end语法：</p>
<p>当b表的字段id为null时，对id取值为拼接字符串（hive+随机数），否则依然取b.id；然后on条件为：hive随机数&#x3D;c.id或者b.id&#x3D;c.id。</p>
<h2 id="group-by"><a href="#group-by" class="headerlink" title="group by"></a>group by</h2><p>对于group by聚合，默认情况下，Map阶段同一Key的数据发给一个reduce，若某个key的数据量太大，可能会造成数据倾斜。</p>
<p>如果在Map端就直接完成部分聚合，最后在Reduce端得出最终结果，就可以避免数据倾斜。</p>
<p>需要在Map端进行聚合参数设置：</p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> 是否在<span class="built_in">Map</span>端进行聚合，默认是<span class="literal">true</span></span><br><span class="line"><span class="built_in">set</span> hive.<span class="built_in">map</span>.aggr = <span class="literal">true</span></span><br><span class="line"> </span><br><span class="line"><span class="number">2.</span> 在<span class="built_in">Map</span>端进行聚合操作的条目数，默认<span class="number">10</span>w条</span><br><span class="line"><span class="built_in">set</span> hive.groupby.mapaggr.checkinterval = <span class="number">100000</span></span><br><span class="line"> </span><br><span class="line"><span class="number">3.</span> 有数据倾斜时进行负载均衡，默认<span class="literal">false</span></span><br><span class="line"><span class="built_in">set</span> hive.groupby.skewindata = <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>原理是当set hive.groupby.skewindata &#x3D; true后，会生成两个MR Job，启两个任务。</p>
<p>job1将group by的key，相同的key可能随机分发到不同的Reduce中，然后Reduce依据key对数据进行聚合，此时每一个Reduce中每个数据的key不一定相同，但是经过这一步聚合后，大大减少了数据量。</p>
<p>job2是真正意义上MR的底层实现，将相同的key分配到同一个reduce中，进行key的聚合操作。</p>
<p>第一步job1实现负载均衡，第二步job2实现聚合需求。</p>
<p>如果skewindata参数&#x3D;false，也就是默认情况下，只会进行job2操作，进行一次MapReduce。</p>
<h2 id="count"><a href="#count" class="headerlink" title="count"></a>count</h2><p>用 count(distinct key)处理数据</p>
<p>当数据量大的时候，由于count（distinct key）去重聚合是全聚合操作，即便是设定了reduce tasks的个数，例如set mapred.reduce.tasks&#x3D;100；hive也只会启动一个reducer（order by也是这个情况），这就造成一个reducer处理的数据量太大，导致整个Job完成的很慢。</p>
<p>可以将count（distinct key）的方式，改为先group by 再count的方式，也就是将distinct换成group by。</p>
<p>这种优化可以增加reducer的个数，虽然会用多个Job完成，但是适合处理数据量大的情况。</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">原始：  <span class="keyword">select</span> count(<span class="keyword">distinct</span> id) <span class="keyword">from</span> <span class="keyword">table</span>;</span><br><span class="line"> </span><br><span class="line">优化后：<span class="keyword">select</span> count(id) <span class="keyword">from</span> (<span class="keyword">select</span> id <span class="keyword">from</span> <span class="keyword">table</span> <span class="keyword">group</span> <span class="keyword">by</span> id) a;</span><br></pre></td></tr></table></figure>

<h2 id="行列过滤（分区过滤，先where再join嵌套子查询）——谓词下推"><a href="#行列过滤（分区过滤，先where再join嵌套子查询）——谓词下推" class="headerlink" title="行列过滤（分区过滤，先where再join嵌套子查询）——谓词下推"></a>行列过滤（分区过滤，先where再join嵌套子查询）——谓词下推</h2><p>列处理：在select中，只拿需要的列，如果有分区，尽量使用分区字段查询（分区过滤），避免使用select *全表扫描select key from tablename where 分区字段 &#x3D; ‘~’</p>
<p>行处理：两表连接时，对一个表的数据先where过滤，再join（如果先join再过滤，过滤的数据量会很大），即嵌套子查询</p>
<p>在Hive中，可以通过将参数hive.optimize.ppd设置为true，启用谓词下推。与它对应的逻辑优化器是PredicatePushDown。该优化器就是将OperatorTree中的FilterOperator向上提</p>
<p>Hive中与列裁剪和分区裁剪优化相关的配置参数分别为：hive.optimize.cp和hive.optimize.pruner，默认都是true。</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">eg：join两张表，A表joinB表，要求是把B表中<span class="built_in">id</span>&lt;<span class="number">10</span>的过滤掉后，只查询联结表的<span class="built_in">id</span>列</span><br><span class="line">原始： select a.<span class="built_in">id</span> <span class="keyword">from</span> A a join B b <span class="keyword">on</span> a.<span class="built_in">id</span>=b.<span class="built_in">id</span> <span class="keyword">where</span> b.<span class="built_in">id</span>&lt;<span class="number">10</span></span><br><span class="line"> </span><br><span class="line">优化后：select a.<span class="built_in">id</span> <span class="keyword">from</span> A a join (select <span class="built_in">id</span> <span class="keyword">from</span> B <span class="keyword">where</span> <span class="built_in">id</span>&lt;<span class="number">10</span>) b <span class="keyword">on</span> a.<span class="built_in">id</span>=b.<span class="built_in">id</span></span><br></pre></td></tr></table></figure>

<h2 id="动态分区"><a href="#动态分区" class="headerlink" title="动态分区"></a>动态分区</h2><p>分区列是表的一个伪列，它对应HDFS的一个分区文件夹，并且分区列存在于表的最后。</p>
<p>如果不设定动态分区，往分区表中导入数据的方式如下：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> 创建分区表</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> stu_par(id <span class="type">int</span>,<span class="type">name</span> string)</span><br><span class="line">partitioned <span class="keyword">by</span> (month string)</span><br><span class="line"><span class="keyword">row</span> <span class="keyword">format</span> delimited fields terminated <span class="keyword">by</span> <span class="string">&#x27;\t&#x27;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="number">2.</span> 往分区中导入数据</span><br><span class="line"><span class="keyword">load</span> data <span class="keyword">local</span> inpath <span class="string">&#x27;/opt/module/datas/student.txt&#x27;</span> <span class="keyword">into</span> <span class="keyword">table</span> stu_par <span class="keyword">partition</span>(month=<span class="string">&#x27;10&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>如果设定动态分区，导入数据就不再需要指定分区字段了</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>. 设置为非严格模式（默认strict，表示必须指定至少一个分区为静态分区；nonstrict表示允许所有分区可使用动态分区）</span><br><span class="line"></span><br><span class="line">hive<span class="selector-class">.exec</span><span class="selector-class">.dynamic</span><span class="selector-class">.partition</span>.mode=nonstrict</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>. 默认配置</span><br><span class="line"></span><br><span class="line">（<span class="number">1</span>）开启动态分区功能（默认true，开启）</span><br><span class="line"></span><br><span class="line">hive<span class="selector-class">.exec</span><span class="selector-class">.dynamic</span>.partition=true</span><br><span class="line"></span><br><span class="line">（<span class="number">2</span>）在所有执行MR节点上，最大一共可以创建多少个动态分区，默认<span class="number">1000</span>个</span><br><span class="line"></span><br><span class="line">hive<span class="selector-class">.exec</span><span class="selector-class">.max</span><span class="selector-class">.dynamic</span>.partitions=<span class="number">1000</span></span><br><span class="line"></span><br><span class="line">（<span class="number">3</span>）在每个执行MR的节点上，最大可以创建多少个分区，默认值<span class="number">100</span></span><br><span class="line"></span><br><span class="line">eg：若源数据包含一年的数据，按照天数分区，day字段应该有<span class="number">365</span>个值，这里的默认值<span class="number">100</span>就应该修改为大于<span class="number">365</span>的数。</span><br><span class="line"></span><br><span class="line">hive<span class="selector-class">.exec</span><span class="selector-class">.max</span><span class="selector-class">.dynamic</span><span class="selector-class">.partitions</span>.pernode=<span class="number">100</span></span><br><span class="line"></span><br><span class="line">（<span class="number">4</span>）整个MR job中，最大可以创建多少个HDFS文件，默认<span class="number">100000</span></span><br><span class="line"></span><br><span class="line">hive<span class="selector-class">.exec</span><span class="selector-class">.max</span><span class="selector-class">.created</span>.files=<span class="number">100000</span></span><br></pre></td></tr></table></figure>

<p>操作 ：</p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">1. 创建分区表</span><br><span class="line">create table dept_par(id string,name string) partitioned by (location int)</span><br><span class="line">row format delimited fields terminated by &#x27;\t&#x27;;</span><br><span class="line"> </span><br><span class="line">2. 设置动态分区非严格模式</span><br><span class="line">set hive.exec.dynamic.partition.mode = nonstrict;</span><br><span class="line"> </span><br><span class="line">3. 查看dept表</span><br><span class="line">+--------------+-------------+-----------+--+</span><br><span class="line">|<span class="string"> dept.deptno  </span>|<span class="string"> dept.dname  </span>|<span class="string"> dept.loc  </span>|</span><br><span class="line">+--------------+-------------+-----------+--+</span><br><span class="line">|<span class="string"> 10           </span>|<span class="string"> ACCOUNTING  </span>|<span class="string"> 1700      </span>|</span><br><span class="line">|<span class="string"> 20           </span>|<span class="string"> RESEARCH    </span>|<span class="string"> 1800      </span>|</span><br><span class="line">|<span class="string"> 30           </span>|<span class="string"> SALES       </span>|<span class="string"> 1900      </span>|</span><br><span class="line">|<span class="string"> 40           </span>|<span class="string"> OPERATIONS  </span>|<span class="string"> 1700      </span>|</span><br><span class="line">+--------------+-------------+-----------+--+</span><br><span class="line"> </span><br><span class="line">4. 分区表动态导入数据（并未指定分区字段的值）</span><br><span class="line">insert into table dept_par partition(location) select deptno,dname,loc from dept;</span><br><span class="line">...</span><br><span class="line">	Loading partition &#123;location=1900&#125;</span><br><span class="line">	Loading partition &#123;location=1800&#125;</span><br><span class="line">	Loading partition &#123;location=1700&#125;</span><br><span class="line">...</span><br><span class="line"> </span><br><span class="line">5. 查看分区表的分区情况</span><br><span class="line">hive (hive_db1)&gt; show partitions dept_par;</span><br><span class="line">OK</span><br><span class="line">partition</span><br><span class="line">location=1700</span><br><span class="line">location=1800</span><br><span class="line">location=1900</span><br><span class="line"> </span><br><span class="line">6. 查询分区表</span><br><span class="line">select <span class="symbol">*</span> from dept_par where location=&#x27;1700&#x27;;</span><br><span class="line">+--------------+----------------+--------------------+--+</span><br><span class="line">|<span class="string"> dept_par.id  </span>|<span class="string"> dept_par.name  </span>|<span class="string"> dept_par.location  </span>|</span><br><span class="line">+--------------+----------------+--------------------+--+</span><br><span class="line">|<span class="string"> 10           </span>|<span class="string"> ACCOUNTING     </span>|<span class="string"> 1700               </span>|</span><br><span class="line">|<span class="string"> 40           </span>|<span class="string"> OPERATIONS     </span>|<span class="string"> 1700               </span>|</span><br><span class="line">+--------------+----------------+--------------------+--+</span><br><span class="line"> </span><br><span class="line">select <span class="symbol">*</span> from dept_par where location=&#x27;1800&#x27;;</span><br><span class="line">+--------------+----------------+--------------------+--+</span><br><span class="line">|<span class="string"> dept_par.id  </span>|<span class="string"> dept_par.name  </span>|<span class="string"> dept_par.location  </span>|</span><br><span class="line">+--------------+----------------+--------------------+--+</span><br><span class="line">|<span class="string"> 20           </span>|<span class="string"> RESEARCH       </span>|<span class="string"> 1800               </span>|</span><br><span class="line">+--------------+----------------+--------------------+--+</span><br><span class="line"> </span><br><span class="line">select <span class="symbol">*</span> from dept_par where location=&#x27;1900&#x27;;</span><br><span class="line">+--------------+----------------+--------------------+--+</span><br><span class="line">|<span class="string"> dept_par.id  </span>|<span class="string"> dept_par.name  </span>|<span class="string"> dept_par.location  </span>|</span><br><span class="line">+--------------+----------------+--------------------+--+</span><br><span class="line">|<span class="string"> 30           </span>|<span class="string"> SALES          </span>|<span class="string"> 1900               </span>|</span><br><span class="line">+--------------+----------------+--------------------+--+</span><br></pre></td></tr></table></figure>

<p><strong>原理：</strong></p>
<p>将select的最后一列，认为是分区列（因为分区列在表的最后），将最后一列字段值相同的行，导入同一个分区中；</p>
<p>好处是避免了指定分区字段的值，直接动态的将值相同的行导入同一个分区中，加大效率。</p>
<p>ps：如果把deptno放在select最后一列，那么会生成四个分区</p>
<h2 id="分桶"><a href="#分桶" class="headerlink" title="分桶"></a>分桶</h2><p>适合对数据进行抽样查询的情况，clustered by 字段 into x buckets，将表数据以（字段hash值%分桶数）按照取模结果，对数据进行分桶，也就是随机分布成几块。</p>
<p>ps：分区列是伪列，需要指明字段类型；分桶列是实际列，不需要指明字段类型。</p>
<p>分桶前，需要设置属性set hive.enforce.bucketing &#x3D; true</p>
<h2 id="分区表"><a href="#分区表" class="headerlink" title="分区表"></a>分区表</h2><p>主要目的是提高hive查询效率，避免全表查询 select * from tablename where 分区字段 &#x3D; ‘~’</p>
<h1 id="zookeeper"><a href="#zookeeper" class="headerlink" title="zookeeper"></a>zookeeper</h1><p>生产上namenode是两个是没有snn的，同样yarn的老大也是两个，是忘了防止一个老大突然挂掉，然后让下一个上位</p>
<p>控制整个老大的更换的就是zookeeper</p>
<p>hadoop ： 请求服务是不用关注所有节点的ip的，我们只用关注namenode的，但是当是两个namenode的时候（生产上），这个时候就会把两个namenode放在一起，形成一个namespace-》zookeeper实现</p>
<p>部署 ：</p>
<ul>
<li>单点</li>
<li>分布式</li>
<li>要求 ：部署的机器数量有要求 ，2n + 1 台机器</li>
</ul>
<p>主从架构 ：如果老大挂了，后面的老二就会上位</p>
<p>zookeeper版本有很多：但是对于我们现在能用就行 ： 3.8.0</p>
<p>部署 ：</p>
<p>有前置要求：具体查看官网 ：对系统有要求 ： jdk 1.8orlater</p>
<p>先把包解压 -》 软连接 -》 zookeeper -》 环境变量 -》 *cmd的是windows上运行的 -》 进入 conf目录 zoo.cfg（改名之后）</p>
<ul>
<li>单点：直接dataDir:改成自己的 - 》 启动</li>
<li>分布 ：dataDir ,三台机器的id，以及机器id的端口号</li>
</ul>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">bigdata3</span></span><br><span class="line"><span class="attribute">dataDir</span>=xxxxx</span><br><span class="line"><span class="attribute">server</span>.<span class="number">1</span>=bigdata3:<span class="number">2888</span>:<span class="number">3888</span></span><br><span class="line"><span class="attribute">server</span>.<span class="number">2</span>=bigdata4:<span class="number">2888</span>:<span class="number">3888</span></span><br><span class="line"><span class="attribute">server</span>.<span class="number">3</span>=bigdata5:<span class="number">2888</span>:<span class="number">3888</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">myid</span> : 指定机器号 ： 在zookeeper的数据文件夹下创建一个myid，id号就是server点的数字</span><br></pre></td></tr></table></figure>

<p>然后启动zk ： 通过zkServer.sh start</p>
<p>分布式要每一台机器上都整</p>
<p>分布式：查看status之后会出现 follower 和leader 就是副手和老大</p>
<p>然后创建一个群起脚本</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> [ <span class="variable">$#</span> -lt <span class="number">1</span> ];then</span><br><span class="line">echo <span class="string">&quot;start|stop|status&quot;</span></span><br><span class="line"><span class="keyword">exit</span> <span class="number">1</span></span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> startzk()&#123;</span><br><span class="line"> nohup zkServer.sh start  &gt; ~<span class="regexp">/log/</span>zk.log <span class="number">1</span>&gt;&amp;<span class="number">2</span> &amp;</span><br><span class="line"> ssh bigdata4 <span class="string">&quot;zkServer.sh start&quot;</span></span><br><span class="line"> ssh bigdata5 <span class="string">&quot;zkServer.sh start&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> stopzk()&#123;</span><br><span class="line"> nohup zkServer.sh stop  &gt; ~<span class="regexp">/log/</span>zk.log <span class="number">1</span>&gt;&amp;<span class="number">2</span> &amp;</span><br><span class="line"> ssh bigdata4 <span class="string">&quot;zkServer.sh stop&quot;</span></span><br><span class="line"> ssh bigdata5 <span class="string">&quot;zkServer.sh stop&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> statuszk()&#123;</span><br><span class="line">echo <span class="string">&quot;-----------------bigdata3------------------&quot;</span></span><br><span class="line">jps | grep QuorumPeerMain</span><br><span class="line">echo <span class="string">&quot;-----------------bigdata4------------------&quot;</span></span><br><span class="line">ssh bigdata4 <span class="string">&quot;jps | grep QuorumPeerMain&quot;</span></span><br><span class="line">echo <span class="string">&quot;-----------------bigdata5------------------&quot;</span></span><br><span class="line">ssh bigdata5 <span class="string">&quot;jps | grep QuorumPeerMain&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">case <span class="variable">$1</span> <span class="keyword">in</span></span><br><span class="line">    <span class="string">&quot;start&quot;</span>)</span><br><span class="line">    startzk</span><br><span class="line">    ;;</span><br><span class="line">    <span class="string">&quot;stop&quot;</span>)</span><br><span class="line">    stopzk</span><br><span class="line">    ;;</span><br><span class="line">    <span class="string">&quot;status&quot;</span>)</span><br><span class="line">    statuszk</span><br><span class="line">    ;;</span><br><span class="line">    *)</span><br><span class="line">    echo <span class="string">&quot;error input&quot;</span></span><br><span class="line">    ;;</span><br><span class="line">esac</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="zk是干什么的？"><a href="#zk是干什么的？" class="headerlink" title="zk是干什么的？"></a>zk是干什么的？</h2><p>zk可以做监控，可以检查到机器是不是还活着，</p>
<p>管理配置信息的</p>
<h2 id="zk的数据模型"><a href="#zk的数据模型" class="headerlink" title="zk的数据模型"></a>zk的数据模型</h2><p>层级式的结构，一个树形的结构，和linux差不多</p>
<p>节点&#x2F;目录</p>
<ul>
<li>节点就是目录</li>
<li>节点保存数据的内容</li>
<li>zk里的所有的目录都可以叫节点</li>
</ul>
<p>通过命令 ：zkCli.sh 访问zk</p>
<p>然后我们可以对其数据进行操作 ：</p>
<ul>
<li><p>查看节点 ：ls name</p>
</li>
<li><p>查看节点内容 ： get name</p>
</li>
<li><p>节点</p>
<ul>
<li>临时节点 ：只在当前session有效 ，关闭当前会话，则就失效，不可以存放子节点</li>
<li>永久节点 ：永久存在的，可以存放子节点</li>
</ul>
</li>
<li><p>zk 每个节点都有自己的id，节点号，不会重复 ， 数据是存放在节点上的</p>
</li>
<li><p>数据不是很大的数据</p>
</li>
<li><p>仅仅是比较小的数据</p>
</li>
<li><p>如果存放的数据发生变更，数据版本号也会发生变更</p>
</li>
<li><p>创建节点 ： create : <code>create /dl2262 zihang</code></p>
</li>
<li><p>stat path :获取当前节点状态 ： <code>stat /dl2262</code></p>
</li>
<li><pre><code>cZxid = 0x300000002 id
ctime = Thu Dec 15 14:52:29 CST 2022
mZxid = 0x300000002
mtime = Thu Dec 15 14:52:29 CST 2022
pZxid = 0x300000002
cversion = 0 
dataVersion = 0 数据版本
aclVersion = 0 权限的版本
ephemeralOwner = 0x0 是不是临时节点 0x0 不是临时节点 其余就是临时节点
dataLength = 6 数据的长度：zihang就是6个字节
numChildren = 0 下面的子节点
</code></pre>
</li>
<li><p>create -e ：创建临时节点 ：<code>create -e /dl2262 zuan</code> 临时节点也有自己的过期时间，时间一过就会自动删除（重新启动客户端的时候）</p>
</li>
<li><p>顺序节点 ： create -s  默认会给节点后面加一个自增的序列： <code>create -s /dl2262/ziyuan</code></p>
</li>
<li><p>不可以创建深层文件夹的方式命令，如果使用zk的api则可以，或者java代码的方式</p>
</li>
<li><p>修改数据内容的 ： set :   <code>set [-s] [-v version] path data-&gt;set /dl2262 xxxx  </code></p>
<ul>
<li>数据版本 ： 如果数据版本不对应，就会报错的</li>
</ul>
</li>
<li><p>删除节点 ：delete ： <code>delete [-v version] path</code> 或者deleteall 删除其及以下所有数据</p>
</li>
<li><p>如果版本不对还是要出错的</p>
</li>
<li><p>zk自带的监控 ， 监听器</p>
</li>
<li><p>命令中有-w的就是可以监听的</p>
</li>
<li><p>针对每一个节点都可以执行的，每个节点都有一个监听器，当每个节点发生变化，就会触发watch事件</p>
</li>
<li><p>但是zk的shell命令每次只能监听一次 ， zk的原生的api不行，但是curator 的可以一直监听</p>
</li>
<li><p>命令 stat -w nodenpath 就可以监听，或者get -w nodepath等</p>
</li>
<li><p>但是命令行的方式只能触发一次</p>
</li>
</ul>
<p>zk的四字命令</p>
<ul>
<li>zk要对外进行服务的</li>
<li>通过器对外的端口对其进行监控这个是对zk进行监控的</li>
<li>使用前提 ： 要编辑配置文件 ：在zoo.cng这个配置文件里添加 <code>4lw.commands.whitelist=*</code></li>
<li>stat ：可以列出自己的服务端和客户端的一些详细信息</li>
<li>使用方式 ： 直接在linux命令行操作 ， <code>echo stat | telnet localhost 2181</code></li>
<li>ruok : are you ok ? 就是检测服务的功能启动了吗</li>
<li>dump ：列出最近的会话和临时节点的详细信息</li>
<li>conf ： 打印机器的配置</li>
</ul>
<p>或者可以使用Prometheus框架监控</p>

      
    </div>

    
    
    

      
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="liu zihang"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">liu zihang</p>
  <div class="site-description" itemprop="description">只有努力不会辜负你</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">53</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
  </nav>
</div>
  <div class="sidebar-button motion-element"><i class="fa fa-comment"></i>
    Chat
  </a>
  </div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/yourname" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;yourname" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      链接网站
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://baidu.com/" title="https:&#x2F;&#x2F;baidu.com" rel="noopener" target="_blank">百度</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://fishc.com.cn/" title="https:&#x2F;&#x2F;fishc.com.cn" rel="noopener" target="_blank">鱼C论坛</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">liu zihang</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count">博客全站共141.3k字</span>
</div>


    <script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

    <span id="busuanzi_container_site_pv">总访问量<span id="busuanzi_value_site_pv"></span>次</span>
    <span class="post-meta-divider">|</span>
    <span id="busuanzi_container_site_uv">总访客数<span id="busuanzi_value_site_uv"></span>人</span>
    <span class="post-meta-divider">|</span>
<!-- 不蒜子计数初始值纠正 -->
<script>
$(document).ready(function() {

    var int = setInterval(fixCount, 50);  // 50ms周期检测函数
    var countOffset = 20000;  // 初始化首次数据

    function fixCount() {            
       if (document.getElementById("busuanzi_container_site_pv").style.display != "none")
        {
            $("#busuanzi_value_site_pv").html(parseInt($("#busuanzi_value_site_pv").html()) + countOffset); 
            clearInterval(int);
        }                  
        if ($("#busuanzi_container_site_pv").css("display") != "none")
        {
            $("#busuanzi_value_site_uv").html(parseInt($("#busuanzi_value_site_uv").html()) + countOffset); // 加上初始数据 
            clearInterval(int); // 停止检测
        }  
    }
       	
});
</script> 

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  
  <script color='0,0,255' opacity='0.5' zIndex='-1' count='99' src="/lib/canvas-nest/canvas-nest.min.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>


  <script defer src="/lib/three/three.min.js"></script>
    <script defer src="/lib/three/canvas_lines.min.js"></script>


  




  
<script src="/js/local-search.js"></script>













  

  

  


</body>
</html>
